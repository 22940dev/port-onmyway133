<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="generator" content="Hexo 4.2.0"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>onmyway133</title><meta description="What you don&amp;#39;t know is what you haven&amp;#39;t learned"><meta property="og:type" content="blog"><meta property="og:title" content="onmyway133"><meta property="og:url" content="https://onmyway133.github.io/"><meta property="og:site_name" content="onmyway133"><meta property="og:description" content="What you don&amp;#39;t know is what you haven&amp;#39;t learned"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://onmyway133.github.io/img/og_image.png"><meta property="article:author" content="Khoa Pham"><meta property="article:tag" content="ios"><meta property="article:tag" content=" android"><meta property="article:tag" content="javascript"><meta property="article:tag" content=" react"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><meta property="twitter:creator" content="@onmyway133"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://onmyway133.github.io"},"headline":"onmyway133","image":["https://onmyway133.github.io/img/og_image.png"],"author":{"@type":"Person","name":"Khoa Pham"},"description":"What you don&#39;t know is what you haven&#39;t learned"}</script><link rel="alternative" href="/atom.xml" title="onmyway133" type="application/atom+xml"><link rel="icon" href="/img/favicon.ico"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=UA-40119591-5" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'UA-40119591-5');</script><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><script data-ad-client="ca-pub-3656459401405265" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" async></script></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/z.png" alt="onmyway133" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/apps">Apps</a><a class="navbar-item" href="/gumroad">Gumroad</a><a class="navbar-item" href="/about">About</a><a class="navbar-item" href="/opensource">Open Source</a><a class="navbar-item" href="/writing">Writing</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/speaking">Speaking</a><a class="navbar-item" href="/news">News</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/onmyway133"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-04-26T05:32:40.000Z" title="2019-04-26T05:32:40.000Z">2019-04-26</time><span class="level-item">a few seconds read (About 30 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-map-from-Swift-5-Resul-to-RxSwift-PublishSubject/">How to map from Swift 5 Resul to RxSwift PublishSubject</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/214">#214</a></strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Result</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">to</span><span class="params">(subject: PublishSubject&lt;Success&gt;)</span></span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> <span class="keyword">self</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> .success(<span class="keyword">let</span> value):</span><br><span class="line">            subject.onNext(value)</span><br><span class="line">        <span class="keyword">case</span> .failure(<span class="keyword">let</span> error):</span><br><span class="line">            subject.onError(error)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-04-23T17:14:31.000Z" title="2019-04-23T17:14:31.000Z">2019-04-23</time><span class="level-item">a few seconds read (About 64 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-update-NSMenuItem-while-NSMenu-is-showing-in-macOS/">How to update NSMenuItem while NSMenu is showing in macOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/213">#213</a></strong></p>
<p>Use <code>Runloop</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">timer = <span class="type">Timer</span>.scheduledTimer(withTimeInterval: <span class="number">1</span>, repeats: <span class="literal">true</span>, block: &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] <span class="number">_</span> <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">let</span> date = <span class="type">Date</span>()</span><br><span class="line">    <span class="keyword">self</span>?.updateStopItem(seconds: finishDate.timeIntervalSince1970 - date.timeIntervalSince1970)</span><br><span class="line">&#125;)</span><br><span class="line">        </span><br><span class="line"><span class="type">RunLoop</span>.main.add(timer!, forMode: .common)</span><br></pre></td></tr></table></figure>

<p>Use <code>Dispatch</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">timer = <span class="type">Timer</span>.scheduledTimer(withTimeInterval: <span class="number">1</span>, repeats: <span class="literal">true</span>, block: &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] <span class="number">_</span> <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">let</span> date = <span class="type">Date</span>()</span><br><span class="line">    <span class="type">DispatchQueue</span>.main.async &#123;</span><br><span class="line">        <span class="keyword">self</span>?.updateStopItem(seconds: finishDate.timeIntervalSince1970 - date.timeIntervalSince1970)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<hr>
<p><strong>Updated at</strong> 2020-09-08 07:54:36</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-04-23T17:11:25.000Z" title="2019-04-23T17:11:25.000Z">2019-04-23</time><span class="level-item">a few seconds read (About 83 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-use-Timer-in-Swift/">How to use Timer in Swift</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/212">#212</a></strong></p>
<p>Pre iOS 10</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">schedule</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="type">DispatchQueue</span>.main.async &#123;</span><br><span class="line">      <span class="keyword">self</span>.timer = <span class="type">Timer</span>.scheduledTimer(timeInterval: <span class="number">20</span>, target: <span class="keyword">self</span>,</span><br><span class="line">                                   selector: #selector(<span class="keyword">self</span>.timerDidFire(timer:)), userInfo: <span class="literal">nil</span>, repeats: <span class="literal">false</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@objc</span> <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">timerDidFire</span><span class="params">(timer: Timer)</span></span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(timer)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>iOS 10+</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">DispatchQueue</span>.main.async &#123;</span><br><span class="line">      <span class="keyword">self</span>.timer = <span class="type">Timer</span>.scheduledTimer(withTimeInterval: <span class="number">20</span>, repeats: <span class="literal">false</span>) &#123; timer <span class="keyword">in</span></span><br><span class="line">        <span class="built_in">print</span>(timer)</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Note that</p>
<ul>
<li>It needs to be on the main queue</li>
<li>Callback function can be public, private, …</li>
<li>Callback function needs to be <code>@objc</code></li>
</ul>
<p>Original answer <a href="https://stackoverflow.com/a/42273141/1418457">https://stackoverflow.com/a/42273141/1418457</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-04-18T17:51:10.000Z" title="2019-04-18T17:51:10.000Z">2019-04-18</time><span class="level-item">a minute read (About 212 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-overload-functions-in-Swift/">How to overload functions in Swift</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/211">#211</a></strong></p>
<h2 id="Function"><a href="#Function" class="headerlink" title="Function"></a>Function</h2><p>Functions in Swift are distinguishable by</p>
<ul>
<li>parameter label</li>
<li>parameter type</li>
<li>return type</li>
</ul>
<p>so that these are all valid, and works for <code>subscript</code> as well</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">A</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// return type</span></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">get</span><span class="params">()</span></span> -&gt; <span class="type">String</span> &#123; <span class="keyword">return</span> <span class="string">""</span> &#125;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">get</span><span class="params">()</span></span> -&gt; <span class="type">Int</span> &#123; <span class="keyword">return</span> <span class="number">1</span> &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// mix of parameter type and return type</span></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">get</span><span class="params">(param: String)</span></span> -&gt; <span class="type">String</span> &#123; <span class="keyword">return</span> <span class="string">""</span> &#125;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">get</span><span class="params">(param: String)</span></span> -&gt; <span class="type">Int</span> &#123; <span class="keyword">return</span> <span class="number">1</span> &#125;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">get</span><span class="params">(param: Int)</span></span> -&gt; <span class="type">Int</span> &#123; <span class="keyword">return</span> <span class="number">1</span> &#125;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">get</span><span class="params">(param: Int)</span></span> -&gt; <span class="type">String</span> &#123; <span class="keyword">return</span> <span class="string">""</span> &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">subscript</span>(param: <span class="type">String</span>) -&gt; <span class="type">String</span> &#123; <span class="keyword">return</span> <span class="string">""</span> &#125;</span><br><span class="line">  <span class="keyword">subscript</span>(param: <span class="type">String</span>) -&gt; <span class="type">Int</span> &#123; <span class="keyword">return</span> <span class="number">1</span> &#125;</span><br><span class="line">  <span class="keyword">subscript</span>(param: <span class="type">Int</span>) -&gt; <span class="type">Int</span> &#123; <span class="keyword">return</span> <span class="number">1</span> &#125;</span><br><span class="line">  <span class="keyword">subscript</span>(param: <span class="type">Int</span>) -&gt; <span class="type">String</span> &#123; <span class="keyword">return</span> <span class="string">""</span> &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// parameter label</span></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">set</span><span class="params">(int: Int)</span></span> &#123;&#125;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">set</span><span class="params">(string: String)</span></span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// concrete type from generic</span></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">get</span><span class="params">(param: Array&lt;String&gt;)</span></span> -&gt; <span class="type">String</span> &#123; <span class="keyword">return</span> <span class="string">""</span> &#125;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">get</span><span class="params">(param: Array&lt;Int&gt;)</span></span> -&gt; <span class="type">Int</span> &#123; <span class="keyword">return</span> <span class="number">1</span> &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">subscript</span>(param: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;) -&gt; <span class="type">String</span> &#123; <span class="keyword">return</span> <span class="string">""</span> &#125;</span><br><span class="line">  <span class="keyword">subscript</span>(param: <span class="type">Array</span>&lt;<span class="type">Int</span>&gt;) -&gt; <span class="type">Int</span> &#123; <span class="keyword">return</span> <span class="number">1</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>When you specialize a generic type, like <code>Array&lt;Int&gt;</code>, you’re actually using a concrete type</p>
<p>Unfortunately, this does not work for NSObject subclass</p>
<blockquote>
<p>Method ‘get()’ with Objective-C selector ‘get’ conflicts with previous declaration with the same Objective-C selector</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span>: <span class="title">NSObject</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">get</span><span class="params">()</span></span> -&gt; <span class="type">String</span> &#123; <span class="keyword">return</span> <span class="string">""</span> &#125;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">get</span><span class="params">()</span></span> -&gt; <span class="type">Int</span> &#123; <span class="keyword">return</span> <span class="number">1</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Generic-function"><a href="#Generic-function" class="headerlink" title="Generic function"></a>Generic function</h2><p>We can overload generic functions as well</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f</span>&lt;T&gt;<span class="params">(t: T)</span></span> &#123;</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">"T"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f</span><span class="params">(string: String)</span></span> &#123;</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">"String"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f</span><span class="params">(int: Int)</span></span> &#123;</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">"Int"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-04-18T17:49:26.000Z" title="2019-04-18T17:49:26.000Z">2019-04-18</time><span class="level-item">5 minutes read (About 794 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/Understanding-AVFoundation-and-MediaPlayer-frameworks-in-iOS/">Understanding AVFoundation and MediaPlayer frameworks in iOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/210">#210</a></strong></p>
<p>Depending on what features we want to achieve, we need to go with either AVFoundation or MediaPlayer framework. As someone who worked with many apps that involve media playback, here are some of my observations</p>
<h2 id="MPMoviePlayerController-vs-AVPlayer"><a href="#MPMoviePlayerController-vs-AVPlayer" class="headerlink" title="MPMoviePlayerController vs AVPlayer"></a>MPMoviePlayerController vs AVPlayer</h2><p>At first, I use MPMoviePlayerController because it is very simple, in fact, it is a wrapper around AVPlayer. It offers a lot of useful notifications and properties.</p>
<p>But when my requirements change, a lot more features are needed, I need to change to AVPlayer to have more control. And that is the wisest decision I’ve ever made</p>
<p>You should use AVPlayer as soon as possible. Using it cost you just a little longer time than MPMoviePlayerController, but you have a lot of control.</p>
<h2 id="Custom-controls"><a href="#Custom-controls" class="headerlink" title="Custom controls"></a>Custom controls</h2><p>When building your own player, the built in controls of MPMoviePlayerController may not satisfy your need. I see many questions on SO are about custom controls.</p>
<h2 id="MPMoviePlayerController"><a href="#MPMoviePlayerController" class="headerlink" title="MPMoviePlayerController"></a>MPMoviePlayerController</h2><p>You have to set controlStyle to MPMovieControlStyleNone, set up Timer because currentPlaybackTime is not KVO compliance</p>
<h2 id="AVPlayer"><a href="#AVPlayer" class="headerlink" title="AVPlayer"></a>AVPlayer</h2><p>AVPlayer has no built in controls, but it has addPeriodicTimeObserverForInterval:queue:usingBlock: that makes handling the current time easily. The nicer thing about periodTimeObserver is that “The block is also invoked whenever time jumps and whenever playback starts or stops”</p>
<h2 id="Notification"><a href="#Notification" class="headerlink" title="Notification"></a>Notification</h2><h3 id="MPMoviePlayerController-1"><a href="#MPMoviePlayerController-1" class="headerlink" title="MPMoviePlayerController"></a>MPMoviePlayerController</h3><p>It has a lot of useful notifications, like MPMoviePlayerNowPlayingMovieDidChangeNotification, MPMoviePlayerLoadStateDidChangeNotification, MPMovieDurationAvailableNotification, …</p>
<h3 id="AVPlayer-1"><a href="#AVPlayer-1" class="headerlink" title="AVPlayer"></a>AVPlayer</h3><p>The AVPlayerItem has some notifications AVPlayerItemDidPlayToEndTimeNotification, AVPlayerItemPlaybackStalledNotification, …<br>If you want to have those same notifications as MPMoviePlayerController, you have to KVO some properties of AVPlayer like currentItem, currentTime, duration, … You have to read documents to make sure which property is KVO compliance</p>
<h2 id="Seek"><a href="#Seek" class="headerlink" title="Seek"></a>Seek</h2><h3 id="MPMoviePlayerController-2"><a href="#MPMoviePlayerController-2" class="headerlink" title="MPMoviePlayerController"></a>MPMoviePlayerController</h3><p>You can change the currentPlaybackTime to seek, but it results in jumping, because of efficiency and buffer status. I have to manually disable slider during seeking</p>
<h3 id="AVPlayer-2"><a href="#AVPlayer-2" class="headerlink" title="AVPlayer"></a>AVPlayer</h3><p>AVPlayer has this <strong>seekToTime:toleranceBefore:toleranceAfter:completionHandler:</strong> which allows you to specify the tolerance. Very nice</p>
<h2 id="Subtitle"><a href="#Subtitle" class="headerlink" title="Subtitle"></a>Subtitle</h2><h3 id="MPMoviePlayerController-3"><a href="#MPMoviePlayerController-3" class="headerlink" title="MPMoviePlayerController"></a>MPMoviePlayerController</h3><p>I have to schedule a timer that “wake” and “sleep” at the beginning and end time of a certain subtitle marker, respectively.</p>
<h3 id="AVPlayer-3"><a href="#AVPlayer-3" class="headerlink" title="AVPlayer"></a>AVPlayer</h3><p>AVPlayer has this <strong>addBoundaryTimeObserverForTimes:queue:usingBlock:</strong> that perfectly suits my need. I setup 2 boundary time observers, 1 for the beginning times, 1 for the end times. The beginning times is an array containing all beginning timestamps that a subtitle marker appears.</p>
<h2 id="Time-scale"><a href="#Time-scale" class="headerlink" title="Time scale"></a>Time scale</h2><p>AVPlayer uses CMTime that offers timescale, which is a more comfortable way to specify more accurate time</p>
<h2 id="Volume"><a href="#Volume" class="headerlink" title="Volume"></a>Volume</h2><p>AVPlayer has <strong>volume</strong> property (relative to system volume) that allows me to programmatically changes the player volume</p>
<h2 id="Playable-duration"><a href="#Playable-duration" class="headerlink" title="Playable duration"></a>Playable duration</h2><h3 id="MPMoviePlayerController-4"><a href="#MPMoviePlayerController-4" class="headerlink" title="MPMoviePlayerController"></a>MPMoviePlayerController</h3><p>It has playableDuration property</p>
<h3 id="AVPlayer-4"><a href="#AVPlayer-4" class="headerlink" title="AVPlayer"></a>AVPlayer</h3><p>You have to compute yourself. See <a href="http://stackoverflow.com/a/12260669/1418457">http://stackoverflow.com/questions/6815316/how-can-i-get-the-playable-duration-of-avplayer</a></p>
<h2 id="Full-screen"><a href="#Full-screen" class="headerlink" title="Full screen"></a>Full screen</h2><p>MPMoviePlayerController achieves full screen mode by creating another UIWindow, you learn from this to support full screen using AVPlayer, too</p>
<h2 id="Movie-Source-Type"><a href="#Movie-Source-Type" class="headerlink" title="Movie Source Type"></a>Movie Source Type</h2><h3 id="MPMoviePlayerController-5"><a href="#MPMoviePlayerController-5" class="headerlink" title="MPMoviePlayerController"></a>MPMoviePlayerController</h3><p>It has movieSourceType that provides clues to the playback system, hence improving load time</p>
<p>“ If you know the source type of the movie, setting the value of this property before playback begins can improve the load times for the movie content.”</p>
<h3 id="AVPlayer-5"><a href="#AVPlayer-5" class="headerlink" title="AVPlayer"></a>AVPlayer</h3><p>Read <strong>Handling Different Types of Asset</strong> on <a href="https://developer.apple.com/library/ios/documentation/AudioVideo/Conceptual/AVFoundationPG/Articles/02_Playback.html">AV Foundation Programming Guide</a></p>
<p>“To create and prepare an HTTP live stream for playback. Initialize an instance of AVPlayerItem using the URL. (You cannot directly create an AVAsset instance to represent the media in an HTTP Live Stream.)”</p>
<h2 id="AVAsset"><a href="#AVAsset" class="headerlink" title="AVAsset"></a>AVAsset</h2><p>AVPlayer allows you to access AVAsset, which provides you more information about the playback and load state</p>
<h2 id="Allow-a-range-within-a-video-to-be-playable"><a href="#Allow-a-range-within-a-video-to-be-playable" class="headerlink" title="Allow a range within a video to be playable"></a>Allow a range within a video to be playable</h2><p>AVPlayerItem has <strong>forwardPlaybackEndTime</strong> and <strong>reversePlaybackEndTime</strong> that is used to specify a range that the player can play. When forwardPlaybackEndTime is specified and the playhead passes this points, AVPlayerItem will trigger AVPlayerItemDidPlayToEndTimeNotification</p>
<p>But it doesn’t work in my case <a href="http://stackoverflow.com/questions/25717819/forwardplaybackendtime-does-not-work">forwardPlaybackEndTime does not work</a></p>
<h2 id="You-can-have-many-instances-of-AVPlayer-playing-at-the-same-time"><a href="#You-can-have-many-instances-of-AVPlayer-playing-at-the-same-time" class="headerlink" title="You can have many instances of AVPlayer playing at the same time"></a>You can have many instances of AVPlayer playing at the same time</h2><h3 id="Read-more"><a href="#Read-more" class="headerlink" title="Read more"></a>Read more</h3><ol>
<li><a href="https://developer.apple.com/library/mac/documentation/AudioVideo/Conceptual/AVFoundationPG/Articles/02_Playback.html">AV Foundation Programming Guide</a></li>
<li><a href="https://developer.apple.com/videos/wwdc/2011/">WWDC 2011 Session 405 Exploring AV Foundation</a></li>
<li><a href="https://developer.apple.com/videos/wwdc/2011/">WWDC 2011 Session 415 Working With Media In AV Foundation</a></li>
<li><a href="https://developer.apple.com/videos/wwdc/2014/">WWDC 2014 Session 503 Mastering Modern Media Playback</a></li>
<li><a href="https://developer.apple.com/videos/wwdc/2011/">WWDC 2011 Session 406 AirPlay and External Displays in iOS apps</a></li>
<li><a href="https://developer.apple.com/library/ios/samplecode/AVPlayerDemo/Introduction/Intro.html">AVPlayerDemo</a></li>
<li><a href="https://github.com/viki-org/VKVideoPlayer">VKVideoPlayer</a></li>
<li><a href="https://github.com/alobi/ALMoviePlayerController">ALMoviePlayerController</a></li>
<li><a href="http://mobiliture.com/ios/tutorials/av-foundation-playing-videos/">AV Foundation Playing Videos</a></li>
<li><a href="http://stackoverflow.com/questions/8146942/avplayer-and-mpmovieplayercontroller-differences">AVPlayer and MPMoviePlayerController differences</a></li>
<li><a href="http://jomnius.blogspot.com/2011/04/mpmovieplayer-tips.html">MPMoviePlayer Tips</a></li>
</ol>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-04-17T05:56:24.000Z" title="2019-04-17T05:56:24.000Z">2019-04-17</time><span class="level-item">7 minutes read (About 999 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-handle-reachability-in-iOS/">How to handle reachability in iOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/209">#209</a></strong></p>
<p>Here are what I learn about reachability handling in iOS, aka checking for internet connection. Hope you will find it useful, too.</p>
<p>This post starts with techniques from Objective age, but many of the concepts still hold true</p>
<h2 id="The-naive-way"><a href="#The-naive-way" class="headerlink" title="The naive way"></a>The naive way</h2><p>Some API you already know in UIKit can be used for checking internet connection. Most of them are synchronous code, so you ‘d better call them in a background thread</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">BOOL</span>)connectedToInternet</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSString</span> *string = [<span class="built_in">NSString</span> stringWithContentsOfURL:[<span class="built_in">NSURL</span> URLWithString:<span class="string">@"http://www.google.com"</span>]</span><br><span class="line">                                                encoding:<span class="built_in">NSUTF8StringEncoding</span></span><br><span class="line">                                                   error:<span class="literal">nil</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> string ? <span class="literal">YES</span> : <span class="literal">NO</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">BOOL</span>)connectedToInternet</span><br><span class="line">&#123;</span><br><span class="line">   <span class="built_in">NSURL</span> *url = [<span class="built_in">NSURL</span> URLWithString:<span class="string">@"http://www.google.com"</span>];</span><br><span class="line">   <span class="built_in">NSMutableURLRequest</span> *request = [<span class="built_in">NSMutableURLRequest</span> requestWithURL:url];</span><br><span class="line">   [request setHTTPMethod:<span class="string">@"HEAD"</span>];</span><br><span class="line">   <span class="built_in">NSHTTPURLResponse</span> *response;</span><br><span class="line">   [<span class="built_in">NSURLConnection</span> sendSynchronousRequest:request returningResponse:&amp;response error: <span class="literal">NULL</span>];</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> ([response statusCode] == <span class="number">200</span>) ? <span class="literal">YES</span> : <span class="literal">NO</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Using-SystemConfiguration-framework"><a href="#Using-SystemConfiguration-framework" class="headerlink" title="Using SystemConfiguration framework"></a>Using SystemConfiguration framework</h2><p>After importing the SystemConfiguration framework, you can use either SCNetworkReachabilityGetFlags to synchronously get the reachability status, or provide a callback to SCNetworkReachabilitySetCallback to be notified about reachability status change.</p>
<p>Note that <code>SCNetworkReachabilityGetFlags</code> is synchronous.</p>
<blockquote>
<p>The System Configuration framework reachability API () operates synchronously by default. Thus, seemingly innocuous routines like SCNetworkReachabilityGetFlags can get you killed by the watchdog. If you’re using the reachability API, you should use it asynchronously. This involves using the SCNetworkReachabilityScheduleWithRunLoop routine to schedule your reachability queries on the run loop</p>
</blockquote>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">BOOL</span>) isConnectionAvailable</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">SCNetworkReachabilityFlags</span> flags;</span><br><span class="line">        <span class="built_in">BOOL</span> receivedFlags;</span><br><span class="line"> </span><br><span class="line">        <span class="built_in">SCNetworkReachabilityRef</span> reachability = <span class="built_in">SCNetworkReachabilityCreateWithName</span>(<span class="built_in">CFAllocatorGetDefault</span>(), [<span class="string">@"dipinkrishna.com"</span> UTF8String]);</span><br><span class="line">        receivedFlags = <span class="built_in">SCNetworkReachabilityGetFlags</span>(reachability, &amp;flags);</span><br><span class="line">        <span class="built_in">CFRelease</span>(reachability);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span> (!receivedFlags || (flags == <span class="number">0</span>) )</span><br><span class="line">        &#123;</span><br><span class="line">        	<span class="keyword">return</span> <span class="literal">FALSE</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">TRUE</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Note that SCNetworkReachabilitySetCallback notifies only when reachability status changes</p>
<blockquote>
<p>Assigns a client to the specified target, which receives callbacks when the reachability of the target changes</p>
</blockquote>
<h2 id="Using-some-libraries"><a href="#Using-some-libraries" class="headerlink" title="Using some libraries"></a>Using some libraries</h2><p>Libraries make our life easier, but to live well with them, you must surely understand them. There are many reachability libraries on Github, but here I want to mention the most popular: Reachability from tonymillion and AFNetworkReachabilityManager (a submodule of AFNetworking) from mattt. Both use SystemConfiguration under the hood.</p>
<h2 id="Reachability"><a href="#Reachability" class="headerlink" title="Reachability"></a>Reachability</h2><p>Some people use Reachability like this</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)testInternetConnection</span><br><span class="line">&#123;   </span><br><span class="line">    internetReachableFoo = [Reachability reachabilityWithHostname:<span class="string">@"www.google.com"</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Internet is reachable</span></span><br><span class="line">    internetReachableFoo.reachableBlock = ^(Reachability*reach)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Update the UI on the main thread</span></span><br><span class="line">        <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@"Yayyy, we have the interwebs!"</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Internet is not reachable</span></span><br><span class="line">    internetReachableFoo.unreachableBlock = ^(Reachability*reach)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Update the UI on the main thread</span></span><br><span class="line">        <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@"Someone broke the internet :("</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    [internetReachableFoo startNotifier];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Looking into the method “startNotifier”, you will see that it only uses SCNetworkReachabilitySetCallback and it means this callback will only be called if reachability status changes.</p>
<p>If you want to know the reachability status directly, for example, the reachability status at app launch, you must use the method “isReachable”. This method under the hood uses SCNetworkReachabilityGetFlags which is synchronous, and it locks the calling thread.</p>
<p>Reachability has reachabilityForLocalWiFi, which is interesting :)</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+(Reachability*)reachabilityForLocalWiFi</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">struct</span> sockaddr_in localWifiAddress;</span><br><span class="line">    bzero(&amp;localWifiAddress, <span class="keyword">sizeof</span>(localWifiAddress));</span><br><span class="line">    localWifiAddress.sin_len            = <span class="keyword">sizeof</span>(localWifiAddress);</span><br><span class="line">    localWifiAddress.sin_family         = AF_INET;</span><br><span class="line">    <span class="comment">// IN_LINKLOCALNETNUM is defined in &lt;netinet/in.h&gt; as 169.254.0.0</span></span><br><span class="line">    localWifiAddress.sin_addr.s_addr    = htonl(IN_LINKLOCALNETNUM);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> [<span class="keyword">self</span> reachabilityWithAddress:&amp;localWifiAddress];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="AFNetworkReachabilityManager"><a href="#AFNetworkReachabilityManager" class="headerlink" title="AFNetworkReachabilityManager"></a>AFNetworkReachabilityManager</h2><p>With AFNetworkReachabilityManager, all you have to do is</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)trackInternetConnection</span><br><span class="line">&#123;</span><br><span class="line">    [[AFNetworkReachabilityManager sharedManager] startMonitoring];</span><br><span class="line">    [[AFNetworkReachabilityManager sharedManager] setReachabilityStatusChangeBlock:^(AFNetworkReachabilityStatus status) &#123;</span><br><span class="line">        <span class="comment">// Handle the status</span></span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>What is nice about AFNetworkReachabilityManager is that in the “startMonitoring” method, it both uses SCNetworkReachabilitySetCallback and calls AFNetworkReachabilityStatusForFlags to get the initial reachability status in a background thread, and calls the AFNetworkReachabilityStatusBlock. So in the user ‘s point of view, all we care about is the AFNetworkReachabilityStatusBlock handler.</p>
<p>AFNetworking has all the features that Reachability has, and its code is well structured. Another cool thing about it is that it is already in your AFNetworking pod. It’s hard to find projects without AFNetworking these days</p>
<h2 id="isReachableViaWWAN-vs-isReachableViaWiFi"><a href="#isReachableViaWWAN-vs-isReachableViaWiFi" class="headerlink" title="isReachableViaWWAN vs isReachableViaWiFi"></a>isReachableViaWWAN vs isReachableViaWiFi</h2><p>Take a look at the method AFNetworkReachabilityStatusForFlags and you will know the story</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> AFNetworkReachabilityStatus AFNetworkReachabilityStatusForFlags(<span class="built_in">SCNetworkReachabilityFlags</span> flags) &#123;</span><br><span class="line">    [...]</span><br><span class="line">    status = AFNetworkReachabilityStatusUnknown;</span><br><span class="line">    <span class="keyword">if</span> (isNetworkReachable == <span class="literal">NO</span>) &#123;</span><br><span class="line">        status = AFNetworkReachabilityStatusNotReachable;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">#if	TARGET_OS_IPHONE</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ((flags &amp; kSCNetworkReachabilityFlagsIsWWAN) != <span class="number">0</span>) &#123;</span><br><span class="line">        status = AFNetworkReachabilityStatusReachableViaWWAN;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">#endif</span></span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        status = AFNetworkReachabilityStatusReachableViaWiFi;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> status;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>isReachableViaWWAN</code> is supposed to be for iOS Device</p>
<h2 id="How-to-use-AFNetworkReachabilityManager"><a href="#How-to-use-AFNetworkReachabilityManager" class="headerlink" title="How to use AFNetworkReachabilityManager"></a>How to use AFNetworkReachabilityManager</h2><p>I’ve asked a question here <a href="https://github.com/AFNetworking/AFNetworking/issues/2262">Issue 2262</a>, you should take a look at it</p>
<p>The safe way is not to use the sharedManager, but use managerForDomain</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">AFNetworkReachabilityManager *afReachability = [AFNetworkReachabilityManager managerForDomain:<span class="string">@"www.google.com"</span>];</span><br><span class="line">    [afReachability setReachabilityStatusChangeBlock:^(AFNetworkReachabilityStatus status) &#123;</span><br><span class="line">        <span class="keyword">if</span> (status &lt; AFNetworkReachabilityStatusReachableViaWWAN) &#123;</span><br><span class="line">            [FTGAlertView showMessage:<span class="string">@"No internet connection"</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line"></span><br><span class="line">    [afReachability startMonitoring];</span><br></pre></td></tr></table></figure>

<p>You should read the question 7 and 8 in the Reference below to know more about SCNetworkReachabilityCreateWithName vs SCNetworkReachabilityCreateWithAddress, and about the zero address</p>
<h2 id="Reachability-swift"><a href="#Reachability-swift" class="headerlink" title="Reachability.swift"></a>Reachability.swift</h2><p>In Swift, there is this popular <a href="https://github.com/ashleymills/Reachability.swift">Reachability.swift</a> to check for network reachability status</p>
<h2 id="Connectivity"><a href="#Connectivity" class="headerlink" title="Connectivity"></a>Connectivity</h2><p>Sometimes, a more robust way is just to ping certain servers, that how’s <a href="https://github.com/rwbutler/Connectivity">Connectivy</a> works</p>
<p>Also, read more <a href="https://medium.com/@rwbutler/solving-the-captive-portal-problem-on-ios-9a53ba2b381e">Solving the Captive Portal Problem on iOS</a></p>
<blockquote>
<p>In order to detect that it has connected to a Wi-Fi network with a captive portal, iOS contacts a number of endpoints hosted by Apple — an example being <a href="https://www.apple.com/library/test/success.html">https://www.apple.com/library/test/success.html</a>. Each endpoint hosts a small HTML page of the form:</p>
</blockquote>
<h2 id="Read-more"><a href="#Read-more" class="headerlink" title="Read more"></a>Read more</h2><ol>
<li><a href="https://github.com/tonymillion/Reachability">Reachability</a></li>
<li><a href="https://github.com/AFNetworking/AFNetworking/blob/master/AFNetworking/AFNetworkReachabilityManager.m">AFNetworkReachabilityManager</a></li>
<li><a href="http://stackoverflow.com/questions/24535842/how-to-check-for-internet-connection-synchronously/25133851#25133851">How to check for internet connection synchronously?</a></li>
<li><a href="http://dipinkrishna.com/blog/2012/04/ios-check-internet-connection/">iOS: Check whether internet connection is available</a></li>
<li><a href="http://ios-blog.co.uk/tutorials/check-if-active-internet-connection-exists-on-ios-device/">Check if Active Internet Connection Exists on iOS Device</a></li>
<li><a href="https://developer.apple.com/library/ios/qa/qa1693/_index.html">Technical Q&amp;A QA1693 Synchronous Networking On The Main Thread</a></li>
<li><a href="http://stackoverflow.com/a/11314946/1418457">How to check for network reachability on iOS in a non-blocking manner?</a></li>
<li><a href="http://stackoverflow.com/questions/16508685/understanding-inaddr-any-for-socket-programming-c">understanding INADDR_ANY for socket programming - c</a></li>
</ol>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-04-17T05:35:01.000Z" title="2019-04-17T05:35:01.000Z">2019-04-17</time><span class="level-item">4 minutes read (About 538 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/Dealing-with-CSS-responsiveness-in-Wordpress/">Dealing with CSS responsiveness in Wordpress</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/208">#208</a></strong></p>
<p>During the alpha test of <a href="https://medium.com/swlh/introducing-learn-talks-awesome-conference-and-meetup-talks-e97c8cf7e0f">LearnTalks</a>, some of my friends reported that the screen is completely blank in the search page, and this happened in mobile only. This article is how I identify the problem and found a workaround for the issue, it may not be the solution, but at least the screen does not appear blank anymore.</p>
<p>As someone who likes to keep up with tech via watching conference videos, I thought it might be a good idea to collect all of these to better search and explore later. So I built a web app with React and Firebase, it is a work in progress for now. Due to time constraints, I decided to go first with Wordpress to quickly play with the idea. So there is LearnTalks.</p>
<p>The theme Marinate that I used didn’t want to render the search page correctly. So I head over to Chrome Dev Tool for Responsive Viewport Mode and Safari for Web Inspector</p>
<p><img src="https://user-images.githubusercontent.com/2284279/56269409-e5c93900-60f3-11e9-9ce4-b5094464b659.png" alt="a1"></p>
<p><img src="https://user-images.githubusercontent.com/2284279/56269433-ef52a100-60f3-11e9-9bad-f3bfd5dca95c.png" alt="a2"></p>
<p>The tests showed that the problem only happened on certain screen resolutions. This must be due to CSS @media query which displays different layouts for different screen sizes. And somehow it didn’t work for some sizes.</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">media</span> screen and (max-width: <span class="number">800px</span>) &#123;</span><br><span class="line"> <span class="selector-id">#site-header</span> &#123;</span><br><span class="line"> <span class="attribute">display</span>: none;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="A-bit-about-the-rules"><a href="#A-bit-about-the-rules" class="headerlink" title="A bit about the rules"></a>A bit about the rules</h2><p>The <code>@media</code> rule is used in media queries to apply different styles for different media types/devices.</p>
<p>Media queries can be used to check many things, such as:</p>
<p>width and height of the viewport<br>width and height of the device<br>orientation (is the tablet/phone in landscape or portrait mode?)<br>resolution<br>Using media queries are a popular technique for delivering a tailored style sheet (responsive web design) to desktops, laptops, tablets, and mobile phones.</p>
<p>So I go to Wordpress <code>Dashboard -&gt; Appearance -&gt; Editor</code> to examine CSS files. Unsurprisingly, there are a bunch of media queries</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">media</span> (min-width: <span class="number">600px</span>) and (max-width: <span class="number">767px</span>) &#123;</span><br><span class="line"> <span class="selector-class">.main-navigation</span> &#123;</span><br><span class="line"> <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="selector-class">.site-header</span> <span class="selector-class">.pushmenu</span> &#123;</span><br><span class="line"> <span class="attribute">margin-top</span>:<span class="number">0px</span>; </span><br><span class="line"> &#125; </span><br><span class="line"> <span class="selector-class">.social-networks</span> <span class="selector-tag">li</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line"> <span class="attribute">line-height</span>:<span class="number">2.1em</span> <span class="meta">!Important</span>; </span><br><span class="line"> &#125; </span><br><span class="line"> <span class="selector-class">.search</span> &#123;</span><br><span class="line"> <span class="attribute">display</span>: none <span class="meta">!important</span>;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="selector-class">.customer</span> <span class="selector-tag">blockquote</span> &#123;</span><br><span class="line"> <span class="attribute">padding</span>: <span class="number">10px</span>;</span><br><span class="line"> <span class="attribute">text-align</span>: justify;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The <code>.search</code> selector is suspicious display: none !important;</p>
<p>The important directive is, well, quite important</p>
<blockquote>
<p>It means, essentially, what it says; that ‘this is important, ignore subsequent rules, and any usual specificity issues, apply this rule!’</p>
</blockquote>
<blockquote>
<p>In normal use, a rule defined in an external stylesheet is overruled by a style defined in the head of the document, which, in turn, is overruled by an in-line style within the element itself (assuming equal specificity of the selectors). Defining a rule with the <code>!important &#39;attribute&#39; (?)</code> discards the normal concerns as regards the ‘later’ rule overriding the ‘earlier’ ones.</p>
</blockquote>
<p>Luckily, this theme allows the ability to Edit CSS, so I can override that to a block attribute to always show search page</p>
<p><img src="https://user-images.githubusercontent.com/2284279/56269449-f4afeb80-60f3-11e9-9032-89647c02d35c.png" alt="a3"></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-04-15T11:55:04.000Z" title="2019-04-15T11:55:04.000Z">2019-04-15</time><span class="level-item">a few seconds read (About 48 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-build-with-xcodebuild-and-automatic-code-signing/">How to build with xcodebuild and automatic code signing</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/207">#207</a></strong></p>
<h2 id="Team-ID"><a href="#Team-ID" class="headerlink" title="Team ID"></a>Team ID</h2><p>Error </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Message: &quot;xcodebuild: error: invalid option &#39;-teamID&#39;</span><br></pre></td></tr></table></figure>

<p>Use <code>=</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xcodebuild teamID=T78DK947F3</span><br></pre></td></tr></table></figure>

<p>Does not work 😢 </p>
<h2 id="DEVELOPMENT-TEAM"><a href="#DEVELOPMENT-TEAM" class="headerlink" title="DEVELOPMENT_TEAM"></a>DEVELOPMENT_TEAM</h2><p><a href="https://pewpewthespells.com/blog/migrating_code_signing.html">https://pewpewthespells.com/blog/migrating_code_signing.html</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xcodebuild DEVELOPMENT_TEAM=T78DK947F3</span><br></pre></td></tr></table></figure>

<p>Works 😄 </p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-04-14T15:54:41.000Z" title="2019-04-14T15:54:41.000Z">2019-04-14</time><span class="level-item">a few seconds read (About 87 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-launch-app-at-start-up-in-macOS/">How to launch app at start up in macOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/205">#205</a></strong></p>
<h2 id="ServiceManagement-framework"><a href="#ServiceManagement-framework" class="headerlink" title="ServiceManagement framework"></a>ServiceManagement framework</h2><p><a href="https://developer.apple.com/documentation/servicemanagement/1501557-smloginitemsetenabled">https://developer.apple.com/documentation/servicemanagement/1501557-smloginitemsetenabled</a></p>
<p><code>SMLoginItemSetEnabled</code></p>
<blockquote>
<p>Enable a helper application located in the main application bundle’s “Contents/Library/LoginItems” directory.</p>
</blockquote>
<h2 id="Login-items"><a href="#Login-items" class="headerlink" title="Login items"></a>Login items</h2><p><a href="https://support.apple.com/kb/PH25590?locale=en_US">macOS Sierra: Open items automatically when you log in</a></p>
<blockquote>
<p>You can have apps, documents, folders, or server connections open automatically whenever you log in to your Mac.</p>
</blockquote>
<blockquote>
<p>Add or remove automatic items<br>Choose Apple menu &gt; System Preferences, then click Users &amp; Groups.</p>
</blockquote>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-04-11T09:57:34.000Z" title="2019-04-11T09:57:34.000Z">2019-04-11</time><span class="level-item">a few seconds read (About 65 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-fix-mismatched-deployment-between-app-and-test-target-in-Xcode/">How to fix mismatched deployment between app and test target in Xcode</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/204">#204</a></strong></p>
<ul>
<li>My macOS app target has deployment target 10.12, but when running test, I get</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Compiling for OS X 10.11, but module &#39;MyApp&#39; has a minimum deployment target of OS X 10.12: &#x2F;Users&#x2F;khoa&#x2F;MyApp&#x2F;DerivedData&#x2F;MyApp&#x2F;Build&#x2F;Products&#x2F;Debug&#x2F;MyApp.framework&#x2F;Modules&#x2F;MyApp.swiftmodule&#x2F;x86_64.swiftmodule</span><br></pre></td></tr></table></figure>

<ul>
<li>The fix is go to test target -&gt; Build Settings -&gt; Deployment<br>Ensure deployments match</li>
</ul>
<img width="966" alt="build" src="https://user-images.githubusercontent.com/2284279/55955443-bfbe1780-5c61-11e9-9a9d-4db8f780269e.png">



<p><strong>Updated at</strong> 2020-05-14 07:53:33</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-04-11T07:17:24.000Z" title="2019-04-11T07:17:24.000Z">2019-04-11</time><span class="level-item">3 minutes read (About 490 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-notarize-macOS-app/">How to notarize macOS app</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/203">#203</a></strong></p>
<h2 id="New-Notarization-Requirements"><a href="#New-Notarization-Requirements" class="headerlink" title="New Notarization Requirements"></a>New Notarization Requirements</h2><p><a href="https://developer.apple.com/news/?id=04102019a">https://developer.apple.com/news/?id=04102019a</a></p>
<blockquote>
<p>With the public release of macOS 10.14.5, we require that all developers creating a Developer ID certificate for the first time notarize their apps, and that all new and updated kernel extensions be notarized as well</p>
</blockquote>
<h2 id="Signing-Your-Apps-for-Gatekeeper"><a href="#Signing-Your-Apps-for-Gatekeeper" class="headerlink" title="Signing Your Apps for Gatekeeper"></a>Signing Your Apps for Gatekeeper</h2><p><a href="https://developer.apple.com/developer-id/">https://developer.apple.com/developer-id/</a></p>
<blockquote>
<p>Unpublished Software. It’s easy to get unpublished software notarized with the Export process or xcodebuild. Custom build workflows are supported by the xcrun altool command line tool for uploading, and you can use xcrun stapler to attach the ticket to the package.</p>
</blockquote>
<blockquote>
<p>Published Software. To submit software you’ve already published, upload it using the xcrun altool command line tool. Several file types are supported, including .zip, .pkg, and .dmg, so you can upload the same package you already distribute to users.</p>
</blockquote>
<h2 id="Notarizing-Your-App-Before-Distribution"><a href="#Notarizing-Your-App-Before-Distribution" class="headerlink" title="Notarizing Your App Before Distribution"></a>Notarizing Your App Before Distribution</h2><p><a href="https://developer.apple.com/documentation/security/notarizing_your_app_before_distribution">https://developer.apple.com/documentation/security/notarizing_your_app_before_distribution</a></p>
<p><img src="https://docs-assets.developer.apple.com/published/a857ce6120/e02fdecf-0018-46d8-a750-c0719d21e326.png" alt=""></p>
<blockquote>
<p>When you click Next, Xcode uploads your archive to the notary service. When the upload is complete, the notary service begins the scanning process, which usually takes less than an hour. While the notary service scans your software, you can continue to prepare your archive for distribution. For example, you can export the archive and perform any final testing that you require prior to making your software available to customers.</p>
</blockquote>
<blockquote>
<p>When the notarization process finishes, Xcode downloads the ticket and staples it to your archive. At that point, export your archive again to receive a distributable version of your software that includes the notary ticket.</p>
</blockquote>
<h2 id="Upload-a-macOS-app-to-be-notarized"><a href="#Upload-a-macOS-app-to-be-notarized" class="headerlink" title="Upload a macOS app to be notarized"></a>Upload a macOS app to be notarized</h2><p><a href="https://help.apple.com/xcode/mac/current/#/dev88332a81e">https://help.apple.com/xcode/mac/current/#/dev88332a81e</a></p>
<p><img src="https://help.apple.com/xcode/mac/current/en.lproj/Art/ao_exportdeveloperid.png" alt=""></p>
<blockquote>
<p>First, upload your macOS app to Apple to be notarized. If the upload fails, view the upload logs to find the problem. For example, you must enable hardened runtime (macOS) before you upload the app. Otherwise, check the notarization status and when the status is “Ready for distribution”, export the app for distribution.</p>
</blockquote>
<h2 id="Distribute-outside-the-Mac-App-Store-macOS"><a href="#Distribute-outside-the-Mac-App-Store-macOS" class="headerlink" title="Distribute outside the Mac App Store (macOS)"></a>Distribute outside the Mac App Store (macOS)</h2><p><a href="https://help.apple.com/xcode/mac/current/#/dev033e997ca">https://help.apple.com/xcode/mac/current/#/dev033e997ca</a></p>
<blockquote>
<p>In some cases, you may want to distribute an app outside of the Mac App Store. Because the app won’t be distributed by Apple, assure users that you are a trusted developer by signing your app with a Developer ID certificate. Users gain additional assurance if your Developer ID-signed app is also notarized by Apple.</p>
</blockquote>
<blockquote>
<p>On macOS, if your app isn’t downloaded from the Mac App Store or signed with a Developer ID certificate, it won’t launch unless the user completely disables Gatekeeper. Users have the option of enabling or disabling identified developers in System Preferences.</p>
</blockquote>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-04-10T19:12:46.000Z" title="2019-04-10T19:12:46.000Z">2019-04-10</time><span class="level-item">a few seconds read (About 13 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-resize-image-using-imagemagick/">How to resize image using imagemagick</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/202">#202</a></strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mogrify -resize 1280x800 s2.png</span><br></pre></td></tr></table></figure>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-04-10T19:07:11.000Z" title="2019-04-10T19:07:11.000Z">2019-04-10</time><span class="level-item">a few seconds read (About 62 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-use-shared-AppGroup-UserDefaults-in-macOS-and-Xcode-extension/">How to use shared AppGroup UserDefaults in macOS and Xcode extension</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/201">#201</a></strong></p>
<ul>
<li><p>Go to both app and extension target, under Capabilities, enable AppGroup</p>
</li>
<li><p>Specify <code>$(TeamIdentifierPrefix)group.com.onmyway133.MyApp</code></p>
</li>
<li><p><code>$(TeamIdentifierPrefix)</code> will expand to something like <code>T78DK947F3.</code>, with <code>.</code></p>
</li>
<li><p>Then using is like a normal UserDefaults</p>
</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> defaults = <span class="type">UserDefaults</span>(suiteName: <span class="string">"T78DK947F3 .group.com.onmyway133.MyApp"</span>)</span><br><span class="line"></span><br><span class="line">defaults?.<span class="keyword">set</span>(<span class="literal">true</span>, forKey: <span class="string">"showOptions"</span>)</span><br><span class="line">defaults?.synchronize()</span><br></pre></td></tr></table></figure>
<hr>
<p><strong>Updated at</strong> 2020-11-12 19:57:33</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-04-10T18:54:10.000Z" title="2019-04-10T18:54:10.000Z">2019-04-10</time><span class="level-item">a few seconds read (About 29 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-check-file-under-Library-in-macOS/">How to check file under Library in macOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/200">#200</a></strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> home = <span class="type">NSSearchPathForDirectoriesInDomains</span>(.applicationScriptsDirectory, .userDomainMask, <span class="literal">true</span>).first!</span><br><span class="line"><span class="keyword">let</span> path = home.appending(<span class="string">".XcodeWayExtensions/XcodeWayScript.scpt"</span>)</span><br><span class="line"><span class="keyword">let</span> exists = <span class="type">FileManager</span>.<span class="keyword">default</span>.fileExists(atPath: path)</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-04-09T06:29:22.000Z" title="2019-04-09T06:29:22.000Z">2019-04-09</time><span class="level-item">a minute read (About 184 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-parse-json-in-Go/">How to parse json in Go</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/199">#199</a></strong></p>
<h2 id="Unmarshal-using-encoding-json"><a href="#Unmarshal-using-encoding-json" class="headerlink" title="Unmarshal using encoding/json"></a>Unmarshal using encoding/json</h2><ul>
<li>property in struct needs to be first letter capitalized</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"net/http"</span></span><br><span class="line">	<span class="string">"encoding/json"</span></span><br><span class="line">	<span class="string">"io/ioutil"</span></span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> MyJsonObject <span class="keyword">struct</span> &#123;</span><br><span class="line">	Id <span class="keyword">string</span> <span class="string">`json:"id"`</span></span><br><span class="line">	Name <span class="keyword">string</span> <span class="string">`json:"name"`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> MyJsonArray <span class="keyword">struct</span> &#123;</span><br><span class="line">	Data []MyJsonObject <span class="string">`json:"data"`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">FetchJson</span><span class="params">()</span></span> &#123;</span><br><span class="line">	url := <span class="string">"https://myapp.com/json"</span></span><br><span class="line">	client := http.Client&#123;</span><br><span class="line">		Timeout: time.Second * <span class="number">10</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	request, requestError := http.NewRequest(http.MethodGet, url, <span class="literal">nil</span>)</span><br><span class="line">	request.Header.Set(<span class="string">"User-Agent"</span>, <span class="string">"myapp"</span>)</span><br><span class="line">	response, responseError := client.Do(request)</span><br><span class="line">	body, readError := ioutil.ReadAll(response.Body)</span><br><span class="line"> </span><br><span class="line">	fmt.Println(requestError, responseError, readError)</span><br><span class="line">	</span><br><span class="line">	myJsonArray := MyJsonArray&#123;&#125;</span><br><span class="line">	marshalError := json.Unmarshal(body, &amp;myJsonArray)</span><br><span class="line">	fmt.Println(jsonResponse, marshalError)	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h2><p>And how to map to another struct<br><a href="https://gobyexample.com/collection-functions">https://gobyexample.com/collection-functions</a></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Map</span><span class="params">(vs []JsonStop, f <span class="keyword">func</span>(JsonStop)</span> *<span class="title">api</span>.<span class="title">Stop</span>) []*<span class="title">api</span>.<span class="title">Stop</span></span> &#123;</span><br><span class="line">    vsm := <span class="built_in">make</span>([]*api.Stop, <span class="built_in">len</span>(vs))</span><br><span class="line">    <span class="keyword">for</span> i, v := <span class="keyword">range</span> vs &#123;</span><br><span class="line">        vsm[i] = f(v)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> vsm</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">stops := Map(jsonResponse.Data, <span class="function"><span class="keyword">func</span><span class="params">(jsonStop JsonStop)</span> *<span class="title">api</span>.<span class="title">Stop</span></span> &#123;</span><br><span class="line">		stop := api.Stop&#123;</span><br><span class="line">			Id: jsonStop.Id, </span><br><span class="line">			Name: jsonStop.Name,</span><br><span class="line">			Address: jsonStop.Address,</span><br><span class="line">			Lat: jsonStop.Lat,</span><br><span class="line">			Long: jsonStop.Long&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> &amp;stop</span><br><span class="line">	&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="json-to-protobuf"><a href="#json-to-protobuf" class="headerlink" title="json to protobuf"></a>json to protobuf</h2><ul>
<li>Use <a href="https://godoc.org/github.com/golang/protobuf/jsonpb">https://godoc.org/github.com/golang/protobuf/jsonpb</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-04-08T19:50:13.000Z" title="2019-04-08T19:50:13.000Z">2019-04-08</time><span class="level-item">3 minutes read (About 381 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-resolve-deep-json-object-in-Dart/">How to resolve deep json object in Dart</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/198">#198</a></strong></p>
<p>If we are not on the edge with GRPC and Protocol Buffer, then most likely we are going to deal with Restful and JSON. In one of my <a href="https://speakerdeck.com/onmyway133/getting-started-with-flutter">Flutter</a> apps I needed to consume JSON</p>
<h2 id="JSON-and-serialization"><a href="#JSON-and-serialization" class="headerlink" title="JSON and serialization"></a>JSON and serialization</h2><p>The guide at <a href="https://flutter.dev/docs/development/data-and-backend/json">https://flutter.dev/docs/development/data-and-backend/json</a> is definitely the way to go.</p>
<p>Currently there are 2 ways. One is to manually use <code>dart:convert</code> package </p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="keyword">dynamic</span>&gt; user = jsonDecode(jsonString);</span><br></pre></td></tr></table></figure>

<p>The other way is to use <a href="https://pub.dartlang.org/packages/json_serializable">json_serializable</a> to generate parsing code</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'package:json_annotation/json_annotation.dart'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="markdown">/// This allows </span>the<span class="markdown"> <span class="code">`User`</span> class to access private members in</span></span></span><br><span class="line"><span class="comment"><span class="markdown">/// </span>the<span class="markdown"> generated file. The value for this is *.g.dart, where</span></span></span><br><span class="line"><span class="comment"><span class="markdown">/// </span>the<span class="markdown"> star denotes </span>the<span class="markdown"> source file name.</span></span></span><br><span class="line"><span class="keyword">part</span> <span class="string">'user.g.dart'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="markdown">/// An annotation for </span>the<span class="markdown"> code generator to know that this class needs </span>the<span class="markdown"></span></span></span><br><span class="line"><span class="comment"><span class="markdown">/// JSON serialization logic to be generated.</span></span></span><br><span class="line"><span class="meta">@JsonSerializable</span>()</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">  User(<span class="keyword">this</span>.name, <span class="keyword">this</span>.email);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">String</span> name;</span><br><span class="line">  <span class="built_in">String</span> email;</span><br><span class="line"></span><br><span class="line">  <span class="comment"><span class="markdown">/// A necessary factory constructor for creating </span>a<span class="markdown"> new User instance</span></span></span><br><span class="line">  <span class="comment"><span class="markdown">/// from </span>a<span class="markdown"> map. Pass </span>the<span class="markdown"> map to </span>the<span class="markdown"> generated <span class="code">`_$UserFromJson()`</span> constructor.</span></span></span><br><span class="line">  <span class="comment"><span class="markdown">/// The constructor is named after </span>the<span class="markdown"> source class, in this case User.</span></span></span><br><span class="line">  <span class="keyword">factory</span> User.fromJson(<span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="keyword">dynamic</span>&gt; json) =&gt; _$UserFromJson(json);</span><br><span class="line"></span><br><span class="line">  <span class="comment"><span class="markdown">/// <span class="code">`toJson`</span> is </span>the<span class="markdown"> convention for </span>a<span class="markdown"> class to declare support for serialization</span></span></span><br><span class="line">  <span class="comment"><span class="markdown">/// to JSON. The implementation </span>simply<span class="markdown"> calls </span>the<span class="markdown"> private, generated</span></span></span><br><span class="line">  <span class="comment"><span class="markdown">/// helper method <span class="code">`_$UserToJson`</span>.</span></span></span><br><span class="line">  <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="keyword">dynamic</span>&gt; toJson() =&gt; _$UserToJson(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="json-resolve"><a href="#json-resolve" class="headerlink" title="json_resolve"></a>json_resolve</h2><p>The problem with manual approach is that it involves lot of boilerplate code, especially when accessing property inside deeply nested json. The problem with code generation approach is that it does not always fit our need and may lack of customization.</p>
<p>Therefore I created <a href="https://github.com/onmyway133/json_resolve">json_resolve</a> which allows us to access json using keypath, with type checking and safety in mind. The code is small, simple to reason and tested.</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="built_in">String</span> byProperty = resolve(json: json, path: <span class="string">"movie"</span>, defaultValue: <span class="string">"error"</span>);</span><br><span class="line">expect(byProperty, <span class="string">"isFun"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="built_in">int</span> byInt = resolve(json: json, path: <span class="string">"earth"</span>, defaultValue: <span class="number">0</span>);</span><br><span class="line">expect(byInt, <span class="number">199999</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="built_in">String</span> byIndex = resolve(json: json, path: <span class="string">"dc.2.name"</span>, defaultValue: <span class="string">"error"</span>);</span><br><span class="line">expect(byIndex, <span class="string">"Wonder Woman"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="built_in">String</span> byIndexThenProperty = resolve(json: json, path: <span class="string">"marvel.0.appear.1.title"</span>, defaultValue: <span class="string">"error"</span>);</span><br><span class="line">expect(byIndexThenProperty, <span class="string">"The Dark World"</span>);</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-04-08T08:40:12.000Z" title="2019-04-08T08:40:12.000Z">2019-04-08</time><span class="level-item">2 minutes read (About 371 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-generate-grpc-protobuf-files/">How to generate grpc protobuf files</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/197">#197</a></strong></p>
<h2 id="protoc"><a href="#protoc" class="headerlink" title="protoc"></a>protoc</h2><p><a href="https://grpc.io/docs/quickstart/go.html">https://grpc.io/docs/quickstart/go.html</a></p>
<blockquote>
<p>Install the protoc compiler that is used to generate gRPC service code. The simplest way to do this is to download pre-compiled binaries for your platform(protoc-<version>-<platform>.zip) from here: <a href="https://github.com/google/protobuf/releases">https://github.com/google/protobuf/releases</a></p>
</blockquote>
<blockquote>
<p>Unzip this file.<br>Update the environment variable PATH to include the path to the protoc binary file.</p>
</blockquote>
<h2 id="Go-protoc-plugin"><a href="#Go-protoc-plugin" class="headerlink" title="Go protoc plugin"></a>Go protoc plugin</h2><p><a href="https://github.com/golang/protobuf">https://github.com/golang/protobuf</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">go get -u github.com/golang/protobuf/protoc-gen-go</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$GOPATH</span>/bin</span><br><span class="line"><span class="built_in">source</span> ~/.zshrc</span><br></pre></td></tr></table></figure>


<h2 id="Swift-protoc-plugin"><a href="#Swift-protoc-plugin" class="headerlink" title="Swift protoc plugin"></a>Swift protoc plugin</h2><p><a href="https://github.com/grpc/grpc-swift">https://github.com/grpc/grpc-swift</a></p>
<blockquote>
<p>The recommended way to use Swift gRPC is to first define an API using the<br><a href="https://developers.google.com/protocol-buffers/">Protocol Buffer</a><br>language and then use the<br><a href="https://github.com/google/protobuf">Protocol Buffer Compiler</a><br>and the <a href="https://github.com/apple/swift-protobuf">Swift Protobuf</a><br>and <a href="https://github.com/grpc/grpc-swift">Swift gRPC</a> plugins to<br>generate the necessary support code.</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/grpc/grpc-swift.git</span><br><span class="line"><span class="built_in">cd</span> grpc-swift</span><br><span class="line">make</span><br><span class="line">sudo cp protoc-gen-swift protoc-gen-swiftgrpc /usr/<span class="built_in">local</span>/bin</span><br></pre></td></tr></table></figure>

<h2 id="Generate"><a href="#Generate" class="headerlink" title="Generate"></a>Generate</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">protoc --swift_out=MyApp/Api --swiftgrpc_out=Client=<span class="literal">true</span>,Server=<span class="literal">false</span>:MyApp/Api --go_out=plugins=grpc:server/api api.proto</span><br></pre></td></tr></table></figure>

<p>In case we need to cd</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd MyApp&#x2F;Library&#x2F;Models&#x2F;Proto</span><br><span class="line"></span><br><span class="line">protoc --swift_out&#x3D;..&#x2F;Generated --swiftgrpc_out&#x3D;Client&#x3D;true,Server&#x3D;false:..&#x2F;Generated api.proto</span><br></pre></td></tr></table></figure>

<h3 id="Empty"><a href="#Empty" class="headerlink" title="Empty"></a>Empty</h3><p>If remote import is needed, then the workaround is to download the that proto locally, for example empty.proto <a href="https://github.com/protocolbuffers/protobuf/blob/master/src/google/protobuf/empty.proto">https://github.com/protocolbuffers/protobuf/blob/master/src/google/protobuf/empty.proto</a></p>
<p>Inside SwiftProtobuf pod, there is generated <code>empty.pb.swift</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">Google_Protobuf_Empty</span> </span>&#123;</span><br><span class="line">  <span class="comment">// SwiftProtobuf.Message conformance is added in an extension below. See the</span></span><br><span class="line">  <span class="comment">// `Message` and `Message+*Additions` files in the SwiftProtobuf library for</span></span><br><span class="line">  <span class="comment">// methods supported on all messages.</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">var</span> unknownFields = <span class="type">SwiftProtobuf</span>.<span class="type">UnknownStorage</span>()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">init</span>() &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>To consume, we can </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftProtobuf</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> empty = <span class="type">Google_Protobuf_Empty</span>()</span><br></pre></td></tr></table></figure>

<h3 id="oneof-mode"><a href="#oneof-mode" class="headerlink" title="oneof mode"></a>oneof mode</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">message Person &#123;</span><br><span class="line">  oneof mode &#123;</span><br><span class="line">    Human human &#x3D; 1;</span><br><span class="line">    Superman superman &#x3D; 2;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Cannot convert value of type ‘Server_Person.OneOf_Mode’ to expected argument type ‘Server_Human’</p>
</blockquote>
<p>Need to assign the mode</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> person = <span class="type">Person</span>()</span><br><span class="line">person.mode = <span class="type">Person</span>.<span class="type">OneOf_Mode</span>.<span class="type">Human</span>()</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-04-05T08:08:09.000Z" title="2019-04-05T08:08:09.000Z">2019-04-05</time><span class="level-item">2 minutes read (About 262 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-cache-CocoaPods/">How to cache CocoaPods</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/196">#196</a></strong></p>
<h2 id="CocoaPods-vs-Carthage"><a href="#CocoaPods-vs-Carthage" class="headerlink" title="CocoaPods vs Carthage"></a>CocoaPods vs Carthage</h2><ul>
<li><a href="https://shashikantjagtap.net/carthage-cocoapods-question/">Carthage or CocoaPods: That is the question</a></li>
</ul>
<blockquote>
<p>CocoaPods will build and compile our frameworks every time whenever you are doing the clean build or run pod install or pod update for the project.</p>
</blockquote>
<h2 id="Cache-Carthage"><a href="#Cache-Carthage" class="headerlink" title="Cache Carthage"></a>Cache Carthage</h2><ul>
<li><a href="https://medium.com/@rajatvig/speeding-up-carthage-for-ios-applications-50e8d0a197e1">Speeding up Carthage for iOS Applications</a></li>
<li><a href="https://medium.com/getpulse/improving-the-xcode-project-build-times-with-carthage-296deec9ebb4">Faster builds in Xcode with Carthage</a></li>
</ul>
<h2 id="Cache-CocoaPods"><a href="#Cache-CocoaPods" class="headerlink" title="Cache CocoaPods"></a>Cache CocoaPods</h2><ul>
<li><a href="https://blog.takescoop.com/improve-ios-ci-build-time-with-cocoapods-caching-4a049ee45e63">Improve iOS CI build times with CocoaPods caching</a> 👍 </li>
<li><a href="https://stackoverflow.com/questions/41891333/any-way-to-clean-only-current-xcode-project-but-not-cocoapods-dependencies">Any way to clean only current Xcode project but not Cocoapods dependencies?</a></li>
<li><a href="https://guides.cocoapods.org/plugins/pre-compiling-dependencies.html">Pre-compiling dependencies</a></li>
<li><a href="https://github.com/leavez/cocoapods-binary">cocoapods-binary</a> 🚀 </li>
</ul>
<blockquote>
<p>It will compile the source code of pods during the pod install process, and make CocoaPods use them. Which pod should be compiled is controlled by the flag in Podfile.</p>
</blockquote>
<h2 id="Xcode-10-new-build-system"><a href="#Xcode-10-new-build-system" class="headerlink" title="Xcode 10 new build system"></a>Xcode 10 new build system</h2><ul>
<li><a href="https://www.ralfebert.de/ios/blog/cocoapods-clean-input-output-files/">CocoaPods and the new Xcode build system</a></li>
<li><a href="https://forums.developer.apple.com/thread/108729">Xcode 10 - Clean (missing) vs Clean Build Folder</a></li>
</ul>
<h2 id="Understanding-framework"><a href="#Understanding-framework" class="headerlink" title="Understanding framework"></a>Understanding framework</h2><ul>
<li><a href="https://www.bignerdranch.com/blog/it-looks-like-you-are-trying-to-use-a-framework/">It Looks Like You Are Trying to Use a Framework</a> 🚀 </li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-04-05T08:03:48.000Z" title="2019-04-05T08:03:48.000Z">2019-04-05</time><span class="level-item">8 minutes read (About 1222 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-build-a-networking-in-Swift/">How to build a networking in Swift</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/195">#195</a></strong></p>
<h2 id="Miami"><a href="#Miami" class="headerlink" title="Miami"></a>Miami</h2><ul>
<li><a href="https://github.com/onmyway133/Miami">https://github.com/onmyway133/Miami</a> </li>
<li>Future based builders</li>
<li>Should not wrap system API</li>
<li><code>URLSession</code> offer tons of thing that it’s hard to use with wrappers like Alamofire</li>
</ul>
<h2 id="Concerns"><a href="#Concerns" class="headerlink" title="Concerns"></a>Concerns</h2><h3 id="Parameter-encoding-is-confusing"><a href="#Parameter-encoding-is-confusing" class="headerlink" title="Parameter encoding is confusing"></a>Parameter encoding is confusing</h3><p>-<a href="https://github.com/Alamofire/Alamofire/blob/master/Documentation/Usage.md#parameter-encoding">https://github.com/Alamofire/Alamofire/blob/master/Documentation/Usage.md#parameter-encoding</a></p>
<h3 id="Query-and-body-builder"><a href="#Query-and-body-builder" class="headerlink" title="Query and body builder"></a>Query and body builder</h3><ul>
<li><a href="https://dev.to/sidthesloth92/understanding-html-form-encoding-url-encoded-and-multipart-forms-3lpa">Understanding HTML Form Encoding: URL Encoded and Multipart Forms</a></li>
<li><a href="https://stackoverflow.com/questions/14551194/how-are-parameters-sent-in-an-http-post-request">https://stackoverflow.com/questions/14551194/how-are-parameters-sent-in-an-http-post-request</a></li>
<li><a href="https://stackoverflow.com/questions/1617058/ok-to-skip-slash-before-query-string">https://stackoverflow.com/questions/1617058/ok-to-skip-slash-before-query-string</a></li>
<li><a href="https://stackoverflow.com/questions/3508338/what-is-the-boundary-in-multipart-form-data">https://stackoverflow.com/questions/3508338/what-is-the-boundary-in-multipart-form-data</a></li>
<li><a href="https://github.com/onmyway133/blog/issues/193">How to construct URL with URLComponents and appendPathComponent in Swift</a></li>
</ul>
<h3 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h3><ul>
<li><a href="https://github.com/onmyway133/blog/issues/115">Case sensitivity in HTTP</a></li>
</ul>
<h3 id="Lazy-execution"><a href="#Lazy-execution" class="headerlink" title="Lazy execution"></a>Lazy execution</h3><ul>
<li>Promise <a href="https://github.com/onmyway133/Then">https://github.com/onmyway133/Then</a></li>
<li>Signal and Future <a href="https://github.com/onmyway133/archives/tree/master/Signal">https://github.com/onmyway133/archives/tree/master/Signal</a></li>
</ul>
<h3 id="Catch-error"><a href="#Catch-error" class="headerlink" title="Catch error"></a>Catch error</h3><ul>
<li><a href="https://github.com/onmyway133/blog/issues/192">How to catch error in ApolloClient</a></li>
</ul>
<h3 id="Implementation"><a href="#Implementation" class="headerlink" title="Implementation"></a>Implementation</h3><ul>
<li><a href="https://github.com/onmyway133/blog/issues/194">How to cancel DispatchWorkItem and NSOperation</a></li>
<li><a href="https://swiftrocks.com/understanding-dispatchqueues.html">Understanding DispatchQueues</a></li>
</ul>
<h2 id="Use-Promise-to-handle-chain-and-error"><a href="#Use-Promise-to-handle-chain-and-error" class="headerlink" title="Use Promise to handle chain and error"></a>Use Promise to handle chain and error</h2><p><a href="https://github.com/onmyway133/Miami/blob/master/Sources/Shared/Future/Future.swift">https://github.com/onmyway133/Miami/blob/master/Sources/Shared/Future/Future.swift</a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Token</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">let</span> lock = <span class="type">NSRecursiveLock</span>()</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> _isCancelled = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> callbacks: [() -&gt; <span class="type">Void</span>] = []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">init</span>() &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">isCancelled</span><span class="params">()</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> lock.whenLock &#123;</span><br><span class="line">            <span class="keyword">return</span> _isCancelled</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">cancel</span><span class="params">()</span></span> &#123;</span><br><span class="line">        lock.whenLock &#123;</span><br><span class="line">            <span class="keyword">guard</span> <span class="keyword">self</span>._isCancelled == <span class="literal">false</span> <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">self</span>._isCancelled = <span class="literal">true</span></span><br><span class="line">            <span class="keyword">self</span>.callbacks.forEach &#123; $<span class="number">0</span>() &#125;</span><br><span class="line">            <span class="keyword">self</span>.callbacks.removeAll()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">onCancel</span><span class="params">(<span class="number">_</span> callback: @escaping <span class="params">()</span></span></span> -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">        lock.whenLock &#123;</span><br><span class="line">            <span class="keyword">self</span>.callbacks.append(callback)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Resolver</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">let</span> queue: <span class="type">DispatchQueue</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">let</span> token: <span class="type">Token</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> callback: (<span class="type">Result</span>&lt;<span class="type">T</span>, <span class="type">Error</span>&gt;) -&gt; <span class="type">Void</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">init</span>(queue: <span class="type">DispatchQueue</span>, token: <span class="type">Token</span>, callback: @escaping (<span class="type">Result</span>&lt;<span class="type">T</span>, <span class="type">Error</span>&gt;) -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.queue = queue</span><br><span class="line">        <span class="keyword">self</span>.token = token</span><br><span class="line">        <span class="keyword">self</span>.callback = callback</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">complete</span><span class="params">(value: T)</span></span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.handle(result: .success(value))</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">fail</span><span class="params">(error: Error)</span></span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.handle(result: .failure(error))</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">handle</span><span class="params">(result: Result&lt;T, Error&gt;)</span></span> &#123;</span><br><span class="line">        queue.async &#123;</span><br><span class="line">            <span class="keyword">self</span>.callback(result)</span><br><span class="line">            <span class="keyword">self</span>.callback = &#123; <span class="number">_</span> <span class="keyword">in</span> &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Future</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">let</span> work: (<span class="type">Resolver</span>&lt;<span class="type">T</span>&gt;) -&gt; <span class="type">Void</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">init</span>(work: @escaping (<span class="type">Resolver</span>&lt;<span class="type">T</span>&gt;) -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.work = work</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">fail</span><span class="params">(error: Error)</span></span> -&gt; <span class="type">Future</span>&lt;<span class="type">T</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Future</span>&lt;<span class="type">T</span>&gt;.result(.failure(error))</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">complete</span><span class="params">(value: T)</span></span> -&gt; <span class="type">Future</span>&lt;<span class="type">T</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> .result(.success(value))</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">result</span><span class="params">(<span class="number">_</span> result: Result&lt;T, Error&gt;)</span></span> -&gt; <span class="type">Future</span>&lt;<span class="type">T</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Future</span>&lt;<span class="type">T</span>&gt;(work: &#123; resolver <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">switch</span> result &#123;</span><br><span class="line">            <span class="keyword">case</span> .success(<span class="keyword">let</span> value):</span><br><span class="line">                resolver.complete(value: value)</span><br><span class="line">            <span class="keyword">case</span> .failure(<span class="keyword">let</span> error):</span><br><span class="line">                resolver.fail(error: error)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">run</span><span class="params">(queue: DispatchQueue = .serial<span class="params">()</span></span></span>, token: <span class="type">Token</span> = <span class="type">Token</span>(), completion: @escaping (<span class="type">Result</span>&lt;<span class="type">T</span>, <span class="type">Error</span>&gt;) -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">        queue.async &#123;</span><br><span class="line">            <span class="keyword">if</span> (token.isCancelled()) &#123;</span><br><span class="line">                completion(.failure(<span class="type">NetworkError</span>.cancelled))</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">let</span> resolver = <span class="type">Resolver</span>&lt;<span class="type">T</span>&gt;(queue: queue, token: token, callback: completion)</span><br><span class="line">            <span class="keyword">self</span>.work(resolver)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">map</span>&lt;U&gt;<span class="params">(transform: @escaping <span class="params">(T)</span></span></span> -&gt; <span class="type">U</span>) -&gt; <span class="type">Future</span>&lt;<span class="type">U</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Future</span>&lt;<span class="type">U</span>&gt;(work: &#123; resolver <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">self</span>.run(queue: resolver.queue, token: resolver.token, completion: &#123; result <span class="keyword">in</span></span><br><span class="line">                resolver.handle(result: result.<span class="built_in">map</span>(transform))</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">flatMap</span>&lt;U&gt;<span class="params">(transform: @escaping <span class="params">(T)</span></span></span> -&gt; <span class="type">Future</span>&lt;<span class="type">U</span>&gt;) -&gt; <span class="type">Future</span>&lt;<span class="type">U</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Future</span>&lt;<span class="type">U</span>&gt;(work: &#123; resolver <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">self</span>.run(queue: resolver.queue, token: resolver.token, completion: &#123; result <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">switch</span> result &#123;</span><br><span class="line">                <span class="keyword">case</span> .success(<span class="keyword">let</span> value):</span><br><span class="line">                    <span class="keyword">let</span> future = transform(value)</span><br><span class="line">                    future.run(queue: resolver.queue, token: resolver.token, completion: &#123; newResult <span class="keyword">in</span></span><br><span class="line">                        resolver.handle(result: newResult)</span><br><span class="line">                    &#125;)</span><br><span class="line">                <span class="keyword">case</span> .failure(<span class="keyword">let</span> error):</span><br><span class="line">                    resolver.fail(error: error)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">catchError</span><span class="params">(transform: @escaping <span class="params">(Error)</span></span></span> -&gt; <span class="type">Future</span>&lt;<span class="type">T</span>&gt;) -&gt; <span class="type">Future</span>&lt;<span class="type">T</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Future</span>&lt;<span class="type">T</span>&gt;(work: &#123; resolver <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">self</span>.run(queue: resolver.queue, token: resolver.token, completion: &#123; result <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">switch</span> result &#123;</span><br><span class="line">                <span class="keyword">case</span> .success(<span class="keyword">let</span> value):</span><br><span class="line">                    resolver.complete(value: value)</span><br><span class="line">                <span class="keyword">case</span> .failure(<span class="keyword">let</span> error):</span><br><span class="line">                    <span class="keyword">let</span> future = transform(error)</span><br><span class="line">                    future.run(queue: resolver.queue, token: resolver.token, completion: &#123; newResult <span class="keyword">in</span></span><br><span class="line">                        resolver.handle(result: newResult)</span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">delay</span><span class="params">(seconds: TimeInterval)</span></span> -&gt; <span class="type">Future</span>&lt;<span class="type">T</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Future</span>&lt;<span class="type">T</span>&gt;(work: &#123; resolver <span class="keyword">in</span></span><br><span class="line">            resolver.queue.asyncAfter(deadline: <span class="type">DispatchTime</span>.now() + seconds, execute: &#123;</span><br><span class="line">                <span class="keyword">self</span>.run(queue: resolver.queue, token: resolver.token, completion: &#123; result <span class="keyword">in</span></span><br><span class="line">                    resolver.handle(result: result)</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">log</span><span class="params">(closure: @escaping <span class="params">(Result&lt;T, Error&gt;)</span></span></span> -&gt; <span class="type">Void</span>) -&gt; <span class="type">Future</span>&lt;<span class="type">T</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Future</span>&lt;<span class="type">T</span>&gt;(work: &#123; resolver <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">self</span>.run(queue: resolver.queue, token: resolver.token, completion: &#123; result <span class="keyword">in</span></span><br><span class="line">                closure(result)</span><br><span class="line">                resolver.handle(result: result)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">sequence</span><span class="params">(futures: [Future&lt;T&gt;])</span></span> -&gt; <span class="type">Future</span>&lt;<span class="type">Sequence</span>&lt;<span class="type">T</span>&gt;&gt; &#123;</span><br><span class="line">        <span class="keyword">var</span> index = <span class="number">0</span></span><br><span class="line">        <span class="keyword">var</span> values = [<span class="type">T</span>]()</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">func</span> <span class="title">runNext</span><span class="params">(resolver: Resolver&lt;Sequence&lt;T&gt;&gt;)</span></span> &#123;</span><br><span class="line">            <span class="keyword">guard</span> index &lt; futures.<span class="built_in">count</span> <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">let</span> sequence = <span class="type">Sequence</span>(values: values)</span><br><span class="line">                resolver.complete(value: sequence)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">let</span> future = futures[index]</span><br><span class="line">            index += <span class="number">1</span></span><br><span class="line">            </span><br><span class="line">            future.run(queue: resolver.queue, token: resolver.token, completion: &#123; result <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">switch</span> result &#123;</span><br><span class="line">                <span class="keyword">case</span> .success(<span class="keyword">let</span> value):</span><br><span class="line">                    values.append(value)</span><br><span class="line">                    runNext(resolver: resolver)</span><br><span class="line">                <span class="keyword">case</span> .failure(<span class="keyword">let</span> error):</span><br><span class="line">                    resolver.fail(error: error)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="type">Future</span>&lt;<span class="type">Sequence</span>&lt;<span class="type">T</span>&gt;&gt;(work: runNext)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">NSLocking</span> </span>&#123;</span><br><span class="line">    @inline(__always)</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">whenLock</span>&lt;T&gt;<span class="params">(<span class="number">_</span> closure: <span class="params">()</span></span></span> <span class="keyword">throws</span> -&gt; <span class="type">T</span>) <span class="keyword">rethrows</span> -&gt; <span class="type">T</span> &#123;</span><br><span class="line">        lock()</span><br><span class="line">        <span class="keyword">defer</span> &#123; unlock() &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">try</span> closure()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @inline(__always)</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">whenLock</span><span class="params">(<span class="number">_</span> closure: <span class="params">()</span></span></span> <span class="keyword">throws</span> -&gt; <span class="type">Void</span>) <span class="keyword">rethrows</span> &#123;</span><br><span class="line">        lock()</span><br><span class="line">        <span class="keyword">defer</span> &#123; unlock() &#125;</span><br><span class="line">        <span class="keyword">try</span> closure()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Query-builder-to-build-query"><a href="#Query-builder-to-build-query" class="headerlink" title="Query builder to build query"></a>Query builder to build query</h2><ul>
<li><a href="https://github.com/onmyway133/Miami/blob/master/Sources/Shared/Builder/QueryBuilder.swift">https://github.com/onmyway133/Miami/blob/master/Sources/Shared/Builder/QueryBuilder.swift</a></li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">protocol</span> <span class="title">QueryBuilder</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">build</span><span class="params">()</span></span> -&gt; [<span class="type">URLQueryItem</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DefaultQueryBuilder</span>: <span class="title">QueryBuilder</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">let</span> parameters: <span class="type">JSONDictionary</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">init</span>(parameters: <span class="type">JSONDictionary</span> = [:]) &#123;</span><br><span class="line">        <span class="keyword">self</span>.parameters = parameters</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">build</span><span class="params">()</span></span> -&gt; [<span class="type">URLQueryItem</span>] &#123;</span><br><span class="line">        <span class="keyword">var</span> components = <span class="type">URLComponents</span>()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> parser = <span class="type">ParameterParser</span>()</span><br><span class="line">        <span class="keyword">let</span> pairs = parser</span><br><span class="line">            .parse(parameters: parameters)</span><br><span class="line">            .<span class="built_in">map</span>(&#123; $<span class="number">0</span> &#125;)</span><br><span class="line">            .sorted(by: &lt;)</span><br><span class="line">        </span><br><span class="line">        components.queryItems = pairs.<span class="built_in">map</span>(&#123; key, value <span class="keyword">in</span></span><br><span class="line">            <span class="type">URLQueryItem</span>(name: key, value: value)</span><br><span class="line">        &#125;)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> components.queryItems ?? []</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">build</span><span class="params">(queryItems: [URLQueryItem])</span></span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> components = <span class="type">URLComponents</span>()</span><br><span class="line">        components.queryItems = queryItems.<span class="built_in">map</span>(&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="type">URLQueryItem</span>(name: escape($<span class="number">0</span>.name), value: escape($<span class="number">0</span>.value ?? <span class="string">""</span>))</span><br><span class="line">        &#125;)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> components.query ?? <span class="string">""</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">escape</span><span class="params">(<span class="number">_</span> string: String)</span></span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> string.addingPercentEncoding(withAllowedCharacters: .urlQueryAllowed) ?? <span class="string">""</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Body-builder-to-build-body"><a href="#Body-builder-to-build-body" class="headerlink" title="Body builder to build body"></a>Body builder to build body</h2><ul>
<li><a href="https://github.com/onmyway133/Miami/blob/master/Sources/Shared/Builder/JsonBodyBuilder.swift">https://github.com/onmyway133/Miami/blob/master/Sources/Shared/Builder/JsonBodyBuilder.swift</a></li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JsonBodyBuilder</span>: <span class="title">BodyBuilder</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">let</span> parameters: <span class="type">JSONDictionary</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">init</span>(parameters: <span class="type">JSONDictionary</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.parameters = parameters</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">build</span><span class="params">()</span></span> -&gt; <span class="type">ForBody?</span> &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> data = <span class="keyword">try</span>? <span class="type">JSONSerialization</span>.data(</span><br><span class="line">            withJSONObject: parameters,</span><br><span class="line">            options: <span class="type">JSONSerialization</span>.<span class="type">WritingOptions</span>()</span><br><span class="line">        ) <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="type">ForBody</span>(body: data, headers: [</span><br><span class="line">            <span class="type">Header</span>.contentType.rawValue: <span class="string">"application/json"</span></span><br><span class="line">        ])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Make-request-with-networking"><a href="#Make-request-with-networking" class="headerlink" title="Make request with networking"></a>Make request with networking</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Networking</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">let</span> session: <span class="type">URLSession</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">let</span> mockManager = <span class="type">MockManager</span>()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> before: (<span class="type">URLRequest</span>) -&gt; <span class="type">URLRequest</span> = &#123; $<span class="number">0</span> &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> catchError: (<span class="type">Error</span>) -&gt; <span class="type">Future</span>&lt;<span class="type">Response</span>&gt; = &#123; error <span class="keyword">in</span> <span class="type">Future</span>.fail(error: error) &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> validate: (<span class="type">Response</span>) -&gt; <span class="type">Future</span>&lt;<span class="type">Response</span>&gt; = &#123; <span class="type">Future</span>.complete(value: $<span class="number">0</span>) &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> logResponse: (<span class="type">Result</span>&lt;<span class="type">Response</span>, <span class="type">Error</span>&gt;) -&gt; <span class="type">Void</span> = &#123; <span class="number">_</span> <span class="keyword">in</span> &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">init</span>(session: <span class="type">URLSession</span> = .shared) &#123;</span><br><span class="line">        <span class="keyword">self</span>.session = session</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">make</span><span class="params">(options: Options, baseUrl: URL)</span></span> -&gt; <span class="type">Future</span>&lt;<span class="type">Response</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">let</span> builder = <span class="type">UrlRequestBuilder</span>()</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> request = <span class="keyword">try</span> builder.build(options: options, baseUrl: baseUrl)</span><br><span class="line">            <span class="keyword">return</span> make(request: request)</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="type">Future</span>&lt;<span class="type">Response</span>&gt;.fail(error: error)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">make</span><span class="params">(request: URLRequest)</span></span> -&gt; <span class="type">Future</span>&lt;<span class="type">Response</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> mock = mockManager.findMock(request: request) &#123;</span><br><span class="line">            <span class="keyword">return</span> mock.future.<span class="built_in">map</span>(transform: &#123; <span class="type">Response</span>(data: $<span class="number">0</span>, urlResponse: <span class="type">URLResponse</span>()) &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> future = <span class="type">Future</span>&lt;<span class="type">Response</span>&gt;(work: &#123; resolver <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">let</span> task = <span class="keyword">self</span>.session.dataTask(with: request, completionHandler: &#123; data, response, error <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">let</span> data = data, <span class="keyword">let</span> urlResponse = response &#123;</span><br><span class="line">                    resolver.complete(value: <span class="type">Response</span>(data: data, urlResponse: urlResponse))</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> <span class="keyword">let</span> error = error &#123;</span><br><span class="line">                    resolver.fail(error: <span class="type">NetworkError</span>.urlSession(error, response))</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    resolver.fail(error: <span class="type">NetworkError</span>.unknownError)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            </span><br><span class="line">            resolver.token.onCancel &#123;</span><br><span class="line">                task.cancel()</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            task.resume()</span><br><span class="line">        &#125;)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> future</span><br><span class="line">            .catchError(transform: <span class="keyword">self</span>.catchError)</span><br><span class="line">            .flatMap(transform: <span class="keyword">self</span>.validate)</span><br><span class="line">            .log(closure: <span class="keyword">self</span>.logResponse)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Mock-a-request"><a href="#Mock-a-request" class="headerlink" title="Mock a request"></a>Mock a request</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Mock</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">let</span> options: <span class="type">Options</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">let</span> future: <span class="type">Future</span>&lt;<span class="type">Data</span>&gt;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">init</span>(options: <span class="type">Options</span>, future: <span class="type">Future</span>&lt;<span class="type">Data</span>&gt;) &#123;</span><br><span class="line">        <span class="keyword">self</span>.options = options</span><br><span class="line">        <span class="keyword">self</span>.future = future</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">on</span><span class="params">(options: Options, data: Data)</span></span> -&gt; <span class="type">Mock</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Mock</span>(options: options, future: <span class="type">Future</span>.complete(value: data))</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">on</span><span class="params">(options: Options, error: Error)</span></span> -&gt; <span class="type">Mock</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Mock</span>(options: options, future: <span class="type">Future</span>.fail(error: error))</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">on</span><span class="params">(options: Options, file: String, fileExtension: String, bundle: Bundle = Bundle.main)</span></span> -&gt; <span class="type">Mock</span> &#123;</span><br><span class="line">        <span class="keyword">guard</span></span><br><span class="line">            <span class="keyword">let</span> url = bundle.url(forResource: file, withExtension: fileExtension),</span><br><span class="line">            <span class="keyword">let</span> data = <span class="keyword">try</span>? <span class="type">Data</span>(contentsOf: url)</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> .on(options: options, error: <span class="type">NetworkError</span>.invalidMock)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> .on(options: options, data: data)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-04-03T06:50:01.000Z" title="2019-04-03T06:50:01.000Z">2019-04-03</time><span class="level-item">a few seconds read (About 78 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-cancel-DispatchWorkItem-and-NSOperation/">How to cancel DispatchWorkItem and NSOperation</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/194">#194</a></strong></p>
<h3 id="DispatchWorkItem"><a href="#DispatchWorkItem" class="headerlink" title="DispatchWorkItem"></a><code>DispatchWorkItem</code></h3><ul>
<li><a href="https://stackoverflow.com/questions/48844169/swift-ios-dispatchworkitem-is-still-running-even-though-its-getting-cancelled">https://stackoverflow.com/questions/48844169/swift-ios-dispatchworkitem-is-still-running-even-though-its-getting-cancelled</a></li>
<li><a href="https://stackoverflow.com/questions/29492707/how-to-stop-cancel-suspend-resume-tasks-on-gcd-queue">https://stackoverflow.com/questions/29492707/how-to-stop-cancel-suspend-resume-tasks-on-gcd-queue</a></li>
</ul>
<h3 id="NSOperation"><a href="#NSOperation" class="headerlink" title="NSOperation"></a><code>NSOperation</code></h3><ul>
<li><a href="https://developer.apple.com/documentation/foundation/nsoperation/1411672-cancel?language=objc">https://developer.apple.com/documentation/foundation/nsoperation/1411672-cancel?language=objc</a></li>
</ul>
<h3 id="Grand-Central-Dispatch-vs-NSOperation"><a href="#Grand-Central-Dispatch-vs-NSOperation" class="headerlink" title="Grand Central Dispatch vs NSOperation"></a>Grand Central Dispatch vs NSOperation</h3><ul>
<li><a href="https://stackoverflow.com/questions/43226434/2017-swift-3-1-gcd-vs-nsoperation">https://stackoverflow.com/questions/43226434/2017-swift-3-1-gcd-vs-nsoperation</a></li>
<li><a href="https://medium.com/@johnsundell/a-deep-dive-into-grand-central-dispatch-in-swift-dead7f6e1ca7">https://medium.com/@johnsundell/a-deep-dive-into-grand-central-dispatch-in-swift-dead7f6e1ca7</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-03-29T10:32:29.000Z" title="2019-03-29T10:32:29.000Z">2019-03-29</time><span class="level-item">a few seconds read (About 67 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-construct-URL-with-URLComponents-and-appendPathComponent-in-Swift/">How to construct URL with URLComponents and appendPathComponent in Swift</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/193">#193</a></strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> components = <span class="type">URLComponents</span>(string: <span class="string">"https://google.com/"</span>)</span><br><span class="line">components?.path = <span class="string">"abc/"</span></span><br><span class="line">components?.url</span><br></pre></td></tr></table></figure>

<p>-&gt; nil</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> components = <span class="type">URLComponents</span>(string: <span class="string">"https://google.com/"</span>)</span><br><span class="line">components?.path = <span class="string">"/abc/"</span></span><br><span class="line">components?.url</span><br><span class="line">components?.queryItems = [<span class="type">URLQueryItem</span>(name: <span class="string">"q"</span>, value: <span class="string">"pokemon"</span>)]</span><br></pre></td></tr></table></figure>

<p>-&gt; <code>https://google.com/abc/?q=pokemon</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> url = <span class="type">URL</span>(string: <span class="string">"https://google.com/"</span>)</span><br><span class="line">url?.appendPathComponent(<span class="string">"/abc?q=pokemon"</span>)</span><br><span class="line">url</span><br></pre></td></tr></table></figure>

<p>-&gt; <code>https://google.com//abc%3Fq=pokemon</code></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-03-28T12:34:07.000Z" title="2019-03-28T12:34:07.000Z">2019-03-28</time><span class="level-item">a minute read (About 202 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-catch-error-in-ApolloClient/">How to catch error in ApolloClient</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/192">#192</a></strong></p>
<p>Read <a href="https://www.apollographql.com/docs/react/features/error-handling">https://www.apollographql.com/docs/react/features/error-handling</a><br>How to catch actual error <a href="https://github.com/apollographql/apollo-client/issues/4016">https://github.com/apollographql/apollo-client/issues/4016</a> 🤔 </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Observable &#125; <span class="keyword">from</span> <span class="string">'apollo-link'</span></span><br><span class="line"><span class="keyword">import</span> ApolloClient <span class="keyword">from</span> <span class="string">'apollo-boost'</span></span><br><span class="line"><span class="keyword">import</span> Token <span class="keyword">from</span> <span class="string">'library/models/Token'</span></span><br><span class="line"><span class="keyword">import</span> TokenService <span class="keyword">from</span> <span class="string">'./TokenService'</span></span><br><span class="line"><span class="keyword">import</span> &#123; TokenRefreshException &#125; <span class="keyword">from</span> <span class="string">'library/utils/Exception'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> client = <span class="keyword">new</span> ApolloClient(&#123;</span><br><span class="line">  uri: <span class="string">'https://www.myapp.no/api/'</span>,</span><br><span class="line">  request: <span class="keyword">async</span> (operation) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> token = <span class="keyword">await</span> TokenService.loadToken()</span><br><span class="line">    updateOperation(operation, token)</span><br><span class="line">  &#125;,</span><br><span class="line">  onError: <span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'ApolloClient error'</span>, error)</span><br><span class="line">    <span class="keyword">if</span> (isAuthError(error)) &#123;</span><br><span class="line">      <span class="keyword">return</span> handleAuthError(error)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> error.forward(error.operation)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  fetchOptions: &#123;</span><br><span class="line">    mode: <span class="string">'no-cors'</span>,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> isValidErrorCode = <span class="function">(<span class="params">statusCode</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> (statusCode) === <span class="string">'undefined'</span> || statusCode === <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> isAuthError = <span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'client error'</span>, error)</span><br><span class="line">  <span class="keyword">if</span> (error.networkError) &#123;</span><br><span class="line">    <span class="keyword">return</span> error.networkError.statusCode === <span class="number">401</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> handleAuthError = <span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Observable(<span class="function">(<span class="params">observer</span>) =&gt;</span> &#123;</span><br><span class="line">    TokenService.refreshToken()</span><br><span class="line">      .then(<span class="function">(<span class="params">token</span>) =&gt;</span> &#123;</span><br><span class="line">        updateOperation(error.operation, token)</span><br><span class="line">      &#125;)</span><br><span class="line">      .then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> subscriber = &#123;</span><br><span class="line">          next: observer.next.bind(observer),</span><br><span class="line">          error: observer.error.bind(observer),</span><br><span class="line">          complete: observer.complete.bind(observer)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        error.forward(error.operation).subscribe(subscriber)</span><br><span class="line">      &#125;)</span><br><span class="line">      .catch(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">        observer.error(e)</span><br><span class="line">      &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> updateOperation = <span class="function">(<span class="params">operation, token: Token</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> tokenHeader = <span class="string">`<span class="subst">$&#123;token.token_type&#125;</span> <span class="subst">$&#123;token.access_token&#125;</span>`</span></span><br><span class="line"></span><br><span class="line">  operation.setContext(<span class="function">(<span class="params">context</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      headers: &#123;</span><br><span class="line">        authorization: tokenHeader,</span><br><span class="line">        <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-03-26T13:23:03.000Z" title="2019-03-26T13:23:03.000Z">2019-03-26</time><span class="level-item">3 minutes read (About 477 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-do-clustering-with-Google-Maps-in-iOS/">How to do clustering with Google Maps in iOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/191">#191</a></strong></p>
<h2 id="Basic-with-Google-Maps"><a href="#Basic-with-Google-Maps" class="headerlink" title="Basic with Google Maps"></a>Basic with Google Maps</h2><p>Add to Podfile <code>pod &#39;GoogleMaps&#39;</code></p>
<p>Add a custom marker</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> GoogleMaps</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">StopMarker</span>: <span class="title">GMSMarker</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> stop: <span class="type">Stop</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(stop: <span class="type">Stop</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.stop = stop</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>()</span><br><span class="line">        <span class="keyword">self</span>.title = stop.name</span><br><span class="line">        <span class="keyword">self</span>.position = stop.toCoordinate()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> imageView = <span class="type">UIImageView</span>(frame: <span class="type">CGRect</span>(x: <span class="number">0</span>, y: <span class="number">0</span>, width: <span class="number">30</span>, height: <span class="number">30</span>))</span><br><span class="line">        imageView.layer.cornerRadius = <span class="number">15</span></span><br><span class="line">        imageView.image = <span class="type">UIImage</span>(named: <span class="string">"pin"</span>)</span><br><span class="line">        <span class="keyword">self</span>.iconView = imageView</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Show markers</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">handle</span><span class="params">(stops: [Stop])</span></span> &#123;</span><br><span class="line">    <span class="keyword">self</span>.stops = stops</span><br><span class="line">    stops</span><br><span class="line">        .<span class="built_in">map</span>(&#123; <span class="type">StopMarker</span>(stop: $<span class="number">0</span>) &#125;)</span><br><span class="line">        .forEach &#123;</span><br><span class="line">            $<span class="number">0</span>.<span class="built_in">map</span> = mapView</span><br><span class="line">        &#125;</span><br><span class="line">   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Assigning <code>$0.map = mapView</code> means telling <code>GMSMapView</code> to start rendering markers</p>
<p>Handle tap</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">ViewController</span>: <span class="title">GMSMapViewDelegate</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">mapView</span><span class="params">(<span class="number">_</span> mapView: GMSMapView, didTap marker: GMSMarker)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        zoomIn(coordinate: marker.position)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">mapView</span><span class="params">(<span class="number">_</span> mapView: GMSMapView, didTapInfoWindowOf marker: GMSMarker)</span></span> &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> stopMarker = marker <span class="keyword">as</span>? <span class="type">StopMarker</span> <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> detailViewController = <span class="type">StopDetailViewController</span>(stop: stopMarker.stop)</span><br><span class="line">        presentPanModal(detailViewController)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Clustering"><a href="#Clustering" class="headerlink" title="Clustering"></a>Clustering</h2><p>Add google-maps-ios-utils manually by following <a href="https://github.com/googlemaps/google-maps-ios-utils/blob/master/Swift.md">https://github.com/googlemaps/google-maps-ios-utils/blob/master/Swift.md</a></p>
<p>Otherwise, with CocoaPods, we get error</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[!] The &#39;Pods-MyApp&#39; target has transitive dependencies that include static binaries: (&#x2F;Users&#x2F;khoa&#x2F;Projects&#x2F;MyApp&#x2F;Pods&#x2F;GoogleMaps&#x2F;Base&#x2F;Frameworks&#x2F;GoogleMapsBase.framework, &#x2F;Users&#x2F;khoa&#x2F;Projects&#x2F;MyApp&#x2F;Pods&#x2F;GoogleMaps&#x2F;Maps&#x2F;Frameworks&#x2F;GoogleMaps.framework, and &#x2F;Users&#x2F;khoa&#x2F;Projects&#x2F;MyApp&#x2F;Pods&#x2F;GoogleMaps&#x2F;Maps&#x2F;Frameworks&#x2F;GoogleMapsCore.framework)</span><br></pre></td></tr></table></figure>

<p>Add <code>ClusterItem</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"><span class="keyword">import</span> CoreLocation</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClusterItem</span>: <span class="title">NSObject</span>, <span class="title">GMUClusterItem</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> position: <span class="type">CLLocationCoordinate2D</span></span><br><span class="line">    <span class="keyword">let</span> stop: <span class="type">Stop</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(stop: <span class="type">Stop</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.stop = stop</span><br><span class="line">        <span class="keyword">self</span>.position = stop.toCoordinate()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Set up cluster manager</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> iconGenerator = <span class="type">GMUDefaultClusterIconGenerator</span>()</span><br><span class="line"><span class="keyword">let</span> algorithm = <span class="type">GMUNonHierarchicalDistanceBasedAlgorithm</span>()</span><br><span class="line"><span class="keyword">let</span> renderer = <span class="type">GMUDefaultClusterRenderer</span>(mapView: mapView, clusterIconGenerator: iconGenerator)</span><br><span class="line">renderer.delegate = <span class="keyword">self</span></span><br><span class="line">clusterManager = <span class="type">GMUClusterManager</span>(<span class="built_in">map</span>: mapView, algorithm: algorithm, renderer: renderer)</span><br><span class="line">clusterManager.setDelegate(<span class="keyword">self</span>, mapDelegate: <span class="keyword">self</span>)</span><br></pre></td></tr></table></figure>

<p>Default algorithm <code>GMUNonHierarchicalDistanceBasedAlgorithm</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">A simple clustering algorithm with O(nlog n) performance. Resulting clusters are not</span><br><span class="line">* hierarchical.</span><br><span class="line">* High level algorithm:</span><br><span class="line">* 1. Iterate over items in the order they were added (candidate clusters).</span><br><span class="line">* 2. Create a cluster with the center of the item.</span><br><span class="line">* 3. Add all items that are within a certain distance to the cluster.</span><br><span class="line">* 4. Move any items out of an existing cluster if they are closer to another cluster.</span><br><span class="line">* 5. Remove those items from the list of candidate clusters.</span><br><span class="line">* Clusters have the center of the first element (not the centroid of the items within it).</span><br></pre></td></tr></table></figure>


<p>Make <code>ClusterItem</code> and add to <code>clusterManager</code>. In the end, call <code>clusterManager.cluster()</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">handle</span><span class="params">(stops: [Stop])</span></span> &#123;</span><br><span class="line">    <span class="keyword">self</span>.stops = stops</span><br><span class="line">    stops</span><br><span class="line">        .<span class="built_in">map</span>(&#123; <span class="type">StopMarker</span>(stop: $<span class="number">0</span>) &#125;)</span><br><span class="line">        .forEach &#123;</span><br><span class="line">            <span class="keyword">let</span> item = <span class="type">ClusterItem</span>(stop: $<span class="number">0</span>.stop)</span><br><span class="line">            clusterManager.add(item)</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    clusterManager.cluster()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>By default, clusterManager uses renderer to render default pin marker. Implement <code>GMUClusterRendererDelegate</code> to use our custom <code>StopMarker</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">ViewController</span>: <span class="title">GMUClusterRendererDelegate</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">renderer</span><span class="params">(<span class="number">_</span> renderer: GMUClusterRenderer, markerFor object: <span class="keyword">Any</span>)</span></span> -&gt; <span class="type">GMSMarker?</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> object &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="keyword">let</span> clusterItem <span class="keyword">as</span> <span class="type">ClusterItem</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="type">StopMarker</span>(stop: clusterItem.stop)</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Finally handle tapping on cluster and cluster item</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">ViewController</span>: <span class="title">GMUClusterManagerDelegate</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">clusterManager</span><span class="params">(<span class="number">_</span> clusterManager: GMUClusterManager, didTap cluster: GMUCluster)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"tap cluster"</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">clusterManager</span><span class="params">(<span class="number">_</span> clusterManager: GMUClusterManager, didTap clusterItem: GMUClusterItem)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"tap cluster item"</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-03-25T12:51:01.000Z" title="2019-03-25T12:51:01.000Z">2019-03-25</time><span class="level-item">a few seconds read (About 27 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-handle-file-picker-in-React/">How to handle file picker in React</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/190">#190</a></strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">render() &#123;</span><br><span class="line">  &lt;Button color=<span class="string">"inherit"</span> onClick=&#123;<span class="keyword">this</span>.onImagePress&#125; &gt;Image&lt;<span class="regexp">/Button&gt;</span></span><br><span class="line"><span class="regexp">  &lt;input ref="fileInput" type="file" id="myFile" multiple accept="image/</span>*<span class="string">" style=&#123;&#123;display: 'none'&#125;&#125; onChange=&#123;this.handleFiles&#125;&gt;&lt;/input&gt;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">onImagePress = () =&gt; &#123;</span></span><br><span class="line"><span class="string">  const fileInput = this.refs.fileInput</span></span><br><span class="line"><span class="string">  fileInput.click()</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">handleFiles = (e) =&gt; &#123;</span></span><br><span class="line"><span class="string">  e.persist()</span></span><br><span class="line"><span class="string">  const file = e.target.files[0]</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-03-25T07:19:13.000Z" title="2019-03-25T07:19:13.000Z">2019-03-25</time><span class="level-item">a few seconds read (About 23 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/Links-for-OSS/">Links for OSS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/189">#189</a></strong></p>
<ul>
<li><a href="https://github.com/digipost/ios">https://github.com/digipost/ios</a></li>
<li><a href="https://github.com/wwdc/2019">https://github.com/wwdc/2019</a></li>
<li><a href="https://github.com/google/science-journal-ios">https://github.com/google/science-journal-ios</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-03-25T07:19:13.000Z" title="2019-03-25T07:19:13.000Z">2019-03-25</time><span class="level-item">a few seconds read (About 23 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/OSS/">OSS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/189">#189</a></strong></p>
<ul>
<li><a href="https://github.com/digipost/ios">https://github.com/digipost/ios</a></li>
<li><a href="https://github.com/wwdc/2019">https://github.com/wwdc/2019</a></li>
<li><a href="https://github.com/google/science-journal-ios">https://github.com/google/science-journal-ios</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-03-24T20:17:22.000Z" title="2019-03-24T20:17:22.000Z">2019-03-24</time><span class="level-item">a minute read (About 144 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-fix-ApiException-10-in-Flutter-for-Android/">How to fix ApiException  10 in Flutter for Android</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/188">#188</a></strong></p>
<p>Get error <code>com.google.android.gms.common.api.ApiException: 10</code> with <code>google_sign_in</code> package.</p>
<p>Read <a href="https://developers.google.com/android/guides/client-auth">https://developers.google.com/android/guides/client-auth</a></p>
<blockquote>
<p>Certain Google Play services (such as Google Sign-in and App Invites) require you to provide the SHA-1 of your signing certificate so we can create an OAuth2 client and API key for your app</p>
</blockquote>
<p>console.developers.google.com/apis/credentials</p>
<p>Credentials -&gt; OAuth client id<br>If we specify SHA1 in firebase, then <code>console.developers.google.com</code> will generate an Android oauth for us</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">keytool -list -v -keystore &#123;keystore_name&#125; -<span class="built_in">alias</span> &#123;alias_name&#125;</span><br></pre></td></tr></table></figure>

<p>Use correct keystore for debug and release</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">buildTypes &#123;</span><br><span class="line">        release &#123;</span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span> Add your own signing config for the release build.</span></span><br><span class="line">            <span class="comment">// Signing with the debug keys for now, so `flutter run --release` works.</span></span><br><span class="line">            signingConfig signingConfigs.release</span><br><span class="line">        &#125;</span><br><span class="line">        debug &#123;</span><br><span class="line">            signingConfig signingConfigs.debug</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<hr>
<p><strong>Updated at</strong> 2020-10-05 13:23:34</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-03-24T20:12:58.000Z" title="2019-03-24T20:12:58.000Z">2019-03-24</time><span class="level-item">a minute read (About 123 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-get-Google-account-photo-in-Flutter/">How to get Google account photo in Flutter</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/187">#187</a></strong></p>
<p>If you use Flutter, then you can access it via <code>people.googleapis.com</code> endpoint, code uses <code>google_sign_in</code> library</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'package:google_sign_in/google_sign_in.dart'</span>;</span><br><span class="line"></span><br><span class="line">Future&lt;<span class="built_in">String</span>&gt; getPhotoUrl(GoogleSignInAccount account, <span class="built_in">String</span> userId) <span class="keyword">async</span> &#123;</span><br><span class="line">  <span class="comment">// final authentication = await account.authentication;</span></span><br><span class="line">  <span class="keyword">final</span> url = <span class="string">'https://people.googleapis.com/v1/people/<span class="subst">$&#123;userId&#125;</span>?personFields=photos'</span>;</span><br><span class="line">  <span class="keyword">final</span> response = <span class="keyword">await</span> http.<span class="keyword">get</span>(</span><br><span class="line">    url,</span><br><span class="line">    headers: <span class="keyword">await</span> account.authHeaders</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">final</span> data = json.decode(response.body);</span><br><span class="line">  <span class="keyword">return</span> data[<span class="string">'photos'</span>].first[<span class="string">'url'</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>You will get something like</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  resourceName: people/<span class="number">998812322529259873423</span>, </span><br><span class="line">  etag: %EgQBAzcabcQBAgUH, </span><br><span class="line">  photos: [&#123;<span class="attr">metadata</span>: &#123;<span class="attr">primary</span>: <span class="literal">true</span>, <span class="attr">source</span>: &#123;<span class="attr">type</span>: PROFILE, <span class="attr">id</span>: <span class="number">107721622529987673423</span>&#125;&#125;, </span><br><span class="line">  url: https:<span class="comment">//lh3.googleusercontent.com/a-/abcdefmB2p1VWxLsNT9WSV0yqwuwo6o2Ba21sh_ra7CnrZ=s100&#125;]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>where url is an accessible image url.</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-03-24T20:08:58.000Z" title="2019-03-24T20:08:58.000Z">2019-03-24</time><span class="level-item">3 minutes read (About 400 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/Getting-activity-name-through-HKWorkoutActivityType-in-HealthKit/">Getting activity name through HKWorkoutActivityType in HealthKit</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/186">#186</a></strong></p>
<p>After fetching workouts with HKObjectType.workoutType() , we get <a href="https://developer.apple.com/documentation/healthkit/hkworkoutactivitytype">HKWorkoutActivityType</a> , which is an enum enum HKWorkoutActivityType : <a href="https://developer.apple.com/documentation/swift/uint">UInt</a> . As of Swift 4.2, there are no way to get enum case as String because this enum has type UInt .</p>
<p>Though there will be some manual involved, we can build a generator to get all the enum case names. Here we will write code to generate code, and use that generated code to examine all the values.</p>
<p>Execute this Swift code in our iOS app</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">makeCode</span><span class="params">(string: String)</span></span> &#123;</span><br><span class="line">   <span class="keyword">let</span> pattern = “<span class="keyword">case</span> \\w*”</span><br><span class="line">   <span class="keyword">let</span> range = <span class="type">NSMakeRange</span>(<span class="number">0</span>, string.<span class="built_in">count</span>-<span class="number">1</span>)</span><br><span class="line">   <span class="keyword">let</span> regex = <span class="keyword">try</span>! <span class="type">NSRegularExpression</span>(pattern: pattern, options: [])</span><br><span class="line">   regex</span><br><span class="line">   .matches(<span class="keyword">in</span>: string, options: [], range: range)</span><br><span class="line">   .forEach(&#123; result <span class="keyword">in</span></span><br><span class="line">   <span class="keyword">let</span> start = string.index(string.startIndex, offsetBy: result.range.lowerBound)</span><br><span class="line">   <span class="keyword">let</span> end = string.index(string.startIndex, offsetBy: result.range.upperBound)</span><br><span class="line">   <span class="keyword">let</span> substring = <span class="type">String</span>(string[start…end])</span><br><span class="line">   <span class="keyword">let</span> name = substring</span><br><span class="line">   .replacingOccurrences(of: “<span class="keyword">case</span>”, with: “”)</span><br><span class="line">   .replacingOccurrences(of: “ “, with: “”)</span><br><span class="line">   .replacingOccurrences(of: “\n”, with: “”</span><br><span class="line">  <span class="built_in">print</span>(“dictionary[<span class="type">HKWorkoutActivityType</span>.\(name).rawValue] = \”\(name)\””)</span><br><span class="line"> &#125;)</span><br></pre></td></tr></table></figure>

<p>Where string is all the cases from <a href="https://developer.apple.com/documentation/healthkit/hkworkoutactivitytype">HKWorkoutActivityType</a>, for example</p>
<p><a href="https://developer.apple.com/documentation/healthkit/hkworkoutactivitytype/archery">case archery</a><br>The constant for shooting archery.</p>
<p><a href="https://developer.apple.com/documentation/healthkit/hkworkoutactivitytype/bowling">case bowling</a><br>The constant for bowling</p>
<p><a href="https://developer.apple.com/documentation/healthkit/hkworkoutactivitytype/fencing">case fencing</a><br>The constant for fencing.</p>
<p><a href="https://developer.apple.com/documentation/healthkit/hkworkoutactivitytype/gymnastics">case gymnastics</a><br>Performing gymnastics.</p>
<p><a href="https://developer.apple.com/documentation/healthkit/hkworkoutactivitytype/trackandfield">case trackAndField</a><br>Participating in track and field events, including shot put, javelin, pole vaulting, and related sports.</p>
<p>What the code does is to use regular expression to examine all the names after case , and build our code</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dictionary[<span class="type">HKWorkoutActivityType</span>.americanFootball.rawValue] = “americanFootball”</span><br><span class="line">dictionary[<span class="type">HKWorkoutActivityType</span>.archery.rawValue] = “archery”</span><br><span class="line">dictionary[<span class="type">HKWorkoutActivityType</span>.australianFootball.rawValue] = “australianFootball”</span><br><span class="line">dictionary[<span class="type">HKWorkoutActivityType</span>.badminton.rawValue] = “badminton”</span><br><span class="line">dictionary[<span class="type">HKWorkoutActivityType</span>.baseball.rawValue] = “baseball”</span><br></pre></td></tr></table></figure>

<p>The above generated code with dictionary contains rawValue as key and the enum case name as value .</p>
<p>Later when we get any HKWorkoutActivityType , we can compare with this dictionary to find the actual name. This is better than hardcode activity name with numbers because those rawValue are just implementation detail</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-03-24T20:08:27.000Z" title="2019-03-24T20:08:27.000Z">2019-03-24</time><span class="level-item">8 minutes read (About 1130 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/Curry-in-Swift-and-Javascript/">Curry in Swift and Javascript</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/185">#185</a></strong></p>
<p>You may encounter curry in everyday code without knowing it. Here is a bit of my reflections on curry and how to apply it in Javascript and Swift.</p>
<h2 id="Taking-one-parameter-in-Haskell"><a href="#Taking-one-parameter-in-Haskell" class="headerlink" title="Taking one parameter in Haskell"></a>Taking one parameter in Haskell</h2><p>In Haskell, all function officially takes only 1 parameter. Function with many parameters are just curried, which means they will be partially applied. Calling sum 1 just returns a function with 1 parameter, then 2is passed into this function. The following 2 function calls are the same.</p>
<pre><code>ghci&gt; sum 1 2
3 
ghci&gt; (max 1) 2
3</code></pre><p>I tend to think of curried function or partially applied function as something that carry dependencies at each application step. Each curried function can be assigned to variable or pass around, or as returned value.</p>
<h2 id="Curry-in-Swift-for-predicate"><a href="#Curry-in-Swift-for-predicate" class="headerlink" title="Curry in Swift for predicate"></a>Curry in Swift for predicate</h2><p>When I was trying to make my own <a href="https://github.com/onmyway133/archives/tree/master/Signal">Signal</a> library, I have</p>
<iframe src="https://medium.com/media/f61aae80ae0b6410d6844dbfd961d01e" frameborder=0></iframe>

<p>and Event</p>
<iframe src="https://medium.com/media/4a05bf4ba2a71d096c2ef87a3cd57ec8" frameborder=0></iframe>

<h3 id="filter"><a href="#filter" class="headerlink" title="filter"></a>filter</h3><p>Then there should be a filter for Signal. The idea of filter is that we should update signal if the Event is Next with right filtered value</p>
<pre><code>public func filter(f: T -&gt; Bool) -&gt; Signal&lt;T&gt;{
    let signal = Signal&lt;T&gt;()
    subscribe { result in
        switch(result) {
        case let .Success(value):
            if f(value) {
                signal.update(result)
            }
        case let .Error(error): signal.update(.Error(error))
        }
    }
    return signal
}</code></pre><h3 id="2-parameters"><a href="#2-parameters" class="headerlink" title="2 parameters"></a>2 parameters</h3><p>But having Event as another monad, I think it should be more encapsulated if that switching logic gets moved into the Event. Here the filter takes 2 params</p>
<p>Event.swift</p>
<pre><code>func filter(f: T -&gt; Bool, callback: (Event&lt;T&gt; -&gt; Void)) {
        switch self {
        case let .Next(value) where f(value):
            callback(self)
        case .Failed:
            callback(self)
        default:
            break
    }
}</code></pre><p>Signal.swift</p>
<pre><code>public func filter(f: T -&gt; Bool) -&gt; Signal&lt;T&gt; {
    let signal = Signal&lt;T&gt;()

    subscribe { event in
        event.filter(f, callback: signal.update)
    }

    return signal
}</code></pre><h3 id="Currying"><a href="#Currying" class="headerlink" title="Currying"></a>Currying</h3><p>With currying, we can make filter a more abstract function, and defer the decision to pass the callback param. It is a little carried away but I find it helpful this way</p>
<p>Now filter accepts 1 param, and it returns a function that takes callback as its param</p>
<p>Event.swift</p>
<pre><code>func filter(f: T -&gt; Bool) -&gt; ((Event&lt;T&gt; -&gt; Void) -&gt; Void) {
        return { g in
            switch self {
            case let .Next(value) where f(value):
                g(self)
            case .Failed:
                g(self)
            default:
                break
            }
        }
    }</code></pre><p>Signal.swift</p>
<pre><code>public func filter(f: T -&gt; Bool) -&gt; Signal&lt;T&gt; {
        let signal = Signal&lt;T&gt;()

        subscribe { event in
            event.filter(f)(signal.update)
        }

        return signal
    }</code></pre><h3 id="Curry-syntax-in-Swift-2-and-above"><a href="#Curry-syntax-in-Swift-2-and-above" class="headerlink" title="Curry syntax in Swift 2 and above"></a>Curry syntax in Swift 2 and above</h3><p>Swift 2 supports curry syntax function</p>
<pre><code>func sum(a: Int)(b: Int) -&gt; Int {
    return a + b
}

let sumWith5 = sum(5)
let result = sumWith5(b: 10)</code></pre><p>Unfortunately, the syntactic sugar for declaring curry has been dropped since Swift 3. You may want to find out in <a href="http://ericasadun.com/2015/12/18/bidding-farewell-to-currying/">Bidding farewell to currying</a>. But it’s not a big deal as we can easily create curry function. It is just a function that returns another function.</p>
<h2 id="Using-curry-for-partial-application-in-UIKit"><a href="#Using-curry-for-partial-application-in-UIKit" class="headerlink" title="Using curry for partial application in UIKit"></a>Using curry for partial application in UIKit</h2><p>I used this curry technique in my Xkcd app. See <a href="https://github.com/onmyway133/Xkcd/blob/master/Source/Feature/Main/MainController.swift">MainController.swift</a>. MainController is vanilla UITabBarController with ComicsController and FavoriteController , all embedded in UINavigationViewController .</p>
<p>The feature is that when a comic is selected, a comic detail screen should be pushed on top of the navigation stack. For example in <a href="https://github.com/onmyway133/Xkcd/blob/master/Source/Feature/Comics/ComicsContoller.swift#L20">ComicsController</a></p>
<pre><code>/// Called when a comic is selected  
var selectComic: ((Comic) -&gt; Void)?</code></pre><p>All ComicsController needs to know is to call that selectComic closure with the chosen Comic, and someone should know how to handle that selection. Back to the <a href="https://github.com/onmyway133/Xkcd/blob/master/Source/Feature/Main/MainController.swift">handleFlow</a> function inside MainController.</p>
<pre><code>private func handleFlow() {
  typealias Function = (UINavigationController) -&gt; (Comic) -&gt; Void
  let selectComic: Function = { [weak self] navigationController in
    return { (comic: Comic) in
      guard let self = self else {
        return
      }

  let detailController = self.makeDetail(comic: comic)
      navigationController.pushViewController(detailController, animated: true)
    }
  }

  comicsController.selectComic = selectComic(comicNavigationController)
  favoriteController.selectComic = selectComic(favoriteNavigationController)
}</code></pre><p>I declared Function as typealias to explicitly state the curry function that we are going to build</p>
<pre><code>typealias Function = (UINavigationController) -&gt; (Comic) -&gt; Void</code></pre><p>We build selectComic as curried function, that takes UINavigationViewController and returns a function that takes Comic and returns Void . This way when we partially apply selectComic with the a navigationController , we get another function that has navigationController as dependency, and ready to be assigned to selectComic property in comicsController .</p>
<h2 id="Curry-promised-function-in-Javascript"><a href="#Curry-promised-function-in-Javascript" class="headerlink" title="Curry promised function in Javascript"></a>Curry promised function in Javascript</h2><p>I like to work with Promise and async/await in Javascript. It allows chainable style and easy to reason about. So when working with callbacks in Javascript, for example callback from native modules in React Native, I tend to convert them into Promise.</p>
<p>For example when working with HealthKit, we need to expose a native modules around it</p>
<pre><code>// [@flow](http://twitter.com/flow)

import { NativeModules } from &apos;react-native&apos;

type HealthManagerType = {
  checkAuthorisation: ((string) =&gt; void)) =&gt; void,
  authorise: ((boolean) =&gt; void)) =&gt; void,
  readWorkout: (Date, Date, () =&gt; void)) =&gt; void,
  readDailySummary: (Date, Date, () =&gt; void)) =&gt; void,
  readMeasurement: (Date, Date, () =&gt; void)) =&gt; void
}

const HealthManager: HealthManagerType = NativeModules.HealthManager
export default HealthManager</code></pre><p>We can build a toPromise function that can convert a function with callback into Promise</p>
<pre><code>// [@flow](http://twitter.com/flow)

const toPromise = (f: (any) =&gt; void) =&gt; {
  return new Promise&lt;any&gt;((resolve, reject) =&gt; {
    try {
      f((result) =&gt; {
        resolve(result)
      })
    } catch (e) {
      reject(e)
    }
  })
}

export default toPromise</code></pre><p>However, as you can see in the signature, it only works with a callback of type (any) =&gt; void In other words, this callback must have exactly 1 parameter, because a Promise can either returns a value or throws an error.</p>
<p>To remedy this, we can build a curry function that can turns function with either 1, 2, 3 parameters into curried function. Thanks to the dynamic nature of Javascript, we have</p>
<pre><code>// [@flow](http://twitter.com/flow)

function curry0(f: () =&gt; void) {
  return f()
}

function curry1(f: (any) =&gt; void) {
  return (p1: any) =&gt; {
    return f(p1)
  }
}

function curry2(f: (any, any) =&gt; void) {
  return (p1: any) =&gt; {
    return (p2: any) =&gt; {
      return f(p1, p2)
    }
  }
}

function curry3(f: (any, any, any) =&gt; void) {
  return (p1: any) =&gt; {
    return (p2: any) =&gt; {
      return (p3: any) =&gt; {
        return f(p1, p2, p3)
      }
    }
  }
}

export default {
  curry0,
  curry1,
  curry2,
  curry3
}</code></pre><p>So with a function that have 3 parameters, we can use curry3 to partially apply the first 2 parameters. Then we have a function that accepts just a callback, and this is turned into Promise via toPromise</p>
<pre><code>const readWorkout = curry.curry3(HealthManager.readWorkout)(DateUtils.startDate))(DateUtils.endDate))

const workouts = await toPromise(readWorkout)</code></pre><h2 id="Where-to-go-from-here"><a href="#Where-to-go-from-here" class="headerlink" title="Where to go from here"></a>Where to go from here</h2><p>Here are some of my favorite posts to read more about curry</p>
<ul>
<li><p><a href="http://learnyouahaskell.com/higher-order-functions">Higher order functions</a></p>
</li>
<li><p><a href="https://robots.thoughtbot.com/introduction-to-function-currying-in-swift">Introduction to Function Currying in Swift</a></p>
</li>
<li><p><a href="http://www.russbishop.net/swift-function-currying">Swift Function Currying</a></p>
</li>
<li><p><a href="https://medium.com/@kevincennis/currying-in-javascript-c66080543528">Currying in JavaScript</a>: I like how he uses memory and slice to gradually build more generic curry function</p>
</li>
</ul>
</div></article></div><nav class="pagination is-centered mt-4" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/page/16/">Previous</a></div><div class="pagination-next"><a href="/page/18/">Next</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/">1</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/page/16/">16</a></li><li><a class="pagination-link is-current" href="/page/17/">17</a></li><li><a class="pagination-link" href="/page/18/">18</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/page/23/">23</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="" src="https://avatars1.githubusercontent.com/u/2284279?s=460&amp;v=4" alt="onmyway133"></figure><p class="title is-size-4 is-block line-height-inherit">onmyway133</p><p class="is-size-6 is-block">iOS, macOS, Android, React. Serial maker. Writer. Speaker.</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Oslo, Norway</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">673</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">52</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/onmyway133" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/onmyway133"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com/onmyway133"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile is-mobile" href="https://onmyway133.com/apps" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Apps</span></span><span class="level-right"><span class="level-item tag">onmyway133.com</span></span></a></li><li><a class="level is-mobile is-mobile" href="https://learntalks.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Learn Talks</span></span><span class="level-right"><span class="level-item tag">learntalks.com</span></span></a></li><li><a class="level is-mobile is-mobile" href="https://wwdctogether.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">WWDC Together</span></span><span class="level-right"><span class="level-item tag">wwdctogether.com</span></span></a></li></ul></div></div></div><!--!--><div class="card widget"><div class="card-content"><h3 class="menu-label">Recent</h3><article class="media"><div class="media-content size-small"><p><time dateTime="2020-12-27T21:11:35.000Z">2020-12-27</time></p><p class="title is-6"><a class="link-muted" href="/blog/How-to-use-hashtag-raw-string-in-Swift/">How to use hashtag raw string in Swift</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-12-26T20:42:53.000Z">2020-12-26</time></p><p class="title is-6"><a class="link-muted" href="/blog/How-to-make-UserDefaults-property-wrapper/">How to make UserDefaults property wrapper</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-12-26T20:09:15.000Z">2020-12-26</time></p><p class="title is-6"><a class="link-muted" href="/blog/How-to-use-Set-to-check-for-bool-in-Swift/">How to use Set to check for bool in Swift</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-12-26T20:02:18.000Z">2020-12-26</time></p><p class="title is-6"><a class="link-muted" href="/blog/How-to-make-visual-effect-blur-in-SwiftUI-for-macOS/">How to make visual effect blur in SwiftUI for macOS</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-12-26T19:51:44.000Z">2020-12-26</time></p><p class="title is-6"><a class="link-muted" href="/blog/How-to-make-simple-HUD-in-SwiftUI/">How to make simple HUD in SwiftUI</a></p><p class="is-uppercase"></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/archives/2020/12/"><span class="level-start"><span class="level-item">December 2020</span></span><span class="level-end"><span class="level-item tag">23</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/11/"><span class="level-start"><span class="level-item">November 2020</span></span><span class="level-end"><span class="level-item tag">15</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/10/"><span class="level-start"><span class="level-item">October 2020</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/09/"><span class="level-start"><span class="level-item">September 2020</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/08/"><span class="level-start"><span class="level-item">August 2020</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/06/"><span class="level-start"><span class="level-item">June 2020</span></span><span class="level-end"><span class="level-item tag">14</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/05/"><span class="level-start"><span class="level-item">May 2020</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/04/"><span class="level-start"><span class="level-item">April 2020</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/03/"><span class="level-start"><span class="level-item">March 2020</span></span><span class="level-end"><span class="level-item tag">21</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/02/"><span class="level-start"><span class="level-item">February 2020</span></span><span class="level-end"><span class="level-item tag">20</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/01/"><span class="level-start"><span class="level-item">January 2020</span></span><span class="level-end"><span class="level-item tag">30</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/12/"><span class="level-start"><span class="level-item">December 2019</span></span><span class="level-end"><span class="level-item tag">36</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/11/"><span class="level-start"><span class="level-item">November 2019</span></span><span class="level-end"><span class="level-item tag">38</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/10/"><span class="level-start"><span class="level-item">October 2019</span></span><span class="level-end"><span class="level-item tag">49</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/09/"><span class="level-start"><span class="level-item">September 2019</span></span><span class="level-end"><span class="level-item tag">50</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/08/"><span class="level-start"><span class="level-item">August 2019</span></span><span class="level-end"><span class="level-item tag">39</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/07/"><span class="level-start"><span class="level-item">July 2019</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/06/"><span class="level-start"><span class="level-item">June 2019</span></span><span class="level-end"><span class="level-item tag">41</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/05/"><span class="level-start"><span class="level-item">May 2019</span></span><span class="level-end"><span class="level-item tag">49</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/04/"><span class="level-start"><span class="level-item">April 2019</span></span><span class="level-end"><span class="level-item tag">27</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/03/"><span class="level-start"><span class="level-item">March 2019</span></span><span class="level-end"><span class="level-item tag">24</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/02/"><span class="level-start"><span class="level-item">February 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/12/"><span class="level-start"><span class="level-item">December 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/05/"><span class="level-start"><span class="level-item">May 2018</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/04/"><span class="level-start"><span class="level-item">April 2018</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/02/"><span class="level-start"><span class="level-item">February 2018</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/01/"><span class="level-start"><span class="level-item">January 2018</span></span><span class="level-end"><span class="level-item tag">14</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/12/"><span class="level-start"><span class="level-item">December 2017</span></span><span class="level-end"><span class="level-item tag">14</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/11/"><span class="level-start"><span class="level-item">November 2017</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/10/"><span class="level-start"><span class="level-item">October 2017</span></span><span class="level-end"><span class="level-item tag">18</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/09/"><span class="level-start"><span class="level-item">September 2017</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/08/"><span class="level-start"><span class="level-item">August 2017</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/07/"><span class="level-start"><span class="level-item">July 2017</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/06/"><span class="level-start"><span class="level-item">June 2017</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/05/"><span class="level-start"><span class="level-item">May 2017</span></span><span class="level-end"><span class="level-item tag">35</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/04/"><span class="level-start"><span class="level-item">April 2017</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/algorithm/"><span class="tag">algorithm</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/android/"><span class="tag">android</span><span class="tag is-grey-lightest">34</span></a></div><div class="control"><a class="tags has-addons" href="/tags/apple-script/"><span class="tag">apple script</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/catalyst/"><span class="tag">catalyst</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ci/"><span class="tag">ci</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cloud/"><span class="tag">cloud</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cocoapods/"><span class="tag">cocoapods</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/combine/"><span class="tag">combine</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/core-data/"><span class="tag">core data</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/csharp/"><span class="tag">csharp</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/css/"><span class="tag">css</span><span class="tag is-grey-lightest">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/dart/"><span class="tag">dart</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/database/"><span class="tag">database</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/design/"><span class="tag">design</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/electron/"><span class="tag">electron</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/firebase/"><span class="tag">firebase</span><span class="tag is-grey-lightest">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/flutter/"><span class="tag">flutter</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/git/"><span class="tag">git</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/github/"><span class="tag">github</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/go/"><span class="tag">go</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/google/"><span class="tag">google</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/iOS/"><span class="tag">iOS</span><span class="tag is-grey-lightest">166</span></a></div><div class="control"><a class="tags has-addons" href="/tags/javascript/"><span class="tag">javascript</span><span class="tag is-grey-lightest">50</span></a></div><div class="control"><a class="tags has-addons" href="/tags/kotlin/"><span class="tag">kotlin</span><span class="tag is-grey-lightest">27</span></a></div><div class="control"><a class="tags has-addons" href="/tags/layout/"><span class="tag">layout</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/life/"><span class="tag">life</span><span class="tag is-grey-lightest">12</span></a></div><div class="control"><a class="tags has-addons" href="/tags/links/"><span class="tag">links</span><span class="tag is-grey-lightest">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/macOS/"><span class="tag">macOS</span><span class="tag is-grey-lightest">116</span></a></div><div class="control"><a class="tags has-addons" href="/tags/machine-learning/"><span class="tag">machine learning</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/maps/"><span class="tag">maps</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/networking/"><span class="tag">networking</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/node/"><span class="tag">node</span><span class="tag is-grey-lightest">11</span></a></div><div class="control"><a class="tags has-addons" href="/tags/objc/"><span class="tag">objc</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/react/"><span class="tag">react</span><span class="tag is-grey-lightest">23</span></a></div><div class="control"><a class="tags has-addons" href="/tags/react-native/"><span class="tag">react native</span><span class="tag is-grey-lightest">14</span></a></div><div class="control"><a class="tags has-addons" href="/tags/realm/"><span class="tag">realm</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/rx/"><span class="tag">rx</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/script/"><span class="tag">script</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/spm/"><span class="tag">spm</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/swift/"><span class="tag">swift</span><span class="tag is-grey-lightest">317</span></a></div><div class="control"><a class="tags has-addons" href="/tags/swiftUI/"><span class="tag">swiftUI</span><span class="tag is-grey-lightest">76</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tech/"><span class="tag">tech</span><span class="tag is-grey-lightest">14</span></a></div><div class="control"><a class="tags has-addons" href="/tags/terminal/"><span class="tag">terminal</span><span class="tag is-grey-lightest">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/testing/"><span class="tag">testing</span><span class="tag is-grey-lightest">17</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tool/"><span class="tag">tool</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/unity/"><span class="tag">unity</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/voip/"><span class="tag">voip</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/watchOS/"><span class="tag">watchOS</span><span class="tag is-grey-lightest">11</span></a></div><div class="control"><a class="tags has-addons" href="/tags/web/"><span class="tag">web</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/work/"><span class="tag">work</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/wwdc/"><span class="tag">wwdc</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/xcode/"><span class="tag">xcode</span><span class="tag is-grey-lightest">24</span></a></div></div></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Subscribe to Updates</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=c2r59mmt2n5k0o5dt5vv3nq4u4&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="c2r59mmt2n5k0o5dt5vv3nq4u4" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button is-primary" type="submit" value="Subscribe"></div></div></form></div></div></div><div class="card widget"><div class="card-content"><div class="notification is-danger">You need to set <code>client_id</code> and <code>slot_id</code> to show this AD unit. Please set it in <code>_config.yml</code>.</div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/z.png" alt="onmyway133" height="28"></a><p class="size-small"><span>&copy; 2020 Khoa Pham</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/onmyway133"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            site: {
                url: 'https://onmyway133.github.io',
                external_link: {"enable":true,"exclude":[]}
            },
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to Top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>