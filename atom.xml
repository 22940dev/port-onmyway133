<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>onmyway133</title>
  
  <subtitle>What you don&#39;t know is what you haven&#39;t learned</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://onmyway133.github.io/"/>
  <updated>2020-12-27T21:11:35.000Z</updated>
  <id>https://onmyway133.github.io/</id>
  
  <author>
    <name>Khoa Pham</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>How to use hashtag raw string in Swift</title>
    <link href="https://onmyway133.github.io/blog/How-to-use-hashtag-raw-string-in-Swift/"/>
    <id>https://onmyway133.github.io/blog/How-to-use-hashtag-raw-string-in-Swift/</id>
    <published>2020-12-27T21:11:35.000Z</published>
    <updated>2020-12-27T21:11:35.000Z</updated>
    
    <content type="html"><![CDATA[<p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/727">#727</a></strong></p><p>Use <code>#</code> in Swift 5 to specify raw string, for example regular expression</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#<span class="string">"^#?(?:[0-9a-fA-F]&#123;3&#125;)&#123;1,2&#125;$"</span>#</span><br></pre></td></tr></table></figure><h2 id="Read-more"><a href="#Read-more" class="headerlink" title="Read more"></a>Read more</h2><ul><li><a href="https://www.hackingwithswift.com/articles/162/how-to-use-raw-strings-in-swift">https://www.hackingwithswift.com/articles/162/how-to-use-raw-strings-in-swift</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;p&gt;&lt;strong&gt;Issue &lt;a href=&quot;https://github.com/onmyway133/blog/issues/727&quot;&gt;#727&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Use &lt;code&gt;#&lt;/code&gt; in Swift 5 to specify
        
      
    
    </summary>
    
    
    
      <category term="swift" scheme="https://onmyway133.github.io/tags/swift/"/>
    
  </entry>
  
  <entry>
    <title>How to make UserDefaults property wrapper</title>
    <link href="https://onmyway133.github.io/blog/How-to-make-UserDefaults-property-wrapper/"/>
    <id>https://onmyway133.github.io/blog/How-to-make-UserDefaults-property-wrapper/</id>
    <published>2020-12-26T20:42:53.000Z</published>
    <updated>2020-12-26T20:42:53.000Z</updated>
    
    <content type="html"><![CDATA[<p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/726">#726</a></strong></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@propertyWrapper</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">UserDefault</span>&lt;<span class="title">Value</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> key: <span class="type">String</span></span><br><span class="line">    <span class="keyword">let</span> defaultValue: <span class="type">Value</span></span><br><span class="line">    <span class="keyword">let</span> container: <span class="type">UserDefaults</span> = .standard</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> wrappedValue: <span class="type">Value</span> &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> container.object(forKey: key) <span class="keyword">as</span>? <span class="type">Value</span> ?? defaultValue</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">set</span> &#123;</span><br><span class="line">            container.<span class="keyword">set</span>(newValue, forKey: key)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Then we can use it as property and provide default value</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">KeepHistoryService</span> </span>&#123;</span><br><span class="line">    @<span class="type">UserDefault</span>(key: <span class="string">"keepHistoryCheckDate"</span>, defaultValue: <span class="literal">nil</span>)</span><br><span class="line">    <span class="keyword">var</span> checkDate: <span class="type">Date?</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;p&gt;&lt;strong&gt;Issue &lt;a href=&quot;https://github.com/onmyway133/blog/issues/726&quot;&gt;#726&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight
        
      
    
    </summary>
    
    
    
      <category term="swift" scheme="https://onmyway133.github.io/tags/swift/"/>
    
  </entry>
  
  <entry>
    <title>How to use Set to check for bool in Swift</title>
    <link href="https://onmyway133.github.io/blog/How-to-use-Set-to-check-for-bool-in-Swift/"/>
    <id>https://onmyway133.github.io/blog/How-to-use-Set-to-check-for-bool-in-Swift/</id>
    <published>2020-12-26T20:09:15.000Z</published>
    <updated>2020-12-26T20:09:15.000Z</updated>
    
    <content type="html"><![CDATA[<p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/725">#725</a></strong></p><p>When you want to check for existence using <code>Bool</code>, consider using <code>Set</code> over Dictionary with <code>Bool</code>, as <code>Set</code> guarantee uniqueness. If using <code>Dictionary</code> instead, the value for key is <code>Optional&lt;Bool&gt;</code> where we have to check for both optional and true false within.</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Book</span>: <span class="title">Hashable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> id: <span class="type">UUID</span></span><br><span class="line">    <span class="keyword">let</span> name: <span class="type">String</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> book1 = <span class="type">Book</span>(id: <span class="type">UUID</span>(), name: <span class="string">"1"</span>)</span><br><span class="line"><span class="keyword">let</span> book2 = <span class="type">Book</span>(id: <span class="type">UUID</span>(), name: <span class="string">"2"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">useDictionary</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> hasChecked: [<span class="type">Book</span>: <span class="type">Bool</span>] = [:]</span><br><span class="line">    hasChecked[book1] = <span class="literal">true</span></span><br><span class="line">    <span class="built_in">print</span>(hasChecked[book1] == <span class="type">Optional</span>&lt;<span class="type">Bool</span>&gt;(<span class="literal">true</span>))</span><br><span class="line">    <span class="built_in">print</span>(hasChecked[book2] == <span class="type">Optional</span>&lt;<span class="type">Bool</span>&gt;.<span class="keyword">none</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">useSet</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> hasChecked: <span class="type">Set</span>&lt;<span class="type">Book</span>&gt; = <span class="type">Set</span>()</span><br><span class="line">    hasChecked.insert(book1)</span><br><span class="line">    <span class="built_in">print</span>(hasChecked.<span class="built_in">contains</span>(book1))</span><br><span class="line">    <span class="built_in">print</span>(hasChecked.<span class="built_in">contains</span>(book2))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;p&gt;&lt;strong&gt;Issue &lt;a href=&quot;https://github.com/onmyway133/blog/issues/725&quot;&gt;#725&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;When you want to check for existence
        
      
    
    </summary>
    
    
    
      <category term="swift" scheme="https://onmyway133.github.io/tags/swift/"/>
    
  </entry>
  
  <entry>
    <title>How to make visual effect blur in SwiftUI for macOS</title>
    <link href="https://onmyway133.github.io/blog/How-to-make-visual-effect-blur-in-SwiftUI-for-macOS/"/>
    <id>https://onmyway133.github.io/blog/How-to-make-visual-effect-blur-in-SwiftUI-for-macOS/</id>
    <published>2020-12-26T20:02:18.000Z</published>
    <updated>2020-12-26T20:02:18.000Z</updated>
    
    <content type="html"><![CDATA[<p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/724">#724</a></strong></p><p>We can use <code>.blur</code> modifier, but with <code>VisualEffectView</code> gives us more options for material and blending mode.</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">VisualEffectView</span>: <span class="title">NSViewRepresentable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> material: <span class="type">NSVisualEffectView</span>.<span class="type">Material</span></span><br><span class="line">    <span class="keyword">let</span> blendingMode: <span class="type">NSVisualEffectView</span>.<span class="type">BlendingMode</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">init</span>(</span><br><span class="line">        material: <span class="type">NSVisualEffectView</span>.<span class="type">Material</span> = .contentBackground,</span><br><span class="line">        blendingMode: <span class="type">NSVisualEffectView</span>.<span class="type">BlendingMode</span> = .withinWindow</span><br><span class="line">    ) &#123;</span><br><span class="line">        <span class="keyword">self</span>.material = material</span><br><span class="line">        <span class="keyword">self</span>.blendingMode = blendingMode</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">makeNSView</span><span class="params">(context: Context)</span></span> -&gt; <span class="type">NSVisualEffectView</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> visualEffectView = <span class="type">NSVisualEffectView</span>()</span><br><span class="line">        visualEffectView.material = material</span><br><span class="line">        visualEffectView.blendingMode = blendingMode</span><br><span class="line">        visualEffectView.state = <span class="type">NSVisualEffectView</span>.<span class="type">State</span>.active</span><br><span class="line">        <span class="keyword">return</span> visualEffectView</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">updateNSView</span><span class="params">(<span class="number">_</span> visualEffectView: NSVisualEffectView, context: Context)</span></span> &#123;</span><br><span class="line">        visualEffectView.material = material</span><br><span class="line">        visualEffectView.blendingMode = blendingMode</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;p&gt;&lt;strong&gt;Issue &lt;a href=&quot;https://github.com/onmyway133/blog/issues/724&quot;&gt;#724&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;We can use &lt;code&gt;.blur&lt;/code&gt; modifier,
        
      
    
    </summary>
    
    
    
      <category term="swift" scheme="https://onmyway133.github.io/tags/swift/"/>
    
      <category term="macOS" scheme="https://onmyway133.github.io/tags/macOS/"/>
    
      <category term="swiftUI" scheme="https://onmyway133.github.io/tags/swiftUI/"/>
    
  </entry>
  
  <entry>
    <title>How to make simple HUD in SwiftUI</title>
    <link href="https://onmyway133.github.io/blog/How-to-make-simple-HUD-in-SwiftUI/"/>
    <id>https://onmyway133.github.io/blog/How-to-make-simple-HUD-in-SwiftUI/</id>
    <published>2020-12-26T19:51:44.000Z</published>
    <updated>2020-12-26T19:59:10.000Z</updated>
    
    <content type="html"><![CDATA[<p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/723">#723</a></strong></p><p>Use <code>@ViewBuilder</code> to build dynamic content for our HUD. For blur effect, here I use <code>NSVisualEffectView</code>, but we can use <code>.blur</code> modifier also</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">HUD</span>&lt;<span class="title">Content</span>&gt;: <span class="title">View</span> <span class="title">where</span> <span class="title">Content</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> content: () -&gt; <span class="type">Content</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(@<span class="type">ViewBuilder</span> content: @escaping () -&gt; <span class="type">Content</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.content = content</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: some <span class="type">View</span> &#123;</span><br><span class="line">        content()</span><br><span class="line">        .frame(width: <span class="number">80</span>, height: <span class="number">80</span>)</span><br><span class="line">        .background(</span><br><span class="line">            <span class="type">VisualEffectView</span>(material: .hudWindow)</span><br><span class="line">                .clipShape(<span class="type">RoundedRectangle</span>(cornerRadius: <span class="number">12</span>))</span><br><span class="line">                .shadow(color: <span class="type">Color</span>.black.opacity(<span class="number">0.22</span>), radius: <span class="number">12</span>, x: <span class="number">0</span>, y: <span class="number">5</span>)</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Then we can make some wrappers for information and progress HUD</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">HUD</span>&lt;<span class="title">Content</span>&gt;: <span class="title">View</span> <span class="title">where</span> <span class="title">Content</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> content: () -&gt; <span class="type">Content</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(@<span class="type">ViewBuilder</span> content: @escaping () -&gt; <span class="type">Content</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.content = content</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: some <span class="type">View</span> &#123;</span><br><span class="line">        content()</span><br><span class="line">        .frame(width: <span class="number">80</span>, height: <span class="number">80</span>)</span><br><span class="line">        .background(</span><br><span class="line">            <span class="type">VisualEffectView</span>()</span><br><span class="line">        )</span><br><span class="line">        .cornerRadius(<span class="number">10</span>)</span><br><span class="line">        .shadow(color: <span class="type">Color</span>.gray.opacity(<span class="number">0.3</span>), radius: <span class="number">1</span>, x: <span class="number">0</span>, y: <span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p><strong>Updated at</strong> 2020-12-26 20:59:10</p>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;p&gt;&lt;strong&gt;Issue &lt;a href=&quot;https://github.com/onmyway133/blog/issues/723&quot;&gt;#723&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Use &lt;code&gt;@ViewBuilder&lt;/code&gt; to build
        
      
    
    </summary>
    
    
    
      <category term="swift" scheme="https://onmyway133.github.io/tags/swift/"/>
    
      <category term="swiftUI" scheme="https://onmyway133.github.io/tags/swiftUI/"/>
    
  </entry>
  
  <entry>
    <title>How to instrument SwiftUI app</title>
    <link href="https://onmyway133.github.io/blog/How-to-instrument-SwiftUI-app/"/>
    <id>https://onmyway133.github.io/blog/How-to-instrument-SwiftUI-app/</id>
    <published>2020-12-25T22:06:34.000Z</published>
    <updated>2020-12-29T13:31:43.000Z</updated>
    
    <content type="html"><![CDATA[<p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/722">#722</a></strong></p><p>With Xcode 12, we can fire up Instrument to profile our app. Select <code>SwiftUI template</code></p><img width="836" alt="Screenshot 2020-12-26 at 00 02 03" src="https://user-images.githubusercontent.com/2284279/103142980-a0a13b00-470d-11eb-81bc-632a08b8084b.png"><p>There are many profiles in that template, I find SwiftUI and Time Profile very useful. Here’s the profile I run for my app <a href="https://onmyway133.com/pastepal">PastePal</a></p><h2 id="SwiftUI-View-Body"><a href="#SwiftUI-View-Body" class="headerlink" title="SwiftUI View Body"></a>SwiftUI View Body</h2><p>This shows how many instance of View with body invocation are there, both for SwiftUI views and our app views</p><p>Taking a look at SwiftUI profile, it shows that <code>ClipboardCell</code> is taking most of the time, here over 7 seconds</p><img width="1396" alt="Screenshot 2020-12-25 at 23 59 12" src="https://user-images.githubusercontent.com/2284279/103142965-7bacc800-470d-11eb-8b0e-5d598f6e082b.png"><h2 id="Time-Profiler"><a href="#Time-Profiler" class="headerlink" title="Time Profiler"></a>Time Profiler</h2><p>This shows how much time was spent in each functions and call stack.</p><p>Then we drill down to Time Profiler, it shows that <code>NSSharingService.submenu</code> accounts for 75% of performance issue</p><img width="1396" alt="Screenshot 2020-12-25 at 23 59 57" src="https://user-images.githubusercontent.com/2284279/103142966-7f404f00-470d-11eb-85b7-3e813ff5476c.png"><p>With these instruments, I found out that the <a href="https://onmyway133.com/blog/how-to-make-sharing-menu-in-swiftui-for-macos/">NSSharingService context menu I added</a> has poor performance. </p><p>This below method is used every time <code>Menu</code> is required, which causes a significant overload on main thread, resulting in noticeable laggy scrolling</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">NSSharingService</span>.sharingServices(forItems: [<span class="string">""</span>])</span><br></pre></td></tr></table></figure><p>A quick fix is to cache the items using <code>static</code> variable. In Swift, static variable is like <code>lazy</code> attribute, it is computed only once on first asked</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">let</span> items = <span class="type">NSSharingService</span>.sharingServices(forItems: [<span class="string">""</span>])</span><br></pre></td></tr></table></figure><p>There are more to optimize in my case, for example calculation of image and dominant colors. But we should only optimize when seeing real performance issue and after proper instruments</p><h2 id="Fix-and-instrument-again"><a href="#Fix-and-instrument-again" class="headerlink" title="Fix and instrument again"></a>Fix and instrument again</h2><p>After the fix, the time reduces from over 7 seconds to just less than 200ms</p><img width="1396" alt="Screenshot 2020-12-26 at 00 09 51" src="https://user-images.githubusercontent.com/2284279/103143031-db57a300-470e-11eb-8953-c15f163fe364.png"><img width="1396" alt="Screenshot 2020-12-26 at 00 09 01" src="https://user-images.githubusercontent.com/2284279/103143033-deeb2a00-470e-11eb-980e-27c82136b1a8.png"><hr><p><strong>Updated at</strong> 2020-12-29 14:31:43</p>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;p&gt;&lt;strong&gt;Issue &lt;a href=&quot;https://github.com/onmyway133/blog/issues/722&quot;&gt;#722&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;With Xcode 12, we can fire up Instrument
        
      
    
    </summary>
    
    
    
      <category term="swiftUI" scheme="https://onmyway133.github.io/tags/swiftUI/"/>
    
  </entry>
  
  <entry>
    <title>How to force set frame explicitly for NSWindow</title>
    <link href="https://onmyway133.github.io/blog/How-to-force-set-frame-explicitly-for-NSWindow/"/>
    <id>https://onmyway133.github.io/blog/How-to-force-set-frame-explicitly-for-NSWindow/</id>
    <published>2020-12-25T21:29:23.000Z</published>
    <updated>2020-12-25T21:29:23.000Z</updated>
    
    <content type="html"><![CDATA[<p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/721">#721</a></strong></p><p>For <code>setFrame</code> to take effect</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mainWindow.setFrame(rect, display: <span class="literal">true</span>)</span><br></pre></td></tr></table></figure><p>we can remove auto save frame flag</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mainWindow.setFrameAutosaveName(<span class="string">"MyApp.MainWindow"</span>)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;p&gt;&lt;strong&gt;Issue &lt;a href=&quot;https://github.com/onmyway133/blog/issues/721&quot;&gt;#721&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;For &lt;code&gt;setFrame&lt;/code&gt; to take
        
      
    
    </summary>
    
    
    
      <category term="swift" scheme="https://onmyway133.github.io/tags/swift/"/>
    
      <category term="macOS" scheme="https://onmyway133.github.io/tags/macOS/"/>
    
  </entry>
  
  <entry>
    <title>How to rotate NSStatusItem</title>
    <link href="https://onmyway133.github.io/blog/How-to-rotate-NSStatusItem/"/>
    <id>https://onmyway133.github.io/blog/How-to-rotate-NSStatusItem/</id>
    <published>2020-12-23T08:01:34.000Z</published>
    <updated>2020-12-26T20:21:00.000Z</updated>
    
    <content type="html"><![CDATA[<p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/720">#720</a></strong></p><p><code>NSStatusItem</code> is backed by <code>NSButton</code>, we can animate this inner button. We need to specify <code>position</code> and <code>anchorPoint</code> for button’s layer so it rotates around its center point</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">guard</span></span><br><span class="line">    <span class="keyword">let</span> button = statusItem.button</span><br><span class="line"><span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> animation = <span class="type">CABasicAnimation</span>(keyPath: <span class="string">"transform.rotation.z"</span>)</span><br><span class="line">animation.fromValue = <span class="number">0</span></span><br><span class="line">animation.toValue = <span class="type">CGFloat</span>.pi * <span class="number">2</span></span><br><span class="line">animation.duration = <span class="number">0.25</span></span><br><span class="line">animation.repeatCount = <span class="number">1</span></span><br><span class="line">button.layer?.position = <span class="type">NSPoint</span>(x: <span class="type">NSMidX</span>(button.frame), y: <span class="type">NSMidY</span>(button.frame))</span><br><span class="line">button.layer?.anchorPoint = <span class="type">NSPoint</span>(x: <span class="number">0.5</span>, y: <span class="number">0.5</span>)</span><br><span class="line">button.layer?.add(animation, forKey: <span class="string">"rotate"</span>)</span><br></pre></td></tr></table></figure><hr><p><strong>Updated at</strong> 2020-12-26 21:21:00</p>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;p&gt;&lt;strong&gt;Issue &lt;a href=&quot;https://github.com/onmyway133/blog/issues/720&quot;&gt;#720&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;NSStatusItem&lt;/code&gt; is backed by
        
      
    
    </summary>
    
    
    
      <category term="swift" scheme="https://onmyway133.github.io/tags/swift/"/>
    
      <category term="macOS" scheme="https://onmyway133.github.io/tags/macOS/"/>
    
  </entry>
  
  <entry>
    <title>How to show image and text in menu item in SwiftUI for macOS</title>
    <link href="https://onmyway133.github.io/blog/How-to-show-image-and-text-in-menu-item-in-SwiftUI-for-macOS/"/>
    <id>https://onmyway133.github.io/blog/How-to-show-image-and-text-in-menu-item-in-SwiftUI-for-macOS/</id>
    <published>2020-12-23T05:17:48.000Z</published>
    <updated>2020-12-23T05:35:31.000Z</updated>
    
    <content type="html"><![CDATA[<p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/719">#719</a></strong></p><p>From SwiftUI 2 for macOS 11.0, we have access to <code>Menu</code> for creating menu and submenu. Usually we use <code>Button</code> for interactive menu items and <code>Text</code> for disabled menu items.</p><p>The easy way to customize menu with image is to call <code>Menu</code> with <code>content</code> and <code>label</code>. Pay attention to how we use <code>Button</code> and <code>Label</code> inside <code>Content</code> to create interactive menu items</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Menu</span>(</span><br><span class="line">    content: &#123;</span><br><span class="line">        <span class="type">ForEach</span>(collections) &#123; collection <span class="keyword">in</span></span><br><span class="line">            <span class="type">Button</span>(action: &#123;) &#123;</span><br><span class="line">                <span class="type">Label</span>(collection.name, systemImage: <span class="type">SFSymbol</span>.star.rawValue)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    label: &#123;</span><br><span class="line">        <span class="type">Image</span>(systemName: <span class="type">SFSymbol</span>.bookmarkFill.rawValue)</span><br><span class="line">        <span class="type">Text</span>(<span class="string">"Add to collection"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>We can also use <code>Image</code> and <code>Text</code> separately. By default SwiftUI wraps these inside <code>HStack</code> automatically for us. For now, color has no effect in <code>Menu</code>, but it works on <code>Text</code></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Image</span>(systemName: <span class="type">SFSymbol</span>.bookmarkFill.rawValue)</span><br><span class="line">     .foregroundColor(<span class="type">Color</span>.red)</span><br><span class="line"><span class="type">Text</span>(collection.name)</span><br><span class="line">    .foregroundColor(<span class="type">Color</span>.green)</span><br></pre></td></tr></table></figure><p>One way to mitigate this is to use Text with icon font. Here I use my <a href="https://github.com/onmyway133/FontAwesomeSwiftUI">FontAwesomeSwiftUI</a></p><p>There’s a problem that only the first <code>Text</code> is shown</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Text</span>(collection.icon)</span><br><span class="line">    .font(.awesome(style: .solid, size: <span class="number">18</span>))</span><br><span class="line">    .foregroundColor(<span class="type">Color</span>.red)</span><br><span class="line"><span class="type">Text</span>(collection.name)</span><br></pre></td></tr></table></figure><p>The solution is to concatenate <code>Text</code>. In SwiftUI, <code>Text</code> has <code>+</code> operator that allows us to make cool attributed texts</p><img width="409" alt="Screenshot 2020-12-23 at 07 34 40" src="https://user-images.githubusercontent.com/2284279/102967039-652a2500-44f1-11eb-826c-ce69f10468b7.png"><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Text</span>(collection.icon)</span><br><span class="line">    .font(.awesome(style: .solid, size: <span class="number">18</span>))</span><br><span class="line">    .foregroundColor(<span class="type">Color</span>.red)</span><br><span class="line">+ <span class="type">Text</span>(collection.name)</span><br></pre></td></tr></table></figure><hr><p><strong>Updated at</strong> 2020-12-23 06:35:31</p>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;p&gt;&lt;strong&gt;Issue &lt;a href=&quot;https://github.com/onmyway133/blog/issues/719&quot;&gt;#719&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;From SwiftUI 2 for macOS 11.0, we have
        
      
    
    </summary>
    
    
    
      <category term="macOS" scheme="https://onmyway133.github.io/tags/macOS/"/>
    
      <category term="swiftUI" scheme="https://onmyway133.github.io/tags/swiftUI/"/>
    
  </entry>
  
  <entry>
    <title>How to make sharing menu in SwiftUI for macOS</title>
    <link href="https://onmyway133.github.io/blog/How-to-make-sharing-menu-in-SwiftUI-for-macOS/"/>
    <id>https://onmyway133.github.io/blog/How-to-make-sharing-menu-in-SwiftUI-for-macOS/</id>
    <published>2020-12-23T04:19:17.000Z</published>
    <updated>2020-12-25T21:57:57.000Z</updated>
    
    <content type="html"><![CDATA[<p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/718">#718</a></strong></p><p>Use <code>NSSharingService.sharingServices(forItems:)</code> with an array of one empty string gives a list of sharing items. There we show <code>image</code> and <code>title</code> of each menu item.</p><p>We should cache sharing items as that can cause performance issue</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> AppKit</span><br><span class="line"><span class="keyword">import</span> EasySwiftUI</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">NSSharingService</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">let</span> items = <span class="type">NSSharingService</span>.sharingServices(forItems: [<span class="string">""</span>])</span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">submenu</span><span class="params">(text: String)</span></span> -&gt; some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Menu</span>(</span><br><span class="line">            content: &#123;</span><br><span class="line">                <span class="type">ForEach</span>(items, id: \.title) &#123; item <span class="keyword">in</span></span><br><span class="line">                    <span class="type">Button</span>(action: &#123; item.perform(withItems: [string]) &#125;) &#123;</span><br><span class="line">                        <span class="type">Image</span>(nsImage: item.image)</span><br><span class="line">                        <span class="type">Text</span>(item.title)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            label: &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">"Share"</span>)</span><br><span class="line">                <span class="type">Image</span>(systemName: <span class="type">SFSymbol</span>.squareAndArrowUp.rawValue)</span><br><span class="line">            &#125;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Alternative, you can trigger <code>NSSharingServicePicker</code> from a button, it shows a context menu with sharing options</p><h2 id="Read-more"><a href="#Read-more" class="headerlink" title="Read more"></a>Read more</h2><ul><li><a href="https://stackoverflow.com/questions/60952334/swiftui-using-nssharingservicepicker-in-macos">https://stackoverflow.com/questions/60952334/swiftui-using-nssharingservicepicker-in-macos</a></li></ul><hr><p><strong>Updated at</strong> 2020-12-25 22:57:57</p>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;p&gt;&lt;strong&gt;Issue &lt;a href=&quot;https://github.com/onmyway133/blog/issues/718&quot;&gt;#718&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Use
        
      
    
    </summary>
    
    
    
      <category term="swift" scheme="https://onmyway133.github.io/tags/swift/"/>
    
      <category term="swiftUI" scheme="https://onmyway133.github.io/tags/swiftUI/"/>
    
  </entry>
  
  <entry>
    <title>How to make stepper with plus and minus buttons in SwiftUI for macOS</title>
    <link href="https://onmyway133.github.io/blog/How-to-make-stepper-with-plus-and-minus-buttons-in-SwiftUI-for-macOS/"/>
    <id>https://onmyway133.github.io/blog/How-to-make-stepper-with-plus-and-minus-buttons-in-SwiftUI-for-macOS/</id>
    <published>2020-12-21T04:24:26.000Z</published>
    <updated>2020-12-21T04:56:28.000Z</updated>
    
    <content type="html"><![CDATA[<p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/717">#717</a></strong></p><p>Try to use predefined system colors in <a href="https://developer.apple.com/design/human-interface-guidelines/macos/visual-design/color/">Human Interface Guidelines</a> for macOS</p><p>Here we use this color <code>unemphasizedSelectedTextBackgroundColor</code> for button background</p><img width="88" alt="Screenshot 2020-12-21 at 06 24 16" src="https://user-images.githubusercontent.com/2284279/102742430-29f2ef00-4355-11eb-9bdd-b5fe373677c5.png"><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">HStack</span>(spacing: <span class="number">1</span>) &#123;</span><br><span class="line">    makeUnderListButton(action: &#123;&#125;, icon: .plus)</span><br><span class="line">    makeUnderListButton(action: &#123;&#125;, icon: .minus)</span><br><span class="line">&#125;</span><br><span class="line">.background(<span class="type">Color</span>(<span class="type">NSColor</span>.unemphasizedSelectedTextBackgroundColor))</span><br><span class="line">.cornerRadius(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">makeUnderListButton</span><span class="params">(action: @escaping <span class="params">()</span></span></span> -&gt; <span class="type">Void</span>, icon: <span class="type">AwesomeIcon</span>) -&gt; some <span class="type">View</span> &#123;</span><br><span class="line">    <span class="type">Button</span>(action: action) &#123;</span><br><span class="line">        <span class="type">Text</span>(icon.rawValue)</span><br><span class="line">            .font(.awesome(style: .solid, size: <span class="number">14</span>))</span><br><span class="line">    &#125;</span><br><span class="line">    .buttonStyle(<span class="type">HighlightButtonStyle</span>(h: <span class="number">8</span>, v: <span class="number">6</span>, cornerRadius: <span class="number">4</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Another thing is List, where we have selected and alternative background colors. We should also use dynamic system colors <code>selectedContentBackgroundColor</code> and <code>alternatingContentBackgroundColors</code></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">VStack</span> &#123;</span><br><span class="line">    <span class="type">ForEach</span>(apps.enumerated().<span class="built_in">map</span>(&#123; $<span class="number">0</span> &#125;), id: \.element) &#123; index, app <span class="keyword">in</span></span><br><span class="line">        makeRow(app: app)</span><br><span class="line">            .onTapGesture &#123;</span><br><span class="line">                <span class="keyword">self</span>.selected = app</span><br><span class="line">            &#125;</span><br><span class="line">            .background(</span><br><span class="line">                <span class="keyword">self</span>.selected == app</span><br><span class="line">                    ? <span class="type">Color</span>(<span class="type">NSColor</span>.selectedContentBackgroundColor)</span><br><span class="line">                    : <span class="type">Color</span>(<span class="type">NSColor</span>.alternatingContentBackgroundColors[index % <span class="number">2</span>])</span><br><span class="line">            )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Read-more"><a href="#Read-more" class="headerlink" title="Read more"></a>Read more</h2><ul><li><a href="https://blog.verslu.is/xamarin/ios-macos-dark-mode-dynamic-colors-overview/">iOS and macOS Dark Mode Dynamic Colors Overview</a></li></ul><hr><p><strong>Updated at</strong> 2020-12-21 05:56:28</p>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;p&gt;&lt;strong&gt;Issue &lt;a href=&quot;https://github.com/onmyway133/blog/issues/717&quot;&gt;#717&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Try to use predefined system colors in &lt;a
        
      
    
    </summary>
    
    
    
      <category term="macOS" scheme="https://onmyway133.github.io/tags/macOS/"/>
    
      <category term="swiftUI" scheme="https://onmyway133.github.io/tags/swiftUI/"/>
    
  </entry>
  
  <entry>
    <title>How to fix Picker not showing selection in SwiftUI</title>
    <link href="https://onmyway133.github.io/blog/How-to-fix-Picker-not-showing-selection-in-SwiftUI/"/>
    <id>https://onmyway133.github.io/blog/How-to-fix-Picker-not-showing-selection-in-SwiftUI/</id>
    <published>2020-12-20T05:18:26.000Z</published>
    <updated>2020-12-23T05:05:08.000Z</updated>
    
    <content type="html"><![CDATA[<p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/716">#716</a></strong></p><p>I have an enum that conforms to <code>CaseIterable</code> that I want to show in <code>Picker</code></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Position</span>: <span class="title">String</span>, <span class="title">Codable</span>, <span class="title">CaseIterable</span>, <span class="title">Identifiable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> id: <span class="type">String</span> &#123; rawValue &#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">left</span></span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">right</span></span><br><span class="line">    <span class="keyword">case</span> bottom</span><br><span class="line">    <span class="keyword">case</span> top</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">Picker</span>(selection: $preference.position, label: <span class="type">Text</span>(<span class="string">"Position"</span>)) &#123;</span><br><span class="line">    <span class="type">ForEach</span>(<span class="type">Preference</span>.<span class="type">Position</span>.allCases) &#123; position <span class="keyword">in</span></span><br><span class="line">        <span class="type">Text</span>(position.rawValue)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>It compiles and runs just fine, but Picker does not show current selection regardless of any Picker style I choose. It does not update <code>Binding</code> at all.</p><p>The fix is to specify <code>id</code>, it looks redundant because of enum conforms to <code>Identifiable</code>, but it fixes the problem</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Picker</span>(selection: $preference.position, label: <span class="type">Text</span>(<span class="string">"Position"</span>)) &#123;</span><br><span class="line">    <span class="type">ForEach</span>(<span class="type">Preference</span>.<span class="type">Position</span>.allCases, id: \.<span class="keyword">self</span>) &#123; position <span class="keyword">in</span></span><br><span class="line">        <span class="type">Text</span>(position.rawValue)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Mismatch-between-rawValue-and-enum-case-itself"><a href="#Mismatch-between-rawValue-and-enum-case-itself" class="headerlink" title="Mismatch between rawValue and enum case itself"></a>Mismatch between rawValue and enum case itself</h3><p>Reading <a href="https://developer.apple.com/documentation/swiftui/foreach/init(_:content:)-6oy5i">ForEach</a> once again </p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">init</span>(<span class="number">_</span> data: <span class="type">Data</span>, content: @escaping (<span class="type">Data</span>.<span class="type">Element</span>) -&gt; <span class="type">Content</span>)</span><br></pre></td></tr></table></figure><blockquote><p>Available when Data conforms to RandomAccessCollection, ID is Data.Element.ID, Content conforms to View, and Data.Element conforms to Identifiable.</p></blockquote><p>So in our case, we use <code>rawValue</code> as <code>id</code> for <code>Identifiable</code>, so there’s mismatch between our <code>selection</code> being <code>enum case</code> and items in <code>ForEach</code>, which uses <code>rawValue</code> to uniquely identifies items. So our fix is to explicitly state that we want to use the enum case itself <code>\.self</code> as <code>id</code>for ForEach</p><p>What we can also do is to declare enum case itself as <code>id</code></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Position</span>: <span class="title">String</span>, <span class="title">Codable</span>, <span class="title">CaseIterable</span>, <span class="title">Identifiable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> id: <span class="type">Position</span> &#123; <span class="keyword">self</span> &#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">left</span></span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">right</span></span><br><span class="line">    <span class="keyword">case</span> bottom</span><br><span class="line">    <span class="keyword">case</span> top</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="The-lesson-learned-here-is-we-need-to-ensure-the-underlying-type-of-selection-in-List-and-id-used-in-ForEach-are-the-same"><a href="#The-lesson-learned-here-is-we-need-to-ensure-the-underlying-type-of-selection-in-List-and-id-used-in-ForEach-are-the-same" class="headerlink" title="The lesson learned here is we need to ensure the underlying type of selection in List and id used  in ForEach are the same"></a>The lesson learned here is we need to ensure the underlying type of <code>selection</code> in <code>List</code> and <code>id</code> used  in <code>ForEach</code> are the same</h2><p><strong>Updated at</strong> 2020-12-23 06:05:08</p>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;p&gt;&lt;strong&gt;Issue &lt;a href=&quot;https://github.com/onmyway133/blog/issues/716&quot;&gt;#716&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;I have an enum that conforms to
        
      
    
    </summary>
    
    
    
      <category term="macOS" scheme="https://onmyway133.github.io/tags/macOS/"/>
    
      <category term="swiftUI" scheme="https://onmyway133.github.io/tags/swiftUI/"/>
    
  </entry>
  
  <entry>
    <title>My year in review 2020</title>
    <link href="https://onmyway133.github.io/blog/My-year-in-review-2020/"/>
    <id>https://onmyway133.github.io/blog/My-year-in-review-2020/</id>
    <published>2020-12-16T19:24:56.000Z</published>
    <updated>2020-12-18T15:57:00.000Z</updated>
    
    <content type="html"><![CDATA[<p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/715">#715</a></strong></p><p>I remember this time last year in December 2019, I spent almost every single bit of my free time on <a href="https://github.com/pumaswift/Puma">Puma</a> because I want a Swift friendly version of fastlane that suits my need and leverages Swift 5 features. </p><p>Here’s my review of my work in year 2020.</p><h2 id="Blogging"><a href="#Blogging" class="headerlink" title="Blogging"></a>Blogging</h2><p>I started blogging on GitHub issue, starting from <a href="https://github.com/onmyway133/blog/issues/1">Issue 1 Hello world, again</a>, now I have over 670 issues, which were generated into blog posts at my website <a href="https://onmyway133.com/">https://onmyway133.com/</a></p><p>🍏 I used to use onmyway133.github.io domain, but then it feels right to have my own domain<br>🍎 I used to write a lot at Medium <a href="https://medium.com/@onmyway133">https://medium.com/@onmyway133</a> for many publications and my own Fantageek publication, I have got 2.3k followers with around 60k views per month<br>🍓 I list my most favorite articles, usually articles that I spent most time polishing here <a href="https://onmyway133.com/writing/">https://onmyway133.com/writing/</a></p><p>One of my very first articles published on Flawless iOS publication was <a href="https://medium.com/flawless-app-stories/a-better-way-to-update-uicollectionview-data-in-swift-with-diff-framework-924db158db86">A better way to update UICollectionView data in Swift with diff framework</a> gets the highest traffic ever, and was rated most trending Swift article for 2018.</p><p>My one of few articles published in Medium in 2019 was <a href="https://medium.com/flawless-app-stories/how-to-make-auto-layout-more-convenient-in-ios-df3b42fed37f">How to make Auto Layout more convenient in iOS</a> got featured in iOS Dev Weekly, and used to promote my library <a href="https://github.com/onmyway133/EasyAnchor">EasyAnchor</a></p><p>My big article this year is <a href="https://onmyway133.com/blog/how-to-test-push-notifications-in-simulator-and-production-ios-apps/">How to test push notifications in simulator and production iOS apps</a>, which was also featured on iOS Dev Weekly, used to summary the changes in push notifications from iOS 7 to iOS 14, and to promote my push notification testing tool <a href="https://twitter.com/pushheroapp">Push Hero</a></p><p>My blog at <a href="https://onmyway133.com/">https://onmyway133.com/</a> has around 15k views each month. I can write proper, lengthy articles to get more views but I don’t want to. I want to write blog about solutions I have found, so that my future self can benefit from it without searching too much.</p><p><img src="https://user-images.githubusercontent.com/2284279/102402948-cfb8fd80-3fe5-11eb-9f7a-b7a85d0ad450.jpeg" alt="views"></p><h2 id="Open-source"><a href="#Open-source" class="headerlink" title="Open source"></a>Open source</h2><p>I have done quite a lot of open source, you can view here <a href="https://onmyway133.com/opensource/">Open source</a>. These have helped tons of apps, with 45k+ apps touched, and 3.4m+ downloads as stats on CocoaPods</p><p>My 4 libraries this year get inspired by SwiftUI and property wrappers</p><p>🍌 <a href="https://github.com/onmyway133/Spek">Spek</a> leverages property wrapper to provide Spec syntax, similar to Quick, but simpler and can generate tests<br>🍈 <a href="https://github.com/onmyway133/Micro">Micro</a> imitates SwiftUI State and ForEach syntax but use UICollectionView with diffable datasource, powered by my another library <a href="https://github.com/onmyway133/DeepDiff">DeepDiff</a><br>🍑 <a href="https://github.com/onmyway133/EasySwiftUI">EasySwiftUI</a> contains many extensions and useful modifier that I use in my SwiftUI apps<br>🥝 <a href="https://github.com/onmyway133/FontAwesomeSwiftUI">FontAwesomeSwiftUI</a> I was tired of using bitmap with dark and light variants, and I can’t use SFSymbols as I want to support macOS 10.15, so FontAwesome is a perfect choice. I couldn’t find library that has support for SwiftUI and easy to use with Swift Package Manager for iOS and macOS, so I made one</p><p>Besides, for all my libraries <a href="https://github.com/onmyway133/EasyStash">EasyStash</a>, <a href="https://github.com/onmyway133/EasyAnchor">EasyAnchor</a>, <a href="https://github.com/onmyway133/EasyTheme">EasyTheme</a>, <a href="https://github.com/onmyway133/EasyClosure">EasyClosure</a>, … I have now support Swift Package Manager, which is nicer to integrate. Thank you CocoaPods for all these years.</p><p>There are now 1.6k people following me on GitHub, that means a lot, meaning somehow my work is useful</p><p>Lately, I open source <a href="https://github.com/onmyway133/awesome-swiftui">awesome-swiftui</a> which I curate all SwiftUI resources, articles and libraries that I find useful for my apps</p><p>❤️ One day, I got sponsor from my dear friend <a href="https://twitter.com/zenangst">Chris</a> for my GitHub open source. Chris is my open source idol who ignited my desire for open source. No one loves open source more than Chris</p><blockquote class="twitter-tweet"><p lang="en" dir="ltr">This means the world to me! If everyone was as lucky as me to just get to inspire one person, the world would be an amazing place. Let&#39;s make it amazing together! Keep rocking because you are amazing &amp; you can bring out the best in others! ❤️ <a href="https://t.co/pJx9obWH7I">https://t.co/pJx9obWH7I</a></p>&mdash; Christoffer Winterkvist (@zenangst) <a href="https://twitter.com/zenangst/status/1309403013237403649?ref_src=twsrc%5Etfw">September 25, 2020</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script><h2 id="Apps"><a href="#Apps" class="headerlink" title="Apps"></a>Apps</h2><p>I started making some apps late last year, first I published them on Gumroad, but it didn’t feel right, and then I published all my apps on AppStore. I like sandboxed apps from AppStore because they limit what the apps can do.</p><p>Apps without Twitter account and landing page seem off, so in May I started revamping my websites, and I wrote my <a href="https://onmyway133.com/apps/">apps</a> page firstly with pure HTML and CSS, then I rewrote in React, because I like React and Javascript.</p><p>Notably, early 2020 I made <a href="https://twitter.com/pushheroapp">Push Hero</a>, <a href="https://twitter.com/PastePalApp">PastePal</a> then I made a complete overhaul lately with more features, thanks to all the feedback. I also took the time to revamp landing pages a lot, you can check landing pages for <a href="https://onmyway133.com/pushhero">Push Hero</a> for example because I have a white label solution</p><p>Learn how I did <a href="https://onmyway133.github.io/blog/How-to-make-white-label-React-app-for-landing-pages/">white label landing page using React</a></p><p>I have a lot of ideas, but very little time.</p><h2 id="Learning"><a href="#Learning" class="headerlink" title="Learning"></a>Learning</h2><p>Coding can be done, but design is never finished. When making apps, I feel like I’m not certain at some design decisions and no matter how I landed with some designs, I didn’t feel happy. Then I took some design courses and books.</p><p>Below is my tweet that I share some design resources that I found useful</p><blockquote class="twitter-tweet"><p lang="en" dir="ltr">Developer with design skill is like tiger with wings. Here are my recommended courses<br><br>The UI Design Bootcamp by <a href="https://twitter.com/designcoursecom?ref_src=twsrc%5Etfw">@designcoursecom</a> a massive UI design course teaches you to build beautiful and well-functioning user interfaces using HTML and CSS.<a href="https://t.co/vfusXamuhJ">https://t.co/vfusXamuhJ</a></p>&mdash; Khoa 🔥 (@onmyway133) <a href="https://twitter.com/onmyway133/status/1320464953548091393?ref_src=twsrc%5Etfw">October 25, 2020</a></blockquote> <h2 id="Listening"><a href="#Listening" class="headerlink" title="Listening"></a>Listening</h2><p>I used to listen to tech podcasts, then I was bored. Discussions like whether to use MVVM vs MVC, SwiftUI vs Catalyst, Swift vs Objective don’t interest me anymore.</p><p>If you ask me for choices, my default answer will be NO. Those who are super passionate about their idea will just ignore my advice and do it anyway.</p><p>Then I listen to indie and product development podcasts, it was inspiring. Once I got the mindset, they also became boring.<br>Now I listen to mostly books on Storytel, some books about habit and making time really make my days.</p><h2 id="Tweet"><a href="#Tweet" class="headerlink" title="Tweet"></a>Tweet</h2><p>I came back to Twitter early this year after quitting it for a while because I got enough of all negative and nonsense political debates. But then I found that I can decide who I can follow and what content I want to view. Then I started organizing List, making my own Chrome extensions to automate things and control what I want to view. I have followed quite many indie developers and great product people, I’ve learnt a lot. The downside is I’m overwhelmingly inspired, I can’t sleep.</p><p>I try to tweet more about what I’ve learned, sharing articles that I have written. For example here I share about how to gain product idea</p><blockquote class="twitter-tweet"><p lang="en" dir="ltr">How to gain product ideas?<br><br>1) Scratch your own itch. If you don&#39;t have any itch to scratch, stop here. This is awkward. Go travelling. Go exploring the world. The world always has problems and needs solution. <a href="https://t.co/07gIoJfJet">pic.twitter.com/07gIoJfJet</a></p>&mdash; Khoa 🔥 (@onmyway133) <a href="https://twitter.com/onmyway133/status/1330399823921557507?ref_src=twsrc%5Etfw">November 22, 2020</a></blockquote><h2 id="WWDC-Together"><a href="#WWDC-Together" class="headerlink" title="WWDC Together"></a>WWDC Together</h2><p>Notable this year is the website I make <a href="https://wwdctogether.com/">WWDC Together</a> as a place for developers like us to hangout and watch videos together. Each video acts like its own chat room, you can also create private chatroom. My colleagues use this and we watched WWDC together with coke and pizza, it was a lot of fun.</p><blockquote class="twitter-tweet"><p lang="en" dir="ltr">I&#39;m excited to launch <a href="https://twitter.com/wwdctogether?ref_src=twsrc%5Etfw">@wwdctogether</a> as a free place to watch and hangout during WWDC. We can now view upcoming and previous sessions via modern playback, with a chatroom for each session. Hope this provides a similar WWDC vibe during this hard time ❤️🔥<a href="https://t.co/0SgGnUAqst">https://t.co/0SgGnUAqst</a> <a href="https://t.co/f9H9wDi62P">pic.twitter.com/f9H9wDi62P</a></p>&mdash; Khoa 🔥 (@onmyway133) <a href="https://twitter.com/onmyway133/status/1273243022826835970?ref_src=twsrc%5Etfw">June 17, 2020</a></blockquote> <p>I had the idea like 2 weeks before WWDC, so I had to make it quick. Working with React is fun to me, it is like playing video game.</p><p>I was lucky to be asked by John to write a guest post <a href="https://wwdcbysundell.com/2020/wwdc-together/">Behind the scenes of WWDC Together with Khoa Pham</a> on his website.</p><p>It was also mentioned by Paul in his WWDC wrap up <a href="https://www.hackingwithswift.com/articles/222/wwdc20-wrap-up-and-recommended-talks">WWDC20: Wrap up and recommended talks</a></p><blockquote><p>One area that absolutely flourished this year was community organization. Sites like <a href="https://wwdcwatch.party">https://wwdcwatch.party</a> and <a href="https://wwdctogether.com">https://wwdctogether.com</a> took a huge amount of work to organize, but meant that people had the chance to have some interaction – had the chance to actually chat about WWDC and share their excitement. I’m really grateful to Michie, Khoa, and other community organizers for making this happen.</p></blockquote><p>I also got to share about in in a well known Norwegian tech website <a href="https://www.kode24.no/kodenytt/norske-wwdc-together-lar-oss-se-pa-apples-konferanse-sammen/72584043">orske WWDC Together lar oss se på Apples konferanse sammen</a></p><h2 id="Speaking"><a href="#Speaking" class="headerlink" title="Speaking"></a>Speaking</h2><p>In 2019, I made several meetup talks, and one pre conf talk for Mobile Era conf</p><blockquote class="twitter-tweet"><p lang="en" dir="ltr">An overview of what we as mobile developers have for <a href="https://twitter.com/hashtag/MachineLearning?src=hash&amp;ref_src=twsrc%5Etfw">#MachineLearning</a> in the session by <a href="https://twitter.com/onmyway133?ref_src=twsrc%5Etfw">@onmyway133</a> at <a href="https://twitter.com/mobileeraconf?ref_src=twsrc%5Etfw">@mobileeraconf</a> Community Evening <a href="https://t.co/bgcE3huGkI">pic.twitter.com/bgcE3huGkI</a></p>&mdash; Mobile Meetup Oslo (@mobileoslo) <a href="https://twitter.com/mobileoslo/status/1192154165751033856?ref_src=twsrc%5Etfw">November 6, 2019</a></blockquote> <p>In 2020, I’m lucky to be invited to talk in some events</p><p>🍅 WWDC Watch Party</p><blockquote class="twitter-tweet"><p lang="en" dir="ltr">Thank you <a href="https://twitter.com/JohnEstropia?ref_src=twsrc%5Etfw">@johnestropia</a> <a href="https://twitter.com/thesunshinejr?ref_src=twsrc%5Etfw">@thesunshinejr</a> <a href="https://twitter.com/onmyway133?ref_src=twsrc%5Etfw">@onmyway133</a> for sharing your experience to the community about Open Source Life and thank you for making our dev life better because of your projects! You are all awesome! ❤️<a href="https://twitter.com/hashtag/WWDCWatchParty?src=hash&amp;ref_src=twsrc%5Etfw">#WWDCWatchParty</a> <a href="https://twitter.com/hashtag/WWDC20?src=hash&amp;ref_src=twsrc%5Etfw">#WWDC20</a> <a href="https://t.co/tfsX7PtKcO">pic.twitter.com/tfsX7PtKcO</a></p>&mdash; wwdcwatchparty (@wwdcwatchparty) <a href="https://twitter.com/wwdcwatchparty/status/1277214349246042112?ref_src=twsrc%5Etfw">June 28, 2020</a></blockquote> <p>I’m happy to be invited by Michie to talk along side with <a href="https://twitter.com/JohnEstropia">John</a> and <a href="https://twitter.com/thesunshinejr">Łukasz</a>, whom I really admire for their awesome open source contribution, to talk about how to start and contribute to open source</p><p>🥦 Bitrise webminar</p><blockquote class="twitter-tweet"><p lang="en" dir="ltr">During the 4th installment of our BUG <a href="https://twitter.com/hashtag/webinar?src=hash&amp;ref_src=twsrc%5Etfw">#webinar</a> series, our main focus was <a href="https://twitter.com/hashtag/iOSDev?src=hash&amp;ref_src=twsrc%5Etfw">#iOSDev</a> and <a href="https://twitter.com/hashtag/WWDC20?src=hash&amp;ref_src=twsrc%5Etfw">#WWDC20</a>. Let&#39;s recap what we discussed with our guests, <a href="https://twitter.com/StuFFmc?ref_src=twsrc%5Etfw">@StuffMC</a>, <a href="https://twitter.com/axbotkin?ref_src=twsrc%5Etfw">@axbotkin</a>, <a href="https://twitter.com/Moatazeldebsy?ref_src=twsrc%5Etfw">@Moatazeldebsy</a>, and <a href="https://twitter.com/onmyway133?ref_src=twsrc%5Etfw">@onmyway133</a> in our freshest blog post! ✨🔥<a href="https://t.co/rrA8cyYXus">https://t.co/rrA8cyYXus</a></p>&mdash; Bitrise (@bitrise) <a href="https://twitter.com/bitrise/status/1283431144726368258?ref_src=twsrc%5Etfw">July 15, 2020</a></blockquote> <p>I shared my thoughts about my favorites at WWDC and the future ahead</p><p>🍇 Contributing.today</p><p>During Hacktoberfest 2020, I was contacted by my friend <a href="https://twitter.com/webmaxru">Maxim</a> to share about open source </p><blockquote class="twitter-tweet"><p lang="en" dir="ltr">I had a pleasure to interview <a href="https://twitter.com/hashtag/OSS?src=hash&amp;ref_src=twsrc%5Etfw">#OSS</a> contributors from Norway <a href="https://twitter.com/DrMowinckels?ref_src=twsrc%5Etfw">@DrMowinckels</a> and <a href="https://twitter.com/onmyway133?ref_src=twsrc%5Etfw">@onmyway133</a> for CONTRIBUTING project. October 2nd we kickoff <a href="https://twitter.com/hashtag/Hacktoberfest?src=hash&amp;ref_src=twsrc%5Etfw">#Hacktoberfest</a> by online meetup about getting started with Open Source at 16:00 CEST. Join our sessions &amp; workshops: <a href="https://t.co/hKkMKEOJJe">https://t.co/hKkMKEOJJe</a> <a href="https://t.co/1yr2AhQ4B6">https://t.co/1yr2AhQ4B6</a></p>&mdash; Maxim Salnikov (@webmaxru) <a href="https://twitter.com/webmaxru/status/1311674525604622337?ref_src=twsrc%5Etfw">October 1, 2020</a></blockquote><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script><h2 id="Work"><a href="#Work" class="headerlink" title="Work"></a>Work</h2><p>I’m happy to continue another awesome year at Shortcut and DNB, where I have awesome and super nice colleagues. I ‘ve made lots of friends who I can talk with, who invited me to play badminton, tennis, football, swimming, hiking. Why didn’t we meet earlier?</p><p>I was lucky to attend a workshop hosted by John Sundell at work, I learned a lot</p><blockquote class="twitter-tweet"><p lang="en" dir="ltr">Ran my first ever large-scale remote workshop today, with over 25 participants, 10 different ongoing video calls for pair programming, and a ton of live coding 😀 Was so much fun!<br><br>Thanks a lot to the wonderful team at <a href="https://twitter.com/shortcut_no?ref_src=twsrc%5Etfw">@shortcut_no</a> for inviting me 😊 <a href="https://t.co/CE4P8Slo1G">https://t.co/CE4P8Slo1G</a></p>&mdash; John Sundell (@johnsundell) <a href="https://twitter.com/johnsundell/status/1298992825422327808?ref_src=twsrc%5Etfw">August 27, 2020</a></blockquote><h2 id="Life"><a href="#Life" class="headerlink" title="Life"></a>Life</h2><p>Thanks for a memorable year, despite all the lockdown. And remember, balance work and life. You don’t need to be super rich to be happy. Having lots of money in the bank while living alone is not fun at all.</p><p>Another year is coming to an end. When looking back, do you miss the time you didn’t spend with your friends and family, or do you miss the time you didn’t get to do your work?</p><h2 id="May-your-code-continue-to-compile-🙏"><a href="#May-your-code-continue-to-compile-🙏" class="headerlink" title="May your code continue to compile 🙏"></a>May your code continue to compile 🙏</h2><p><strong>Updated at</strong> 2020-12-18 16:57:00</p>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;p&gt;&lt;strong&gt;Issue &lt;a href=&quot;https://github.com/onmyway133/blog/issues/715&quot;&gt;#715&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;I remember this time last year in
        
      
    
    </summary>
    
    
    
      <category term="life" scheme="https://onmyway133.github.io/tags/life/"/>
    
  </entry>
  
  <entry>
    <title>How to do didSet for State and Binding in SwiftUI</title>
    <link href="https://onmyway133.github.io/blog/How-to-do-didSet-for-State-and-Binding-in-SwiftUI/"/>
    <id>https://onmyway133.github.io/blog/How-to-do-didSet-for-State-and-Binding-in-SwiftUI/</id>
    <published>2020-12-16T04:30:50.000Z</published>
    <updated>2020-12-16T18:27:35.000Z</updated>
    
    <content type="html"><![CDATA[<p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/714">#714</a></strong></p><p>Below is an example of a parent <code>ContentView</code> with <code>State</code> and a child <code>Sidebar</code> with a <code>Binding</code>.</p><p>The <code>didSet</code> is only called for the property that is changed. </p><p>When we click <code>Button in ContentView</code>, that changes <code>State</code> property, so only the <code>didSet</code> in <code>ContentView</code> is called<br>When we click <code>Button in Sidebar</code>, that changes <code>Binding</code> property, so only the <code>didSet</code> in <code>Sidebar</code> is called</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Tag</span>: <span class="title">String</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> all</span><br><span class="line">    <span class="keyword">case</span> settings</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ContentView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    @<span class="type">State</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> tag: <span class="type">Tag</span> = .all &#123;</span><br><span class="line">        <span class="keyword">didSet</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"ContentView \(tag)"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Sidebar</span>(tag: $tag)</span><br><span class="line">        <span class="type">Button</span>(action: &#123; tag = .settings &#125;) &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">"Button in ContentView"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Sidebar</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    @<span class="type">Binding</span></span><br><span class="line">    <span class="keyword">var</span> tag: <span class="type">Tag</span> &#123;</span><br><span class="line">        <span class="keyword">didSet</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"Sidebar \(tag)"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(tag.rawValue)</span><br><span class="line">        <span class="type">Button</span>(action: &#123; tag = .settings &#125;) &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">"Button in Sidebar"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Custom-Binding-with-get-set"><a href="#Custom-Binding-with-get-set" class="headerlink" title="Custom Binding with get set"></a>Custom Binding with get set</h3><p>Another way to observe Binding changes is to use custom <code>Binding</code> with <code>get, set</code>. Here even if we click <code>Button in ContentView</code>, the <code>set</code> block is triggered and here we can change <code>State</code></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> body: some <span class="type">View</span> &#123;</span><br><span class="line">    <span class="type">Sidebar</span>(tag: <span class="type">Binding</span>&lt;<span class="type">Tag</span>&gt;(</span><br><span class="line">        <span class="keyword">get</span>: &#123; tag &#125;,</span><br><span class="line">        <span class="keyword">set</span>: &#123; newTag <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">self</span>.tag = newTag</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"ContentView newTag \(newTag)"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    ))</span><br><span class="line">    <span class="type">Button</span>(action: &#123; tag = .settings &#125;) &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">"Button in ContentView"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Convenient-new-Binding"><a href="#Convenient-new-Binding" class="headerlink" title="Convenient new Binding"></a>Convenient new Binding</h3><p>We can also make convenient extension on Binding to return new <code>Binding</code>, with a hook allowing us to inspect newValue. So we can call like <code>Sidebar(tag: $tag.didSet</code></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Binding</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">didSet</span><span class="params">(<span class="number">_</span> <span class="keyword">didSet</span>: @escaping <span class="params">(Value)</span></span></span> -&gt; <span class="type">Void</span>) -&gt; <span class="type">Binding</span>&lt;<span class="type">Value</span>&gt; &#123;</span><br><span class="line">        <span class="type">Binding</span>(</span><br><span class="line">            <span class="keyword">get</span>: &#123; wrappedValue &#125;,</span><br><span class="line">            <span class="keyword">set</span>: &#123; newValue <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">self</span>.wrappedValue = newValue</span><br><span class="line">                <span class="keyword">didSet</span>(newValue)</span><br><span class="line">            &#125;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ContentView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    @<span class="type">State</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> tag: <span class="type">Tag</span> = .all &#123;</span><br><span class="line">        <span class="keyword">didSet</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"ContentView \(tag)"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Sidebar</span>(tag: $tag.<span class="keyword">didSet</span> &#123; newValue <span class="keyword">in</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"ContentView newTag \(newValue)"</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="type">Button</span>(action: &#123; tag = .settings &#125;) &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">"Button in ContentView"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p><strong>Updated at</strong> 2020-12-16 19:27:35</p>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;p&gt;&lt;strong&gt;Issue &lt;a href=&quot;https://github.com/onmyway133/blog/issues/714&quot;&gt;#714&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Below is an example of a parent
        
      
    
    </summary>
    
    
    
      <category term="swift" scheme="https://onmyway133.github.io/tags/swift/"/>
    
      <category term="swiftUI" scheme="https://onmyway133.github.io/tags/swiftUI/"/>
    
  </entry>
  
  <entry>
    <title>How to add toolbar programatically in macOS</title>
    <link href="https://onmyway133.github.io/blog/How-to-add-toolbar-programatically-in-macOS/"/>
    <id>https://onmyway133.github.io/blog/How-to-add-toolbar-programatically-in-macOS/</id>
    <published>2020-12-15T04:18:34.000Z</published>
    <updated>2020-12-15T04:18:34.000Z</updated>
    
    <content type="html"><![CDATA[<p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/713">#713</a></strong></p><p>To setup toolbar, we need to implement <code>NSToolbarDelegate</code> that provides toolbar items. This delegate is responsible for many things</p><ul><li>Set visible and allowed items with <code>toolbarDefaultItemIdentifiers</code></li><li>Provide item with <code>itemForItemIdentifier</code></li><li>Being notified with <code>toolbarWillAddItem</code> and <code>toolbarDidRemoveItem</code></li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">window.toolbarStyle = .unifiedCompact</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> toolbar = <span class="type">NSToolbar</span>(identifier: <span class="string">"Toolbar"</span>)</span><br><span class="line">toolbar.displayMode = .iconAndLabel</span><br><span class="line">toolbar.delegate = (<span class="type">NSApp</span>.delegate <span class="keyword">as</span>! <span class="type">AppDelegate</span>)</span><br><span class="line">toolbar.insertItem(withItemIdentifier: .add, at: <span class="number">0</span>)</span><br><span class="line">toolbar.insertItem(withItemIdentifier: .settings, at: <span class="number">1</span>)</span><br><span class="line">window.toolbar = toolbar</span><br></pre></td></tr></table></figure><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">NSToolbarItem</span>.<span class="title">Identifier</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> add = <span class="type">NSToolbarItem</span>.<span class="type">Identifier</span>(rawValue: <span class="string">"Add"</span>)</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> settings = <span class="type">NSToolbarItem</span>.<span class="type">Identifier</span>(rawValue: <span class="string">"Settings"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">AppDelegate</span>: <span class="title">NSToolbarDelegate</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">toolbar</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="number">_</span> toolbar: NSToolbar,</span></span></span><br><span class="line"><span class="function"><span class="params">        itemForItemIdentifier itemIdentifier: NSToolbarItem.Identifier,</span></span></span><br><span class="line"><span class="function"><span class="params">        willBeInsertedIntoToolbar flag: Bool</span></span></span><br><span class="line"><span class="function"><span class="params">    )</span></span> -&gt; <span class="type">NSToolbarItem?</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> itemIdentifier &#123;</span><br><span class="line">        <span class="keyword">case</span> .add:</span><br><span class="line">            <span class="keyword">let</span> item = <span class="type">NSToolbarItem</span>(itemIdentifier: itemIdentifier)</span><br><span class="line">            item.label = <span class="string">"Add"</span></span><br><span class="line">            item.image = <span class="type">NSImage</span>(named: <span class="type">NSImage</span>.<span class="type">Name</span>(<span class="string">"add"</span>))</span><br><span class="line">            <span class="keyword">let</span> menuItem: <span class="type">NSMenuItem</span> = <span class="type">NSMenuItem</span>()</span><br><span class="line">            menuItem.submenu = <span class="literal">nil</span></span><br><span class="line">            menuItem.title = <span class="string">"Add"</span></span><br><span class="line">            item.menuFormRepresentation = menuItem</span><br><span class="line">            item.toolTip = <span class="string">"Click here to add new entry"</span></span><br><span class="line">            <span class="keyword">return</span> item</span><br><span class="line">        <span class="keyword">case</span> .settings:</span><br><span class="line">            <span class="keyword">let</span> item = <span class="type">NSToolbarItem</span>(itemIdentifier: itemIdentifier)</span><br><span class="line">            item.label = <span class="string">"Settings"</span></span><br><span class="line">            <span class="keyword">let</span> button = <span class="type">NSButton</span>(image: <span class="type">NSImage</span>(named: <span class="type">NSImage</span>.<span class="type">Name</span>(<span class="string">"gear"</span>))!, target: <span class="literal">nil</span>, action: <span class="literal">nil</span>)</span><br><span class="line">            button.bezelStyle = .texturedRounded</span><br><span class="line">            item.view = button</span><br><span class="line">            <span class="keyword">return</span> item</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">toolbarDefaultItemIdentifiers</span><span class="params">(<span class="number">_</span> toolbar: NSToolbar)</span></span> -&gt; [<span class="type">NSToolbarItem</span>.<span class="type">Identifier</span>] &#123;</span><br><span class="line">        [.add, .settings]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">toolbarAllowedItemIdentifiers</span><span class="params">(<span class="number">_</span> toolbar: NSToolbar)</span></span> -&gt; [<span class="type">NSToolbarItem</span>.<span class="type">Identifier</span>] &#123;</span><br><span class="line">        [.add, .settings]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Read-more"><a href="#Read-more" class="headerlink" title="Read more"></a>Read more</h2><ul><li><a href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Toolbars/Tasks/AddRemoveToolbarItems.html">Adding and Removing Toolbar Items</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;p&gt;&lt;strong&gt;Issue &lt;a href=&quot;https://github.com/onmyway133/blog/issues/713&quot;&gt;#713&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;To setup toolbar, we need to implement
        
      
    
    </summary>
    
    
    
      <category term="swift" scheme="https://onmyway133.github.io/tags/swift/"/>
    
      <category term="macOS" scheme="https://onmyway133.github.io/tags/macOS/"/>
    
  </entry>
  
  <entry>
    <title>How to declare network Error with enum in Swift</title>
    <link href="https://onmyway133.github.io/blog/How-to-declare-network-Error-with-enum-in-Swift/"/>
    <id>https://onmyway133.github.io/blog/How-to-declare-network-Error-with-enum-in-Swift/</id>
    <published>2020-12-14T10:17:31.000Z</published>
    <updated>2020-12-14T10:17:31.000Z</updated>
    
    <content type="html"><![CDATA[<p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/712">#712</a></strong></p><p>Describe all possible paths in your program with enum. This is great to track down bugs and to not miss representing potential cases in UI. Errors can come from app layer, backend layer to network issues.</p><p>Enum is handy in both UIKit and SwiftUI</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">NetworkError</span>: <span class="title">Swift</span>.<span class="title">Error</span> </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">enum</span> <span class="title">RequestError</span> </span>&#123;</span><br><span class="line">        <span class="keyword">case</span> invalidRequest(<span class="type">URLRequest</span>)</span><br><span class="line">        <span class="keyword">case</span> encodingError(<span class="type">Swift</span>.<span class="type">EncodingError</span>)</span><br><span class="line">        <span class="keyword">case</span> other(<span class="type">NSError</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">enum</span> <span class="title">ServerError</span> </span>&#123;</span><br><span class="line">        <span class="keyword">case</span> decodingError(<span class="type">Swift</span>.<span class="type">DecodingError</span>)</span><br><span class="line">        <span class="keyword">case</span> noInternetConnection</span><br><span class="line">        <span class="keyword">case</span> timeout</span><br><span class="line">        <span class="keyword">case</span> internalServerError</span><br><span class="line">        <span class="keyword">case</span> other(statusCode: <span class="type">Int</span>, response: <span class="type">HTTPURLResponse</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> requestError(<span class="type">RequestError</span>)</span><br><span class="line">    <span class="keyword">case</span> serverError(<span class="type">ServerError</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>and note that Foundation has <code>NSError</code> with a bunch of well defined error code ready to use. We can use this before introduce our custom error cases</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">var</span> <span class="type">NSURLErrorUnknown</span>: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">var</span> <span class="type">NSURLErrorCancelled</span>: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">var</span> <span class="type">NSURLErrorBadURL</span>: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">var</span> <span class="type">NSURLErrorTimedOut</span>: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">var</span> <span class="type">NSURLErrorUnsupportedURL</span>: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">var</span> <span class="type">NSURLErrorCannotFindHost</span>: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">var</span> <span class="type">NSURLErrorCannotConnectToHost</span>: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">var</span> <span class="type">NSURLErrorNetworkConnectionLost</span>: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">var</span> <span class="type">NSURLErrorDNSLookupFailed</span>: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">var</span> <span class="type">NSURLErrorHTTPTooManyRedirects</span>: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">var</span> <span class="type">NSURLErrorResourceUnavailable</span>: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">var</span> <span class="type">NSURLErrorNotConnectedToInternet</span>: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">var</span> <span class="type">NSURLErrorRedirectToNonExistentLocation</span>: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">var</span> <span class="type">NSURLErrorBadServerResponse</span>: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">var</span> <span class="type">NSURLErrorUserCancelledAuthentication</span>: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">var</span> <span class="type">NSURLErrorUserAuthenticationRequired</span>: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">var</span> <span class="type">NSURLErrorZeroByteResource</span>: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">var</span> <span class="type">NSURLErrorCannotDecodeRawData</span>: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">var</span> <span class="type">NSURLErrorCannotDecodeContentData</span>: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">var</span> <span class="type">NSURLErrorCannotParseResponse</span>: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;p&gt;&lt;strong&gt;Issue &lt;a href=&quot;https://github.com/onmyway133/blog/issues/712&quot;&gt;#712&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Describe all possible paths in your
        
      
    
    </summary>
    
    
    
      <category term="swift" scheme="https://onmyway133.github.io/tags/swift/"/>
    
  </entry>
  
  <entry>
    <title>How to programatically select row in List in SwiftUI</title>
    <link href="https://onmyway133.github.io/blog/How-to-programatically-select-row-in-List-in-SwiftUI/"/>
    <id>https://onmyway133.github.io/blog/How-to-programatically-select-row-in-List-in-SwiftUI/</id>
    <published>2020-12-13T18:54:22.000Z</published>
    <updated>2020-12-13T18:54:22.000Z</updated>
    
    <content type="html"><![CDATA[<p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/711">#711</a></strong></p><p><code>List</code> has a selection parameter where we can pass selection binding. As we can see here <code>selection</code> is of type optional <code>Binding&lt;Set&lt;SelectionValue&gt;&gt;?</code> where <code>SelectionValue</code> is any thing conforming to <code>Hasable</code></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@available</span>(iOS <span class="number">13.0</span>, macOS <span class="number">10.15</span>, tvOS <span class="number">13.0</span>, watchOS <span class="number">6.0</span>, *)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">List</span>&lt;<span class="title">SelectionValue</span>, <span class="title">Content</span>&gt; : <span class="title">View</span> <span class="title">where</span> <span class="title">SelectionValue</span> : <span class="title">Hashable</span>, <span class="title">Content</span> : <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="meta">@available</span>(watchOS, unavailable)</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">init</span>(selection: <span class="type">Binding</span>&lt;<span class="type">Set</span>&lt;<span class="type">SelectionValue</span>&gt;&gt;?, @<span class="type">ViewBuilder</span> content: () -&gt; <span class="type">Content</span>)</span><br></pre></td></tr></table></figure><p>So we can programatically control selection by tagging row with our own <code>Tag</code></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SideView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">enum</span> <span class="title">Tag</span>: <span class="title">String</span>, <span class="title">Hashable</span> </span>&#123;</span><br><span class="line">        <span class="keyword">case</span> all</span><br><span class="line">        <span class="keyword">case</span> settings</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @<span class="type">State</span></span><br><span class="line">    <span class="keyword">var</span> selection: <span class="type">Tag?</span> = .all</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">List</span> &#123;</span><br><span class="line">            all</span><br><span class="line">                .tag(<span class="type">Tag</span>.all)</span><br><span class="line">            categories</span><br><span class="line">            settings</span><br><span class="line">                .tag(<span class="type">Tag</span>.settings)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;p&gt;&lt;strong&gt;Issue &lt;a href=&quot;https://github.com/onmyway133/blog/issues/711&quot;&gt;#711&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;List&lt;/code&gt; has a selection
        
      
    
    </summary>
    
    
    
      <category term="swift" scheme="https://onmyway133.github.io/tags/swift/"/>
    
      <category term="swiftUI" scheme="https://onmyway133.github.io/tags/swiftUI/"/>
    
  </entry>
  
  <entry>
    <title>How to show sidebar in SwiftUI for macOS</title>
    <link href="https://onmyway133.github.io/blog/How-to-show-sidebar-in-SwiftUi-for-macOS/"/>
    <id>https://onmyway133.github.io/blog/How-to-show-sidebar-in-SwiftUi-for-macOS/</id>
    <published>2020-12-13T18:01:59.000Z</published>
    <updated>2020-12-14T14:38:19.000Z</updated>
    
    <content type="html"><![CDATA[<p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/710">#710</a></strong></p><p>Starting from macOS 11, we can use <code>List</code> with <code>SidebarListStyle</code> inside <code>NavigationView</code> to declare master detail view. The <code>SidebarListStyle</code> makes list translucent. It automatically handles selection and marks selected row in list with accent color.</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">MainView</span>: <span class="title">some</span> <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> body: some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">NavigationView</span> &#123;</span><br><span class="line">            sidebar</span><br><span class="line">            <span class="type">ContentView</span>()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> sidebar: some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">List</span> &#123;</span><br><span class="line">            <span class="type">Group</span> &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">"Categories"</span>)</span><br><span class="line">                    .foregroundColor(.gray)</span><br><span class="line">                <span class="type">ForEach</span>(categories) &#123; category <span class="keyword">in</span></span><br><span class="line">                    <span class="type">NavigationLink</span>(destination: <span class="type">ContentView</span>(category: category)) &#123;</span><br><span class="line">                        <span class="type">Label</span>(category.name, systemImage: <span class="string">"message"</span>)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="type">Divider</span>()</span><br><span class="line">            <span class="type">NavigationLink</span>(destination: <span class="type">SettingsView</span>()) &#123;</span><br><span class="line">                <span class="type">Label</span>(<span class="string">"Settings"</span>, systemImage: <span class="string">"gear"</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        .listStyle(<span class="type">SidebarListStyle</span>())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>To toggle side bar, we can use <code>toggleSidebar</code> selector since for now, sidebar is backed by <code>NSSplitViewController</code></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mainWindow.firstResponder?.tryToPerform(#selector(<span class="type">NSSplitViewController</span>.toggleSidebar(<span class="number">_</span>:)), with: <span class="literal">nil</span>)</span><br></pre></td></tr></table></figure><p>We can specify tool bar items on either sidebar or content.</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.toolbar&#123;</span><br><span class="line">    <span class="comment">//Toggle Sidebar Button</span></span><br><span class="line">    <span class="type">ToolbarItem</span>(placement: .navigation)&#123;</span><br><span class="line">        <span class="type">Button</span>(action: toggleSidebar) &#123;</span><br><span class="line">            <span class="type">Image</span>(systemName: <span class="string">"sidebar.left"</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>For tool bar to work, we must use <code>App</code> and embed views inside <code>WindowGroup</code></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@main</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">AppWithSidebarAndToolbar</span>: <span class="title">App</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> body: some <span class="type">Scene</span> &#123;</span><br><span class="line">        <span class="type">WindowGroup</span> &#123;</span><br><span class="line">            <span class="type">MainView</span>()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p><strong>Updated at</strong> 2020-12-14 15:38:19</p>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;p&gt;&lt;strong&gt;Issue &lt;a href=&quot;https://github.com/onmyway133/blog/issues/710&quot;&gt;#710&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Starting from macOS 11, we can use
        
      
    
    </summary>
    
    
    
      <category term="macOS" scheme="https://onmyway133.github.io/tags/macOS/"/>
    
      <category term="swiftUI" scheme="https://onmyway133.github.io/tags/swiftUI/"/>
    
  </entry>
  
  <entry>
    <title>How to mock UNNotificationResponse in unit tests</title>
    <link href="https://onmyway133.github.io/blog/How-to-mock-UNNotificationResponse-in-unit-tests/"/>
    <id>https://onmyway133.github.io/blog/How-to-mock-UNNotificationResponse-in-unit-tests/</id>
    <published>2020-12-07T10:24:19.000Z</published>
    <updated>2020-12-07T10:49:55.000Z</updated>
    
    <content type="html"><![CDATA[<p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/708">#708</a></strong></p><p>The best way to test is to not have to mock at all. The second best way is to have your own abstraction over the things you would like to test, either it is in form of protocol or some function injection.</p><p>But in case you want a quick way to test things, and want to test as real as possible, then for some cases we can be creative to mock the real objects.</p><p>One practical example is when we have some logic to handle notification, either showing or deep link user to certain screen. From iOS 10, notifications are to be delivered via <code>UNUserNotificationCenterDelegate</code></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@available</span>(iOS <span class="number">10.0</span>, *)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">protocol</span> <span class="title">UNUserNotificationCenterDelegate</span> : <span class="title">NSObjectProtocol</span> </span>&#123;</span><br><span class="line">    <span class="meta">@available</span>(iOS <span class="number">10.0</span>, *)</span><br><span class="line">    <span class="keyword">optional</span> <span class="function"><span class="keyword">func</span> <span class="title">userNotificationCenter</span><span class="params">(<span class="number">_</span> center: UNUserNotificationCenter, didReceive response: UNNotificationResponse, withCompletionHandler completionHandler: @escaping <span class="params">()</span></span></span> -&gt; <span class="type">Void</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>and all we get is <code>UNNotificationResponse</code> which has no real way to construct it.</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@available</span>(iOS <span class="number">10.0</span>, *)</span><br><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">UNNotificationResponse</span> : <span class="title">NSObject</span>, <span class="title">NSCopying</span>, <span class="title">NSSecureCoding</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// The notification to which the user responded.</span></span><br><span class="line">    <span class="meta">@NSCopying</span> <span class="keyword">open</span> <span class="keyword">var</span> notification: <span class="type">UNNotification</span> &#123; <span class="keyword">get</span> &#125;</span><br></pre></td></tr></table></figure><p>That class inherits from <code>NSCopying</code> which means it is constructed from <code>NSCoder</code>, but how do we init it?</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> response = <span class="type">UNNotificationResponse</span>(coder: ???)</span><br></pre></td></tr></table></figure><h2 id="NSObject-and-NSCoder"><a href="#NSObject-and-NSCoder" class="headerlink" title="NSObject and NSCoder"></a>NSObject and NSCoder</h2><p>The trick is, since <code>UNNotificationResponse</code> is <code>NSObject</code> subclass, it is key value compliant, and since it is also <code>NSCopying</code> compliant, we can make a mock coder to construct it</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">KeyedArchiver</span>: <span class="title">NSKeyedArchiver</span> </span>&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">decodeObject</span><span class="params">(forKey <span class="number">_</span>: String)</span></span> -&gt; <span class="type">Any</span> &#123; <span class="string">""</span> &#125;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">decodeInt64</span><span class="params">(forKey key: String)</span></span> -&gt; <span class="type">Int64</span> &#123; <span class="number">0</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>On iOS 12, we need to add <code>decodeInt64</code> method, otherwise <code>UNNotificationResponse</code> init fails. This is not needed on iOS 14</p><p><code>UNNotificationResponse</code> has a read only <code>UNNotification</code>, which has a readonly <code>UNNotificationRequest</code>, which can be constructed from a <code>UNNotificationContent</code></p><p>Luckily <code>UNNotificationContent</code> has a counterpart <code>UNMutableNotificationContent</code></p><p>Now we can make a simple extension on <code>UNNotificationResponse</code> to quickly create that object in tests</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">extension</span> <span class="title">UNNotificationResponse</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">with</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        userInfo: [AnyHashable: <span class="keyword">Any</span>],</span></span></span><br><span class="line"><span class="function"><span class="params">        actionIdentifier: String = UNNotificationDefaultActionIdentifier</span></span></span><br><span class="line"><span class="function"><span class="params">    )</span></span> <span class="keyword">throws</span> -&gt; <span class="type">UNNotificationResponse</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> content = <span class="type">UNMutableNotificationContent</span>()</span><br><span class="line">        content.userInfo = userInfo</span><br><span class="line">        <span class="keyword">let</span> request = <span class="type">UNNotificationRequest</span>(</span><br><span class="line">            identifier: <span class="string">""</span>,</span><br><span class="line">            content: content,</span><br><span class="line">            trigger: <span class="literal">nil</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> notification = <span class="keyword">try</span> <span class="type">XCTUnwrap</span>(<span class="type">UNNotification</span>(coder: <span class="type">KeyedArchiver</span>()))</span><br><span class="line">        notification.setValue(request, forKey: <span class="string">"request"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> response = <span class="keyword">try</span> <span class="type">XCTUnwrap</span>(<span class="type">UNNotificationResponse</span>(coder: <span class="type">KeyedArchiver</span>()))</span><br><span class="line">        response.setValue(notification, forKey: <span class="string">"notification"</span>)</span><br><span class="line">        response.setValue(actionIdentifier, forKey: <span class="string">"actionIdentifier"</span>)</span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>We can then test like normal</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">testResponse</span><span class="params">()</span></span> <span class="keyword">throws</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> data: [<span class="type">AnyHashable</span>: <span class="type">Any</span>] = [</span><br><span class="line">        <span class="string">"data"</span>: [</span><br><span class="line">            <span class="string">"type"</span>: <span class="string">"OPEN_ARTICLE"</span>,</span><br><span class="line">            <span class="string">"articleId"</span>: <span class="string">"1"</span>,</span><br><span class="line">            <span class="string">"articleType"</span>: <span class="string">"Fiction"</span>,</span><br><span class="line">            <span class="string">"articleTag"</span>: <span class="string">"1"</span></span><br><span class="line">        ]</span><br><span class="line">    ]</span><br><span class="line">    <span class="keyword">let</span> response = <span class="keyword">try</span> <span class="type">UNNotificationResponse</span>.with(userInfo: data)</span><br><span class="line">    <span class="keyword">let</span> centerDelegate = <span class="type">ArticleCenterDelegate</span>()</span><br><span class="line">    centerDelegate.userNotificationCenter(</span><br><span class="line">        <span class="type">UNUserNotificationCenter</span>.current(),</span><br><span class="line">        didReceive: response,</span><br><span class="line">        withCompletionHandler: &#123;&#125;</span><br><span class="line">    )</span><br><span class="line">    <span class="type">XCTAssertEqual</span>(response.notification.request.content.userInfo[<span class="string">"type"</span>], <span class="string">"OPEN_ARTICLE"</span>)</span><br><span class="line">    <span class="type">XCTAssertEqual</span>(centerDelegate.didOpenArticle, <span class="literal">true</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="decodeObject-for-key"><a href="#decodeObject-for-key" class="headerlink" title="decodeObject for key"></a>decodeObject for key</h2><p>Another way is to build a proper <code>KeyedArchiver</code> that checks key and return correct property. Note that we can reuse the same <code>NSKeyedArchiver</code> to nested properties.</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">KeyedArchiver</span>: <span class="title">NSKeyedArchiver</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> request: <span class="type">UNNotificationRequest</span></span><br><span class="line">    <span class="keyword">let</span> actionIdentifier: <span class="type">String</span></span><br><span class="line">    <span class="keyword">let</span> notification: <span class="type">UNNotification</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">decodeObject</span><span class="params">(forKey key: String)</span></span> -&gt; <span class="type">Any?</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> key &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">"request"</span>:</span><br><span class="line">            <span class="keyword">return</span> request</span><br><span class="line">        <span class="keyword">case</span> <span class="string">"actionIdentifier"</span>:</span><br><span class="line">            <span class="keyword">return</span> actionIdentifier</span><br><span class="line">        <span class="keyword">case</span> <span class="string">"notification"</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="type">UNNotification</span>(coder: <span class="keyword">self</span>)</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p><strong>Updated at</strong> 2020-12-07 11:49:55</p>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;p&gt;&lt;strong&gt;Issue &lt;a href=&quot;https://github.com/onmyway133/blog/issues/708&quot;&gt;#708&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;The best way to test is to not have to
        
      
    
    </summary>
    
    
    
      <category term="swift" scheme="https://onmyway133.github.io/tags/swift/"/>
    
      <category term="testing" scheme="https://onmyway133.github.io/tags/testing/"/>
    
  </entry>
  
  <entry>
    <title>How to support right click menu to NSStatusItem</title>
    <link href="https://onmyway133.github.io/blog/How-to-support-right-click-menu-to-NSStatusItem/"/>
    <id>https://onmyway133.github.io/blog/How-to-support-right-click-menu-to-NSStatusItem/</id>
    <published>2020-12-07T05:16:58.000Z</published>
    <updated>2020-12-08T04:11:24.000Z</updated>
    
    <content type="html"><![CDATA[<p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/707">#707</a></strong></p><p>The trick is to set the button oinside of <code>statusItem</code> to send actions on both <code>leftMouseUp</code> and <code>rightMouseUp</code>.</p><p>Another thing to note is we use <code>popUpMenu</code> on <code>NSStatusItem</code>, although it is marked as deprecated on macOS 10.14. We can set <code>menu</code> but that overrides left click. </p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Omnia</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">let</span> statusItem = <span class="type">NSStatusBar</span>.system.statusItem(withLength: <span class="type">NSStatusItem</span>.squareLength)</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">let</span> statusItemMenuHandler = <span class="type">MenuHandler</span>()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">setupStatusMenu</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> button = statusItem.button &#123;</span><br><span class="line">        button.image = <span class="type">NSImage</span>(named: <span class="type">NSImage</span>.<span class="type">Name</span>(<span class="string">"statusMenuIcon"</span>))</span><br><span class="line">        button.contentTintColor = <span class="type">NSColor</span>.black</span><br><span class="line">        button.action = #selector(statusMenuButtonTouched(<span class="number">_</span>:))</span><br><span class="line">        button.sendAction(on: [.leftMouseUp, .rightMouseUp]) <span class="comment">// This is important</span></span><br><span class="line"></span><br><span class="line">        statusItemMenuHandler.add(title: <span class="string">"About"</span>, action: &#123;</span><br><span class="line">            <span class="type">NSWorkspace</span>.shared.<span class="keyword">open</span>(<span class="type">URL</span>(string: <span class="string">"https://onmyway133.com/pushhero"</span>)!)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@objc</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">statusMenuButtonTouched</span><span class="params">(<span class="number">_</span> sender: NSStatusBarButton)</span></span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> event = <span class="type">NSApp</span>.currentEvent <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">    <span class="keyword">switch</span> event.type &#123;</span><br><span class="line">    <span class="keyword">case</span> .rightMouseUp:</span><br><span class="line">        statusItem.popUpMenu(statusItemMenuHandler.menu)</span><br><span class="line">        <span class="comment">// statusItem.menu = statusItemMenuHandler.menu // this overrides left click</span></span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        popover.toggle()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p><strong>Updated at</strong> 2020-12-08 05:11:24</p>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;p&gt;&lt;strong&gt;Issue &lt;a href=&quot;https://github.com/onmyway133/blog/issues/707&quot;&gt;#707&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;The trick is to set the button oinside of
        
      
    
    </summary>
    
    
    
      <category term="swift" scheme="https://onmyway133.github.io/tags/swift/"/>
    
      <category term="macOS" scheme="https://onmyway133.github.io/tags/macOS/"/>
    
  </entry>
  
</feed>
