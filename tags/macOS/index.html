<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="generator" content="Hexo 4.2.0"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Tag: macOS - onmyway133</title><meta description="What you don&amp;#39;t know is what you haven&amp;#39;t learned"><meta property="og:type" content="blog"><meta property="og:title" content="onmyway133"><meta property="og:url" content="https://onmyway133.github.io/"><meta property="og:site_name" content="onmyway133"><meta property="og:description" content="What you don&amp;#39;t know is what you haven&amp;#39;t learned"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://onmyway133.github.io/img/og_image.png"><meta property="article:author" content="Khoa Pham"><meta property="article:tag" content="ios"><meta property="article:tag" content=" android"><meta property="article:tag" content="javascript"><meta property="article:tag" content=" react"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><meta property="twitter:creator" content="@onmyway133"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://onmyway133.github.io"},"headline":"onmyway133","image":["https://onmyway133.github.io/img/og_image.png"],"author":{"@type":"Person","name":"Khoa Pham"},"description":"What you don&#39;t know is what you haven&#39;t learned"}</script><link rel="alternative" href="/atom.xml" title="onmyway133" type="application/atom+xml"><link rel="icon" href="/img/favicon.ico"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=UA-40119591-5" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'UA-40119591-5');</script><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><script data-ad-client="ca-pub-3656459401405265" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" async></script></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/z.png" alt="onmyway133" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/apps">Apps</a><a class="navbar-item" href="/gumroad">Gumroad</a><a class="navbar-item" href="/about">About</a><a class="navbar-item" href="/opensource">Open Source</a><a class="navbar-item" href="/writing">Writing</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/speaking">Speaking</a><a class="navbar-item" href="/news">News</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/onmyway133"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/tags">Tags</a></li><li class="is-active"><a href="#" aria-current="page">macOS</a></li></ul></nav></div></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-12-07T05:16:58.000Z" title="2020-12-07T05:16:58.000Z">2020-12-07</time><span class="level-item">a minute read (About 147 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-support-right-click-menu-to-NSStatusItem/">How to support right click menu to NSStatusItem</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/707">#707</a></strong></p>
<p>The trick is to set the button oinside of <code>statusItem</code> to send actions on both <code>leftMouseUp</code> and <code>rightMouseUp</code>.</p>
<p>Another thing to note is we use <code>popUpMenu</code> on <code>NSStatusItem</code>, although it is marked as deprecated on macOS 10.14. We can set <code>menu</code> but that overrides left click. </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Omnia</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">let</span> statusItem = <span class="type">NSStatusBar</span>.system.statusItem(withLength: <span class="type">NSStatusItem</span>.squareLength)</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">let</span> statusItemMenuHandler = <span class="type">MenuHandler</span>()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">setupStatusMenu</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> button = statusItem.button &#123;</span><br><span class="line">        button.image = <span class="type">NSImage</span>(named: <span class="type">NSImage</span>.<span class="type">Name</span>(<span class="string">"statusMenuIcon"</span>))</span><br><span class="line">        button.contentTintColor = <span class="type">NSColor</span>.black</span><br><span class="line">        button.action = #selector(statusMenuButtonTouched(<span class="number">_</span>:))</span><br><span class="line">        button.sendAction(on: [.leftMouseUp, .rightMouseUp]) <span class="comment">// This is important</span></span><br><span class="line"></span><br><span class="line">        statusItemMenuHandler.add(title: <span class="string">"About"</span>, action: &#123;</span><br><span class="line">            <span class="type">NSWorkspace</span>.shared.<span class="keyword">open</span>(<span class="type">URL</span>(string: <span class="string">"https://onmyway133.com/pushhero"</span>)!)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@objc</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">statusMenuButtonTouched</span><span class="params">(<span class="number">_</span> sender: NSStatusBarButton)</span></span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> event = <span class="type">NSApp</span>.currentEvent <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">    <span class="keyword">switch</span> event.type &#123;</span><br><span class="line">    <span class="keyword">case</span> .rightMouseUp:</span><br><span class="line">        statusItem.popUpMenu(statusItemMenuHandler.menu)</span><br><span class="line">        <span class="comment">// statusItem.menu = statusItemMenuHandler.menu // this overrides left click</span></span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        popover.toggle()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>Updated at</strong> 2020-12-08 05:11:24</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-11-30T19:26:10.000Z" title="2020-11-30T19:26:10.000Z">2020-11-30</time><span class="level-item">14 minutes read (About 2040 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-convert-from-paid-to-free-with-IAP/">How to convert from paid to free with IAP</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/703">#703</a></strong></p>
<h2 id="What-is-receipt"><a href="#What-is-receipt" class="headerlink" title="What is receipt"></a>What is receipt</h2><p>Read <a href="https://stackoverflow.com/questions/45615106/when-to-refresh-a-receipt-vs-restore-purchases-in-ios">When to refresh a receipt vs restore purchases in iOS?</a></p>
<p>From iOS 7, every app downloaded from the store has a receipt (for downloading/buying the app) at <code>appStoreReceiptURL</code>. When users purchases something via In App Purchase, the content at <code>appStoreReceiptURL</code> is updated with purchases information. Most of the cases, you just need to refresh the receipt (at appStoreReceiptURL) so that you know which transactions users have made.</p>
<p><strong>Note</strong></p>
<ul>
<li>Receipt is generated and bundled with your app when user download the app, whether it is free or paid</li>
<li>When user makes IAP, receipt is updated with IAP information</li>
<li>When user downloads an app (download free, or purchase paid app), they get future updates (whether free or paid) forever.</li>
<li>Call <code>SKReceiptRefreshRequest</code> or <code>SKPaymentQueue.restoreCompletedTransactions</code> asks for Appstore credential</li>
<li>When we build the app from Xcode or download from Testflight, receipt is not bundled within the app since the app is not downloaded from AppStore. We can use <code>SKReceiptRefreshRequest</code> to download receipt from sandbox Appstore</li>
<li><code>restoreCompletedTransactions</code> updates app receipt</li>
<li>Receipt is stored locally on device, so when user uninstalls and reinstalls your app, there’s no in app purchases information, this is when you should refresh receipt or <code>restoreCompletedTransactions</code></li>
</ul>
<p>Users restore transactions to maintain access to content they’ve already purchased. For example, when they upgrade to a new phone, they don’t lose all of the items they purchased on the old phone. Include some mechanism in your app to let the user restore their purchases, such as a Restore Purchases button. Restoring purchases prompts for the user’s App Store credentials, which interrupts the flow of your app: because of this, don’t automatically restore purchases, especially not every time your app is launched.</p>
<p>In most cases, all your app needs to do is refresh its receipt and deliver the products in its receipt. The refreshed receipt contains a record of the user’s purchases in this app, on this device or any other device. However, some apps need to take an alternate approach for one of the following reasons:</p>
<ul>
<li>If you use Apple-hosted content, restoring completed transactions gives your app the transaction objects it uses to download the content. If you need to support versions of iOS earlier than iOS 7, where the app receipt isn’t available, restore completed transactions instead.</li>
<li>Refreshing the receipt asks the App Store for the latest copy of the receipt. Refreshing a receipt does not create any new transactions.</li>
<li>Restoring completed transactions creates a new transaction for every completed transaction the user made, essentially replaying history for your transaction queue observer.</li>
</ul>
<p>More about receipt, from WWDC 2017, What’s new in StoreKit session <a href="https://developer.apple.com/videos/play/wwdc2017/303/">https://developer.apple.com/videos/play/wwdc2017/303/</a></p>
<p><img src="https://user-images.githubusercontent.com/2284279/100661732-38507b00-3354-11eb-9198-104410e5ddfb.png" alt="receipt"></p>
<p>You can also watch WWDC 2017, session Advanced StoreKit for more detail <a href="https://developer.apple.com/videos/play/wwdc2017/305/">https://developer.apple.com/videos/play/wwdc2017/305/</a></p>
<p><img src="https://user-images.githubusercontent.com/2284279/100661745-3d152f00-3354-11eb-943d-9c6d9b79000d.png" alt="receipt tips"></p>
<h2 id="Restoring-Purchased-Products"><a href="#Restoring-Purchased-Products" class="headerlink" title="Restoring Purchased Products"></a>Restoring Purchased Products</h2><p>Read <a href="https://developer.apple.com/documentation/storekit/in-app_purchase/restoring_purchased_products">Restoring Purchased Products</a></p>
<blockquote>
<p>Users sometimes need to restore purchased content, such as when they upgrade to a new phone.</p>
</blockquote>
<blockquote>
<p>Don’t automatically restore purchases, especially when your app is launched. Restoring purchases prompts for the user’s App Store credentials, which interrupts the flow of your app</p>
</blockquote>
<blockquote>
<p>In most cases, you only need to refresh the app receipt and deliver the products listed on the receipt. The refreshed receipt contains a record of the user’s purchases in this app, from any device the user’s App Store account is logged into</p>
</blockquote>
<blockquote>
<p>Refreshing a receipt doesn’t create new transactions; it requests the latest copy of the receipt from the App Store</p>
</blockquote>
<blockquote>
<p>Restoring completed transactions creates a new transaction for every transaction previously completed, essentially replaying history for your transaction queue observer. Your app maintains its own state to keep track of why it’s restoring completed transactions and how to handle them.</p>
</blockquote>
<h2 id="What-are-the-different-IAP-types"><a href="#What-are-the-different-IAP-types" class="headerlink" title="What are the different IAP types"></a>What are the different IAP types</h2><p>From AppStore</p>
<h3 id="Consumable-pay-everytime"><a href="#Consumable-pay-everytime" class="headerlink" title="Consumable (pay everytime)"></a>Consumable (pay everytime)</h3><p>A consumable In-App Purchase must be purchased every time the user downloads it. One-time services, such as fish food in a fishing app, are usually implemented as consumables.</p>
<h3 id="Non-Consumable-one-time-payment"><a href="#Non-Consumable-one-time-payment" class="headerlink" title="Non-Consumable (one time payment)"></a>Non-Consumable (one time payment)</h3><p>Non-consumable In-App Purchases only need to be purchased once by users. Services that do not expire or decrease with use are usually implemented as non-consumables, such as new race tracks for a game app.</p>
<h3 id="Auto-Renewable-Subscriptions-will-deduct-money-from-your-credit-card-on-a-cycle-complete"><a href="#Auto-Renewable-Subscriptions-will-deduct-money-from-your-credit-card-on-a-cycle-complete" class="headerlink" title="Auto-Renewable Subscriptions (will deduct money from your credit card on a cycle complete)"></a>Auto-Renewable Subscriptions (will deduct money from your credit card on a cycle complete)</h3><p>Auto-renewable Subscriptions allow the user to purchase updating and dynamic content for a set duration of time. Subscriptions renew automatically unless the user opts out, such as magazine subscriptions.</p>
<h3 id="Free-Subscription-no-payment-and-is-still-visible-even-you-did-not-submitted-your-account-detail-to-itunes-connect"><a href="#Free-Subscription-no-payment-and-is-still-visible-even-you-did-not-submitted-your-account-detail-to-itunes-connect" class="headerlink" title="Free Subscription (no payment and is still visible even you did not submitted your account detail to itunes connect)"></a>Free Subscription (no payment and is still visible even you did not submitted your account detail to itunes connect)</h3><p>Free subscriptions are a way for developers to put free subscription content in Newsstand. Once a user signs up for a free subscription, it will be available on all devices associated with the user’s Apple ID. Note that free subscriptions do not expire and can only be offered in Newsstand-enabled apps.</p>
<h3 id="Non-Renewing-need-to-renew-manually"><a href="#Non-Renewing-need-to-renew-manually" class="headerlink" title="Non-Renewing (need to renew manually)"></a>Non-Renewing (need to renew manually)</h3><p>Subscription Non-Renewing Subscriptions allow the sale of services with a limited duration. Non-Renewing Subscriptions must be used for In-App Purchases that offer time-based access to static content. Examples include a one week subscription to voice guidance feature within a navigation app or an annual subscription to online catalog of archived video or audio.</p>
<h2 id="When-is-app-receipt-missing"><a href="#When-is-app-receipt-missing" class="headerlink" title="When is app receipt missing"></a>When is app receipt missing</h2><p>Read <a href="https://developer.apple.com/documentation/storekit/skreceiptrefreshrequest">SKReceiptRefreshRequest</a></p>
<blockquote>
<p>Use this API to request a new receipt if the receipt is invalid or missing</p>
</blockquote>
<p>Receipt is stored locally on device. It can be missing in case user sync or restore device.</p>
<p>Watch <a href="https://asciiwwdc.com/2014/sessions/305">WWDC 2014 - 305 Preventing Unauthorized Purchases with Receipts</a></p>
<h2 id="How-to-check-receipt-existence"><a href="#How-to-check-receipt-existence" class="headerlink" title="How to check receipt existence"></a>How to check receipt existence</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Bundle</span>.main.appStoreReceiptURL</span><br><span class="line">checkResourceIsReachable</span><br></pre></td></tr></table></figure>

<h2 id="How-to-read-receipt"><a href="#How-to-read-receipt" class="headerlink" title="How to read receipt"></a>How to read receipt</h2><p>Read <a href="https://www.raywenderlich.com/9257-in-app-purchases-receipt-validation-tutorial">In-App Purchases: Receipt Validation Tutorial</a></p>
<blockquote>
<p>The receipt consists of a single file in the app bundle. The file is in a format called PKCS #7. The payload consists of a set of receipt attributes in a cross-platform format called ASN.1</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="number">12</span>: <span class="comment">// Receipt Creation Date</span></span><br><span class="line">  <span class="keyword">var</span> dateStartPtr = ptr</span><br><span class="line">  receiptCreationDate = readASN1Date(ptr: &amp;dateStartPtr, maxLength: length)</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="number">17</span>: <span class="comment">// IAP Receipt</span></span><br><span class="line">  <span class="built_in">print</span>(<span class="string">"IAP Receipt."</span>)</span><br><span class="line">  </span><br><span class="line"><span class="keyword">case</span> <span class="number">19</span>: <span class="comment">// Original App Version</span></span><br><span class="line">  <span class="keyword">var</span> stringStartPtr = ptr</span><br><span class="line">  originalAppVersion = readASN1String(ptr: &amp;stringStartPtr, maxLength: length)</span><br></pre></td></tr></table></figure>

<p>Use <a href="https://github.com/tikhop/TPInAppReceipt">TPInAppReceipt</a> which includes certificates.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> <span class="type">InAppReceipt</span>.localReceipt()</span><br></pre></td></tr></table></figure>

<p>Check <a href="https://developer.apple.com/library/archive/releasenotes/General/ValidateAppStoreReceipt/Chapters/ReceiptFields.html">Receipt Fields</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Original Application Version</span><br><span class="line">The version of the app that was originally purchased.</span><br><span class="line">ASN.1 Field Type 19</span><br><span class="line">ASN.1 Field Value UTF8STRING</span><br></pre></td></tr></table></figure>

<p><strong>Note</strong></p>
<blockquote>
<p>This corresponds to the value of CFBundleVersion (in iOS) or CFBundleShortVersionString (in macOS) in the Info.plist file when the purchase was originally made</p>
</blockquote>
<p><code>CFBundleVersion</code> is build number, and <code>CFBundleShortVersionString</code> is app version</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">In-App Purchase Receipt</span><br><span class="line">The receipt for an in-app purchase.</span><br><span class="line">ASN.1 Field Type 17</span><br></pre></td></tr></table></figure>

<p>Read <a href="https://developer.apple.com/documentation/storekit/in-app_purchase/validating_receipts_with_the_app_store">Validating Receipts with the App Store</a></p>
<p>Sample <code>verifyReceipt</code> json</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"receipt"</span>: &#123;</span><br><span class="line">        <span class="attr">"receipt_type"</span>: <span class="string">"ProductionSandbox"</span>,</span><br><span class="line">        <span class="attr">"adam_id"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">"app_item_id"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">"bundle_id"</span>: <span class="string">"com.example.app.ios"</span>,</span><br><span class="line">        <span class="attr">"application_version"</span>: <span class="string">"3"</span>,</span><br><span class="line">        <span class="attr">"download_id"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">"version_external_identifier"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">"receipt_creation_date"</span>: <span class="string">"2018-11-13 16:46:31 Etc/GMT"</span>,</span><br><span class="line">        <span class="attr">"receipt_creation_date_ms"</span>: <span class="string">"1542127591000"</span>,</span><br><span class="line">        <span class="attr">"receipt_creation_date_pst"</span>: <span class="string">"2018-11-13 08:46:31 America/Los_Angeles"</span>,</span><br><span class="line">        <span class="attr">"request_date"</span>: <span class="string">"2018-11-13 17:10:31 Etc/GMT"</span>,</span><br><span class="line">        <span class="attr">"request_date_ms"</span>: <span class="string">"1542129031280"</span>,</span><br><span class="line">        <span class="attr">"request_date_pst"</span>: <span class="string">"2018-11-13 09:10:31 America/Los_Angeles"</span>,</span><br><span class="line">        <span class="attr">"original_purchase_date"</span>: <span class="string">"2013-08-01 07:00:00 Etc/GMT"</span>,</span><br><span class="line">        <span class="attr">"original_purchase_date_ms"</span>: <span class="string">"1375340400000"</span>,</span><br><span class="line">        <span class="attr">"original_purchase_date_pst"</span>: <span class="string">"2013-08-01 00:00:00 America/Los_Angeles"</span>,</span><br><span class="line">        <span class="attr">"original_application_version"</span>: <span class="string">"1.0"</span>,</span><br><span class="line">        <span class="attr">"in_app"</span>: [&#123;</span><br><span class="line">            <span class="attr">"quantity"</span>: <span class="string">"1"</span>,</span><br><span class="line">            <span class="attr">"product_id"</span>: <span class="string">"test2"</span>,</span><br><span class="line">            <span class="attr">"transaction_id"</span>: <span class="string">"1000000472106082"</span>,</span><br><span class="line">            <span class="attr">"original_transaction_id"</span>: <span class="string">"1000000472106082"</span>,</span><br><span class="line">            <span class="attr">"purchase_date"</span>: <span class="string">"2018-11-13 16:46:31 Etc/GMT"</span>,</span><br><span class="line">            <span class="attr">"purchase_date_ms"</span>: <span class="string">"1542127591000"</span>,</span><br><span class="line">            <span class="attr">"purchase_date_pst"</span>: <span class="string">"2018-11-13 08:46:31 America/Los_Angeles"</span>,</span><br><span class="line">            <span class="attr">"original_purchase_date"</span>: <span class="string">"2018-11-13 16:46:31 Etc/GMT"</span>,</span><br><span class="line">            <span class="attr">"original_purchase_date_ms"</span>: <span class="string">"1542127591000"</span>,</span><br><span class="line">            <span class="attr">"original_purchase_date_pst"</span>: <span class="string">"2018-11-13 08:46:31 America/Los_Angeles"</span>,</span><br><span class="line">            <span class="attr">"is_trial_period"</span>: <span class="string">"false"</span></span><br><span class="line">        &#125;]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"status"</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">"environment"</span>: <span class="string">"Sandbox"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Verify your receipt first with the production URL; then verify with the sandbox URL if you receive a 21007 status code. This approach ensures you do not have to switch between URLs while your application is tested, reviewed by App Review, or live in the App Store.</p>
</blockquote>
<h2 id="Show-me-the-code"><a href="#Show-me-the-code" class="headerlink" title="Show me the code"></a>Show me the code</h2><p>Let’s use enum to represent possible states for each resource. Here’s simple case where we only have 1 non consumable IAP product.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">IAPError</span>: <span class="title">Error</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> failedToRefreshReceipt</span><br><span class="line">    <span class="keyword">case</span> failedToRequestProduct</span><br><span class="line">    <span class="keyword">case</span> failedToPurchase</span><br><span class="line">    <span class="keyword">case</span> receiptNotFound</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">IAPResourceState</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> notAsked</span><br><span class="line">    <span class="keyword">case</span> loading</span><br><span class="line">    <span class="keyword">case</span> success(<span class="type">T</span>)</span><br><span class="line">    <span class="keyword">case</span> failure(<span class="type">IAPError</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">PricingPlan</span>: <span class="title">ObservableObject</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> pro = (<span class="type">Bundle</span>.main.bundleIdentifier ?? <span class="string">""</span>) + <span class="string">".pro"</span></span><br><span class="line"></span><br><span class="line">    @<span class="type">Published</span></span><br><span class="line">    <span class="keyword">var</span> isPro: <span class="type">Bool</span> = <span class="literal">false</span></span><br><span class="line">    @<span class="type">Published</span></span><br><span class="line">    <span class="keyword">var</span> product: <span class="type">IAPResourceState</span>&lt;<span class="type">SKProduct</span>&gt; = .notAsked</span><br><span class="line">    @<span class="type">Published</span></span><br><span class="line">    <span class="keyword">var</span> purchase: <span class="type">IAPResourceState</span>&lt;<span class="type">SKPayment</span>&gt; = .notAsked</span><br><span class="line">    @<span class="type">Published</span></span><br><span class="line">    <span class="keyword">var</span> receipt: <span class="type">IAPResourceState</span>&lt;<span class="type">InAppReceipt</span>&gt; = .notAsked</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Let’s have a central place for managing all IAP operations, called <code>IAPManager</code>, it can update our <code>ObservableObject</code> <code>PricingPlan</code> hence triggers update to SwiftUI.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> StoreKit</span><br><span class="line"><span class="keyword">import</span> TPInAppReceipt</span><br><span class="line"><span class="keyword">import</span> Version</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">IAPManager</span>: <span class="title">NSObject</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">let</span> pricingPlan: <span class="type">PricingPlan</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">let</span> paymentQueue: <span class="type">SKPaymentQueue</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(pricingPlan: <span class="type">PricingPlan</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.pricingPlan = pricingPlan</span><br><span class="line">        <span class="keyword">self</span>.paymentQueue = <span class="type">SKPaymentQueue</span>.<span class="keyword">default</span>()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">self</span>.paymentQueue.add(<span class="keyword">self</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">requestProducts</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">let</span> identifiers = <span class="type">PricingPlan</span>.pro</span><br><span class="line">        <span class="keyword">let</span> request = <span class="type">SKProductsRequest</span>(productIdentifiers: <span class="type">Set</span>(arrayLiteral: identifiers))</span><br><span class="line">        request.delegate = <span class="keyword">self</span></span><br><span class="line">        pricingPlan.product = .loading</span><br><span class="line">        request.start()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">purchase</span><span class="params">(product: SKProduct)</span></span> &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="type">SKPaymentQueue</span>.canMakePayments() <span class="keyword">else</span> &#123;</span><br><span class="line">            showAlert(text: <span class="string">"You are not allowed to make payment. Please check device settings."</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        pricingPlan.purchase = .loading</span><br><span class="line">        <span class="keyword">let</span> payment = <span class="type">SKPayment</span>(product: product)</span><br><span class="line">        paymentQueue.add(payment)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">refreshReceipt</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">let</span> request = <span class="type">SKReceiptRefreshRequest</span>()</span><br><span class="line">        request.delegate = <span class="keyword">self</span></span><br><span class="line">        request.start()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">restorePurchase</span><span class="params">()</span></span> &#123;</span><br><span class="line">        paymentQueue.restoreCompletedTransactions()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Refresh-receipt"><a href="#Refresh-receipt" class="headerlink" title="Refresh receipt"></a>Refresh receipt</h3><p>You can use <code>restoreCompletedTransactions</code> if you simply <code>finishTransaction</code> and grant user pro feature, like in this simple tutorial <a href="https://www.raywenderlich.com/5456-in-app-purchase-tutorial-getting-started">In-App Purchase Tutorial: Getting Started</a>, search for <code>SKPaymentTransactionObserver</code>. <code>restoreCompletedTransactions</code> also updates receipt.</p>
<p>Otherwise refreshing receipt is a better idea. It serves both case when receipt is not there locally and when you want to restore transactions. With receipt refreshing, no restored transactions are created and <code>SKPaymentTransactionObserver</code> is not called, so we need to check receipt proactively.</p>
<p>Either <code>restoreCompletedTransactions</code>  or <code>SKReceiptRefreshRequest</code> asks for AppStore credential so you should present a button there and ask user.</p>
<h3 id="Check-local-receipt"><a href="#Check-local-receipt" class="headerlink" title="Check local receipt"></a>Check local receipt</h3><p>Try to locate local receipt and examine it.</p>
<ul>
<li>If it is not there (missing, corrupted), refresh receipt</li>
<li>If it’s there, check if it was from a version when the app was still as paid. Notice the difference in meaning of <code>originalAppVersion</code> in macOS and iOS</li>
<li>If it is not paid, check if this receipt contains In App Purchase information for our product</li>
</ul>
<p>In practice, we need to perform some basic checks on receipt, like bundle id, app version, device id. Read <a href="https://www.raywenderlich.com/9257-in-app-purchases-receipt-validation-tutorial">In-App Purchases: Receipt Validation Tutorial</a>, search for <code>Validating the Receipt</code>. <code>TPInAppReceipt</code> also has some handy <code>verify</code> functions</p>
<p>Besides verifying receipt locally, it is advisable to call <a href="https://developer.apple.com/documentation/appstorereceipts/verifyreceipt">verifyreceipt</a> either on device, or better on serve to let Apple verify receipt and returns you a human readable json for receipt information.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">checkReceipt</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="type">DispatchQueue</span>.main.async &#123;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> receipt = <span class="keyword">try</span> <span class="type">InAppReceipt</span>.localReceipt()</span><br><span class="line">            <span class="keyword">self</span>.pricingPlan.receipt = .success(receipt)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">self</span>.isPaid(receipt: receipt) &#123;</span><br><span class="line">                <span class="keyword">self</span>.pricingPlan.isPro = <span class="literal">true</span></span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> receipt.containsPurchase(ofProductIdentifier: <span class="type">PricingPlan</span>.pro) &#123;</span><br><span class="line">                <span class="keyword">self</span>.pricingPlan.isPro = <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="keyword">self</span>.pricingPlan.receipt = .failure(.receiptNotFound)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">isPaid</span><span class="params">(receipt: InAppReceipt)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    #<span class="keyword">if</span> os(macOS)</span><br><span class="line">    <span class="comment">// originalAppVersion is CFBundleShortVersionString</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> version = <span class="type">Version</span>(receipt.originalAppVersion) &#123;</span><br><span class="line">        <span class="keyword">return</span> version &lt; versionToIAP</span><br><span class="line">    &#125;</span><br><span class="line">    #<span class="keyword">else</span></span><br><span class="line">    <span class="comment">// originalAppVersion is CFBundleVersion</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> buildNumber = <span class="type">Int</span>(receipt.originalAppVersion) &#123;</span><br><span class="line">        <span class="keyword">return</span> buildNumber &lt; buildNumberToIAP</span><br><span class="line">    &#125;</span><br><span class="line">    #endif</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Finally, observe <code>SKProductsRequestDelegate</code> which also conforms to <code>SKRequestDelegate</code> for both product and receipt refresh request</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">IAPManager</span>: <span class="title">SKProductsRequestDelegate</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">productsRequest</span><span class="params">(<span class="number">_</span> request: SKProductsRequest, didReceive response: SKProductsResponse)</span></span> &#123;</span><br><span class="line">        <span class="type">DispatchQueue</span>.main.async &#123;</span><br><span class="line">            <span class="keyword">guard</span> <span class="keyword">let</span> product = response.products.first <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">self</span>.pricingPlan.product = .failure(<span class="type">IAPError</span>.failedToRequestProduct)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">self</span>.pricingPlan.product = .success(product)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">request</span><span class="params">(<span class="number">_</span> request: SKRequest, didFailWithError error: Error)</span></span> &#123;</span><br><span class="line">        <span class="type">DispatchQueue</span>.main.async &#123;</span><br><span class="line">            <span class="keyword">switch</span> request &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="keyword">is</span> <span class="type">SKProductsRequest</span>:</span><br><span class="line">                <span class="keyword">self</span>.pricingPlan.product = .failure(<span class="type">IAPError</span>.failedToRequestProduct)</span><br><span class="line">            <span class="keyword">case</span> <span class="keyword">is</span> <span class="type">SKReceiptRefreshRequest</span>:</span><br><span class="line">                <span class="keyword">self</span>.pricingPlan.receipt = .failure(<span class="type">IAPError</span>.failedToRefreshReceipt)</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">requestDidFinish</span><span class="params">(<span class="number">_</span> request: SKRequest)</span></span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> request &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="keyword">is</span> <span class="type">SKReceiptRefreshRequest</span>:</span><br><span class="line">            checkReceipt()</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>Updated at</strong> 2020-12-04 06:58:17</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-11-27T11:24:13.000Z" title="2020-11-27T11:24:13.000Z">2020-11-27</time><span class="level-item">a few seconds read (About 37 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-disable-NSTextView-in-SwiftUI/">How to disable NSTextView in SwiftUI</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/702">#702</a></strong></p>
<p>The trick is to use an overlay</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">MessageTextView</span>(text: $input.message)</span><br><span class="line">    .overlay(obscure)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obscure: <span class="type">AnyView</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> store.pricingPlan.isPro &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">EmptyView</span>().erase()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Color</span>.black.opacity(<span class="number">0.01</span>).erase()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-11-10T04:18:34.000Z" title="2020-11-10T04:18:34.000Z">2020-11-10</time><span class="level-item">a minute read (About 202 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-check-dark-mode-in-AppKit-for-macOS-apps/">How to check dark mode in AppKit for macOS apps</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/693">#693</a></strong></p>
<p><code>AppKit</code> app has its theme information stored in UserDefaults key <code>AppleInterfaceStyle</code>, if is dark, it contains String <code>Dark</code>.</p>
<p>Another way is to detect appearance via <code>NSView</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">R</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> dark = <span class="type">DarkTheme</span>()</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> light = <span class="type">LightTheme</span>()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> theme: <span class="type">Theme</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> isDark = <span class="type">UserDefaults</span>.standard.string(forKey: <span class="string">"AppleInterfaceStyle"</span>) == <span class="string">"Dark"</span></span><br><span class="line">        <span class="keyword">return</span> isDark ? dark : light</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Another way is to rely on <code>appearance</code> on NSView. You can quickly check via <code>NSApp.keyWindow?.effectiveAppearance</code> but notice that <code>keyWindow</code> can be nil when the app is not active since no window is focused for keyboard events. You should use <code>NSApp.windows.first</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> isDark = <span class="type">NSApp</span>.windows.first?.effectiveAppearance.bestMatch(from: [.darkAqua, .vibrantDark]) == .darkAqua</span><br></pre></td></tr></table></figure>

<p>Then build a simple Theme system</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> EasySwiftUI</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Theme</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> primaryColor: <span class="type">Color</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="keyword">var</span> textColor: <span class="type">Color</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="keyword">var</span> text2Color: <span class="type">Color</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="keyword">var</span> backgroundColor: <span class="type">Color</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="keyword">var</span> background2Color: <span class="type">Color</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Theme</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> primaryColor: <span class="type">Color</span> &#123; <span class="type">Color</span>(hex: <span class="number">0x1</span>) &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">DarkTheme</span>: <span class="title">Theme</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">LightTheme</span>: <span class="title">Theme</span> </span>&#123;</span><br><span class="line">    ....   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>For SwiftUI, you can <code>colorScheme</code> environment, then use modifier <code>.id(colorScheme)</code> to force SwiftUI to update when color scheme changes</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">MainView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    @<span class="type">Environment</span>(\.colorScheme)</span><br><span class="line">    <span class="keyword">var</span> colorScheme</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;&#125;</span><br><span class="line">        .id(colorScheme)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>Updated at</strong> 2020-11-10 05:52:33</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-11-03T04:19:35.000Z" title="2020-11-03T04:19:35.000Z">2020-11-03</time><span class="level-item">a minute read (About 129 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-make-full-size-content-view-in-SwiftUI-for-macOS/">How to make full size content view in SwiftUI for macOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/689">#689</a></strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">applicationDidFinishLaunching</span><span class="params">(<span class="number">_</span> aNotification: Notification)</span></span> &#123;</span><br><span class="line">    <span class="comment">// extend to title bar</span></span><br><span class="line">    <span class="keyword">let</span> contentView = <span class="type">ContentView</span>()</span><br><span class="line">        <span class="comment">// .padding(.top, 24) // can padding to give some space</span></span><br><span class="line">        .edgesIgnoringSafeArea(.top)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// specify fullSizeContentView</span></span><br><span class="line">    window = <span class="type">NSWindow</span>(</span><br><span class="line">        contentRect: <span class="type">NSRect</span>(x: <span class="number">0</span>, y: <span class="number">0</span>, width: <span class="number">800</span>, height: <span class="number">600</span>),</span><br><span class="line">        styleMask: [.titled, .closable, .miniaturizable, .texturedBackground, .resizable, .fullSizeContentView],</span><br><span class="line">        backing: .buffered, </span><br><span class="line">       <span class="keyword">defer</span>: <span class="literal">false</span></span><br><span class="line">    )</span><br><span class="line">    window.center()</span><br><span class="line">    window.setFrameAutosaveName(<span class="string">"My App"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// window.title = ... // no title</span></span><br><span class="line">    <span class="comment">// window.toolbar = NSToolbar() // use toolbar if wanted. This triggers .unifiedTitleAndToolbar styleMask</span></span><br><span class="line">    window.titlebarAppearsTransparent = <span class="literal">true</span></span><br><span class="line">    window.titleVisibility = .hidden <span class="comment">// hide title</span></span><br><span class="line">    window.backgroundColor = <span class="type">R</span>.color.myBackgroundColor <span class="comment">// set our preferred background color</span></span><br><span class="line"></span><br><span class="line">    window.contentView = <span class="type">NSHostingView</span>(rootView: contentView)</span><br><span class="line">    window.makeKeyAndOrderFront(<span class="literal">nil</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>I have an issue where if I use <code>HSplitView</code>, some Button are not clickable until I drag the split view handle. The workaround is to use HStack with a Divider<br><strong>Updated at</strong> 2020-11-03 05:21:50</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-10-07T03:01:55.000Z" title="2020-10-07T03:01:55.000Z">2020-10-07</time><span class="level-item">a few seconds read (About 102 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-style-multiline-Text-in-SwiftUI-for-macOS/">How to style multiline Text in SwiftUI for macOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/681">#681</a></strong></p>
<p>Only need to specify <code>fixedSize</code> on text to preserve ideal height.</p>
<blockquote>
<p>The maximum number of lines is 1 if the value is less than 1. If the value is nil, the text uses as many lines as required. The default is nil.</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Text</span>(longText)</span><br><span class="line">    .lineLimit(<span class="literal">nil</span>) <span class="comment">// No need</span></span><br><span class="line">    .fixedSize(horizontal: <span class="literal">false</span>, vertical: <span class="literal">true</span>)</span><br></pre></td></tr></table></figure>

<p>If the Text is inside a row in a <code>List</code>, <code>fixedSize</code> causes the row to be in middle of the <code>List</code>, workaround is to use <code>ScrollView</code> and vertical <code>StackView</code>.</p>
<p>Sometimes for Text to properly size itself, specify an explicit frame width<br><strong>Updated at</strong> 2020-10-07 05:02:01</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-10-04T03:14:08.000Z" title="2020-10-04T03:14:08.000Z">2020-10-04</time><span class="level-item">a minute read (About 212 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-clear-List-background-color-in-SwiftUI-for-macOS/">How to clear List background color in SwiftUI for macOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/680">#680</a></strong></p>
<p>For <code>List</code> in SwiftUI for macOS, it has default background color because of the enclosing <code>NSScrollView</code> via <code>NSTableView</code> that <code>List</code> uses under the hood. Using <code>listRowBackground</code> also gives no effect</p>
<p>The solution is to use a library like <a href="https://github.com/siteline/SwiftUI-Introspect">SwiftUI-Introspect</a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Introspect</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">List</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">removeBackground</span><span class="params">()</span></span> -&gt; some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> introspectTableView &#123; tableView <span class="keyword">in</span></span><br><span class="line">            tableView.backgroundColor = .clear</span><br><span class="line">            tableView.enclosingScrollView!.drawsBackground = <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>then</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">List</span> &#123;</span><br><span class="line">    <span class="type">ForEach</span>(items) &#123; item <span class="keyword">in</span></span><br><span class="line">        <span class="comment">// view here</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">.removeBackground()</span><br></pre></td></tr></table></figure>

<p>Or we can add extension on <code>NSTableView</code> to alter its content when it moves to superview</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">NSTableView</span> </span>&#123;</span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidMoveToWindow</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidMoveToWindow()</span><br><span class="line"></span><br><span class="line">        backgroundColor = <span class="type">NSColor</span>.clear</span><br><span class="line">        enclosingScrollView!.drawsBackground = <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This works OK for me on macOS 10.15.5, 10.15.7 and macOS 10.11 beta. But it was reported crash during review on macOS 10.15.6</p>
<blockquote>
<p>The app launches briefly and then quits without error message.</p>
</blockquote>
<p>After inspecting crash log, it is because of <code>viewDidMoveToWindow</code>. So it’s wise not to mess with NSTableView for now</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Thread 0 Crashed:: Dispatch queue: com.apple.main-thread</span><br><span class="line">0   com.onmyway133.PushHero       	0x0000000104770b0a @objc NSTableView.viewDidMoveToWindow() (in Push Hero) (&lt;compiler-generated&gt;:296)</span><br><span class="line">1   com.apple.AppKit              	0x00007fff2d8638ea -[NSView _setWindow:] + 2416</span><br><span class="line">2   com.apple.AppKit              	0x00007fff2d8844ea -[NSControl _setWindow:] + 158</span><br><span class="line">3   com.apple.AppKit              	0x00007fff2d946ace -[NSTableView _setWindow:] + 306</span><br></pre></td></tr></table></figure>
<p><strong>Updated at</strong> 2020-10-09 03:49:39</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-10-01T03:05:30.000Z" title="2020-10-01T03:05:30.000Z">2020-10-01</time><span class="level-item">a minute read (About 139 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-avoid-reduced-opacity-when-hiding-view-with-animation-in-SwiftUI/">How to avoid reduced opacity when hiding view with animation in SwiftUI</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/679">#679</a></strong></p>
<p>While redesigning UI for my app <a href="https://onmyway133.com/pushhero/">Push Hero</a>, I ended up with an accordion style to toggle section.</p>
<img width="588" alt="Screenshot 2020-10-01 at 06 58 33" src="https://user-images.githubusercontent.com/2284279/94769940-86c4b600-03b3-11eb-87da-fbba61f13ace.png">

<p>It worked great so far, but after 1 collapsing, all image and text views have reduced opacity. This does not happen for other elements like dropdown button or text.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">extension View &#123;</span><br><span class="line">    func sectionBackground(_ title: String, _ shows: Binding&lt;Bool&gt;) -&gt; some View &#123;</span><br><span class="line">        VStack(alignment: .leading) &#123;</span><br><span class="line">            HStack &#123;</span><br><span class="line">                Text(title.uppercased())</span><br><span class="line">                Spacer()</span><br><span class="line">                if shows !&#x3D; nil &#123;</span><br><span class="line">                    SmallButton(</span><br><span class="line">                        imageName: &quot;downArrow&quot;,</span><br><span class="line">                        tooltip: shows!.wrappedValue ? &quot;Collapse&quot; : &quot;Expand&quot;,</span><br><span class="line">                        action: &#123;</span><br><span class="line">                           withAnimation(.easeInOut) &#123;</span><br><span class="line">                                shows!.wrappedValue.toggle()</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    )</span><br><span class="line">                    .rotationEffect(.radians(shows!.wrappedValue ? .pi : 0))</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            if shows.wrappedValue &#123;</span><br><span class="line">                self</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The culprit is that <code>withAnimation</code>, it seems to apply opacity effect. So the workaround is to disable animation <code>wrappedValue</code>, or to tweak transition so that there’s no opacity adjustment.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> shows.wrappedValue &#123;</span><br><span class="line">    <span class="keyword">self</span>.transition(<span class="type">AnyTransition</span>.identity)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-09-29T03:01:46.000Z" title="2020-09-29T03:01:46.000Z">2020-09-29</time><span class="level-item">a minute read (About 135 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-unwrap-Binding-with-Optional-in-SwiftUI/">How to unwrap Binding with Optional in SwiftUI</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/677">#677</a></strong></p>
<p>The quick way to add new properties without breaking current saved Codable is to declare them as optional. For example if you use  <a href="https://github.com/onmyway133/EasyStash">EasyStash</a> library to save and load Codable models.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Input</span>: <span class="title">Codable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> bundleId: <span class="type">String</span> = <span class="string">""</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// New props</span></span><br><span class="line">    <span class="keyword">var</span> notificationId: <span class="type">String?</span></span><br></pre></td></tr></table></figure>

<p>This new property when using dollar syntax <code>$input.notificationId</code> turn into Binding with optional <code>Binding&lt;Strting?&gt;</code> which is incompatible in SwiftUI when we use Binding.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">MaterialTextField</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> placeholder: <span class="type">String</span></span><br><span class="line">    @<span class="type">Binding</span> <span class="keyword">var</span> text: <span class="type">String</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The solution here is write an extension that converts <code>Binding&lt;String?&gt;</code> to <code>Binding&lt;String&gt;</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Binding</span> <span class="title">where</span> <span class="title">Value</span> == <span class="title">String</span>? </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">toNonOptional</span><span class="params">()</span></span> -&gt; <span class="type">Binding</span>&lt;<span class="type">String</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Binding</span>&lt;<span class="type">String</span>&gt;(</span><br><span class="line">            <span class="keyword">get</span>: &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">self</span>.wrappedValue ?? <span class="string">""</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="keyword">set</span>: &#123;</span><br><span class="line">                <span class="keyword">self</span>.wrappedValue = $<span class="number">0</span></span><br><span class="line">            &#125;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>so we can use them as normal</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">MaterialTextField</span>(text: $input.notificationId.toNonOptional())</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-09-29T02:55:04.000Z" title="2020-09-29T02:55:04.000Z">2020-09-29</time><span class="level-item">a minute read (About 196 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-make-custom-toggle-in-SwiftUI/">How to make custom toggle in SwiftUI</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/676">#676</a></strong></p>
<p>I’ve used the default <code>SwiftUI</code> to achieve the 2 tab views in SwiftUI. It adds a default box around the content and also opinionated paddings. For now on light mode on macOS, the unselected tab has wrong colors.</p>
<p>The way to solve this is to come up with a custom toggle, that we can style and align the way we want. Here is how I did for my app <a href="https://onmyway133.com/pushhero">Push Hero</a></p>
<p>Using a Text instead of Button here gives me default static text look.</p>
<img width="752" alt="Screenshot 2020-09-29 at 06 52 33" src="https://user-images.githubusercontent.com/2284279/94513986-5bf62880-0220-11eb-9b29-bca0de5de64b.png">

<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">AuthenticationView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    @<span class="type">Binding</span> <span class="keyword">var</span> input: <span class="type">Input</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: some <span class="type">View</span> &#123;</span><br><span class="line">        toggle</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> toggle: some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="type">HStack</span>(spacing: <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">"🔑 Key"</span>)</span><br><span class="line">                        .style(selected: input.authentication == .key)</span><br><span class="line">                        .onTapGesture &#123;</span><br><span class="line">                            <span class="keyword">self</span>.input.authentication = .key</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="type">Text</span>(<span class="string">"📰 Certificate"</span>)</span><br><span class="line">                        .style(selected: input.authentication == .certificate)</span><br><span class="line">                        .onTapGesture &#123;</span><br><span class="line">                            <span class="keyword">self</span>.input.authentication = .certificate</span><br><span class="line">                        &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                .padding(<span class="number">3</span>)</span><br><span class="line">                .background(<span class="type">Color</span>.white.opacity(<span class="number">0.2</span>))</span><br><span class="line">                .cornerRadius(<span class="number">6</span>)</span><br><span class="line"></span><br><span class="line">                <span class="type">Spacer</span>()</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            choose</span><br><span class="line">            <span class="type">Spacer</span>()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> choose: <span class="type">AnyView</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> input.authentication &#123;</span><br><span class="line">        <span class="keyword">case</span> .key:</span><br><span class="line">            <span class="keyword">return</span> <span class="type">KeyAuthenticationView</span>().erase()</span><br><span class="line">        <span class="keyword">case</span> .certificate:</span><br><span class="line">            <span class="keyword">return</span> <span class="type">CertificateAuthenticationView</span>().erase()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">extension</span> <span class="title">Text</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">style</span><span class="params">(selected: Bool)</span></span> -&gt; some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span></span><br><span class="line">            .padding(.vertical, <span class="number">3</span>)</span><br><span class="line">            .padding(.horizontal, <span class="number">4</span>)</span><br><span class="line">            .background(selected ? <span class="type">Color</span>.white.opacity(<span class="number">0.5</span>) : <span class="type">Color</span>.clear)</span><br><span class="line">            .cornerRadius(<span class="number">6</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>Updated at</strong> 2020-09-29 04:55:14</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-09-23T02:32:58.000Z" title="2020-09-23T02:32:58.000Z">2020-09-23</time><span class="level-item">a few seconds read (About 58 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-use-HSplitView-to-define-3-panes-view-in-SwiftUI-for-macOS/">How to use HSplitView to define 3 panes view in SwiftUI for macOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/674">#674</a></strong></p>
<p>Specify <code>minWidth</code> to ensure miminum width, and use <code>.layoutPriority(1)</code> for the most important pane.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">MainView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    @<span class="type">EnvironmentObject</span> <span class="keyword">var</span> store: <span class="type">Store</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">HSplitView</span> &#123;</span><br><span class="line">            <span class="type">LeftPane</span>()</span><br><span class="line">                .padding()</span><br><span class="line">                .frame(minWidth: <span class="number">200</span>, maxWidth: <span class="number">500</span>)</span><br><span class="line">            <span class="type">MiddlePane</span>(store: store)</span><br><span class="line">                .padding()</span><br><span class="line">                .frame(minWidth: <span class="number">500</span>)</span><br><span class="line">                .layoutPriority(<span class="number">1</span>)</span><br><span class="line">            <span class="type">RightPane</span>()</span><br><span class="line">                .padding()</span><br><span class="line">                .frame(minWidth: <span class="number">300</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        .background(<span class="type">R</span>.color.background)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>Updated at</strong> 2020-09-23 08:42:29</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-04-06T05:51:05.000Z" title="2020-04-06T05:51:05.000Z">2020-04-06</time><span class="level-item">a minute read (About 201 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-disable-ring-type-in-TextField-in-SwiftUI/">How to disable ring type in TextField in SwiftUI</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/636">#636</a></strong></p>
<p>Normally we can just wrap <code>NSTextField</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SearchTextField</span>: <span class="title">NSViewRepresentable</span> </span>&#123;</span><br><span class="line">    @<span class="type">Binding</span> <span class="keyword">var</span> text: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> hint: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> onCommit: (<span class="type">String</span>) -&gt; <span class="type">Void</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">makeNSView</span><span class="params">(context: NSViewRepresentableContext&lt;SearchTextField&gt;)</span></span> -&gt; <span class="type">NSTextField</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> tf = <span class="type">NSTextField</span>()</span><br><span class="line">        tf.focusRingType = .<span class="keyword">none</span></span><br><span class="line">        tf.isBordered = <span class="literal">false</span></span><br><span class="line">        tf.isEditable = <span class="literal">true</span></span><br><span class="line">        tf.isSelectable = <span class="literal">true</span></span><br><span class="line">        tf.drawsBackground = <span class="literal">false</span></span><br><span class="line">        tf.delegate = context.coordinator</span><br><span class="line">        tf.font = <span class="type">NSFont</span>(name: <span class="type">OpenSans</span>.bold.rawValue, size: <span class="number">14</span>)</span><br><span class="line">        tf.placeholderString = hint</span><br><span class="line">        <span class="keyword">return</span> tf</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">updateNSView</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="number">_</span> nsView: NSTextField,</span></span></span><br><span class="line"><span class="function"><span class="params">        context: NSViewRepresentableContext&lt;SearchTextField&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">    )</span></span> &#123;</span><br><span class="line">        nsView.font = <span class="type">NSFont</span>(name: <span class="type">OpenSans</span>.bold.rawValue, size: <span class="number">14</span>)</span><br><span class="line">        nsView.stringValue = text</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">makeCoordinator</span><span class="params">()</span></span> -&gt; <span class="type">SearchTextField</span>.<span class="type">Coordinator</span> &#123;</span><br><span class="line">        <span class="type">Coordinator</span>(parent: <span class="keyword">self</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Coordinator</span>: <span class="title">NSObject</span>, <span class="title">NSTextFieldDelegate</span>  </span>&#123;</span><br><span class="line">        <span class="keyword">let</span> parent: <span class="type">SearchTextField</span></span><br><span class="line">        <span class="keyword">init</span>(parent: <span class="type">SearchTextField</span>) &#123;</span><br><span class="line">            <span class="keyword">self</span>.parent = parent</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">func</span> <span class="title">controlTextDidChange</span><span class="params">(<span class="number">_</span> obj: Notification)</span></span> &#123;</span><br><span class="line">            <span class="keyword">let</span> textField = obj.object <span class="keyword">as</span>! <span class="type">NSTextField</span></span><br><span class="line">            parent.text = textField.stringValue</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">func</span> <span class="title">control</span><span class="params">(<span class="number">_</span> control: NSControl, textView: NSTextView, doCommandBy commandSelector: Selector)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (commandSelector == #selector(<span class="type">NSResponder</span>.insertNewline(<span class="number">_</span>:))) &#123;</span><br><span class="line">                <span class="keyword">self</span>.parent.onCommit(textView.string)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>But there is a weird Appstore rejection where the textfield is not focusable. The workaround is to use <code>TextField</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">NSTextField</span> </span>&#123;</span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">override</span> <span class="keyword">var</span> focusRingType: <span class="type">NSFocusRingType</span> &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123; .<span class="keyword">none</span> &#125;</span><br><span class="line">        <span class="keyword">set</span> &#123; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">TextField</span>(</span><br><span class="line">    <span class="string">"What's next?"</span>,</span><br><span class="line">    text: $text,</span><br><span class="line">    onCommit: &#123; <span class="keyword">self</span>.onAdd(<span class="keyword">self</span>.text) &#125;</span><br><span class="line">)</span><br><span class="line">.font(.system(size: <span class="number">14</span>, weight: .semibold, design: .rounded))</span><br><span class="line">.textFieldStyle(<span class="type">PlainTextFieldStyle</span>())</span><br><span class="line">.padding(<span class="number">1</span>)</span><br><span class="line">.background(<span class="type">RoundedRectangle</span>(cornerRadius: <span class="number">2</span>).stroke(<span class="type">Color</span>.white))</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-04-03T01:15:06.000Z" title="2020-04-03T01:15:06.000Z">2020-04-03</time><span class="level-item">a few seconds read (About 100 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-handle-enter-key-in-NSTextField/">How to handle enter key in NSTextField</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/635">#635</a></strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">textField.delegate = <span class="keyword">self</span></span><br></pre></td></tr></table></figure>

<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">NSTextFieldDelegate</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">control</span><span class="params">(<span class="number">_</span> control: NSControl, textView: NSTextView, doCommandBy commandSelector: Selector)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (commandSelector == #selector(<span class="type">NSResponder</span>.insertNewline(<span class="number">_</span>:))) &#123;</span><br><span class="line">        <span class="comment">// Do something against ENTER key</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"enter"</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (commandSelector == #selector(<span class="type">NSResponder</span>.deleteForward(<span class="number">_</span>:))) &#123;</span><br><span class="line">        <span class="comment">// Do something against DELETE key</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (commandSelector == #selector(<span class="type">NSResponder</span>.deleteBackward(<span class="number">_</span>:))) &#123;</span><br><span class="line">        <span class="comment">// Do something against BACKSPACE key</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (commandSelector == #selector(<span class="type">NSResponder</span>.insertTab(<span class="number">_</span>:))) &#123;</span><br><span class="line">        <span class="comment">// Do something against TAB key</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (commandSelector == #selector(<span class="type">NSResponder</span>.cancelOperation(<span class="number">_</span>:))) &#123;</span><br><span class="line">        <span class="comment">// Do something against ESCAPE key</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// return true if the action was handled; otherwise false</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-03-29T23:47:37.000Z" title="2020-03-29T23:47:37.000Z">2020-03-30</time><span class="level-item">a few seconds read (About 37 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-toggle-with-animation-in-SwiftUI/">How to toggle with animation in SwiftUI</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/632">#632</a></strong></p>
<p>Use Group</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">makeHeader</span><span class="params">()</span></span> -&gt; some <span class="type">View</span> &#123;</span><br><span class="line">    <span class="type">Group</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> showsSearch &#123;</span><br><span class="line">            <span class="type">SearchView</span>(</span><br><span class="line">                onSearch: onSearch</span><br><span class="line">            )</span><br><span class="line">            .transition(.move(edge: .leading))</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">InputView</span>(</span><br><span class="line">                onAdd: onAdd</span><br><span class="line">            )</span><br><span class="line">            .transition(.move(edge: .leading))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">withAnimation &#123;</span><br><span class="line">    <span class="keyword">self</span>.showsSearch.toggle()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-03-22T21:42:16.000Z" title="2020-03-22T21:42:16.000Z">2020-03-22</time><span class="level-item">a few seconds read (About 92 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-show-context-popover-from-SwiftUI-for-macOS/">How to show context popover from SwiftUI for macOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/630">#630</a></strong></p>
<p>For SwiftUI app using <code>NSPopover</code>, to show  context popover menu, we can ask for <code>windows</code> array, get the <code>_NSPopoverWindow</code> and calculate the position. Note that origin of macOS screen is bottom left</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(lldb) po NSApp.windows</span><br><span class="line">▿ 2 elements</span><br><span class="line">  - 0 : &lt;NSStatusBarWindow: 0x101a02700&gt;</span><br><span class="line">  - 1 : &lt;_NSPopoverWindow: 0x101c01060&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> handler = <span class="type">MenuHandler</span>()</span><br><span class="line">handler.add(title: <span class="string">"About"</span>, action: onAbout)</span><br><span class="line">handler.add(title: <span class="string">"Quit"</span>, action: onQuit)</span><br><span class="line"></span><br><span class="line"><span class="keyword">guard</span> <span class="keyword">let</span> window = <span class="type">NSApp</span>.windows.last <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line"><span class="keyword">let</span> position = <span class="type">CGPoint</span>(</span><br><span class="line">    x: window.frame.maxX - <span class="number">100</span>,</span><br><span class="line">    y: window.frame.minY + <span class="number">80</span></span><br><span class="line">)</span><br><span class="line">handler.menu.popUp(positioning: <span class="literal">nil</span>, at: position, <span class="keyword">in</span>: <span class="literal">nil</span>)</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-03-22T20:35:21.000Z" title="2020-03-22T20:35:21.000Z">2020-03-22</time><span class="level-item">a few seconds read (About 109 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-make-segmented-control-in-SwiftUI-for-macOS/">How to make segmented control in SwiftUI for macOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/629">#629</a></strong></p>
<p>Use <code>Picker</code> with <code>SegmentedPickerStyle</code>.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Picker</span>(selection: $preferenceManager.preference.display, label: <span class="type">EmptyView</span>()) &#123;</span><br><span class="line">    <span class="type">Image</span>(<span class="string">"grid"</span>)</span><br><span class="line">        .resizable()</span><br><span class="line">    .padding()</span><br><span class="line">        .tag(<span class="number">0</span>)</span><br><span class="line">    <span class="type">Image</span>(<span class="string">"list"</span>)</span><br><span class="line">        .resizable()</span><br><span class="line">        .tag(<span class="number">1</span>)</span><br><span class="line">&#125;.pickerStyle(<span class="type">SegmentedPickerStyle</span>())</span><br><span class="line">.frame(width: <span class="number">50</span>)</span><br><span class="line">.padding(.leading, <span class="number">16</span>)</span><br><span class="line">.padding(.trailing, <span class="number">24</span>)</span><br></pre></td></tr></table></figure>

<p>Alternatively, we can make custom <code>NSSegmentedControl</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> AppKit</span><br><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">MySegmentControl</span>: <span class="title">NSViewRepresentable</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">makeCoordinator</span><span class="params">()</span></span> -&gt; <span class="type">MySegmentControl</span>.<span class="type">Coordinator</span> &#123;</span><br><span class="line">        <span class="type">Coordinator</span>(parent: <span class="keyword">self</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">makeNSView</span><span class="params">(context: NSViewRepresentableContext&lt;MySegmentControl&gt;)</span></span> -&gt; <span class="type">NSSegmentedControl</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> control = <span class="type">NSSegmentedControl</span>(</span><br><span class="line">            images: [</span><br><span class="line">                <span class="type">NSImage</span>(named: <span class="type">NSImage</span>.<span class="type">Name</span>(<span class="string">"grid"</span>))!,</span><br><span class="line">                <span class="type">NSImage</span>(named: <span class="type">NSImage</span>.<span class="type">Name</span>(<span class="string">"list"</span>))!</span><br><span class="line">            ],</span><br><span class="line">            trackingMode: .selectOne,</span><br><span class="line">            target: context.coordinator,</span><br><span class="line">            action: #selector(<span class="type">Coordinator</span>.onChange(<span class="number">_</span>:))</span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">return</span> control</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">updateNSView</span><span class="params">(<span class="number">_</span> nsView: NSSegmentedControl, context: NSViewRepresentableContext&lt;MySegmentControl&gt;)</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Coordinator</span> </span>&#123;</span><br><span class="line">        <span class="keyword">let</span> parent: <span class="type">MySegmentControl</span></span><br><span class="line">        <span class="keyword">init</span>(parent: <span class="type">MySegmentControl</span>) &#123;</span><br><span class="line">            <span class="keyword">self</span>.parent = parent</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@objc</span></span><br><span class="line">        <span class="function"><span class="keyword">func</span> <span class="title">onChange</span><span class="params">(<span class="number">_</span> control: NSSegmentedControl)</span></span> &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-03-20T04:22:45.000Z" title="2020-03-20T04:22:45.000Z">2020-03-20</time><span class="level-item">a few seconds read (About 78 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-check-if-NSColor-is-light/">How to check if NSColor is light</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/627">#627</a></strong></p>
<p>Algorithm from <a href="https://www.w3.org/WAI/ER/WD-AERT/#color-contrast">https://www.w3.org/WAI/ER/WD-AERT/#color-contrast</a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">NSColor</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> isLight: <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">guard</span></span><br><span class="line">            <span class="keyword">let</span> components = cgColor.components,</span><br><span class="line">            components.<span class="built_in">count</span> &gt;= <span class="number">3</span></span><br><span class="line">        <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">false</span> &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> brightness = ((components[<span class="number">0</span>] * <span class="number">299</span>) + (components[<span class="number">1</span>] * <span class="number">587</span>) + (components[<span class="number">2</span>] * <span class="number">114</span>)) / <span class="number">1000</span></span><br><span class="line">        <span class="keyword">return</span> brightness &gt; <span class="number">0.5</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Then we  can apply  contrast color for our Text</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Text</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">applyColorBaseOnBackground</span><span class="params">(<span class="number">_</span> color: NSColor?)</span></span> -&gt; some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> color = color <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="keyword">self</span> &#125;</span><br><span class="line">        <span class="keyword">if</span> color.isMyLight &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">self</span>.foregroundColor(<span class="type">Color</span>.black)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">self</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-03-18T20:22:56.000Z" title="2020-03-18T20:22:56.000Z">2020-03-18</time><span class="level-item">a few seconds read (About 104 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-trigger-onAppear-in-SwiftUI-for-macOS/">How to trigger onAppear in SwiftUI for macOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/626">#626</a></strong></p>
<p>SwiftUI does not trigger onAppear and onDisappear like  we expect. We can use NSView to trigger</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">AppearAware</span>: <span class="title">NSViewRepresentable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> onAppear: () -&gt; <span class="type">Void</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">makeNSView</span><span class="params">(context: NSViewRepresentableContext&lt;AppearAware&gt;)</span></span> -&gt; <span class="type">AwareView</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> view = <span class="type">AwareView</span>()</span><br><span class="line">        view.onAppear = onAppear</span><br><span class="line">        <span class="keyword">return</span> view</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">updateNSView</span><span class="params">(<span class="number">_</span> nsView: AwareView, context: NSViewRepresentableContext&lt;AppearAware&gt;)</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">AwareView</span>: <span class="title">NSView</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> trigged: <span class="type">Bool</span> = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">var</span> onAppear: () -&gt; <span class="type">Void</span> = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidMoveToSuperview</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidMoveToSuperview()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">guard</span> !trigged <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">        trigged = <span class="literal">true</span></span><br><span class="line">        onAppear()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Then we can use it as an hidden view, like in a ZStack</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ZStack</span> &#123;</span><br><span class="line">    <span class="type">AppearAware</span>(onAppear: &#123;</span><br><span class="line">        <span class="type">LocalImageCache</span>.shared.load(url: url) &#123; image <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">self</span>.image = image</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="type">Image</span>(image)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-03-17T21:50:00.000Z" title="2020-03-17T21:50:00.000Z">2020-03-17</time><span class="level-item">a few seconds read (About 58 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-force-refresh-in-ForEach-in-SwiftUI-for-macOS/">How to force refresh in ForEach in SwiftUI for macOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/625">#625</a></strong></p>
<p>For some strange reasons, content inside ForEach does not update with changes in Core Data NSManagedObject. The workaround is to introduce salt, like UUID just to make state change</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">NoteRow</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> note: <span class="type">Note</span></span><br><span class="line">    <span class="keyword">let</span> id: <span class="type">UUID</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">List</span> &#123;</span><br><span class="line">    <span class="type">ForEach</span>(notes) &#123; note <span class="keyword">in</span></span><br><span class="line">        <span class="type">NoteRow</span>(note: note, id: <span class="type">UUID</span>())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>Updated at</strong> 2020-11-20 03:29:39</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-03-17T04:48:44.000Z" title="2020-03-17T04:48:44.000Z">2020-03-17</time><span class="level-item">2 minutes read (About 342 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-access-bookmark-url-in-macOS/">How to access bookmark url in macOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/624">#624</a></strong></p>
<blockquote>
<p>By default the approaches above grant you access while the app remains open. When you quit the app, any folder access you had is lost.</p>
</blockquote>
<blockquote>
<p>To gain persistent access to a folder even on subsequent launches, we’ll have to take advantage of a system called Security-Scoped Bookmarks.</p>
</blockquote>
<p>Add entitlements</p>
<blockquote>
<p>Use of app-scoped bookmarks and URLs</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">key</span>&gt;</span>com.apple.security.files.user-selected.read-only<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">true</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">key</span>&gt;</span>com.apple.security.files.bookmarks.app-scope<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">true</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p><a href="https://developer.apple.com/library/archive/documentation/Miscellaneous/Reference/EntitlementKeyReference/Chapters/EnablingAppSandbox.html#//apple_ref/doc/uid/TP40011195-CH4-SW18">Enabling Security-Scoped Bookmark and URL Access</a></p>
<blockquote>
<p>If you want to provide your sandboxed app with persistent access to file system resources, you must enable security-scoped bookmark and URL access. Security-scoped bookmarks are available starting in macOS v10.7.3.</p>
</blockquote>
<blockquote>
<p>To add the bookmarks.app-scope or bookmarks.document-scope entitlement, edit the target’s .entitlements property list file using the Xcode property list editor. Use the entitlement keys shown in Table 4-4, depending on which type of access you want. Use a value of <true/> for each entitlement you want to enable. You can enable either or both entitlements.</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">saveBookmark</span><span class="params">(item: ShortcutItem)</span></span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> url = item.fileUrl <span class="keyword">else</span> &#123; <span class="keyword">return</span>  &#125;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> bookmarkData = <span class="keyword">try</span> url.bookmarkData(</span><br><span class="line">            options: .withSecurityScope,</span><br><span class="line">            includingResourceValuesForKeys: <span class="literal">nil</span>,</span><br><span class="line">            relativeTo: <span class="literal">nil</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        item.bookmark = bookmarkData</span><br><span class="line">    &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Failed to save bookmark data for \(url)"</span>, error)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">loadBookmark</span><span class="params">(item: ShortcutItem)</span></span> -&gt; <span class="type">URL?</span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> data = item.bookmark <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> isStale = <span class="literal">false</span></span><br><span class="line">        <span class="keyword">let</span> url = <span class="keyword">try</span> <span class="type">URL</span>(</span><br><span class="line">            resolvingBookmarkData: data,</span><br><span class="line">            options: .withSecurityScope,</span><br><span class="line">            relativeTo: <span class="literal">nil</span>,</span><br><span class="line">            bookmarkDataIsStale: &amp;isStale</span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">if</span> isStale &#123;</span><br><span class="line">            saveBookmark(item: item)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> url</span><br><span class="line">    &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Error resolving bookmark:"</span>, error)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">_</span> = url.startAccessingSecurityScopedResource()</span><br><span class="line"><span class="type">NSWorkspace</span>.shared.<span class="keyword">open</span>(url)</span><br><span class="line">url.stopAccessingSecurityScopedResource()</span><br></pre></td></tr></table></figure>

<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">_</span> = url.startAccessingSecurityScopedResource()</span><br><span class="line"><span class="type">NSWorkspace</span>.shared.selectFile(</span><br><span class="line">    url.path,</span><br><span class="line">    inFileViewerRootedAtPath: url.deletingLastPathComponent().path</span><br><span class="line">)</span><br><span class="line">url.stopAccessingSecurityScopedResource()</span><br></pre></td></tr></table></figure>

<h2 id="Read-more"><a href="#Read-more" class="headerlink" title="Read more"></a>Read more</h2><ul>
<li><a href="https://benscheirman.com/2019/10/troubleshooting-appkit-file-permissions/">Modern AppKit File Permissions</a></li>
<li><a href="https://stackoverflow.com/questions/42179567/what-does-startaccessingsecurityscopedresource-actually-do">https://stackoverflow.com/questions/42179567/what-does-startaccessingsecurityscopedresource-actually-do</a></li>
<li><a href="https://developer.apple.com/library/archive/documentation/Miscellaneous/Reference/EntitlementKeyReference/Chapters/EnablingAppSandbox.html">Enabling App Sandbox</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-03-13T05:39:49.000Z" title="2020-03-13T05:39:49.000Z">2020-03-13</time><span class="level-item">a minute read (About 126 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-make-TextField-focus-in-SwiftUI-for-macOS/">How to make TextField focus in SwiftUI for macOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/620">#620</a></strong></p>
<p>For <code>NSWindow</code> having <code>level</code>other than <code>.normal</code>, need  to override key and main  property to allow TextField to be focusable</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FocusWindow</span>: <span class="title">NSWindow</span> </span>&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">var</span> canBecomeKey: <span class="type">Bool</span>  &#123; <span class="literal">true</span> &#125;</span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">var</span> canBecomeMain: <span class="type">Bool</span> &#123; <span class="literal">true</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Furthermore to customize TextField, consider  using custom</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> AppKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">MyTextField</span>: <span class="title">NSViewRepresentable</span> </span>&#123;</span><br><span class="line">    @<span class="type">Binding</span> <span class="keyword">var</span> text: <span class="type">String</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">makeNSView</span><span class="params">(context: NSViewRepresentableContext&lt;MyTextField&gt;)</span></span> -&gt; <span class="type">NSTextField</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> tf = <span class="type">NSTextField</span>()</span><br><span class="line">        tf.focusRingType = .<span class="keyword">none</span></span><br><span class="line">        tf.isBordered = <span class="literal">false</span></span><br><span class="line">        tf.drawsBackground = <span class="literal">false</span></span><br><span class="line">        tf.delegate = context.coordinator</span><br><span class="line">        <span class="keyword">return</span> tf</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">updateNSView</span><span class="params">(<span class="number">_</span> nsView: NSTextField, context: NSViewRepresentableContext&lt;MyTextField&gt;)</span></span> &#123;</span><br><span class="line">        nsView.stringValue = text</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">makeCoordinator</span><span class="params">()</span></span> -&gt; <span class="type">MyTextField</span>.<span class="type">Coordinator</span> &#123;</span><br><span class="line">        <span class="type">Coordinator</span>(parent: <span class="keyword">self</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Coordinator</span>: <span class="title">NSObject</span>, <span class="title">NSTextFieldDelegate</span>  </span>&#123;</span><br><span class="line">        <span class="keyword">let</span> parent: <span class="type">MyTextField</span></span><br><span class="line">        <span class="keyword">init</span>(parent: <span class="type">MyTextField</span>) &#123;</span><br><span class="line">            <span class="keyword">self</span>.parent = parent</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">func</span> <span class="title">controlTextDidChange</span><span class="params">(<span class="number">_</span> obj: Notification)</span></span> &#123;</span><br><span class="line">            <span class="keyword">let</span> textField = obj.object <span class="keyword">as</span>! <span class="type">NSTextField</span></span><br><span class="line">            parent.text = textField.stringValue</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-03-11T20:42:03.000Z" title="2020-03-11T20:42:03.000Z">2020-03-11</time><span class="level-item">a few seconds read (About 99 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-make-tooltip-in-SwiftUI-for-macOS/">How to make tooltip in SwiftUI for macOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/617">#617</a></strong></p>
<p>Create empty NSView and use as overlay. Need  to <code>updateNSView</code> in case we toggle the state of tooltip</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Tooltip</span>: <span class="title">NSViewRepresentable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> tooltip: <span class="type">String</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">makeNSView</span><span class="params">(context: NSViewRepresentableContext&lt;Tooltip&gt;)</span></span> -&gt; <span class="type">NSView</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> view = <span class="type">NSView</span>()</span><br><span class="line">        view.toolTip = tooltip</span><br><span class="line">        <span class="keyword">return</span> view</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">updateNSView</span><span class="params">(<span class="number">_</span> nsView: NSView, context: NSViewRepresentableContext&lt;Tooltip&gt;)</span></span> &#123;</span><br><span class="line">        nsView.toolTip = tooltip</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Button</span>(action: <span class="keyword">self</span>.onGear) &#123;</span><br><span class="line">    <span class="type">Image</span>(<span class="string">"gear"</span>)</span><br><span class="line">        .styleButton()</span><br><span class="line">&#125;</span><br><span class="line">.overlay(<span class="type">Tooltip</span>(tooltip: <span class="string">"Settings"</span>))</span><br><span class="line">.buttonStyle(<span class="type">BorderlessButtonStyle</span>())</span><br></pre></td></tr></table></figure>

<p>Sometimes  it’s better to add overlay tooltip to Image inside Button to avoid blocking</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Button</span>(action: <span class="keyword">self</span>.onGear) &#123;</span><br><span class="line">    <span class="type">Image</span>(<span class="string">"gear"</span>)</span><br><span class="line">        .styleButton()</span><br><span class="line">       .overlay(<span class="type">Tooltip</span>(tooltip: <span class="string">"Settings"</span>))</span><br><span class="line">&#125;</span><br><span class="line">.buttonStyle(<span class="type">BorderlessButtonStyle</span>())</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-03-05T04:31:15.000Z" title="2020-03-05T04:31:15.000Z">2020-03-05</time><span class="level-item">a few seconds read (About 19 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-make-translucent-SwiftUI-List-in-macOS/">How to make translucent SwiftUI List in macOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/615">#615</a></strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">List</span> &#123;</span><br><span class="line">    <span class="type">ForEach</span>(books) &#123; (book: <span class="type">Book</span>) <span class="keyword">in</span></span><br><span class="line">        <span class="type">BookRow</span>(book: book)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">.listStyle(<span class="type">SidebarListStyle</span>())</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-03-02T18:17:49.000Z" title="2020-03-02T18:17:49.000Z">2020-03-02</time><span class="level-item">a minute read (About 196 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-present-NSWindow-modally/">How to present NSWindow modally</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/612">#612</a></strong></p>
<p>Use <a href="https://developer.apple.com/documentation/appkit/nsapplication/1428436-runmodal">runModal</a></p>
<blockquote>
<p>This method runs a modal event loop for the specified window synchronously. It displays the specified window, makes it key, starts the run loop, and processes events for that window. (You do not need to show the window yourself.) While the app is in that loop, it does not respond to any other events (including mouse, keyboard, or window-close events) unless they are associated with the window. It also does not perform any tasks (such as firing timers) that are not associated with the modal run loop. In other words, this method consumes only enough CPU time to process events and dispatch them to the action methods associated with the modal window.</p>
</blockquote>
<p>Specify <code>level</code> in <code>windowDidBecomeKey</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> controller = <span class="type">SettingsWindowController</span>()</span><br><span class="line"><span class="type">NSApp</span>.runModal(<span class="keyword">for</span>: controller.window!)</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">SettingsWindowController</span>: <span class="title">NSWindowController</span>, <span class="title">NSWindowDelegate</span> </span>&#123;</span><br><span class="line">    <span class="keyword">init</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> mainView = <span class="type">SettingsView</span>()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> window = <span class="type">NSWindow</span>(</span><br><span class="line">            contentRect: <span class="type">CGRect</span>(x: <span class="number">0</span>, y: <span class="number">0</span>, width: <span class="number">500</span>, height: <span class="number">300</span>),</span><br><span class="line">            styleMask: [.titled, .closable],</span><br><span class="line">            backing: .buffered,</span><br><span class="line">            <span class="keyword">defer</span>: <span class="literal">false</span></span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">let</span> hosting = <span class="type">NSHostingView</span>(rootView: mainView)</span><br><span class="line">        window.contentView = hosting</span><br><span class="line"></span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(window: window)</span><br><span class="line">        window.delegate = <span class="keyword">self</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">windowDidBecomeKey</span><span class="params">(<span class="number">_</span> notification: Notification)</span></span> &#123;</span><br><span class="line">        window?.level = .statusBar</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">windowWillClose</span><span class="params">(<span class="number">_</span> notification: Notification)</span></span> &#123;</span><br><span class="line">        <span class="type">NSApp</span>.stopModal()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-02-27T04:37:40.000Z" title="2020-02-27T04:37:40.000Z">2020-02-27</time><span class="level-item">a few seconds read (About 98 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-use-visual-effect-view-in-NSWindow/">How to use visual effect view in NSWindow</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/610">#610</a></strong></p>
<p>Set <code>NSVisualEffectView</code> as contentView of NSWindow, and our main view as subview of it. Remember to set frame or autoresizing mask as non-direct content view does not get full size as the window</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> mainView = <span class="type">MainView</span>()</span><br><span class="line">    .environment(\.managedObjectContext, coreDataManager.container.viewContext)</span><br><span class="line"></span><br><span class="line">window = <span class="type">NSWindow</span>(</span><br><span class="line">    contentRect: .zero,</span><br><span class="line">    styleMask: [.fullSizeContentView],</span><br><span class="line">    backing: .buffered,</span><br><span class="line">    <span class="keyword">defer</span>: <span class="literal">false</span></span><br><span class="line">)</span><br><span class="line">window.titlebarAppearsTransparent = <span class="literal">true</span></span><br><span class="line">window.center()</span><br><span class="line">window.level = .statusBar</span><br><span class="line">window.setFrameAutosaveName(<span class="string">"MyApp"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> visualEffect = <span class="type">NSVisualEffectView</span>()</span><br><span class="line">visualEffect.blendingMode = .behindWindow</span><br><span class="line">visualEffect.state = .active</span><br><span class="line">visualEffect.material = .appearanceBased</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> hosting = <span class="type">NSHostingView</span>(rootView: mainView)</span><br><span class="line">window.contentView = visualEffect</span><br><span class="line">visualEffect.addSubview(hosting)</span><br><span class="line">hosting.autoresizingMask = [.width, .height]</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-02-23T19:42:44.000Z" title="2020-02-23T19:42:44.000Z">2020-02-23</time><span class="level-item">a few seconds read (About 42 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-animate-NSWindow/">How to animate NSWindow</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/609">#609</a></strong></p>
<p>Use <code>animator</code> proxy and <code>animate</code> parameter</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> rect = window.frame</span><br><span class="line">rect.frame.origin.x = <span class="number">1000</span></span><br><span class="line"><span class="type">NSAnimationContext</span>.runAnimationGroup(&#123; context <span class="keyword">in</span></span><br><span class="line">    context.timingFunction = <span class="type">CAMediaTimingFunction</span>(name: .easeIn)</span><br><span class="line">    window.animator().setFrame(rect, display: <span class="literal">true</span>, animate: <span class="literal">true</span>)</span><br><span class="line">&#125;, completionHandler: &#123;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><strong>Updated at</strong> 2020-11-22 18:26:33</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-02-22T21:24:08.000Z" title="2020-02-22T21:24:08.000Z">2020-02-22</time><span class="level-item">a few seconds read (About 32 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-find-active-application-in-macOS/">How to find active application in macOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/608">#608</a></strong></p>
<blockquote>
<p>An NSRunningApplication instance for the current application.</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">NSRunningApplication</span>.current</span><br></pre></td></tr></table></figure>

<blockquote>
<p>The running app instance for the app that receives key events.</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">NSWorkspace</span>.shared.frontmostApplication</span><br></pre></td></tr></table></figure>


</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-02-12T20:39:53.000Z" title="2020-02-12T20:39:53.000Z">2020-02-12</time><span class="level-item">a few seconds read (About 38 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-use-application-will-terminate-in-macOS/">How to use application will terminate in macOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/601">#601</a></strong></p>
<p>On Xcode 11, <code>applicationWillTerminate</code> is not called because of default automatic termination on in Info.plist. Removing <code>NSSupportsSuddenTermination</code> to trigger will terminate notification</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">applicationWillTerminate</span><span class="params">(<span class="number">_</span> notification: Notification)</span></span> &#123;</span><br><span class="line">    save()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">key</span>&gt;</span>NSSupportsAutomaticTermination<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">true</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">key</span>&gt;</span>NSSupportsSuddenTermination<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">true</span>/&gt;</span></span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-02-04T05:10:59.000Z" title="2020-02-04T05:10:59.000Z">2020-02-04</time><span class="level-item">a few seconds read (About 33 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-change-background-color-in-List-in-SwiftUI-for-macOS/">How to change background color in List in SwiftUI for macOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/595">#595</a></strong></p>
<p>SwiftUI uses <code>ListCoreScrollView</code> and <code>ListCoreClipView</code> under the hood. For now the workaround, is to avoid using <code>List</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">List</span> &#123;</span><br><span class="line">    <span class="type">ForEach</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>use</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">VStack</span> &#123;</span><br><span class="line">    <span class="type">ForEach</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>Updated at</strong> 2020-08-14 07:26:27</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-02-02T05:34:09.000Z" title="2020-02-02T05:34:09.000Z">2020-02-02</time><span class="level-item">a few seconds read (About 39 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-weak-link-Combine-in-macOS-10.14-and-iOS-12/">How to weak link Combine in macOS 10.14 and iOS 12</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/593">#593</a></strong></p>
<p><code>#if canImport(Combine)</code> is not enough, need to specify in Other Linker Flags</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">OTHER_LDFLAGS &#x3D; -weak_framework Combine</span><br></pre></td></tr></table></figure>

<h2 id="Read-more"><a href="#Read-more" class="headerlink" title="Read more"></a>Read more</h2><ul>
<li><a href="https://stackoverflow.com/questions/57168931/optional-linking-for-swift-combine-framework-in-xcode-11">https://stackoverflow.com/questions/57168931/optional-linking-for-swift-combine-framework-in-xcode-11</a></li>
</ul>
</div></article></div><nav class="pagination is-centered mt-4" role="navigation" aria-label="pagination"><div class="pagination-previous is-invisible is-hidden-mobile"><a href="/tags/macOS/page/0/">Previous</a></div><div class="pagination-next"><a href="/tags/macOS/page/2/">Next</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link is-current" href="/tags/macOS/">1</a></li><li><a class="pagination-link" href="/tags/macOS/page/2/">2</a></li><li><a class="pagination-link" href="/tags/macOS/page/3/">3</a></li><li><a class="pagination-link" href="/tags/macOS/page/4/">4</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="" src="https://avatars1.githubusercontent.com/u/2284279?s=460&amp;v=4" alt="onmyway133"></figure><p class="title is-size-4 is-block line-height-inherit">onmyway133</p><p class="is-size-6 is-block">iOS, macOS, Android, React. Serial maker. Writer. Speaker.</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Oslo, Norway</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">656</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">52</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/onmyway133" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/onmyway133"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com/onmyway133"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile is-mobile" href="https://onmyway133.com/apps" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Apps</span></span><span class="level-right"><span class="level-item tag">onmyway133.com</span></span></a></li><li><a class="level is-mobile is-mobile" href="https://learntalks.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Learn Talks</span></span><span class="level-right"><span class="level-item tag">learntalks.com</span></span></a></li></ul></div></div></div><!--!--><div class="card widget"><div class="card-content"><h3 class="menu-label">Recent</h3><article class="media"><div class="media-content size-small"><p><time dateTime="2020-12-07T10:24:19.000Z">2020-12-07</time></p><p class="title is-6"><a class="link-muted" href="/blog/How-to-mock-UNNotificationResponse-in-unit-tests/">How to mock UNNotificationResponse in unit tests</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-12-07T05:16:58.000Z">2020-12-07</time></p><p class="title is-6"><a class="link-muted" href="/blog/How-to-support-right-click-menu-to-NSStatusItem/">How to support right click menu to NSStatusItem</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-12-07T05:04:21.000Z">2020-12-07</time></p><p class="title is-6"><a class="link-muted" href="/blog/How-to-convert-struct-to-Core-Data-NSManagedObject/">How to convert struct to Core Data NSManagedObject</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-12-05T05:00:44.000Z">2020-12-05</time></p><p class="title is-6"><a class="link-muted" href="/blog/How-to-format-ISO-date-string-in-Javascript/">How to format ISO date string in Javascript</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-12-05T04:31:35.000Z">2020-12-05</time></p><p class="title is-6"><a class="link-muted" href="/blog/How-to-declare-Error-in-Swift/">How to declare Error in Swift</a></p><p class="is-uppercase"></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/archives/2020/12/"><span class="level-start"><span class="level-item">December 2020</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/11/"><span class="level-start"><span class="level-item">November 2020</span></span><span class="level-end"><span class="level-item tag">15</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/10/"><span class="level-start"><span class="level-item">October 2020</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/09/"><span class="level-start"><span class="level-item">September 2020</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/08/"><span class="level-start"><span class="level-item">August 2020</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/06/"><span class="level-start"><span class="level-item">June 2020</span></span><span class="level-end"><span class="level-item tag">14</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/05/"><span class="level-start"><span class="level-item">May 2020</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/04/"><span class="level-start"><span class="level-item">April 2020</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/03/"><span class="level-start"><span class="level-item">March 2020</span></span><span class="level-end"><span class="level-item tag">21</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/02/"><span class="level-start"><span class="level-item">February 2020</span></span><span class="level-end"><span class="level-item tag">20</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/01/"><span class="level-start"><span class="level-item">January 2020</span></span><span class="level-end"><span class="level-item tag">30</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/12/"><span class="level-start"><span class="level-item">December 2019</span></span><span class="level-end"><span class="level-item tag">36</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/11/"><span class="level-start"><span class="level-item">November 2019</span></span><span class="level-end"><span class="level-item tag">38</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/10/"><span class="level-start"><span class="level-item">October 2019</span></span><span class="level-end"><span class="level-item tag">49</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/09/"><span class="level-start"><span class="level-item">September 2019</span></span><span class="level-end"><span class="level-item tag">50</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/08/"><span class="level-start"><span class="level-item">August 2019</span></span><span class="level-end"><span class="level-item tag">39</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/07/"><span class="level-start"><span class="level-item">July 2019</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/06/"><span class="level-start"><span class="level-item">June 2019</span></span><span class="level-end"><span class="level-item tag">41</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/05/"><span class="level-start"><span class="level-item">May 2019</span></span><span class="level-end"><span class="level-item tag">49</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/04/"><span class="level-start"><span class="level-item">April 2019</span></span><span class="level-end"><span class="level-item tag">27</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/03/"><span class="level-start"><span class="level-item">March 2019</span></span><span class="level-end"><span class="level-item tag">24</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/02/"><span class="level-start"><span class="level-item">February 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/12/"><span class="level-start"><span class="level-item">December 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/05/"><span class="level-start"><span class="level-item">May 2018</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/04/"><span class="level-start"><span class="level-item">April 2018</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/02/"><span class="level-start"><span class="level-item">February 2018</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/01/"><span class="level-start"><span class="level-item">January 2018</span></span><span class="level-end"><span class="level-item tag">14</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/12/"><span class="level-start"><span class="level-item">December 2017</span></span><span class="level-end"><span class="level-item tag">14</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/11/"><span class="level-start"><span class="level-item">November 2017</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/10/"><span class="level-start"><span class="level-item">October 2017</span></span><span class="level-end"><span class="level-item tag">18</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/09/"><span class="level-start"><span class="level-item">September 2017</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/08/"><span class="level-start"><span class="level-item">August 2017</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/07/"><span class="level-start"><span class="level-item">July 2017</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/06/"><span class="level-start"><span class="level-item">June 2017</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/05/"><span class="level-start"><span class="level-item">May 2017</span></span><span class="level-end"><span class="level-item tag">36</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/04/"><span class="level-start"><span class="level-item">April 2017</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/algorithm/"><span class="tag">algorithm</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/android/"><span class="tag">android</span><span class="tag is-grey-lightest">34</span></a></div><div class="control"><a class="tags has-addons" href="/tags/apple-script/"><span class="tag">apple script</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/catalyst/"><span class="tag">catalyst</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ci/"><span class="tag">ci</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cloud/"><span class="tag">cloud</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cocoapods/"><span class="tag">cocoapods</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/combine/"><span class="tag">combine</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/core-data/"><span class="tag">core data</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/csharp/"><span class="tag">csharp</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/css/"><span class="tag">css</span><span class="tag is-grey-lightest">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/dart/"><span class="tag">dart</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/database/"><span class="tag">database</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/design/"><span class="tag">design</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/electron/"><span class="tag">electron</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/firebase/"><span class="tag">firebase</span><span class="tag is-grey-lightest">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/flutter/"><span class="tag">flutter</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/git/"><span class="tag">git</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/github/"><span class="tag">github</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/go/"><span class="tag">go</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/google/"><span class="tag">google</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/iOS/"><span class="tag">iOS</span><span class="tag is-grey-lightest">165</span></a></div><div class="control"><a class="tags has-addons" href="/tags/javascript/"><span class="tag">javascript</span><span class="tag is-grey-lightest">50</span></a></div><div class="control"><a class="tags has-addons" href="/tags/kotlin/"><span class="tag">kotlin</span><span class="tag is-grey-lightest">27</span></a></div><div class="control"><a class="tags has-addons" href="/tags/layout/"><span class="tag">layout</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/life/"><span class="tag">life</span><span class="tag is-grey-lightest">11</span></a></div><div class="control"><a class="tags has-addons" href="/tags/links/"><span class="tag">links</span><span class="tag is-grey-lightest">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/macOS/"><span class="tag">macOS</span><span class="tag is-grey-lightest">108</span></a></div><div class="control"><a class="tags has-addons" href="/tags/machine-learning/"><span class="tag">machine learning</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/maps/"><span class="tag">maps</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/networking/"><span class="tag">networking</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/node/"><span class="tag">node</span><span class="tag is-grey-lightest">11</span></a></div><div class="control"><a class="tags has-addons" href="/tags/objc/"><span class="tag">objc</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/react/"><span class="tag">react</span><span class="tag is-grey-lightest">23</span></a></div><div class="control"><a class="tags has-addons" href="/tags/react-native/"><span class="tag">react native</span><span class="tag is-grey-lightest">14</span></a></div><div class="control"><a class="tags has-addons" href="/tags/realm/"><span class="tag">realm</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/rx/"><span class="tag">rx</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/script/"><span class="tag">script</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/spm/"><span class="tag">spm</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/swift/"><span class="tag">swift</span><span class="tag is-grey-lightest">305</span></a></div><div class="control"><a class="tags has-addons" href="/tags/swiftUI/"><span class="tag">swiftUI</span><span class="tag is-grey-lightest">66</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tech/"><span class="tag">tech</span><span class="tag is-grey-lightest">14</span></a></div><div class="control"><a class="tags has-addons" href="/tags/terminal/"><span class="tag">terminal</span><span class="tag is-grey-lightest">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/testing/"><span class="tag">testing</span><span class="tag is-grey-lightest">17</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tool/"><span class="tag">tool</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/unity/"><span class="tag">unity</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/voip/"><span class="tag">voip</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/watchOS/"><span class="tag">watchOS</span><span class="tag is-grey-lightest">11</span></a></div><div class="control"><a class="tags has-addons" href="/tags/web/"><span class="tag">web</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/work/"><span class="tag">work</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/wwdc/"><span class="tag">wwdc</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/xcode/"><span class="tag">xcode</span><span class="tag is-grey-lightest">24</span></a></div></div></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Subscribe to Updates</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=c2r59mmt2n5k0o5dt5vv3nq4u4&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="c2r59mmt2n5k0o5dt5vv3nq4u4" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button is-primary" type="submit" value="Subscribe"></div></div></form></div></div></div><div class="card widget"><div class="card-content"><div class="notification is-danger">You need to set <code>client_id</code> and <code>slot_id</code> to show this AD unit. Please set it in <code>_config.yml</code>.</div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/z.png" alt="onmyway133" height="28"></a><p class="size-small"><span>&copy; 2020 Khoa Pham</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/onmyway133"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            site: {
                url: 'https://onmyway133.github.io',
                external_link: {"enable":true,"exclude":[]}
            },
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to Top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>