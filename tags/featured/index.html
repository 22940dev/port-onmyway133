<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="generator" content="Hexo 4.2.0"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Tag: featured - onmyway133</title><meta description="What you don&amp;#39;t know is what you haven&amp;#39;t learned"><meta property="og:type" content="blog"><meta property="og:title" content="onmyway133"><meta property="og:url" content="https://onmyway133.github.io/"><meta property="og:site_name" content="onmyway133"><meta property="og:description" content="What you don&amp;#39;t know is what you haven&amp;#39;t learned"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://onmyway133.github.io/img/og_image.png"><meta property="article:author" content="Khoa Pham"><meta property="article:tag" content="ios"><meta property="article:tag" content=" android"><meta property="article:tag" content="javascript"><meta property="article:tag" content=" react"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><meta property="twitter:creator" content="@onmyway133"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://onmyway133.github.io"},"headline":"onmyway133","image":["https://onmyway133.github.io/img/og_image.png"],"author":{"@type":"Person","name":"Khoa Pham"},"description":"What you don&#39;t know is what you haven&#39;t learned"}</script><link rel="alternative" href="/atom.xml" title="onmyway133" type="application/atom+xml"><link rel="icon" href="/img/favicon.ico"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=UA-40119591-5" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'UA-40119591-5');</script><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><script data-ad-client="ca-pub-3656459401405265" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" async></script></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/z.png" alt="onmyway133" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/apps">Apps</a><a class="navbar-item" href="/gumroad">Gumroad</a><a class="navbar-item" href="/about">About</a><a class="navbar-item" href="/opensource">Open Source</a><a class="navbar-item" href="/writing">Writing</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/speaking">Speaking</a><a class="navbar-item" href="/news">News</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/onmyway133"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/tags">Tags</a></li><li class="is-active"><a href="#" aria-current="page">featured</a></li></ul></nav></div></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2021-01-06T12:13:34.000Z" title="2021-01-06T12:13:34.000Z">2021-01-06</time><span class="level-item">17 minutes read (About 2504 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-simplify-communication-patterns-with-closure-in-Swift/">How to simplify communication patterns with closure in Swift</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/744">#744</a></strong></p>
<p>As someone who builds lots of <a href="https://onmyway133.com">apps</a>, I try to find quick ways to do things. One of them is to avoid repetitive and cumbersome APIs. That’s why I built <a href="https://github.com/onmyway133/Anchors">Anchors</a> to <a href="https://onmyway133.com/blog/how-to-make-auto-layout-more-convenient-in-ios/">make Auto Layout more convenient</a>, <a href="https://github.com/onmyway133/Omnia">Omnia</a> to add missing extensions. The next thing in the itchy list is the many ways to communicate among objects in iOS and macOS development that can be very annoying sometimes.</p>
<p>This post is my take on tackling some communication patterns issue and how to make it simpler with <a href="https://github.com/onmyway133/EasyClosure">EasyClosure</a>. The learning applies for both iOS and macOS development, and code is in Swift 5.</p>
<h3 id="Table-of-Contents"><a href="#Table-of-Contents" class="headerlink" title="Table of Contents"></a>Table of Contents</h3><ul>
<li><a href="">The many communication patterns</a></li>
<li><a href="">Associated objects</a></li>
<li><a href="">Protocol with associated type</a></li>
<li><a href="e">Action to RxSwift observable</a></li>
<li><a href="">Timer keeps a strong reference to its target</a></li>
<li><a href="">Key-value observing in Swift 5</a></li>
<li><a href="">Block-based Notification Center</a></li>
</ul>
<h2 id="The-many-communication-patterns"><a href="#The-many-communication-patterns" class="headerlink" title="The many communication patterns"></a>The many communication patterns</h2><p>In iOS, we can handle button tap by using addTarget which is a function that any UIControl has:</p>
<pre><code>let button = UIButton()
button.addTarget(self, action: #selector(buttonTouched(_:)), for: .touchUpInside)

@objc func buttonTouched(_ sender: UIButton) {}</code></pre><p>In macOS, due to historical reasons, the syntax is a bit different:</p>
<pre><code>button.target = self
button.action = #selector(buttonTouched(_:))

@objc func buttonTouched(_ sender: NSButton) {}</code></pre><p>The more complex the app, the more we need to split responsibilities for classes and make them communicate. Target action is not the only way for objects communication, there are delegates, notification center, KVO and blocks. All of these are used all over the placed within iOS SDKs. Not only do we have to be aware of syntax differences, but we also have to care about how and when to use one over another.</p>
<p>This article Communication Patterns from objc.io is my favorite and many of the principles still hold true for now.</p>
<p><img src="https://cdn-images-1.medium.com/max/2268/0*sr1z90rXBwO-GS3K.png" alt="[https://www.objc.io/issues/7-foundation/communication-patterns/](https://www.objc.io/issues/7-foundation/communication-patterns/)"><em><a href="https://www.objc.io/issues/7-foundation/communication-patterns/">https://www.objc.io/issues/7-foundation/communication-patterns/</a></em></p>
<p>As I do many apps, I’m a bit baffled by cumbersome APIs, I wish I could write code in a more succinct and convenient way. Something like:</p>
<pre><code>button.on.tap { print(&quot;button was tapped&quot; }
user.on.propertyChange(\.name) { print(&quot;name has changed to \($0)&quot;}
tableView.on.tapRow { print(&quot;row \($0) was tapped&quot; }</code></pre><p>This may seem a bit overengineered and some of you may feel OK with the iOS APIs. I have to admit that I prefer explicit over the clever code, but in this case, we can make the APIs look a bit nicer. This is achieved with a less known featured in ObjC Runtime called associated objects.</p>
<p>In the old Objective C age, there was the famous <a href="https://github.com/BlocksKit/BlocksKit">BlocksKit</a> which allows us to deal with UIKit/AppKit in the handy block syntax. Although Objective C block is hard to declare, they are much more declarative than other communication patterns like delegate or handling UIAlert actions. And with the closure in Swift, we can do even nicer things.</p>
<h2 id="Associated-objects"><a href="#Associated-objects" class="headerlink" title="Associated objects"></a>Associated objects</h2><p>With Objective C category and Swift extension, we can’t add a stored property, that’s where associated objects come into play. The associated object allows us to attach other objects to the lifetime of any NSObject , with these 2 free functions objc_getAssociatedObject and objc_setAssociatedObject .</p>
<p>The associated object lies in the Objective C runtime category and can be considered hacky, but it has shown to be very effective in some scenarios.</p>
<h3 id="Detecting-object-deallocation"><a href="#Detecting-object-deallocation" class="headerlink" title="Detecting object deallocation"></a>Detecting object deallocation</h3><p>Since the associated object is attached to the host object, there’s this very handy use case that allows detection of the life cycle of the host object. We can, for example, observe UIViewControllerto tell if it has really been deallocated.</p>
<pre><code>class Notifier {
    deinit {
        print(&quot;host object was deinited&quot;)
    }
}

extension UIViewController {
    private struct AssociatedKeys {
        static var notifier = &quot;notifier&quot;
    }

var notifier: Notifier? {
        get {
            return objc_getAssociatedObject(self, &amp;AssociatedKeys.notifier) as? Notifier
        }

set {
            if let newValue = newValue {
                objc_setAssociatedObject(
                    self,
                    &amp;AssociatedKeys.notifier,
                    newValue as Notifier?,
                    .OBJC_ASSOCIATION_RETAIN_NONATOMIC
                )
            }
        }
    }
}</code></pre><p>Then if we at some time set the host object to nil, the associated object will be deallocated too, giving us a callback to handle to deinit event:</p>
<pre><code>var viewController: UIViewController? = UIViewController()
viewController?.notifier = Notifier()
viewController = nil
XCTAssertNil(viewController?.notifier)</code></pre><h3 id="Confusing-code-completion"><a href="#Confusing-code-completion" class="headerlink" title="Confusing code completion"></a>Confusing code completion</h3><p>If we’re gonna make the on extension to UIButton, UITableView, UIViewController we have to add the associated object into NSObject for all these classes to have on property.</p>
<pre><code>class On {
    func tap(_ closure: () -&gt; Void) {}
    func tapRow(_ closure: () -&gt; Void) {}
    func textChange(_ closure: () -&gt; Void) {}
}</code></pre><p>to NSObject:</p>
<pre><code>extension NSObject {
    private struct AssociatedKeys {
        static var on = &quot;on&quot;
    }

var on: On? {
        get {
            return objc_getAssociatedObject(self, &amp;AssociatedKeys.on) as? On
        }

set {
            if let newValue = newValue {
                objc_setAssociatedObject(
                    self,
                    &amp;AssociatedKeys.on,
                    newValue as On?,
                    .OBJC_ASSOCIATION_RETAIN_NONATOMIC
                )
            }
        }
    }
}</code></pre><p>This brings another problem with code completion, we can act on UIButton but Xcode still hints us about all methods on On , but for UIButton only tap and propertyChange are valid. The textChange is more for UITextField and UITextView:</p>
<pre><code>button.on.textChange {}</code></pre><h2 id="Protocol-with-associated-type"><a href="#Protocol-with-associated-type" class="headerlink" title="Protocol with associated type"></a>Protocol with associated type</h2><p>To remedy this awkward API, we can use a very sweet feature of Swift called protocol with an associated type. We start by introducing EasyClosureAware that has a host EasyClosureAwareHostType of type AnyObject. This means that this protocol is for any class that wants to attach itself to a host object.</p>
<pre><code>private struct AssociatedKey {
    static var key = &quot;EasyClosure_on&quot;
}

public protocol EasyClosureAware: class {
    associatedtype EasyClosureAwareHostType: AnyObject

var on: Container&lt;EasyClosureAwareHostType&gt; { get }
}

extension EasyClosureAware {
    public var on: Container&lt;Self&gt; {
        get {
            if let value = objc_getAssociatedObject(self, &amp;AssociatedKey.key) as? Container&lt;Self&gt; {
                return value
            }

let value = Container(host: self)
            objc_setAssociatedObject(self, &amp;AssociatedKey.key, value, .OBJC_ASSOCIATION_RETAIN_NONATOMIC)
            return value
        }
    }
}

extension NSObject: EasyClosureAware { }</code></pre><p>Then we confirm NSObject to EasyClosureAware so every NSObject subclass has the on property for free.</p>
<p>The Container is for containing all targets and to keep all target alive. With this approach we can wrap around any patterns like delegate, target action and KVO observer.</p>
<pre><code>public class Container&lt;Host: AnyObject&gt;: NSObject {
    public unowned let host: Host

    public init(host: Host) {
        self.host = host
    }

    // Keep all targets alive
    public var targets = [String: NSObject]()
}</code></pre><p>With this setup, we can easily apply to any object. For example UIButton:</p>
<pre><code>public extension Container where Host: UIButton {
    func tap(_ action: [@escaping](http://twitter.com/escaping) Action) {
        let target = ButtonTarget(host: host, action: action)
        targets[ButtonTarget.uniqueId] = target
    }
}

class ButtonTarget: NSObject {
    var action: Action?

init(host: UIButton, action: [@escaping](http://twitter.com/escaping) Action) {
        super.init()

self.action = action
        host.addTarget(self, action: #selector(handleTap), for: .touchUpInside)
    }

// MARK: - Action

[@objc](http://twitter.com/objc) func handleTap() {
        action?()
    }
}</code></pre><p>We have ButtonTarget that acts as target for target-action for UIButton , which inherits from UIControl .</p>
<p>Now to react to button tap, it’s as simple as calling:</p>
<pre><code>button.on.tap {}</code></pre><p>And Xcode shows correct auto-completion. If we’re about to use UITextField , there’s no code suggestions showing up as there’s no methods for UITextField yet:</p>
<pre><code>textField.on. // ummh?</code></pre><p>We need to add a method to Container that has UITextField constraint, for example:</p>
<pre><code>public extension Container where Host: UITextField {
    func textChange(_ action: [@escaping](http://twitter.com/escaping) StringAction) {
        let target = TextFieldTarget(host: host, textAction: action)
        targets[TextFieldTarget.uniqueId] = target
    }
}

class TextFieldTarget: NSObject {
    var textAction: StringAction?

required init(host: UITextField, textAction: [@escaping](http://twitter.com/escaping) StringAction) {
        super.init()

self.textAction = textAction
        host.addTarget(self, action: #selector(handleTextChange(_:)), for: .editingChanged)
    }

// MARK: - Action

[@objc](http://twitter.com/objc) func handleTextChange(_ textField: UITextField) {
        textAction?(textField.text ?? &quot;&quot;)
    }
}</code></pre><p>I’ve used this technique extensively and it works on any platform like iOS, macOS, tvOS as they all base on Objective C Runtime and NSObject. We can easily extend it to any classes we want. This can replace target action, delegate, notification center, KVO or any other communication patterns.</p>
<p>In the next sections, let’s explore timer, KVO and notification and whether we should have our on closure.</p>
<h2 id="Action-to-RxSwift-observable"><a href="#Action-to-RxSwift-observable" class="headerlink" title="Action to RxSwift observable"></a>Action to RxSwift observable</h2><p>Having button.on.tap {} is nice, but it would be great if that can transform into Observablefor some RxSwift fans like me.</p>
<p>We can have our own RxButton like:</p>
<pre><code>final class RxButton: UIButton {
    let tap = PublishSubject&lt;()&gt;()

override init(frame: CGRect) {
        super.init(frame: frame)

self.on.tap { tap.onNext(()) }
    }
}</code></pre><p>We use PublishSubject to map from the imperative to the declarative world of Rx, then we can consume it:</p>
<pre><code>button.tap.subscribe(onNext: {})</code></pre><h2 id="Timer-keeps-a-strong-reference-to-its-target"><a href="#Timer-keeps-a-strong-reference-to-its-target" class="headerlink" title="Timer keeps a strong reference to its target"></a>Timer keeps a strong reference to its target</h2><p>Unlike target-action in UIControl where target is held weakly, Timer keeps its target strongly to deliver tick event.</p>
<p>If you are using init(timeInterval:target:selector:userInfo:repeats:) then please read the section about <a href="https://developer.apple.com/documentation/foundation/timer/1408356-init">target</a> carefully.</p>
<blockquote>
<p>The object to which to send the message specified by aSelector when the timer fires. The timer maintains a strong reference to this object until it (the timer) is invalidated.</p>
</blockquote>
<p>This is what we did before iOS 10:</p>
<pre><code>func schedule() {
    DispatchQueue.main.async {
      self.timer = Timer.scheduledTimer(timeInterval: 20, target: self,
                                   selector: #selector(self.timerDidFire(timer:)), userInfo: nil, repeats: false)
    }
}

[@objc](http://twitter.com/objc) private func timerDidFire(timer: Timer) {
    print(timer)
}</code></pre><p>We can easily extend Timer with our on property by introducing tick method:</p>
<pre><code>public extension Container where Host: Timer {

func tick(_ action: [@escaping](http://twitter.com/escaping) Action) {
        self.timerTarget?.action = action
    }
}

class TimerTarget: NSObject {
    var action: Action?

[@objc](http://twitter.com/objc) func didFire() {
        action?()
    }
}

public extension Timer {
    static func scheduledTimer(withTimeInterval interval: TimeInterval, repeats: Bool) -&gt; Timer {
        let target = TimerTarget()
        let timer = Timer.scheduledTimer(timeInterval: interval,
                                         target: target,
                                         selector: #selector(TimerTarget.didFire),
                                         userInfo: nil,
                                         repeats: repeats)
        timer.on.timerTarget = target
        return timer
    }
}</code></pre><p>So we can use with timer.on.tick:</p>
<pre><code>timer = Timer.scheduledTimer(withTimeInterval: 1, repeats: true)
timer.on.tick { print(&quot;tick&quot;) }</code></pre><p>But as of iOS 10, Timer gets its closure based API, so now we can just call the static method scheduledTimer:</p>
<pre><code>DispatchQueue.main.async {
      self.timer = Timer.scheduledTimer(withTimeInterval: 20, repeats: false) { timer in
        print(timer)
      }
}</code></pre><p>Now that Timer gets better API, our on property on Timer is no longer needed, which is fine.</p>
<h2 id="Key-value-observing-in-Swift-5"><a href="#Key-value-observing-in-Swift-5" class="headerlink" title="Key-value observing in Swift 5"></a>Key-value observing in Swift 5</h2><p>Key-value observing is the ability to watch property change for an NSObject , before Swift 5 the syntax is quite verbose and error-prone with addObserver and observeValuem methods. This is not to mention the usage of context , especially in the subclassing situation, where we need a context key to distinguish between observations of different objects on the same keypath.</p>
<pre><code>public extension Container where Host: NSObject {

func observe(object: NSObject, keyPath: String, _ action: [@escaping](http://twitter.com/escaping) AnyAction) {
        let item = KeyPathTarget.Item(object: object, keyPath: keyPath, action: action)
        keyPathTarget.items.append(item)
        object.addObserver(keyPathTarget, forKeyPath: keyPath, options: .new, context: nil)
    }

func unobserve(object: NSObject, keyPath: String? = nil) {
        let predicate: (KeyPathTarget.Item) -&gt; Bool = { item in
            return item.object === object
                &amp;&amp; (keyPath != nil) ? (keyPath! == item.keyPath) : true
        }

keyPathTarget.items.filter(predicate).forEach({
            object.removeObserver(keyPathTarget, forKeyPath: $0.keyPath)
        })

keyPathTarget.items = keyPathTarget.items.filter({ !predicate($0) })
    }
}

class KeyPathTarget: NSObject {
    class Item {
        let object: NSObject
        let keyPath: String
        let action: AnyAction

init(object: NSObject, keyPath: String, action: [@escaping](http://twitter.com/escaping) AnyAction) {
            self.object = object
            self.keyPath = keyPath
            self.action = action
        }
    }

var items = [Item]()

deinit {
        items.forEach({ item in
            item.object.removeObserver(self, forKeyPath: item.keyPath)
        })

items.removeAll()
    }

// MARK: - KVO
    override func observeValue(forKeyPath keyPath: String?,
                               of object: Any?,
                               change: [NSKeyValueChangeKey : Any]?,
                               context: UnsafeMutableRawPointer?) {
        guard let object = object as? NSObject,
            let keyPath = keyPath,
            let value = change?[.newKey] else {
                return
        }

let predicate: (KeyPathTarget.Item) -&gt; Bool = { item in
            return item.object === object
                &amp;&amp; keyPath == item.keyPath
        }

items.filter(predicate).forEach({
            $0.action(value)
        })
    }
}</code></pre><p>Then we can have an observer to observe contentSize of UIScrollView like:</p>
<pre><code>let observer = NSObject()
observer.on.observe(object: scrollView: keyPath: #keyPath(UIScrollView.contentSize)) { value in  print($0 as? CGSize)}</code></pre><p>Starting from Swift 5, there’s an introduction of KeyPath syntax and improvement to KVO. Now we can just:</p>
<pre><code>@objc class User: NSObject {
    @objc dynamic var name = &quot;random&quot;
}

let thor = Person()

thor.observe(\User.name, options: .new) { user, change in
    print(&quot;User has a new name \(user.name)&quot;)
}

thor.name = &quot;Thor&quot;</code></pre><p>As for KVO, we need to mark @objc and dynamic for it to work. The rest is just to call observe on the object with the KeyPath we want to observe.</p>
<h2 id="Block-based-Notification-Center"><a href="#Block-based-Notification-Center" class="headerlink" title="Block-based Notification Center"></a>Block-based Notification Center</h2><p>NotificationCenter is the mechanism to post and receive notification system-wide. Starting from iOS 4, NotificationCenter got its block API <a href="https://developer.apple.com/documentation/foundation/nsnotificationcenter/1411723-addobserverforname">addObserverForName:object:queue:usingBlock:</a></p>
<p>The only thing to notice is that block parameter being copied.</p>
<blockquote>
<p>The block to be executed when the notification is received.<br>The block is copied by the notification center and (the copy) held until the observer registration is removed.</p>
</blockquote>
<p>As for EasyClosure, to wrap around NotficationCenter is easy:</p>
<pre><code>public extension Container where Host: NSObject {

func observe(notification name: Notification.Name,
                 _ action: [@escaping](http://twitter.com/escaping) NotificationAction) {
        let observer = NotificationCenter.default.addObserver(
            forName: name, object: nil,
            queue: OperationQueue.main, using: {
                action($0)
        })

notificationTarget.mapping[name] = observer
    }

func unobserve(notification name: Notification.Name) {
        let observer = notificationTarget.mapping.removeValue(forKey: name)

if let observer = observer {
            NotificationCenter.default.removeObserver(observer as Any)
            notificationTarget.mapping.removeValue(forKey: name)
        }
    }
}

class NotificationTarget: NSObject {
    var mapping: [Notification.Name: NSObjectProtocol] = [:]

deinit {
        mapping.forEach({ (key, value) in
            NotificationCenter.default.removeObserver(value as Any)
        })

mapping.removeAll()
    }
}</code></pre><p>And with its on extension:</p>
<pre><code>viewController.on.observe(notification: Notification.Name.UIApplicationDidBecomeActive) { notification in
  print(&quot;application did become active&quot;)
}

viewController.on.unobserve(notification: Notification.Name.UIApplicationDidBecomeActive)</code></pre><p>This is for demonstration purpose only as the default NotificationCenter with block-based API is good enough. There are some cautions when using it<br><a href="https://sealedabstract.com/code/nsnotificationcenter-with-blocks-considered-harmful/">NSNotificationCenter with blocks considered harmful</a> that’s good to be aware of.</p>
<h2 id="Where-do-we-go-from-here"><a href="#Where-do-we-go-from-here" class="headerlink" title="Where do we go from here"></a>Where do we go from here</h2><p>We’ve learned how to make use of associated objects and make nicer APIs. <a href="https://github.com/onmyway133/EasyClosure">EasyClosure</a> is designed to be extensible and we can wrap any communication patterns. KVO and NotificationCenter APIs have become better starting iOS 10 and Swift 5, and we see a trend of more closure based API as they are declarative and convenient. When we can, we should stick to the system APIs as much as possible and only make our sugar when needed.</p>
<p>I hope you find this article helpful, here ‘s a fun gif made with <a href="https://github.com/onmyway133/EasyClosure">EasyClosure</a> APIs:</p>
<pre><code>func allOn() -&gt; Bool {
  return [good, cheap, fast].filter({ $0.isOn }).count == 3
}

good.on.valueChange { _ in
  if allOn() {
    fast.setOn(false, animated: true)
  }
}

cheap.on.valueChange { _ in
  if allOn() {
    good.setOn(false, animated: true)
  }
}

fast.on.valueChange { _ in
  if allOn() {
    cheap.setOn(false, animated: true)
  }
}</code></pre><p><img src="https://cdn-images-1.medium.com/max/2000/0*7Bk_M_krffE-VTbp.gif" alt=""></p>
<h2 id="Read-more"><a href="#Read-more" class="headerlink" title="Read more"></a>Read more</h2><ul>
<li>I originally published on <a href="https://medium.com/flawless-app-stories/simplifying-communication-patterns-with-closure-in-swift-1938414468b3">https://medium.com/flawless-app-stories/simplifying-communication-patterns-with-closure-in-swift-1938414468b3</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2021-01-05T06:07:53.000Z" title="2021-01-05T06:07:53.000Z">2021-01-05</time><span class="level-item">28 minutes read (About 4150 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-make-Auto-Layout-more-convenient-in-iOS/">How to make Auto Layout more convenient in iOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/742">#742</a></strong></p>
<p>Auto Layout has been around since macOS 10.7 and iOS 6.0 as a nicer way to do layouts over the old resizing masks. Besides some rare cases when we need to manually specify origins and sizes, Auto Layout is the preferred way to do declarative layouts whether we choose to do UI in code or Storyboard. The Auto Layout APIs have some improvements over the years, there are also some sugar libraries that add easy syntaxes, so more choices for developers.</p>
<p>In this article, let’s take a review of how layout has improved over the years, from manual layout, autoresizing masks and finally to Auto Layout. I will mention a few takes on some libraries and how to abstract Auto Layout using the builder pattern. There are also some notes about the view life cycle and APIs improvements that might be overlooked. These are of course based on my experience and varies because of personal tastes but I hope you‘ll find something useful.</p>
<p>Although the article mention iOS, the same learning applies to watchOS, tvOS and macOS too. </p>
<h2 id="Positioning-a-view-before-Auto-Layout"><a href="#Positioning-a-view-before-Auto-Layout" class="headerlink" title="Positioning a view before Auto Layout"></a>Positioning a view before Auto Layout</h2><p>When I first started iOS programming in early 2014, I read a book about Auto Layout and that book detailed lots of scenarios that completely confused me. It didn’t take long until I tried Auto Layout in an app and I realized it w as so simple. In its simplest sense, a view needs a position and a size to be correctly shown on the screen, everything else is just extra. In Auto Layout’s term, we need to specify enough constraints to position and size the view.</p>
<h3 id="Manual-layout-using-CGRect"><a href="#Manual-layout-using-CGRect" class="headerlink" title="Manual layout using CGRect"></a>Manual layout using CGRect</h3><p>If we take a look back at the way we do a manual layout with the frame, there are origins and sizes. For example, here is how to position a red box that stretches accordingly with the width of the view controller.</p>
<p><img src="https://cdn-images-1.medium.com/max/2336/1*ScTtKYui6Ml0z0ocYR9uDA.png" alt=""></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> box = <span class="type">UIView</span>()</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        </span><br><span class="line">        box.backgroundColor = <span class="type">UIColor</span>.red</span><br><span class="line">        view.addSubview(box)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLayoutSubviews</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLayoutSubviews()</span><br><span class="line">        </span><br><span class="line">        box.frame = <span class="type">CGRect</span>(x: <span class="number">20</span>, y: <span class="number">50</span>, width: view.frame.size.width - <span class="number">40</span>, height: <span class="number">100</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>viewDidLoad is called when the view property of view controller is loaded, we need to wait until viewDidLayoutSubviews so that we have access to the final bounds. When the bounds change for a view controller’s view, the view adjusts the positions of its subviews and then the system calls this method.</p>
<h3 id="Why-is-view-size-correct-in-viewDidLoad"><a href="#Why-is-view-size-correct-in-viewDidLoad" class="headerlink" title="Why is view size correct in viewDidLoad"></a>Why is view size correct in viewDidLoad</h3><p>viewDidLoad is definitely not the recommended way to do manual layout but there are times we still see that its view is correctly sized and fills the screen. This is when we need to read <a href="https://developer.apple.com/documentation/uikit/uiviewcontroller">View Management</a> in UIViewController more thoroughly:</p>
<blockquote>
<p>Each view controller manages a view hierarchy, the root view of which is stored in the <a href="https://developer.apple.com/documentation/uikit/uiviewcontroller/1621460-view">*view</a>*property of this class. The root view acts primarily as a container for the rest of the view hierarchy. The size and position of the root view is determined by the object that owns it, which is either a parent view controller or the app’s window. The view controller that is owned by the window is the app’s root view controller and its view is sized to fill the window.<br>A view controller’s root view is always sized to fit its assigned space.</p>
</blockquote>
<p>It can also be that the view has fixed size in xib or storyboard but we should control the size explicitly and do that in the right view controller method to avoid unexpected behaviors.</p>
<h3 id="Autoresizing-masks"><a href="#Autoresizing-masks" class="headerlink" title="Autoresizing masks"></a>Autoresizing masks</h3><p><img src="https://cdn-images-1.medium.com/max/2000/1*yn3czZbudyVVlr-a3J1l9A.png" alt=""></p>
<p>Autoresizing mask was the old way to make layout a bit more declarative, also called <em>springs and struts</em> layout system. It is integer bit mask that determines how the receiver resizes itself when its superview’s bounds change. Combining these constants lets you specify which dimensions of the view should grow or shrink relative to the superview. The default value of this property is none, which indicates that the view should not be resized at all.</p>
<p>While we can specify which edges we want to fix and which should be flexible, it is confusing in the ways we do in xib and in code.</p>
<p>In the above screenshot, we pin the top of the red box to the top of the screen, and that is fixed distance. When the view changes size, the width and height of the red box changes proportionally, but the top spacing remains fixed.</p>
<p>In code, instead of specifying autoresizing in terms of fixed distance, we use flexible terms to specify which edges should be flexible.</p>
<p>To achieve the same red box on the top of the screen, we need to specify a flexible width and a flexible bottom margin. This means the left, right and top edges are fixed.</p>
<pre><code>box.autoresizingMask = [.flexibleWidth, .flexibleBottomMargin]</code></pre><p>Here are a few more scenarios</p>
<ul>
<li><p>Horizontally fixed distance from the left: [.flexibleRightMargin]</p>
</li>
<li><p>Center horizontally [.flexibleLeftMargin, .flexibleRightMargin]</p>
</li>
<li><p>Vertically fixed distance from the top: [.flexibleBottomMargin]</p>
</li>
<li><p>Center vertically [.flexibleTopMargin, .flexibleBottomMargin]</p>
</li>
</ul>
<p>These are not very intuitive and the way these are scaled proportionally may not fit our expectation. Also, note that multiple options can be done on the same axis.</p>
<blockquote>
<p>When more than one option along the same axis is set, the default behavior is to distribute the size difference proportionally among the flexible portions. The larger the flexible portion, relative to the other flexible portions, the more it is likely to grow. For example, suppose this property includes the <a href="apple-reference-documentation://hsNSe_v1m3">flexibleWidth</a> and <a href="apple-reference-documentation://hsW_P6WgME">flexibleRightMargin</a>constants but does not include the <em>flexibleLeftMargin</em> constant, thus indicating that the width of the view’s left margin is fixed but that the view’s width and right margin may change.</p>
</blockquote>
<p>Understanding of autoresizing masks won’t waste your time, we will come back to it in a few minutes 😉</p>
<h2 id="Auto-Layout-to-the-rescue"><a href="#Auto-Layout-to-the-rescue" class="headerlink" title="Auto Layout to the rescue"></a>Auto Layout to the rescue</h2><p>Auto Layout, together with dynamic text and size classes, are recommended ways to build <a href="https://developer.apple.com/design/adaptivity/">adaptive user interfaces</a> as there the number of iOS devices with different screen sizes grows.</p>
<h3 id="A-constraint-based-layout-system"><a href="#A-constraint-based-layout-system" class="headerlink" title="A constraint-based layout system"></a>A constraint-based layout system</h3><p>Auto Layout is described via <a href="https://developer.apple.com/documentation/uikit/nslayoutconstraint">NSLayoutConstraint</a> by defining constraints between 2 objects. Here is the simple formula to remember:</p>
<pre><code>item1.attribute1 = multiplier × item2.attribute2 + constant</code></pre><p>Here is how to replicate that red box with NSLayoutConstraint. We need to specify which property of which view should be connected to another property of another view. Auto Layout supports many attributes such ascenterX, centerY and topMargin.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> marginTop = <span class="type">NSLayoutConstraint</span>(item: box, attribute: .top, relatedBy: .<span class="built_in">equal</span>, toItem: view, attribute: .top, multiplier: <span class="number">1.0</span>, constant: <span class="number">50</span>)</span><br><span class="line"><span class="keyword">let</span> marginLeft = <span class="type">NSLayoutConstraint</span>(item: box, attribute: .<span class="keyword">left</span>, relatedBy: .<span class="built_in">equal</span>, toItem: view, attribute: .<span class="keyword">left</span>, multiplier: <span class="number">1.0</span>, constant: <span class="number">20</span>)</span><br><span class="line"><span class="keyword">let</span> marginRight = <span class="type">NSLayoutConstraint</span>(item: box, attribute: .<span class="keyword">right</span>, relatedBy: .<span class="built_in">equal</span>, toItem: view, attribute: .<span class="keyword">right</span>, multiplier: <span class="number">1.0</span>, constant: -<span class="number">20</span>)</span><br><span class="line"><span class="keyword">let</span> height = <span class="type">NSLayoutConstraint</span>(item: box, attribute: .height, relatedBy: .<span class="built_in">equal</span>, toItem: <span class="literal">nil</span>, attribute: .notAnAttribute, multiplier: <span class="number">1.0</span>, constant: <span class="number">100</span>)</span><br><span class="line"><span class="type">NSLayoutConstraint</span>.activate([marginTop, marginLeft, marginRight, height])</span><br></pre></td></tr></table></figure>

<h3 id="translatesAutoresizingMaskIntoConstraints"><a href="#translatesAutoresizingMaskIntoConstraints" class="headerlink" title="translatesAutoresizingMaskIntoConstraints"></a>translatesAutoresizingMaskIntoConstraints</h3><p>If we run the above code, we will get into the popular warning message regarding translatesAutoresizingMaskIntoConstraints</p>
<pre><code>[LayoutConstraints] Unable to simultaneously satisfy constraints.
 Probably at least one of the constraints in the following list is one you don&apos;t want. 
 Try this: 
  (1) look at each constraint and try to figure out which you don&apos;t expect; 
  (2) find the code that added the unwanted constraint or constraints and fix it. 
 (Note: If you&apos;re seeing NSAutoresizingMaskLayoutConstraints that you don&apos;t understand, refer to the documentation for the UIView property translatesAutoresizingMaskIntoConstraints) 
(
    &quot;&lt;NSAutoresizingMaskLayoutConstraint:0x600003ef2300 h=--&amp; v=--&amp; UIView:0x7fb66c5059f0.midX == 0   (active)&gt;&quot;,
    &quot;&lt;NSLayoutConstraint:0x600003e94b90 H:|-(20)-[UIView:0x7fb66c5059f0](LTR)   (active, names: &apos;|&apos;:UIView:0x7fb66c50bce0 )&gt;&quot;
)</code></pre><p>If you need some help deciphering this, there is <a href="https://www.wtfautolayout.com/">wtfautolayout</a> that does a good job on explaining what’s really happening.</p>
<p><img src="https://cdn-images-1.medium.com/max/3884/1*6bzhDTPpCUhitq4GbTVAmw.png" alt=""></p>
<p>It is said that resizing masks has been reimplemented using Auto Layout under the hood, and there is always NSAutoresizingMaskLayoutConstraint added to the view, hence the midX constraint.</p>
<p>We should never mix resizing masks and Auto Layout to avoid unwanted behavior, the fix is simply to disable translatesAutoresizingMaskIntoConstraints</p>
<pre><code>box.translatesAutoresizingMaskIntoConstraints = false</code></pre><p>This property is false by default for views from xib or storyboard but holds true if we declare layout in code. The intention is for the system to create a set of constraints that duplicate the behavior specified by the view’s autoresizing mask. This also lets you modify the view’s size and location using the view’s frame, bounds, or center properties, allowing you to create a static, frame-based layout within Auto Layout.</p>
<h3 id="Visual-Format-Language"><a href="#Visual-Format-Language" class="headerlink" title="Visual Format Language"></a>Visual Format Language</h3><p>The Visual Format Language lets you use ASCII-art like strings to define your constraints. I see it is used in some code bases so it’s good to know it.</p>
<p>Here is how to recreate the red box using VFL. We need to specify constraints for both horizontal and vertical direction. Note that the same format string may result in multiple constraints:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> views = [<span class="string">"box"</span> : box]</span><br><span class="line"><span class="keyword">let</span> horizontal = <span class="string">"H:|-20-[box]-20-|"</span></span><br><span class="line"><span class="keyword">let</span> vertical = <span class="string">"V:|-50-[box(100)]"</span></span><br><span class="line"><span class="keyword">let</span> horizontalConstraints = <span class="type">NSLayoutConstraint</span>.constraints(withVisualFormat: horioptions: [], metrics: <span class="literal">nil</span>, views: views)</span><br><span class="line"><span class="keyword">let</span> verticalConstraints = <span class="type">NSLayoutConstraint</span>.constraints(withVisualFormat: veoptions: [], metrics: <span class="literal">nil</span>, views: views)</span><br><span class="line"><span class="type">NSLayoutConstraint</span>.activate([horizontalConstraints, verticalConstraints].flatMap(&#123; $<span class="number">0</span> &#125;))</span><br></pre></td></tr></table></figure>

<p>Visual Format Language is a bit nicer than the verbose NSLayoutConstraint initializer, but it encourages string format, which is error-prone.</p>
<h3 id="addConstraint-and-activate"><a href="#addConstraint-and-activate" class="headerlink" title="addConstraint and activate"></a>addConstraint and activate</h3><p>This may seem trivial but I see in modern code bases, there is still usage of addConstraint . This was old and hard to use, as we must find the nearest common ancestor view of the 2 views that envolve in Auto Layout.</p>
<p>Starting from iOS 8, there is isActive and the static activate functions that ease this adding constraints process a lot. Basically what it does is to activate or deactivate the constraint with calls to<a href="apple-reference-documentation://hs6gkFVJuz">addConstraint(_:)</a> and <a href="apple-reference-documentation://hsYzji4l8L">removeConstraint(_:)</a> on the view that is the closest common ancestor of the items managed by this constraint.</p>
<h3 id="NSLayoutAnchor"><a href="#NSLayoutAnchor" class="headerlink" title="NSLayoutAnchor"></a>NSLayoutAnchor</h3><p>Starting with macOS 10.11 and iOS 9, there was NSLayoutAnchor that simplifies Auto Layout a lot. Auto Layout was declarative, but a bit verbose, now it is simpler than ever with an anchoring system.</p>
<p>Here is how to achieve that same red box</p>
<pre><code>NSLayoutConstraint.activate([
    box.topAnchor.constraint(equalTo: view.topAnchor, constant: 50),
    box.leftAnchor.constraint(equalTo: view.leftAnchor, constant: 20),
    box.rightAnchor.constraint(equalTo: view.rightAnchor, constant: -20),
    box.heightAnchor.constraint(equalToConstant: 100)
])</code></pre><p>The cool thing about NSLayoutAnchor is its generic constrained API design. Constraints are divided into X-axis, Y-axis and dimension anchor type that makes it hard to make mistakes.</p>
<pre><code>open class NSLayoutXAxisAnchor : NSLayoutAnchor&lt;NSLayoutXAxisAnchor&gt;
open class NSLayoutDimension : NSLayoutAnchor&lt;NSLayoutDimension&gt;</code></pre><p>For example, we can’t pin the top anchor to the left anchor as they are in different axis, and it makes no sense. Attempt to do the following results in compilation issue as Swift strong type system ensures correctness.</p>
<pre><code>box.topAnchor.constraint(equalTo: view.leftAnchor, constant: 50),</code></pre><h3 id="Ambiguous-error-message-with-NSLayoutAnchor"><a href="#Ambiguous-error-message-with-NSLayoutAnchor" class="headerlink" title="Ambiguous error message with NSLayoutAnchor"></a>Ambiguous error message with NSLayoutAnchor</h3><p>I’ve gone into a few cases where the error messages from NSLayoutAnchor don’t help. If we mistakenly connect topAnchor with centerXAnchor, which are not possible as they are from different axes.</p>
<pre><code>NSLayoutConstraint.activate([
    box.topAnchor.constraint(equalTo: view.centerXAnchor, constant: 50)
])</code></pre><p>Xcode complains of unwrapped UIView problem which may confuse us even more.</p>
<pre><code>Value of optional type &apos;UIView?&apos; must be unwrapped to refer to member &apos;centerXAnchor&apos; of wrapped base type &apos;UIView&apos;</code></pre><p>Another puzzle, regarding this code</p>
<pre><code>NSLayoutConstraint.activate([
    imageView.centerYAnchor.constraint(equalTo: view.centerYAnchor),
    imageView.leftAnchor.constraint(equalTo: view.leftAnchor, constant: 8),
    imageView.heightAnchor.constraint(equalToConstant: view.heightAnchor, mult0.7),
    imageView.widthAnchor.constraint(equalTo: imageView.heightAnchor, multiplier: 1.0)
])</code></pre><p>Xcode is complaining about ‘Int’ is not convertible to ‘CGFloat’ which is very misleading. Can you spot the error?</p>
<p>The problem is that we are using equalToConstant , not equalTo . The generic constraints of NSLayoutAnchor is giving us misleading errors and can waste lots of time of us trying to figure out the subtle typos.</p>
<h2 id="Abstractions-over-Auto-Layout"><a href="#Abstractions-over-Auto-Layout" class="headerlink" title="Abstractions over Auto Layout"></a>Abstractions over Auto Layout</h2><p>NSLayoutAnchor is getting more popular now but it is not without any flaws. Depending on personal taste, there might be some other forms of abstractions over Auto Layout, namely Cartography and SnapKit, which I ‘ve used and loved. Here are a few of my takes on those.</p>
<h3 id="Cartography"><a href="#Cartography" class="headerlink" title="Cartography"></a>Cartography</h3><p><a href="https://github.com/robb/Cartography">Cartography</a> is one of the most popular ways to do Auto Layout in iOS. It uses operators which makes constraints very clear:</p>
<pre><code>constrain(button1, button2) { button1, button2 in
    button1.right == button2.left - 12
}</code></pre><p>What I don’t like about Cartography is that we have to repeat parameter names and that the parameters inside closure are just proxies, not real views and there is a limit on the number of constrain items.</p>
<p>Another huge con was that long compilation time issue due to excessive use of operators <a href="https://github.com/robb/Cartography/issues/215">Very long compile time in large functions</a>. Although Swift compilation time is getting better, this was a big problem. I even had to write a script to remove Cartography to use simple NSLayoutAnchor, so take a look at <a href="https://gist.github.com/onmyway133/c486939f82fc4d3a8ed4be21538fdd32">AutoLayoutConverter</a>, which converts Cartography code from</p>
<pre><code>constrain(logoImnageView, view1, view2) { logoImageView, view1, view2 in
    logoImageView.with == 74
    view1.left == view2.left + 20
}</code></pre><p>to simple NSLayoutAnchor</p>
<pre><code>Constraint.on(
  logoImageView.widthAnchor.constraint(equalToConstant: 74),
  view1.leftAnchor.constraint(equalTo: view2.leftAnchor, constant: 20),
)</code></pre><p>There are always tradeoffs but to reduce compilation time at the time was a top priority.</p>
<h3 id="SnapKit"><a href="#SnapKit" class="headerlink" title="SnapKit"></a>SnapKit</h3><p><a href="https://github.com/SnapKit/SnapKit">SnapKit</a>, originally Masonry, is perhaps the most popular Auto Layout wrapper</p>
<pre><code>box.snp.makeConstraints { (make) -&gt; Void in
   make.width.height.equalTo(50)
   make.center.equalTo(self.view)
}</code></pre><p>The syntax is nice and with snp namespace to avoid extension name clashes, which I love.</p>
<p>The thing I don’t like about SnapKit is that limited closure. We can only work on 1 view at a time, and the make inside closure is just a proxy, which does not seem intuitive.</p>
<p>Imagine if we’re gonna make paging views or <a href="https://github.com/onmyway133/blog/issues/22">piano</a>, where each view is stacked side by side. We need a lot of SnapKit calls as we can only work on 1 view at a time. Also, there is no clear relationship where we connect with the other view.</p>
<p><img src="https://cdn-images-1.medium.com/max/3882/0*4zvVsKPnTaG5ZXgm.png" alt="[https://github.com/onmyway133/blog/issues/22](https://github.com/onmyway133/blog/issues/22)"><em><a href="https://github.com/onmyway133/blog/issues/22">https://github.com/onmyway133/blog/issues/22</a></em></p>
<pre><code>keyB.snp.makeConstraints { (make) -&gt; Void in
   make.left.equalTo(self.keyA.right)
}

keyC.snp.makeConstraints { (make) -&gt; Void in
   make.left.equalTo(self.keyB.right)
}

keyD.snp.makeConstraints { (make) -&gt; Void in
   make.left.equalTo(self.keyC.right)
}</code></pre><h3 id="The-many-overloading-functions"><a href="#The-many-overloading-functions" class="headerlink" title="The many overloading functions"></a>The many overloading functions</h3><p>There are also attempts to build simple Auto Layout wrapper functions but that escalates very quickly.</p>
<p>We might begin with an extension that pins edge constraints to superview.</p>
<pre><code>box.pinEdgesToSuperview()</code></pre><p>But a view does not always pin to its superview, it can be to another view, then we add another function</p>
<pre><code>box.pinEdgesToView(_ view: UIView)</code></pre><p>It would be nice if there is some padding, isn’t it? Let’s add insets options</p>
<pre><code>box.pinEdgesToView(_ view: UIView, insets: UIEdgeInsets)</code></pre><p>There might be cases where we only want to pin top, left, and right and not the bottom, let’s add another parameter</p>
<pre><code>box.pinEdgesToView(_ view: UIView, insets: UIEdgeInsets, exclude: NSLayoutConstraint.Attribute)</code></pre><p>Constraints are not always 1000 priorities, it can be lower. We need to support that</p>
<pre><code>box.pinEdgesToView(_ view: UIView, insets: UIEdgeInsets, exclude: NSLayoutConstraint.Attribute, priority: NSLayoutConstraint.Priority)</code></pre><p>We might exclude more than one properties or set different priority levels for each constraint. The simple wrapper with overloading functions and default parameters are just like building rigid abstraction based on premature assumptions. This just limits us in the long run and not scalable 😢</p>
<h2 id="Embracing-Auto-Layout"><a href="#Embracing-Auto-Layout" class="headerlink" title="Embracing Auto Layout"></a>Embracing Auto Layout</h2><p>All the Auto Layout frameworks out there are just convenient ways to build NSLayoutConstraint, in fact, these are what you normally need</p>
<ul>
<li><p>Call addSubview so that view is in the hierarchy</p>
</li>
<li><p>Set translatesAutoresizingMaskIntoConstraints = false</p>
</li>
<li><p>Set isActive = true to enable constraints</p>
</li>
</ul>
<p>Here is how to make an extension on NSLayoutConstraint that disables translatesAutoresizingMaskIntoConstraints for the involved views. Code is from <a href="https://github.com/onmyway133/Omnia/blob/master/Sources/iOS/NSLayoutConstraint.swift">Omnia</a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">extension</span> <span class="title">NSLayoutConstraint</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/// Disable auto resizing mask and activate constraints</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// - Parameter constraints: constraints to activate</span></span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">on</span><span class="params">(<span class="number">_</span> constraints: [NSLayoutConstraint])</span></span> &#123;</span><br><span class="line">        constraints.forEach &#123;</span><br><span class="line">            ($<span class="number">0</span>.firstItem <span class="keyword">as</span>? <span class="type">UIView</span>)?.translatesAutoresizingMaskIntoConstraints = <span class="literal">false</span></span><br><span class="line">            $<span class="number">0</span>.isActive = <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">on</span><span class="params">(<span class="number">_</span> constraintsArray: [[NSLayoutConstraint]])</span></span> &#123;</span><br><span class="line">        <span class="keyword">let</span> constraints = constraintsArray.flatMap(&#123; $<span class="number">0</span> &#125;)</span><br><span class="line">        <span class="type">NSLayoutConstraint</span>.on(constraints)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Here before we activate constraints, we find the firstItem then disables translatesAutoresizingMaskIntoConstraints. From Swift 4.2 there is a separation between compactMap and flatMap so we can safely use flatMap to flatten an array of arrays. This is useful when we have an <a href="https://github.com/onmyway133/Omnia/blob/master/Sources/iOS/UIView.swift">array of arrays</a> of constraints.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">extension</span> <span class="title">UIView</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">pinCenter</span><span class="params">(view: UIView)</span></span> -&gt; [<span class="type">NSLayoutConstraint</span>] &#123;</span><br><span class="line">        <span class="keyword">return</span> [</span><br><span class="line">            centerXAnchor.constraint(equalTo: view.centerXAnchor),</span><br><span class="line">            centerYAnchor.constraint(equalTo: view.centerYAnchor)</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">pin</span><span class="params">(size: CGSize)</span></span> -&gt; [<span class="type">NSLayoutConstraint</span>] &#123;</span><br><span class="line">        <span class="keyword">return</span> [</span><br><span class="line">            widthAnchor.constraint(equalToConstant: size.width),</span><br><span class="line">            heightAnchor.constraint(equalToConstant: size.height)</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>With that, we can pin the red box with a certain size and to the center of the screen:</p>
<pre><code>NSLayoutConstraint.on([
    box.pinCenter(view: view),
    box.pin(size: CGSize(width: 100, height: 50))
])</code></pre><p>This is a very thin but powerful wrapper over NSLayoutAnchor and we can expand it the way we need. It sadly has some problems, like we can’t easily change the priority, as we have to reference the constraint 😢</p>
<pre><code>let topConstraint = box.topAnchor.constraint(equalTo: view.topAnchor, constant: 50)
topConstraint.priority = UILayoutPriority.defaultLow

NSLayoutConstraint.on([
    topConstraint
])</code></pre><h2 id="Making-Auto-Layout-more-convenient-with-the-builder-pattern"><a href="#Making-Auto-Layout-more-convenient-with-the-builder-pattern" class="headerlink" title="Making Auto Layout more convenient with the builder pattern"></a>Making Auto Layout more convenient with the builder pattern</h2><p>The above extension on NSLayoutConstraint works well. However, if you’re like me who wants even more declarative and fast Auto Layout code, we can use the builder pattern to make Auto Layout even nicer. The builder pattern can be applied to many parts of the code but I find it very well suited for Auto Layout. The final code is <a href="https://github.com/onmyway133/Anchors">Anchors</a> on GitHub, and I will detail how to make it.</p>
<p>Here is what we want to achieve to quickly position 4 views:</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/0*bH2VP8h2rWp0pgqm.gif" alt=""></p>
<pre><code>activate(
  boxA.anchor.top.left,
  boxB.anchor.top.right,
  boxC.anchor.bottom.left,
  boxD.anchor.bottom.right
)</code></pre><p>Most of the times, we want to anchor to parent view, so that should be implicitly done for us. I like to have anchor namespace to avoid extension naming clashes and to make it the starting point for all our convenient Auto Layout code. Let’s identify a few core concepts</p>
<h3 id="Which-objects-can-interact-with-Auto-Layout"><a href="#Which-objects-can-interact-with-Auto-Layout" class="headerlink" title="Which objects can interact with Auto Layout?"></a>Which objects can interact with Auto Layout?</h3><p>Currently, there are 3 types of objects that can interact withAuto Layout</p>
<ul>
<li><p>UIView</p>
</li>
<li><p><a href="https://developer.apple.com/documentation/uikit/uilayoutsupport">UILayoutSupport</a>, from iOS 7, for UIViewController to get bottomLayoutGuide and topLayoutGuide . In iOS 11, we should use <a href="https://developer.apple.com/documentation/uikit/uiview/2891102-safearealayoutguide">safeAreaLayoutGuide</a> from UIView instead</p>
</li>
<li><p><a href="https://developer.apple.com/documentation/uikit/uilayoutguide">UILayoutGuide</a>: using invisible UIView to do Auto Layout is expensive, that’s why Apple introduced layout guides in iOS 9 to help.</p>
</li>
</ul>
<p>So to support these 3 with anchor namespace, we can make Anchor object that holds AnyObject as behind the scene, NSLayoutConstraint works with AnyObject:</p>
<pre><code>public class Anchor: ConstraintProducer {
  let item: AnyObject

/// Init with View
  convenience init(view: View) {
    self.init(item: view)
  }

/// Init with Layout Guide
  convenience init(layoutGuide: LayoutGuide) {
    self.init(item: layoutGuide)
  }

// Init with Item
  public init(item: AnyObject) {
    self.item = item
  }
}</code></pre><p>Now we can define anchor property</p>
<pre><code>public extension View {
  var anchor: Anchor {
    return Anchor(view: self)
  }
}

public extension LayoutGuide {
  var anchor: Anchor {
    return Anchor(layoutGuide: self)
  }
}</code></pre><h3 id="Which-properties-are-needed-in-a-layout-constraint"><a href="#Which-properties-are-needed-in-a-layout-constraint" class="headerlink" title="Which properties are needed in a layout constraint?"></a>Which properties are needed in a layout constraint?</h3><p>The builder patterns make building things declaratively by holding temporary values. Besides from, to, priority, identifier, we need an array of pins to handle cases where there are multiple created constraints. A center constraint results in both centerX and centerY constraints, and an edge constraint results in top, left, bottom and right constraints.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">To</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> anchor(<span class="type">Anchor</span>)</span><br><span class="line">    <span class="keyword">case</span> size</span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">none</span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pin</span> </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> attribute: <span class="type">Attribute</span></span><br><span class="line">  <span class="keyword">var</span> constant: <span class="type">CGFloa</span></span><br><span class="line">  <span class="keyword">init</span>(<span class="number">_</span> attribute:  <span class="type">Attribute</span>, constant: <span class="type">CGFloat</span> = <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">self</span>.attribute = attribute</span><br><span class="line">    <span class="keyword">self</span>.constant = constant</span><br><span class="line">  &#125;</span><br><span class="line"><span class="keyword">let</span> item: <span class="type">AnyObject</span></span><br><span class="line"><span class="comment">// key: attribute</span></span><br><span class="line"><span class="comment">// value: constant</span></span><br><span class="line"><span class="keyword">var</span> pins: [<span class="type">Pin</span>] = [</span><br><span class="line"><span class="keyword">var</span> multiplierValue: <span class="type">CGFloat</span> = <span class="number">1</span></span><br><span class="line"><span class="keyword">var</span> priorityValue: <span class="type">Float?</span></span><br><span class="line"><span class="keyword">var</span> identifierValue: <span class="type">String?</span></span><br><span class="line"><span class="keyword">var</span> referenceBlock: (([<span class="type">NSLayoutConstraint</span>]) -&gt; <span class="type">Void</span>)?</span><br><span class="line"><span class="keyword">var</span> relationValue: <span class="type">Relation</span> = .<span class="built_in">equal</span></span><br><span class="line"><span class="keyword">var</span> toValue: <span class="type">To</span> = .<span class="keyword">none</span></span><br></pre></td></tr></table></figure>

<p>With this, we can also expand our convenient anchor to support more constraints, like spacing horizontally, which adds left and right constraints with correct constants. Because as you know, in Auto Layout, for right and bottom direction, we need to use negative values:</p>
<pre><code>func paddingHorizontally(_ value: CGFloat) -&gt; Anchor {
  removeIfAny(.leading)
  removeIfAny(.trailing
  pins.append(Pin(.leading, constant: value))
  pins.append(Pin(.trailing, constant: -value)
  return self
}</code></pre><h3 id="Inferring-constraints"><a href="#Inferring-constraints" class="headerlink" title="Inferring constraints"></a>Inferring constraints</h3><p>There are times we want to infer constraints, like if we want a view’s height to double its width. Since we already have width, declaring ratio should pair the height to the width.</p>
<pre><code>box.anchor.width.constant(10)
box.anchor.height.ratio(2) // height==width*2</code></pre><p>This is easily achieved by checking our pins array</p>
<pre><code>if sourceAnchor.exists(.width) {
  return Anchor(item: sourceAnchor.item).width
    .equal
    .to(Anchor(item: sourceAnchor.item).height)
    .multiplier(ratio).constraints()
} else if sourceAnchor.exists(.height) {
  return Anchor(item: sourceAnchor.item).height
    .equal
    .to(Anchor(item: sourceAnchor.item).width)
    .multiplier(ratio).constraints()
} else {
  return []
}</code></pre><h3 id="Retrieving-a-constraint"><a href="#Retrieving-a-constraint" class="headerlink" title="Retrieving a constraint"></a>Retrieving a constraint</h3><p>I see we’re used to storing constraint property in order to change its constant later. The constraints property in UIView has enough info and it is the source of truth, so retrieving constraint from that is more preferable.</p>
<p>Here‘s how we find constraint and update that</p>
<pre><code>boxA.anchor.find(.height)?.constant = 100

// later
boxB.anchor.find(.height)?.constant = 100

// later
boxC.anchor.find(.height)?.constant = 100</code></pre><p><img src="https://cdn-images-1.medium.com/max/2000/0*1kvf_QjOnm66j8U0.gif" alt=""></p>
<p>The code to find constraint is very straightforward.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">extension</span> <span class="title">Anchor</span> </span>&#123;</span><br><span class="line"><span class="comment">/// Find a constraint based on an attribute</span></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">find</span><span class="params">(<span class="number">_</span> attribute: Attribute)</span></span> -&gt; <span class="type">NSLayoutConstraint?</span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> view = item <span class="keyword">as</span>? <span class="type">View</span> <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> constraints = view.superview?.constraints</span><br><span class="line">    <span class="keyword">if</span> attribute == .width || attribute == .height &#123;</span><br><span class="line">      constraints?.append(contentsOf: view.constraints)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> constraints?.<span class="built_in">filter</span>(&#123;</span><br><span class="line">      <span class="keyword">guard</span> $<span class="number">0</span>.firstAttribute == attribute <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">    <span class="keyword">guard</span> $<span class="number">0</span>.firstItem <span class="keyword">as</span>? <span class="type">NSObject</span> == view <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;).first</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="How-to-reset-constraints"><a href="#How-to-reset-constraints" class="headerlink" title="How to reset constraints"></a>How to reset constraints</h3><p>One of the patterns I see all over is resetting constraints in UITableViewCell or UICollectionViewCell. Depending on the state, the cell removes certain constraints and add new constraints. <a href="https://github.com/robb/Cartography">Cartography</a> does this well by using group.</p>
<pre><code>constrain(view, replace: group) { view in
    view.top  == view.superview!.top
    view.left == view.superview!.left
}</code></pre><p>If we think about it, NSLayoutConstraint is just layout instructions. It can be activated or deactivated . So if we can group constraints, we can <a href="https://developer.apple.com/documentation/uikit/nslayoutconstraint/1526955-activate">activate</a> or <a href="https://developer.apple.com/documentation/uikit/nslayoutconstraint/1526066-deactivate">deactivate</a> them as a whole.</p>
<p>Here is how to declare 4 groups of constraints, the syntax is from <a href="https://github.com/onmyway133/Anchors">Anchors</a> but this applies to NSLayoutAnchor as well since those generateNSLayoutConstraint under the hood.</p>
<pre><code>let g1 = group(box.anchor.top.left)
let g2 = group(box.anchor.top.right)
let g3 = group(box.anchor.bottom.right)
let g4 = group(box.anchor.bottom.left)</code></pre><h2 id="Where-to-go-from-here"><a href="#Where-to-go-from-here" class="headerlink" title="Where to go from here"></a>Where to go from here</h2><p>In this article, we step a bit in time into manual layout, autoresizing masks and then to the modern Auto Layout. The Auto Layout APIs have improvements over the years and are recommended way to do layout. Learning declarative layout also helps me a lot when I learn Constraint Layout in Android, flexbox in React Native or the widget layout in Flutter.</p>
<p>The post goes through the detailed implementation of how we can build more convenient Auto Layout like <a href="https://github.com/onmyway133/Anchors">Anchors</a> with the builder pattern. In the next article, let’s explore the many ways to debug Auto Layout and how to correctly do Auto Layout for different screen sizes.</p>
<p>In the meantime, let’s play <a href="https://github.com/onmyway133/Anchors">Tetris</a> in Auto Layout, because why not 😉</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/0*4Uuc-FYvpYpeNSrT.gif" alt="[https://github.com/onmyway133/Anchors](https://github.com/onmyway133/Anchors)"><em><a href="https://github.com/onmyway133/Anchors">https://github.com/onmyway133/Anchors</a></em></p>
<pre><code>activate(
  lineBlock.anchor.left.bottom
)

// later
activate(
  firstSquareBlock.anchor.left.equal.to(lineBlock.anchor.right),
  firstSquareBlock.anchor.bottom
)

// later
activate(
  secondSquareBlock.anchor.right.bottom
)</code></pre><h2 id="Read-more"><a href="#Read-more" class="headerlink" title="Read more"></a>Read more</h2><ul>
<li>I originally published on Medium <a href="https://medium.com/flawless-app-stories/how-to-make-auto-layout-more-convenient-in-ios-df3b42fed37f">https://medium.com/flawless-app-stories/how-to-make-auto-layout-more-convenient-in-ios-df3b42fed37f</a></li>
</ul>
<hr>
<p><strong>Updated at</strong> 2021-01-05 07:22:31</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2021-01-01T21:41:45.000Z" title="2021-01-01T21:41:45.000Z">2021-01-01</time><span class="level-item">9 minutes read (About 1350 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-use-flexible-frame-in-SwiftUI/">How to use flexible frame in SwiftUI</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/734">#734</a></strong></p>
<p>In SwiftUI there are fixed frame and flexible frame modifiers.</p>
<h2 id="Fixed-frame-Positions-this-view-within-an-invisible-frame-with-the-specified-size"><a href="#Fixed-frame-Positions-this-view-within-an-invisible-frame-with-the-specified-size" class="headerlink" title="Fixed frame Positions this view within an invisible frame with the specified size."></a>Fixed frame <a href="https://developer.apple.com/documentation/swiftui/list/frame(width:height:alignment:)">Positions this view within an invisible frame with the specified size.</a></h2><blockquote>
<p>Use this method to specify a fixed size for a view’s width, height, or both. If you only specify one of the dimensions, the resulting view assumes this view’s sizing behavior in the other dimension.</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">VStack</span> &#123;</span><br><span class="line">    <span class="type">Ellipse</span>()</span><br><span class="line">        .fill(<span class="type">Color</span>.purple)</span><br><span class="line">        .frame(width: <span class="number">200</span>, height: <span class="number">100</span>)</span><br><span class="line">    <span class="type">Ellipse</span>()</span><br><span class="line">        .fill(<span class="type">Color</span>.blue)</span><br><span class="line">        .frame(height: <span class="number">100</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Flexible-frame-frame-minWidth-idealWidth-maxWidth-minHeight-idealHeight-maxHeight-alignment"><a href="#Flexible-frame-frame-minWidth-idealWidth-maxWidth-minHeight-idealHeight-maxHeight-alignment" class="headerlink" title="Flexible frame frame(minWidth:idealWidth:maxWidth:minHeight:idealHeight:maxHeight:alignment:)"></a>Flexible frame <a href="https://developer.apple.com/documentation/swiftui/list/frame(minwidth:idealwidth:maxwidth:minheight:idealheight:maxheight:alignment:)">frame(minWidth:idealWidth:maxWidth:minHeight:idealHeight:maxHeight:alignment:)</a></h2><p>Read the documentation carefully</p>
<blockquote>
<p>Always specify at least one size characteristic when calling this method. Pass nil or leave out a characteristic to indicate that the frame should adopt this view’s sizing behavior, constrained by the other non-nil arguments.</p>
</blockquote>
<blockquote>
<p>The size proposed to this view is the size proposed to the frame, limited by any constraints specified, and with any ideal dimensions specified replacing any corresponding unspecified dimensions in the proposal.</p>
</blockquote>
<blockquote>
<p>If no minimum or maximum constraint is specified in a given dimension, the frame adopts the sizing behavior of its child in that dimension. If both constraints are specified in a dimension, the frame unconditionally adopts the size proposed for it, clamped to the constraints. Otherwise, the size of the frame in either dimension is:</p>
</blockquote>
<blockquote>
<p>If a minimum constraint is specified and the size proposed for the frame by the parent is less than the size of this view, the proposed size, clamped to that minimum.</p>
</blockquote>
<blockquote>
<p>If a maximum constraint is specified and the size proposed for the frame by the parent is greater than the size of this view, the proposed size, clamped to that maximum.</p>
</blockquote>
<blockquote>
<p>Otherwise, the size of this view.</p>
</blockquote>
<h2 id="Experiment-with-different-proposed-frame"><a href="#Experiment-with-different-proposed-frame" class="headerlink" title="Experiment with different proposed frame"></a>Experiment with different proposed frame</h2><p>To understand the explanation above, I prepare a Swift playground to examine with 3 scenarios: when both <code>minWidth</code> and <code>maxWidth</code> are provided, when either <code>minWidth</code> or <code>maxWidth</code> is provided. I use <code>width</code> for horizontal dimension but the same applies in vertical direction with <code>height</code>.</p>
<p>I have a <code>View</code> called <code>Examine</code> to demonstrate flexible frame. Here we have a flexible frame with red border and red text showing its size where you can specify <code>minWidth</code> and <code>maxWidth</code>. </p>
<p>Inside it is the content with a fixed frame with blue border and blue text showing content size where you can specify <code>contentWidth</code>. Finally there’s <code>parentWidth</code> where we specify proposed width to our red flexible frame.</p>
<p>The variations for our scenarios are that proposed width falls outside and inside <code>minWidth</code>, <code>contentWidth</code>, and <code>maxWidth</code> range.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Examine</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> parentWidth: <span class="type">CGFloat</span></span><br><span class="line">    <span class="keyword">let</span> contentWidth: <span class="type">CGFloat</span></span><br><span class="line">    <span class="keyword">var</span> minWidth: <span class="type">CGFloat?</span></span><br><span class="line">    <span class="keyword">var</span> maxWidth: <span class="type">CGFloat?</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Rectangle</span>()</span><br><span class="line">            .fill(<span class="type">Color</span>.gray)</span><br><span class="line">            .border(<span class="type">Color</span>.black, width: <span class="number">3</span>)</span><br><span class="line">            .frame(width: contentWidth)</span><br><span class="line">            .overlay(</span><br><span class="line">                <span class="type">GeometryReader</span> &#123; geo <span class="keyword">in</span></span><br><span class="line">                    <span class="type">Text</span>(<span class="string">"\(geo.size.width)"</span>)</span><br><span class="line">                        .foregroundColor(<span class="type">Color</span>.blue)</span><br><span class="line">                        .offset(x: <span class="number">0</span>, y: -<span class="number">20</span>)</span><br><span class="line">                        .center()</span><br><span class="line">                &#125;</span><br><span class="line">            )</span><br><span class="line">            .border(<span class="type">Color</span>.blue, width: <span class="number">2</span>)</span><br><span class="line">            .frame(minWidth: minWidth, maxWidth: maxWidth)</span><br><span class="line">            .overlay(</span><br><span class="line">                <span class="type">GeometryReader</span> &#123; geo <span class="keyword">in</span></span><br><span class="line">                    <span class="type">Text</span>(<span class="string">"\(geo.size.width)"</span>)</span><br><span class="line">                        .foregroundColor(<span class="type">Color</span>.red)</span><br><span class="line">                        .center()</span><br><span class="line">                &#125;</span><br><span class="line">            )</span><br><span class="line">            .border(<span class="type">Color</span>.red, width: <span class="number">1</span>)</span><br><span class="line">            .frame(width: parentWidth, height: <span class="number">100</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">center</span><span class="params">()</span></span> -&gt; some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">Spacer</span>()</span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="type">Spacer</span>()</span><br><span class="line">                <span class="keyword">self</span></span><br><span class="line">                <span class="type">Spacer</span>()</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">Spacer</span>()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Examine_Previews</span>: <span class="title">PreviewProvider</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Group</span> &#123;</span><br><span class="line">            <span class="type">Group</span> &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">"Both minWidth and maxWidth"</span>)</span><br><span class="line">                <span class="type">Examine</span>(parentWidth: <span class="number">75</span>, contentWidth: <span class="number">150</span>, minWidth: <span class="number">100</span>, maxWidth: <span class="number">200</span>)</span><br><span class="line">                    .help(<span class="string">"proposed size &lt; min width"</span>)</span><br><span class="line">                <span class="type">Examine</span>(parentWidth: <span class="number">125</span>, contentWidth: <span class="number">150</span>, minWidth: <span class="number">100</span>, maxWidth: <span class="number">200</span>)</span><br><span class="line">                    .help(<span class="string">"min width &lt; proposed size &lt; content"</span>)</span><br><span class="line">                <span class="type">Examine</span>(parentWidth: <span class="number">175</span>, contentWidth: <span class="number">150</span>, minWidth: <span class="number">100</span>, maxWidth: <span class="number">200</span>)</span><br><span class="line">                    .help(<span class="string">"min width &lt; content &lt; proposed size"</span>)</span><br><span class="line">                <span class="type">Examine</span>(parentWidth: <span class="number">300</span>, contentWidth: <span class="number">150</span>, minWidth: <span class="number">100</span>, maxWidth: <span class="number">200</span>)</span><br><span class="line">                    .help(<span class="string">"min width &lt; content &lt; max width &lt; proposed size"</span>)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="type">Group</span> &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">"Just minWidth"</span>)</span><br><span class="line">                <span class="type">Examine</span>(parentWidth: <span class="number">75</span>, contentWidth: <span class="number">150</span>, minWidth: <span class="number">100</span>)</span><br><span class="line">                <span class="type">Examine</span>(parentWidth: <span class="number">125</span>, contentWidth: <span class="number">150</span>, minWidth: <span class="number">100</span>)</span><br><span class="line">                <span class="type">Examine</span>(parentWidth: <span class="number">175</span>, contentWidth: <span class="number">150</span>, minWidth: <span class="number">100</span>)</span><br><span class="line">                <span class="type">Examine</span>(parentWidth: <span class="number">175</span>, contentWidth: <span class="number">75</span>, minWidth: <span class="number">100</span>)</span><br><span class="line">                    .help(<span class="string">"content &lt; minWidth"</span>)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="type">Group</span> &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">"Just maxWidth"</span>)</span><br><span class="line">                <span class="type">Examine</span>(parentWidth: <span class="number">75</span>, contentWidth: <span class="number">150</span>, maxWidth: <span class="number">200</span>)</span><br><span class="line">                <span class="type">Examine</span>(parentWidth: <span class="number">125</span>, contentWidth: <span class="number">150</span>, maxWidth: <span class="number">200</span>)</span><br><span class="line">                <span class="type">Examine</span>(parentWidth: <span class="number">175</span>, contentWidth: <span class="number">150</span>, maxWidth: <span class="number">200</span>)</span><br><span class="line">                <span class="type">Examine</span>(parentWidth: <span class="number">300</span>, contentWidth: <span class="number">225</span>, maxWidth: <span class="number">200</span>)</span><br><span class="line">                    .help(<span class="string">"content &gt; maxWidth"</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Observation"><a href="#Observation" class="headerlink" title="Observation"></a>Observation</h3><p>Here are the results with different variations of specifying  <code>parentWidth</code> aka proposed width.</p>
<p>🍑 <strong><em>Scenario 1</em></strong>: both minWidth and maxWidth are specified</p>
<p>Our red flexible frame clamps proposed width between its <code>minWidth</code> and <code>maxWidth</code>, ignoring <code>contentWidth</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> redWidth = clamp(minWidth, parentWidth, maxWidth)</span><br></pre></td></tr></table></figure>

<img width="682" alt="Screenshot 2021-01-01 at 23 30 19" src="https://user-images.githubusercontent.com/2284279/103447291-57ab3280-4c89-11eb-9779-99c34162cf56.png">

<p>🍅 <strong><em>Scenario 2</em></strong>: only minWidth is specified</p>
<p>Our red flexible frame clamps proposed width between its <code>minWidth</code> and <code>contentWidth</code>. In case <code>content</code> is less than <code>minWidth</code>, then final width is <code>minWidth</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> redWidth = clamp(minWidth, parentWidth, contentWidth)</span><br></pre></td></tr></table></figure>

<img width="668" alt="Screenshot 2021-01-01 at 23 51 46" src="https://user-images.githubusercontent.com/2284279/103447491-50395880-4c8c-11eb-9395-d0b4b8e3faa1.png">


<p>🍏 <strong><em>Scenario 3</em></strong>: only maxWidth is specified</p>
<p>Our red flexible frame clamps proposed width between its <code>contentWidth</code> and <code>maxWidth</code>. In case <code>content</code> is more than <code>maxWidth</code>, then  final width is <code>maxWidth</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> redWidth = clamp(contentWidth, parentWidth, maxWidth)</span><br></pre></td></tr></table></figure>

<img width="675" alt="Screenshot 2021-01-01 at 23 52 27" src="https://user-images.githubusercontent.com/2284279/103447500-69420980-4c8c-11eb-86c8-db15d95c0829.png">

<h2 id="What-are-idealWidth-and-idealHeight"><a href="#What-are-idealWidth-and-idealHeight" class="headerlink" title="What are idealWidth and idealHeight"></a>What are idealWidth and idealHeight</h2><p>In SwiftUI, view takes proposed frame from its parent, then proposes its to its child, and reports the size it wants from it’s child and its proposed frame from parent. The reported frame is the final frame used by that view.</p>
<p>When we use <code>.frame</code> modifier, SwiftUI does not changes the frame of that view directly. Instead it creates a container around that view.</p>
<p>There are 4 kinds of frame behavior depending on which View we are using. Some have mixed behavior.</p>
<ul>
<li>Sum up frames from its children then report the final frame. For example <code>HStack</code>, <code>VStack</code></li>
<li>Merely use the proposed frame. For example <code>GeometryReader</code>, <code>.overlay</code>, <code>Rectangle</code></li>
<li>Use more space than proposed. For example texts with <code>fixedSize</code></li>
<li>Use only space needed for its content and respect proposed frame as max</li>
</ul>
<h3 id="Fix-the-size-to-its-ideal-size"><a href="#Fix-the-size-to-its-ideal-size" class="headerlink" title="Fix the size to its ideal size"></a>Fix the size to its ideal size</h3><p>Some View like <code>Text</code> or <code>Image</code> has intrinsic content size, means it has implicit <code>idealWidth</code> and <code>idealHeight</code>. Some like <code>Rectangle</code> we need to explicit set <code>.frame(idealWidth: idealHeight)</code>. And these ideal width and height are only applied if we specify <code>fixedSize</code></p>
<p>To understand this, let’s read <a href="https://developer.apple.com/documentation/swiftui/view/fixedsize()">fixedSize</a></p>
<blockquote>
<p>Fixes this view at its ideal size.<br>During the layout of the view hierarchy, each view proposes a size to each child view it contains. If the child view doesn’t need a fixed size it can accept and conform to the size offered by the parent.<br>For example, a Text view placed in an explicitly sized frame wraps and truncates its string to remain within its parent’s bounds:</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Text</span>(<span class="string">"A single line of text, too long to fit in a box."</span>)</span><br><span class="line">    .frame(width: <span class="number">200</span>, height: <span class="number">200</span>)</span><br><span class="line">    .border(<span class="type">Color</span>.gray)</span><br></pre></td></tr></table></figure>

<img width="382" alt="Screenshot 2021-01-02 at 00 15 14" src="https://user-images.githubusercontent.com/2284279/103447744-97751880-4c8f-11eb-93a0-9a8ff96024f1.png">

<blockquote>
<p>The fixedSize() modifier can be used to create a view that maintains the ideal size of its children both dimensions:</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Text</span>(<span class="string">"A single line of text, too long to fit in a box."</span>)</span><br><span class="line">    .fixedSize()</span><br><span class="line">    .frame(width: <span class="number">200</span>, height: <span class="number">200</span>)</span><br><span class="line">    .border(<span class="type">Color</span>.gray)</span><br></pre></td></tr></table></figure>

<img width="523" alt="Screenshot 2021-01-02 at 00 16 11" src="https://user-images.githubusercontent.com/2284279/103447755-ba9fc800-4c8f-11eb-93d8-1bbe1dfd4f3c.png">

<blockquote>
<p>You can think of fixedSize() as the creation of a counter proposal to the view size proposed to a view by its parent. The ideal size of a view, and the specific effects of fixedSize() depends on the particular view and how you have configured it.</p>
</blockquote>
<p>To view this in playground, I have prepared this snippet</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Text_Previews</span>: <span class="title">PreviewProvider</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span>(spacing: <span class="number">16</span>) &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">"A single line of text, too long to fit in a box."</span>)</span><br><span class="line">                .fixedSize()</span><br><span class="line">                .border(<span class="type">Color</span>.red)</span><br><span class="line">                .frame(width: <span class="number">200</span>, height: <span class="number">200</span>)</span><br><span class="line">                .border(<span class="type">Color</span>.gray)</span><br><span class="line">        &#125;</span><br><span class="line">        .padding()</span><br><span class="line">        .frame(width: <span class="number">500</span>, height: <span class="number">500</span>)</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Here we can see that our canvas is 500x500, and the <code>Text</code> grows outside its parent frame 200x200</p>
<img width="666" alt="Screenshot 2021-01-02 at 00 17 29" src="https://user-images.githubusercontent.com/2284279/103447779-e8850c80-4c8f-11eb-9126-65d4da3e28ed.png">

<h3 id="Play-with-Rectangle"><a href="#Play-with-Rectangle" class="headerlink" title="Play with Rectangle"></a>Play with Rectangle</h3><p>Remember that shapes like <code>Rectangle</code> takes up all the proposed size. When we explicitly specify <code>fixedSize</code>, the<code>idealWidth</code> and <code>idealHeight</code> are used.</p>
<p>Here I have 3 rectangle</p>
<p>🍎 Red: There are no ideal size explicitly specified, so SwiftUI uses a magic number <code>10</code> as the size<br>🍏 Green: We specify frame directly and no idealWidth, idealHeight and no fixedSize, so this rectangle takes up full frame<br>🧊 Blue: The outer gray box has height 50, but this rectangle uses <code>idealWidth</code> and <code>idealHeight</code> of 200 because we specify <code>fixedSize</code> </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ContentView_Previews</span>: <span class="title">PreviewProvider</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span>(spacing: <span class="number">16</span>) &#123;</span><br><span class="line">            <span class="type">Rectangle</span>()</span><br><span class="line">                .fill(<span class="type">Color</span>.red)</span><br><span class="line">                .fixedSize()</span><br><span class="line"></span><br><span class="line">            <span class="type">Rectangle</span>()</span><br><span class="line">                .fill(<span class="type">Color</span>.green)</span><br><span class="line">                .frame(width: <span class="number">100</span>, height: <span class="number">100</span>)</span><br><span class="line"></span><br><span class="line">            <span class="type">Rectangle</span>()</span><br><span class="line">                .fill(<span class="type">Color</span>.blue)</span><br><span class="line">                .frame(idealWidth: <span class="number">200</span>, idealHeight: <span class="number">200</span>)</span><br><span class="line">                .fixedSize(horizontal: <span class="literal">true</span>, vertical: <span class="literal">true</span>)</span><br><span class="line">                .frame(height: <span class="number">50</span>)</span><br><span class="line">                .border(<span class="type">Color</span>.gray)</span><br><span class="line">        &#125;</span><br><span class="line">        .padding()</span><br><span class="line">        .frame(width: <span class="number">500</span>, height: <span class="number">500</span>)</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img width="613" alt="Screenshot 2021-01-02 at 00 23 29" src="https://user-images.githubusercontent.com/2284279/103447838-be801a00-4c90-11eb-85d6-eff53ecd987e.png">

<hr>
<p><strong>Updated at</strong> 2021-01-01 23:25:08</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-12-16T19:24:56.000Z" title="2020-12-16T19:24:56.000Z">2020-12-16</time><span class="level-item">15 minutes read (About 2185 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/My-year-in-review-2020/">My year in review 2020</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/715">#715</a></strong></p>
<p>I remember this time last year in December 2019, I spent almost every single bit of my free time on <a href="https://github.com/pumaswift/Puma">Puma</a> because I want a Swift friendly version of fastlane that suits my need and leverages Swift 5 features. </p>
<p>Here’s my review of my work in year 2020.</p>
<h2 id="Blogging"><a href="#Blogging" class="headerlink" title="Blogging"></a>Blogging</h2><p>I started blogging on GitHub issue, starting from <a href="https://github.com/onmyway133/blog/issues/1">Issue 1 Hello world, again</a>, now I have over 670 issues, which were generated into blog posts at my website <a href="https://onmyway133.com/">https://onmyway133.com/</a></p>
<p>🍏 I used to use onmyway133.github.io domain, but then it feels right to have my own domain<br>🍎 I used to write a lot at Medium <a href="https://medium.com/@onmyway133">https://medium.com/@onmyway133</a> for many publications and my own Fantageek publication, I have got 2.3k followers with around 60k views per month<br>🍓 I list my most favorite articles, usually articles that I spent most time polishing here <a href="https://onmyway133.com/writing/">https://onmyway133.com/writing/</a></p>
<p>One of my very first articles published on Flawless iOS publication was <a href="https://medium.com/flawless-app-stories/a-better-way-to-update-uicollectionview-data-in-swift-with-diff-framework-924db158db86">A better way to update UICollectionView data in Swift with diff framework</a> gets the highest traffic ever, and was rated most trending Swift article for 2018.</p>
<p>My one of few articles published in Medium in 2019 was <a href="https://medium.com/flawless-app-stories/how-to-make-auto-layout-more-convenient-in-ios-df3b42fed37f">How to make Auto Layout more convenient in iOS</a> got featured in iOS Dev Weekly, and used to promote my library <a href="https://github.com/onmyway133/EasyAnchor">EasyAnchor</a></p>
<p>My big article this year is <a href="https://onmyway133.com/blog/how-to-test-push-notifications-in-simulator-and-production-ios-apps/">How to test push notifications in simulator and production iOS apps</a>, which was also featured on iOS Dev Weekly, used to summary the changes in push notifications from iOS 7 to iOS 14, and to promote my push notification testing tool <a href="https://twitter.com/pushheroapp">Push Hero</a></p>
<p>My blog at <a href="https://onmyway133.com/">https://onmyway133.com/</a> has around 15k views each month. I can write proper, lengthy articles to get more views but I don’t want to. I want to write blog about solutions I have found, so that my future self can benefit from it without searching too much.</p>
<p><img src="https://user-images.githubusercontent.com/2284279/102402948-cfb8fd80-3fe5-11eb-9f7a-b7a85d0ad450.jpeg" alt="views"></p>
<h2 id="Open-source"><a href="#Open-source" class="headerlink" title="Open source"></a>Open source</h2><p>I have done quite a lot of open source, you can view here <a href="https://onmyway133.com/opensource/">Open source</a>. These have helped tons of apps, with 45k+ apps touched, and 3.4m+ downloads as stats on CocoaPods</p>
<p>My 4 libraries this year get inspired by SwiftUI and property wrappers</p>
<p>🍌 <a href="https://github.com/onmyway133/Spek">Spek</a> leverages property wrapper to provide Spec syntax, similar to Quick, but simpler and can generate tests<br>🍈 <a href="https://github.com/onmyway133/Micro">Micro</a> imitates SwiftUI State and ForEach syntax but use UICollectionView with diffable datasource, powered by my another library <a href="https://github.com/onmyway133/DeepDiff">DeepDiff</a><br>🍑 <a href="https://github.com/onmyway133/EasySwiftUI">EasySwiftUI</a> contains many extensions and useful modifier that I use in my SwiftUI apps<br>🥝 <a href="https://github.com/onmyway133/FontAwesomeSwiftUI">FontAwesomeSwiftUI</a> I was tired of using bitmap with dark and light variants, and I can’t use SFSymbols as I want to support macOS 10.15, so FontAwesome is a perfect choice. I couldn’t find library that has support for SwiftUI and easy to use with Swift Package Manager for iOS and macOS, so I made one</p>
<p>Besides, for all my libraries <a href="https://github.com/onmyway133/EasyStash">EasyStash</a>, <a href="https://github.com/onmyway133/EasyAnchor">EasyAnchor</a>, <a href="https://github.com/onmyway133/EasyTheme">EasyTheme</a>, <a href="https://github.com/onmyway133/EasyClosure">EasyClosure</a>, … I have now support Swift Package Manager, which is nicer to integrate. Thank you CocoaPods for all these years.</p>
<p>There are now 1.6k people following me on GitHub, that means a lot, meaning somehow my work is useful</p>
<p>Lately, I open source <a href="https://github.com/onmyway133/awesome-swiftui">awesome-swiftui</a> which I curate all SwiftUI resources, articles and libraries that I find useful for my apps</p>
<p>❤️ One day, I got sponsor from my dear friend <a href="https://twitter.com/zenangst">Chris</a> for my GitHub open source. Chris is my open source idol who ignited my desire for open source. No one loves open source more than Chris</p>
<blockquote class="twitter-tweet"><p lang="en" dir="ltr">This means the world to me! If everyone was as lucky as me to just get to inspire one person, the world would be an amazing place. Let&#39;s make it amazing together! Keep rocking because you are amazing &amp; you can bring out the best in others! ❤️ <a href="https://t.co/pJx9obWH7I">https://t.co/pJx9obWH7I</a></p>&mdash; Christoffer Winterkvist (@zenangst) <a href="https://twitter.com/zenangst/status/1309403013237403649?ref_src=twsrc%5Etfw">September 25, 2020</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

<h2 id="Apps"><a href="#Apps" class="headerlink" title="Apps"></a>Apps</h2><p>I started making some apps late last year, first I published them on Gumroad, but it didn’t feel right, and then I published all my apps on AppStore. I like sandboxed apps from AppStore because they limit what the apps can do.</p>
<p>Apps without Twitter account and landing page seem off, so in May I started revamping my websites, and I wrote my <a href="https://onmyway133.com/apps/">apps</a> page firstly with pure HTML and CSS, then I rewrote in React, because I like React and Javascript.</p>
<p>Notably, early 2020 I made <a href="https://twitter.com/pushheroapp">Push Hero</a>, <a href="https://twitter.com/PastePalApp">PastePal</a> then I made a complete overhaul lately with more features, thanks to all the feedback. I also took the time to revamp landing pages a lot, you can check landing pages for <a href="https://onmyway133.com/pushhero">Push Hero</a> for example because I have a white label solution</p>
<p>Learn how I did <a href="https://onmyway133.github.io/blog/How-to-make-white-label-React-app-for-landing-pages/">white label landing page using React</a></p>
<p>I have a lot of ideas, but very little time.</p>
<h2 id="Learning"><a href="#Learning" class="headerlink" title="Learning"></a>Learning</h2><p>Coding can be done, but design is never finished. When making apps, I feel like I’m not certain at some design decisions and no matter how I landed with some designs, I didn’t feel happy. Then I took some design courses and books.</p>
<p>Below is my tweet that I share some design resources that I found useful</p>
<blockquote class="twitter-tweet"><p lang="en" dir="ltr">Developer with design skill is like tiger with wings. Here are my recommended courses<br><br>The UI Design Bootcamp by <a href="https://twitter.com/designcoursecom?ref_src=twsrc%5Etfw">@designcoursecom</a> a massive UI design course teaches you to build beautiful and well-functioning user interfaces using HTML and CSS.<a href="https://t.co/vfusXamuhJ">https://t.co/vfusXamuhJ</a></p>&mdash; Khoa 🔥 (@onmyway133) <a href="https://twitter.com/onmyway133/status/1320464953548091393?ref_src=twsrc%5Etfw">October 25, 2020</a></blockquote> 

<h2 id="Listening"><a href="#Listening" class="headerlink" title="Listening"></a>Listening</h2><p>I used to listen to tech podcasts, then I was bored. Discussions like whether to use MVVM vs MVC, SwiftUI vs Catalyst, Swift vs Objective don’t interest me anymore.</p>
<p>If you ask me for choices, my default answer will be NO. Those who are super passionate about their idea will just ignore my advice and do it anyway.</p>
<p>Then I listen to indie and product development podcasts, it was inspiring. Once I got the mindset, they also became boring.<br>Now I listen to mostly books on Storytel, some books about habit and making time really make my days.</p>
<h2 id="Tweet"><a href="#Tweet" class="headerlink" title="Tweet"></a>Tweet</h2><p>I came back to Twitter early this year after quitting it for a while because I got enough of all negative and nonsense political debates. But then I found that I can decide who I can follow and what content I want to view. Then I started organizing List, making my own Chrome extensions to automate things and control what I want to view. I have followed quite many indie developers and great product people, I’ve learnt a lot. The downside is I’m overwhelmingly inspired, I can’t sleep.</p>
<p>I try to tweet more about what I’ve learned, sharing articles that I have written. For example here I share about how to gain product idea</p>
<blockquote class="twitter-tweet"><p lang="en" dir="ltr">How to gain product ideas?<br><br>1) Scratch your own itch. If you don&#39;t have any itch to scratch, stop here. This is awkward. Go travelling. Go exploring the world. The world always has problems and needs solution. <a href="https://t.co/07gIoJfJet">pic.twitter.com/07gIoJfJet</a></p>&mdash; Khoa 🔥 (@onmyway133) <a href="https://twitter.com/onmyway133/status/1330399823921557507?ref_src=twsrc%5Etfw">November 22, 2020</a></blockquote>

<h2 id="WWDC-Together"><a href="#WWDC-Together" class="headerlink" title="WWDC Together"></a>WWDC Together</h2><p>Notable this year is the website I make <a href="https://wwdctogether.com/">WWDC Together</a> as a place for developers like us to hangout and watch videos together. Each video acts like its own chat room, you can also create private chatroom. My colleagues use this and we watched WWDC together with coke and pizza, it was a lot of fun.</p>
<blockquote class="twitter-tweet"><p lang="en" dir="ltr">I&#39;m excited to launch <a href="https://twitter.com/wwdctogether?ref_src=twsrc%5Etfw">@wwdctogether</a> as a free place to watch and hangout during WWDC. We can now view upcoming and previous sessions via modern playback, with a chatroom for each session. Hope this provides a similar WWDC vibe during this hard time ❤️🔥<a href="https://t.co/0SgGnUAqst">https://t.co/0SgGnUAqst</a> <a href="https://t.co/f9H9wDi62P">pic.twitter.com/f9H9wDi62P</a></p>&mdash; Khoa 🔥 (@onmyway133) <a href="https://twitter.com/onmyway133/status/1273243022826835970?ref_src=twsrc%5Etfw">June 17, 2020</a></blockquote> 

<p>I had the idea like 2 weeks before WWDC, so I had to make it quick. Working with React is fun to me, it is like playing video game.</p>
<p>I was lucky to be asked by John to write a guest post <a href="https://wwdcbysundell.com/2020/wwdc-together/">Behind the scenes of WWDC Together with Khoa Pham</a> on his website.</p>
<p>It was also mentioned by Paul in his WWDC wrap up <a href="https://www.hackingwithswift.com/articles/222/wwdc20-wrap-up-and-recommended-talks">WWDC20: Wrap up and recommended talks</a></p>
<blockquote>
<p>One area that absolutely flourished this year was community organization. Sites like <a href="https://wwdcwatch.party">https://wwdcwatch.party</a> and <a href="https://wwdctogether.com">https://wwdctogether.com</a> took a huge amount of work to organize, but meant that people had the chance to have some interaction – had the chance to actually chat about WWDC and share their excitement. I’m really grateful to Michie, Khoa, and other community organizers for making this happen.</p>
</blockquote>
<p>I also got to share about in in a well known Norwegian tech website <a href="https://www.kode24.no/kodenytt/norske-wwdc-together-lar-oss-se-pa-apples-konferanse-sammen/72584043">orske WWDC Together lar oss se på Apples konferanse sammen</a></p>
<h2 id="Speaking"><a href="#Speaking" class="headerlink" title="Speaking"></a>Speaking</h2><p>In 2019, I made several meetup talks, and one pre conf talk for Mobile Era conf</p>
<blockquote class="twitter-tweet"><p lang="en" dir="ltr">An overview of what we as mobile developers have for <a href="https://twitter.com/hashtag/MachineLearning?src=hash&amp;ref_src=twsrc%5Etfw">#MachineLearning</a> in the session by <a href="https://twitter.com/onmyway133?ref_src=twsrc%5Etfw">@onmyway133</a> at <a href="https://twitter.com/mobileeraconf?ref_src=twsrc%5Etfw">@mobileeraconf</a> Community Evening <a href="https://t.co/bgcE3huGkI">pic.twitter.com/bgcE3huGkI</a></p>&mdash; Mobile Meetup Oslo (@mobileoslo) <a href="https://twitter.com/mobileoslo/status/1192154165751033856?ref_src=twsrc%5Etfw">November 6, 2019</a></blockquote> 

<p>In 2020, I’m lucky to be invited to talk in some events</p>
<p>🍅 WWDC Watch Party</p>
<blockquote class="twitter-tweet"><p lang="en" dir="ltr">Thank you <a href="https://twitter.com/JohnEstropia?ref_src=twsrc%5Etfw">@johnestropia</a> <a href="https://twitter.com/thesunshinejr?ref_src=twsrc%5Etfw">@thesunshinejr</a> <a href="https://twitter.com/onmyway133?ref_src=twsrc%5Etfw">@onmyway133</a> for sharing your experience to the community about Open Source Life and thank you for making our dev life better because of your projects! You are all awesome! ❤️<a href="https://twitter.com/hashtag/WWDCWatchParty?src=hash&amp;ref_src=twsrc%5Etfw">#WWDCWatchParty</a> <a href="https://twitter.com/hashtag/WWDC20?src=hash&amp;ref_src=twsrc%5Etfw">#WWDC20</a> <a href="https://t.co/tfsX7PtKcO">pic.twitter.com/tfsX7PtKcO</a></p>&mdash; wwdcwatchparty (@wwdcwatchparty) <a href="https://twitter.com/wwdcwatchparty/status/1277214349246042112?ref_src=twsrc%5Etfw">June 28, 2020</a></blockquote> 

<p>I’m happy to be invited by Michie to talk along side with <a href="https://twitter.com/JohnEstropia">John</a> and <a href="https://twitter.com/thesunshinejr">Łukasz</a>, whom I really admire for their awesome open source contribution, to talk about how to start and contribute to open source</p>
<p>🥦 Bitrise webminar</p>
<blockquote class="twitter-tweet"><p lang="en" dir="ltr">During the 4th installment of our BUG <a href="https://twitter.com/hashtag/webinar?src=hash&amp;ref_src=twsrc%5Etfw">#webinar</a> series, our main focus was <a href="https://twitter.com/hashtag/iOSDev?src=hash&amp;ref_src=twsrc%5Etfw">#iOSDev</a> and <a href="https://twitter.com/hashtag/WWDC20?src=hash&amp;ref_src=twsrc%5Etfw">#WWDC20</a>. Let&#39;s recap what we discussed with our guests, <a href="https://twitter.com/StuFFmc?ref_src=twsrc%5Etfw">@StuffMC</a>, <a href="https://twitter.com/axbotkin?ref_src=twsrc%5Etfw">@axbotkin</a>, <a href="https://twitter.com/Moatazeldebsy?ref_src=twsrc%5Etfw">@Moatazeldebsy</a>, and <a href="https://twitter.com/onmyway133?ref_src=twsrc%5Etfw">@onmyway133</a> in our freshest blog post! ✨🔥<a href="https://t.co/rrA8cyYXus">https://t.co/rrA8cyYXus</a></p>&mdash; Bitrise (@bitrise) <a href="https://twitter.com/bitrise/status/1283431144726368258?ref_src=twsrc%5Etfw">July 15, 2020</a></blockquote> 

<p>I shared my thoughts about my favorites at WWDC and the future ahead</p>
<p>🍇 Contributing.today</p>
<p>During Hacktoberfest 2020, I was contacted by my friend <a href="https://twitter.com/webmaxru">Maxim</a> to share about open source </p>
<blockquote class="twitter-tweet"><p lang="en" dir="ltr">I had a pleasure to interview <a href="https://twitter.com/hashtag/OSS?src=hash&amp;ref_src=twsrc%5Etfw">#OSS</a> contributors from Norway <a href="https://twitter.com/DrMowinckels?ref_src=twsrc%5Etfw">@DrMowinckels</a> and <a href="https://twitter.com/onmyway133?ref_src=twsrc%5Etfw">@onmyway133</a> for CONTRIBUTING project. October 2nd we kickoff <a href="https://twitter.com/hashtag/Hacktoberfest?src=hash&amp;ref_src=twsrc%5Etfw">#Hacktoberfest</a> by online meetup about getting started with Open Source at 16:00 CEST. Join our sessions &amp; workshops: <a href="https://t.co/hKkMKEOJJe">https://t.co/hKkMKEOJJe</a> <a href="https://t.co/1yr2AhQ4B6">https://t.co/1yr2AhQ4B6</a></p>&mdash; Maxim Salnikov (@webmaxru) <a href="https://twitter.com/webmaxru/status/1311674525604622337?ref_src=twsrc%5Etfw">October 1, 2020</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

<h2 id="Work"><a href="#Work" class="headerlink" title="Work"></a>Work</h2><p>I’m happy to continue another awesome year at Shortcut and DNB, where I have awesome and super nice colleagues. I ‘ve made lots of friends who I can talk with, who invited me to play badminton, tennis, football, swimming, hiking. Why didn’t we meet earlier?</p>
<p>I was lucky to attend a workshop hosted by John Sundell at work, I learned a lot</p>
<blockquote class="twitter-tweet"><p lang="en" dir="ltr">Ran my first ever large-scale remote workshop today, with over 25 participants, 10 different ongoing video calls for pair programming, and a ton of live coding 😀 Was so much fun!<br><br>Thanks a lot to the wonderful team at <a href="https://twitter.com/shortcut_no?ref_src=twsrc%5Etfw">@shortcut_no</a> for inviting me 😊 <a href="https://t.co/CE4P8Slo1G">https://t.co/CE4P8Slo1G</a></p>&mdash; John Sundell (@johnsundell) <a href="https://twitter.com/johnsundell/status/1298992825422327808?ref_src=twsrc%5Etfw">August 27, 2020</a></blockquote>

<h2 id="Life"><a href="#Life" class="headerlink" title="Life"></a>Life</h2><p>Thanks for a memorable year, despite all the lockdown. And remember, balance work and life. You don’t need to be super rich to be happy. Having lots of money in the bank while living alone is not fun at all.</p>
<p>Another year is coming to an end. When looking back, do you miss the time you didn’t spend with your friends and family, or do you miss the time you didn’t get to do your work?</p>
<h2 id="May-your-code-continue-to-compile-🙏"><a href="#May-your-code-continue-to-compile-🙏" class="headerlink" title="May your code continue to compile 🙏"></a>May your code continue to compile 🙏</h2><p><strong>Updated at</strong> 2021-01-01 23:25:50</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-10-11T02:11:14.000Z" title="2020-10-11T02:11:14.000Z">2020-10-11</time><span class="level-item">19 minutes read (About 2812 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-test-push-notifications-in-simulator-and-production-iOS-apps/">How to test push notifications in simulator and production iOS apps</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/682">#682</a></strong></p>
<p>After has recently reminded about his updating <a href="https://developer.apple.com/news/?id=c88acm2b">APNs provider API</a> which makes me realised a lot has changed about push notifications, both in terms of client and provider approach. </p>
<blockquote>
<p>The HTTP/2-based Apple Push Notification service (APNs) provider API lets you take advantage of great features, such as authentication with a JSON Web Token, improved error messaging, and per-notification feedback. If you send push notifications with the legacy binary protocol, we strongly recommend upgrading to the APNs provider API.</p>
</blockquote>
<p>From the the iOS client point of view, you pretty much don’t need to care about provider API, as you only need to register for push notification capability and send the device token to your backend, and it’s the backend’s job to send push request to Apple notifications server.</p>
<p>But it’s good to know the underlying mechanism, especially when you want to troubleshoot push notification. Since a push notification failure can be because of many reasons: it could be due to some failed logic in your backend, or that the push certificate has expired, or that you have sent the wrong device token, or that user has turned off push permission in Settings app, or that the push has been delayed.</p>
<p>Here’s also a common abbreviations you need to learn: <code>APNs</code> it is short for Apple Push Notification service. You can think of it as the server your device always has connection with, so you’re ready for any server push messages from it.</p>
<h2 id="What-is-binary-provider-API"><a href="#What-is-binary-provider-API" class="headerlink" title="What is binary provider API"></a>What is binary provider API</h2><p>Push notification feature was first introduced by Apple in 2009 via a fairly complex <a href="https://developer.apple.com/library/archive/documentation/NetworkingInternet/Conceptual/RemoteNotificationsPG/BinaryProviderAPI.html">binary provider API</a></p>
<p><img src="https://user-images.githubusercontent.com/2284279/95670009-ca26dd80-0b86-11eb-8ff9-5dbb4d1d312c.png" alt="binary"></p>
<p>In short, binary provider API is just a specification about which address and which format to send push request to Apple push server. The binary interface of the production environment is available through <code>gateway.push.apple.com, port 2195</code> and development environment <code>gateway.sandbox.push.apple.com, port 2195</code>. The binary interface employs a plain TCP socket for binary content that is streaming in nature.</p>
<p>As you can see in the package instruction above, we need specify frame length and data. Data is a key value pairs of multiple informations like device token, expiration, topic, priority.</p>
<p>Send request to the above addresses via secured TLS or SSL channel. The SSL certificate required for these connections is obtained from your developer account.</p>
<h2 id="The-new-HTTP-2-provider-API"><a href="#The-new-HTTP-2-provider-API" class="headerlink" title="The new HTTP/2 provider API"></a>The new HTTP/2 provider API</h2><p>The new <a href="https://developer.apple.com/documentation/usernotifications/setting_up_a_remote_notification_server/sending_notification_requests_to_apns/">HTTP2/ provider API</a> is recommended, it has detailed error reporting and better throughput. If you use <a href="https://developer.apple.com/documentation/foundation/urlsession">URLSession</a> which supports the HTTP/1.1 and HTTP/2 protocols. HTTP/2 support, as described by RFC 7540, you will feel familiar.</p>
<p>In short, when you have a notification to send to a user, your provider must construct a POST request and send it to Apple Push Notification service (APNs). Your request must include the following information:</p>
<ul>
<li>The JSON payload that you want to send</li>
<li>The device token for the user’s device</li>
<li>Request-header fields specifying how to deliver the notification</li>
<li>For token-based authentication, your provider server’s current authentication token</li>
</ul>
<p>Upon receiving your server’s POST request, APNs validates the request using either the provided authentication token or your server’s certificate. If validation succeeds, APNs uses the provided device token to identify the user’s device. It then tries to send your JSON payload to that device.</p>
<p>So it’s pretty much how you configure <code>URLRequest</code>with <code>URLSession</code>, specify base url, some request headers including the authorization and the payload body.</p>
<p>Use HTTP/2 and TLS 1.2 or later to establish a connection to the new provider API endpoint. For development serverit is <code>api.sandbox.push.apple.com:443</code> and for production server it is <code>api.push.apple.com:443</code>. You then send the request as <code>POST</code> and Apple will do its job to verify and send the push notification to the users device.</p>
<h2 id="Certificate-vs-token-based-authentication"><a href="#Certificate-vs-token-based-authentication" class="headerlink" title="Certificate vs token based authentication"></a>Certificate vs token based authentication</h2><p>To send push request to APNs, you need to authenticate to tell that is really from you. APNs support 2 types of authentication, the traditional way with a certificate, and the recently new recommended way with a p8 token.</p>
<h3 id="Certificate-based-authentication"><a href="#Certificate-based-authentication" class="headerlink" title="Certificate based authentication"></a>Certificate based authentication</h3><p>For <a href="https://developer.apple.com/documentation/usernotifications/setting_up_a_remote_notification_server/establishing_a_certificate-based_connection_to_apns">certificate based authentication</a>, you will need a p12 certificate which you can obtain and generate from your Developer account.</p>
<p><img src="https://user-images.githubusercontent.com/2284279/95670291-81bcef00-0b89-11eb-8e98-92112c414476.png" alt="cer"></p>
<p>Because there are sandbox and production push endpoint, few years ago it was required to have separate sandbox and production environment push certificate, which you had to create separately in your Apple developer account, then in testing need to specify the correct push certificate for each environment.</p>
<p>Now around iOS 10 year we can use just 1 single certificate for both sandbox and production, which is a relief for us developers. When we create certificate on Apple developer page, we need to upload a certificate signing request that we can generate from Keychain Access app. After we download the generated push certificate, download and run it in Keychain, there we can generate p12 key file that contains both certificate and private key to sign our push request.</p>
<p>Certificate and provisioning profiles valid for only 1 year. So every year you have to renew push notification certificates, which is also a good and bad thing. Besides that, every app differs from bundle id, so we kinda have to generate certificate for each app.</p>
<h3 id="Token-based-authentication"><a href="#Token-based-authentication" class="headerlink" title="Token based authentication"></a>Token based authentication</h3><p><a href="https://developer.apple.com/documentation/usernotifications/setting_up_a_remote_notification_server/establishing_a_token-based_connection_to_apns">Token-based authentication</a> offers a stateless way to communicate with APNs. Stateless communication is faster than certificate-based communication because it doesn’t require APNs to look up the certificate, or other information, related to your provider server. There are other advantages to using token-based authentication:</p>
<p>The cool thing about token is that you can use one token to distribute notifications for all of your company’s apps. You can create in your Apple developer account. Key authentication is the recommended way to authenticate with Apple services, so it is used not only for push services, but also for MusicKit and DeviceCheck.</p>
<p><img src="https://user-images.githubusercontent.com/2284279/95670409-a796c380-0b8a-11eb-87a5-169d48e738de.png" alt="key"></p>
<p>When you request a key, Apple gives you a 10-character string with the Key ID which you must include this string in your JSON tokens and an authentication token signing key, specified as a text file (with a .p8 file extension). The key is allowed to download once and you need to keep it properly.</p>
<p>The token that you include with your notification requests uses the JSON Web Token (JWT) specification. The token itself contains four key-value pairs</p>
<img width="811" alt="Screenshot 2020-10-11 at 06 28 34" src="https://user-images.githubusercontent.com/2284279/95670434-ff352f00-0b8a-11eb-8d28-2e5b07a6875e.png">

<p>After all, the JSON Web Token is encoded in this <code>authorization</code> HTTP headers in your request like this</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">authorization &#x3D; bearer eyAia2lkIjogIjhZTDNHM1JSWDciIH0.eyAiaXNzIjogIkM4Nk5WOUpYM0QiLCAiaWF0I</span><br><span class="line">		 jogIjE0NTkxNDM1ODA2NTAiIH0.MEYCIQDzqyahmH1rz1s-LFNkylXEa2lZ_aOCX4daxxTZkVEGzwIhALvkClnx5m5eAT6</span><br><span class="line">		 Lxw7LZtEQcH6JENhJTMArwLf3sXwi</span><br></pre></td></tr></table></figure>

<p>For security, APNs requires you to refresh your token regularly. Refresh your token no more than once every 20 minutes and no less than once every 60 minutes.</p>
<h2 id="How-to-register-for-push-notifications-from-iOS-app"><a href="#How-to-register-for-push-notifications-from-iOS-app" class="headerlink" title="How to register for push notifications from iOS app"></a>How to register for push notifications from iOS app</h2><p>The APIs to register for remote notification has changed over the years.</p>
<h3 id="iOS-7"><a href="#iOS-7" class="headerlink" title="iOS 7"></a>iOS 7</h3><p>In iOS 7, we used to use this method <a href="https://developer.apple.com/documentation/uikit/uiapplication/1623010-registerforremotenotificationtyp?language=objc">registerForRemoteNotificationTypes</a> to register to receive remote notifications of the specified types via Apple Push Notification service.</p>
<p>The types can be <code>UIRemoteNotificationTypeBadge</code>, <code>UIRemoteNotificationTypeAlert</code>, <code>UIRemoteNotificationTypeSound</code></p>
<p>When you send this message, the device initiates the registration process with Apple Push Notification service. If it succeeds, the app delegate receives a device token in the <code>application:didRegisterForRemoteNotificationsWithDeviceToken:</code> method; if registration doesn’t succeed, the delegate is informed via the <code>application:didFailToRegisterForRemoteNotificationsWithError:</code>method. If the app delegate receives a device token, it should connect with its provider and pass it the token.</p>
<h3 id="iOS-8-with-registerUserNotificationSettings"><a href="#iOS-8-with-registerUserNotificationSettings" class="headerlink" title="iOS 8 with registerUserNotificationSettings"></a>iOS 8 with <code>registerUserNotificationSettings</code></h3><p>From iOS 8, there’s separation between asking for a remote notification with device token, and with presenting push message to the user. This confused developers as these 2 things are separate now.</p>
<p>First, we use <a href="https://developer.apple.com/documentation/uikit/uiapplication/1623078-registerforremotenotifications">registerForRemoteNotifications</a> to register to receive remote notifications via Apple Push Notification service.</p>
<p>Call this method to initiate the registration process with Apple Push Notification service. If registration succeeds, the app calls your app delegate object’s <code>application(_:didRegisterForRemoteNotificationsWithDeviceToken:)</code> method and passes it a device token. You should pass this token along to the server you use to generate remote notifications for the device. If registration fails, the app calls its app delegate’s <code>application(_:didFailToRegisterForRemoteNotificationsWithError:)</code> method instead.</p>
<p>In short, this is to receive device token from APNs so we can do silent push notification or other things. Note that we need to enable <code>Remote notification</code> capability for Background modes.</p>
<img width="999" alt="Screenshot 2020-10-11 at 06 39 46" src="https://user-images.githubusercontent.com/2284279/95670516-90f16c00-0b8c-11eb-8569-74fe99007ba5.png">

<p>To present push message to user via alert, banner, badge or sound, we need to explicitly ask for using this method <a href="https://developer.apple.com/documentation/uikit/uiapplication/1622932-registerusernotificationsettings">registerUserNotificationSettings</a> to registers your preferred options for notifying the user.</p>
<p>If your app displays alerts, play sounds, or badges its icon, you must call this method during your launch cycle to request permission to alert the user in these ways. After calling this method, the app calls the <code>application(_ application: UIApplication, didRegister notificationSettings: UIUserNotificationSettings)</code> method of its app delegate to report the results. You can use that method to determine if your request was granted or denied by the user.</p>
<h3 id="iOS-10-with-UserNotifications-framework"><a href="#iOS-10-with-UserNotifications-framework" class="headerlink" title="iOS 10 with UserNotifications framework"></a>iOS 10 with UserNotifications framework</h3><p>In iOS 10, Apple introduced <code>UserNotifications</code> and <code>UserNotificationsUI</code> framework and lots of new features to push notifications like actions and attachments.</p>
<p>To ask for permission to present push message from iOS 10, use the new <code>UNUserNotificationCenter</code> which accepts options and block callback with grant status.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">UNUserNotificationCenter</span>.current().requestAuthorization(options: [.badge, .sound, .alert])</span><br></pre></td></tr></table></figure>

<p><img src="https://user-images.githubusercontent.com/2284279/95670610-d95d5980-0b8d-11eb-86c9-4d4ab16e31f6.png" alt="abc"></p>
<p>There ‘s also <code>UNNotificationAction</code> and <code>UNNotificationAttachment</code> to specify additional actions and attachment to go along with the push message, this is very handy for visual purpose and convenient actions user can perform right away from the push message.</p>
<p>There’s also a convenient <code>UserNotificationsUI</code> that was shipped with iOS 10 that allows us to embed custom view controller from our push message</p>
<p><img src="https://user-images.githubusercontent.com/2284279/95670635-4e309380-0b8e-11eb-88c5-8cd591d8665e.png" alt="ui"></p>
<p>When an iOS device receives a notification containing an alert, the system displays the contents of the alert in two stages. Initially, it displays an abbreviated banner with the title, subtitle, and two to four lines of body text from the notification. If the user presses the abbreviated banner, iOS displays the full notification interface, including any notification-related actions. The system provides the interface for the abbreviated banner, but you can customize the full interface using a notification content app extension.</p>
<p>Also, there is this callback <a href="https://developer.apple.com/documentation/usernotifications/unusernotificationcenterdelegate/1649518-usernotificationcenter">userNotificationCenter _:willPresent</a> that asks the delegate how to handle a notification that arrived while the app was running in the foreground.</p>
<p>If your app is in the foreground when a notification arrives, the shared user notification center calls this method to deliver the notification directly to your app. If you implement this method, you can take whatever actions are necessary to process the notification or show it when your app is running.</p>
<h3 id="iOS-12-with-provisional-push"><a href="#iOS-12-with-provisional-push" class="headerlink" title="iOS 12 with provisional push"></a>iOS 12 with provisional push</h3><p>New in iOS 12 is the <code>UNAuthorizationStatus.provisional</code>, which are notifications that appear silently in the user’s notification center without appearing on the user’s home screen. We can start sending them as soon as a user has downloaded and run your app for the first time. You can send provisional push notifications unlimited times unless the user explicitly turns them off.</p>
<img width="333" alt="Screenshot 2020-10-11 at 06 58 34" src="https://user-images.githubusercontent.com/2284279/95670721-30aff980-0b8f-11eb-89c0-6d4c39d314c0.png">

<p>This is good to send unobtrusive push to users in their Notification Center where they can pick up at a later time.  </p>
<h3 id="iOS-13-with-apns-push-type"><a href="#iOS-13-with-apns-push-type" class="headerlink" title="iOS 13 with apns-push-type"></a>iOS 13 with apns-push-type</h3><p>Starting with iOS 13 and watchOS 6, there is <code>apns-push-type</code> which must accurately reflect the contents of your notification’s payload. If there is a mismatch, or if the header is missing on required systems, APNs may return an error.</p>
<p>The <code>apns-push-type</code> header field has six valid values. The descriptions below describe when and how to use these values. For example <code>alert</code> for notifications that trigger a user interaction and <code>background</code> for notifications that deliver content in the background.</p>
<p>In a WWDC 2019 session <a href="https://developer.apple.com/videos/play/wwdc2019/707/?time=799">Advances in App Background Execution</a>, <code>apns-priority</code> must be set to 5 for <code>content available</code> notifications.</p>
<h3 id="iOS-14-with-ephemeral-authorization-status-and-AppClip"><a href="#iOS-14-with-ephemeral-authorization-status-and-AppClip" class="headerlink" title="iOS 14 with ephemeral authorization status and AppClip"></a>iOS 14 with ephemeral authorization status and AppClip</h3><p>From <a href="https://developer.apple.com/documentation/app_clips/enabling_notifications_in_app_clips">Enable your App Clip to schedule and receive notifications for a short or extended time period.</a></p>
<blockquote>
<p>Some App Clips may need to schedule or receive notifications to provide value. Consider an App Clip that allows users to order food for delivery: By sending notifications, the App Clip informs the user about an upcoming delivery. If notifications are important for your App Clip’s functionality, enable it to schedule or receive notifications for up to 8 hours after each launch.</p>
</blockquote>
<h3 id="Remote-notification-only-with-content-available"><a href="#Remote-notification-only-with-content-available" class="headerlink" title="Remote notification only with content-available"></a>Remote notification only with content-available</h3><p>Besides user interface notification, there is <code>content-available</code> notification that delivers notifications that wake your app and update it in the background. If your app’s server-based content changes infrequently or at irregular intervals, you can use background notifications to notify your app when new content becomes available. Read <a href="https://developer.apple.com/documentation/usernotifications/setting_up_a_remote_notification_server/pushing_background_updates_to_your_app">Pushing Background Updates to Your App</a></p>
<h2 id="Testing-push-notification-in-simulator"><a href="#Testing-push-notification-in-simulator" class="headerlink" title="Testing push notification in simulator"></a>Testing push notification in simulator</h2><p>We have been able to drag images to the Photos app in simulator for years, but new in Xcode 11.4 is the ability to drag push payload to simulator to simulate remote push notification.</p>
<p>All we have to do is create an <code>apns</code> file with <code>Simulator Target Bundle</code> key to specify our app, then drag to the simulator</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"Simulator Target Bundle"</span>: <span class="string">"com.onmyway133.PushHero"</span>,</span><br><span class="line">    <span class="attr">"aps"</span>: &#123;</span><br><span class="line">        <span class="attr">"alert"</span>: <span class="string">"Welcome to Push Hero"</span>,</span><br><span class="line">        <span class="attr">"sound"</span>: <span class="string">"chime"</span>,</span><br><span class="line">        <span class="attr">"badge"</span>: <span class="number">2</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Many of the simulator features can be controlled via <code>xcrun simctl</code> command line tool where you can change status bar time, battery info, start and stop certain simulators and send push with <code>xcrun simctl push</code>. This is very handy in case you want to automate things.</p>
<h2 id="Test-push-notification-easily-with-Push-Hero"><a href="#Test-push-notification-easily-with-Push-Hero" class="headerlink" title="Test push notification easily with Push Hero"></a>Test push notification easily with Push Hero</h2><p>As iOS developers who need to test push notification a lot, I face this challenge. That’s why I made <a href="https://onmyway133.com/pushhero/">Push Hero</a> as a native macOS application that allows us to reliably test push notification. It is written in pure Swift with all the new APNs specification in mind.</p>
<img width="1364" alt="Screenshot 2020-10-08 at 06 17 12" src="https://user-images.githubusercontent.com/2284279/95670862-ec255d80-0b90-11eb-9a8d-694167f69d8d.png">

<p>With Push Hero, we can setup multiple test scenario for different app. Each we can specify the authentication method we want, either with p8 token or p12 certificate based. There’s also input validation and hint helper that explains which field is needed and in which format, so you save time to work on your push testing instead.</p>
<p>New in latest version of Push Hero is the ability to send multiple pushes to multiple device tokens, which is the most frequent request. In the right history pane, there’s information about each request and response content, together with apns id information.</p>
<p>Also in Push Hero is the popup to show explanation for each field, and you need to consult <a href="https://developer.apple.com/documentation/usernotifications/setting_up_a_remote_notification_server/sending_notification_requests_to_apns/">Sending Notification Requests to APNs</a> documentation as there are some specifications there. For example with VoIP push, the <code>apns-topic</code> header field must use your app’s bundle ID with <code>.voip</code> appended to the end. If you’re using certificate-based authentication, you must also register the certificate for VoIP services</p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>Push notification continues to be important for iOS apps, and Apple has over the years improved and changed it for the better. This also means lots of knowledge to keep up with. Understanding provider APNs, setting up certificate and JSON Web Token key can be intimidating and take time.</p>
<p>Hopefully the above summary gets you more understanding into push notification, not only the history of changes in both client and provider API, but also some ways to test it easily.</p>
<hr>
<p><strong>Updated at</strong> 2021-01-01 23:26:17</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-06-12T20:12:46.000Z" title="2019-06-12T20:12:46.000Z">2019-06-12</time><span class="level-item">12 minutes read (About 1763 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/Favorite-WWDC-2019-sessions/">Favorite WWDC 2019 sessions</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/305">#305</a></strong></p>
<p><img src="https://user-images.githubusercontent.com/2284279/59388887-40d28180-8d6d-11e9-9a02-582ce19d6f81.jpeg" alt="w1"></p>
<p>This year I’m lucky enough to get the ticket to WWDC and I couldn’t be more satisfied. 5 conference days full of awesomeness, talks, labs and networking, all make WWDC special and memorial conference for every attendee.</p>
<p>As predicted by many, Marzipan (now officially called Project Catalyst) a technology that could allow iOS apps to be ported to macOS, would be the main topic for this year. But WWDC went more spectacular than that, with dark mode on iOS, independent watchOS apps, and SwiftUI being the star of the show. With over 150 sessions and extra videos, it can be a bit overwhelming to catch up, so I sum up 10 essential sessions to get started. It’s good to catch up with the latest technology, but be aware that frameworks and APIs come and get deprecated very often. It’s better to understand why they are introduced, how to learn the skills and mindset so we can apply them in our apps to delight user experience.</p>
<p>Firstly, a little tip to get the most of WWDC videos. Although you can watch on <a href="https://developer.apple.com/videos/wwdc2019">Apple developer website</a>, there’s <a href="https://wwdc.io/">WWDC for macOS app</a> that allows much more comfortable watching experience. There we can tweak playing speed, picture in picture view mode, favorite and download videos for offline watching. </p>
<p>Secondly, for those of you who want to search some texts in the talks, there is <a href="https://asciiwwdc.com/">ASCIIwwdc</a> that provides full transcripts of all the talks.</p>
<h2 id="1-Platform-State-of-the-Union"><a href="#1-Platform-State-of-the-Union" class="headerlink" title="1. Platform State of the Union"></a>1. <a href="https://developer.apple.com/videos/play/wwdc2019/103/">Platform State of the Union</a></h2><p>If you only have time for 1 video, this is it. Right after the <a href="https://developer.apple.com/videos/play/wwdc2019/101/">Keynote</a>, Platform State of the Union is like keynote for developers as it highlights important development changes.</p>
<ul>
<li>macOS 10.15, iOS 13, watchOS 6 and tvOS 13: As usual we get version bumps on all major platforms, which brings lots of new features and enhancement. macOS 10.15 is caleld Catalina and there’s a whole new platform for iPad called iPadOS.</li>
<li>Security and Privacy: Adding to security enhancement from last year, this year shows how Apple really commits into this. There are one-time location permission, signing with Apple, security protocol for HomeKit, new crypto framework which marks MD5 as insecure. Also, apps that target kids can’t display ad or include analytics.</li>
<li>tvOS 13 gets multiple user support</li>
<li>watchOS 6 makes way for independent watch apps, which does not require accompanying iOS apps. There’s also dedicated watch appstore.</li>
<li>iOS 13 now can live in the dark, but dropping support for iPhone 5S, 6 and below. Also, there is ability to toggle language setting per app only.</li>
<li>iPadOS is a spinoff version of iOS for now, they look the same but they are expected to take different paths. It includes mouse support and requires iPad Air 2 and newer devices.</li>
<li>macOS 10.15 introduces a replacement of bash with zsh. It also supports SideCar which allows iPad as an external display. Last but not least, there is Project Catalyst that enables iPad apps to run on the mac.</li>
<li>Xcode 11 includes Swift 5.1 that can target latest SDKs. It brings a new look and feel with tons of features like minimap, Xcode preview, official support for Swift Package Manager, source control enhancement and test plan.</li>
</ul>
<h2 id="2-What’s-New-in-Swift"><a href="#2-What’s-New-in-Swift" class="headerlink" title="2. What’s New in Swift"></a>2. <a href="https://developer.apple.com/videos/play/wwdc2019/402/">What’s New in Swift</a></h2><p>Although <a href="https://github.com/apple/swift">Swift is developed in the open</a>, it’s easy to lose track of in tons of proposals and changes. Swift 5.1 brings lots of cool features that power SwiftUI and Combine, so it’s a prerequisite. </p>
<ul>
<li>Module stability: This looks unimportant but this may be the most key feature of Swift 5.1. Unlike ABI stability we get in Swift 5, module stability helps resolves differences at compile time. In other words, this ensures a Swift 5 library will work with the future Swift compilers.</li>
</ul>
<img width="682" alt="a1" src="https://user-images.githubusercontent.com/2284279/59390812-a8d79680-8d72-11e9-8503-1266788e9177.png">

<ul>
<li>A single expression can be declared without return keyword</li>
<li>Function builder, with marker <code>@_functionBuilder</code> which works pretty much like function with receiver in Kotlin, allows for some very neat DSL syntax.</li>
<li>Property wrapper, a counterpart of Kotlin delegated property, allows property accessors to be used in a convenient way. Shipped with Swift 5.1, we can use that with <code>@propertyWrapper</code> annotation.</li>
<li>Opaque return type with <code>some</code> keyword remedies limitation of Swift protocol with Self or associcated types requirements.</li>
<li>Among other things, there are other cool features like universal <code>Self</code>, static subscripts, collection diffing and matching against optional.</li>
</ul>
<h2 id="3-Introducing-SwiftUI-Building-Your-First-App"><a href="#3-Introducing-SwiftUI-Building-Your-First-App" class="headerlink" title="3. Introducing SwiftUI: Building Your First App"></a>3. <a href="https://developer.apple.com/videos/play/wwdc2019/204/">Introducing SwiftUI: Building Your First App</a></h2><p>Welcome to the spotlight of WWDC 2019, SwiftUI. It may be the most exciting announcement since Swift was introduced in 2014. SwiftUI is not just a new framework, it’s a complete paradigm shift from imperative programming with UIKit/AppKit to a declarative world. I was amazed by how quickly React and Flutter allows fast prototyping and developing, so I’m very happy Apple finally makes this available natively on all platforms.</p>
<img width="1063" alt="w2" src="https://user-images.githubusercontent.com/2284279/59391590-0a990000-8d75-11e9-90bd-3926f7fbc1b9.png">

<p>The cool thing about SwiftUI is that it is expressive and has consistent syntax across platforms. So it is a learn once, write anywhere concept. Together with hot reloading of Xcode Preview, this ends the long debate among iOS community about whether to write UI in code or Storyboard, as the source of truth is now the concise code, but users are free to change any UI details via interactive Preview.</p>
<p>Not only SwiftUI handles consistent UI according to Apple design guideline, it also provides many features for free like accessibility, dark mode and other bookkeeping.</p>
<p>SwiftUI supports latest platform versions and no backward compatibility, so some of us have to wait 1 or 2 more years until iOS 13 is widely adopted. To learn more about SwiftUI, there are other advanced sesions like </p>
<ul>
<li><a href="https://developer.apple.com/videos/play/wwdc2019/216/">SwiftUI Essentials</a></li>
<li><a href="https://developer.apple.com/videos/play/wwdc2019/237/">Building Custom Views with SwiftUI</a></li>
<li><a href="https://developer.apple.com/videos/play/wwdc2019/226/">Data Flow Through SwiftUI</a> </li>
<li><a href="https://developer.apple.com/videos/play/wwdc2019/240/">SwiftUI On All Devices</a></li>
<li><a href="https://developer.apple.com/videos/play/wwdc2019/231/">Integrating SwiftUI</a></li>
</ul>
<h2 id="4-Implementing-Dark-Mode-on-iOS"><a href="#4-Implementing-Dark-Mode-on-iOS" class="headerlink" title="4. Implementing Dark Mode on iOS"></a>4. <a href="https://developer.apple.com/videos/play/wwdc2019/214/">Implementing Dark Mode on iOS</a></h2><p>As much as I was excited about Dark theme in Android Q, Dark Mode in iOS is something that eases my eyes. Some apps also support Dark theme by their owns, but with iOS 13, supporting Dark mode to our apps is not a daunting task. There are more vibrancy materials, system colors that adapts automatically to dark and light modes. We can also select images for each mode in Asset Catalog easily.</p>
<img width="1110" alt="w4" src="https://user-images.githubusercontent.com/2284279/59392111-c9a1eb00-8d76-11e9-8083-6ba6e9054410.png">

<h2 id="5-Introducing-Combine-and-Advances-in-Foundation"><a href="#5-Introducing-Combine-and-Advances-in-Foundation" class="headerlink" title="5. Introducing Combine and Advances in Foundation"></a>5. <a href="https://developer.apple.com/videos/play/wwdc2019/711/">Introducing Combine and Advances in Foundation</a></h2><p>Combine is a unified declarative framework for processing values over time. As a huge fan of Rx, Combine looks like home. It was thrilled to see this finnaly get supported official by Apple. This simplifying asyncrhonous programming a lot, also streamline other communication patterns like KVO and notification center.</p>
<img width="1159" alt="w5" src="https://user-images.githubusercontent.com/2284279/59392379-be02f400-8d77-11e9-8daa-923cbb20caa0.png">

<p>Combine is the force the powers reactive nature in SwiftUI with <code>Binding</code> and <code>BindableObject</code>. There’s also lots of improvements to Foundation like collection diffing, new list and relative formatters, and notably Combine syntax for <code>URLSession</code>, which makes networking a breeze.</p>
<p>To learn more about Combine, there’s <a href="https://developer.apple.com/videos/play/wwdc2019/721/">Combine in Practice</a> where we can learn more about error handling, schedule work and many operators on streams.</p>
<img width="1001" alt="w6" src="https://user-images.githubusercontent.com/2284279/59392558-55684700-8d78-11e9-8c52-27e2ecd18d89.png">


<h2 id="6-Modernizing-Your-UI-for-iOS-13"><a href="#6-Modernizing-Your-UI-for-iOS-13" class="headerlink" title="6. Modernizing Your UI for iOS 13"></a>6. <a href="https://developer.apple.com/videos/play/wwdc2019/224/">Modernizing Your UI for iOS 13</a></h2><p>Take a look at this talk to learn about new features in iOS 13 that we should be aware in our apps. Newly in iOS 13, we can take advantage of card style modal presentation that is very cumbersome to replicate ourselves. There’s also new <code>UISearchBarTextField</code> with advanced customizations for token and inputs. Lastly, the new <code>UIMenu</code> makes showing context menu trivial and make way for iPad apps to behave like native on the mac.</p>
<img width="996" alt="w8" src="https://user-images.githubusercontent.com/2284279/59392862-7c734880-8d79-11e9-9281-0c164b0876bb.png">

<h2 id="7-Modern-Swift-API-Design"><a href="#7-Modern-Swift-API-Design" class="headerlink" title="7. Modern Swift API Design"></a>7. <a href="https://developer.apple.com/videos/play/wwdc2019/415/">Modern Swift API Design</a></h2><p>If you’re developing iOS apps, chances are that you have already stumbled upon <a href="https://swift.org/documentation/api-design-guidelines/">API Design Guidelines</a> which contains valuable guides to structuring our Swift code.</p>
<img width="933" alt="w7" src="https://user-images.githubusercontent.com/2284279/59392647-b263fd00-8d78-11e9-9c70-ec3d4686f98c.png">

<p>This highlights my most favorite programming advice “Clarity at the point of use”, because things we declare are written only once, but read many many times, so we should make those concise and clear. There’s also mention of preferring generic over protocol which reminds me of protocol witness technique.</p>
<p>This talk details how Apple engineers themselves design Swift code in their RealityKit and SwiftUI frameworks.</p>
<h2 id="8-Optimizing-App-Launch"><a href="#8-Optimizing-App-Launch" class="headerlink" title="8. Optimizing App Launch"></a>8. <a href="https://developer.apple.com/videos/play/wwdc2019/423/">Optimizing App Launch</a></h2><p>The launch time of your app can be decisive in user experience, it needs to be fast and do just the necessary things. With enhancements via shared and cached frameworks, apps now load faster on iOS 13. But there’s more thing we can do to improve this, thanks to the new App Launch profiler in Xcode 11, together with app launch time measurement in XCTests. The 3 words we can take away from this talk is minimize, prioritize, and optimize work at this critical launch time.</p>
<img width="887" alt="w9" src="https://user-images.githubusercontent.com/2284279/59392966-d96efe80-8d79-11e9-98ab-eecaaf363db2.png">

<h2 id="9-Introducing-iPad-Apps-for-Mac"><a href="#9-Introducing-iPad-Apps-for-Mac" class="headerlink" title="9. Introducing iPad Apps for Mac"></a>9. <a href="https://developer.apple.com/videos/play/wwdc2019/205/">Introducing iPad Apps for Mac</a></h2><p>Starting with iOS 13 with Project Catalyst, there’s a new target environment check called UIKitForMac, which allows iPad apps to target the mac while using the same code base. Most of the UI after porting have the correct look and feel like a native macOS app with many features provided for free like window management. There are, kind of obviously, some frameworks that are designed specifically for phone and tablet experience, can’t be supported in macOS.</p>
<img width="1147" alt="w11" src="https://user-images.githubusercontent.com/2284279/59393110-729e1500-8d7a-11e9-9ed8-f6b91ccd03f1.png">

<p>There are other sesions like <a href="https://developer.apple.com/videos/play/wwdc2019/235/">Taking iPad Apps for Mac to the Next Level</a> where we can learn more about this.</p>
<h2 id="10-Creating-Independent-Watch-Apps"><a href="#10-Creating-Independent-Watch-Apps" class="headerlink" title="10. Creating Independent Watch Apps"></a>10. <a href="https://developer.apple.com/videos/play/wwdc2019/208/">Creating Independent Watch Apps</a></h2><img width="1088" alt="w13" src="https://user-images.githubusercontent.com/2284279/59393274-21daec00-8d7b-11e9-8ddf-0fd809b0570c.png">

<p>watchOS finally gets its own Appstore and the ability to run independent watchOS apps without a companying iOS app. With the introduction of URLSession and streaming APIs for the watch, together with enhancements in push notifications, Apple sign in, debugging, this can’t be a better time to start developing for the watch.</p>
<hr>
<p>It is stunning to see how Apple comes up with so many cool announcements this year while keeping innovation and quality high. There are more sessions to explore, head over to <a href="https://developer.apple.com/videos/wwdc2019">WWDC 2019 developer website</a> to learn more.</p>
<hr>
<p><strong>Updated at</strong> 2021-01-01 23:27:16</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-05-23T16:09:18.000Z" title="2019-05-23T16:09:18.000Z">2019-05-23</time><span class="level-item">21 minutes read (About 3181 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-add-app-icons-and-splash-screens-to-a-React-Native-app-in-staging-and-production/">How to add app icons and splash screens to a React Native app in staging and production</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/268">#268</a></strong></p>
<p>React Native was designed to be “learn once, write anywhere,” and it is usually used to build cross platform apps for iOS and Android. And for each app that we build, there are times we need to reuse the same code, build and tweak it a bit to make it work for different environments. For example, we might need multiple skins, themes, a free and paid version, or more often different staging and production environments.</p>
<p>And the task that we can’t avoid is adding app icons and splash screens to our apps.</p>
<p>In fact, to add a staging and production environment, and to add app icons, requires us to use Xcode and Android Studio, and we do it the same way we do with native iOS or Android projects.</p>
<p>Let’s call our app MyApp and bootstrap it with react-native init MyApp . There will of course, be tons of <a href="https://github.com/thekevinbrown/react-native-schemes-manager">libraries</a> to help us with managing different environments.</p>
<p>In this post, we will do just like we did with native apps, so that we know the basic steps.</p>
<h2 id="Build-configuration-target-build-types-production-flavor-and-build-variant"><a href="#Build-configuration-target-build-types-production-flavor-and-build-variant" class="headerlink" title="Build configuration, target, build types, production flavor, and build variant"></a>Build configuration, target, build types, production flavor, and build variant</h2><p>There are some terminologies we needed to remember. In iOS, debug and releases are called <a href="https://developer.apple.com/library/archive/featuredarticles/XcodeConcepts/Concept-Build_Settings.html">build configurations</a>, and staging and production are called <a href="https://developer.apple.com/library/archive/featuredarticles/XcodeConcepts/Concept-Targets.html">targets</a>.</p>
<blockquote>
<h1 id="A-build-configuration-specifies-a-set-of-build-settings-used-to-build-a-target’s-product-in-a-particular-way-For-example-it-is-common-to-have-separate-build-configurations-for-debug-and-release-builds-of-a-product"><a href="#A-build-configuration-specifies-a-set-of-build-settings-used-to-build-a-target’s-product-in-a-particular-way-For-example-it-is-common-to-have-separate-build-configurations-for-debug-and-release-builds-of-a-product" class="headerlink" title="A build configuration specifies a set of build settings used to build a target’s product in a particular way. For example, it is common to have separate build configurations for debug and release builds of a product."></a>A build configuration specifies a set of build settings used to build a target’s product in a particular way. For example, it is common to have separate build configurations for debug and release builds of a product.</h1><h1 id="A-target-specifies-a-product-to-build-and-contains-the-instructions-for-building-the-product-from-a-set-of-files-in-a-project-or-work-space-A-target-defines-a-single-product-it-organizes-the-inputs-into-the-build-system-—-the-source-files-and-instructions-for-processing-those-source-files-—-required-to-build-that-product-Projects-can-contain-one-or-more-targets-each-of-which-produces-one-product"><a href="#A-target-specifies-a-product-to-build-and-contains-the-instructions-for-building-the-product-from-a-set-of-files-in-a-project-or-work-space-A-target-defines-a-single-product-it-organizes-the-inputs-into-the-build-system-—-the-source-files-and-instructions-for-processing-those-source-files-—-required-to-build-that-product-Projects-can-contain-one-or-more-targets-each-of-which-produces-one-product" class="headerlink" title="A target specifies a product to build and contains the instructions for building the product from a set of files in a project or work-space. A target defines a single product; it organizes the inputs into the build system — the source files and instructions for processing those source files — required to build that product. Projects can contain one or more targets, each of which produces one product"></a>A target specifies a product to build and contains the instructions for building the product from a set of files in a project or work-space. A target defines a single product; it organizes the inputs into the build system — the source files and instructions for processing those source files — required to build that product. Projects can contain one or more targets, each of which produces one product</h1></blockquote>
<p>In Android, debug and releases are called build types, and staging and production are called product flavors. Together they form <a href="https://developer.android.com/studio/build/build-variants">build variants</a>.</p>
<blockquote>
<h1 id="For-example-a-“demo”-product-flavor-can-specify-different-features-and-device-requirements-such-as-custom-source-code-resources-and-minimum-API-levels-while-the-“debug”-build-type-applies-different-build-and-packaging-settings-such-as-debug-options-and-signing-keys-The-resulting-build-variant-is-the-“demoDebug”-version-of-your-app-and-it-includes-a-combination-of-the-configurations-and-resources-included-in-the-“demo”-product-flavor-“debug”-build-type-and-main-source-set"><a href="#For-example-a-“demo”-product-flavor-can-specify-different-features-and-device-requirements-such-as-custom-source-code-resources-and-minimum-API-levels-while-the-“debug”-build-type-applies-different-build-and-packaging-settings-such-as-debug-options-and-signing-keys-The-resulting-build-variant-is-the-“demoDebug”-version-of-your-app-and-it-includes-a-combination-of-the-configurations-and-resources-included-in-the-“demo”-product-flavor-“debug”-build-type-and-main-source-set" class="headerlink" title="For example, a “demo” product flavor can specify different features and device requirements, such as custom source code, resources, and minimum API levels, while the “debug” build type applies different build and packaging settings, such as debug options and signing keys. The resulting build variant is the “demoDebug” version of your app, and it includes a combination of the configurations and resources included in the “demo” product flavor, “debug” build type, and main/ source set."></a>For example, a “demo” <em>product flavor</em> can specify different features and device requirements, such as custom source code, resources, and minimum API levels, while the “debug” <em>build type</em> applies different build and packaging settings, such as debug options and signing keys. The resulting build variant is the “demoDebug” version of your app, and it includes a combination of the configurations and resources included in the “demo” product flavor, “debug” build type, and main/ source set.</h1></blockquote>
<h2 id="Staging-and-production-targets-in-iOS"><a href="#Staging-and-production-targets-in-iOS" class="headerlink" title="Staging and production targets in iOS"></a>Staging and production targets in iOS</h2><p>Open MyApp.xcodeproj inside ios using Xcode. Here is what we get after bootstrapping:</p>
<p><img src="https://cdn-images-1.medium.com/max/2004/1*HMMS0zLAfLU_bvli-IESBg.png" alt=""></p>
<p>React Native creates iOS and tvOS apps, and two test targets. In Xcode, a project can contain many targets, and each target means a unique product with its own build settings — Info.plist and app icons.</p>
<h3 id="Duplicate-target"><a href="#Duplicate-target" class="headerlink" title="Duplicate target"></a>Duplicate target</h3><p>If we don’t need the tvOS app, we can delete the MyApp-tvOS and MyApp-tvOSTests . Let’s use MyApp target as our production environment, and right click -&gt; Duplicate to make another target. Let’s call it MyApp Staging.</p>
<p><img src="https://cdn-images-1.medium.com/max/2694/1*T2RDoSaQRJv8GRGkphUkGw.png" alt=""></p>
<p>Each target must have unique bundle id. Change the bundle id of MyApp to com.onmyway133.MyApp and MyApp Staging to com.onmyway133.MyApp.Staging.</p>
<p><img src="https://cdn-images-1.medium.com/max/3720/1*I3qdG0cgDrwc1bep76ckcA.png" alt=""></p>
<h3 id="Info-plist"><a href="#Info-plist" class="headerlink" title="Info.plist"></a>Info.plist</h3><p>When we duplicate MyApp target , Xcode also duplicates Info.plist into MyApp copy-Info.plist for the staging target. Change it to a more meaningful name Info-Staging.plist and drag it to the MyApp group in Xcode to stay organised. After dragging, MyApp Staging target can’t find the plist, so click Choose Info.plist File and point to the Info-Staging.plist.</p>
<p><img src="https://cdn-images-1.medium.com/max/4732/1*_FYFXy6NDHhSm5XwOPFDmQ.png" alt=""></p>
<h3 id="Scheme"><a href="#Scheme" class="headerlink" title="Scheme"></a>Scheme</h3><p>Xcode also duplicates the scheme when we duplicate the target, so we get MyApp copy:</p>
<p><img src="https://cdn-images-1.medium.com/max/5158/1*DW9wbUJWU1P4gXymv1LT8g.png" alt=""></p>
<p>Click Manage Schemes in the scheme drop-down to open Scheme manager:</p>
<p><img src="https://cdn-images-1.medium.com/max/3208/1*-bjXILHt-Y88etVJDlmyFQ.png" alt=""></p>
<p>I usually delete the generated MyApp copy scheme, then I create a new scheme again for the MyApp Staging target. You need to make sure that the scheme is marked as Shared so that it is tracked into git.</p>
<p><img src="https://cdn-images-1.medium.com/max/3208/1*VTXk1T-j9W-Yd24uU7Wmqg.png" alt=""></p>
<p>For some reason, the staging scheme does not have all the things set up like the production scheme. You can run into issues like ‘React/RCTBundleURLProvider.h’ file not found or <a href="https://github.com/onmyway133/notes/issues/380">RN: ‘React/RCTBridgeModule.h’ file not found</a> . It is because React target is not linked yet.</p>
<p>To solve it, we must disable Parallelise Build and add React target and move it above MyApp Staging.</p>
<p><img src="https://cdn-images-1.medium.com/max/3720/1*F7NF8BBg44H6AZHk_A7Jpg.png" alt=""></p>
<h3 id="Staging-and-production-product-flavors-in-Android"><a href="#Staging-and-production-product-flavors-in-Android" class="headerlink" title="Staging and production product flavors in Android"></a>Staging and production product flavors in Android</h3><p>Open the android folder in Android Studio. By default there are only debug and release build types:</p>
<p><img src="https://cdn-images-1.medium.com/max/3528/1*e362XxJHJpR0tn-ry86brA.png" alt=""></p>
<p>They are configured in the app module build.gradle:</p>
<pre><code>buildTypes {
    release {
        minifyEnabled enableProguardInReleaseBuilds
        proguardFiles getDefaultProguardFile(&quot;proguard-android.txt&quot;), &quot;proguard-rules.pro&quot;
    }
}</code></pre><p>First, let’s change application id to com.onmyway133.MyApp to match iOS. It is not required but I think it’s good to stay organised. Then create two product flavors for staging and production. For staging, let’s add .Staging to the application id.</p>
<p>From Android Studio 3, “all flavors must now belong to a named flavor dimension” — normally we just need default dimensions. Here is how it looks in build.gradle for our app module:</p>
<pre><code>android {
    compileSdkVersion rootProject.ext.compileSdkVersion
    buildToolsVersion rootProject.ext.buildToolsVersion
    flavorDimensions &quot;default&quot;

defaultConfig {
        applicationId &quot;com.onmyway133.MyApp&quot;
        minSdkVersion rootProject.ext.minSdkVersion
        targetSdkVersion rootProject.ext.targetSdkVersion
        versionCode 1
        versionName &quot;1.0&quot;
        ndk {
            abiFilters &quot;armeabi-v7a&quot;, &quot;x86&quot;
        }
    }
    splits {
        abi {
            reset()
            enable enableSeparateBuildPerCPUArchitecture
            universalApk false  // If true, also generate a universal APK
            include &quot;armeabi-v7a&quot;, &quot;x86&quot;
        }
    }
    buildTypes {
        release {
            minifyEnabled enableProguardInReleaseBuilds
            proguardFiles getDefaultProguardFile(&quot;proguard-android.txt&quot;), &quot;proguard-rules.pro&quot;
        }
    }

productFlavors {
        staging {
            applicationIdSuffix &quot;.Staging&quot;
        }

        production {

        }
    }
}</code></pre><p>Click Sync Now to let gradle do the syncing job. After that, we can see that we have four build variants:</p>
<p><img src="https://cdn-images-1.medium.com/max/5478/1*KxKqB-NdxtieuhFF-AUvwA.png" alt=""></p>
<h3 id="How-to-run-staging-and-production"><a href="#How-to-run-staging-and-production" class="headerlink" title="How to run staging and production"></a>How to run staging and production</h3><p>To run the Android app, we can specify a variant like react-native run-android — variant=productionDebug, but I prefer to go to Android Studio, select the variant, and run.</p>
<p>To run iOS app, we can specify the scheme like react-native run-ios — simulator=’iPhone X’ — scheme=”MyApp Staging” . As of react-native 0.57.0 this does not work. But it does not matter as I usually go to Xcode, select the scheme, and run.</p>
<h3 id="Add-app-icon-for-iOS"><a href="#Add-app-icon-for-iOS" class="headerlink" title="Add app icon for iOS"></a>Add app icon for iOS</h3><p>According to the <a href="https://developer.apple.com/design/human-interface-guidelines/ios/icons-and-images/app-icon/">Human Interface Guideline</a>, we need app icons of different sizes for different iOS versions, device resolutions, and situations (notification, settings, Spring Board). I’ve crafted a tool called <a href="https://github.com/onmyway133/IconGenerator">IconGenerator</a>, which was previously mentioned in <a href="https://dev.to/sarthology/best-open-source-tools-for-developers--300f">Best Open Source Tools For Developers</a>. Drag the icon that you want — I prefer those with 1024x1024 pixels for high resolution app icons — to the Icon Generator MacOS app.</p>
<p><img src="https://cdn-images-1.medium.com/max/2848/1*4uBuihDMn3nq3Y1NwVhJsA.png" alt=""></p>
<p>Click Generate and we get AppIcon.appiconset . This contains app icons of the required sizes that are ready to be used in Asset Catalog. Drag this to Asset Catalog in Xcode. That is for production.</p>
<p>For staging, it’s good practice to add a “Staging” banner so that testers know which is staging, and which is production. We can easily do this in Sketch.</p>
<p><img src="https://cdn-images-1.medium.com/max/4536/1*6uxkwnsGkDp0K12LXh_yiw.png" alt=""></p>
<p>Remember to set a background, so we don’t get a transparent background. For an app icon with transparent background, iOS shows the background as black which looks horrible.</p>
<p>After exporting the image, drag the staging icon to the IconGenerator the same way we did earlier. But this time, rename the generated appiconset to AppIcon-Staging.appiconset. Then drag this to Asset Catalog in Xcode.</p>
<p>For the staging target to use staging app icons, open MyApp Staging target and choose AppIcon-Staging as App Icon Source.</p>
<p><img src="https://cdn-images-1.medium.com/max/4908/1*oIGuaxyftwCD0_72Rnv9-g.png" alt=""></p>
<h3 id="Add-app-icon-for-Android"><a href="#Add-app-icon-for-Android" class="headerlink" title="Add app icon for Android"></a>Add app icon for Android</h3><p><img src="https://cdn-images-1.medium.com/max/6720/1*CS_tKOts1zz05PVJ5XEc9A.png" alt=""></p>
<p>I like to switch to Project view, as it is easier to change app icons. Click res -&gt; New -&gt; Image Asset to open Asset Studio. We can use the same app icons that we used in iOS:</p>
<p><img src="https://cdn-images-1.medium.com/max/4528/1*bzJZh1exxXGnrXw_j4AMgQ.png" alt=""></p>
<p>Android 8.0 (API level 26) introduced <a href="https://developer.android.com/guide/practices/ui_guidelines/icon_design_adaptive">Adaptive Icons</a> so we need to tweak the Resize slider to make sure our app icons look as nice as possible.</p>
<blockquote>
<h1 id="Android-8-0-API-level-26-introduces-adaptive-launcher-icons-which-can-display-a-variety-of-shapes-across-different-device-models-For-example-an-adaptive-launcher-icon-can-display-a-circular-shape-on-one-OEM-device-and-display-a-squircle-on-another-device-Each-device-OEM-provides-a-mask-which-the-system-then-uses-to-render-all-adaptive-icons-with-the-same-shape-Adaptive-launcher-icons-are-also-used-in-shortcuts-the-Settings-app-sharing-dialogs-and-the-overview-screen-—-Android-developers"><a href="#Android-8-0-API-level-26-introduces-adaptive-launcher-icons-which-can-display-a-variety-of-shapes-across-different-device-models-For-example-an-adaptive-launcher-icon-can-display-a-circular-shape-on-one-OEM-device-and-display-a-squircle-on-another-device-Each-device-OEM-provides-a-mask-which-the-system-then-uses-to-render-all-adaptive-icons-with-the-same-shape-Adaptive-launcher-icons-are-also-used-in-shortcuts-the-Settings-app-sharing-dialogs-and-the-overview-screen-—-Android-developers" class="headerlink" title="Android 8.0 (API level 26) introduces adaptive launcher icons, which can display a variety of shapes across different device models. For example, an adaptive launcher icon can display a circular shape on one OEM device, and display a squircle on another device. Each device OEM provides a mask, which the system then uses to render all adaptive icons with the same shape. Adaptive launcher icons are also used in shortcuts, the Settings app, sharing dialogs, and the overview screen. — Android developers"></a>Android 8.0 (API level 26) introduces adaptive launcher icons, which can display a variety of shapes across different device models. For example, an adaptive launcher icon can display a circular shape on one OEM device, and display a squircle on another device. Each device OEM provides a mask, which the system then uses to render all adaptive icons with the same shape. Adaptive launcher icons are also used in shortcuts, the Settings app, sharing dialogs, and the overview screen. — <a href="https://developer.android.com/guide/practices/ui_guidelines/icon_design_adaptive">Android developers</a></h1></blockquote>
<p>We are doing for production first, which means the main Res Directory. This step will replace the existing placeholder app icons generated by Android Studio when we bootstrapped React Native projects.</p>
<p><img src="https://cdn-images-1.medium.com/max/4528/1*kIYEWBrWMG_qOkY-LsWnxw.png" alt=""></p>
<p>Now that we have production app icons, let’s make staging app icons. Android manages code and assets via convention. Click on src -&gt; New -&gt; Directory and create a staging folder. Inside staging, create a folder called res . Anything we place in staging will replace the ones in main — this is called source sets.</p>
<p><img src="https://cdn-images-1.medium.com/max/3652/1*dAkYONFc86mHNXKnbPf2fA.png" alt=""></p>
<p>You can read more here: <a href="https://developer.android.com/studio/build/build-variants">Build with source sets</a>.</p>
<blockquote>
<p>You can use source set directories to contain the code and resources you want packaged only with certain configurations. For example, if you are building the “demoDebug” build variant, which is the crossproduct of a “demo” product flavor and “debug” build type, Gradle looks at these directories, and gives them the following priority:<br>src/demoDebug/ <em>(build variant source set)</em><br>src/debug/ <em>(build type source set)</em><br>src/demo/ <em>(product flavor source set)</em><br>src/main/ <em>(main source set)</em></p>
</blockquote>
<p>Right click on staging/res -&gt; New -&gt; Image Asset to make app icons for staging. We also use the same staging app icons like in iOS, but this time we choose staging as Res Directory. This way Android Studio knows how to generate different ic_launcher and put them into staging.</p>
<p><img src="https://cdn-images-1.medium.com/max/4528/1*jKI8Erm57SGwZI2ylLaJ0w.png" alt=""></p>
<h3 id="Add-launch-screen-for-iOS"><a href="#Add-launch-screen-for-iOS" class="headerlink" title="Add launch screen for iOS"></a>Add launch screen for iOS</h3><p>The splash screen is called a [Launch Screen](<a href="http://Launch">http://Launch</a> Screen) in iOS, and it is important.</p>
<blockquote>
<h1 id="A-launch-screen-appears-instantly-when-your-app-starts-up-The-launch-screen-is-quickly-replaced-with-the-first-screen-of-your-app-giving-the-impression-that-your-app-is-fast-and-responsive"><a href="#A-launch-screen-appears-instantly-when-your-app-starts-up-The-launch-screen-is-quickly-replaced-with-the-first-screen-of-your-app-giving-the-impression-that-your-app-is-fast-and-responsive" class="headerlink" title="A launch screen appears instantly when your app starts up. The launch screen is quickly replaced with the first screen of your app, giving the impression that your app is fast and responsive"></a>A launch screen appears instantly when your app starts up. The launch screen is quickly replaced with the first screen of your app, giving the impression that your app is fast and responsive</h1></blockquote>
<p>In the old days, we needed to use static launch images with different sizes for each device and orientation.</p>
<p><img src="https://cdn-images-1.medium.com/max/2912/1*gncLBHGa4ntt1a9NCLL_1g.png" alt=""></p>
<h3 id="Launch-Screen-storyboard"><a href="#Launch-Screen-storyboard" class="headerlink" title="Launch Screen storyboard"></a>Launch Screen storyboard</h3><p>For now the recommended way is to use Launch Screen storyboard . The iOS project from React Native comes with LaunchScreen.xib but xib is a thing of the past. Let’s delete it and create a file called Launch Screen.storyboard .</p>
<p>Right click on MyApp folder -&gt; New and chose Launch Screen, add it to both targets as usually we show the same splash screen for both staging and production.</p>
<p><img src="https://cdn-images-1.medium.com/max/5140/1*kfGNEVm_gJevBIziQ3iXbw.png" alt=""></p>
<p><img src="https://cdn-images-1.medium.com/max/2984/1*v0ZGfvbSFgljeW34PQsw7g.png" alt=""></p>
<h3 id="Image-Set"><a href="#Image-Set" class="headerlink" title="Image Set"></a>Image Set</h3><p>Open asset catalog, right click and select New Image Set . We can name it anything. This will be used in the Launch Screen.storyboard.</p>
<p><img src="https://cdn-images-1.medium.com/max/4496/1*WOAJ9Vr7fSqRSxwBwRb3qg.png" alt=""></p>
<p>Open Launch Screen.storyboard and add an UIImageView . If you are using Xcode 10, click the Library button in the upper right corner and choose Show Objects Library.</p>
<p><img src="https://cdn-images-1.medium.com/max/6720/1*I6hTPAW_L4fUbo8cTakXlg.png" alt=""></p>
<p>Set image for Image View, and make sure Content Mode is set to Aspect Filled, as this ensures that the image always covers the full screen (although it may be cropped). Then connect ImageView using constraints to the View, not the Safe Area. You do this by Control+drag from the Image View (splash) to the View.</p>
<p><img src="https://cdn-images-1.medium.com/max/5700/1*qdEg7IejnxG3Y0Uo1bpiCA.png" alt=""></p>
<h3 id="Constrains-without-margin"><a href="#Constrains-without-margin" class="headerlink" title="Constrains without margin"></a>Constrains without margin</h3><p>Click into each constraint and uncheck Relative to Margin. This makes our ImageView pin to the very edges of the view and with no margin at all.</p>
<p><img src="https://cdn-images-1.medium.com/max/6720/1*5AIBO-ZLXfiLGsk9P32nFw.png" alt=""></p>
<p>Now go to both targets and select Launch Screen.storyboard as Launch Screen File:</p>
<p><img src="https://cdn-images-1.medium.com/max/7168/1*SrrFr1lk7oIwc4QvdoJVxg.png" alt=""></p>
<p>On iOS, the launch screen is often cached, so you probably won’t see the changes. One way to avoid that is to delete the app and run it again.</p>
<h3 id="Add-a-launcher-theme-for-Android"><a href="#Add-a-launcher-theme-for-Android" class="headerlink" title="Add a launcher theme for Android"></a>Add a launcher theme for Android</h3><p>There are <a href="https://android.jlelse.eu/the-complete-android-splash-screen-guide-c7db82bce565">several</a> <a href="https://android.jlelse.eu/right-way-to-create-splash-screen-on-android-e7f1709ba154">ways</a> to add splash screen for Android, from using launcher themes, Splash Activity, and a timer. For me, a reasonable splash screen for Android should be a very minimal image.</p>
<p>As there are many Android devices with different ratios and resolutions, if you want to show a full screen splash image, it will probably not scale correctly for each device. This is just about UX.</p>
<p>For the splash screen, let’s use the launcher theme with splash_background.xml .</p>
<h3 id="Learn-about-Device-Metric"><a href="#Learn-about-Device-Metric" class="headerlink" title="Learn about Device Metric"></a>Learn about Device Metric</h3><p>There is no single splash image that suits all Android devices. A more logical approach is to create multiple splash images for all common resolutions in portrait and landscape. Or we can design a minimal splash image that works. You can find more info here: <a href="https://material.io/tools/devices/">Device Metric</a>.</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*VY5n-nyMet5xlgQyr_fWWw.png" alt=""></p>
<p><img src="https://cdn-images-1.medium.com/max/5940/1*491dzlEkHT3FvIuuLosGKg.png" alt=""></p>
<p>Here is how to add splash screen in 4 easy steps:</p>
<h3 id="Add-splash-image"><a href="#Add-splash-image" class="headerlink" title="Add splash image"></a>Add splash image</h3><p>We usually need a common splash screen for both staging and production. Drag an image into main/res/drawble . Android Studio seems to have a problem with recognising some jpg images for the splash screen, so it’s best to choose png images.</p>
<h3 id="Add-splash-background-xml"><a href="#Add-splash-background-xml" class="headerlink" title="Add splash_background.xml"></a>Add splash_background.xml</h3><p>Right click on drawable -&gt; New -&gt; Drawable resource file . Name it whatever you want — I choose splash_background.xml . Choose the root element as layer-list:</p>
<p><img src="https://cdn-images-1.medium.com/max/4170/1*rEa10WkfXx9VCBX_0sQK3A.png" alt=""></p>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*FwCOuThRAGCZSWvdhVrfCw.png" alt=""></p>
<p>A [Layer List](<a href="http://Layer">http://Layer</a> List) means “a Drawable that manages an array of other Drawables. These are drawn in array order, so the element with the largest index is drawn on top”. Here is how splash_background.xml looks like:</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;

&lt;!-- The android:opacity=”opaque” line — this is critical in preventing a flash of black as your theme transitions. --&gt;
&lt;layer-list xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    android:opacity=&quot;opaque&quot;&gt;

    &lt;!-- The background color, preferably the same as your normal theme --&gt;
    &lt;item android:drawable=&quot;@android:color/white&quot;/&gt;

    &lt;!-- Your splash image --&gt;
    &lt;item&gt;
        &lt;bitmap
            android:src=&quot;@drawable/iron_man&quot;
            android:gravity=&quot;center&quot;/&gt;

    &lt;/item&gt;

&lt;/layer-list&gt;</code></pre><p>Note that we point to our splash image we added earlier with android:src=”@drawable/iron_man”.</p>
<h3 id="Declare-style"><a href="#Declare-style" class="headerlink" title="Declare style"></a>Declare style</h3><p>Open styles.xml and add SplashTheme:</p>
<pre><code>&lt;style name=&quot;SplashTheme&quot; parent=&quot;Theme.AppCompat.NoActionBar&quot;&gt;
    &lt;item name=&quot;android:windowBackground&quot;&gt;@drawable/splash_background&lt;/item&gt;
&lt;/style&gt;</code></pre><h3 id="Use-SplashTheme"><a href="#Use-SplashTheme" class="headerlink" title="Use SplashTheme"></a>Use SplashTheme</h3><p>Go to Manifest.xml and change the theme of the the launcher activity, which has category android:name=”android.intent.category.LAUNCHER” . Change it to android:theme=”@style/SplashTheme” . For React Native, the launcher activity is usually MainActivity . Here is how Manifest.xml looks:</p>
<pre><code>&lt;manifest xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    package=&quot;com.myapp&quot;&gt;

    &lt;uses-permission android:name=&quot;android.permission.INTERNET&quot; /&gt;
    &lt;uses-permission android:name=&quot;android.permission.SYSTEM_ALERT_WINDOW&quot;/&gt;

    &lt;application
      android:name=&quot;.MainApplication&quot;
      android:label=&quot;@string/app_name&quot;
      android:icon=&quot;@mipmap/ic_launcher&quot;
      android:allowBackup=&quot;false&quot;
      android:theme=&quot;@style/AppTheme&quot;&gt;
      &lt;activity
        android:name=&quot;.MainActivity&quot;
        android:label=&quot;@string/app_name&quot;
        android:configChanges=&quot;keyboard|keyboardHidden|orientation|screenSize&quot;
        android:theme=&quot;@style/SplashTheme&quot;
        android:windowSoftInputMode=&quot;adjustResize&quot;&gt;
        &lt;intent-filter&gt;
            &lt;action android:name=&quot;android.intent.action.MAIN&quot; /&gt;
            &lt;category android:name=&quot;android.intent.category.LAUNCHER&quot; /&gt;
        &lt;/intent-filter&gt;
      &lt;/activity&gt;
      &lt;activity android:name=&quot;com.facebook.react.devsupport.DevSettingsActivity&quot; /&gt;
    &lt;/application&gt;

&lt;/manifest&gt;</code></pre><p>Run the app now and you should see the splash screen showing when the app starts.</p>
<h2 id="Managing-environment-configurations"><a href="#Managing-environment-configurations" class="headerlink" title="Managing environment configurations"></a>Managing environment configurations</h2><p>The differences between staging and production are just about app names, application ids, and app icons. We probably use different API keys, and backend URL for staging and production.</p>
<p>Right now the most popular library to handle these scenarios is <a href="https://github.com/luggit/react-native-config">react-native-config</a>, which is said to “bring some 12 factor love to your mobile apps”. It requires lots of steps to get started, and I hope there is a less verbose solution.</p>
<h3 id="Where-to-go-from-here"><a href="#Where-to-go-from-here" class="headerlink" title="Where to go from here"></a>Where to go from here</h3><p>In this post, we touched Xcode and Android Studio more than Visual Studio Code, but this was inevitable. I hope this post was useful to you. Here are some more links to read more about this topic:</p>
<ul>
<li><a href="https://medium.com/@scottianstewart/react-native-add-app-icons-and-launch-screens-onto-ios-and-android-apps-3bfbc20b7d4c">Add App Icons and Launch Screens to React Native Apps (iOS &amp; Android)</a></li>
<li><a href="https://medium.com/handlebar-labs/how-to-add-a-splash-screen-to-a-react-native-app-ios-and-android-30a3cec835ae">How to Add a Splash Screen to a React Native App (iOS and Android)</a></li>
<li><a href="https://medium.com/differential/managing-configuration-in-react-native-cd2dfb5e6f7b">Managing Configuration in React Native</a></li>
<li><a href="https://medium.com/@jacks205/adding-multiple-target-pipelines-for-react-native-apps-and-fastlane-circleci-deployment-pt-1-ae9590ae52f2">Adding multiple target pipelines for React Native Apps (and Fastlane CircleCI deployment) pt. 1</a></li>
<li><a href="https://android.jlelse.eu/the-complete-android-splash-screen-guide-c7db82bce565">The (Complete) Android Splash Screen Guide</a></li>
</ul>
<hr>
<h2 id="I-originally-published-on-Free-Code-Camp-https-medium-freecodecamp-org-how-to-add-app-icons-and-splash-screens-to-a-react-native-app-in-staging-and-production-d1dab615e7c6"><a href="#I-originally-published-on-Free-Code-Camp-https-medium-freecodecamp-org-how-to-add-app-icons-and-splash-screens-to-a-react-native-app-in-staging-and-production-d1dab615e7c6" class="headerlink" title="I originally published on Free Code Camp https://medium.freecodecamp.org/how-to-add-app-icons-and-splash-screens-to-a-react-native-app-in-staging-and-production-d1dab615e7c6"></a>I originally published on Free Code Camp <a href="https://medium.freecodecamp.org/how-to-add-app-icons-and-splash-screens-to-a-react-native-app-in-staging-and-production-d1dab615e7c6">https://medium.freecodecamp.org/how-to-add-app-icons-and-splash-screens-to-a-react-native-app-in-staging-and-production-d1dab615e7c6</a></h2><p><strong>Updated at</strong> 2021-01-13 09:14:18</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-05-23T14:46:25.000Z" title="2019-05-23T14:46:25.000Z">2019-05-23</time><span class="level-item">an hour read (About 6685 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/Learn-iOS-best-practices-by-building-a-simple-recipes-app/">Learn iOS best practices by building a simple recipes app</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/258">#258</a></strong></p>
<p>I started iOS development when iOS 7 had been announced. And I have learned a bit, through working, advice from colleagues and the iOS community.</p>
<p>In this article, I’d like to share a lot of good practices by taking the example of a simple recipes app. The source code is at GitHub <a href="https://github.com/onmyway133/recipes">Recipes</a>.</p>
<p>The app is a traditional master detail application that showcases a list of recipes together with their detailed information.</p>
<p>There are thousands of ways to solve a problem, and the way a problem is tackled also depends on personal taste. Hopefully, throughout this article you’ll learn something useful — I did learn a lot when I did this project.</p>
<p>I’ve added links to some keywords where I felt further reading would be beneficial. So definitely check them out. Any feedback is welcome.</p>
<p>So let’s get started…</p>
<p>Here is a high level overview of what you’ll be building.</p>
<p><img src="https://user-images.githubusercontent.com/2284279/58270863-09cf0880-7d8b-11e9-9619-44db3dad5709.png" alt="1"></p>
<h2 id="Getting-started"><a href="#Getting-started" class="headerlink" title="Getting started"></a>Getting started</h2><p>Let’s decide on the tool and project settings that we use.</p>
<h3 id="Xcode-and-Swift-version"><a href="#Xcode-and-Swift-version" class="headerlink" title="Xcode and Swift version"></a>Xcode and Swift version</h3><p>At <a href="https://developer.apple.com/videos/wwdc2018/">WWDC 2018</a>, Apple introduced Xcode 10 with Swift 4.2. However, at the time of writing, Xcode 10 is still in beta 5. So let’s stick with the stable Xcode 9 and Swift 4.1. Xcode 4.2 has some cool features — you can play with it through this awesome <a href="https://github.com/ole/whats-new-in-swift-4-2">Playground</a>. It does <strong>not</strong> introduce huge changes from Swift 4.1, so we can easily update our app in the near future if required.</p>
<p>You should set the Swift version in the Project setting instead of the target settings. This means all targets in the project share the same Swift version (4.1).</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*Lxby_2mEek2-H50j3hYFEA.png" alt=""></p>
<h3 id="Minimum-iOS-version-to-support"><a href="#Minimum-iOS-version-to-support" class="headerlink" title="Minimum iOS version to support"></a>Minimum iOS version to support</h3><p>As of summer 2018, iOS 12 is in public beta 5 and we can’t target iOS 12 without Xcode 10. In this post, we use Xcode 9 and the base SDK is iOS 11. Depending on the requirement and user bases, some apps need to support old iOS versions. Although iOS users tend to adopt new iOS versions faster than those who use Android, there are a some that stay with old versions. According to Apples advice, we need to support the <strong>two most recent versions</strong>, which are iOS 10 and iOS 11. As <a href="https://developer.apple.com/support/app-store/">measured by the App Store</a> on May 31, 2018, only 5% of users use iOS 9 and prior.</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*yxSupQXoYTO_laZs8uZe8g.png" alt=""></p>
<p>Targeting new iOS versions means we can take advantages of new SDKs, which Apple engineers improve every year. The <a href="https://developer.apple.com/documentation/uikit/views_and_controls?changes=latest_minor">Apple developer website</a> has an improved change log view. Now it is easier to see what has been added or modified.</p>
<p><img src="https://cdn-images-1.medium.com/max/2190/1*bOAc6e_guz5Bf10CT-Av1Q.png" alt=""></p>
<p>Ideally, to determine when to drop support for old iOS versions, we need analytics about how users use our app.</p>
<h3 id="Organising-the-Xcode-project"><a href="#Organising-the-Xcode-project" class="headerlink" title="Organising the Xcode project"></a>Organising the Xcode project</h3><p>When we create the new project, select both “Include Unit Tests” and “Include UI Tests” as it a recommended practice to write tests early. Recent changes to the XCTest framework, especially in UI Tests, make testing a breeze and are pretty stable.</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*QMr3U0naiK_YbuDKJydcrg.png" alt=""></p>
<p>Before adding new files to the project, take a pause and think about the structure of your app. How do we want to organize the files? We have a few options. We can organize files by feature/module or role/types. Each has its pros and cons and I’ll discuss them below.</p>
<p><strong>By role/type:</strong></p>
<ul>
<li><p><strong>Pros</strong>: There is less thinking involved about where to put files. It’s also easier to apply scripts or filters.</p>
</li>
<li><p><strong>Cons</strong>: It’s hard to correlate if we would want to find multiple files related to the same feature. It would also take time to reorganise files if we want to make them into reusable components in the future.</p>
</li>
</ul>
<p><strong>By feature/module</strong></p>
<ul>
<li><p><strong>Pros</strong>: It makes everything modular and encourages composition.</p>
</li>
<li><p><strong>Cons</strong>: It may get messy when many files of different types are bundled together.</p>
</li>
</ul>
<h3 id="Staying-modular"><a href="#Staying-modular" class="headerlink" title="Staying modular"></a><strong>Staying modular</strong></h3><p>Personally, I try to organize my code by features/components as much as possible. This makes it easier to identify related code to fix, and to add new features easier in the future. It answers the question “What does this app do?” instead of “What is this file?” <a href="http://merowing.info/2014/03/subjective-guide-to-writing-ios-apps-part-1-introduction/">Here is a good article regarding this</a>.</p>
<p>A good rule of thumb is to stay consistent, no matter which structure you choose. 👍</p>
<h2 id="Recipes-app-structure"><a href="#Recipes-app-structure" class="headerlink" title="Recipes app structure"></a>Recipes app structure</h2><p>The following is the app structure that our recipe app uses:</p>
<h3 id="Source"><a href="#Source" class="headerlink" title="Source"></a><strong>Source</strong></h3><p>Contains source code files, split into components:</p>
<ul>
<li><p><strong>Features:</strong> the main features in the app</p>
</li>
<li><p><strong>Home:</strong> the home screen, showing a list of recipes and an open search</p>
</li>
<li><p><strong>List:</strong> shows a list of recipes, including reloading a recipe and showing an empty view when a recipe does not exist</p>
</li>
<li><p><strong>Search:</strong> handle search and debouncing</p>
</li>
<li><p><strong>Detail:</strong> shows detail information</p>
</li>
</ul>
<h3 id="Library"><a href="#Library" class="headerlink" title="Library"></a><strong>Library</strong></h3><p>Contains the core components of our application:</p>
<ul>
<li><p><strong>Flow:</strong> contains FlowController to manage flows</p>
</li>
<li><p><strong>Adapter:</strong> generic data source for UICollectionView</p>
</li>
<li><p><strong>Extension:</strong> convenient extensions for common operations</p>
</li>
<li><p><strong>Model:</strong> The model in the app, parsed from JSON</p>
</li>
</ul>
<h3 id="Resource"><a href="#Resource" class="headerlink" title="Resource"></a><strong>Resource</strong></h3><p>Contains plist, resource, and Storyboard files.</p>
<h2 id="Code-conventions"><a href="#Code-conventions" class="headerlink" title="Code conventions"></a>Code conventions</h2><p>I agree with most of the style guides in <a href="https://github.com/raywenderlich/swift-style-guide">raywenderlich/swift-style-guide</a> and <a href="https://github.com/github/swift-style-guide">github/swift-style-guide</a>. These are straightforward and reasonable to use in a Swift project. Also, check out the official <a href="https://swift.org/documentation/api-design-guidelines/">API Design Guidelines</a> made by the Swift team at Apple on how to write better Swift code.</p>
<p>Whichever style guide you choose to follow, <strong>code clarity</strong> must be your most important goal.</p>
<p>Indentation and the tab-space war is a sensitive topic, but again, it depends on taste. I use four spaces indentation in Android projects, and two spaces in iOS and React. In this Recipes app, I follow consistent and easy-to-reason indentation, which I have written about <a href="https://medium.com/fantageek/indenting-swift-code-a55b04cc3a64">here</a> and <a href="https://medium.com/fantageek/using-camelcase-for-abbreviations-232eb67d872">here</a>.</p>
<h3 id="Documentation"><a href="#Documentation" class="headerlink" title="Documentation"></a>Documentation</h3><p>Good code should explain itself clearly so you don’t need to write comments. If a chunk of code is hard to understand, it’s good to take a pause and refactor it to some methods with descriptive names so it’s the chunk of code is more clear to understand. However, I find documenting classes and methods are also good for your coworkers and future self. According to the <a href="https://swift.org/documentation/api-design-guidelines/">Swift API design guidelines</a>,</p>
<p><strong>Write a documentation comment</strong> for every declaration. Insights gained by writing documentation can have a profound impact on your design, so don’t put it off.</p>
<p>It’s very easy to generate comment template /// in Xcode with Cmd+Alt+/ . If you plan to refactor your code to a framework to share with others in the future, tools like <a href="https://github.com/realm/jazzy">jazzy</a> can generate documentation so other people can follow along.</p>
<h3 id="Marking-sections-of-code"><a href="#Marking-sections-of-code" class="headerlink" title="Marking sections of code"></a>Marking sections of code</h3><p>The use of MARK can be helpful to separate sections of code. It also groups functions nicely in the Navigation Bar. You can also use extension groups, related properties and methods.</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*Jyoy2lvz2w5xKo-fIUJTMw.png" alt=""></p>
<p>For a simple UIViewController we can possible define the following MARKs:</p>
<pre><code>// MARK: - Init
// MARK: - View life cycle
// MARK: - Setup
// MARK: - Action
// MARK: - Data</code></pre><h3 id="Source-control"><a href="#Source-control" class="headerlink" title="Source control"></a>Source control</h3><p>Git is a popular source control system right now. We can use the template .gitignore file from <a href="https://www.gitignore.io/api/swift">gitignore.io/api/swift</a>. There are both pros and cons in <a href="https://guides.cocoapods.org/using/using-cocoapods#should-i-check-the-pods-directory-into-source-control">checking in dependencies</a> files (CocoaPods and Carthage). It depends on your project, but I tend to not commit dependencies (node_modules, Carthage, Pods) in source control to not clutter the code base. It also makes reviewing Pull requests easier.</p>
<p>Whether or not you check in the Pods directory, the Podfile and Podfile.lock should <strong>always</strong> be kept under version control.</p>
<p>I use both iTerm2 to execute commands and <a href="https://www.sourcetreeapp.com/">Source Tree</a> to view branches and staging.</p>
<h3 id="Dependencies"><a href="#Dependencies" class="headerlink" title="Dependencies"></a>Dependencies</h3><p>I have used third party frameworks, and also made and contributed to <a href="https://github.com/onmyway133/blog/issues/5">open source</a> a lot. Using a <a href="https://github.com/onmyway133/blog/issues/105">framework</a> gives you a <a href="https://github.com/onmyway133/blog/issues/85">boost</a> at the start, but it can also limit you a lot in the future. There may be some trivial changes that are very hard to work around. The same thing happens when using <a href="https://medium.com/fantageek/dear-sdk-developers-d8e1434fb702">SDKs</a>. My preference is to pick active open source frameworks. Read the source code and check frameworks carefully, and consult with your team if you plan to use them. A bit of extra caution does no harm.</p>
<p>In this app, I try to use as few dependencies as possible. Just enough to demonstrate how to manage dependencies. Some experienced developers may prefer <a href="https://github.com/Carthage/Carthage">Carthage</a>, a dependency manager as it gives you complete control. Here I choose <a href="https://github.com/CocoaPods/CocoaPods">CocoaPods</a> because its easy to use, and it has worked great so far.</p>
<p>There’s a file called .swift-version of value 4.1 in the root of the project to tell CocoaPods that this project uses Swift 4.1. This looks simple but took me quite some time to figure out. ☹️</p>
<h2 id="Getting-into-the-project"><a href="#Getting-into-the-project" class="headerlink" title="Getting into the project"></a>Getting into the project</h2><p>Let’s craft some launch images and icons to give the project a nice look.</p>
<h3 id="API"><a href="#API" class="headerlink" title="API"></a>API</h3><p>The easy way to learn iOS networking is through public free API services. Here I use food2fork. You can register for an account at <a href="http://food2fork.com/about/api">http://food2fork.com/about/api</a>. There are many other awesome APIs in this <a href="https://github.com/toddmotto/public-apis">public-api</a> repository.</p>
<p>It’s good to keep your credentials in a safe place. I use <a href="https://1password.com/">1Password</a> to generate and store my passwords.</p>
<p>Before we start coding, let’s play with the APIs to see which kinds of requests they require and responses they return. I use the <a href="https://github.com/getinsomnia/insomnia">Insomnia</a> tool to test and analyze API responses. It’s open source, free, and works great. 👍</p>
<p><img src="https://cdn-images-1.medium.com/max/3104/1*yAm50k67Ql-XW0LT3NM-2g.png" alt=""></p>
<h3 id="Launch-screen"><a href="#Launch-screen" class="headerlink" title="Launch screen"></a>Launch screen</h3><p>The first impression is important, so is the Launch Screen. The preferred way is using LaunchScreen.storyboard instead of a static Launch image.</p>
<p>To add a launch image to Asset Catalog, open LaunchScreen.storyboard, add UIImageView , and pin it to the edges of UIView. We should not pin the image to the Safe Area as we want the image to be full screen. Also, unselect any margins in the Auto Layout constraints. Set the contentMode of the UIImageView as Aspect Fill so it stretches with the correct aspect ratio.</p>
<p><img src="https://cdn-images-1.medium.com/max/2334/1*9s_8LJhoTgMpeosbuQrAUQ.png" alt="Configure layout in LaunchScreen."><em>Configure layout in LaunchScreen.</em></p>
<h3 id="App-icon"><a href="#App-icon" class="headerlink" title="App icon"></a>App icon</h3><p>A good practice is to provide all the necessary app icons for each device that you support, and also for places like Notification, Settings, and Springboard. Make sure each image has no transparent pixels, otherwise it results in a black background. This tip is from <a href="https://developer.apple.com/ios/human-interface-guidelines/icons-and-images/app-icon/">Human Interface Guidelines - App Icon</a>.</p>
<p><strong>Keep the background simple and avoid transparency</strong>. Make sure your icon is opaque, and don’t clutter the background. Give it a simple background so it doesn’t overpower other app icons nearby. You don’t need to fill the entire icon with content.</p>
<p>We need to design square images with a size greater than 1024 x 1024 so each is able to downscale to smaller images. You can do this by hand, script, or use this small <a href="https://github.com/onmyway133/IconGenerator">IconGenerator</a> app that I made.</p>
<p>The IconGenerator app can generate icons for iOS in iPhone, iPad, macOS and watchOS apps. The result is the AppIcon.appiconset that we can drag right into the Asset Catalog. Asset Catalog is the way to go for modern Xcode projects.</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*GPAQUNsbFs7xu-JmL6fLIw.png" alt=""></p>
<h3 id="Linting-code-with-SwiftLint"><a href="#Linting-code-with-SwiftLint" class="headerlink" title="Linting code with SwiftLint"></a>Linting code with SwiftLint</h3><p>Regardless of what platform we develop on, it’s good to have a linter to enforce consistent conventions. The most popular tool for Swift projects is <a href="https://github.com/realm/SwiftLint">SwiftLint</a>, made by the awesome people at <a href="https://realm.io/">Realm</a>.</p>
<p>To install it, add pod ‘SwiftLint’, ‘~&gt; 0.25’ to the Podfile. It’s also a good practice to specify the <a href="https://guides.cocoapods.org/syntax/podfile.html#pod">version</a> of the dependencies so pod install won’t accidentally update to a major version that could break your app. Then add a .swiftlint.yml with your preferred configuration. A sample configuration can be found <a href="https://github.com/realm/SwiftLint/blob/master/.swiftlint.yml">here</a>.</p>
<p>Finally, add a new Run Script Phrase to execute swiftlint after compiling.</p>
<p><img src="https://cdn-images-1.medium.com/max/2280/1*ySIPs3Y_Y6dgIEhGSuAVjQ.png" alt=""></p>
<h3 id="Type-safe-resource"><a href="#Type-safe-resource" class="headerlink" title="Type-safe resource"></a>Type-safe resource</h3><p>I use <a href="https://github.com/mac-cain13/R.swift">R.swift</a> to safely manage resources. It can generate type-safe classes to access font, localisable strings, and colors. Whenever we change resource file names, we get compile errors instead of a implicit crash. This prevents us inferring with resources that are actively in use.</p>
<pre><code>imageView.image = R.image.notFound()</code></pre><h2 id="Show-me-the-code"><a href="#Show-me-the-code" class="headerlink" title="Show me the code"></a>Show me the code</h2><p>Let’s dive into the code, starting with the model, flow controllers and service classes.</p>
<h3 id="Designing-the-model"><a href="#Designing-the-model" class="headerlink" title="Designing the model"></a>Designing the model</h3><p>It may sound boring but clients are just a prettier way to represent the API response. The model is perhaps the most basic thing and we use it a lot in the app. It plays such an important role but there can be some obvious bugs related to malformed models and assumptions about how a model should be parsed that need to be considered.</p>
<p>We should test for every model of the app. Ideally, we need automated testing of models from API responses in case the model has changed from the backend.</p>
<p>Starting from Swift 4.0, we can conform our model to <a href="https://developer.apple.com/documentation/swift/codable">Codable</a> to easily serialise to and from JSON. Our Model should be immutable:</p>
<pre><code>struct Recipe: Codable {
  let publisher: String
  let url: URL
  let sourceUrl: String
  let id: String
  let title: String
  let imageUrl: String
  let socialRank: Double
  let publisherUrl: URL

enum CodingKeys: String, CodingKey {
    case publisher
    case url = &quot;f2f_url&quot;
    case sourceUrl = &quot;source_url&quot;
    case id = &quot;recipe_id&quot;
    case title
    case imageUrl = &quot;image_url&quot;
    case socialRank = &quot;social_rank&quot;
    case publisherUrl = &quot;publisher_url&quot;
  }
}</code></pre><p>We can use some test frameworks if you like fancy syntax or an RSpec style. Some third party test frameworks may have issues. I find XCTest good enough.</p>
<pre><code>import XCTest
@testable import Recipes

class RecipesTests: XCTestCase {
  func testParsing() throws {
    let json: [String: Any] = [
      &quot;publisher&quot;: &quot;Two Peas and Their Pod&quot;,
      &quot;f2f_url&quot;: &quot;http://food2fork.com/view/975e33&quot;,
      &quot;title&quot;: &quot;No-Bake Chocolate Peanut Butter Pretzel Cookies&quot;,
      &quot;source_url&quot;: &quot;http://www.twopeasandtheirpod.com/no-bake-chocolate-peanut-butter-pretzel-cookies/&quot;,
      &quot;recipe_id&quot;: &quot;975e33&quot;,
      &quot;image_url&quot;: &quot;http://static.food2fork.com/NoBakeChocolatePeanutButterPretzelCookies44147.jpg&quot;,
      &quot;social_rank&quot;: 99.99999999999974,
      &quot;publisher_url&quot;: &quot;http://www.twopeasandtheirpod.com&quot;
    ]

let data = try JSONSerialization.data(withJSONObject: json, options: [])
    let decoder = JSONDecoder()
    let recipe = try decoder.decode(Recipe.self, from: data)

XCTAssertEqual(recipe.title, &quot;No-Bake Chocolate Peanut Butter Pretzel Cookies&quot;)
    XCTAssertEqual(recipe.id, &quot;975e33&quot;)
    XCTAssertEqual(recipe.url, URL(string: &quot;http://food2fork.com/view/975e33&quot;)!)
  }
}</code></pre><h3 id="Better-navigation-with-FlowController"><a href="#Better-navigation-with-FlowController" class="headerlink" title="Better navigation with FlowController"></a>Better navigation with FlowController</h3><p>Before, I used <a href="https://github.com/hyperoslo/Compass">Compass</a> as a <a href="https://medium.com/flawless-app-stories/url-routing-with-compass-d59c0061e7e2">routing engine</a> in my projects, but over time I’ve found that writing simple Routing code works too.</p>
<p>The FlowController is used to manage many UIViewController related components to a common feature. You may want to read <a href="https://github.com/onmyway133/blog/issues/106">FlowController and Coordinator</a> for other use cases and to get a better understanding.</p>
<p>There is the AppFlowController that manages changing rootViewController. For now it starts the RecipeFlowController.</p>
<pre><code>window = UIWindow(frame: UIScreen.main.bounds)
window?.rootViewController = appFlowController
window?.makeKeyAndVisible()
appFlowController.start()</code></pre><p>RecipeFlowController manages (in fact it is) the UINavigationController, that handles pushing HomeViewController, RecipesDetailViewController, SafariViewController.</p>
<pre><code>final class RecipeFlowController: UINavigationController {
  /// Start the flow
  func start() {
    let service = RecipesService(networking: NetworkService())
    let controller = HomeViewController(recipesService: service)
    viewControllers = [controller]
    controller.select = { [weak self] recipe in
      self?.startDetail(recipe: recipe)
    }
  }

private func startDetail(recipe: Recipe) {}
  private func startWeb(url: URL) {}
}</code></pre><p>The UIViewController can use delegate or closure to notify FlowController about changes or next screens in the flow. For delegate there may be a need to check when there are <strong>two</strong> instances of the same class. Here we use closurefor simplicity.</p>
<h3 id="Auto-Layout"><a href="#Auto-Layout" class="headerlink" title="Auto Layout"></a>Auto Layout</h3><p>Auto Layout has been around since iOS 5, it gets better each year. Although some people still have a problem with it, mostly because of confusing breaking constraints and performance, but personally, I find Auto Layout to be good enough.</p>
<p>I try to use Auto Layout as much as possible to make an adaptive UI. We can use libraries like <a href="https://github.com/onmyway133/Anchors">Anchors</a> to do declarative and fast Auto Layout. However in this app, we’ll just use the NSLayoutAnchor since it is from iOS 9. The code below is inspired by <a href="https://github.com/hyperoslo/Sugar/blob/master/Sources/iOS/Constraint.swift">Constrain</a>t. Remember that Auto Layout in its simplest form involves toggling translatesAutoresizingMaskIntoConstraints and activating isActive constraints.</p>
<pre><code>extension NSLayoutConstraint {
  static func activate(_ constraints: [NSLayoutConstraint]) {
    constraints.forEach {
      ($0.firstItem as? UIView)?.translatesAutoresizingMaskIntoConstraints = false
      $0.isActive = true
    }
  }
}</code></pre><p>There are actually many other layout engines available on GitHub. To get a sense over which one would be suitable to use, check out the <a href="https://github.com/layoutBox/LayoutFrameworkBenchmark">LayoutFrameworkBenchmark</a>.</p>
<p><img src="https://cdn-images-1.medium.com/max/2298/1*f8NMEsKqs6n8llxFR8WGuw.png" alt=""></p>
<h3 id="Architecture"><a href="#Architecture" class="headerlink" title="Architecture"></a>Architecture</h3><p>Architecture is probably the most hyped and discussed topic. I’m a fan of exploring architectures, you can view more posts and frameworks about different architectures <a href="https://github.com/onmyway133/fantastic-ios-architecture">here</a>.</p>
<p>To me, all architectures and patterns define roles for each object and how to connect them. Remember these guiding principles for your choice of architecture:</p>
<ul>
<li><p>encapsuate what varies</p>
</li>
<li><p>favor composition over inheritance</p>
</li>
<li><p>program to interface, not to implementation</p>
</li>
</ul>
<p>After playing around with many different architectures, with and without Rx, I found out that simple MVC is good enough. In this simple project, there is just UIViewController with logic encapsulated in helper Service classes,</p>
<h3 id="Massive-View-Controller"><a href="#Massive-View-Controller" class="headerlink" title="Massive View Controller"></a>Massive View Controller</h3><p>You may have heard people joking about how massive UIViewController is, but in reality, there is no massive view controller. It’s just us writing bad code. However there are ways to <a href="http://khanlou.com/2014/09/8-patterns-to-help-you-destroy-massive-view-controller/">slim</a> it down.</p>
<p>In the recipes app I use,</p>
<ul>
<li><p>Service to inject into the view controller to perform a single task</p>
</li>
<li><p>Generic View to move view and controls declaration to the View layer</p>
</li>
<li><p>Child view controller to compose child view controllers to build more features</p>
</li>
</ul>
<p><a href="http://khanlou.com/2014/09/8-patterns-to-help-you-destroy-massive-view-controller/">Here</a> is a very good article with 8 tips to slim down big controllers.</p>
<h3 id="Access-Control"><a href="#Access-Control" class="headerlink" title="Access Control"></a>Access Control</h3><p>The SWIFT <a href="https://developer.apple.com/library/content/documentation/Swift/Conceptual/Swift_Programming_Language/AccessControl.html">documentation</a> mentions that “access control restricts access to parts of your code from code in other source files and modules. This feature enables you to hide the implementation details of your code, and to specify a preferred interface through which that code can be accessed and used.”</p>
<p>Everything should be private and final by default. This also helps the <a href="https://developer.apple.com/swift/blog/?id=27">compiler</a>. When seeing a public property, we need to search for it across the project before doing anything further with it. If the property is used only within a class, making it private means we don’t need to care if it breaks elsewhere.</p>
<p>Declare properties as final where possible.</p>
<pre><code>final class HomeViewController: UIViewController {}</code></pre><p>Declare properties as private or at least private(set).</p>
<pre><code>final class RecipeDetailView: UIView {
  private let scrollableView = ScrollableView()
  private(set) lazy var imageView: UIImageView = self.makeImageView()
}</code></pre><h3 id="Lazy-properties"><a href="#Lazy-properties" class="headerlink" title="Lazy properties"></a>Lazy properties</h3><p>For properties that can be accessed at a later time, we can declare them as lazyand can use closure for fast construction.</p>
<pre><code>final class RecipeCell: UICollectionViewCell {
  private(set) lazy var containerView: UIView = {
    let view = UIView()
    view.clipsToBounds = true
    view.layer.cornerRadius = 5
    view.backgroundColor = Color.main.withAlphaComponent(0.4)

return view
  }()
}</code></pre><p>We can also use make functions if we plan to reuse the same function for multiple properties.</p>
<pre><code>final class RecipeDetailView: UIView {
  private(set) lazy var imageView: UIImageView = self.makeImageView()

private func makeImageView() -&gt; UIImageView {
    let imageView = UIImageView()
    imageView.contentMode = .scaleAspectFill
    imageView.clipsToBounds = true
    return imageView
  }
}</code></pre><p>This also matches advice from <a href="https://swift.org/documentation/api-design-guidelines/">Strive for Fluent Usage</a>.</p>
<p>Begin names of factory methods with “make”, For example, x.makeIterator().</p>
<h3 id="Code-snippets"><a href="#Code-snippets" class="headerlink" title="Code snippets"></a>Code snippets</h3><p>Some code syntax is hard to remember. Consider using code snippets to auto generate code. This is supported by Xcode and is the preferred way by Apple engineers when they demo.</p>
<pre><code>if #available(iOS 11, *) {
  viewController.navigationItem.searchController = searchController
  viewController.navigationItem.hidesSearchBarWhenScrolling = false
} else {
  viewController.navigationItem.titleView = searchController.searchBar
}</code></pre><p>I made a <a href="https://github.com/hyperoslo/SwiftSnippets">repo</a> with some useful Swift snippets that many enjoy using.</p>
<h3 id="Networking"><a href="#Networking" class="headerlink" title="Networking"></a>Networking</h3><p>Networking in Swift is kind of a solved problem. There are tedious and error-prone tasks like parsing HTTP responses, handling request queues, handling parameter queries. I’ve seen bugs about PATCH requests, <a href="https://github.com/onmyway133/blog/issues/115">lowercased HTTP methods</a>, … We can just use <a href="https://github.com/Alamofire/Alamofire">Alamofire</a>. There’s no need to waste time here.</p>
<p>For this app, since it’s simple and to avoid unnecessary dependencies. We can just use URLSession directly. A resource usually contains URL, path, parameters and the HTTP method.</p>
<pre><code>struct Resource {
  let url: URL
  let path: String?
  let httpMethod: String
  let parameters: [String: String]
}</code></pre><p>A simple network service can just parse Resource to URLRequest and tells URLSession to execute</p>
<pre><code>final class NetworkService: Networking {
  @discardableResult func fetch(resource: Resource, completion: @escaping (Data?) -&gt; Void) -&gt; URLSessionTask? {
    guard let request = makeRequest(resource: resource) else {
      completion(nil)
      return nil
    }

let task = session.dataTask(with: request, completionHandler: { data, _, error in
      guard let data = data, error == nil else {
        completion(nil)
        return
      }

completion(data)
    })

task.resume()
    return task
  }
}</code></pre><p>Use dependency injection. Allow caller to specify URLSessionConfiguration. Here we make use of Swift default parameter to provide the most common option.</p>
<pre><code>init(configuration: URLSessionConfiguration = URLSessionConfiguration.default) {
  self.session = URLSession(configuration: configuration)
}</code></pre><p>I also use <a href="https://developer.apple.com/documentation/foundation/urlqueryitem">URLQueryItem</a> which was from iOS 8. It makes parsing parameters to query items nice and less tedious.</p>
<h3 id="How-to-test-Networking-code"><a href="#How-to-test-Networking-code" class="headerlink" title="How to test Networking code"></a>How to test Networking code</h3><p>We can use <a href="https://developer.apple.com/documentation/foundation/urlprotocol">URLProtocol</a> and <a href="https://developer.apple.com/documentation/foundation/urlcache">URLCache</a> to add a stub for network responses or we can use frameworks like <a href="https://github.com/kylef/Mockingjay">Mockingjay</a> which swizzles URLSessionConfiguration.</p>
<p>I myself prefer using the protocol to test. By using the protocol, the test can create a mock request to provide a stub response.</p>
<pre><code>protocol Networking {
  @discardableResult func fetch(resource: Resource, completion: @escaping (Data?) -&gt; Void) -&gt; URLSessionTask?
}

final class MockNetworkService: Networking {
  let data: Data
  init(fileName: String) {
    let bundle = Bundle(for: MockNetworkService.self)
    let url = bundle.url(forResource: fileName, withExtension: &quot;json&quot;)!
    self.data = try! Data(contentsOf: url)
  }

func fetch(resource: Resource, completion: @escaping (Data?) -&gt; Void) -&gt; URLSessionTask? {
    completion(data)
    return nil
  }
}</code></pre><h3 id="Implementing-cache-for-offline-support"><a href="#Implementing-cache-for-offline-support" class="headerlink" title="Implementing cache for offline support"></a>Implementing cache for offline support</h3><p>I used to contribute and use a library called <a href="https://github.com/hyperoslo/Cache">Cache</a> a lot. What we need from a good cache library is memory and disk cache, memory for fast access, disk for persistency. When we save, we save to both memory and disk. When we load, if memory cache fails, we load from disk, then update memory again. There are many advanced topics about cache like purging, expiry, access frequency. Have a read about them <a href="https://medium.com/hyperoslo/open-source-stories-from-cachable-to-generic-storage-in-cache-418d9a230d51">here</a>.</p>
<p>In this simple app, a homegrown cache service class is enough and a good way to learn how caching works. Everything in Swift can be converted to Data, so we can just save Data to cache. Swift 4 Codable can serialize object to Data.</p>
<p>The code below shows us how to use FileManager for disk cache.</p>
<pre><code>/// Save and load data to memory and disk cache
final class CacheService {

/// For get or load data in memory
  private let memory = NSCache&lt;NSString, NSData&gt;()

/// The path url that contain cached files (mp3 files and image files)
  private let diskPath: URL

/// For checking file or directory exists in a specified path
  private let fileManager: FileManager

/// Make sure all operation are executed serially
  private let serialQueue = DispatchQueue(label: &quot;Recipes&quot;)

init(fileManager: FileManager = FileManager.default) {
    self.fileManager = fileManager
    do {
      let documentDirectory = try fileManager.url(
        for: .documentDirectory,
        in: .userDomainMask,
        appropriateFor: nil,
        create: true
      )
      diskPath = documentDirectory.appendingPathComponent(&quot;Recipes&quot;)
      try createDirectoryIfNeeded()
    } catch {
      fatalError()
    }
  }

func save(data: Data, key: String, completion: (() -&gt; Void)? = nil) {
    let key = MD5(key)

serialQueue.async {
      self.memory.setObject(data as NSData, forKey: key as NSString)
      do {
        try data.write(to: self.filePath(key: key))
        completion?()
      } catch {
        print(error)
      }
    }
  }
}</code></pre><p>To avoid malformed and very long file names, we can hash them. I use MD5 from <a href="https://github.com/onmyway133/SwiftHash">SwiftHash</a>, which gives dead simple usage let key = MD5(key).</p>
<h3 id="How-to-test-Cache"><a href="#How-to-test-Cache" class="headerlink" title="How to test Cache"></a>How to test Cache</h3><p>Since I design Cache operations to be asynchronous, we need to use test expectation. Remember to reset the state before each test so the previous test state does not interfere with the current test. The expectation in XCTestCase makes testing asynchronous code easier than ever. 👍</p>
<pre><code>class CacheServiceTests: XCTestCase {
  let service = CacheService()

override func setUp() {
    super.setUp()

try? service.clear()
  }

func testClear() {
    let expectation = self.expectation(description: #function)
    let string = &quot;Hello world&quot;
    let data = string.data(using: .utf8)!

service.save(data: data, key: &quot;key&quot;, completion: {
      try? self.service.clear()
      self.service.load(key: &quot;key&quot;, completion: {
        XCTAssertNil($0)
        expectation.fulfill()
      })
    })

wait(for: [expectation], timeout: 1)
  }
}</code></pre><h3 id="Loading-remote-Images"><a href="#Loading-remote-Images" class="headerlink" title="Loading remote Images"></a>Loading remote Images</h3><p>I also contribute to <a href="https://github.com/hyperoslo/Imaginary">Imaginary</a> so I know a bit about how it works. For remote images, we need to download and cache it, and the cache key is usually the URL of the remote image.</p>
<p>In our recipese app, let’s build a simple ImageService based on our NetworkService and CacheService. Basically an image is just a network resource that we download and cache. We prefer composition so we’ll include NetworkService and CacheService into ImageService.</p>
<pre><code>/// Check local cache and fetch remote image
final class ImageService {

private let networkService: Networking
  private let cacheService: CacheService
  private var task: URLSessionTask?

init(networkService: Networking, cacheService: CacheService) {
    self.networkService = networkService
    self.cacheService = cacheService
  }
}</code></pre><p>We usually have UICollectionViewand UITableView cells with UIImageView. And since cells are reused, we need to cancel any existing request task before making a new request.</p>
<pre><code>func fetch(url: URL, completion: @escaping (UIImage?) -&gt; Void) {
  // Cancel existing task if any
  task?.cancel()

// Try load from cache
  cacheService.load(key: url.absoluteString, completion: { [weak self] cachedData in
    if let data = cachedData, let image = UIImage(data: data) {
      DispatchQueue.main.async {
        completion(image)
      }
    } else {
      // Try to request from network
      let resource = Resource(url: url)
      self?.task = self?.networkService.fetch(resource: resource, completion: { networkData in
        if let data = networkData, let image = UIImage(data: data) {
          // Save to cache
          self?.cacheService.save(data: data, key: url.absoluteString)
          DispatchQueue.main.async {
            completion(image)
          }
        } else {
          print(&quot;Error loading image at \(url)&quot;)
        }
      })

self?.task?.resume()
    }
  })
}</code></pre><h3 id="Making-image-loading-more-convenient-for-UIImageView"><a href="#Making-image-loading-more-convenient-for-UIImageView" class="headerlink" title="Making image loading more convenient for UIImageView"></a>Making image loading more convenient for UIImageView</h3><p>Let’s add an extension to UIImageView to set the remote image from the URL. I use associated object to keep this ImageService and to cancel old requests. We make good use of associated object to attach ImageService to UIImageView. The point is to cancel the current request when the request is triggered again. This is handy when the image views are rendered in a scrolling list.</p>
<pre><code>extension UIImageView {
  func setImage(url: URL, placeholder: UIImage? = nil) {
    if imageService == nil {
      imageService = ImageService(networkService: NetworkService(), cacheService: CacheService())
    }

self.image = placeholder
    self.imageService?.fetch(url: url, completion: { [weak self] image in
      self?.image = image
    })
  }

private var imageService: ImageService? {
    get {
      return objc_getAssociatedObject(self, &amp;AssociateKey.imageService) as? ImageService
    }
    set {
      objc_setAssociatedObject(
        self,
        &amp;AssociateKey.imageService,
        newValue,
        objc_AssociationPolicy.OBJC_ASSOCIATION_RETAIN_NONATOMIC
      )
    }
  }
}</code></pre><h3 id="Generic-DataSource-for-UITableView-and-UICollectionView"><a href="#Generic-DataSource-for-UITableView-and-UICollectionView" class="headerlink" title="Generic DataSource for UITableView and UICollectionView"></a>Generic DataSource for UITableView and UICollectionView</h3><p>We use UITableView and UICollectionView in almost in every app and almost perform the same thing repeatedly.</p>
<ul>
<li><p>show refresh control while loading</p>
</li>
<li><p>reload list in case of data</p>
</li>
<li><p>show error in case of failure.</p>
</li>
</ul>
<p>There are many wrappers around UITableView and UICollection. Each adds another layer of abstraction, which gives us more power but applies restrictions at the same time.</p>
<p>In this app, I use Adapter to get a generic data source, to make a type safe collection. Because, in the end, all we need is to map from the model to the cells.</p>
<p>I also utilize <a href="https://github.com/hyperoslo/Upstream">Upstream</a> based on this idea. It’s hard to wrap around UITableView and UICollectionView, as many times, it is app specific, so a thin wrapper like Adapter is enough.</p>
<pre><code>final class Adapter&lt;T, Cell: UICollectionViewCell&gt;: NSObject,
UICollectionViewDataSource, UICollectionViewDelegateFlowLayout {
  var items: [T] = []
  var configure: ((T, Cell) -&gt; Void)?
  var select: ((T) -&gt; Void)?
  var cellHeight: CGFloat = 60
}</code></pre><h3 id="Controller-and-View"><a href="#Controller-and-View" class="headerlink" title="Controller and View"></a>Controller and View</h3><p>I ditched Storyboard because of many limitations and many issues. Instead, I use code to make views and define constraints. It is not that hard to follow. Most of the boilerplate code in UIViewController is for creating views and configuring the layout. Let’s move those to the view. You can read more about that <a href="https://github.com/onmyway133/blog/issues/37">here</a>.</p>
<pre><code>/// Used to separate between controller and view
class BaseController&lt;T: UIView&gt;: UIViewController {
  let root = T()

override func loadView() {
    view = root
  }
}

final class RecipeDetailViewController: BaseController&lt;RecipeDetailView&gt; {}</code></pre><h3 id="Handling-responsibilities-with-a-child-View-Controller"><a href="#Handling-responsibilities-with-a-child-View-Controller" class="headerlink" title="Handling responsibilities with a child View Controller"></a>Handling responsibilities with a child View Controller</h3><p>The View controller container is a powerful concept. Each view controller has a separation of concern and can be composed together to create advanced features. I have used RecipeListViewController to manage the UICollectionView and show a list of recipes.</p>
<pre><code>final class RecipeListViewController: UIViewController {
  private(set) var collectionView: UICollectionView!
  let adapter = Adapter&lt;Recipe, RecipeCell&gt;()
  private let emptyView = EmptyView(text: &quot;No recipes found!&quot;)
}</code></pre><p>There is the HomeViewController which embeds this RecipeListViewController</p>
<pre><code>/// Show a list of recipes
final class HomeViewController: UIViewController {

/// When a recipe get select
  var select: ((Recipe) -&gt; Void)?

private var refreshControl = UIRefreshControl()
  private let recipesService: RecipesService
  private let searchComponent: SearchComponent
  private let recipeListViewController = RecipeListViewController()
}</code></pre><h3 id="Composition-and-Dependency-Injection"><a href="#Composition-and-Dependency-Injection" class="headerlink" title="Composition and Dependency Injection"></a>Composition and Dependency Injection</h3><p>I try to build components and compose code whenever I can . We see that ImageService makes use of the NetworkService and CacheService, and RecipeDetailViewController makes use of Recipe and RecipesService</p>
<p>Ideally objects should not create dependencies by themselves. The dependencies should be created outside and passed down from <a href="http://blog.ploeh.dk/2011/07/28/CompositionRoot/">root</a>. In our app the root is AppDelegate and AppFlowController so dependencies should start from here.</p>
<h3 id="App-Transport-Security"><a href="#App-Transport-Security" class="headerlink" title="App Transport Security"></a>App Transport Security</h3><p><img src="https://cdn-images-1.medium.com/max/4000/0*tdRZmIGTGEEUmG87.jpg" alt=""></p>
<p>Since iOS 9, all apps should adopt <a href="https://developer.apple.com/library/content/releasenotes/General/WhatsNewIniOS/Articles/iOS9.html">App Transport Security</a></p>
<blockquote>
<p><em>App Transport Security (ATS) enforces best practices in the secure connections between an app and its back end. ATS prevents accidental disclosure, provides secure default behavior, and is easy to adopt; it is also on by default in iOS 9 and OS X v10.11. You should adopt ATS as soon as possible, regardless of whether you’re creating a new app or updating an existing one.</em></p>
</blockquote>
<p>In our app, some images are obtained over an HTTP connection. We need to exclude it from the security rule, but only for that domain only.</p>
<pre><code>&lt;key&gt;NSAppTransportSecurity&lt;/key&gt;
&lt;dict&gt;
  &lt;key&gt;NSExceptionDomains&lt;/key&gt;
  &lt;dict&gt;
    &lt;key&gt;food2fork.com&lt;/key&gt;
    &lt;dict&gt;
      &lt;key&gt;NSIncludesSubdomains&lt;/key&gt;
      &lt;true/&gt;
      &lt;key&gt;NSExceptionAllowsInsecureHTTPLoads&lt;/key&gt;
      &lt;true/&gt;
    &lt;/dict&gt;
  &lt;/dict&gt;
&lt;/dict&gt;</code></pre><h3 id="A-custom-Scrollable-View"><a href="#A-custom-Scrollable-View" class="headerlink" title="A custom Scrollable View"></a>A custom Scrollable View</h3><p>For the detail screen, we can use UITableView and UICollectionView with different cell types. Here, the views should be static. We can stack using UIStackView. For more flexibility, we can just use UIScrollView.</p>
<pre><code>/// Vertically layout view using Auto Layout in UIScrollView
final class ScrollableView: UIView {
  private let scrollView = UIScrollView()
  private let contentView = UIView()

override init(frame: CGRect) {
    super.init(frame: frame)

scrollView.showsHorizontalScrollIndicator = false
    scrollView.alwaysBounceHorizontal = false
    addSubview(scrollView)

scrollView.addSubview(contentView)

NSLayoutConstraint.activate([
      scrollView.topAnchor.constraint(equalTo: topAnchor),
      scrollView.bottomAnchor.constraint(equalTo: bottomAnchor),
      scrollView.leftAnchor.constraint(equalTo: leftAnchor),
      scrollView.rightAnchor.constraint(equalTo: rightAnchor),

contentView.topAnchor.constraint(equalTo: scrollView.topAnchor),
      contentView.bottomAnchor.constraint(equalTo: scrollView.bottomAnchor),
      contentView.leftAnchor.constraint(equalTo: leftAnchor),
      contentView.rightAnchor.constraint(equalTo: rightAnchor)
    ])
  }
}</code></pre><p>We pin the UIScrollView to the edges. We pin the contentView left and right anchor to self, while pinning the contentView top and bottom anchor to UIScrollView.</p>
<p>The views inside contentView have top and bottom constraints, so when they expand, they expand contentView as well. UIScrollView uses Auto Layout info from this contentView to determine its contentSize. Here is how ScrollableView is used in RecipeDetailView.</p>
<pre><code>scrollableView.setup(pairs: [
  ScrollableView.Pair(view: imageView, inset: UIEdgeInsets(top: 8, left: 0, bottom: 0, right: 0)),
  ScrollableView.Pair(view: ingredientHeaderView, inset: UIEdgeInsets(top: 8, left: 0, bottom: 0, right: 0)),
  ScrollableView.Pair(view: ingredientLabel, inset: UIEdgeInsets(top: 4, left: 8, bottom: 0, right: 0)),
  ScrollableView.Pair(view: infoHeaderView, inset: UIEdgeInsets(top: 4, left: 0, bottom: 0, right: 0)),
  ScrollableView.Pair(view: instructionButton, inset: UIEdgeInsets(top: 8, left: 20, bottom: 0, right: 20)),
  ScrollableView.Pair(view: originalButton, inset: UIEdgeInsets(top: 8, left: 20, bottom: 0, right: 20)),
  ScrollableView.Pair(view: infoView, inset: UIEdgeInsets(top: 16, left: 0, bottom: 20, right: 0))
])</code></pre><h3 id="Adding-search-functionality"><a href="#Adding-search-functionality" class="headerlink" title="Adding search functionality"></a>Adding search functionality</h3><p>From iOS 8 onwards, we can use the <a href="https://developer.apple.com/documentation/uikit/uisearchcontroller">UISearchController</a> to get a default search experience with the search bar and results controller. We’ll encapsuate search functionality into SearchComponent so that it can be pluggable.</p>
<pre><code>final class SearchComponent: NSObject, UISearchResultsUpdating, UISearchBarDelegate {
  let recipesService: RecipesService
  let searchController: UISearchController
  let recipeListViewController = RecipeListViewController()
}</code></pre><p>Starting from <a href="https://www.hackingwithswift.com/articles/5/how-to-adopt-ios-11-user-interface-changes-in-your-app">iOS 11</a>, there ‘s a property called searchController on the UINavigationItem which makes it easy to show the search bar on the navigation bar.</p>
<pre><code>func add(to viewController: UIViewController) {
  if #available(iOS 11, *) {
    viewController.navigationItem.searchController = searchController
    viewController.navigationItem.hidesSearchBarWhenScrolling = false
  } else {
    viewController.navigationItem.titleView = searchController.searchBar
  }

viewController.definesPresentationContext = true
}</code></pre><p>In this app, we need to disable hidesNavigationBarDuringPresentation for now, as it is quite buggy. Hopefully it gets resolved in future iOS updates.</p>
<h3 id="Understanding-Presentation-context"><a href="#Understanding-Presentation-context" class="headerlink" title="Understanding Presentation context"></a>Understanding Presentation context</h3><p>Understanding presentation context is crucial for view controller presentation. In search, we use the searchResultsController.</p>
<pre><code>self.searchController = UISearchController(searchResultsController: recipeListViewController)</code></pre><p>We need to use <a href="https://developer.apple.com/documentation/uikit/uiviewcontroller/1621456-definespresentationcontext">definesPresentationContext</a> on the source view controller (the view controller where we add the search bar into). Without this we get the searchResultsController to be presented over full screen !!!</p>
<blockquote>
<p><em>When using the currentContext or overCurrentContext style to present a view controller, this property controls which existing view controller in your view controller hierarchy is actually covered by the new content. When a context-based presentation occurs, UIKit starts at the presenting view controller and walks up the view controller hierarchy. If it finds a view controller whose value for this property is true, it asks that view controller to present the new view controller. If no view controller defines the presentation context, UIKit asks the window’s root view controller to handle the presentation.</em><br><em>The default value for this property is false. Some system-provided view controllers, such as UINavigationController, change the default value to true.</em></p>
</blockquote>
<h3 id="Debouncing-search-actions"><a href="#Debouncing-search-actions" class="headerlink" title="Debouncing search actions"></a>Debouncing search actions</h3><p>We should not execute search requests for every key stroke the user types in the search bar. Therefore some kind of throttling is needed. We can use DispatchWorkItem to encapsulate the action and send it to the queue. Later we can cancel it.</p>
<pre><code>final class Debouncer {
  private let delay: TimeInterval
  private var workItem: DispatchWorkItem?

init(delay: TimeInterval) {
    self.delay = delay
  }

/// Trigger the action after some delay
  func schedule(action: @escaping () -&gt; Void) {
    workItem?.cancel()
    workItem = DispatchWorkItem(block: action)
    DispatchQueue.main.asyncAfter(deadline: .now() + delay, execute: workItem!)
  }
}</code></pre><h3 id="Testing-debouncing-with-Inverted-expectation"><a href="#Testing-debouncing-with-Inverted-expectation" class="headerlink" title="Testing debouncing with Inverted expectation"></a>Testing debouncing with Inverted expectation</h3><p>To test Debouncer we can use XCTest expectation in <a href="https://developer.apple.com/documentation/xctest/xctestexpectation/2806573-isinverted">inverted</a> mode. Read more about it in <a href="https://www.swiftbysundell.com/posts/unit-testing-asynchronous-swift-code">Unit testing asynchronous Swift code</a>.</p>
<blockquote>
<p><em>To check that a situation does not occur during testing, create an expectation that is fulfilled when the unexpected situation occurs, and set its isInverted property to true. Your test will fail immediately if the inverted expectation is fulfilled.</em></p>
</blockquote>
<pre><code>class DebouncerTests: XCTestCase {
  func testDebouncing() {
    let cancelExpectation = self.expectation(description: &quot;cancel&quot;)
    cancelExpectation.isInverted = true

let completeExpectation = self.expectation(description: &quot;complete&quot;)
    let debouncer = Debouncer(delay: 0.3)

debouncer.schedule {
      cancelExpectation.fulfill()
    }

debouncer.schedule {
      completeExpectation.fulfill()
    }

wait(for: [cancelExpectation, completeExpectation], timeout: 1)
  }
}</code></pre><h3 id="Testing-user-interface-with-UITests"><a href="#Testing-user-interface-with-UITests" class="headerlink" title="Testing user interface with UITests"></a>Testing user interface with UITests</h3><p>Sometimes small refactoring can have a large effect. A disabled button can lead to unusable screens afterward. UITest helps ensuring integrity and functional aspects of the app. Test should be declarative. We can use the <a href="https://github.com/hyperoslo/tine-handel-ios/pull/318">Robot pattern</a>.</p>
<pre><code>class RecipesUITests: XCTestCase {
  var app: XCUIApplication!

  override func setUp() {
    super.setUp()
    continueAfterFailure = false

    app = XCUIApplication()
  }

  func testScrolling() {
    app.launch()

    let collectionView = app.collectionViews.element(boundBy: 0)
    collectionView.swipeUp()
    collectionView.swipeUp()
  }

  func testGoToDetail() {
    app.launch()

    let collectionView = app.collectionViews.element(boundBy: 0)
    let firstCell = collectionView.cells.element(boundBy: 0)
    firstCell.tap()
  }
}</code></pre><p>Here are some of my articles regarding testing.</p>
<ul>
<li><p><a href="https://hackernoon.com/running-uitests-with-facebook-login-in-ios-4ac998940c42">Running UITests with Facebook login in iOS</a></p>
</li>
<li><p><a href="https://medium.com/fantageek/testing-in-swift-with-given-when-then-pattern-cd1a4e1737f9">Testing in Swift with Given When Then pattern</a></p>
</li>
</ul>
<h3 id="Main-thread-guard"><a href="#Main-thread-guard" class="headerlink" title="Main thread guard"></a>Main thread guard</h3><p>Accessing the UI from the background queue can lead to potential problems. Earlier, I needed to use <a href="https://github.com/onmyway133/MainThreadGuard">MainThreadGuard</a>, now that Xcode 9 has <a href="https://developer.apple.com/documentation/code_diagnostics/main_thread_checker">Main Thread Checker</a>, I just enabled that in Xcode.</p>
<blockquote>
<p><em>The Main Thread Checker is a standalone tool for Swift and C languages that detects invalid usage of AppKit, UIKit, and other APIs on a background thread. Updating UI on a thread other than the main thread is a common mistake that can result in missed UI updates, visual defects, data corruptions, and crashes.</em></p>
</blockquote>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*DLKXooWl-av-vsT4-qnZtA.png" alt=""></p>
<h3 id="Measuring-performances-and-issues"><a href="#Measuring-performances-and-issues" class="headerlink" title="Measuring performances and issues"></a>Measuring performances and issues</h3><p>We can use <a href="https://developer.apple.com/library/content/documentation/DeveloperTools/Conceptual/InstrumentsUserGuide/index.html">Instruments</a> to thoroughly profile the app. For quick measurement, we can head over to the Debug Navigator tab and see CPU, Memory and Network usage. Check out <a href="https://medium.com/@kazmiekr/what-every-ios-developer-should-be-doing-with-instruments-d1661eeaf64f">this cool article</a> to learn more about instruments.</p>
<h3 id="Prototyping-with-Playground"><a href="#Prototyping-with-Playground" class="headerlink" title="Prototyping with Playground"></a>Prototyping with Playground</h3><p>Playground is the recommended way to prototype and build apps. At WWDC 2018, Apple introduced <a href="https://developer.apple.com/documentation/createml">Create ML</a> which supports Playground to train model. Check out <a href="https://medium.com/flawless-app-stories/playground-driven-development-in-swift-cf167489fe7b">this cool article</a> to learn more about playground driven development in Swift.</p>
<h2 id="Where-to-go-from-here"><a href="#Where-to-go-from-here" class="headerlink" title="Where to go from here"></a>Where to go from here</h2><p>Thanks for making it this far. I hope you’ve learnt something useful. The best way to learn something is to just do it. If you happen to write the same code again and again, make it as a component. If a problem gives you a hard time, write about it. Share your experience with the world, you will learn a lot.</p>
<hr>
<h2 id="Original-post-https-medium-freecodecamp-org-learn-ios-best-practices-by-building-a-simple-recipes-app-9bcbce4d10d"><a href="#Original-post-https-medium-freecodecamp-org-learn-ios-best-practices-by-building-a-simple-recipes-app-9bcbce4d10d" class="headerlink" title="Original post https://medium.freecodecamp.org/learn-ios-best-practices-by-building-a-simple-recipes-app-9bcbce4d10d"></a>Original post <a href="https://medium.freecodecamp.org/learn-ios-best-practices-by-building-a-simple-recipes-app-9bcbce4d10d">https://medium.freecodecamp.org/learn-ios-best-practices-by-building-a-simple-recipes-app-9bcbce4d10d</a></h2><p><strong>Updated at</strong> 2021-01-01 23:26:13</p>
</div></article></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="" src="https://avatars1.githubusercontent.com/u/2284279?s=460&amp;v=4" alt="onmyway133"></figure><p class="title is-size-4 is-block line-height-inherit">onmyway133</p><p class="is-size-6 is-block">iOS, macOS, Android, React. Serial maker. Writer. Speaker.</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Oslo, Norway</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">709</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">54</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/onmyway133" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/onmyway133"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com/onmyway133"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile is-mobile" href="https://onmyway133.com/apps" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Apps</span></span><span class="level-right"><span class="level-item tag">onmyway133.com</span></span></a></li><li><a class="level is-mobile is-mobile" href="https://learntalks.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Learn Talks</span></span><span class="level-right"><span class="level-item tag">learntalks.com</span></span></a></li><li><a class="level is-mobile is-mobile" href="https://wwdctogether.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">WWDC Together</span></span><span class="level-right"><span class="level-item tag">wwdctogether.com</span></span></a></li></ul></div></div></div><!--!--><div class="card widget"><div class="card-content"><h3 class="menu-label">Recent</h3><article class="media"><div class="media-content size-small"><p><time dateTime="2021-01-26T05:33:34.000Z">2021-01-26</time></p><p class="title is-6"><a class="link-muted" href="/blog/How-to-use-Sparkle-for-macOS-app/">How to use Sparkle for macOS app</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2021-01-21T12:31:00.000Z">2021-01-21</time></p><p class="title is-6"><a class="link-muted" href="/blog/How-to-use-ScrollViewReader-in-SwiftUI/">How to use ScrollViewReader in SwiftUI</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2021-01-21T12:03:16.000Z">2021-01-21</time></p><p class="title is-6"><a class="link-muted" href="/blog/How-to-handle-keyDown-in-NSResponder/">How to handle keyDown in NSResponder</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2021-01-21T11:22:33.000Z">2021-01-21</time></p><p class="title is-6"><a class="link-muted" href="/blog/How-to-use-built-in-NSImage-in-macos/">How to use built in NSImage in macos</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2021-01-21T11:12:50.000Z">2021-01-21</time></p><p class="title is-6"><a class="link-muted" href="/blog/How-to-handle-NSSearchToolbarItem-in-macOS-11/">How to handle NSSearchToolbarItem in macOS 11</a></p><p class="is-uppercase"></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/archives/2021/01/"><span class="level-start"><span class="level-item">January 2021</span></span><span class="level-end"><span class="level-item tag">29</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/12/"><span class="level-start"><span class="level-item">December 2020</span></span><span class="level-end"><span class="level-item tag">29</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/11/"><span class="level-start"><span class="level-item">November 2020</span></span><span class="level-end"><span class="level-item tag">15</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/10/"><span class="level-start"><span class="level-item">October 2020</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/09/"><span class="level-start"><span class="level-item">September 2020</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/08/"><span class="level-start"><span class="level-item">August 2020</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/06/"><span class="level-start"><span class="level-item">June 2020</span></span><span class="level-end"><span class="level-item tag">14</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/05/"><span class="level-start"><span class="level-item">May 2020</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/04/"><span class="level-start"><span class="level-item">April 2020</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/03/"><span class="level-start"><span class="level-item">March 2020</span></span><span class="level-end"><span class="level-item tag">21</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/02/"><span class="level-start"><span class="level-item">February 2020</span></span><span class="level-end"><span class="level-item tag">20</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/01/"><span class="level-start"><span class="level-item">January 2020</span></span><span class="level-end"><span class="level-item tag">30</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/12/"><span class="level-start"><span class="level-item">December 2019</span></span><span class="level-end"><span class="level-item tag">36</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/11/"><span class="level-start"><span class="level-item">November 2019</span></span><span class="level-end"><span class="level-item tag">38</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/10/"><span class="level-start"><span class="level-item">October 2019</span></span><span class="level-end"><span class="level-item tag">49</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/09/"><span class="level-start"><span class="level-item">September 2019</span></span><span class="level-end"><span class="level-item tag">50</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/08/"><span class="level-start"><span class="level-item">August 2019</span></span><span class="level-end"><span class="level-item tag">39</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/07/"><span class="level-start"><span class="level-item">July 2019</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/06/"><span class="level-start"><span class="level-item">June 2019</span></span><span class="level-end"><span class="level-item tag">41</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/05/"><span class="level-start"><span class="level-item">May 2019</span></span><span class="level-end"><span class="level-item tag">50</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/04/"><span class="level-start"><span class="level-item">April 2019</span></span><span class="level-end"><span class="level-item tag">27</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/03/"><span class="level-start"><span class="level-item">March 2019</span></span><span class="level-end"><span class="level-item tag">24</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/02/"><span class="level-start"><span class="level-item">February 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/12/"><span class="level-start"><span class="level-item">December 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/05/"><span class="level-start"><span class="level-item">May 2018</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/04/"><span class="level-start"><span class="level-item">April 2018</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/02/"><span class="level-start"><span class="level-item">February 2018</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/01/"><span class="level-start"><span class="level-item">January 2018</span></span><span class="level-end"><span class="level-item tag">14</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/12/"><span class="level-start"><span class="level-item">December 2017</span></span><span class="level-end"><span class="level-item tag">14</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/11/"><span class="level-start"><span class="level-item">November 2017</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/10/"><span class="level-start"><span class="level-item">October 2017</span></span><span class="level-end"><span class="level-item tag">18</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/09/"><span class="level-start"><span class="level-item">September 2017</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/08/"><span class="level-start"><span class="level-item">August 2017</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/07/"><span class="level-start"><span class="level-item">July 2017</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/06/"><span class="level-start"><span class="level-item">June 2017</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/05/"><span class="level-start"><span class="level-item">May 2017</span></span><span class="level-end"><span class="level-item tag">35</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/04/"><span class="level-start"><span class="level-item">April 2017</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/algorithm/"><span class="tag">algorithm</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/android/"><span class="tag">android</span><span class="tag is-grey-lightest">34</span></a></div><div class="control"><a class="tags has-addons" href="/tags/apple-script/"><span class="tag">apple script</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/catalyst/"><span class="tag">catalyst</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ci/"><span class="tag">ci</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cloud/"><span class="tag">cloud</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cocoapods/"><span class="tag">cocoapods</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/combine/"><span class="tag">combine</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/core-data/"><span class="tag">core data</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/csharp/"><span class="tag">csharp</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/css/"><span class="tag">css</span><span class="tag is-grey-lightest">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/dart/"><span class="tag">dart</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/database/"><span class="tag">database</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/design/"><span class="tag">design</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/electron/"><span class="tag">electron</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/featured/"><span class="tag">featured</span><span class="tag is-grey-lightest">8</span></a></div><div class="control"><a class="tags has-addons" href="/tags/firebase/"><span class="tag">firebase</span><span class="tag is-grey-lightest">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/flutter/"><span class="tag">flutter</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/git/"><span class="tag">git</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/github/"><span class="tag">github</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/go/"><span class="tag">go</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/google/"><span class="tag">google</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/iOS/"><span class="tag">iOS</span><span class="tag is-grey-lightest">171</span></a></div><div class="control"><a class="tags has-addons" href="/tags/javascript/"><span class="tag">javascript</span><span class="tag is-grey-lightest">51</span></a></div><div class="control"><a class="tags has-addons" href="/tags/kotlin/"><span class="tag">kotlin</span><span class="tag is-grey-lightest">27</span></a></div><div class="control"><a class="tags has-addons" href="/tags/layout/"><span class="tag">layout</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/life/"><span class="tag">life</span><span class="tag is-grey-lightest">14</span></a></div><div class="control"><a class="tags has-addons" href="/tags/links/"><span class="tag">links</span><span class="tag is-grey-lightest">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/macOS/"><span class="tag">macOS</span><span class="tag is-grey-lightest">130</span></a></div><div class="control"><a class="tags has-addons" href="/tags/machine-learning/"><span class="tag">machine learning</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/maps/"><span class="tag">maps</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/networking/"><span class="tag">networking</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/node/"><span class="tag">node</span><span class="tag is-grey-lightest">13</span></a></div><div class="control"><a class="tags has-addons" href="/tags/objc/"><span class="tag">objc</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/react/"><span class="tag">react</span><span class="tag is-grey-lightest">24</span></a></div><div class="control"><a class="tags has-addons" href="/tags/react-native/"><span class="tag">react native</span><span class="tag is-grey-lightest">14</span></a></div><div class="control"><a class="tags has-addons" href="/tags/realm/"><span class="tag">realm</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/rx/"><span class="tag">rx</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/script/"><span class="tag">script</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/spm/"><span class="tag">spm</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/swift/"><span class="tag">swift</span><span class="tag is-grey-lightest">343</span></a></div><div class="control"><a class="tags has-addons" href="/tags/swiftUI/"><span class="tag">swiftUI</span><span class="tag is-grey-lightest">88</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tech/"><span class="tag">tech</span><span class="tag is-grey-lightest">14</span></a></div><div class="control"><a class="tags has-addons" href="/tags/terminal/"><span class="tag">terminal</span><span class="tag is-grey-lightest">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/testing/"><span class="tag">testing</span><span class="tag is-grey-lightest">17</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tool/"><span class="tag">tool</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tweet/"><span class="tag">tweet</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/unity/"><span class="tag">unity</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/voip/"><span class="tag">voip</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/watchOS/"><span class="tag">watchOS</span><span class="tag is-grey-lightest">11</span></a></div><div class="control"><a class="tags has-addons" href="/tags/web/"><span class="tag">web</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/work/"><span class="tag">work</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/wwdc/"><span class="tag">wwdc</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/xcode/"><span class="tag">xcode</span><span class="tag is-grey-lightest">24</span></a></div></div></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Subscribe to Updates</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=c2r59mmt2n5k0o5dt5vv3nq4u4&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="c2r59mmt2n5k0o5dt5vv3nq4u4" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button is-primary" type="submit" value="Subscribe"></div></div></form></div></div></div><div class="card widget"><div class="card-content"><div class="notification is-danger">You need to set <code>client_id</code> and <code>slot_id</code> to show this AD unit. Please set it in <code>_config.yml</code>.</div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/z.png" alt="onmyway133" height="28"></a><p class="size-small"><span>&copy; 2021 Khoa Pham</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/onmyway133"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            site: {
                url: 'https://onmyway133.github.io',
                external_link: {"enable":true,"exclude":[]}
            },
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to Top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>