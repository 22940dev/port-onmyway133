<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="generator" content="Hexo 4.2.0"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Tag: swift - onmyway133</title><meta description="What you don&amp;#39;t know is what you haven&amp;#39;t learned"><meta property="og:type" content="blog"><meta property="og:title" content="onmyway133"><meta property="og:url" content="https://onmyway133.github.io/"><meta property="og:site_name" content="onmyway133"><meta property="og:description" content="What you don&amp;#39;t know is what you haven&amp;#39;t learned"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://onmyway133.github.io/img/og_image.png"><meta property="article:author" content="Khoa Pham"><meta property="article:tag" content="ios"><meta property="article:tag" content=" android"><meta property="article:tag" content="javascript"><meta property="article:tag" content=" react"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><meta property="twitter:creator" content="@onmyway133"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://onmyway133.github.io"},"headline":"onmyway133","image":["https://onmyway133.github.io/img/og_image.png"],"author":{"@type":"Person","name":"Khoa Pham"},"description":"What you don&#39;t know is what you haven&#39;t learned"}</script><link rel="alternative" href="/atom.xml" title="onmyway133" type="application/atom+xml"><link rel="icon" href="/img/favicon.ico"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=UA-40119591-5" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'UA-40119591-5');</script><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><script data-ad-client="ca-pub-3656459401405265" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" async></script></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/z.png" alt="onmyway133" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/apps">Apps</a><a class="navbar-item" href="/producthunt">Product Hunt</a><a class="navbar-item" href="/gumroad">Gumroad</a><a class="navbar-item" href="/about">About</a><a class="navbar-item" href="/opensource">Open Source</a><a class="navbar-item" href="/writing">Writing</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/speaking">Speaking</a><a class="navbar-item" href="/news">News</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/onmyway133"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/tags">Tags</a></li><li class="is-active"><a href="#" aria-current="page">swift</a></li></ul></nav></div></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-10-02T10:47:06.000Z" title="2019-10-02T10:47:06.000Z">2019-10-02</time><span class="level-item">a minute read (About 135 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-handle-NSTextField-change-in-macOS/">How to handle NSTextField change in macOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/438">#438</a></strong></p>
<h2 id="Storyboard"><a href="#Storyboard" class="headerlink" title="Storyboard"></a>Storyboard</h2><p>In Storyboard, <code>NSTextField</code> has an Action option that specify whether <code>Send on</code>Send on Enter only` should be the default behaviour.</p>
<p><img src="https://user-images.githubusercontent.com/2284279/66045014-217d8100-e523-11e9-8e78-a7f835490245.png" alt="textfield"></p>
<h2 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h2><p>In code, <code>NSTextFieldDelegate</code> notifies whenever text field value changes, and <code>target action</code> notifies when Enter key is pressed</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Cocoa</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">NSViewController</span>, <span class="title">NSTextFieldDelegate</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@IBOutlet</span> <span class="keyword">weak</span> <span class="keyword">var</span> textField: <span class="type">NSTextField!</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        </span><br><span class="line">        textField.delegate = <span class="keyword">self</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">controlTextDidChange</span><span class="params">(<span class="number">_</span> obj: Notification)</span></span> &#123;</span><br><span class="line">        <span class="keyword">let</span> textField = obj.object <span class="keyword">as</span>! <span class="type">NSTextField</span></span><br><span class="line">        <span class="built_in">print</span>(textField.stringValue)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Use-EasyClosure"><a href="#Use-EasyClosure" class="headerlink" title="Use EasyClosure"></a>Use EasyClosure</h2><p>If we use <a href="https://github.com/onmyway133/EasyClosure">EasyClosure</a> then this is easy</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> textField: <span class="type">NSTextField</span> = </span><br><span class="line"></span><br><span class="line">textField.on.action &#123; string <span class="keyword">in</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"User has pressed enter \(string)"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">textField.on.change &#123; string <span class="keyword">in</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Text field value has changed"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-10-02T10:04:41.000Z" title="2019-10-02T10:04:41.000Z">2019-10-02</time><span class="level-item">2 minutes read (About 329 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-add-section-header-to-NSCollectionView-in-macOS/">How to add section header to NSCollectionView in macOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/437">#437</a></strong></p>
<h2 id="Normal"><a href="#Normal" class="headerlink" title="Normal"></a>Normal</h2><p>Use <a href="https://github.com/onmyway133/Omnia">Omnia</a> for <code>itemId</code> extension</p>
<p><code>HeaderCell.swift</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">HeaderCell</span>: <span class="title">NSView</span>, <span class="title">NSCollectionViewSectionHeaderView</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> label: <span class="type">NSTextField</span> = withObject(<span class="type">NSTextField</span>(labelWithString: <span class="string">""</span>)) &#123;</span><br><span class="line">        $<span class="number">0</span>.textColor = <span class="type">R</span>.color.header</span><br><span class="line">        $<span class="number">0</span>.font = <span class="type">R</span>.font.header</span><br><span class="line">        $<span class="number">0</span>.alignment = .<span class="keyword">left</span></span><br><span class="line">        $<span class="number">0</span>.lineBreakMode = .byTruncatingTail</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">init</span>(frame frameRect: <span class="type">NSRect</span>) &#123;</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(frame: frameRect)</span><br><span class="line"></span><br><span class="line">        addSubviews([label])</span><br><span class="line"></span><br><span class="line">        activate(</span><br><span class="line">            label.anchor.centerY,</span><br><span class="line">            label.anchor.<span class="keyword">left</span>.constant(<span class="number">8</span>)</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">init</span>?(coder: <span class="type">NSCoder</span>) &#123;</span><br><span class="line">        <span class="built_in">fatalError</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>ViewController.swift</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">collectionView.register(</span><br><span class="line">    <span class="type">HeaderCell</span>.<span class="keyword">self</span>,</span><br><span class="line">    forSupplementaryViewOfKind: <span class="type">NSCollectionView</span>.elementKindSectionHeader,</span><br><span class="line">    withIdentifier: <span class="type">HeaderCell</span>.itemId</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">collectionView</span><span class="params">(<span class="number">_</span> collectionView: NSCollectionView, viewForSupplementaryElementOfKind kind: NSCollectionView.SupplementaryElementKind, at indexPath: IndexPath)</span></span> -&gt; <span class="type">NSView</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> kind == <span class="type">NSCollectionView</span>.elementKindSectionHeader &#123;</span><br><span class="line">        <span class="keyword">let</span> view = collectionView.makeSupplementaryView(</span><br><span class="line">            ofKind: kind,</span><br><span class="line">            withIdentifier: <span class="type">HeaderCell</span>.itemId,</span><br><span class="line">            <span class="keyword">for</span>: indexPath</span><br><span class="line">        ) <span class="keyword">as</span>! <span class="type">HeaderCell</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> menu = app.menus[indexPath.section]</span><br><span class="line">        view.label.stringValue = menu.name</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> view</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">NSView</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="In-generic-subclass"><a href="#In-generic-subclass" class="headerlink" title="In generic subclass"></a>In generic subclass</h2><p>If use <code>CollectionViewHandler</code> from <a href="https://github.com/onmyway133/Omnia">Omnia</a>, then need to add <code>@objc</code> due to a bug in Swift compiler for subclassing generic class</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@objc</span> (collectionView:viewForSupplementaryElementOfKind:atIndexPath:)</span><br></pre></td></tr></table></figure>

<p><code>MyHandler.swift</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> AppKit</span><br><span class="line"><span class="keyword">import</span> Omnia</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyHandler</span>: <span class="title">CollectionViewHandler</span>&lt;<span class="title">App</span>.<span class="title">Key</span>, <span class="title">KeyCell</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">init</span>() &#123;</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>()</span><br><span class="line"></span><br><span class="line">        layout.headerReferenceSize = <span class="type">NSSize</span>(width: <span class="number">300</span>, height: <span class="number">30</span>)</span><br><span class="line"></span><br><span class="line">        collectionView.register(</span><br><span class="line">            <span class="type">HeaderCell</span>.<span class="keyword">self</span>,</span><br><span class="line">            forSupplementaryViewOfKind: <span class="type">NSCollectionView</span>.elementKindSectionHeader,</span><br><span class="line">            withIdentifier: <span class="type">HeaderCell</span>.itemId</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@objc</span> (collectionView:viewForSupplementaryElementOfKind:atIndexPath:)</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">collectionView</span><span class="params">(<span class="number">_</span> collectionView: NSCollectionView, viewForSupplementaryElementOfKind kind: NSCollectionView.SupplementaryElementKind, at indexPath: IndexPath)</span></span> -&gt; <span class="type">NSView</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> kind == <span class="type">NSCollectionView</span>.elementKindSectionHeader &#123;</span><br><span class="line">            <span class="keyword">let</span> view = collectionView.makeSupplementaryView(</span><br><span class="line">                ofKind: kind,</span><br><span class="line">                withIdentifier: <span class="type">HeaderCell</span>.itemId,</span><br><span class="line">                <span class="keyword">for</span>: indexPath</span><br><span class="line">            ) <span class="keyword">as</span>! <span class="type">HeaderCell</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">let</span> menu = app.menus[indexPath.section]</span><br><span class="line">            view.label.stringValue = menu.name</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> view</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="type">NSView</span>()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Use-Omnia"><a href="#Use-Omnia" class="headerlink" title="Use Omnia"></a>Use Omnia</h2><p>Use <code>CollectionViewSectionHandler</code> from Omnia</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SectionHandler</span>: <span class="title">CollectionViewSectionHandler</span>&lt;<span class="title">App</span>.<span class="title">Key</span>, <span class="title">KeyCell</span>, <span class="title">HeaderCell</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sectionHandler.configureHeader = &#123; section, view <span class="keyword">in</span></span><br><span class="line">    view.label.stringValue = section.name</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sectionHandler.configure = &#123; item, cell <span class="keyword">in</span></span><br><span class="line">    cell.shortcutLabel.stringValue = item.shortcut</span><br><span class="line">    cell.nameLabel.stringValue = item.name</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sectionHandler.itemSize = &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> <span class="keyword">self</span> = <span class="keyword">self</span> <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> .zero</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> width = <span class="keyword">self</span>.sectionHandler.collectionView.frame.size.width</span><br><span class="line">        - <span class="keyword">self</span>.sectionHandler.layout.sectionInset.<span class="keyword">left</span></span><br><span class="line">        - <span class="keyword">self</span>.sectionHandler.layout.sectionInset.<span class="keyword">right</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="type">CGSize</span>(width: width, height: <span class="number">18</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Read-more"><a href="#Read-more" class="headerlink" title="Read more"></a>Read more</h2><ul>
<li><a href="https://www.raywenderlich.com/783-nscollectionview-tutorial#toc-anchor-020">https://www.raywenderlich.com/783-nscollectionview-tutorial#toc-anchor-020</a></li>
<li><a href="https://www.raywenderlich.com/1047-advanced-collection-views-in-os-x-tutorial">https://www.raywenderlich.com/1047-advanced-collection-views-in-os-x-tutorial</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-10-01T08:23:00.000Z" title="2019-10-01T08:23:00.000Z">2019-10-01</time><span class="level-item">a few seconds read (About 104 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-show-context-menu-from-NSButton-in-macOS/">How to show context menu from NSButton in macOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/435">#435</a></strong></p>
<p>Use <code>NSMenu</code> and <code>popUp</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">showQuitMenu</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> menu = <span class="type">NSMenu</span>()</span><br><span class="line">    <span class="keyword">let</span> aboutItem = <span class="type">NSMenuItem</span>(</span><br><span class="line">        title: <span class="string">"About"</span>,</span><br><span class="line">        action: #selector(onAboutTouched(<span class="number">_</span>:)),</span><br><span class="line">        keyEquivalent: <span class="string">""</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> quitItem = <span class="type">NSMenuItem</span>(</span><br><span class="line">        title: <span class="string">"Quit Hacker Pad"</span>,</span><br><span class="line">        action: #selector(onQuitTouched(<span class="number">_</span>:)),</span><br><span class="line">        keyEquivalent: <span class="string">""</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    aboutItem.target = <span class="keyword">self</span></span><br><span class="line">    quitItem.target = <span class="keyword">self</span></span><br><span class="line"></span><br><span class="line">    menu.addItem(aboutItem)</span><br><span class="line">    menu.addItem(quitItem)</span><br><span class="line"></span><br><span class="line">    menu.popUp(</span><br><span class="line">        positioning: aboutItem,</span><br><span class="line">        at: bottomView.quitButton.frame.origin,</span><br><span class="line">        <span class="keyword">in</span>: bottomView</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Use <a href="https://github.com/onmyway133/Omnia">Omnia</a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> menuHandler = <span class="type">MenuHandler</span>()</span><br><span class="line">menuHandler.add(title: <span class="string">"About"</span>, action: &#123;</span><br><span class="line">    <span class="type">NSWorkspace</span>.shared.<span class="keyword">open</span>(<span class="type">URL</span>(string: <span class="string">"https://onmyway133.github.io/"</span>)!)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">menuHandler.add(title: <span class="string">"Quit Hacker Pad"</span>, action: &#123;</span><br><span class="line">    <span class="type">NSApp</span>.terminate(<span class="literal">nil</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">menuHandler.show(from: <span class="keyword">self</span>.bottomView.gearButton, <span class="keyword">in</span>: <span class="keyword">self</span>.bottomView)</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-09-30T18:15:00.000Z" title="2019-09-30T18:15:00.000Z">2019-09-30</time><span class="level-item">a few seconds read (About 39 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-handle-UICollectionView-reloadData-with-selected-index-path/">How to handle UICollectionView reloadData with selected index path</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/434">#434</a></strong></p>
<p>When calling <code>collectionView.reloadData()</code>, selected indexpath stays the same, but be aware that order of data may have changed</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> selectedData = ...</span><br><span class="line"><span class="keyword">let</span> indexPathForSelectedData = ...</span><br><span class="line"></span><br><span class="line">collectionView.scrollToItem(</span><br><span class="line">    at: indexPathForSelectedData,</span><br><span class="line">    at: .centeredHorizontally,</span><br><span class="line">    animated: <span class="literal">false</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-09-30T09:33:15.000Z" title="2019-09-30T09:33:15.000Z">2019-09-30</time><span class="level-item">a few seconds read (About 44 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-make-checked-NSButton-in-AppKit/">How to make checked NSButton in AppKit</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/433">#433</a></strong></p>
<ul>
<li>Use <a href="https://github.com/onmyway133/Omnia">Omnia</a> for convenient <code>style</code> and <code>isOn</code> property</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> checkButton = <span class="type">NSButton</span>(checkboxWithTitle: <span class="string">""</span>, target: <span class="literal">nil</span>, action: <span class="literal">nil</span>)</span><br><span class="line">checkButton.stylePlain(title: <span class="string">"Autosave"</span>, color: <span class="type">R</span>.color.text, font: <span class="type">R</span>.font.text)</span><br><span class="line">checkButton.isOn = <span class="literal">true</span></span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-09-28T19:09:26.000Z" title="2019-09-28T19:09:26.000Z">2019-09-28</time><span class="level-item">a minute read (About 127 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-save-files-in-sandboxed-macOS-app/">How to save files in sandboxed macOS app</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/432">#432</a></strong></p>
<p>Read <a href="https://developer.apple.com/library/archive/documentation/Security/Conceptual/AppSandboxDesignGuide/AppSandboxInDepth/AppSandboxInDepth.html#//apple_ref/doc/uid/TP40011183-CH3-SW4">Container Directories and File System Access</a></p>
<blockquote>
<p>When you adopt App Sandbox, your application has access to the following locations:</p>
</blockquote>
<blockquote>
<p>The app container directory. Upon first launch, the operating system creates a special directory for use by your app—and only by your app—called a container. Each user on a system gets an individual container for your app, within their home directory; your app has unfettered read/write access to the container for the user who ran it.</p>
</blockquote>
<p>Use <a href="https://github.com/onmyway133/EasyStash">EasyStash</a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> options = <span class="type">Options</span>()</span><br><span class="line">options.searchPathDirectory = .documentDirectory</span><br><span class="line">storage = <span class="keyword">try</span>! <span class="type">Storage</span>(options: options)</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-09-26T07:07:11.000Z" title="2019-09-26T07:07:11.000Z">2019-09-26</time><span class="level-item">a few seconds read (About 80 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-use-marked-in-WKWebView-in-AppKit/">How to use marked in WKWebView in AppKit</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/429">#429</a></strong></p>
<p>Use <a href="https://github.com/markedjs/marked">https://github.com/markedjs/marked</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;!doctype html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta charset=<span class="string">"utf-8"</span>/&gt;</span><br><span class="line">  &lt;title&gt;Marked <span class="keyword">in</span> the browser&lt;<span class="regexp">/title&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;div id=<span class="string">"content"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  &lt;script src=<span class="string">"https://cdn.jsdelivr.net/npm/marked/marked.min.js"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">  &lt;script&gt;</span><br><span class="line">    <span class="built_in">document</span>.getElementById(<span class="string">'content'</span>).innerHTML =</span><br><span class="line">      marked(<span class="string">`# Marked in the browser\n\nRendered by **marked**.`</span>);</span><br><span class="line">  &lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>body&gt;</span><br><span class="line">&lt;<span class="regexp">/html&gt;</span></span><br></pre></td></tr></table></figure>

<p>Should use back tick instead of <code>&#39;</code> to deal with multiline string, and escape back tick</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> markdown = markdown.replacingOccurrences(of: <span class="string">"`"</span>, with: <span class="string">"\\`"</span>)</span><br><span class="line">marked(`\(markdown)`);</span><br><span class="line"></span><br><span class="line">webView.loadHTMLString(string, baseURL: <span class="literal">nil</span>)</span><br></pre></td></tr></table></figure>

<p>For WKWebView to load even local content, need to enable <code>Outgoing connections</code>, and maybe <code>Incoming connections</code> in Sandbox</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-09-25T08:26:20.000Z" title="2019-09-25T08:26:20.000Z">2019-09-25</time><span class="level-item">a few seconds read (About 88 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-enable-NSMenuItem-in-AppKit/">How to enable NSMenuItem in AppKit</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/428">#428</a></strong></p>
<p>Need to set target</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> item = <span class="type">NSMenuItem</span>(</span><br><span class="line">    title: title,</span><br><span class="line">    action: #selector(onMenuItemClicked(<span class="number">_</span>:)),</span><br><span class="line">    keyEquivalent: <span class="string">""</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">item.target = <span class="keyword">self</span></span><br></pre></td></tr></table></figure>

<p>Sometimes, need to check <code>autoenablesItems</code></p>
<blockquote>
<p>Indicates whether the menu automatically enables and disables its menu items.</p>
</blockquote>
<blockquote>
<p>This property contains a Boolean value, indicating whether the menu automatically enables and disables its menu items. If set to true, menu items of the menu are automatically enabled and disabled according to rules computed by the NSMenuValidation informal protocol. By default, NSMenu objects autoenable their menu items.</p>
</blockquote>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-09-24T11:49:34.000Z" title="2019-09-24T11:49:34.000Z">2019-09-24</time><span class="level-item">2 minutes read (About 244 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-use-generic-NSCollectionView-in-macOS/">How to use generic NSCollectionView in macOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/427">#427</a></strong></p>
<p>See <a href="https://github.com/onmyway133/Omnia/blob/master/Sources/macOS/CollectionViewHandler.swift">CollectionViewHandler</a></p>
<p>Use <code>ClickedCollectionView</code> to detect clicked index for context menu.<br>Embed <code>NSCollectionView</code> inside <code>NSScrollView</code> to enable scrolling</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> AppKit</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CollectionViewHandler</span>&lt;<span class="title">Item</span>: <span class="title">Equatable</span>, <span class="title">Cell</span>: <span class="title">NSCollectionViewItem</span>&gt;</span></span><br><span class="line"><span class="class">: <span class="title">NSObject</span>, <span class="title">NSCollectionViewDataSource</span>, <span class="title">NSCollectionViewDelegateFlowLayout</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">let</span> layout = <span class="type">NSCollectionViewFlowLayout</span>()</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">let</span> scrollView = <span class="type">NSScrollView</span>()</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">let</span> collectionView = <span class="type">ClickedCollectionView</span>()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> items = [<span class="type">Item</span>]()</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> itemSize: () -&gt; <span class="type">CGSize</span> = &#123; .zero &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> configure: (<span class="type">Item</span>, <span class="type">Cell</span>) -&gt; <span class="type">Void</span> = &#123; <span class="number">_</span>, <span class="number">_</span> <span class="keyword">in</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">init</span>() &#123;</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>()</span><br><span class="line"></span><br><span class="line">        layout.minimumLineSpacing = <span class="number">4</span></span><br><span class="line">        layout.sectionInset = <span class="type">NSEdgeInsets</span>(top: <span class="number">4</span>, <span class="keyword">left</span>: <span class="number">4</span>, bottom: <span class="number">4</span>, <span class="keyword">right</span>: <span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">        collectionView.dataSource = <span class="keyword">self</span></span><br><span class="line">        collectionView.delegate = <span class="keyword">self</span></span><br><span class="line">        collectionView.collectionViewLayout = layout</span><br><span class="line">        collectionView.allowsMultipleSelection = <span class="literal">false</span></span><br><span class="line">        collectionView.backgroundColors = [.clear]</span><br><span class="line">        collectionView.isSelectable = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">        collectionView.register(<span class="type">Cell</span>.<span class="keyword">self</span>, forItemWithIdentifier: <span class="type">Cell</span>.itemId)</span><br><span class="line"></span><br><span class="line">        scrollView.documentView = collectionView</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// MARK: - Items</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(item: Item)</span></span> &#123;</span><br><span class="line">        items.insert(item, at: <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">let</span> indexPath = <span class="type">IndexPath</span>(item: <span class="number">0</span>, section: <span class="number">0</span>)</span><br><span class="line">        collectionView.animator().insertItems(at: <span class="type">Set</span>(arrayLiteral: indexPath))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">remove</span><span class="params">(item: Item)</span></span> &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> index = items.firstIndex(<span class="keyword">where</span>: &#123; $<span class="number">0</span> == item &#125;) <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        remove(index: index)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">remove</span><span class="params">(index: Int)</span></span> &#123;</span><br><span class="line">        items.remove(at: index)</span><br><span class="line">        <span class="keyword">let</span> indexPath = <span class="type">IndexPath</span>(item: index, section: <span class="number">0</span>)</span><br><span class="line">        collectionView.animator().deleteItems(at: <span class="type">Set</span>(arrayLiteral: indexPath))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// MARK: - NSCollectionViewDataSource</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">numberOfSections</span><span class="params">(<span class="keyword">in</span> collectionView: NSCollectionView)</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">collectionView</span><span class="params">(<span class="number">_</span> collectionView: NSCollectionView, numberOfItemsInSection section: Int)</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> items.<span class="built_in">count</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">collectionView</span><span class="params">(<span class="number">_</span> collectionView: NSCollectionView, itemForRepresentedObjectAt indexPath: IndexPath)</span></span> -&gt; <span class="type">NSCollectionViewItem</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> cell = collectionView.makeItem(withIdentifier: <span class="type">Cell</span>.itemId, <span class="keyword">for</span>: indexPath) <span class="keyword">as</span>! <span class="type">Cell</span></span><br><span class="line">        <span class="keyword">let</span> item = items[indexPath.item]</span><br><span class="line">        configure(item, cell)</span><br><span class="line">        <span class="keyword">return</span> cell</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// MARK: - NSCollectionViewDelegateFlowLayout</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">collectionView</span><span class="params">(<span class="number">_</span> collectionView: NSCollectionView, layout collectionViewLayout: NSCollectionViewLayout, sizeForItemAt indexPath: IndexPath)</span></span> -&gt; <span class="type">NSSize</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> itemSize()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-09-19T06:13:56.000Z" title="2019-09-19T06:13:56.000Z">2019-09-19</time><span class="level-item">2 minutes read (About 225 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-use-throttle-and-debounce-in-RxSwift/">How to use throttle and debounce in RxSwift</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/426">#426</a></strong></p>
<h2 id="throttle"><a href="#throttle" class="headerlink" title="throttle"></a>throttle</h2><p><a href="https://rxmarbles.com/#throttle">https://rxmarbles.com/#throttle</a></p>
<img width="846" alt="throttle" src="https://user-images.githubusercontent.com/2284279/65225775-fe37e800-dac5-11e9-8d07-864d80a25ead.png">

<blockquote>
<p>Returns an Observable that emits the first and the latest item emitted by the source Observable during sequential time windows of a specified duration.<br>This operator makes sure that no two elements are emitted in less then dueTime.</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.throttle(.milliseconds(<span class="number">500</span>), scheduler: <span class="type">MainScheduler</span>.instance)</span><br></pre></td></tr></table></figure>

<p>In a time window, only the first item gets emitted. </p>
<p>💡 In other words, in a time window, take first and discard following.</p>
<p>For example, when failure, we show error message but don’t want to show error messages consecutively. We can use throttle to discard consecutive errors.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">viewModel.fetchBooksFail</span><br><span class="line">     .observeOn(<span class="type">MainScheduler</span>.instance)</span><br><span class="line">     .throttle(.seconds(<span class="number">2</span>), scheduler: <span class="type">MainScheduler</span>.instance)</span><br></pre></td></tr></table></figure>

<h2 id="debounce"><a href="#debounce" class="headerlink" title="debounce"></a>debounce</h2><p><a href="https://rxmarbles.com/#debounce">https://rxmarbles.com/#debounce</a></p>
<img width="838" alt="debounce" src="https://user-images.githubusercontent.com/2284279/65225784-0132d880-dac6-11e9-85fe-891a5b316115.png">

<blockquote>
<p>Ignores elements from an observable sequence which are followed by another element within a specified relative time duration, using the specified scheduler to run throttling timers.</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.debounce(.milliseconds(<span class="number">500</span>), scheduler: <span class="type">MainScheduler</span>.instance)</span><br></pre></td></tr></table></figure>

<p>If an element is about to get emitted, wait for a time window to see if there are other elements emitted. If yes, start the waiting again.</p>
<p>💡 In other words, in a time window, wait and take last</p>
<p>For example, when receiving data, we may need to wait for the final data if there are many data events emitted consecutively</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">viewModel.fetchBooks</span><br><span class="line">    .<span class="built_in">filter</span>(&#123; !$<span class="number">0</span>.isEmpty &#125;)</span><br><span class="line">    .debounce(.milliseconds(<span class="number">500</span>), scheduler: <span class="type">MainScheduler</span>.instance)</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-09-19T05:41:24.000Z" title="2019-09-19T05:41:24.000Z">2019-09-19</time><span class="level-item">a few seconds read (About 21 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-use-flatMap-and-compactMap-in-Swift/">How to use flatMap and compactMap in Swift</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/425">#425</a></strong></p>
<p><code>flatMap</code>: map and flatten array of arrays<br><code>compactMap</code>: map and flatten array of optionals</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-09-17T07:44:33.000Z" title="2019-09-17T07:44:33.000Z">2019-09-17</time><span class="level-item">a few seconds read (About 69 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-constrain-to-views-inside-UICollectionViewCell-in-iOS/">How to constrain to views inside UICollectionViewCell in iOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/422">#422</a></strong></p>
<p>To constrain views outside to elements inside <code>UICollectionViewCell</code>, we can use <code>UILayoutGuide</code>.</p>
<p>Need to make layout guide the same constraints as the real elements</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> imageViewGuide = <span class="type">UILayoutGuide</span>()</span><br><span class="line">collectionView.addLayoutGuide(imageViewGuide)</span><br><span class="line"><span class="type">NSLayoutConstraint</span>.on([</span><br><span class="line">    imageViewGuide.topAnchor.constraint(equalTo: collectionView.topAnchor, constant: <span class="number">16</span>),</span><br><span class="line">    imageViewGuide.heightAnchor.constraint(equalTo: collectionView.heightAnchor, multiplier: <span class="number">0.5</span>)</span><br><span class="line">])</span><br></pre></td></tr></table></figure>

<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">NSLayoutConstraint</span>.on([</span><br><span class="line">    loadingIndicator.centerXAnchor.constraint(equalTo: collectionView.centerXAnchor),</span><br><span class="line">    loadingIndicator.centerYAnchor.constraint(equalTo: imageViewGuide.centerYAnchor)</span><br><span class="line">])</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-09-16T09:14:07.000Z" title="2019-09-16T09:14:07.000Z">2019-09-16</time><span class="level-item">a few seconds read (About 92 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-secure-CVC-in-STPPaymentCardTextField-in-Stripe-for-iOS/">How to secure CVC in STPPaymentCardTextField in Stripe for iOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/421">#421</a></strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">maskCvcIfAny</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">guard</span></span><br><span class="line">        <span class="keyword">let</span> view = paymentTextField.subviews.first(<span class="keyword">where</span>: &#123; !($<span class="number">0</span> <span class="keyword">is</span> <span class="type">UIImageView</span>) &#125;),</span><br><span class="line">        <span class="keyword">let</span> cvcField = view.subviews</span><br><span class="line">			.compactMap(&#123; $<span class="number">0</span> <span class="keyword">as</span>? <span class="type">UITextField</span> &#125;)</span><br><span class="line">			.first(<span class="keyword">where</span>: &#123; $<span class="number">0</span>.tag == <span class="number">2</span> &amp;&amp; ($<span class="number">0</span>.accessibilityLabel ?? <span class="string">""</span>).lowercased().<span class="built_in">contains</span>(<span class="string">"cvc"</span>)  &#125;)</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    cvcField.isSecureTextEntry = <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>where tag is in <code>STPPaymentCardTextFieldViewModel.h</code></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="built_in">NS_ENUM</span>(<span class="built_in">NSInteger</span>, STPCardFieldType) &#123;</span><br><span class="line">    STPCardFieldTypeNumber,</span><br><span class="line">    STPCardFieldTypeExpiration,</span><br><span class="line">    STPCardFieldTypeCVC,</span><br><span class="line">    STPCardFieldTypePostalCode,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>Also, need to check <code>accessibilityLabel</code> in <code>STPPaymentCardTextField.m</code></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">NSString</span> *)defaultCVCPlaceholder &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.viewModel.brand == STPCardBrandAmex) &#123;</span><br><span class="line">        <span class="keyword">return</span> STPLocalizedString(<span class="string">@"CVV"</span>, <span class="string">@"Label for entering CVV in text field"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> STPLocalizedString(<span class="string">@"CVC"</span>, <span class="string">@"Label for entering CVC in text field"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-09-12T11:32:10.000Z" title="2019-09-12T11:32:10.000Z">2019-09-12</time><span class="level-item">a minute read (About 179 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-easily-parse-deep-json-in-Swift/">How to easily parse deep json in Swift</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/414">#414</a></strong></p>
<p><code>Codable</code> is awesome, but sometimes we just need to quickly get value in a deepy nested JSON. In the same way I did for Dart <a href="https://github.com/onmyway133/blog/issues/198">How to resolve deep json object in Dart</a>, let’s make that in Swift.</p>
<p>See <a href="https://github.com/onmyway133/Omnia/blob/master/Sources/Shared/JSON.swift">https://github.com/onmyway133/Omnia/blob/master/Sources/Shared/JSON.swift</a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">resolve</span>&lt;T&gt;<span class="params">(<span class="number">_</span> jsonDictionary: [String: <span class="keyword">Any</span>], keyPath: String)</span></span> -&gt; <span class="type">T?</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> current: <span class="type">Any?</span> = jsonDictionary</span><br><span class="line"></span><br><span class="line">    keyPath.<span class="built_in">split</span>(separator: <span class="string">"."</span>).forEach &#123; component <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> maybeInt = <span class="type">Int</span>(component), <span class="keyword">let</span> array = current <span class="keyword">as</span>? <span class="type">Array</span>&lt;<span class="type">Any</span>&gt; &#123;</span><br><span class="line">            current = array[maybeInt]</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> <span class="keyword">let</span> dictionary = current <span class="keyword">as</span>? <span class="type">JSONDictionary</span> &#123;</span><br><span class="line">            current = dictionary[<span class="type">String</span>(component)]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> current <span class="keyword">as</span>? <span class="type">T</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>So we can just resolve via key path</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">JSONTests</span>: <span class="title">XCTestCase</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">let</span> json: [<span class="type">String</span>: <span class="type">Any</span>] = [</span><br><span class="line">            <span class="string">"outside"</span>: [</span><br><span class="line">                <span class="string">"object"</span>: [</span><br><span class="line">                    <span class="string">"number"</span>: <span class="number">1</span>,</span><br><span class="line">                    <span class="string">"text"</span>: <span class="string">"hello"</span></span><br><span class="line">                ],</span><br><span class="line">                <span class="string">"arrayOfObjects"</span>: [</span><br><span class="line">                    [</span><br><span class="line">                        <span class="string">"number"</span>: <span class="number">2</span>,</span><br><span class="line">                        <span class="string">"text"</span>: <span class="string">"two"</span></span><br><span class="line">                    ],</span><br><span class="line">                    [</span><br><span class="line">                        <span class="string">"number"</span>: <span class="number">3</span>,</span><br><span class="line">                        <span class="string">"text"</span>: <span class="string">"three"</span></span><br><span class="line">                    ]</span><br><span class="line">                ],</span><br><span class="line">                <span class="string">"arrayOfArrays"</span>: [</span><br><span class="line">                    [</span><br><span class="line">                        <span class="string">"one"</span>, <span class="string">"two"</span>, <span class="string">"three"</span>, <span class="string">"four"</span></span><br><span class="line">                    ],</span><br><span class="line">                    [</span><br><span class="line">                        <span class="string">"five"</span>, <span class="string">"six"</span>, <span class="string">"seven"</span></span><br><span class="line">                    ]</span><br><span class="line">                ]</span><br><span class="line">            ]</span><br><span class="line">        ]</span><br><span class="line"></span><br><span class="line">        <span class="type">XCTAssertEqual</span>(resolve(json, keyPath: <span class="string">"outside.object.number"</span>), <span class="number">1</span>)</span><br><span class="line">        <span class="type">XCTAssertEqual</span>(resolve(json, keyPath: <span class="string">"outside.object.text"</span>), <span class="string">"hello"</span>)</span><br><span class="line">        <span class="type">XCTAssertEqual</span>(resolve(json, keyPath: <span class="string">"outside.arrayOfObjects.1.number"</span>), <span class="number">3</span>)</span><br><span class="line">        <span class="type">XCTAssertEqual</span>(resolve(json, keyPath: <span class="string">"outside.arrayOfArrays.1.1"</span>), <span class="string">"six"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-09-10T09:23:47.000Z" title="2019-09-10T09:23:47.000Z">2019-09-10</time><span class="level-item">3 minutes read (About 391 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-speed-up-GMSMarker-in-Google-Maps-for-iOS/">How to speed up GMSMarker in Google Maps for iOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/412">#412</a></strong></p>
<ul>
<li>Google Maps with a lot of pin, and no clustering can have bad performance if there are complex view in the marker.</li>
<li>The workaround is to use manual layout and rasterization</li>
</ul>
<p><a href="https://developer.apple.com/documentation/quartzcore/calayer/1410905-shouldrasterize">shouldRasterize</a></p>
<blockquote>
<p>When the value of this property is true, the layer is rendered as a bitmap in its local coordinate space and then composited to the destination with any other content. Shadow effects and any filters in the filters property are rasterized and included in the bitmap. However, the current opacity of the layer is not rasterized. If the rasterized bitmap requires scaling during compositing, the filters in the minificationFilter and magnificationFilter properties are applied as needed.</p>
</blockquote>
<p>In the <code>class PinView: UIView</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">isOpaque = <span class="literal">true</span></span><br><span class="line">layer.shouldRasterize = <span class="literal">true</span></span><br><span class="line">layer.rasterizationScale = <span class="type">UIScreen</span>.main.scale</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">StopMarker</span>: <span class="title">GMSMarker</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> stop: <span class="type">Stop</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">let</span> pinView = <span class="type">PinView</span>()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(stop: <span class="type">Stop</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.stop = stop</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>()</span><br><span class="line">        <span class="keyword">self</span>.position = stop.toCoordinate()</span><br><span class="line">        <span class="keyword">self</span>.iconView = pinView</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Read-more"><a href="#Read-more" class="headerlink" title="Read more"></a>Read more</h2><ul>
<li><a href="http://angelolloqui.com/blog/30-iOS-Performance-tips-I-Drawing-shadows">iOS Performance tips I: Drawing shadows</a></li>
</ul>
<blockquote>
<p>When your app needs to draw something on the screen, the GPU takes your layer hierarchy (UIView is just a wrapper on top of CALayer, which in the end are OpenGL textures) and applies one by one on top of each other based on their x,y,z position. In regular rendering, the whole operation happens in special frame buffers that the display will directly read for rendering on the screen, repeating the process at a rate around 60 times per second.</p>
</blockquote>
<blockquote>
<p>Of course the process have some drawbacks as well. The main one is that offscreen rendering requires a context switch (GPU has to change to a different memory area to perform the drawing) and then copying the resulting composited layer into the frame buffer. Every time any of the composited layers change, the cache needs to be redrawn again. This is why in many circumstances offscreen rendering is not a good idea, as it requires additional computation when need to be rerendered. Besides, the layer requires extra video memory which of course is limited, so use it with caution. </p>
</blockquote>
<ul>
<li><a href="https://www.objc.io/issues/3-views/moving-pixels-onto-the-screen/">Getting Pixels onto the Screen</a></li>
<li><a href="https://stackoverflow.com/questions/19405741/when-should-i-set-layer-shouldrasterize-to-yes">https://stackoverflow.com/questions/19405741/when-should-i-set-layer-shouldrasterize-to-yes</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-09-10T07:29:57.000Z" title="2019-09-10T07:29:57.000Z">2019-09-10</time><span class="level-item">a minute read (About 127 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-support-drag-and-drop-in-UICollectionView-iOS/">How to support drag and drop in UICollectionView iOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/411">#411</a></strong></p>
<p>See <a href="https://github.com/onmyway133/CollectionUpdateExample/blob/master/DragAndDrop/ViewController.swift">DragAndDrop example</a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span>, <span class="title">UICollectionViewDropDelegate</span>, <span class="title">UICollectionViewDragDelegate</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// MARK: - UICollectionViewDragDelegate</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">collectionView</span><span class="params">(<span class="number">_</span> collectionView: UICollectionView, itemsForBeginning session: UIDragSession, at indexPath: IndexPath)</span></span> -&gt; [<span class="type">UIDragItem</span>] &#123;</span><br><span class="line">        <span class="keyword">let</span> controller = leftController</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> provider = <span class="type">NSItemProvider</span>(</span><br><span class="line">            object: controller.imageForCell(indexPath: indexPath)</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> dragItem = <span class="type">UIDragItem</span>(itemProvider: provider)</span><br><span class="line">        dragItem.localObject = indexPath</span><br><span class="line">        <span class="keyword">return</span> [dragItem]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// MARK: - UICollectionViewDropDelegate</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">collectionView</span><span class="params">(<span class="number">_</span> collectionView: UICollectionView, performDropWith coordinator: UICollectionViewDropCoordinator)</span></span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> destinationIndexPath: <span class="type">IndexPath</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> indexPath = coordinator.destinationIndexPath &#123;</span><br><span class="line">            destinationIndexPath = indexPath</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            destinationIndexPath = <span class="type">IndexPath</span>(row: <span class="number">0</span>, section: <span class="number">0</span>)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> controller = rightController</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> dragItemIndexPath = coordinator.items.last?.dragItem.localObject <span class="keyword">as</span>! <span class="type">IndexPath</span></span><br><span class="line">        <span class="keyword">let</span> draggedItem = leftController.items[dragItemIndexPath.item]</span><br><span class="line"></span><br><span class="line">        <span class="comment">// remove</span></span><br><span class="line">        leftController.items.remove(at: dragItemIndexPath.item)</span><br><span class="line">        leftController.collectionView.deleteItems(at: [dragItemIndexPath])</span><br><span class="line"></span><br><span class="line">        <span class="comment">// insert</span></span><br><span class="line">        controller.items.insert(draggedItem, at: destinationIndexPath.item)</span><br><span class="line">        controller.collectionView.insertItems(at: [destinationIndexPath])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-09-10T07:25:02.000Z" title="2019-09-10T07:25:02.000Z">2019-09-10</time><span class="level-item">a minute read (About 162 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-support-drag-and-drop-in-NSView/">How to support drag and drop in NSView</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/410">#410</a></strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> AppKit</span><br><span class="line"><span class="keyword">import</span> Anchors</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DraggingView</span>: <span class="title">NSView</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> didDrag: ((<span class="type">FileInfo</span>) -&gt; <span class="type">Void</span>)?</span><br><span class="line">    <span class="keyword">let</span> highlightView = <span class="type">NSView</span>()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">init</span>(frame frameRect: <span class="type">NSRect</span>) &#123;</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(frame: frameRect)</span><br><span class="line"></span><br><span class="line">        registerForDraggedTypes([</span><br><span class="line">            .fileURL</span><br><span class="line">        ])</span><br><span class="line"></span><br><span class="line">        highlightView.isHidden = <span class="literal">true</span></span><br><span class="line">        addSubview(highlightView)</span><br><span class="line">        activate(highlightView.anchor.edges)</span><br><span class="line">        highlightView.wantsLayer = <span class="literal">true</span></span><br><span class="line">        highlightView.layer?.borderColor = <span class="type">NSColor</span>(hex: <span class="string">"#FF6CA8"</span>).cgColor</span><br><span class="line">        highlightView.layer?.borderWidth = <span class="number">6</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">init</span>?(coder decoder: <span class="type">NSCoder</span>) &#123;</span><br><span class="line">        <span class="built_in">fatalError</span>()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">draggingEntered</span><span class="params">(<span class="number">_</span> sender: NSDraggingInfo)</span></span> -&gt; <span class="type">NSDragOperation</span> &#123;</span><br><span class="line">        highlightView.isHidden = <span class="literal">false</span></span><br><span class="line">        <span class="keyword">return</span> <span class="type">NSDragOperation</span>()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">draggingEnded</span><span class="params">(<span class="number">_</span> sender: NSDraggingInfo)</span></span> &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> pathAlias = sender.draggingPasteboard.propertyList(forType: .fileURL) <span class="keyword">as</span>? <span class="type">String</span> <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> url = <span class="type">URL</span>(fileURLWithPath: pathAlias).standardized</span><br><span class="line">        <span class="keyword">let</span> fileInfo = <span class="type">FileInfo</span>(url: url)</span><br><span class="line">        didDrag?(fileInfo)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">draggingExited</span><span class="params">(<span class="number">_</span> sender: NSDraggingInfo?)</span></span> &#123;</span><br><span class="line">        highlightView.isHidden = <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">draggingUpdated</span><span class="params">(<span class="number">_</span> sender: NSDraggingInfo)</span></span> -&gt; <span class="type">NSDragOperation</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">NSDragOperation</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>To get information about multiple files</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">draggingEnded</span><span class="params">(<span class="number">_</span> sender: NSDraggingInfo)</span></span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> pasteBoardItems = sender.draggingPasteboard.pasteboardItems <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> fileInfos: [<span class="type">FileInfo</span>] = pasteBoardItems</span><br><span class="line">        .compactMap(&#123;</span><br><span class="line">            <span class="keyword">return</span> $<span class="number">0</span>.propertyList(forType: .fileURL) <span class="keyword">as</span>? <span class="type">String</span></span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="built_in">map</span>(&#123;</span><br><span class="line">            <span class="keyword">let</span> url = <span class="type">URL</span>(fileURLWithPath: $<span class="number">0</span>).standardized</span><br><span class="line">            <span class="keyword">return</span> <span class="type">FileInfo</span>(url: url)</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">    didDrag(fileInfos)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-09-08T19:48:50.000Z" title="2019-09-08T19:48:50.000Z">2019-09-08</time><span class="level-item">a few seconds read (About 45 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-use-NSStepper-in-Appkit/">How to use NSStepper in Appkit</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/409">#409</a></strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> stepper = <span class="type">NSStepper</span>()</span><br><span class="line"><span class="keyword">let</span> textField = <span class="type">NSTextField</span>(wrappingLabelWithString: <span class="string">"\(myLocalCount)"</span>)</span><br><span class="line"></span><br><span class="line">stepper.integerValue = myLocalCount</span><br><span class="line">stepper.minValue = <span class="number">5</span></span><br><span class="line">stepper.maxValue = <span class="number">24</span></span><br><span class="line">stepper.valueWraps = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">stepper.target = <span class="keyword">self</span></span><br><span class="line">stepper.action = #selector(onStepperChange(<span class="number">_</span>:))</span><br><span class="line"></span><br><span class="line"><span class="meta">@objc</span> <span class="function"><span class="keyword">func</span> <span class="title">onStepperChange</span><span class="params">(<span class="number">_</span> sender: NSStepper)</span></span> &#123;</span><br><span class="line">    myLocalCount = sender.integerValue</span><br><span class="line">    textField.stringValue = <span class="string">"\(sender.integerValue)"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-09-08T17:51:23.000Z" title="2019-09-08T17:51:23.000Z">2019-09-08</time><span class="level-item">a few seconds read (About 33 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-handle-shortcut-in-AppKit/">How to handle shortcut in AppKit</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/408">#408</a></strong></p>
<p><code>Podfile</code></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod <span class="string">'MASShortcut'</span></span><br></pre></td></tr></table></figure>

<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> shortcut = <span class="type">MASShortcut</span>(keyCode: kVK_ANSI_K, modifierFlags: [.command, .shift])</span><br><span class="line"></span><br><span class="line"><span class="type">MASShortcutMonitor</span>.shared()?.register(shortcut, withAction: &#123;</span><br><span class="line">    <span class="keyword">self</span>.showPopover(sender: <span class="keyword">self</span>.statusItem.button)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-09-07T19:14:41.000Z" title="2019-09-07T19:14:41.000Z">2019-09-07</time><span class="level-item">a few seconds read (About 90 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-select-file-in-its-directory-in-AppKit/">How to select file in its directory in AppKit</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/407">#407</a></strong></p>
<p><a href="https://developer.apple.com/documentation/appkit/nsworkspace/1524399-selectfile">https://developer.apple.com/documentation/appkit/nsworkspace/1524399-selectfile</a></p>
<blockquote>
<p>In macOS 10.5 and later, this method does not follow symlinks when selecting the file. If the fullPath parameter contains any symlinks, this method selects the symlink instead of the file it targets. If you want to select the target file, use the resolvingSymlinksInPath method to resolve any symlinks before calling this method.</p>
</blockquote>
<blockquote>
<p>It is safe to call this method from any thread of your app.</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">NSWorkspace</span>.shared.selectFile(</span><br><span class="line">    url.path,</span><br><span class="line">    inFileViewerRootedAtPath: url.deletingLastPathComponent().path)</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-09-07T18:51:52.000Z" title="2019-09-07T18:51:52.000Z">2019-09-07</time><span class="level-item">a few seconds read (About 20 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-use-NSProgressIndicator-in-AppKit/">How to use NSProgressIndicator in AppKit</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/406">#406</a></strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> progressIndicator = <span class="type">NSProgressIndicator</span>()</span><br><span class="line">progressIndicator.isIndeterminate = <span class="literal">true</span></span><br><span class="line">progressIndicator.style = .spinning</span><br><span class="line">progressIndicator.startAnimation(<span class="literal">nil</span>)</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-09-07T17:36:00.000Z" title="2019-09-07T17:36:00.000Z">2019-09-07</time><span class="level-item">a minute read (About 149 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-show-save-panel-in-AppKit/">How to show save panel in AppKit</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/405">#405</a></strong></p>
<p>Enable <code>Read/Write</code> for <code>User Selected File</code> under <code>Sandbox</code> to avoid bridge absent error</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">save</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> panel = <span class="type">NSSavePanel</span>()</span><br><span class="line">    <span class="comment">// 3</span></span><br><span class="line">    panel.directoryURL = <span class="type">FileManager</span>.<span class="keyword">default</span>.homeDirectoryForCurrentUser</span><br><span class="line">    <span class="comment">// 4</span></span><br><span class="line">    panel.nameFieldStringValue = <span class="string">"abc.gif"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5</span></span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> window = view.window <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    panel.beginSheetModal(<span class="keyword">for</span>: window) &#123; (result) <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">guard</span> result == .<span class="type">OK</span>, <span class="keyword">let</span> url = panel.url <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">self</span>.showAlert()</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">showAlert</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> alert = <span class="type">NSAlert</span>()</span><br><span class="line">    alert.messageText = <span class="string">"Hello world"</span></span><br><span class="line">    alert.informativeText = <span class="string">"Information text"</span></span><br><span class="line">    alert.addButton(withTitle: <span class="string">"OK"</span>)</span><br><span class="line">    alert.addButton(withTitle: <span class="string">"Cancel"</span>)</span><br><span class="line">    alert.runModal()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>To save multiple files, use <code>NSOpenPanel</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> panel = <span class="type">NSOpenPanel</span>()</span><br><span class="line">panel.canChooseFiles = <span class="literal">false</span></span><br><span class="line">panel.allowsMultipleSelection = <span class="literal">false</span></span><br><span class="line">panel.canChooseDirectories = <span class="literal">true</span></span><br><span class="line">panel.directoryURL = <span class="type">FileManager</span>.<span class="keyword">default</span>.homeDirectoryForCurrentUser</span><br></pre></td></tr></table></figure>

<h2 id="Read-more"><a href="#Read-more" class="headerlink" title="Read more"></a>Read more</h2><ul>
<li><a href="https://www.raywenderlich.com/666-filemanager-class-tutorial-for-macos-getting-started-with-the-file-system">https://www.raywenderlich.com/666-filemanager-class-tutorial-for-macos-getting-started-with-the-file-system</a></li>
<li><a href="https://stackoverflow.com/questions/47954418/using-cocoa-nssavepanel-in-sandbox-causes-assertion-failure">https://stackoverflow.com/questions/47954418/using-cocoa-nssavepanel-in-sandbox-causes-assertion-failure</a></li>
<li><a href="https://stackoverflow.com/questions/18417432/how-to-show-alert-pop-up-in-in-cocoa">https://stackoverflow.com/questions/18417432/how-to-show-alert-pop-up-in-in-cocoa</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-09-06T17:58:42.000Z" title="2019-09-06T17:58:42.000Z">2019-09-06</time><span class="level-item">a few seconds read (About 36 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-animate-NSView-using-keyframe/">How to animate NSView using keyframe</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/404">#404</a></strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> animation = <span class="type">CAKeyframeAnimation</span>(keyPath: <span class="string">"position.y"</span>)</span><br><span class="line">animation.values = [<span class="number">50</span>, <span class="number">20</span>, <span class="number">50</span>]</span><br><span class="line">animation.keyTimes = [<span class="number">0.0</span>, <span class="number">0.5</span>, <span class="number">1.0</span>]</span><br><span class="line">animation.duration = <span class="number">2</span></span><br><span class="line">animation.repeatCount = <span class="type">Float</span>.greatestFiniteMagnitude</span><br><span class="line">animation.autoreverses = <span class="literal">true</span></span><br><span class="line">myView.wantsLayer = <span class="literal">true</span></span><br><span class="line">myView.layer?.add(animation, forKey: <span class="string">"bounce"</span>)</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-09-06T09:13:14.000Z" title="2019-09-06T09:13:14.000Z">2019-09-06</time><span class="level-item">a few seconds read (About 111 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-quit-macOS-on-last-window-closed/">How to quit macOS on last window closed</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/403">#403</a></strong></p>
<p><a href="https://developer.apple.com/documentation/appkit/nsapplicationdelegate/1428381-applicationshouldterminateafterl?language=objc">https://developer.apple.com/documentation/appkit/nsapplicationdelegate/1428381-applicationshouldterminateafterl?language=objc</a></p>
<blockquote>
<p>The application sends this message to your delegate when the application’s last window is closed. It sends this message regardless of whether there are still panels open. (A panel in this case is defined as being an instance of NSPanel or one of its subclasses.)</p>
</blockquote>
<blockquote>
<p>If your implementation returns NO, control returns to the main event loop and the application is not terminated. If you return YES, your delegate’s applicationShouldTerminate: method is subsequently invoked to confirm that the application should be terminated.</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">applicationShouldTerminateAfterLastWindowClosed</span><span class="params">(<span class="number">_</span> sender: NSApplication)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-09-06T07:03:02.000Z" title="2019-09-06T07:03:02.000Z">2019-09-06</time><span class="level-item">2 minutes read (About 234 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-test-Date-with-timezone-aware-in-Swift/">How to test Date with timezone aware in Swift</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/402">#402</a></strong></p>
<p>I want to test if a date has passed another date</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> base =  <span class="type">Date</span>(timeIntervalSince1970: <span class="number">1567756697</span>)</span><br><span class="line"><span class="type">XCTAssertEqual</span>(validator.hasPassed(event: event, date: base), <span class="literal">true</span>)</span><br></pre></td></tr></table></figure>

<p>My <code>hasPassed</code> is using Calendar.current</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">minuteSinceMidnight</span><span class="params">(date: Date)</span></span> -&gt; <span class="type">MinuteSinceMidnight</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> calendar = <span class="type">Calendar</span>.current</span><br><span class="line">    <span class="keyword">let</span> start = calendar.startOfDay(<span class="keyword">for</span>: date)</span><br><span class="line">    <span class="keyword">return</span> <span class="type">Int</span>(date.timeIntervalSince(start)) / <span class="number">60</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>But the minute is always having timezone applied. Even if I try with <code>DateComponents</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">minuteSinceMidnight</span><span class="params">(date: Date)</span></span> -&gt; <span class="type">MinuteSinceMidnight</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> components = calendar.dateComponents([.hour, .minute], from: date)</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> hour = components.hour, <span class="keyword">let</span> minute = components.minute <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> hour * <span class="number">60</span> + minute</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>As long as I use <code>Calendar</code>, it always has timezone applied.</p>
<p>Checking this time interval <code>1567756697</code> on <a href="https://www.epochconverter.com/">https://www.epochconverter.com/</a></p>
<blockquote>
<p>Assuming that this timestamp is in seconds:<br>GMT: Friday, September 6, 2019 7:58:17 PM<br>Your time zone: Friday, September 6, 2019 9:58:17 PM GMT+02:00 DST</p>
</blockquote>
<p>Because I have GMT+2, there will always be 2 hours offset. This works in app, but not in test because of the way I construct Date with time interval.</p>
<p>One way is to have test data using string construction, and provide timezone to <code>DateFormatter</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> formatter = <span class="type">ISO8601DateFormatter</span>()</span><br><span class="line"><span class="keyword">let</span> date = formatter.date(from: <span class="string">"2019-07-58T12:39:00Z"</span>)</span><br><span class="line"><span class="keyword">let</span> string = formatter.string(from: <span class="type">Date</span>())</span><br></pre></td></tr></table></figure>

<p>Another way is to have a fixed timezone for Calendar</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> calendar = <span class="type">Calendar</span>.current</span><br><span class="line">calendar.timeZone = <span class="type">TimeZone</span>(secondsFromGMT: <span class="number">0</span>)!</span><br></pre></td></tr></table></figure>

<p>Another way is to adjust existing date</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">calendar.date(bySettingHour: <span class="number">20</span>, minute: <span class="number">02</span>, second: <span class="number">00</span>, of: <span class="type">Date</span>()</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-09-04T10:03:45.000Z" title="2019-09-04T10:03:45.000Z">2019-09-04</time><span class="level-item">a minute read (About 190 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-do-simple-analytics-in-iOS/">How to do simple analytics in iOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/395">#395</a></strong></p>
<p>Prefer static enum to avoid repetition and error. The Log should have methods with all required fields so the call site is as simple as possible. How to format and assign parameters is encapsulated in this Analytics.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"><span class="keyword">import</span> Firebase</span><br><span class="line"><span class="keyword">import</span> FirebaseAnalytics</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Analytics</span> </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">enum</span> <span class="title">Parameter</span>: <span class="title">String</span> </span>&#123;</span><br><span class="line">        <span class="keyword">case</span> studentId = <span class="string">"student_id"</span></span><br><span class="line">        <span class="keyword">case</span> classId = <span class="string">"class_id"</span></span><br><span class="line">        <span class="keyword">case</span> url = <span class="string">"url"</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">enum</span> <span class="title">Property</span>: <span class="title">String</span> </span>&#123;</span><br><span class="line">        <span class="keyword">case</span> grantLocation = <span class="string">"grant_location"</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">enum</span> <span class="title">Name</span>: <span class="title">String</span> </span>&#123;</span><br><span class="line">        <span class="keyword">case</span> login</span><br><span class="line">        <span class="keyword">case</span> logOut = <span class="string">"log_out"</span></span><br><span class="line">        <span class="keyword">case</span> enroll</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Log</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">log</span><span class="params">(<span class="number">_</span> name: Name, parameters: [Parameter: String] = [:])</span></span> &#123;</span><br><span class="line">            <span class="keyword">let</span> mapped: [<span class="type">String</span>: <span class="type">String</span>] = <span class="type">Dictionary</span>(uniqueKeysWithValues: parameters.<span class="built_in">map</span>(&#123; key, value <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">return</span> (key.rawValue, value)</span><br><span class="line">            &#125;))</span><br><span class="line"></span><br><span class="line">            <span class="type">FirebaseAnalytics</span>.<span class="type">Analytics</span>.logEvent(name.rawValue, parameters: mapped)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">set</span><span class="params">(userId: String?)</span></span> &#123;</span><br><span class="line">            <span class="type">FirebaseAnalytics</span>.<span class="type">Analytics</span>.setUserID(userId)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">setProperty</span><span class="params">(<span class="number">_</span> property: Property, value: String)</span></span> &#123;</span><br><span class="line">            <span class="type">FirebaseAnalytics</span>.<span class="type">Analytics</span>.setUserProperty(value, forName: property.rawValue)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> log = <span class="type">Log</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Analytics</span>.<span class="title">Log</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">grantLocation</span><span class="params">(hasGranted: Bool)</span></span> &#123;</span><br><span class="line">        setProperty(.grantLocation, value: hasGranted.<span class="built_in">toString</span>())</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">login</span><span class="params">(userId: String)</span></span> &#123;</span><br><span class="line">        log(.login)</span><br><span class="line">        <span class="keyword">set</span>(userId: userId)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">logOut</span><span class="params">()</span></span> &#123;</span><br><span class="line">        log(.logOut)</span><br><span class="line">        <span class="keyword">set</span>(userId: <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">enroll</span><span class="params">(classId: String)</span></span> &#123;</span><br><span class="line">        log(.enroll, parameters: [</span><br><span class="line">            .classId: classId</span><br><span class="line">        ])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">extension</span> <span class="title">Bool</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">toString</span><span class="params">()</span></span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span> ? <span class="string">"yes"</span>: <span class="string">"no"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-08-27T11:29:44.000Z" title="2019-08-27T11:29:44.000Z">2019-08-27</time><span class="level-item">5 minutes read (About 751 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-manage-OneSignal-push-notification-in-iOS/">How to manage OneSignal push notification in iOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/377">#377</a></strong></p>
<p><a href="https://onesignal.com/">OneSignal</a> is an alternative for Parse for push notifications but the sdk has many extra stuff and assumptions and lots of swizzling.</p>
<p>We can just use Rest to make API calls. From <a href="https://github.com/onmyway133/Dust">https://github.com/onmyway133/Dust</a></p>
<p>Every official push notification SDK can do many things</p>
<ul>
<li>Register device token. This is crucial for the notification to get from your backend -&gt; APNS -&gt; device</li>
<li>Manage player id, user id, arn, …This is used to associate with device token</li>
<li>Manager tag, topic, subscription, segments, …This is used to group a set of device tokens</li>
<li>Do swizzling, update your application badge number, change your user notification settings, … without your knowing about that</li>
<li>Some other fancy stuffs</li>
<li>Dust does only one thing, which is push notification handling. The rest is under your control</li>
</ul>
<p>OneSignal</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">application</span><span class="params">(application: UIApplication, didFinishLaunchingWithOptions launchOptions: [NSObject : AnyObject]?)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">  <span class="type">OneSignal</span>.appID = <span class="string">""</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">application</span><span class="params">(application: UIApplication, didRegisterForRemoteNotificationsWithDeviceToken deviceToken: NSData)</span></span> &#123;</span><br><span class="line">  <span class="type">OneSignal</span>.handleDeviceToken(deviceToken)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Here is the implementation</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Utils</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">parse</span><span class="params">(deviceToken data: NSData)</span></span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> buffer = <span class="type">UnsafePointer</span>&lt;<span class="type">CChar</span>&gt;(data.bytes)</span><br><span class="line">    <span class="keyword">var</span> string = <span class="string">""</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span>..&lt;data.length &#123;</span><br><span class="line">      string += <span class="type">String</span>(format: <span class="string">"%02.2hhx"</span>, arguments: [buffer[i]])</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> string</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">deviceModel</span><span class="params">()</span></span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> systemInfo = utsname()</span><br><span class="line">    uname(&amp;systemInfo)</span><br><span class="line">    <span class="keyword">var</span> v = systemInfo.machine</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> deviceModel = <span class="string">""</span></span><br><span class="line">    <span class="keyword">let</span> <span class="number">_</span> = <span class="built_in">withUnsafePointer</span>(&amp;v) &#123;</span><br><span class="line">      deviceModel = <span class="type">String</span>(<span class="type">UTF8String</span>: <span class="type">UnsafePointer</span>($<span class="number">0</span>)) ?? <span class="string">""</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> deviceModel</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">systemVersion</span><span class="params">()</span></span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> version = <span class="type">NSProcessInfo</span>.processInfo().operatingSystemVersion</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"\(version.majorVersion).\(version.minorVersion).\(version.patchVersion)"</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">language</span><span class="params">()</span></span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">NSLocale</span>.preferredLanguages().first!</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">timezone</span><span class="params">()</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">NSTimeZone</span>.localTimeZone().secondsFromGMT</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">soundFiles</span><span class="params">()</span></span> -&gt; [<span class="type">String</span>] &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> resourcePath = <span class="type">NSBundle</span>.mainBundle().resourcePath</span><br><span class="line">      <span class="keyword">else</span> &#123; <span class="keyword">return</span> [] &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> files = <span class="keyword">try</span>? <span class="type">NSFileManager</span>.defaultManager()</span><br><span class="line">      .contentsOfDirectoryAtPath(resourcePath)</span><br><span class="line">      .<span class="built_in">filter</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> $<span class="number">0</span>.hasSuffix(<span class="string">".wav"</span>) || $<span class="number">0</span>.hasSuffix(<span class="string">".mp3"</span>)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> files ?? []</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">versionNumber</span><span class="params">()</span></span> -&gt; <span class="type">String?</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">NSBundle</span>.mainBundle().infoDictionary?[<span class="string">"CFBundleShortVersionString"</span>] <span class="keyword">as</span>? <span class="type">String</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">buildNumber</span><span class="params">()</span></span> -&gt; <span class="type">String?</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">NSBundle</span>.mainBundle().infoDictionary?[<span class="string">"CFBundleVersionString"</span>] <span class="keyword">as</span>? <span class="type">String</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">netType</span><span class="params">()</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="comment">// Reachability</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">UserDefaults</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">Key</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> playerID: <span class="type">String</span> = <span class="string">"Dust-OneSignal-Player-ID-Key"</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> deviceToken: <span class="type">String</span> = <span class="string">"Dust-OneSignal-Device-Token-Key"</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> subscribed: <span class="type">String</span> = <span class="string">"Dust-OneSignal-Disable-Subscribed-Key"</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">var</span> playerID: <span class="type">String?</span> &#123;</span><br><span class="line">    <span class="keyword">get</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="type">NSUserDefaults</span>.standardUserDefaults().stringForKey(<span class="type">Key</span>.playerID)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">set</span> &#123;</span><br><span class="line">      <span class="type">NSUserDefaults</span>.standardUserDefaults().setObject(newValue, forKey: <span class="type">Key</span>.playerID)</span><br><span class="line">      <span class="type">NSUserDefaults</span>.standardUserDefaults().synchronize()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">var</span> deviceToken: <span class="type">String?</span> &#123;</span><br><span class="line">    <span class="keyword">get</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="type">NSUserDefaults</span>.standardUserDefaults().stringForKey(<span class="type">Key</span>.deviceToken)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">set</span> &#123;</span><br><span class="line">      <span class="type">NSUserDefaults</span>.standardUserDefaults().setObject(newValue, forKey: <span class="type">Key</span>.deviceToken)</span><br><span class="line">      <span class="type">NSUserDefaults</span>.standardUserDefaults().synchronize()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">var</span> subscribed: <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">get</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="type">NSUserDefaults</span>.standardUserDefaults().boolForKey(<span class="type">Key</span>.subscribed)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">set</span> &#123;</span><br><span class="line">      <span class="type">NSUserDefaults</span>.standardUserDefaults().setBool(newValue, forKey: <span class="type">Key</span>.subscribed)</span><br><span class="line">      <span class="type">NSUserDefaults</span>.standardUserDefaults().synchronize()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"><span class="keyword">import</span> Alamofire</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">OneSignal</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">var</span> appID: <span class="type">String</span> = <span class="string">""</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">let</span> version = <span class="string">"020115"</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">let</span> baseURL = <span class="type">NSURL</span>(string: <span class="string">"https://onesignal.com/api/v1"</span>)!</span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">enum</span> <span class="title">NotificationType</span>: <span class="title">Int</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> subscribed = <span class="number">7</span></span><br><span class="line">    <span class="keyword">case</span> unsubscribed = -<span class="number">2</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">value</span><span class="params">()</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="type">UserDefaults</span>.subscribed</span><br><span class="line">        ? <span class="type">NotificationType</span>.subscribed.rawValue : <span class="type">NotificationType</span>.unsubscribed.rawValue</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">enum</span> <span class="title">Provisioning</span>: <span class="title">Int</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> development = <span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">setup</span><span class="params">(appID appID: String)</span></span> &#123;</span><br><span class="line">    <span class="type">NSUserDefaults</span>.standardUserDefaults().registerDefaults([</span><br><span class="line">      <span class="type">UserDefaults</span>.<span class="type">Key</span>.subscribed: <span class="literal">true</span></span><br><span class="line">    ])</span><br><span class="line"></span><br><span class="line">    <span class="type">OneSignal</span>.appID = appID</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">registerOrUpdateSession</span><span class="params">(completion: <span class="params">(<span class="params">(String?)</span></span></span></span> -&gt; <span class="type">Void</span>)? = <span class="literal">nil</span>) &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> bundleID = <span class="type">NSBundle</span>.mainBundle().bundleIdentifier,</span><br><span class="line">      <span class="keyword">let</span> deviceToken = <span class="type">UserDefaults</span>.deviceToken</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> params: [<span class="type">String</span>: <span class="type">AnyObject</span>] = [</span><br><span class="line">      <span class="string">"app_id"</span> : appID,</span><br><span class="line">      <span class="string">"device_model"</span> : <span class="type">Utils</span>.deviceModel(),</span><br><span class="line">      <span class="string">"device_os"</span> : <span class="type">Utils</span>.systemVersion(),</span><br><span class="line">      <span class="string">"language"</span> : <span class="type">Utils</span>.language(),</span><br><span class="line">      <span class="string">"timezone"</span> : <span class="type">NSNumber</span>(integer: <span class="type">Utils</span>.timezone()),</span><br><span class="line">      <span class="string">"device_type"</span> : <span class="type">NSNumber</span>(integer : <span class="number">0</span>),</span><br><span class="line">      <span class="string">"sounds"</span> : <span class="type">Utils</span>.soundFiles(),</span><br><span class="line">      <span class="string">"sdk"</span> : version,</span><br><span class="line">      <span class="string">"identifier"</span> : deviceToken,</span><br><span class="line">      <span class="string">"net_type"</span> : <span class="type">NSNumber</span>(integer: <span class="type">Utils</span>.netType()),</span><br><span class="line">      <span class="string">"rooted"</span>: <span class="type">NSNumber</span>(bool: <span class="literal">false</span>),</span><br><span class="line">      <span class="string">"as_id"</span>: <span class="string">"OptedOut"</span>,</span><br><span class="line">      <span class="string">"sdk_type"</span>: <span class="string">"native"</span>,</span><br><span class="line">      <span class="string">"ios_bundle"</span>: bundleID,</span><br><span class="line">      <span class="string">"game_version"</span>: <span class="type">Utils</span>.versionNumber() ?? <span class="string">""</span>,</span><br><span class="line">      <span class="string">"notification_types"</span>: <span class="type">NotificationType</span>.value(),</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    #<span class="keyword">if</span> <span class="type">DEBUG</span></span><br><span class="line">      params[<span class="string">"test_type"</span>] = <span class="type">Provisioning</span>.development.rawValue</span><br><span class="line">    #endif</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> url: <span class="type">NSURL</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> playerID = <span class="type">UserDefaults</span>.playerID &#123;</span><br><span class="line">      url = baseURL.<span class="type">URLByAppendingPathComponent</span>(<span class="string">"players/\(playerID)/on_session"</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      url = baseURL.<span class="type">URLByAppendingPathComponent</span>(<span class="string">"players"</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">Alamofire</span></span><br><span class="line">    .request(.<span class="type">POST</span>, url, parameters: params)</span><br><span class="line">    .responseJSON &#123; response <span class="keyword">in</span></span><br><span class="line">      <span class="keyword">guard</span> <span class="keyword">let</span> json = response.result.value <span class="keyword">as</span>? [<span class="type">String</span>: <span class="type">AnyObject</span>]</span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">        completion?(<span class="literal">nil</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> <span class="keyword">let</span> id = json[<span class="string">"id"</span>] <span class="keyword">as</span>? <span class="type">String</span> &#123;</span><br><span class="line">        <span class="type">UserDefaults</span>.playerID = id</span><br><span class="line">        completion?(id)</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> <span class="keyword">let</span> value = json[<span class="string">"success"</span>] <span class="keyword">as</span>? <span class="type">Int</span>,</span><br><span class="line">        playerID = <span class="type">UserDefaults</span>.playerID <span class="keyword">where</span> value == <span class="number">1</span> &#123;</span><br><span class="line">        completion?(playerID)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        completion?(<span class="literal">nil</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">handle</span><span class="params">(deviceToken data: NSData)</span></span> &#123;</span><br><span class="line">    <span class="type">UserDefaults</span>.deviceToken = <span class="type">Utils</span>.parse(deviceToken: data)</span><br><span class="line">    registerOrUpdateSession()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">update</span><span class="params">(subscription subscribed: Bool)</span></span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> playerID = <span class="type">UserDefaults</span>.playerID <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">    <span class="type">UserDefaults</span>.subscribed = subscribed</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> url = baseURL.<span class="type">URLByAppendingPathComponent</span>(<span class="string">"players/\(playerID)"</span>)</span><br><span class="line">    <span class="keyword">let</span> params: [<span class="type">String</span>: <span class="type">AnyObject</span>] = [</span><br><span class="line">      <span class="string">"app_id"</span>: appID,</span><br><span class="line">      <span class="string">"notification_types"</span>: <span class="type">NotificationType</span>.value()</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    <span class="type">Alamofire</span></span><br><span class="line">    .request(.<span class="type">PUT</span>, url, parameters: params)</span><br><span class="line">    .responseJSON &#123; response <span class="keyword">in</span></span><br><span class="line">      <span class="built_in">print</span>(response)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">update</span><span class="params">(badge <span class="built_in">count</span>: Int)</span></span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> playerID = <span class="type">UserDefaults</span>.playerID <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> url = baseURL.<span class="type">URLByAppendingPathComponent</span>(<span class="string">"players/\(playerID)"</span>)</span><br><span class="line">    <span class="keyword">let</span> params: [<span class="type">String</span>: <span class="type">AnyObject</span>] = [</span><br><span class="line">      <span class="string">"app_id"</span>: appID,</span><br><span class="line">      <span class="string">"badge_count"</span>: <span class="built_in">count</span></span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    <span class="type">Alamofire</span></span><br><span class="line">      .request(.<span class="type">PUT</span>, url, parameters: params)</span><br><span class="line">      .responseJSON &#123; response <span class="keyword">in</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">getPlayerID</span><span class="params">(completion: String -&gt; Void)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> playerID = <span class="type">UserDefaults</span>.playerID &#123;</span><br><span class="line">      completion(playerID)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    registerOrUpdateSession &#123; playerID <span class="keyword">in</span></span><br><span class="line">      <span class="keyword">if</span> <span class="keyword">let</span> playerID = playerID &#123;</span><br><span class="line">        completion(playerID)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-08-27T11:26:45.000Z" title="2019-08-27T11:26:45.000Z">2019-08-27</time><span class="level-item">a minute read (About 119 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-do-throttle-and-debounce-using-DispatchWorkItem-in-Swift/">How to do throttle and debounce using DispatchWorkItem in Swift</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/376">#376</a></strong></p>
<p><a href="https://github.com/onmyway133/Omnia/blob/master/Sources/Shared/Debouncer.swift">https://github.com/onmyway133/Omnia/blob/master/Sources/Shared/Debouncer.swift</a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Debouncer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">let</span> delay: <span class="type">TimeInterval</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> workItem: <span class="type">DispatchWorkItem?</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">init</span>(delay: <span class="type">TimeInterval</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.delay = delay</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Trigger the action after some delay</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">run</span><span class="params">(action: @escaping <span class="params">()</span></span></span> -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">        workItem?.cancel()</span><br><span class="line">        workItem = <span class="type">DispatchWorkItem</span>(block: action)</span><br><span class="line">        <span class="type">DispatchQueue</span>.main.asyncAfter(deadline: .now() + delay, execute: workItem!)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> XCTest</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DebouncerTests</span>: <span class="title">XCTestCase</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">testDebounce</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">let</span> expectation = <span class="keyword">self</span>.expectation(description: #function)</span><br><span class="line">        <span class="keyword">let</span> debouncer = <span class="type">Debouncer</span>(delay: <span class="number">0.5</span>)</span><br><span class="line">        <span class="keyword">var</span> value = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        debouncer.run(action: &#123;</span><br><span class="line">            value = <span class="number">1</span></span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        debouncer.run(action: &#123;</span><br><span class="line">            value = <span class="number">2</span></span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="type">DispatchQueue</span>.main.asyncAfter(deadline: <span class="type">DispatchTime</span>.now() + <span class="number">0.2</span>, execute: &#123;</span><br><span class="line">            debouncer.run(action: &#123;</span><br><span class="line">                value = <span class="number">3</span></span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="type">DispatchQueue</span>.main.asyncAfter(deadline: <span class="type">DispatchTime</span>.now() + <span class="number">0.71</span>, execute: &#123;</span><br><span class="line">            <span class="type">XCTAssertEqual</span>(value, <span class="number">3</span>)</span><br><span class="line">            expectation.fulfill()</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        wait(<span class="keyword">for</span>: [expectation], timeout: <span class="number">1.2</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-08-27T11:24:45.000Z" title="2019-08-27T11:24:45.000Z">2019-08-27</time><span class="level-item">a few seconds read (About 62 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-simplify-UIApplication-life-cycle-observation-in-iOS/">How to simplify UIApplication life cycle observation in iOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/375">#375</a></strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">LifecyclerHandler</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> observer: <span class="type">AnyObject!</span></span><br><span class="line">    <span class="keyword">var</span> action: (() -&gt; <span class="type">Void</span>)?</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">let</span> debouncer = <span class="type">Debouncer</span>(delay: <span class="number">1.0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">setup</span><span class="params">()</span></span> &#123;</span><br><span class="line">        observer = <span class="type">NotificationCenter</span>.<span class="keyword">default</span>.addObserver(</span><br><span class="line">            forName: <span class="type">UIApplication</span>.didBecomeActiveNotification,</span><br><span class="line">            object: <span class="literal">nil</span>,</span><br><span class="line">            queue: .main,</span><br><span class="line">            using: &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] <span class="number">_</span> <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">self</span>?.debouncer.run &#123;</span><br><span class="line">                    <span class="keyword">self</span>?.action?()</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">let</span> lifecycleHandler = <span class="type">LifecyclerHandler</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">    lifecycleHandler.action = &#123;</span><br><span class="line">        <span class="type">Deps</span>.userHandler.refreshToken()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    lifecycleHandler.setup()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-08-27T10:52:17.000Z" title="2019-08-27T10:52:17.000Z">2019-08-27</time><span class="level-item">a minute read (About 221 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-do-UITests-with-Google-Maps-on-iOS/">How to do UITests with Google Maps on iOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/374">#374</a></strong></p>
<h2 id="Interact-with-GMSMapView"><a href="#Interact-with-GMSMapView" class="headerlink" title="Interact with GMSMapView"></a>Interact with GMSMapView</h2><p>Add <code>accessibilityIdentifier</code> to the parent view of <code>GMSMapView</code>. Setting directly onto <code>GMSMapView</code> has no effect</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">accessibilityIdentifier = <span class="string">"MapView"</span></span><br></pre></td></tr></table></figure>

<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="built_in">map</span> = app.otherElements.matching(identifier: <span class="string">"MapView"</span>).element(boundBy: <span class="number">0</span>)</span><br><span class="line"><span class="built_in">map</span>.pinch(withScale: <span class="number">2</span>, velocity: <span class="number">1</span>)</span><br><span class="line"><span class="built_in">map</span>.rotate(<span class="type">CGFloat</span>.pi/<span class="number">3</span>, withVelocity: <span class="number">1.0</span>)</span><br><span class="line"><span class="built_in">map</span>.swipeLeft()</span><br><span class="line"><span class="built_in">map</span>.swipeRight()</span><br><span class="line"><span class="built_in">map</span>.swipeDown()</span><br><span class="line"><span class="built_in">map</span>.swipeDown()</span><br></pre></td></tr></table></figure>

<h2 id="Interact-with-GMSMarker-1st-try"><a href="#Interact-with-GMSMarker-1st-try" class="headerlink" title="Interact with GMSMarker (1st try)"></a>Interact with GMSMarker (1st try)</h2><p>Need to enable accessibility</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mapView.accessibilityElementsHidden = <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<p>Can’t use pinch to zoom out with UITests, so need to mock location !!!</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">map</span>().pinch(withScale: <span class="number">0.05</span>, velocity: -<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<p>Need to use gpx to mock to preferred location</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="built_in">map</span> = app.otherElements[<span class="type">Constant</span>.<span class="type">AccessibilityId</span>.mapView.rawValue]</span><br><span class="line"><span class="keyword">let</span> pin = app.otherElements</span><br><span class="line">            .matching(identifier: <span class="type">Constant</span>.<span class="type">AccessibilityId</span>.pin.rawValue)</span><br><span class="line">            .element(boundBy: <span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p>Try <code>isAccessibilityElement = true</code> for <code>PinView</code>, can’t touch!!<br>Use coordinate, can’t touch !!</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> coordinate = pin.coordinate(withNormalizedOffset: <span class="type">CGVector</span>(dx: <span class="number">0.5</span>, dy: <span class="number">0.5</span>))</span><br><span class="line">coordinate.tap()</span><br></pre></td></tr></table></figure>

<p>Try traversing all the pins, can’t touch</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Array</span>(<span class="number">0</span>..&lt;pins.<span class="built_in">count</span>).forEach &#123;</span><br><span class="line">    <span class="keyword">let</span> pin = pins.element(boundBy: $<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">if</span> pin.isHittable &#123;</span><br><span class="line">        pin.tap()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>When <code>po app.otherElements</code>, coordinates are outside screen</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Other, &#123;&#123;1624.0, 1624.0&#125;, &#123;30.0, 30.0&#125;&#125;, identifier: &#39;pin&#39;, label: &#39;Hello world&#39;</span><br></pre></td></tr></table></figure>

<h2 id="Interact-with-GMSMarker-works"><a href="#Interact-with-GMSMarker-works" class="headerlink" title="Interact with GMSMarker (works)"></a>Interact with GMSMarker (works)</h2><p>My <code>PinView</code> has <code>isHittable</code> being false, no matter how I use coordinate or enable it. It can’t be touched.</p>
<p>Go to Xcode -&gt; Open Developer Tool -&gt; Accessibility Inspector to inspect our app in iOS simulator</p>
<img width="1680" alt="inspector" src="https://user-images.githubusercontent.com/2284279/63772730-fe373480-c8d9-11e9-97b9-e089d468e6f9.png">

<p>It turns out that if I do </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">po app.buttons</span><br></pre></td></tr></table></figure>

<p>It shows all the GMSMarker, but with <code>identifier</code> having class name <code>MyApp.MyStopMarker</code>, so just need to use <code>buttons</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">NSPredicate</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">contains</span><span class="params">(identifier: String)</span></span> -&gt; <span class="type">NSPredicate</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">NSPredicate</span>(format: <span class="string">"identifier CONTAINS[c] '\(text)'"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> pin = <span class="built_in">map</span>()</span><br><span class="line">    .buttons.matching(<span class="type">NSPredicate</span>.<span class="built_in">contains</span>(<span class="string">"MyStopMarker"</span>))</span><br><span class="line">    .element(boundBy: <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">pin.tap()</span><br></pre></td></tr></table></figure></div></article></div><nav class="pagination is-centered mt-4" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/tags/swift/page/4/">Previous</a></div><div class="pagination-next"><a href="/tags/swift/page/6/">Next</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/tags/swift/">1</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/tags/swift/page/4/">4</a></li><li><a class="pagination-link is-current" href="/tags/swift/page/5/">5</a></li><li><a class="pagination-link" href="/tags/swift/page/6/">6</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/tags/swift/page/9/">9</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="" src="https://avatars1.githubusercontent.com/u/2284279?s=460&amp;v=4" alt="onmyway133"></figure><p class="title is-size-4 is-block line-height-inherit">onmyway133</p><p class="is-size-6 is-block">iOS, macOS, Android, React. Serial maker. Writer. Speaker.</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Oslo, Norway</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">605</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">52</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/onmyway133" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/onmyway133"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com/onmyway133"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile is-mobile" href="https://onmyway133.com/apps" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Apps</span></span><span class="level-right"><span class="level-item tag">onmyway133.com</span></span></a></li><li><a class="level is-mobile is-mobile" href="https://learntalks.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Learn Talks</span></span><span class="level-right"><span class="level-item tag">learntalks.com</span></span></a></li></ul></div></div></div><!--!--><div class="card widget"><div class="card-content"><h3 class="menu-label">Recent</h3><article class="media"><div class="media-content size-small"><p><time dateTime="2020-06-04T03:58:39.000Z">2020-06-04</time></p><p class="title is-6"><a class="link-muted" href="/blog/How-to-auto-scroll-to-top-in-react-router-5/">How to auto scroll to top in react router 5</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-06-03T02:41:26.000Z">2020-06-03</time></p><p class="title is-6"><a class="link-muted" href="/blog/How-to-use-dynamic-route-in-react-router-5/">How to use dynamic route in react router 5</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-06-01T03:00:36.000Z">2020-06-01</time></p><p class="title is-6"><a class="link-muted" href="/blog/How-to-use-folder-as-local-npm-package/">How to use folder as local npm package</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-05-22T18:41:10.000Z">2020-05-22</time></p><p class="title is-6"><a class="link-muted" href="/blog/How-to-make-switch-statement-in-SwiftUI/">How to make switch statement in SwiftUI</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-05-08T20:19:31.000Z">2020-05-08</time></p><p class="title is-6"><a class="link-muted" href="/blog/How-to-update-multiple-state-properties-with-React-hooks/">How to update multiple state properties with React hooks</a></p><p class="is-uppercase"></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/archives/2020/06/"><span class="level-start"><span class="level-item">June 2020</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/05/"><span class="level-start"><span class="level-item">May 2020</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/04/"><span class="level-start"><span class="level-item">April 2020</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/03/"><span class="level-start"><span class="level-item">March 2020</span></span><span class="level-end"><span class="level-item tag">21</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/02/"><span class="level-start"><span class="level-item">February 2020</span></span><span class="level-end"><span class="level-item tag">20</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/01/"><span class="level-start"><span class="level-item">January 2020</span></span><span class="level-end"><span class="level-item tag">30</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/12/"><span class="level-start"><span class="level-item">December 2019</span></span><span class="level-end"><span class="level-item tag">36</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/11/"><span class="level-start"><span class="level-item">November 2019</span></span><span class="level-end"><span class="level-item tag">38</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/10/"><span class="level-start"><span class="level-item">October 2019</span></span><span class="level-end"><span class="level-item tag">49</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/09/"><span class="level-start"><span class="level-item">September 2019</span></span><span class="level-end"><span class="level-item tag">50</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/08/"><span class="level-start"><span class="level-item">August 2019</span></span><span class="level-end"><span class="level-item tag">39</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/07/"><span class="level-start"><span class="level-item">July 2019</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/06/"><span class="level-start"><span class="level-item">June 2019</span></span><span class="level-end"><span class="level-item tag">41</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/05/"><span class="level-start"><span class="level-item">May 2019</span></span><span class="level-end"><span class="level-item tag">48</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/04/"><span class="level-start"><span class="level-item">April 2019</span></span><span class="level-end"><span class="level-item tag">27</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/03/"><span class="level-start"><span class="level-item">March 2019</span></span><span class="level-end"><span class="level-item tag">24</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/02/"><span class="level-start"><span class="level-item">February 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/12/"><span class="level-start"><span class="level-item">December 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/05/"><span class="level-start"><span class="level-item">May 2018</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/04/"><span class="level-start"><span class="level-item">April 2018</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/02/"><span class="level-start"><span class="level-item">February 2018</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/01/"><span class="level-start"><span class="level-item">January 2018</span></span><span class="level-end"><span class="level-item tag">14</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/12/"><span class="level-start"><span class="level-item">December 2017</span></span><span class="level-end"><span class="level-item tag">14</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/11/"><span class="level-start"><span class="level-item">November 2017</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/10/"><span class="level-start"><span class="level-item">October 2017</span></span><span class="level-end"><span class="level-item tag">18</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/09/"><span class="level-start"><span class="level-item">September 2017</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/08/"><span class="level-start"><span class="level-item">August 2017</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/07/"><span class="level-start"><span class="level-item">July 2017</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/06/"><span class="level-start"><span class="level-item">June 2017</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/05/"><span class="level-start"><span class="level-item">May 2017</span></span><span class="level-end"><span class="level-item tag">35</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/04/"><span class="level-start"><span class="level-item">April 2017</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/algorithm/"><span class="tag">algorithm</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/android/"><span class="tag">android</span><span class="tag is-grey-lightest">34</span></a></div><div class="control"><a class="tags has-addons" href="/tags/apple-script/"><span class="tag">apple script</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/catalyst/"><span class="tag">catalyst</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ci/"><span class="tag">ci</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cloud/"><span class="tag">cloud</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cocoapods/"><span class="tag">cocoapods</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/combine/"><span class="tag">combine</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/core-data/"><span class="tag">core data</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/csharp/"><span class="tag">csharp</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/css/"><span class="tag">css</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/dart/"><span class="tag">dart</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/database/"><span class="tag">database</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/design/"><span class="tag">design</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/electron/"><span class="tag">electron</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/firebase/"><span class="tag">firebase</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/flutter/"><span class="tag">flutter</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/git/"><span class="tag">git</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/github/"><span class="tag">github</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/go/"><span class="tag">go</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/google/"><span class="tag">google</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/iOS/"><span class="tag">iOS</span><span class="tag is-grey-lightest">157</span></a></div><div class="control"><a class="tags has-addons" href="/tags/javascript/"><span class="tag">javascript</span><span class="tag is-grey-lightest">43</span></a></div><div class="control"><a class="tags has-addons" href="/tags/kotlin/"><span class="tag">kotlin</span><span class="tag is-grey-lightest">25</span></a></div><div class="control"><a class="tags has-addons" href="/tags/layout/"><span class="tag">layout</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/life/"><span class="tag">life</span><span class="tag is-grey-lightest">10</span></a></div><div class="control"><a class="tags has-addons" href="/tags/links/"><span class="tag">links</span><span class="tag is-grey-lightest">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/macOS/"><span class="tag">macOS</span><span class="tag is-grey-lightest">97</span></a></div><div class="control"><a class="tags has-addons" href="/tags/machine-learning/"><span class="tag">machine learning</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/maps/"><span class="tag">maps</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/networking/"><span class="tag">networking</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/node/"><span class="tag">node</span><span class="tag is-grey-lightest">11</span></a></div><div class="control"><a class="tags has-addons" href="/tags/objc/"><span class="tag">objc</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/react/"><span class="tag">react</span><span class="tag is-grey-lightest">14</span></a></div><div class="control"><a class="tags has-addons" href="/tags/react-native/"><span class="tag">react native</span><span class="tag is-grey-lightest">14</span></a></div><div class="control"><a class="tags has-addons" href="/tags/realm/"><span class="tag">realm</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/rx/"><span class="tag">rx</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/script/"><span class="tag">script</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/spm/"><span class="tag">spm</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/swift/"><span class="tag">swift</span><span class="tag is-grey-lightest">270</span></a></div><div class="control"><a class="tags has-addons" href="/tags/swiftUI/"><span class="tag">swiftUI</span><span class="tag is-grey-lightest">50</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tech/"><span class="tag">tech</span><span class="tag is-grey-lightest">15</span></a></div><div class="control"><a class="tags has-addons" href="/tags/terminal/"><span class="tag">terminal</span><span class="tag is-grey-lightest">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/testing/"><span class="tag">testing</span><span class="tag is-grey-lightest">14</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tool/"><span class="tag">tool</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/unity/"><span class="tag">unity</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/voip/"><span class="tag">voip</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/watchOS/"><span class="tag">watchOS</span><span class="tag is-grey-lightest">11</span></a></div><div class="control"><a class="tags has-addons" href="/tags/web/"><span class="tag">web</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/work/"><span class="tag">work</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/wwdc/"><span class="tag">wwdc</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/xcode/"><span class="tag">xcode</span><span class="tag is-grey-lightest">23</span></a></div></div></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Subscribe to Updates</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=c2r59mmt2n5k0o5dt5vv3nq4u4&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="c2r59mmt2n5k0o5dt5vv3nq4u4" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button is-primary" type="submit" value="Subscribe"></div></div></form></div></div></div><div class="card widget"><div class="card-content"><div class="notification is-danger">You need to set <code>client_id</code> and <code>slot_id</code> to show this AD unit. Please set it in <code>_config.yml</code>.</div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/z.png" alt="onmyway133" height="28"></a><p class="size-small"><span>&copy; 2020 Khoa Pham</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/onmyway133"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            site: {
                url: 'https://onmyway133.github.io',
                external_link: {"enable":true,"exclude":[]}
            },
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to Top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>