<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="generator" content="Hexo 4.2.0"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Tag: swift - onmyway133</title><meta description="What you don&amp;#39;t know is what you haven&amp;#39;t learned"><meta property="og:type" content="blog"><meta property="og:title" content="onmyway133"><meta property="og:url" content="https://onmyway133.github.io/"><meta property="og:site_name" content="onmyway133"><meta property="og:description" content="What you don&amp;#39;t know is what you haven&amp;#39;t learned"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://onmyway133.github.io/img/og_image.png"><meta property="article:author" content="Khoa Pham"><meta property="article:tag" content="ios"><meta property="article:tag" content=" android"><meta property="article:tag" content="javascript"><meta property="article:tag" content=" react"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><meta property="twitter:creator" content="@onmyway133"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://onmyway133.github.io"},"headline":"onmyway133","image":["https://onmyway133.github.io/img/og_image.png"],"author":{"@type":"Person","name":"Khoa Pham"},"description":"What you don&#39;t know is what you haven&#39;t learned"}</script><link rel="alternative" href="/atom.xml" title="onmyway133" type="application/atom+xml"><link rel="icon" href="/img/favicon.ico"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=UA-40119591-5" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'UA-40119591-5');</script><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><script data-ad-client="ca-pub-3656459401405265" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" async></script></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/z.png" alt="onmyway133" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/apps">Apps</a><a class="navbar-item" href="/gumroad">Gumroad</a><a class="navbar-item" href="/about">About</a><a class="navbar-item" href="/opensource">Open Source</a><a class="navbar-item" href="/writing">Writing</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/speaking">Speaking</a><a class="navbar-item" href="/news">News</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/onmyway133"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/tags">Tags</a></li><li class="is-active"><a href="#" aria-current="page">swift</a></li></ul></nav></div></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-04-08T08:40:12.000Z" title="2019-04-08T08:40:12.000Z">2019-04-08</time><span class="level-item">2 minutes read (About 371 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-generate-grpc-protobuf-files/">How to generate grpc protobuf files</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/197">#197</a></strong></p>
<h2 id="protoc"><a href="#protoc" class="headerlink" title="protoc"></a>protoc</h2><p><a href="https://grpc.io/docs/quickstart/go.html">https://grpc.io/docs/quickstart/go.html</a></p>
<blockquote>
<p>Install the protoc compiler that is used to generate gRPC service code. The simplest way to do this is to download pre-compiled binaries for your platform(protoc-<version>-<platform>.zip) from here: <a href="https://github.com/google/protobuf/releases">https://github.com/google/protobuf/releases</a></p>
</blockquote>
<blockquote>
<p>Unzip this file.<br>Update the environment variable PATH to include the path to the protoc binary file.</p>
</blockquote>
<h2 id="Go-protoc-plugin"><a href="#Go-protoc-plugin" class="headerlink" title="Go protoc plugin"></a>Go protoc plugin</h2><p><a href="https://github.com/golang/protobuf">https://github.com/golang/protobuf</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">go get -u github.com/golang/protobuf/protoc-gen-go</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$GOPATH</span>/bin</span><br><span class="line"><span class="built_in">source</span> ~/.zshrc</span><br></pre></td></tr></table></figure>


<h2 id="Swift-protoc-plugin"><a href="#Swift-protoc-plugin" class="headerlink" title="Swift protoc plugin"></a>Swift protoc plugin</h2><p><a href="https://github.com/grpc/grpc-swift">https://github.com/grpc/grpc-swift</a></p>
<blockquote>
<p>The recommended way to use Swift gRPC is to first define an API using the<br><a href="https://developers.google.com/protocol-buffers/">Protocol Buffer</a><br>language and then use the<br><a href="https://github.com/google/protobuf">Protocol Buffer Compiler</a><br>and the <a href="https://github.com/apple/swift-protobuf">Swift Protobuf</a><br>and <a href="https://github.com/grpc/grpc-swift">Swift gRPC</a> plugins to<br>generate the necessary support code.</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/grpc/grpc-swift.git</span><br><span class="line"><span class="built_in">cd</span> grpc-swift</span><br><span class="line">make</span><br><span class="line">sudo cp protoc-gen-swift protoc-gen-swiftgrpc /usr/<span class="built_in">local</span>/bin</span><br></pre></td></tr></table></figure>

<h2 id="Generate"><a href="#Generate" class="headerlink" title="Generate"></a>Generate</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">protoc --swift_out=MyApp/Api --swiftgrpc_out=Client=<span class="literal">true</span>,Server=<span class="literal">false</span>:MyApp/Api --go_out=plugins=grpc:server/api api.proto</span><br></pre></td></tr></table></figure>

<p>In case we need to cd</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd MyApp&#x2F;Library&#x2F;Models&#x2F;Proto</span><br><span class="line"></span><br><span class="line">protoc --swift_out&#x3D;..&#x2F;Generated --swiftgrpc_out&#x3D;Client&#x3D;true,Server&#x3D;false:..&#x2F;Generated api.proto</span><br></pre></td></tr></table></figure>

<h3 id="Empty"><a href="#Empty" class="headerlink" title="Empty"></a>Empty</h3><p>If remote import is needed, then the workaround is to download the that proto locally, for example empty.proto <a href="https://github.com/protocolbuffers/protobuf/blob/master/src/google/protobuf/empty.proto">https://github.com/protocolbuffers/protobuf/blob/master/src/google/protobuf/empty.proto</a></p>
<p>Inside SwiftProtobuf pod, there is generated <code>empty.pb.swift</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">Google_Protobuf_Empty</span> </span>&#123;</span><br><span class="line">  <span class="comment">// SwiftProtobuf.Message conformance is added in an extension below. See the</span></span><br><span class="line">  <span class="comment">// `Message` and `Message+*Additions` files in the SwiftProtobuf library for</span></span><br><span class="line">  <span class="comment">// methods supported on all messages.</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">var</span> unknownFields = <span class="type">SwiftProtobuf</span>.<span class="type">UnknownStorage</span>()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">init</span>() &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>To consume, we can </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftProtobuf</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> empty = <span class="type">Google_Protobuf_Empty</span>()</span><br></pre></td></tr></table></figure>

<h3 id="oneof-mode"><a href="#oneof-mode" class="headerlink" title="oneof mode"></a>oneof mode</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">message Person &#123;</span><br><span class="line">  oneof mode &#123;</span><br><span class="line">    Human human &#x3D; 1;</span><br><span class="line">    Superman superman &#x3D; 2;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Cannot convert value of type ‘Server_Person.OneOf_Mode’ to expected argument type ‘Server_Human’</p>
</blockquote>
<p>Need to assign the mode</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> person = <span class="type">Person</span>()</span><br><span class="line">person.mode = <span class="type">Person</span>.<span class="type">OneOf_Mode</span>.<span class="type">Human</span>()</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-04-05T08:03:48.000Z" title="2019-04-05T08:03:48.000Z">2019-04-05</time><span class="level-item">8 minutes read (About 1222 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-build-a-networking-in-Swift/">How to build a networking in Swift</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/195">#195</a></strong></p>
<h2 id="Miami"><a href="#Miami" class="headerlink" title="Miami"></a>Miami</h2><ul>
<li><a href="https://github.com/onmyway133/Miami">https://github.com/onmyway133/Miami</a> </li>
<li>Future based builders</li>
<li>Should not wrap system API</li>
<li><code>URLSession</code> offer tons of thing that it’s hard to use with wrappers like Alamofire</li>
</ul>
<h2 id="Concerns"><a href="#Concerns" class="headerlink" title="Concerns"></a>Concerns</h2><h3 id="Parameter-encoding-is-confusing"><a href="#Parameter-encoding-is-confusing" class="headerlink" title="Parameter encoding is confusing"></a>Parameter encoding is confusing</h3><p>-<a href="https://github.com/Alamofire/Alamofire/blob/master/Documentation/Usage.md#parameter-encoding">https://github.com/Alamofire/Alamofire/blob/master/Documentation/Usage.md#parameter-encoding</a></p>
<h3 id="Query-and-body-builder"><a href="#Query-and-body-builder" class="headerlink" title="Query and body builder"></a>Query and body builder</h3><ul>
<li><a href="https://dev.to/sidthesloth92/understanding-html-form-encoding-url-encoded-and-multipart-forms-3lpa">Understanding HTML Form Encoding: URL Encoded and Multipart Forms</a></li>
<li><a href="https://stackoverflow.com/questions/14551194/how-are-parameters-sent-in-an-http-post-request">https://stackoverflow.com/questions/14551194/how-are-parameters-sent-in-an-http-post-request</a></li>
<li><a href="https://stackoverflow.com/questions/1617058/ok-to-skip-slash-before-query-string">https://stackoverflow.com/questions/1617058/ok-to-skip-slash-before-query-string</a></li>
<li><a href="https://stackoverflow.com/questions/3508338/what-is-the-boundary-in-multipart-form-data">https://stackoverflow.com/questions/3508338/what-is-the-boundary-in-multipart-form-data</a></li>
<li><a href="https://github.com/onmyway133/blog/issues/193">How to construct URL with URLComponents and appendPathComponent in Swift</a></li>
</ul>
<h3 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h3><ul>
<li><a href="https://github.com/onmyway133/blog/issues/115">Case sensitivity in HTTP</a></li>
</ul>
<h3 id="Lazy-execution"><a href="#Lazy-execution" class="headerlink" title="Lazy execution"></a>Lazy execution</h3><ul>
<li>Promise <a href="https://github.com/onmyway133/Then">https://github.com/onmyway133/Then</a></li>
<li>Signal and Future <a href="https://github.com/onmyway133/archives/tree/master/Signal">https://github.com/onmyway133/archives/tree/master/Signal</a></li>
</ul>
<h3 id="Catch-error"><a href="#Catch-error" class="headerlink" title="Catch error"></a>Catch error</h3><ul>
<li><a href="https://github.com/onmyway133/blog/issues/192">How to catch error in ApolloClient</a></li>
</ul>
<h3 id="Implementation"><a href="#Implementation" class="headerlink" title="Implementation"></a>Implementation</h3><ul>
<li><a href="https://github.com/onmyway133/blog/issues/194">How to cancel DispatchWorkItem and NSOperation</a></li>
<li><a href="https://swiftrocks.com/understanding-dispatchqueues.html">Understanding DispatchQueues</a></li>
</ul>
<h2 id="Use-Promise-to-handle-chain-and-error"><a href="#Use-Promise-to-handle-chain-and-error" class="headerlink" title="Use Promise to handle chain and error"></a>Use Promise to handle chain and error</h2><p><a href="https://github.com/onmyway133/Miami/blob/master/Sources/Shared/Future/Future.swift">https://github.com/onmyway133/Miami/blob/master/Sources/Shared/Future/Future.swift</a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Token</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">let</span> lock = <span class="type">NSRecursiveLock</span>()</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> _isCancelled = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> callbacks: [() -&gt; <span class="type">Void</span>] = []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">init</span>() &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">isCancelled</span><span class="params">()</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> lock.whenLock &#123;</span><br><span class="line">            <span class="keyword">return</span> _isCancelled</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">cancel</span><span class="params">()</span></span> &#123;</span><br><span class="line">        lock.whenLock &#123;</span><br><span class="line">            <span class="keyword">guard</span> <span class="keyword">self</span>._isCancelled == <span class="literal">false</span> <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">self</span>._isCancelled = <span class="literal">true</span></span><br><span class="line">            <span class="keyword">self</span>.callbacks.forEach &#123; $<span class="number">0</span>() &#125;</span><br><span class="line">            <span class="keyword">self</span>.callbacks.removeAll()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">onCancel</span><span class="params">(<span class="number">_</span> callback: @escaping <span class="params">()</span></span></span> -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">        lock.whenLock &#123;</span><br><span class="line">            <span class="keyword">self</span>.callbacks.append(callback)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Resolver</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">let</span> queue: <span class="type">DispatchQueue</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">let</span> token: <span class="type">Token</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> callback: (<span class="type">Result</span>&lt;<span class="type">T</span>, <span class="type">Error</span>&gt;) -&gt; <span class="type">Void</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">init</span>(queue: <span class="type">DispatchQueue</span>, token: <span class="type">Token</span>, callback: @escaping (<span class="type">Result</span>&lt;<span class="type">T</span>, <span class="type">Error</span>&gt;) -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.queue = queue</span><br><span class="line">        <span class="keyword">self</span>.token = token</span><br><span class="line">        <span class="keyword">self</span>.callback = callback</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">complete</span><span class="params">(value: T)</span></span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.handle(result: .success(value))</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">fail</span><span class="params">(error: Error)</span></span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.handle(result: .failure(error))</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">handle</span><span class="params">(result: Result&lt;T, Error&gt;)</span></span> &#123;</span><br><span class="line">        queue.async &#123;</span><br><span class="line">            <span class="keyword">self</span>.callback(result)</span><br><span class="line">            <span class="keyword">self</span>.callback = &#123; <span class="number">_</span> <span class="keyword">in</span> &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Future</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">let</span> work: (<span class="type">Resolver</span>&lt;<span class="type">T</span>&gt;) -&gt; <span class="type">Void</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">init</span>(work: @escaping (<span class="type">Resolver</span>&lt;<span class="type">T</span>&gt;) -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.work = work</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">fail</span><span class="params">(error: Error)</span></span> -&gt; <span class="type">Future</span>&lt;<span class="type">T</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Future</span>&lt;<span class="type">T</span>&gt;.result(.failure(error))</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">complete</span><span class="params">(value: T)</span></span> -&gt; <span class="type">Future</span>&lt;<span class="type">T</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> .result(.success(value))</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">result</span><span class="params">(<span class="number">_</span> result: Result&lt;T, Error&gt;)</span></span> -&gt; <span class="type">Future</span>&lt;<span class="type">T</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Future</span>&lt;<span class="type">T</span>&gt;(work: &#123; resolver <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">switch</span> result &#123;</span><br><span class="line">            <span class="keyword">case</span> .success(<span class="keyword">let</span> value):</span><br><span class="line">                resolver.complete(value: value)</span><br><span class="line">            <span class="keyword">case</span> .failure(<span class="keyword">let</span> error):</span><br><span class="line">                resolver.fail(error: error)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">run</span><span class="params">(queue: DispatchQueue = .serial<span class="params">()</span></span></span>, token: <span class="type">Token</span> = <span class="type">Token</span>(), completion: @escaping (<span class="type">Result</span>&lt;<span class="type">T</span>, <span class="type">Error</span>&gt;) -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">        queue.async &#123;</span><br><span class="line">            <span class="keyword">if</span> (token.isCancelled()) &#123;</span><br><span class="line">                completion(.failure(<span class="type">NetworkError</span>.cancelled))</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">let</span> resolver = <span class="type">Resolver</span>&lt;<span class="type">T</span>&gt;(queue: queue, token: token, callback: completion)</span><br><span class="line">            <span class="keyword">self</span>.work(resolver)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">map</span>&lt;U&gt;<span class="params">(transform: @escaping <span class="params">(T)</span></span></span> -&gt; <span class="type">U</span>) -&gt; <span class="type">Future</span>&lt;<span class="type">U</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Future</span>&lt;<span class="type">U</span>&gt;(work: &#123; resolver <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">self</span>.run(queue: resolver.queue, token: resolver.token, completion: &#123; result <span class="keyword">in</span></span><br><span class="line">                resolver.handle(result: result.<span class="built_in">map</span>(transform))</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">flatMap</span>&lt;U&gt;<span class="params">(transform: @escaping <span class="params">(T)</span></span></span> -&gt; <span class="type">Future</span>&lt;<span class="type">U</span>&gt;) -&gt; <span class="type">Future</span>&lt;<span class="type">U</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Future</span>&lt;<span class="type">U</span>&gt;(work: &#123; resolver <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">self</span>.run(queue: resolver.queue, token: resolver.token, completion: &#123; result <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">switch</span> result &#123;</span><br><span class="line">                <span class="keyword">case</span> .success(<span class="keyword">let</span> value):</span><br><span class="line">                    <span class="keyword">let</span> future = transform(value)</span><br><span class="line">                    future.run(queue: resolver.queue, token: resolver.token, completion: &#123; newResult <span class="keyword">in</span></span><br><span class="line">                        resolver.handle(result: newResult)</span><br><span class="line">                    &#125;)</span><br><span class="line">                <span class="keyword">case</span> .failure(<span class="keyword">let</span> error):</span><br><span class="line">                    resolver.fail(error: error)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">catchError</span><span class="params">(transform: @escaping <span class="params">(Error)</span></span></span> -&gt; <span class="type">Future</span>&lt;<span class="type">T</span>&gt;) -&gt; <span class="type">Future</span>&lt;<span class="type">T</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Future</span>&lt;<span class="type">T</span>&gt;(work: &#123; resolver <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">self</span>.run(queue: resolver.queue, token: resolver.token, completion: &#123; result <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">switch</span> result &#123;</span><br><span class="line">                <span class="keyword">case</span> .success(<span class="keyword">let</span> value):</span><br><span class="line">                    resolver.complete(value: value)</span><br><span class="line">                <span class="keyword">case</span> .failure(<span class="keyword">let</span> error):</span><br><span class="line">                    <span class="keyword">let</span> future = transform(error)</span><br><span class="line">                    future.run(queue: resolver.queue, token: resolver.token, completion: &#123; newResult <span class="keyword">in</span></span><br><span class="line">                        resolver.handle(result: newResult)</span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">delay</span><span class="params">(seconds: TimeInterval)</span></span> -&gt; <span class="type">Future</span>&lt;<span class="type">T</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Future</span>&lt;<span class="type">T</span>&gt;(work: &#123; resolver <span class="keyword">in</span></span><br><span class="line">            resolver.queue.asyncAfter(deadline: <span class="type">DispatchTime</span>.now() + seconds, execute: &#123;</span><br><span class="line">                <span class="keyword">self</span>.run(queue: resolver.queue, token: resolver.token, completion: &#123; result <span class="keyword">in</span></span><br><span class="line">                    resolver.handle(result: result)</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">log</span><span class="params">(closure: @escaping <span class="params">(Result&lt;T, Error&gt;)</span></span></span> -&gt; <span class="type">Void</span>) -&gt; <span class="type">Future</span>&lt;<span class="type">T</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Future</span>&lt;<span class="type">T</span>&gt;(work: &#123; resolver <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">self</span>.run(queue: resolver.queue, token: resolver.token, completion: &#123; result <span class="keyword">in</span></span><br><span class="line">                closure(result)</span><br><span class="line">                resolver.handle(result: result)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">sequence</span><span class="params">(futures: [Future&lt;T&gt;])</span></span> -&gt; <span class="type">Future</span>&lt;<span class="type">Sequence</span>&lt;<span class="type">T</span>&gt;&gt; &#123;</span><br><span class="line">        <span class="keyword">var</span> index = <span class="number">0</span></span><br><span class="line">        <span class="keyword">var</span> values = [<span class="type">T</span>]()</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">func</span> <span class="title">runNext</span><span class="params">(resolver: Resolver&lt;Sequence&lt;T&gt;&gt;)</span></span> &#123;</span><br><span class="line">            <span class="keyword">guard</span> index &lt; futures.<span class="built_in">count</span> <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">let</span> sequence = <span class="type">Sequence</span>(values: values)</span><br><span class="line">                resolver.complete(value: sequence)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">let</span> future = futures[index]</span><br><span class="line">            index += <span class="number">1</span></span><br><span class="line">            </span><br><span class="line">            future.run(queue: resolver.queue, token: resolver.token, completion: &#123; result <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">switch</span> result &#123;</span><br><span class="line">                <span class="keyword">case</span> .success(<span class="keyword">let</span> value):</span><br><span class="line">                    values.append(value)</span><br><span class="line">                    runNext(resolver: resolver)</span><br><span class="line">                <span class="keyword">case</span> .failure(<span class="keyword">let</span> error):</span><br><span class="line">                    resolver.fail(error: error)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="type">Future</span>&lt;<span class="type">Sequence</span>&lt;<span class="type">T</span>&gt;&gt;(work: runNext)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">NSLocking</span> </span>&#123;</span><br><span class="line">    @inline(__always)</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">whenLock</span>&lt;T&gt;<span class="params">(<span class="number">_</span> closure: <span class="params">()</span></span></span> <span class="keyword">throws</span> -&gt; <span class="type">T</span>) <span class="keyword">rethrows</span> -&gt; <span class="type">T</span> &#123;</span><br><span class="line">        lock()</span><br><span class="line">        <span class="keyword">defer</span> &#123; unlock() &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">try</span> closure()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @inline(__always)</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">whenLock</span><span class="params">(<span class="number">_</span> closure: <span class="params">()</span></span></span> <span class="keyword">throws</span> -&gt; <span class="type">Void</span>) <span class="keyword">rethrows</span> &#123;</span><br><span class="line">        lock()</span><br><span class="line">        <span class="keyword">defer</span> &#123; unlock() &#125;</span><br><span class="line">        <span class="keyword">try</span> closure()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Query-builder-to-build-query"><a href="#Query-builder-to-build-query" class="headerlink" title="Query builder to build query"></a>Query builder to build query</h2><ul>
<li><a href="https://github.com/onmyway133/Miami/blob/master/Sources/Shared/Builder/QueryBuilder.swift">https://github.com/onmyway133/Miami/blob/master/Sources/Shared/Builder/QueryBuilder.swift</a></li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">protocol</span> <span class="title">QueryBuilder</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">build</span><span class="params">()</span></span> -&gt; [<span class="type">URLQueryItem</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DefaultQueryBuilder</span>: <span class="title">QueryBuilder</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">let</span> parameters: <span class="type">JSONDictionary</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">init</span>(parameters: <span class="type">JSONDictionary</span> = [:]) &#123;</span><br><span class="line">        <span class="keyword">self</span>.parameters = parameters</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">build</span><span class="params">()</span></span> -&gt; [<span class="type">URLQueryItem</span>] &#123;</span><br><span class="line">        <span class="keyword">var</span> components = <span class="type">URLComponents</span>()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> parser = <span class="type">ParameterParser</span>()</span><br><span class="line">        <span class="keyword">let</span> pairs = parser</span><br><span class="line">            .parse(parameters: parameters)</span><br><span class="line">            .<span class="built_in">map</span>(&#123; $<span class="number">0</span> &#125;)</span><br><span class="line">            .sorted(by: &lt;)</span><br><span class="line">        </span><br><span class="line">        components.queryItems = pairs.<span class="built_in">map</span>(&#123; key, value <span class="keyword">in</span></span><br><span class="line">            <span class="type">URLQueryItem</span>(name: key, value: value)</span><br><span class="line">        &#125;)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> components.queryItems ?? []</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">build</span><span class="params">(queryItems: [URLQueryItem])</span></span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> components = <span class="type">URLComponents</span>()</span><br><span class="line">        components.queryItems = queryItems.<span class="built_in">map</span>(&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="type">URLQueryItem</span>(name: escape($<span class="number">0</span>.name), value: escape($<span class="number">0</span>.value ?? <span class="string">""</span>))</span><br><span class="line">        &#125;)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> components.query ?? <span class="string">""</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">escape</span><span class="params">(<span class="number">_</span> string: String)</span></span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> string.addingPercentEncoding(withAllowedCharacters: .urlQueryAllowed) ?? <span class="string">""</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Body-builder-to-build-body"><a href="#Body-builder-to-build-body" class="headerlink" title="Body builder to build body"></a>Body builder to build body</h2><ul>
<li><a href="https://github.com/onmyway133/Miami/blob/master/Sources/Shared/Builder/JsonBodyBuilder.swift">https://github.com/onmyway133/Miami/blob/master/Sources/Shared/Builder/JsonBodyBuilder.swift</a></li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JsonBodyBuilder</span>: <span class="title">BodyBuilder</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">let</span> parameters: <span class="type">JSONDictionary</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">init</span>(parameters: <span class="type">JSONDictionary</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.parameters = parameters</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">build</span><span class="params">()</span></span> -&gt; <span class="type">ForBody?</span> &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> data = <span class="keyword">try</span>? <span class="type">JSONSerialization</span>.data(</span><br><span class="line">            withJSONObject: parameters,</span><br><span class="line">            options: <span class="type">JSONSerialization</span>.<span class="type">WritingOptions</span>()</span><br><span class="line">        ) <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="type">ForBody</span>(body: data, headers: [</span><br><span class="line">            <span class="type">Header</span>.contentType.rawValue: <span class="string">"application/json"</span></span><br><span class="line">        ])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Make-request-with-networking"><a href="#Make-request-with-networking" class="headerlink" title="Make request with networking"></a>Make request with networking</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Networking</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">let</span> session: <span class="type">URLSession</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">let</span> mockManager = <span class="type">MockManager</span>()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> before: (<span class="type">URLRequest</span>) -&gt; <span class="type">URLRequest</span> = &#123; $<span class="number">0</span> &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> catchError: (<span class="type">Error</span>) -&gt; <span class="type">Future</span>&lt;<span class="type">Response</span>&gt; = &#123; error <span class="keyword">in</span> <span class="type">Future</span>.fail(error: error) &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> validate: (<span class="type">Response</span>) -&gt; <span class="type">Future</span>&lt;<span class="type">Response</span>&gt; = &#123; <span class="type">Future</span>.complete(value: $<span class="number">0</span>) &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> logResponse: (<span class="type">Result</span>&lt;<span class="type">Response</span>, <span class="type">Error</span>&gt;) -&gt; <span class="type">Void</span> = &#123; <span class="number">_</span> <span class="keyword">in</span> &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">init</span>(session: <span class="type">URLSession</span> = .shared) &#123;</span><br><span class="line">        <span class="keyword">self</span>.session = session</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">make</span><span class="params">(options: Options, baseUrl: URL)</span></span> -&gt; <span class="type">Future</span>&lt;<span class="type">Response</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">let</span> builder = <span class="type">UrlRequestBuilder</span>()</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> request = <span class="keyword">try</span> builder.build(options: options, baseUrl: baseUrl)</span><br><span class="line">            <span class="keyword">return</span> make(request: request)</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="type">Future</span>&lt;<span class="type">Response</span>&gt;.fail(error: error)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">make</span><span class="params">(request: URLRequest)</span></span> -&gt; <span class="type">Future</span>&lt;<span class="type">Response</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> mock = mockManager.findMock(request: request) &#123;</span><br><span class="line">            <span class="keyword">return</span> mock.future.<span class="built_in">map</span>(transform: &#123; <span class="type">Response</span>(data: $<span class="number">0</span>, urlResponse: <span class="type">URLResponse</span>()) &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> future = <span class="type">Future</span>&lt;<span class="type">Response</span>&gt;(work: &#123; resolver <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">let</span> task = <span class="keyword">self</span>.session.dataTask(with: request, completionHandler: &#123; data, response, error <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">let</span> data = data, <span class="keyword">let</span> urlResponse = response &#123;</span><br><span class="line">                    resolver.complete(value: <span class="type">Response</span>(data: data, urlResponse: urlResponse))</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> <span class="keyword">let</span> error = error &#123;</span><br><span class="line">                    resolver.fail(error: <span class="type">NetworkError</span>.urlSession(error, response))</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    resolver.fail(error: <span class="type">NetworkError</span>.unknownError)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            </span><br><span class="line">            resolver.token.onCancel &#123;</span><br><span class="line">                task.cancel()</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            task.resume()</span><br><span class="line">        &#125;)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> future</span><br><span class="line">            .catchError(transform: <span class="keyword">self</span>.catchError)</span><br><span class="line">            .flatMap(transform: <span class="keyword">self</span>.validate)</span><br><span class="line">            .log(closure: <span class="keyword">self</span>.logResponse)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Mock-a-request"><a href="#Mock-a-request" class="headerlink" title="Mock a request"></a>Mock a request</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Mock</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">let</span> options: <span class="type">Options</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">let</span> future: <span class="type">Future</span>&lt;<span class="type">Data</span>&gt;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">init</span>(options: <span class="type">Options</span>, future: <span class="type">Future</span>&lt;<span class="type">Data</span>&gt;) &#123;</span><br><span class="line">        <span class="keyword">self</span>.options = options</span><br><span class="line">        <span class="keyword">self</span>.future = future</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">on</span><span class="params">(options: Options, data: Data)</span></span> -&gt; <span class="type">Mock</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Mock</span>(options: options, future: <span class="type">Future</span>.complete(value: data))</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">on</span><span class="params">(options: Options, error: Error)</span></span> -&gt; <span class="type">Mock</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Mock</span>(options: options, future: <span class="type">Future</span>.fail(error: error))</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">on</span><span class="params">(options: Options, file: String, fileExtension: String, bundle: Bundle = Bundle.main)</span></span> -&gt; <span class="type">Mock</span> &#123;</span><br><span class="line">        <span class="keyword">guard</span></span><br><span class="line">            <span class="keyword">let</span> url = bundle.url(forResource: file, withExtension: fileExtension),</span><br><span class="line">            <span class="keyword">let</span> data = <span class="keyword">try</span>? <span class="type">Data</span>(contentsOf: url)</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> .on(options: options, error: <span class="type">NetworkError</span>.invalidMock)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> .on(options: options, data: data)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-04-03T06:50:01.000Z" title="2019-04-03T06:50:01.000Z">2019-04-03</time><span class="level-item">a few seconds read (About 78 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-cancel-DispatchWorkItem-and-NSOperation/">How to cancel DispatchWorkItem and NSOperation</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/194">#194</a></strong></p>
<h3 id="DispatchWorkItem"><a href="#DispatchWorkItem" class="headerlink" title="DispatchWorkItem"></a><code>DispatchWorkItem</code></h3><ul>
<li><a href="https://stackoverflow.com/questions/48844169/swift-ios-dispatchworkitem-is-still-running-even-though-its-getting-cancelled">https://stackoverflow.com/questions/48844169/swift-ios-dispatchworkitem-is-still-running-even-though-its-getting-cancelled</a></li>
<li><a href="https://stackoverflow.com/questions/29492707/how-to-stop-cancel-suspend-resume-tasks-on-gcd-queue">https://stackoverflow.com/questions/29492707/how-to-stop-cancel-suspend-resume-tasks-on-gcd-queue</a></li>
</ul>
<h3 id="NSOperation"><a href="#NSOperation" class="headerlink" title="NSOperation"></a><code>NSOperation</code></h3><ul>
<li><a href="https://developer.apple.com/documentation/foundation/nsoperation/1411672-cancel?language=objc">https://developer.apple.com/documentation/foundation/nsoperation/1411672-cancel?language=objc</a></li>
</ul>
<h3 id="Grand-Central-Dispatch-vs-NSOperation"><a href="#Grand-Central-Dispatch-vs-NSOperation" class="headerlink" title="Grand Central Dispatch vs NSOperation"></a>Grand Central Dispatch vs NSOperation</h3><ul>
<li><a href="https://stackoverflow.com/questions/43226434/2017-swift-3-1-gcd-vs-nsoperation">https://stackoverflow.com/questions/43226434/2017-swift-3-1-gcd-vs-nsoperation</a></li>
<li><a href="https://medium.com/@johnsundell/a-deep-dive-into-grand-central-dispatch-in-swift-dead7f6e1ca7">https://medium.com/@johnsundell/a-deep-dive-into-grand-central-dispatch-in-swift-dead7f6e1ca7</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-03-29T10:32:29.000Z" title="2019-03-29T10:32:29.000Z">2019-03-29</time><span class="level-item">a few seconds read (About 67 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-construct-URL-with-URLComponents-and-appendPathComponent-in-Swift/">How to construct URL with URLComponents and appendPathComponent in Swift</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/193">#193</a></strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> components = <span class="type">URLComponents</span>(string: <span class="string">"https://google.com/"</span>)</span><br><span class="line">components?.path = <span class="string">"abc/"</span></span><br><span class="line">components?.url</span><br></pre></td></tr></table></figure>

<p>-&gt; nil</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> components = <span class="type">URLComponents</span>(string: <span class="string">"https://google.com/"</span>)</span><br><span class="line">components?.path = <span class="string">"/abc/"</span></span><br><span class="line">components?.url</span><br><span class="line">components?.queryItems = [<span class="type">URLQueryItem</span>(name: <span class="string">"q"</span>, value: <span class="string">"pokemon"</span>)]</span><br></pre></td></tr></table></figure>

<p>-&gt; <code>https://google.com/abc/?q=pokemon</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> url = <span class="type">URL</span>(string: <span class="string">"https://google.com/"</span>)</span><br><span class="line">url?.appendPathComponent(<span class="string">"/abc?q=pokemon"</span>)</span><br><span class="line">url</span><br></pre></td></tr></table></figure>

<p>-&gt; <code>https://google.com//abc%3Fq=pokemon</code></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-03-24T20:08:27.000Z" title="2019-03-24T20:08:27.000Z">2019-03-24</time><span class="level-item">8 minutes read (About 1130 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/Curry-in-Swift-and-Javascript/">Curry in Swift and Javascript</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/185">#185</a></strong></p>
<p>You may encounter curry in everyday code without knowing it. Here is a bit of my reflections on curry and how to apply it in Javascript and Swift.</p>
<h2 id="Taking-one-parameter-in-Haskell"><a href="#Taking-one-parameter-in-Haskell" class="headerlink" title="Taking one parameter in Haskell"></a>Taking one parameter in Haskell</h2><p>In Haskell, all function officially takes only 1 parameter. Function with many parameters are just curried, which means they will be partially applied. Calling sum 1 just returns a function with 1 parameter, then 2is passed into this function. The following 2 function calls are the same.</p>
<pre><code>ghci&gt; sum 1 2
3 
ghci&gt; (max 1) 2
3</code></pre><p>I tend to think of curried function or partially applied function as something that carry dependencies at each application step. Each curried function can be assigned to variable or pass around, or as returned value.</p>
<h2 id="Curry-in-Swift-for-predicate"><a href="#Curry-in-Swift-for-predicate" class="headerlink" title="Curry in Swift for predicate"></a>Curry in Swift for predicate</h2><p>When I was trying to make my own <a href="https://github.com/onmyway133/archives/tree/master/Signal">Signal</a> library, I have</p>
<iframe src="https://medium.com/media/f61aae80ae0b6410d6844dbfd961d01e" frameborder=0></iframe>

<p>and Event</p>
<iframe src="https://medium.com/media/4a05bf4ba2a71d096c2ef87a3cd57ec8" frameborder=0></iframe>

<h3 id="filter"><a href="#filter" class="headerlink" title="filter"></a>filter</h3><p>Then there should be a filter for Signal. The idea of filter is that we should update signal if the Event is Next with right filtered value</p>
<pre><code>public func filter(f: T -&gt; Bool) -&gt; Signal&lt;T&gt;{
    let signal = Signal&lt;T&gt;()
    subscribe { result in
        switch(result) {
        case let .Success(value):
            if f(value) {
                signal.update(result)
            }
        case let .Error(error): signal.update(.Error(error))
        }
    }
    return signal
}</code></pre><h3 id="2-parameters"><a href="#2-parameters" class="headerlink" title="2 parameters"></a>2 parameters</h3><p>But having Event as another monad, I think it should be more encapsulated if that switching logic gets moved into the Event. Here the filter takes 2 params</p>
<p>Event.swift</p>
<pre><code>func filter(f: T -&gt; Bool, callback: (Event&lt;T&gt; -&gt; Void)) {
        switch self {
        case let .Next(value) where f(value):
            callback(self)
        case .Failed:
            callback(self)
        default:
            break
    }
}</code></pre><p>Signal.swift</p>
<pre><code>public func filter(f: T -&gt; Bool) -&gt; Signal&lt;T&gt; {
    let signal = Signal&lt;T&gt;()

    subscribe { event in
        event.filter(f, callback: signal.update)
    }

    return signal
}</code></pre><h3 id="Currying"><a href="#Currying" class="headerlink" title="Currying"></a>Currying</h3><p>With currying, we can make filter a more abstract function, and defer the decision to pass the callback param. It is a little carried away but I find it helpful this way</p>
<p>Now filter accepts 1 param, and it returns a function that takes callback as its param</p>
<p>Event.swift</p>
<pre><code>func filter(f: T -&gt; Bool) -&gt; ((Event&lt;T&gt; -&gt; Void) -&gt; Void) {
        return { g in
            switch self {
            case let .Next(value) where f(value):
                g(self)
            case .Failed:
                g(self)
            default:
                break
            }
        }
    }</code></pre><p>Signal.swift</p>
<pre><code>public func filter(f: T -&gt; Bool) -&gt; Signal&lt;T&gt; {
        let signal = Signal&lt;T&gt;()

        subscribe { event in
            event.filter(f)(signal.update)
        }

        return signal
    }</code></pre><h3 id="Curry-syntax-in-Swift-2-and-above"><a href="#Curry-syntax-in-Swift-2-and-above" class="headerlink" title="Curry syntax in Swift 2 and above"></a>Curry syntax in Swift 2 and above</h3><p>Swift 2 supports curry syntax function</p>
<pre><code>func sum(a: Int)(b: Int) -&gt; Int {
    return a + b
}

let sumWith5 = sum(5)
let result = sumWith5(b: 10)</code></pre><p>Unfortunately, the syntactic sugar for declaring curry has been dropped since Swift 3. You may want to find out in <a href="http://ericasadun.com/2015/12/18/bidding-farewell-to-currying/">Bidding farewell to currying</a>. But it’s not a big deal as we can easily create curry function. It is just a function that returns another function.</p>
<h2 id="Using-curry-for-partial-application-in-UIKit"><a href="#Using-curry-for-partial-application-in-UIKit" class="headerlink" title="Using curry for partial application in UIKit"></a>Using curry for partial application in UIKit</h2><p>I used this curry technique in my Xkcd app. See <a href="https://github.com/onmyway133/Xkcd/blob/master/Source/Feature/Main/MainController.swift">MainController.swift</a>. MainController is vanilla UITabBarController with ComicsController and FavoriteController , all embedded in UINavigationViewController .</p>
<p>The feature is that when a comic is selected, a comic detail screen should be pushed on top of the navigation stack. For example in <a href="https://github.com/onmyway133/Xkcd/blob/master/Source/Feature/Comics/ComicsContoller.swift#L20">ComicsController</a></p>
<pre><code>/// Called when a comic is selected  
var selectComic: ((Comic) -&gt; Void)?</code></pre><p>All ComicsController needs to know is to call that selectComic closure with the chosen Comic, and someone should know how to handle that selection. Back to the <a href="https://github.com/onmyway133/Xkcd/blob/master/Source/Feature/Main/MainController.swift">handleFlow</a> function inside MainController.</p>
<pre><code>private func handleFlow() {
  typealias Function = (UINavigationController) -&gt; (Comic) -&gt; Void
  let selectComic: Function = { [weak self] navigationController in
    return { (comic: Comic) in
      guard let self = self else {
        return
      }

  let detailController = self.makeDetail(comic: comic)
      navigationController.pushViewController(detailController, animated: true)
    }
  }

  comicsController.selectComic = selectComic(comicNavigationController)
  favoriteController.selectComic = selectComic(favoriteNavigationController)
}</code></pre><p>I declared Function as typealias to explicitly state the curry function that we are going to build</p>
<pre><code>typealias Function = (UINavigationController) -&gt; (Comic) -&gt; Void</code></pre><p>We build selectComic as curried function, that takes UINavigationViewController and returns a function that takes Comic and returns Void . This way when we partially apply selectComic with the a navigationController , we get another function that has navigationController as dependency, and ready to be assigned to selectComic property in comicsController .</p>
<h2 id="Curry-promised-function-in-Javascript"><a href="#Curry-promised-function-in-Javascript" class="headerlink" title="Curry promised function in Javascript"></a>Curry promised function in Javascript</h2><p>I like to work with Promise and async/await in Javascript. It allows chainable style and easy to reason about. So when working with callbacks in Javascript, for example callback from native modules in React Native, I tend to convert them into Promise.</p>
<p>For example when working with HealthKit, we need to expose a native modules around it</p>
<pre><code>// [@flow](http://twitter.com/flow)

import { NativeModules } from &apos;react-native&apos;

type HealthManagerType = {
  checkAuthorisation: ((string) =&gt; void)) =&gt; void,
  authorise: ((boolean) =&gt; void)) =&gt; void,
  readWorkout: (Date, Date, () =&gt; void)) =&gt; void,
  readDailySummary: (Date, Date, () =&gt; void)) =&gt; void,
  readMeasurement: (Date, Date, () =&gt; void)) =&gt; void
}

const HealthManager: HealthManagerType = NativeModules.HealthManager
export default HealthManager</code></pre><p>We can build a toPromise function that can convert a function with callback into Promise</p>
<pre><code>// [@flow](http://twitter.com/flow)

const toPromise = (f: (any) =&gt; void) =&gt; {
  return new Promise&lt;any&gt;((resolve, reject) =&gt; {
    try {
      f((result) =&gt; {
        resolve(result)
      })
    } catch (e) {
      reject(e)
    }
  })
}

export default toPromise</code></pre><p>However, as you can see in the signature, it only works with a callback of type (any) =&gt; void In other words, this callback must have exactly 1 parameter, because a Promise can either returns a value or throws an error.</p>
<p>To remedy this, we can build a curry function that can turns function with either 1, 2, 3 parameters into curried function. Thanks to the dynamic nature of Javascript, we have</p>
<pre><code>// [@flow](http://twitter.com/flow)

function curry0(f: () =&gt; void) {
  return f()
}

function curry1(f: (any) =&gt; void) {
  return (p1: any) =&gt; {
    return f(p1)
  }
}

function curry2(f: (any, any) =&gt; void) {
  return (p1: any) =&gt; {
    return (p2: any) =&gt; {
      return f(p1, p2)
    }
  }
}

function curry3(f: (any, any, any) =&gt; void) {
  return (p1: any) =&gt; {
    return (p2: any) =&gt; {
      return (p3: any) =&gt; {
        return f(p1, p2, p3)
      }
    }
  }
}

export default {
  curry0,
  curry1,
  curry2,
  curry3
}</code></pre><p>So with a function that have 3 parameters, we can use curry3 to partially apply the first 2 parameters. Then we have a function that accepts just a callback, and this is turned into Promise via toPromise</p>
<pre><code>const readWorkout = curry.curry3(HealthManager.readWorkout)(DateUtils.startDate))(DateUtils.endDate))

const workouts = await toPromise(readWorkout)</code></pre><h2 id="Where-to-go-from-here"><a href="#Where-to-go-from-here" class="headerlink" title="Where to go from here"></a>Where to go from here</h2><p>Here are some of my favorite posts to read more about curry</p>
<ul>
<li><p><a href="http://learnyouahaskell.com/higher-order-functions">Higher order functions</a></p>
</li>
<li><p><a href="https://robots.thoughtbot.com/introduction-to-function-currying-in-swift">Introduction to Function Currying in Swift</a></p>
</li>
<li><p><a href="http://www.russbishop.net/swift-function-currying">Swift Function Currying</a></p>
</li>
<li><p><a href="https://medium.com/@kevincennis/currying-in-javascript-c66080543528">Currying in JavaScript</a>: I like how he uses memory and slice to gradually build more generic curry function</p>
</li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-03-19T07:58:44.000Z" title="2019-03-19T07:58:44.000Z">2019-03-19</time><span class="level-item">a minute read (About 200 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-run-executable-in-macOS/">How to run executable in macOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/176">#176</a></strong></p>
<p>Enable executable</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x executable</span><br></pre></td></tr></table></figure>

<p>Add executable file to target<br>Use <code>Process</code> with correct <code>launchPad</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">TaskDelegate</span>: <span class="title">class</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">task</span><span class="params">(task: Task, didOutput string: String)</span></span></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">taskDidComplete</span><span class="params">(task: Task)</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Task</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">weak</span> <span class="keyword">var</span> delegate: <span class="type">TaskDelegate?</span></span><br><span class="line">  <span class="keyword">let</span> process = <span class="type">Process</span>()</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">run</span><span class="params">(arguments: [String])</span></span> &#123;</span><br><span class="line">    <span class="type">DispatchQueue</span>.background.async &#123;</span><br><span class="line">      <span class="keyword">let</span> launchPath = <span class="type">Bundle</span>.main.path(forResource: <span class="string">"executable"</span>, ofType: <span class="string">""</span>)!</span><br><span class="line">      <span class="keyword">self</span>.run(launchPath: launchPath, arguments: arguments)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">stop</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="type">DispatchQueue</span>.background.async &#123;</span><br><span class="line">      <span class="keyword">if</span> <span class="keyword">self</span>.process.isRunning &#123;</span><br><span class="line">        <span class="keyword">self</span>.process.terminate()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// MARK: - Helper</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">run</span><span class="params">(launchPath: String, arguments: [String])</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> process = <span class="type">Process</span>()</span><br><span class="line">    process.launchPath = launchPath</span><br><span class="line">    process.arguments = arguments</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> stdOut = <span class="type">Pipe</span>()</span><br><span class="line">    process.standardOutput = stdOut</span><br><span class="line">    <span class="keyword">let</span> stdErr = <span class="type">Pipe</span>()</span><br><span class="line">    process.standardError = stdErr</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> handler =  &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] (file: <span class="type">FileHandle!</span>) -&gt; <span class="type">Void</span> <span class="keyword">in</span></span><br><span class="line">      <span class="keyword">let</span> data = file.availableData</span><br><span class="line">      <span class="keyword">guard</span> <span class="keyword">let</span> output = <span class="type">NSString</span>(data: data, encoding: <span class="type">String</span>.<span class="type">Encoding</span>.utf8.rawValue) <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">guard</span> <span class="keyword">let</span> strongSelf = <span class="keyword">self</span>,</span><br><span class="line">        <span class="keyword">let</span> string = output.components(separatedBy: <span class="string">"\n"</span>).first <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="type">DispatchQueue</span>.main.async &#123;</span><br><span class="line">        strongSelf.delegate?.task(task: strongSelf, didOutput: string)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    stdErr.fileHandleForReading.readabilityHandler = handler</span><br><span class="line">    stdOut.fileHandleForReading.readabilityHandler = handler</span><br><span class="line"></span><br><span class="line">    process.terminationHandler = &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] (task: <span class="type">Process?</span>) -&gt; () <span class="keyword">in</span></span><br><span class="line">      stdErr.fileHandleForReading.readabilityHandler = <span class="literal">nil</span></span><br><span class="line">      stdOut.fileHandleForReading.readabilityHandler = <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">guard</span> <span class="keyword">let</span> strongSelf = <span class="keyword">self</span> <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="type">DispatchQueue</span>.main.async &#123;</span><br><span class="line">        strongSelf.delegate?.taskDidComplete(task: strongSelf)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    process.launch()</span><br><span class="line">    process.waitUntilExit()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-03-19T07:56:00.000Z" title="2019-03-19T07:56:00.000Z">2019-03-19</time><span class="level-item">a few seconds read (About 25 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-print-current-directory-using-Process-in-macOS/">How to print current directory using Process in macOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/175">#175</a></strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> process = <span class="type">Process</span>()</span><br><span class="line">process.launchPath = <span class="string">"/bin/pwd"</span></span><br><span class="line">process.arguments = []</span><br></pre></td></tr></table></figure>

<p>Should be the same as <code>FileManager.default.currentDirectoryPath</code></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-03-19T07:05:27.000Z" title="2019-03-19T07:05:27.000Z">2019-03-19</time><span class="level-item">a few seconds read (About 23 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-change-NSTextField-backgroundColor-in-NSPopover/">How to change NSTextField backgroundColor in NSPopover</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/174">#174</a></strong></p>
<p>Disable vibrancy mode of NSPopover</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> popover = <span class="type">NSPopover</span>()</span><br><span class="line">popover.appearance = <span class="type">NSAppearance</span>(named: <span class="type">NSAppearance</span>.<span class="type">Name</span>.aqua)</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-03-18T13:59:00.000Z" title="2019-03-18T13:59:00.000Z">2019-03-18</time><span class="level-item">a minute read (About 126 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-make-scrollable-vertical-NSStackView/">How to make scrollable vertical NSStackView</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/173">#173</a></strong></p>
<p>You might need to flip <code>NSClipView</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> AppKit</span><br><span class="line"><span class="keyword">import</span> Anchors</span><br><span class="line"><span class="keyword">import</span> Omnia</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ScrollableStackView</span>: <span class="title">NSView</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">FlippedClipView</span>: <span class="title">NSClipView</span> </span>&#123;</span><br><span class="line">        <span class="keyword">override</span> <span class="keyword">var</span> isFlipped: <span class="type">Bool</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">init</span>(frame frameRect: <span class="type">NSRect</span>) &#123;</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(frame: frameRect)</span><br><span class="line">        setup()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">init</span>?(coder decoder: <span class="type">NSCoder</span>) &#123;</span><br><span class="line">        <span class="built_in">fatalError</span>()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> stackView: <span class="type">NSStackView</span> = withObject(<span class="type">NSStackView</span>()) &#123;</span><br><span class="line">        $<span class="number">0</span>.orientation = .vertical</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">let</span> scrollView: <span class="type">NSScrollView</span> = <span class="type">NSScrollView</span>()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">setup</span><span class="params">()</span></span> &#123;</span><br><span class="line">        addSubview(scrollView)</span><br><span class="line">        scrollView.hasVerticalScroller = <span class="literal">true</span></span><br><span class="line">        scrollView.drawsBackground = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">        activate(</span><br><span class="line">            scrollView.anchor.edges</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> clipView = <span class="type">FlippedClipView</span>()</span><br><span class="line">        clipView.translatesAutoresizingMaskIntoConstraints = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">        clipView.drawsBackground = <span class="literal">false</span></span><br><span class="line">        scrollView.contentView = clipView</span><br><span class="line"></span><br><span class="line">        activate(</span><br><span class="line">            clipView.anchor.edges.<span class="built_in">equal</span>.to(scrollView.anchor)</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        scrollView.documentView = stackView</span><br><span class="line">        stackView.translatesAutoresizingMaskIntoConstraints = <span class="literal">false</span></span><br><span class="line">        activate(</span><br><span class="line">            clipView.anchor.<span class="keyword">left</span>.top.<span class="keyword">right</span>.<span class="built_in">equal</span>.to(stackView.anchor)</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Read-more"><a href="#Read-more" class="headerlink" title="Read more"></a>Read more</h2><ul>
<li><a href="https://stackoverflow.com/questions/10016475/create-nsscrollview-programmatically-in-an-nsview-cocoa/55219153#55219153">https://stackoverflow.com/questions/10016475/create-nsscrollview-programmatically-in-an-nsview-cocoa/55219153#55219153</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-03-18T13:57:09.000Z" title="2019-03-18T13:57:09.000Z">2019-03-18</time><span class="level-item">a few seconds read (About 30 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-load-top-level-view-from-xib-in-macOS/">How to load top level view from xib in macOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/171">#171</a></strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> views: <span class="type">NSArray?</span></span><br><span class="line"><span class="type">NSNib</span>(nibNamed: <span class="type">NSNib</span>.<span class="type">Name</span>(<span class="string">"ProfileView"</span>), bundle: <span class="literal">nil</span>)?.instantiate(withOwner: <span class="literal">nil</span>, topLevelObjects: &amp;views)</span><br><span class="line"><span class="keyword">let</span> profileView = views!.compactMap(&#123; $<span class="number">0</span> <span class="keyword">as</span>? <span class="type">ProfileView</span> &#125;).first!</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2018-02-27T11:21:02.000Z" title="2018-02-27T11:21:02.000Z">2018-02-27</time><span class="level-item">4 minutes read (About 668 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/UITableViewCell-and-Model/">UITableViewCell and Model</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/154">#154</a></strong></p>
<p>The most common UI element in iOS is <code>UITableView</code>, and the most common task is to display the UITableViewCell using the model.</p>
<p>Although the title specifies UITableViewCell, but the problem involves other views (UICollectionView, custom view, …) as well</p>
<p>There are many debates about this, so here I want to make a summary, all in my opinion</p>
<h3 id="It-started-with"><a href="#It-started-with" class="headerlink" title="It started with"></a>It started with</h3><p><a href="http://inessential.com/2012/12/31/uitableviewcell_is_not_a_controller">UITableViewCell Is Not a Controller</a><br>This article follows strict MVC and states we should not pass model object to cell and let cell manipulate directly on the model. He shows several examples that point out this job is not suitable for the cell. Instead this job should be done on the Controller (UIViewController, UITableViewDataSource, …)</p>
<h3 id="Category-for-simple-case"><a href="#Category-for-simple-case" class="headerlink" title="Category for simple case"></a>Category for simple case</h3><p><a href="http://www.sebastianrehnby.com/blog/2013/01/01/skinnier-controllers-using-view-categories/">Skinnier Controllers Using View Categories</a><br>This article states that we should keep ViewController skinnier by transfering the job (mapping model object to cell) to the cell category</p>
<h3 id="Using-subclassing"><a href="#Using-subclassing" class="headerlink" title="Using subclassing"></a>Using subclassing</h3><p><a href="http://corporationunknown.com/blog/2013/01/01/uitableviewcell-is-not-a-controller-but/">UITableViewCell Is Not a Controller, But…</a><br>This articles explains the beauty of subclassing to take advantage of Polymorphism. In the theming example he gives, we see that Controller ‘s job now is to select the correct cell subclass, and the subclass ‘s job is to know how to use the model<br>“When a UITableViewCell subclass accepts a model object parameter and updates its constituent subviews as I have described, it is behaving as a data transformer, not a controller”</p>
<h3 id="Model-Presenter"><a href="#Model-Presenter" class="headerlink" title="Model Presenter"></a>Model Presenter</h3><p><a href="https://medium.com/ios-apprentice/model-view-controller-presenter-8bb4149fa5ef">Model View Controller Presenter</a><br>This article shows that using subclassing and category will have duplication implementation when you have more cells and models. After several optimizations, he finally gets to the Model Presenter, which is the center object who knows how to represent the model in different view.<br>“This is an object that knows how to represent every aspect of a certain model”</p>
<h4 id="MVVM"><a href="#MVVM" class="headerlink" title="MVVM"></a>MVVM</h4><p><a href="http://cocoamanifest.net/articles/2013/10/mvc-mvvm-frp-and-building-bridges.html">MVC, MVVM, FRP, And Building Bridges</a><br>This article explains MVVM but it touches our problem directly. The problem with cell and model actually is</p>
<ol>
<li>How to map the model to the cell</li>
<li>Who will do this job? The cell, Controller or another Model Mapping object ?</li>
</ol>
<p>The ViewModel is actually who does this work, which is to transform the model to something the view can easily use</p>
<p>“A table view data source is none of these things. It’s purely a layer between the table view and the model. The model defines lists of things, but the table view data source transform those lists into sections and rows. It also returns the actual table view cells, but that’s not what I’m focusing on here. The key is its role as a middle-tier data transformer.”</p>
<h3 id="Do-we-access-the-cell-‘s-subviews"><a href="#Do-we-access-the-cell-‘s-subviews" class="headerlink" title="Do we access the cell ‘s subviews"></a>Do we access the cell ‘s subviews</h3><p><a href="http://inessential.com/2013/01/02/paul_on_uitableviewcell">Paul on UITableViewCell</a><br>Brent follows with another post explaining how cell ‘s subviews should not be accessed outside of the cell</p>
<h3 id="Data-Source"><a href="#Data-Source" class="headerlink" title="Data Source"></a>Data Source</h3><p><a href="http://www.objc.io/issue-1/table-views.html">Clean table view code</a><br>This article deals with Bridging the Gap Between Model Objects and Cells.<br>“At some point we have to hand over the data we want to display into the view layer. Since we still want to maintain a clear separation between the model and the view, we often offload this task to the table view’s data source. This kind of code clutters the data source with specific knowledge about the design of the cell. We are better off factoring this out into a category of the cell class”</p>
<p>This together with <a href="http://www.objc.io/issue-1/lighter-view-controllers.html">Lighter View Controllers</a> shows a practical example that deals with most cases</p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ol>
<li><a href="http://cocoamanifest.net/articles/2013/01/should-uitableviewcells-know-about-model-objects.html">Should UITableViewCells Know About Model Objects?</a></li>
</ol>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2018-01-26T12:40:28.000Z" title="2018-01-26T12:40:28.000Z">2018-01-26</time><span class="level-item">a minute read (About 189 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/Learning-from-Open-Source-Generic-Factory/">Learning from Open Source  Generic Factory</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/148">#148</a></strong></p>
<p>From <a href="https://github.com/devxoul/Pure/blob/master/Sources/Pure/FactoryModule.swift">https://github.com/devxoul/Pure/blob/master/Sources/Pure/FactoryModule.swift</a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">protocol</span> <span class="title">FactoryModule</span>: <span class="title">Module</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// A factory for `Self`.</span></span><br><span class="line">  <span class="keyword">associatedtype</span> <span class="type">Factory</span> = <span class="type">Pure</span>.<span class="type">Factory</span>&lt;<span class="type">Self</span>&gt;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// Creates an instance of a module with a dependency and a payload.</span></span><br><span class="line">  <span class="keyword">init</span>(dependency: <span class="type">Dependency</span>, payload: <span class="type">Payload</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>From <a href="https://github.com/devxoul/Pure/blob/master/Sources/Pure/Factory.swift">https://github.com/devxoul/Pure/blob/master/Sources/Pure/Factory.swift</a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">Factory</span>&lt;<span class="title">Module</span>: <span class="title">FactoryModule</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">let</span> dependencyClosure: () -&gt; <span class="type">Module</span>.<span class="type">Dependency</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/// A static dependency of a module.</span></span><br><span class="line">  <span class="keyword">open</span> <span class="keyword">var</span> dependency: <span class="type">Module</span>.<span class="type">Dependency</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>.dependencyClosure()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// Creates an instance of `Factory`.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// - parameter dependency: A static dependency which should be resolved in a composition root.</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">init</span>(dependency: <span class="meta">@autoclosure</span> @escaping () -&gt; <span class="type">Module</span>.<span class="type">Dependency</span>) &#123;</span><br><span class="line">    <span class="keyword">self</span>.dependencyClosure = dependency</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// Creates an instance of a module with a runtime parameter.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// - parameter payload: A runtime parameter which is required to construct a module.</span></span><br><span class="line">  <span class="keyword">open</span> <span class="function"><span class="keyword">func</span> <span class="title">create</span><span class="params">(payload: Module.Payload)</span></span> -&gt; <span class="type">Module</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">Module</span>.<span class="keyword">init</span>(dependency: <span class="keyword">self</span>.dependency, payload: payload)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>From <a href="https://github.com/devxoul/Pure/blob/master/Tests/PureTests/PureSpec.swift#L72">https://github.com/devxoul/Pure/blob/master/Tests/PureTests/PureSpec.swift#L72</a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> factory = <span class="type">FactoryFixture</span>&lt;<span class="type">Dependency</span>, <span class="type">Payload</span>&gt;.<span class="type">Factory</span>(dependency: .<span class="keyword">init</span>(</span><br><span class="line">  networking: <span class="string">"Networking A"</span></span><br><span class="line">))</span><br><span class="line"><span class="keyword">let</span> instance = factory.create(payload: .<span class="keyword">init</span>(id: <span class="number">100</span>))</span><br><span class="line">expect(instance.dependency.networking) == <span class="string">"Networking A"</span></span><br><span class="line">expect(instance.payload.id) == <span class="number">100</span></span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2018-01-26T12:02:44.000Z" title="2018-01-26T12:02:44.000Z">2018-01-26</time><span class="level-item">3 minutes read (About 400 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/Using-camelCase-for-abbreviations/">Using camelCase for abbreviations</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/147">#147</a></strong></p>
<p>Each language and platform has its own coding style guide. This goes true when it comes to abbreviations. I’ve had some debates about whether to use <code>JSON</code>  or <code>Json</code>, <code>URL</code> or <code>Url</code>, <code>HTTP</code> or <code>Http</code>. </p>
<p>I personally prefer camelCase, so I’m very happy to see that Kotlin is on my side. See <a href="https://android.github.io/kotlin-guides/style.html#camel-case">Kotlin Style guide</a>, I think this guide should be applied in other languages, such as Swift 😛 </p>
<blockquote>
<p>Sometimes there is more than one reasonable way to convert an English phrase into camel case, such as when acronyms or unusual constructs like “IPv6” or “iOS” are present. To improve predictability, use the following scheme.</p>
</blockquote>
<blockquote>
<p>Beginning with the prose form of the name:</p>
</blockquote>
<blockquote>
<ol>
<li>Convert the phrase to plain ASCII and remove any apostrophes. For example, “Müller’s algorithm” might become “Muellers algorithm”.</li>
</ol>
</blockquote>
<blockquote>
<ol start="2">
<li>Divide this result into words, splitting on spaces and any remaining punctuation (typically hyphens).</li>
</ol>
</blockquote>
<blockquote>
<p>Recommended: if any word already has a conventional camel-case appearance in common usage, split this into its constituent parts (e.g., “AdWords” becomes “ad words”). Note that a word such as “iOS” is not really in camel case per se; it defies any convention, so this recommendation does not apply.</p>
</blockquote>
<blockquote>
<ol start="3">
<li>Now lowercase everything (including acronyms), then uppercase only the first character of:</li>
</ol>
</blockquote>
<blockquote>
<p>…each word, to yield pascal case, or</p>
</blockquote>
<blockquote>
<p>…each word except the first, to yield camel case</p>
</blockquote>
<blockquote>
<ol start="4">
<li>Finally, join all the words into a single identifier.</li>
</ol>
</blockquote>
<blockquote>
<p>Note that the casing of the original words is almost entirely disregarded.</p>
</blockquote>
<table>
<thead>
<tr>
<th>Prose form</th>
<th>Correct</th>
<th>Incorrect</th>
</tr>
</thead>
<tbody><tr>
<td>“XML Http Request”</td>
<td>XmlHttpRequest</td>
<td>XMLHTTPRequest</td>
</tr>
<tr>
<td>“new customer ID”</td>
<td>newCustomerId</td>
<td>newCustomerID</td>
</tr>
<tr>
<td>“inner stopwatch”</td>
<td>innerStopwatch</td>
<td>innerStopWatch</td>
</tr>
<tr>
<td>“supports IPv6 on iOS”</td>
<td>supportsIpv6OnIos</td>
<td>supportsIPv6OnIOS</td>
</tr>
<tr>
<td>“YouTube importer”</td>
<td>YouTubeImporterYoutubeImporter*</td>
<td></td>
</tr>
</tbody></table>
<p>About <code>iOS</code> or <code>IOS</code>, I think I would go with <code>IOS</code>. I think <a href="https://facebook.github.io/react-native/docs/navigation.html#navigatorios">React Native</a> thinks so too</p>
<blockquote>
<p>NavigatorIOS looks and feels just like UINavigationController, because it is actually built on top of it.</p>
</blockquote>
<h3 id="Read-more"><a href="#Read-more" class="headerlink" title="Read more"></a>Read more</h3><ul>
<li><a href="https://softwareengineering.stackexchange.com/questions/186277/should-the-variable-be-named-id-or-id">https://softwareengineering.stackexchange.com/questions/186277/should-the-variable-be-named-id-or-id</a></li>
<li><a href="https://swift.org/documentation/api-design-guidelines/#promote-clear-usage">https://swift.org/documentation/api-design-guidelines/#promote-clear-usage</a></li>
<li><a href="https://github.com/raywenderlich/swift-style-guide#naming">https://github.com/raywenderlich/swift-style-guide#naming</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2018-01-10T12:40:08.000Z" title="2018-01-10T12:40:08.000Z">2018-01-10</time><span class="level-item">3 minutes read (About 474 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-use-standalone-UINavigationBar-in-iOS/">How to use standalone UINavigationBar in iOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/144">#144</a></strong></p>
<p>There are times we want the same <code>UIViewController</code> to look good when it’s presented modally or pushed from <code>UINavigationController</code> stack. Take a look at BarcodeScanner and the PR <a href="https://github.com/hyperoslo/BarcodeScanner/pull/82">https://github.com/hyperoslo/BarcodeScanner/pull/82</a></p>
<p>When it is presented, we need a header view so that we can show a title and a close button. We can create a custom <code>HeaderView</code> that inherits from <code>UIView</code> or either embed it in a <code>UINavigationController</code> before presenting.</p>
<p>If we go with the controller being embedded in <code>UINavigationController</code> approach, it will collide with the other <code>UINavigationController</code> when it is pushed.</p>
<p>If we go with custom <code>HeaderView</code>, then we need to layout the view so that it looks good on both portrait and landscape, and on iPhone X that as <code>safeAreaLayoutGuide</code>.</p>
<h2 id="Using-standalone-UINavigationBar"><a href="#Using-standalone-UINavigationBar" class="headerlink" title="Using standalone UINavigationBar"></a>Using standalone UINavigationBar</h2><p>Since <code>UINavigationController</code> uses <code>UINavigationBar</code> under the hood, which uses <code>UINavigationItem</code> info to present the content. We can imitate this behavior by using a standalone <code>UINavigationBar</code>. See <a href="https://developer.apple.com/documentation/uikit/uinavigationbar">Adding Content to a Standalone Navigation Bar</a></p>
<blockquote>
<p>In the vast majority of scenarios you will use a navigation bar as part of a navigation controller. However, there are situations for which you might want to use the navigation bar UI and implement your own approach to content navigation. In these situations, you can use a standalone navigation bar.</p>
</blockquote>
<blockquote>
<p>A navigation bar manages a stack of UINavigationItem objects</p>
</blockquote>
<p>The beauty is that our standalone <code>UINavigationBar</code> and that of <code>UINavigationController</code> are the same, use the same <code>UINavigationItem</code> and no manual layout are needed</p>
<h3 id="Declare-UINavigationItem"><a href="#Declare-UINavigationItem" class="headerlink" title="Declare UINavigationItem"></a>Declare <code>UINavigationItem</code></h3><p>We can just set properties like we did with a normal <code>navigationItem</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> standaloneItem = <span class="type">UINavigationItem</span>()</span><br><span class="line">standaloneItem.leftBarButtonItem = <span class="type">UIBarButtonItem</span>(customView: closeButton)</span><br><span class="line">standaloneItem.titleView = <span class="type">UILabel</span>()</span><br></pre></td></tr></table></figure>

<h3 id="Adding-UINavigationBar"><a href="#Adding-UINavigationBar" class="headerlink" title="Adding UINavigationBar"></a>Adding <code>UINavigationBar</code></h3><p>Customise your bar, then declare layout constraints. You only need to pin left, right, and top. Note that you need to implement <code>UINavigationBarDelegate</code> to attach bar to status bar, so that it appears good on iPhone X too</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> navigationBar = <span class="type">UINavigationBar</span>()</span><br><span class="line">navigationBar.isTranslucent = <span class="literal">false</span></span><br><span class="line">navigationBar.delegate = <span class="keyword">self</span></span><br><span class="line">navigationBar.backgroundColor = .white</span><br><span class="line">navigationBar.items = [standaloneItem]</span><br><span class="line"> </span><br><span class="line">navigationBar.translatesAutoresizingMaskIntoConstraints = <span class="literal">false</span></span><br><span class="line">navigationBar.leftAnchor.constraint(equalTo: view.leftAnchor).isActive = <span class="literal">true</span></span><br><span class="line">navigationBar.rightAnchor.constraint(equalTo: view.rightAnchor).isActive = <span class="literal">true</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> #available(iOS <span class="number">11</span>, *) &#123;</span><br><span class="line">  navigationBar.topAnchor.constraint(equalTo: view.safeAreaLayoutGuide.topAnchor).isActive = <span class="literal">true</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  navigationBar.topAnchor.constraint(equalTo: view.topAnchor).isActive = <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">BarcodeScannerController</span>: <span class="title">UINavigationBarDelegate</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">position</span><span class="params">(<span class="keyword">for</span> bar: UIBarPositioning)</span></span> -&gt; <span class="type">UIBarPosition</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> .topAttached</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Inside-UINavigationController"><a href="#Inside-UINavigationController" class="headerlink" title="Inside UINavigationController"></a>Inside <code>UINavigationController</code></h3><p>When this <code>UIViewController</code> is pushed from a <code>UINavigationController</code> stack, we just need to hide our standalone <code>navigationBar</code>. If we prefer the default back button, we don’t need to set <code>leftBarButtonItem</code></p>
<p>On iOS 10, you need to call <code>sizeToFit</code> for any items in <code>UINavigationItem</code> for it to get actual size</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewWillAppear</span><span class="params">(<span class="number">_</span> animated: Bool)</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.viewWillAppear(animated)</span><br><span class="line">    </span><br><span class="line">  <span class="keyword">if</span> navigationController != <span class="literal">nil</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> label = <span class="type">HeaderElement</span>.makeLabel()</span><br><span class="line">      label.sizeToFit()</span><br><span class="line">      navigationItem.titleView = label</span><br><span class="line">    navigationBar.isHidden = <span class="literal">true</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    navigationBar.isHidden = <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2018-01-06T17:41:50.000Z" title="2018-01-06T17:41:50.000Z">2018-01-06</time><span class="level-item">a minute read (About 122 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-generate-QR-code-in-AppKit/">How to generate QR code in AppKit</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/140">#140</a></strong></p>
<p>I need to generate QR code in <a href="https://github.com/onmyway133/AddressGenerator">https://github.com/onmyway133/AddressGenerator</a>. Fortunately with <code>CoreImage</code> filter, it is very easy. Code is in Swift 4</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> AppKit</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">QRCodeGenerator</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">generate</span><span class="params">(string: String, size: CGSize)</span></span> -&gt; <span class="type">NSImage?</span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> data = string.data(using: .utf8) <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Filter</span></span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> <span class="built_in">filter</span> = <span class="type">CIFilter</span>(name: <span class="string">"CIQRCodeGenerator"</span>) <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">filter</span>.setValue(data, forKey: <span class="string">"inputMessage"</span>)</span><br><span class="line">    <span class="built_in">filter</span>.setValue(<span class="string">"Q"</span>, forKey: <span class="string">"inputCorrectionLevel"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// CIImage</span></span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> ciImage = <span class="built_in">filter</span>.outputImage <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// NSImage</span></span><br><span class="line">    <span class="keyword">let</span> rep = <span class="type">NSCIImageRep</span>(ciImage: ciImage)</span><br><span class="line">    <span class="keyword">let</span> image = <span class="type">NSImage</span>(size: rep.size)</span><br><span class="line">    image.addRepresentation(rep)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Scale</span></span><br><span class="line">    <span class="keyword">let</span> finalImage = <span class="type">NSImage</span>(size: size)</span><br><span class="line">    finalImage.lockFocus()</span><br><span class="line">    <span class="type">NSGraphicsContext</span>.current?.imageInterpolation = .<span class="keyword">none</span></span><br><span class="line">    image.draw(<span class="keyword">in</span>: <span class="type">NSRect</span>(origin: .zero, size: size))</span><br><span class="line">    finalImage.unlockFocus()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> finalImage</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2018-01-04T08:25:12.000Z" title="2018-01-04T08:25:12.000Z">2018-01-04</time><span class="level-item">a few seconds read (About 54 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/Hiding-back-button-in-navigation-bar-in-iOS/">Hiding back button in navigation bar in iOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/137">#137</a></strong></p>
<p>Use a custom <code>NavigationController</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NavigationController</span>: <span class="title">UINavigationController</span> </span>&#123;</span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">    navigationBar.tintColor = .white</span><br><span class="line">    navigationBar.barStyle = .black</span><br><span class="line">    navigationBar.isTranslucent = <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">pushViewController</span><span class="params">(<span class="number">_</span> viewController: UIViewController, animated: Bool)</span></span> &#123;</span><br><span class="line">    viewController.navigationItem.backBarButtonItem =</span><br><span class="line">      <span class="type">UIBarButtonItem</span>(title: <span class="string">""</span>, style: .plain, target: <span class="literal">nil</span>, action: <span class="literal">nil</span>)</span><br><span class="line">    <span class="keyword">super</span>.pushViewController(viewController, animated: animated)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2018-01-03T14:09:55.000Z" title="2018-01-03T14:09:55.000Z">2018-01-03</time><span class="level-item">a few seconds read (About 22 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/Some-Swift-tips/">Some Swift tips</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/136">#136</a></strong></p>
<h3 id="Adding-final"><a href="#Adding-final" class="headerlink" title="Adding final"></a>Adding final</h3><ul>
<li><a href="https://gist.github.com/krzysztofzablocki/8c9a6c428cf5fcf19effca223a5548cd">https://gist.github.com/krzysztofzablocki/8c9a6c428cf5fcf19effca223a5548cd</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-12-21T12:54:45.000Z" title="2017-12-21T12:54:45.000Z">2017-12-21</time><span class="level-item">a minute read (About 223 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-make-NSCollectionView-programatically-in-Swift/">How to make NSCollectionView programatically in Swift</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/131">#131</a></strong></p>
<p>Here’s how to create <code>NSCollectionView</code> programatically. We need to embed it inside <code>NScrollView</code> for scrolling to work. Code is in Swift 4</p>
<h3 id="NSCollectionView"><a href="#NSCollectionView" class="headerlink" title="NSCollectionView"></a>NSCollectionView</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> layout = <span class="type">NSCollectionViewFlowLayout</span>()</span><br><span class="line">layout.minimumLineSpacing = <span class="number">4</span></span><br><span class="line"></span><br><span class="line">collectionView = <span class="type">NSCollectionView</span>()</span><br><span class="line">collectionView.dataSource = <span class="keyword">self</span></span><br><span class="line">collectionView.delegate = <span class="keyword">self</span></span><br><span class="line">collectionView.collectionViewLayout = layout</span><br><span class="line">collectionView.allowsMultipleSelection = <span class="literal">false</span></span><br><span class="line">collectionView.backgroundColors = [.clear]</span><br><span class="line">collectionView.isSelectable = <span class="literal">true</span></span><br><span class="line">collectionView.register(</span><br><span class="line">  <span class="type">Cell</span>.<span class="keyword">self</span>,</span><br><span class="line">  forItemWithIdentifier: <span class="type">NSUserInterfaceItemIdentifier</span>(rawValue: <span class="string">"Cell"</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="NScrollView"><a href="#NScrollView" class="headerlink" title="NScrollView"></a>NScrollView</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">scrollView = <span class="type">NSScrollView</span>()</span><br><span class="line">scrollView.documentView = collectionView</span><br><span class="line">view.addSubview(scrollView)</span><br></pre></td></tr></table></figure>

<h3 id="NSCollectionViewItem"><a href="#NSCollectionViewItem" class="headerlink" title="NSCollectionViewItem"></a>NSCollectionViewItem</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Cell</span>: <span class="title">NSCollectionViewItem</span> </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> label = <span class="type">Label</span>()</span><br><span class="line">  <span class="keyword">let</span> myImageView = <span class="type">NSImageView</span>()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">loadView</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">self</span>.view = <span class="type">NSView</span>()</span><br><span class="line">    <span class="keyword">self</span>.view.wantsLayer = <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="NSCollectionViewDataSource"><a href="#NSCollectionViewDataSource" class="headerlink" title="NSCollectionViewDataSource"></a>NSCollectionViewDataSource</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">collectionView</span><span class="params">(<span class="number">_</span> collectionView: NSCollectionView, numberOfItemsInSection section: Int)</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> coins.<span class="built_in">count</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">collectionView</span><span class="params">(<span class="number">_</span> collectionView: NSCollectionView, itemForRepresentedObjectAt indexPath: IndexPath)</span></span> -&gt; <span class="type">NSCollectionViewItem</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> cell = collectionView.makeItem(</span><br><span class="line">    withIdentifier: <span class="type">NSUserInterfaceItemIdentifier</span>(rawValue: <span class="string">"Cell"</span>),</span><br><span class="line">    <span class="keyword">for</span>: indexPath</span><br><span class="line">  ) <span class="keyword">as</span>! <span class="type">Cell</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> coin = coins[indexPath.item]</span><br><span class="line"></span><br><span class="line">  cell.label.stringValue = coin.name</span><br><span class="line">  cell.coinImageView.image =</span><br><span class="line">    <span class="type">NSImage</span>(named: <span class="type">NSImage</span>.<span class="type">Name</span>(rawValue: <span class="string">"USD"</span>))</span><br><span class="line">    ?? <span class="type">NSImage</span>(named: <span class="type">NSImage</span>.<span class="type">Name</span>(rawValue: <span class="string">"Others"</span>))</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> cell</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="NSCollectionViewDelegateFlowLayout"><a href="#NSCollectionViewDelegateFlowLayout" class="headerlink" title="NSCollectionViewDelegateFlowLayout"></a>NSCollectionViewDelegateFlowLayout</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">collectionView</span><span class="params">(<span class="number">_</span> collectionView: NSCollectionView, didSelectItemsAt indexPaths: Set&lt;IndexPath&gt;)</span></span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> indexPath = indexPaths.first,</span><br><span class="line">    <span class="keyword">let</span> cell = collectionView.item(at: indexPath) <span class="keyword">as</span>? <span class="type">Cell</span> <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">collectionView</span><span class="params">(<span class="number">_</span> collectionView: NSCollectionView, didDeselectItemsAt indexPaths: Set&lt;IndexPath&gt;)</span></span> &#123;</span><br><span class="line">  <span class="keyword">guard</span> <span class="keyword">let</span> indexPath = indexPaths.first,</span><br><span class="line">    <span class="keyword">let</span> cell = collectionView.item(at: indexPath) <span class="keyword">as</span>? <span class="type">Cell</span> <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">collectionView</span><span class="params">(<span class="number">_</span> collectionView: NSCollectionView, layout collectionViewLayout: NSCollectionViewLayout, sizeForItemAt indexPath: IndexPath)</span></span> -&gt; <span class="type">NSSize</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="type">NSSize</span>(</span><br><span class="line">    width: collectionView.frame.size.width,</span><br><span class="line">    height: <span class="number">40</span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p><strong>Updated at</strong> 2020-05-22 11:48:15</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-12-20T15:58:30.000Z" title="2017-12-20T15:58:30.000Z">2017-12-20</time><span class="level-item">a minute read (About 172 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/UnsafePointer-in-Swift/">UnsafePointer in Swift</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/130">#130</a></strong></p>
<p>Code is in Swift 4</p>
<h3 id="Constructing-UnsafeMutablePointer"><a href="#Constructing-UnsafeMutablePointer" class="headerlink" title="Constructing UnsafeMutablePointer"></a>Constructing UnsafeMutablePointer</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> byteCount = <span class="number">32</span></span><br><span class="line"><span class="keyword">let</span> result = <span class="type">UnsafeMutablePointer</span>&lt;<span class="type">UInt8</span>&gt;.allocate(capacity: byteCount)</span><br></pre></td></tr></table></figure>

<h3 id="Data-to-UnsafePointer"><a href="#Data-to-UnsafePointer" class="headerlink" title="Data to UnsafePointer"></a>Data to UnsafePointer</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Data</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">toPointer</span><span class="params">()</span></span> -&gt; <span class="type">UnsafePointer</span>&lt;<span class="type">UInt8</span>&gt;? &#123;</span><br><span class="line">    <span class="keyword">let</span> buffer = <span class="type">UnsafeMutablePointer</span>&lt;<span class="type">UInt8</span>&gt;.allocate(capacity: <span class="built_in">count</span>)</span><br><span class="line">    <span class="keyword">let</span> stream = <span class="type">OutputStream</span>(toBuffer: buffer, capacity: <span class="built_in">count</span>)</span><br><span class="line"></span><br><span class="line">    stream.<span class="keyword">open</span>()</span><br><span class="line">    withUnsafeBytes(&#123; (p: <span class="type">UnsafePointer</span>&lt;<span class="type">UInt8</span>&gt;) -&gt; <span class="type">Void</span> <span class="keyword">in</span></span><br><span class="line">      stream.write(p, maxLength: <span class="built_in">count</span>)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    stream.close()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="type">UnsafePointer</span>&lt;<span class="type">UInt8</span>&gt;(buffer)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="UnsafePointer-to-Data"><a href="#UnsafePointer-to-Data" class="headerlink" title="UnsafePointer to Data"></a>UnsafePointer to Data</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">UnsafePointer</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">toData</span><span class="params">()</span></span> -&gt; <span class="type">Data</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">Data</span>(bytes: <span class="type">UnsafeRawPointer</span>(<span class="keyword">self</span>), <span class="built_in">count</span>: <span class="number">32</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Dealing-with-C-API"><a href="#Dealing-with-C-API" class="headerlink" title="Dealing with C API"></a>Dealing with C API</h3><p>This is how to do keccak hash using C API from <a href="https://github.com/ethereum/ethash/blob/master/src/libethash/sha3.c">https://github.com/ethereum/ethash/blob/master/src/libethash/sha3.c</a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">KeccakHash</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">hash</span><span class="params">(data: Data)</span></span> <span class="keyword">throws</span> -&gt; <span class="type">Data</span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> dataPointer = data.toPointer() <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="type">InteralError</span>.invalid</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> byteCount = <span class="number">32</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> result = <span class="type">UnsafeMutablePointer</span>&lt;<span class="type">UInt8</span>&gt;.allocate(capacity: byteCount)</span><br><span class="line">    sha3_256(result, byteCount, dataPointer, data.<span class="built_in">count</span>)</span><br><span class="line">    <span class="keyword">return</span> result.toData()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Read-more"><a href="#Read-more" class="headerlink" title="Read more"></a>Read more</h2><ul>
<li>See <a href="https://github.com/onmyway133/Reindeers/blob/master/Sources/Extensions.swift">https://github.com/onmyway133/Reindeers/blob/master/Sources/Extensions.swift</a></li>
<li><a href="https://oleb.net/blog/2017/12/importing-c-library-into-swift/"><br>How to import a C library in Swift using the Swift Package Manager</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-12-20T09:40:35.000Z" title="2017-12-20T09:40:35.000Z">2017-12-20</time><span class="level-item">3 minutes read (About 478 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-prevent-UIVisualEffectView-crash/">How to prevent UIVisualEffectView crash</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/124">#124</a></strong></p>
<p>We all know that there’s a potential crash with <code>UIVisualEffectView</code> on iOS 11. The fix is to not add sub views directly to <code>UIVisualEffectView</code>, but to its <code>contentView</code>. So we should change</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">effectView.addSubview(button)</span><br></pre></td></tr></table></figure>

<p>to </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">effectView.contentView.addubView(button)</span><br></pre></td></tr></table></figure>

<p>Here we don’t need to perform iOS version check, because <code>effectView.contentView</code> works for any iOS versions.</p>
<h3 id="Potential-cases-for-crashes"><a href="#Potential-cases-for-crashes" class="headerlink" title="Potential cases for crashes"></a>Potential cases for crashes</h3><p>Here are some cases you can potentially cause the crashes</p>
<p><strong><em>Strange namings</em></strong></p>
<p>Normally we name our <code>UIVisualEffectView</code> as <code>blurView</code>, <code>effectView</code>. But there’s times we name it differently like <code>navigationView</code>, <code>containerView</code>, <code>boxView</code>, … This way we may completely forget that it’s a <code>UIVisualEffectView</code> 🙀 </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">containerView.addSubview(button)</span><br><span class="line">boxView.insertSubview(label, at: <span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p><strong><em>Custom loadView</em></strong></p>
<p>Sometimes it’s convenient to have our <code>UIViewController &#39;s view</code> as a whole blur view, so that all things inside have a nice blur effect background</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OverlayController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> blurView = <span class="type">UIVisualEffectView</span>(effect: <span class="type">UIBlurEffect</span>(style: .dark))</span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">loadView</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.loadView()</span><br><span class="line">    <span class="keyword">self</span>.view = blurView</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line"></span><br><span class="line">    view.addSubview(button)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>By setting our <code>blurView</code> as <code>view</code> in <code>loadView</code>, we have no idea afterwards that <code>view</code> is actually a <code>UIVisualEffectView</code> 🙀 </p>
<p><strong><em>Inheritance</em></strong></p>
<p>What happen if we have another <code>UIViewController</code> that inherits from our <code>OverlayController</code>, all it knows about <code>view</code> is <code>UIView</code>, it does not know that it is a disguising <code>UIVisualEffectView</code> 🙀 </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClocksController</span>: <span class="title">OverlayController</span> </span>&#123;</span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line"></span><br><span class="line">    view.addSubview(timeLabel)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><em>Superclass type</em></strong></p>
<p>Sometimes declare our things but with protocol or superclass types. Consumers of our API have no clue to know that it is <code>UIVisualEffectView</code> 🙀 </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> view: <span class="type">UIView</span> = <span class="type">UIVisualEffectView</span>(effect: <span class="type">UIBlurEffect</span>(style: .dark))</span><br></pre></td></tr></table></figure>

<p>Here it appears to us that <code>view</code> is of type <code>UIView</code></p>
<p><strong><em>Legacy codebase</em></strong></p>
<p>Now imagine you ‘ve handled a legacy codebase to deal with. Perform finding and replacing all those things related to <code>UIVisualEffectView</code> is very hard task. Especially since we tend to write less tests for UI</p>
<h3 id="Making-it-impossible-to-crash"><a href="#Making-it-impossible-to-crash" class="headerlink" title="Making it impossible to crash"></a>Making it impossible to crash</h3><p>I like concept like <a href="https://wiki.haskell.org/Phantom_type">Phantom type</a> to limit interface. Here we’re not using type but a wrapper </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">BlurView</span>: <span class="title">UIView</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">let</span> effectView: <span class="type">UIVisualEffectView</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">init</span>(style: <span class="type">UIBlurEffectStyle</span>, backgroundColor: <span class="type">UIColor?</span> = <span class="literal">nil</span>) &#123;</span><br><span class="line">    <span class="keyword">self</span>.effectView = <span class="type">UIVisualEffectView</span>(effect: <span class="type">UIBlurEffect</span>(style: style))</span><br><span class="line">    <span class="keyword">self</span>.effectView.backgroundColor = backgroundColor</span><br><span class="line">    <span class="keyword">super</span>.<span class="keyword">init</span>(frame: .zero)</span><br><span class="line">    insertSubview(effectView, at: <span class="number">0</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">required</span> <span class="keyword">init</span>?(coder aDecoder: <span class="type">NSCoder</span>) &#123;</span><br><span class="line">    <span class="built_in">fatalError</span>()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">addSubview</span><span class="params">(<span class="number">_</span> view: UIView)</span></span> &#123;</span><br><span class="line">    effectView.contentView.addSubview(view)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">layoutSubviews</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.layoutSubviews()</span><br><span class="line"></span><br><span class="line">    effectView.frame = bounds</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Here we override <code>addSubview</code> to always add views to <code>effectView.contentView</code>. In the <code>init</code> method, we need to call <code>insertSubview</code> instead because of our overriden <code>addSubview</code></p>
<p>Now <code>BlurView</code> has a blur effect thanks to is underlying <code>UIVisualEffectView</code>, but expose only <code>addSubview</code> because of its <code>UIView</code> interface. This way it is impossible to cause crashes 😎 </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> blurView = <span class="type">BlurView</span>(style: .dark)</span><br><span class="line">blurView.addSubview(button(</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-12-13T14:10:40.000Z" title="2017-12-13T14:10:40.000Z">2017-12-13</time><span class="level-item">a minute read (About 140 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/Hashable-and-Set-in-Swift/">Hashable and Set in Swift</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/122">#122</a></strong></p>
<p>From <a href="https://developer.apple.com/documentation/swift/set">Set</a></p>
<blockquote>
<p>You can create a set with any element type that conforms to the Hashable protocol. By default, most types in the standard library are hashable, including strings, numeric and Boolean types, enumeration cases without associated values, and even sets themselves.</p>
</blockquote>
<p>From <a href="https://developer.apple.com/documentation/swift/hashable">Hashable</a></p>
<blockquote>
<p>The Hashable protocol inherits from the Equatable protocol, so you must also add an equal-to operator (==) function for your custom type.</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">protocol</span> <span class="title">Hashable</span> : <span class="title">Equatable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// The hash value.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// Hash values are not guaranteed to be equal across different executions of</span></span><br><span class="line">    <span class="comment">/// your program. Do not save hash values to use during a future execution.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> hashValue: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Read-more"><a href="#Read-more" class="headerlink" title="Read more"></a>Read more</h2><ul>
<li><a href="https://useyourloaf.com/blog/swift-hashable/">https://useyourloaf.com/blog/swift-hashable/</a></li>
<li><a href="http://kelan.io/2015/swift-hashable-for-sets/">http://kelan.io/2015/swift-hashable-for-sets/</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-12-13T11:53:23.000Z" title="2017-12-13T11:53:23.000Z">2017-12-13</time><span class="level-item">a few seconds read (About 16 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/Generic-declaration-in-Swift/">Generic declaration in Swift</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/121">#121</a></strong></p>
<p>These are different</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DiffService</span>&lt;<span class="title">T</span>: <span class="title">MKAnnotation</span> &amp; <span class="title">Equatable</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DiffService</span>&lt;<span class="title">T</span>: <span class="title">MKAnnotation</span>, <span class="title">Equatable</span>&gt;</span></span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-12-07T15:22:39.000Z" title="2017-12-07T15:22:39.000Z">2017-12-07</time><span class="level-item">13 minutes read (About 1974 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/Collection-Update/">Collection Update</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/119">#119</a></strong></p>
<p>This is about collection update, how to provide correct IndexPath and a simple diffing algorithm</p>
<ul>
<li>Excerpt from my talk at CocoaHeads, Oslo <a href="https://www.meetup.com/CocoaHeads-Oslo/events/244892347/">https://www.meetup.com/CocoaHeads-Oslo/events/244892347/</a></li>
<li>Slide <a href="https://speakerdeck.com/onmyway133/collection-update">https://speakerdeck.com/onmyway133/collection-update</a></li>
</ul>
<h2 id="CollectionView"><a href="#CollectionView" class="headerlink" title="CollectionView"></a>CollectionView</h2><p>It’s hard to imagine of any apps that don’t use Table View or CollectionView. And by CollectionView, I actually mean UICollectionView 😉  . Most of the time, we show something with response from backend, then potentially update and insert new items as data changed.</p>
<p><img src="https://user-images.githubusercontent.com/2284279/34838146-55461fbc-f6fd-11e7-928f-b5461a51893f.png" alt="collectionview"></p>
<p>We can totally call <code>reloadData</code> to reflect the changes, but an animation is better here as it gives user better understanding of what’s going on, and to not surprise them. </p>
<p>This talks about <code>UICollectionView</code>, but <code>UITableView</code> behaves the same</p>
<h2 id="Drag-and-Drop"><a href="#Drag-and-Drop" class="headerlink" title="Drag and Drop"></a>Drag and Drop</h2><p>Let’s imagine an app where user are allowed to customise their experience by moving items from one collection to another.</p>
<p>You can take a look at the example <a href="https://github.com/onmyway133/CollectionUpdateExample/tree/master/DragAndDrop">DragAndDrop</a> which is using the new <a href="https://developer.apple.com/ios/drag-and-drop/">drag and drop API</a> in iOS 11.</p>
<p><img src="https://user-images.githubusercontent.com/2284279/33726942-d084fa74-db76-11e7-95e0-6580f4c5fc9d.png" alt="ipad"></p>
<p>You must ensure that your data is changed before calling update methods on <code>UICollectionView</code>. And then we call <code>deleteItems</code> and <code>insertItems</code> to reflect data changes. <code>UICollectionView</code> performs a nice animation for you</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">collectionView</span><span class="params">(<span class="number">_</span> collectionView: UICollectionView, performDropWith coordinator: UICollectionViewDropCoordinator)</span></span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> destinationIndexPath = coordinator.destinationIndexPath</span><br><span class="line">  <span class="keyword">let</span> sourceIndexPath = coordinator.items.last?.dragItem.localObject <span class="keyword">as</span>! <span class="type">IndexPath</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// remove</span></span><br><span class="line">  sourceItems.remove(at: sourceIndexPath.item)</span><br><span class="line">  sourceCollectionView.deleteItems(at: [sourceIndexPath])</span><br><span class="line"></span><br><span class="line">  <span class="comment">// insert</span></span><br><span class="line">  destinationItems.insert(draggedItem, at: destinationIndexPath.item)</span><br><span class="line">  destinationCollectionView.insertItems(at: [destinationIndexPath])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="NSInternalInconsistencyException"><a href="#NSInternalInconsistencyException" class="headerlink" title="NSInternalInconsistencyException"></a>NSInternalInconsistencyException</h2><p>If you have large number of items with many insertions and deletions from backend response, you need to calculate the correct IndexPath to call, which are not easy thing. Most the time you will get the following crashes</p>
<blockquote>
<p>Terminating app due to uncaught exception ‘NSInternalInconsistencyException’,<br>reason: ‘Invalid update: invalid number of items in section 0.<br>The number of items contained in an existing section after the update (213)<br>must be equal to the number of items contained in that section before<br>the update (154), plus or minus the number of items inserted or<br>deleted from that section (40 inserted, 0 deleted) and plus<br>or minus the number of items moved into or out of<br>that section (0 moved in, 0 moved out).’</p>
</blockquote>
<p>In my experience it happened randomly because everyone has different data. Although the message is very descriptive, it may take a while to figure it out.</p>
<h2 id="Game-of-IndexPath"><a href="#Game-of-IndexPath" class="headerlink" title="Game of IndexPath"></a>Game of IndexPath</h2><p>Let’s refine our knowledge of <code>IndexPath</code> by going through some examples. With a collection of 6 items, we perform some update operations and figure out what <code>IndexPath</code> should be. </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">items = [<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>, <span class="string">"d"</span>, <span class="string">"e"</span>, <span class="string">"f"</span>]</span><br></pre></td></tr></table></figure>

<p>Take a look at my example here <a href="https://github.com/onmyway133/CollectionUpdateExample/tree/master/CollectionUpdateExample">CollectionUpdateExample</a>, there are many more examples</p>
<div align="center">
<img src="https://user-images.githubusercontent.com/2284279/33727113-647cfe34-db77-11e7-8533-4dd84657e718.png" height="400" />
<img src="https://user-images.githubusercontent.com/2284279/33727115-6499e350-db77-11e7-8030-971bd9a29040.png" height="400" />
</div>

<h2 id="index-vs-offset"><a href="#index-vs-offset" class="headerlink" title="index vs offset"></a>index vs offset</h2><p>Before we go any further, I just want to mention that, by <code>index</code> I actually mean <code>offset from the start</code>. If you take a look at the <a href="https://developer.apple.com/documentation/swift/array/1687832-enumerated">enumerated</a> function, it suggests the name as <code>offset</code> instead of <code>index</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Array</span>(<span class="number">0</span>..&lt;<span class="number">10</span>).enumerated().forEach &#123; (offset, element) <span class="keyword">in</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This <a href="https://en.wikipedia.org/wiki/Zero-based_numbering">zero based numbering</a> could shed some light on this matter</p>
<blockquote>
<p>Particularly in C, where arrays are closely tied to pointer arithmetic, this makes for a simpler implementation: the subscript refers to an offset from the starting position of an array, so the first element has an offset of zero.</p>
</blockquote>
<h3 id="1-Insert-3-items-at-the-end"><a href="#1-Insert-3-items-at-the-end" class="headerlink" title="1.  Insert 3 items at the end"></a>1.  Insert 3 items at the end</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">items.append(contentsOf: [<span class="string">"g"</span>, <span class="string">"h"</span>, <span class="string">"i"</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">// a, b, c, d, e, f, g, h, i</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> indexPaths = <span class="type">Array</span>(<span class="number">6</span>...<span class="number">8</span>).<span class="built_in">map</span> &#123; <span class="type">IndexPath</span>(item: $<span class="number">0</span>, section: <span class="number">0</span>) &#125;</span><br><span class="line">collectionView.insertItems(at: indexPaths)</span><br></pre></td></tr></table></figure>

<h3 id="2-Delete-3-items-at-the-end"><a href="#2-Delete-3-items-at-the-end" class="headerlink" title="2. Delete 3 items at the end"></a>2. Delete 3 items at the end</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">items.removeLast()</span><br><span class="line">items.removeLast()</span><br><span class="line">items.removeLast()</span><br><span class="line"></span><br><span class="line"><span class="comment">// a, b, c</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> indexPaths = <span class="type">Array</span>(<span class="number">3</span>...<span class="number">5</span>).<span class="built_in">map</span> &#123; <span class="type">IndexPath</span>(item: $<span class="number">0</span>, section: <span class="number">0</span>) &#125;</span><br><span class="line">collectionView.deleteItems(at: indexPaths)</span><br></pre></td></tr></table></figure>

<h3 id="3-Update-item-at-index-2"><a href="#3-Update-item-at-index-2" class="headerlink" title="3. Update item at index 2"></a>3. Update item at index 2</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">items[<span class="number">2</span>] = <span class="string">"👻"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// a, b, 👻, d, e, f</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> indexPath = <span class="type">IndexPath</span>(item: <span class="number">2</span>, section: <span class="number">0</span>)</span><br><span class="line">collectionView.reloadItems(at: [indexPath])</span><br></pre></td></tr></table></figure>

<h3 id="4-Move-item-“c”-to-the-end"><a href="#4-Move-item-“c”-to-the-end" class="headerlink" title="4. Move item “c” to the end"></a>4. Move item “c” to the end</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">items.remove(at: <span class="number">2</span>)</span><br><span class="line">items.append(<span class="string">"c"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// a, b, d, e, f, c</span></span><br><span class="line"></span><br><span class="line">collectionView.moveItem(</span><br><span class="line">  at: <span class="type">IndexPath</span>(item: <span class="number">2</span>, section: <span class="number">0</span>),</span><br><span class="line">  to: <span class="type">IndexPath</span>(item: <span class="number">5</span>, section :<span class="number">0</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="5-Delete-3-items-at-the-beginning-then-insert-3-items-at-the-end"><a href="#5-Delete-3-items-at-the-beginning-then-insert-3-items-at-the-end" class="headerlink" title="5. Delete 3 items at the beginning, then insert 3 items at the end"></a>5. Delete 3 items at the beginning, then insert 3 items at the end</h3><p>With multiple different operations, we should use <a href="https://developer.apple.com/documentation/uikit/uicollectionview/1618045-performbatchupdates">performBatchUpdates</a></p>
<blockquote>
<p>You can use this method in cases where you want to make multiple changes to the collection view in one single animated operation, as opposed to in several separate animations. You might use this method to insert, delete, reload, or move cells or use it to change the layout parameters associated with one or more cells</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">items.removeFirst()</span><br><span class="line">items.removeFirst()</span><br><span class="line">items.removeFirst()</span><br><span class="line"></span><br><span class="line">items.append(contentsOf: [<span class="string">"g"</span>, <span class="string">"h"</span>, <span class="string">"i"</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">// d, e, f, g, h, i</span></span><br><span class="line"></span><br><span class="line">collectionView.performBatchUpdates(&#123;</span><br><span class="line">  <span class="keyword">let</span> deleteIndexPaths = <span class="type">Array</span>(<span class="number">0</span>...<span class="number">2</span>).<span class="built_in">map</span> &#123; <span class="type">IndexPath</span>(item: $<span class="number">0</span>, section: <span class="number">0</span>) &#125;</span><br><span class="line">  collectionView.deleteItems(at: deleteIndexPaths)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> insertIndexPaths = <span class="type">Array</span>(<span class="number">3</span>...<span class="number">5</span>).<span class="built_in">map</span> &#123; <span class="type">IndexPath</span>(item: $<span class="number">0</span>, section: <span class="number">0</span>) &#125;</span><br><span class="line">  collectionView.insertItems(at: insertIndexPaths)</span><br><span class="line">&#125;, completion: <span class="literal">nil</span>)</span><br></pre></td></tr></table></figure>

<h3 id="6-Insert-3-items-at-the-end-then-delete-3-items-beginning"><a href="#6-Insert-3-items-at-the-end-then-delete-3-items-beginning" class="headerlink" title="6. Insert 3 items at the end, then delete 3 items beginning"></a>6. Insert 3 items at the end, then delete 3 items beginning</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">items.append(contentsOf: [<span class="string">"g"</span>, <span class="string">"h"</span>, <span class="string">"i"</span>])</span><br><span class="line"></span><br><span class="line">items.removeFirst()</span><br><span class="line">items.removeFirst()</span><br><span class="line">items.removeFirst()</span><br><span class="line"></span><br><span class="line"><span class="comment">// d, e, f, g, h, i</span></span><br><span class="line"></span><br><span class="line">collectionView.performBatchUpdates(&#123;</span><br><span class="line">  <span class="keyword">let</span> insertIndexPaths = <span class="type">Array</span>(<span class="number">6</span>...<span class="number">8</span>).<span class="built_in">map</span> &#123; <span class="type">IndexPath</span>(item: $<span class="number">0</span>, section: <span class="number">0</span>) &#125;</span><br><span class="line">  collectionView.insertItems(at: insertIndexPaths)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> deleteIndexPaths = <span class="type">Array</span>(<span class="number">0</span>...<span class="number">2</span>).<span class="built_in">map</span> &#123; <span class="type">IndexPath</span>(item: $<span class="number">0</span>, section: <span class="number">0</span>) &#125;</span><br><span class="line">  collectionView.deleteItems(at: deleteIndexPaths)</span><br><span class="line">&#125;, completion: <span class="literal">nil</span>)</span><br></pre></td></tr></table></figure>

<h2 id="🙀"><a href="#🙀" class="headerlink" title="🙀"></a>🙀</h2><p>If you run the example 6, you will get a crash</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Terminating app due to uncaught exception </span><br><span class="line">&#39;NSInternalInconsistencyException&#39;, </span><br><span class="line">reason: &#39;attempt to insert item 6 into section 0, </span><br><span class="line">but there are only 6 items in section 0 after the update&#39;</span><br></pre></td></tr></table></figure>

<h2 id="performBatchUpdates"><a href="#performBatchUpdates" class="headerlink" title="performBatchUpdates"></a>performBatchUpdates</h2><p>It is because the way <code>performBatchUpdates</code> works. If you take a look at the <a href="https://developer.apple.com/documentation/uikit/uicollectionview/1618045-performbatchupdates">documentation</a></p>
<blockquote>
<p>Deletes are processed before inserts in batch operations. This means the indexes for the deletions are processed relative to the indexes of the collection view’s state before the batch operation, and the indexes for the insertions are processed relative to the indexes of the state after all the deletions in the batch operation.</p>
</blockquote>
<p>No matter how we call insert or delete, <code>performBatchUpdates</code> always performs deletions first. So we need to call <code>deleteItems</code> and <code>insertItems</code> as if the deletions occur first.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">items.append(contentsOf: [<span class="string">"g"</span>, <span class="string">"h"</span>, <span class="string">"i"</span>])</span><br><span class="line"></span><br><span class="line">items.removeFirst()</span><br><span class="line">items.removeFirst()</span><br><span class="line">items.removeFirst()</span><br><span class="line"></span><br><span class="line"><span class="comment">// d, e, f, g, h, i</span></span><br><span class="line"></span><br><span class="line">collectionView.performBatchUpdates(&#123;</span><br><span class="line">  <span class="keyword">let</span> deleteIndexPaths = <span class="type">Array</span>(<span class="number">0</span>...<span class="number">2</span>).<span class="built_in">map</span> &#123; <span class="type">IndexPath</span>(item: $<span class="number">0</span>, section: <span class="number">0</span>) &#125;</span><br><span class="line">  collectionView.deleteItems(at: deleteIndexPaths)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> insertIndexPaths = <span class="type">Array</span>(<span class="number">3</span>...<span class="number">5</span>).<span class="built_in">map</span> &#123; <span class="type">IndexPath</span>(item: $<span class="number">0</span>, section: <span class="number">0</span>) &#125;</span><br><span class="line">  collectionView.insertItems(at: insertIndexPaths)</span><br><span class="line">&#125;, completion: <span class="literal">nil</span>)</span><br></pre></td></tr></table></figure>

<h2 id="Operations"><a href="#Operations" class="headerlink" title="Operations"></a>Operations</h2><p>There are many operations on <code>UICollectionView</code>, and there are operations to update whole section as well. Take a look <a href="https://developer.apple.com/library/content/documentation/UserExperience/Conceptual/TableView_iPhone/ManageInsertDeleteRow/ManageInsertDeleteRow.html">Ordering of Operations and Index Paths</a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">insertItems(at indexPaths: [<span class="type">IndexPath</span>])</span><br><span class="line">deleteItems(at indexPaths: [<span class="type">IndexPath</span>])</span><br><span class="line">reloadItems(at indexPaths: [<span class="type">IndexPath</span>])</span><br><span class="line">moveItem(at indexPath: <span class="type">IndexPath</span>, to newIndexPath: <span class="type">IndexPath</span>)</span><br><span class="line">performBatchUpdates(<span class="number">_</span> updates, completion)</span><br></pre></td></tr></table></figure>

<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">insertSections(<span class="number">_</span> sections: <span class="type">IndexSet</span>)</span><br><span class="line">deleteSections(<span class="number">_</span> sections: <span class="type">IndexSet</span>)</span><br><span class="line">reloadSections(<span class="number">_</span> sections: <span class="type">IndexSet</span>)</span><br><span class="line">moveSection(<span class="number">_</span> section: <span class="type">Int</span>, toSection newSection: <span class="type">Int</span>)</span><br></pre></td></tr></table></figure>

<p><img src="https://developer.apple.com/library/content/documentation/UserExperience/Conceptual/TableView_iPhone/Art/batch_insert_delete.jpg" alt="inline"></p>
<h2 id="Edit-distance"><a href="#Edit-distance" class="headerlink" title="Edit distance"></a>Edit distance</h2><p>Doing these calculations by hand is quite tedious and error prone. We can build our own abstraction using some algorithms. The naive one is <a href="https://en.wikipedia.org/wiki/Wagner%E2%80%93Fischer_algorithm">Wagner–Fischer algorithm</a> which uses <a href="https://en.wikipedia.org/wiki/Dynamic_programming">Dynamic Programming</a> to tell the edit distance between two strings of characters.</p>
<p>Edit distance means the number of steps needed to change from one string to another. String is just a collection of characters, so we can generalise this concept to make it work for any collection of items. Instead of comparing character, we require items to conform to <code>Equatable</code></p>
<h2 id="“kit”-gt-“kat”"><a href="#“kit”-gt-“kat”" class="headerlink" title="“kit” -&gt; “kat”"></a>“kit” -&gt; “kat”</h2><p>How can we transform form the word “kit” to “kat”? What kinds of operations do we nede to perform? You may tell “just change the i to a”, but this trivial example helps you understand the algorithm. Let’s get started.</p>
<p><img src="https://user-images.githubusercontent.com/2284279/33278613-5dc25c70-d39c-11e7-8a5c-2e8e6946ae36.jpg" alt="inline"></p>
<h3 id="Deletions"><a href="#Deletions" class="headerlink" title="Deletions"></a>Deletions</h3><p>If we go from “kit” to an empty string “”, we need 3 deletions </p>
<p><img src="https://user-images.githubusercontent.com/2284279/33243688-2bade616-d2eb-11e7-8463-f913695818ef.png" alt="inline"></p>
<p>“k” -&gt; “”  👉 1 deletion<br>“ki” -&gt; “” 👉 2 deletions<br>“kit” -&gt; “” 👉    3 deletions</p>
<h3 id="Insertions"><a href="#Insertions" class="headerlink" title="Insertions"></a>Insertions</h3><p>If we go from an empty string “” to “kat”, we need 3 insertions</p>
<p><img src="https://user-images.githubusercontent.com/2284279/33243726-c078ee3a-d2eb-11e7-918f-8bba30be0c0e.png" alt="inline"></p>
<p>“” -&gt; “k”  👉    1 insertion<br>“” -&gt; “ka”  👉    2 insertions<br>“” -&gt; “kat”  👉    3 insertions</p>
<h3 id="If-equal-take-value-from-the-top-left"><a href="#If-equal-take-value-from-the-top-left" class="headerlink" title="If equal, take value from the top left"></a>If equal, take value from the top left</h3><p>You can think of the algorithm as if we go from source string, to empty string, to destination string. We try to find the minimum steps to update. Going horizontally means insertions, vertically means deletions and diagonally means substitutions</p>
<p>This way we can build our matrix, iterate from row to row, column by column. First, the letter “k” from source collection is the same with letter “k” from destination collection, we simply take value from the top left, which is 0 substituion</p>
<p><img src="https://user-images.githubusercontent.com/2284279/33243911-9f1e87d8-d2ee-11e7-8dde-bb2f02593eca.png" alt="inline"></p>
<h3 id="If-not-equal"><a href="#If-not-equal" class="headerlink" title="If not equal"></a>If not equal</h3><p>We continue with the next letter from the destination collection. Here “k” and “a” are not the same. We take minimum value from left, top, top left. Then increase by one</p>
<p><img src="https://user-images.githubusercontent.com/2284279/33243912-9f371230-d2ee-11e7-8386-85ed3f9f4bcf.png" alt="inline"></p>
<p>Here we take value from left, which is horizontally, so we increase by 1 insertion</p>
<h3 id="“k”-gt-“kat”-👉-2-insertions"><a href="#“k”-gt-“kat”-👉-2-insertions" class="headerlink" title="“k” -&gt; “kat” 👉 2 insertions"></a>“k” -&gt; “kat” 👉 2 insertions</h3><p>Continue, they are not the same, so we take value from left horizontally. Here you can see it kind makes sense, as to go from “k” to “kat”, we need 2 insertions, which is to insert letters “a” and “t”</p>
<p><img src="https://user-images.githubusercontent.com/2284279/33243913-9f4ed1ea-d2ee-11e7-9fae-71693ec1844d.png" alt="inline"></p>
<h3 id="The-bottom-right-value"><a href="#The-bottom-right-value" class="headerlink" title="The bottom right value"></a>The bottom right value</h3><p>Continue with the next row, and next row until we  got to the bottom right value, which gives you the edit distance. Here 1 substitution means that we need to perform 1 substitution to go from “kit” to “kat”, which is update “i” with “a’</p>
<p><img src="https://user-images.githubusercontent.com/2284279/35505204-a7b5f0f6-04e5-11e8-8124-4e8868f2ea8d.png" alt="final"></p>
<p>You can easily see that we need to update index 1. But how do we know that it is index 1 🤔 </p>
<h2 id="Edit-steps"><a href="#Edit-steps" class="headerlink" title="Edit steps"></a>Edit steps</h2><p>In each step, we need to associate the index of item in source and destination collection. You can take a look at my implementation <a href="https://github.com/onmyway133/DeepDiff">DeepDiff</a></p>
<p><img src="https://github.com/onmyway133/DeepDiff/raw/master/Screenshots/collection.gif" alt="inline"></p>
<h2 id="Complexity"><a href="#Complexity" class="headerlink" title="Complexity"></a>Complexity</h2><p>We iterate through the matrix, with <code>m</code> and <code>n</code> are the length of source and destination collection respectively, we can see that the complexity of this algorithm is 0(mn).</p>
<p>Also the performance greatly depends on the size of the collection and how complex the item is. The more complex and how deep you want to perform <code>Equatable</code> can greatly affect your performance.</p>
<h2 id="Improving-performance"><a href="#Improving-performance" class="headerlink" title="Improving performance"></a>Improving performance</h2><p>The section <a href="https://github.com/onmyway133/DeepDiff#how-does-it-work">How does it work</a> shows several ways we can improve performance.</p>
<p>Firstly, instead of building a matrix, which costs memory <code>m*n</code>, we can just use temporary arrays as holder. </p>
<p>Secondly, to quickly compare 2 items, we can use <code>Hashable</code>, as 2 identical items will always have the same hash.</p>
<h2 id="More-performance"><a href="#More-performance" class="headerlink" title="More performance"></a>More performance</h2><p>If you want better performance, then algorithms with linear complexity may be interested to you. Take a look at <a href="https://github.com/onmyway133/blog/issues/99">Diff algorithm</a></p>
<ul>
<li><a href="http://documents.scribd.com/docs/10ro9oowpo1h81pgh1as.pdf">Heckel</a></li>
<li><a href="https://publications.mpi-cbg.de/Wu_1990_6334.pdf">Wu</a></li>
<li><a href="http://www.xmailserver.org/diff2.pdf">Myers</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-12-01T12:41:58.000Z" title="2017-12-01T12:41:58.000Z">2017-12-01</time><span class="level-item">3 minutes read (About 468 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/Using-Playground-with-CocoaPods/">Using Playground with CocoaPods</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/113">#113</a></strong></p>
<p>This is a follow up from my post <a href="https://github.com/onmyway133/blog/issues/94">Learning from Open Source: Using Playground</a> on how to actually add a playground to your production project.</p>
<p>The idea is simple: create a framework so that Playground can access the code. This demo an iOS project with CocoaPods. See the demo <a href="https://github.com/onmyway133/UsingPlayground">https://github.com/onmyway133/UsingPlayground</a></p>
<p>This is also my question to this question <a href="https://stackoverflow.com/questions/47589855/how-to-expose-your-project-code-to-a-xcode-playground-when-using-cocoapods/47595120#47595120">https://stackoverflow.com/questions/47589855/how-to-expose-your-project-code-to-a-xcode-playground-when-using-cocoapods/47595120#47595120</a></p>
<h3 id="1-Add-a-pod"><a href="#1-Add-a-pod" class="headerlink" title="1. Add a pod"></a>1. Add a pod</h3><p>Create a new project called <code>UsingPlayground</code>. Create a <code>Podfile</code> with a pod <a href="https://github.com/hyperoslo/Cheers">Cheers</a> because we want something fun 😄 </p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">platform <span class="symbol">:ios</span>, <span class="string">'9.0'</span></span><br><span class="line">use_frameworks!</span><br><span class="line"></span><br><span class="line">pod <span class="string">'Cheers'</span></span><br><span class="line"></span><br><span class="line">target <span class="string">'UsingPlayground'</span></span><br></pre></td></tr></table></figure>

<h3 id="2-Use-the-pod-in-your-project"><a href="#2-Use-the-pod-in-your-project" class="headerlink" title="2. Use the pod in your project"></a>2. Use the pod in your project</h3><p>This is very straightforward. Just to make sure the pod work</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> Cheers</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> cheerView = <span class="type">CheerView</span>()</span><br><span class="line">    view.addSubview(cheerView)</span><br><span class="line">    cheerView.frame = view.bounds</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Configure</span></span><br><span class="line">    cheerView.config.particle = .confetti</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Start</span></span><br><span class="line">    cheerView.start()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Build and run the project to enjoy a very fascinating confetti 🎊 </p>
<h3 id="3-Add-a-CocoaTouch-framework"><a href="#3-Add-a-CocoaTouch-framework" class="headerlink" title="3. Add a CocoaTouch framework"></a>3. Add a CocoaTouch framework</h3><p>In your workspace, select the <code>UsingPlayground</code> project, add new CocoaTouch framework. Let’s call it <code>AppFramework</code>. </p>
<p><img src="https://user-images.githubusercontent.com/2284279/33485759-e6a9779a-d6a7-11e7-850d-05aceec69e37.png" alt="framework"></p>
<p>Then add source files to this framework. For now, just check file <code>ViewController.swift</code> add add it to the <code>AppFramework</code> target too.</p>
<p><img src="https://user-images.githubusercontent.com/2284279/33485764-e9ebf3f6-d6a7-11e7-8b61-b97c3a8774aa.png" alt="targets"></p>
<h3 id="4-Public"><a href="#4-Public" class="headerlink" title="4. Public"></a>4. Public</h3><p>Swift types and methods are internal by default. So in order for them to be visible in the Playground, we need to declare them as public.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public class ViewController: UIViewController &#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-Add-pod-to-AppFramework"><a href="#5-Add-pod-to-AppFramework" class="headerlink" title="5. Add pod to AppFramework"></a>5. Add pod to AppFramework</h3><p>In order for AppFramework to use our pods, we need to add those pods into framework target as well. Add <code>target &#39;AppFramework&#39;</code> to your Podfile</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">platform <span class="symbol">:ios</span>, <span class="string">'9.0'</span></span><br><span class="line"></span><br><span class="line">use_frameworks!</span><br><span class="line"></span><br><span class="line">pod <span class="string">'Cheers'</span></span><br><span class="line"></span><br><span class="line">target <span class="string">'UsingPlayground'</span></span><br><span class="line">target <span class="string">'AppFramework'</span></span><br></pre></td></tr></table></figure>

<p>Now run <code>pod install</code> again. In some rare cases, you need to run <code>pod deintegrate</code> and <code>pod install</code> to start from a clean slate</p>
<h3 id="6-Add-a-Playground"><a href="#6-Add-a-Playground" class="headerlink" title="6. Add a Playground"></a>6. Add a Playground</h3><p>Add a Playground and drag that to our workspace. Let’s call it <code>MyPlayground</code></p>
<p><img src="https://user-images.githubusercontent.com/2284279/33485907-6a88a4a0-d6a8-11e7-8f03-dec00122601d.png" alt="play"></p>
<h3 id="6-Enjoy"><a href="#6-Enjoy" class="headerlink" title="6. Enjoy"></a>6. Enjoy</h3><p>Now edit our <code>MyPlayground</code>. You can import frameworks from pod and our <code>AppFramework</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> Cheers</span><br><span class="line"><span class="keyword">import</span> AppFramework</span><br><span class="line"><span class="keyword">import</span> PlaygroundSupport</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> cheerView = <span class="type">CheerView</span>()</span><br><span class="line">cheerView.frame = <span class="type">CGRect</span>(x: <span class="number">0</span>, y: <span class="number">50</span>, width: <span class="number">200</span>, height: <span class="number">400</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Configure</span></span><br><span class="line">cheerView.config.particle = .confetti</span><br><span class="line"></span><br><span class="line"><span class="comment">// Start</span></span><br><span class="line">cheerView.start()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> myController = <span class="type">ViewController</span>()</span><br><span class="line"></span><br><span class="line"><span class="type">PlaygroundPage</span>.current.liveView = myController.view</span><br></pre></td></tr></table></figure>

<p>Remember to toggle Editor Mode so you can see Playground result</p>
<p><img src="https://user-images.githubusercontent.com/2284279/33485980-b221c1ac-d6a8-11e7-9214-15dbbc123380.png" alt="enjoy"></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-11-27T15:20:15.000Z" title="2017-11-27T15:20:15.000Z">2017-11-27</time><span class="level-item">27 minutes read (About 4118 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/URL-Routing-with-Compass/">URL Routing with Compass</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/110">#110</a></strong></p>
<p>Medium version <a href="https://medium.com/@onmyway133/url-routing-with-compass-d59c0061e7e2">https://medium.com/@onmyway133/url-routing-with-compass-d59c0061e7e2</a></p>
<hr>
<p>Apps often have many screens, and <code>UIViewController</code> works well as the basis for a screen, together with presentation and navigation APIs. Things are fine until you get lost in the forest of flows, and code becomes hard to maintain. </p>
<p>One way to avoid this is the <code>central URL routing</code> approach. Think of it as a network router that handles and resolves all routing requests. This way, the code becomes declarative and decoupled, so that the list component does not need to know what it’s presenting. URL routing also makes logging and tracking easy along with ease of handling external requests such as deep linking. </p>
<p>There are various frameworks that perform URL routing. In this tutorial you’ll use <a href="https://github.com/hyperoslo/Compass">Compass</a> for its simplicity. You’ll refactor an existing app, which is a simplified Instagram app named <code>PhotoFeed</code>. When you’ve finished this tutorial, you’ll know how to declare and use routers with Compass and handle deep linking. </p>
<h1 id="Getting-Started"><a href="#Getting-Started" class="headerlink" title="Getting Started"></a>Getting Started</h1><p>Download the <a href="https://github.com/onmyway133/PhotoFeed/tree/start">starter project</a> and unzip it. Go to the <code>PhotoFeed</code> folder and run <code>pod install</code> to install the particular dependencies for this project. Open <code>PhotoFeed.xcworkspace</code> and run the project. Tap <code>Login</code> to go to the Instagram login page and enter your Instagram credentials, then have a look around the app. </p>
<p><img src="https://user-images.githubusercontent.com/2284279/33277373-a808bf8a-d398-11e7-9b27-9ddc4549ffdc.png" alt="artboard"></p>
<p>The main app is made of a <code>UITabBarController</code> that shows the feed, the currently logged-in user profile and a menu. This is a typical <code>Model View Controller</code> project where <code>UIViewController</code> handles <code>Cell</code> delegates and takes responsibility for the navigation. For simplicity, all view controllers inherit from <code>TableController</code> and <code>CollectionController</code> that know how to manage list of a particular model and cell. All models conform to the new Swift 4 <code>Codable</code> protocol.</p>
<h2 id="Registering-Your-App-on-Instagram"><a href="#Registering-Your-App-on-Instagram" class="headerlink" title="Registering Your App on Instagram"></a>Registering Your App on Instagram</h2><p>In order to use the Instagram API, you’ll need to register your app at <a href="https://www.instagram.com/developer/">Instagram Developer</a>. After obtaining your <em>client id</em>, switch back to the project. Go to <code>APIClient.swift</code> and modify your <code>clientId</code>. </p>
<p><img src="https://user-images.githubusercontent.com/2284279/33277396-b40a3bec-d398-11e7-9f1d-3033870e0738.png" alt="artboard 2"></p>
<p><strong>Note</strong>: The project comes with a default app with limited permissions. The app can’t access following or follower APIs, and you can only see your own posts and comments</p>
<h1 id="Compass-101"><a href="#Compass-101" class="headerlink" title="Compass 101"></a>Compass 101</h1><p>The concept of Compass is very simple: you have a set of routes and central place for handling these routes. Think of a route as a navigation request to a specific screen within the app. The idea behind URL routing is borrowed from the modern web server. When user enters a URL into the browser, such as <code>https://flawlessapp.io/category/ios</code>, that request is sent from the browser to the web server. The server parses the URL and returns the requested content, such as HTML or JSON. Most web server frameworks have URL routing support, including <a href="https://expressjs.com/en/guide/routing.html">ASP.NET</a>, <a href="https://expressjs.com/en/guide/routing.html">Express.js</a>, and others. For example, here is how you handle a URL route in express.js:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app.get(<span class="string">'/api/category/:categoryTag'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> page = getCategoryPageFor(req.params.categoryTag)</span><br><span class="line">  res.send(page)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>Users or apps request a specific URL that express an intent about what should be returned or displayed. But instead of returning web pages, Compass constructs screens in terms of <code>UIViewController</code> and presents them.</p>
<h2 id="Route-Patterns"><a href="#Route-Patterns" class="headerlink" title="Route Patterns"></a>Route Patterns</h2><p>This is how you declare a routing schema in Compass:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Navigator</span>.routes = [<span class="string">"profile:&#123;userId&#125;"</span>, <span class="string">"post:&#123;postId&#125;"</span>, <span class="string">"logout"</span>]</span><br></pre></td></tr></table></figure>

<p>This is simply as array of patterns you register on the <code>Navigator</code>. This is the central place where you define all your routes. Since they are in one place, all your navigations are kept in one place and can easily be understood. Looking at the example above, <code>{userId}, {postId}</code> are placeholders that will be resolved to actual parameters. For example with <code>post:BYOkwgXnwr3</code>, you get <code>userId</code> of <code>BYOkwgXnwr3</code>. Compass also performs pattern matching, in that <code>post:BYOkwgXnwr3</code> matches <code>post:{postId}</code>, not <code>comment:{postId}</code>, <code>blogpost:{postId}</code>, …This will become to make sense in following sections. </p>
<h2 id="The-Navigator"><a href="#The-Navigator" class="headerlink" title="The Navigator"></a>The Navigator</h2><p>The <code>Navigator</code> is a the central place for routes registration, navigating and handling.</p>
<p><img src="https://user-images.githubusercontent.com/2284279/33277861-1855fa40-d39a-11e7-8449-0d10608d2501.png" alt="artboard 3"></p>
<p> The next step is to trigger a routing request. You can do that via the <code>Navigator</code>. For example, this is how you do  in the feed to request opening a specific post:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Navigator</span>.navigate(urn: <span class="string">"post:BYOkwgXnwr3"</span>)</span><br></pre></td></tr></table></figure>

<p>Compass uses the user-friendly <code>urn</code>, short for <a href="https://no.wikipedia.org/wiki/Uniform_Resource_Name">Uniform Resource Name</a> to make itwork seamlessly with <a href="https://en.wikipedia.org/wiki/Mobile_deep_linking">Deep Linking</a>. This <code>urn</code> matches the routing schema <code>post:{postId}</code>. Compass uses <code>{param}</code> as the special token to identifier the parameter and <code>:</code> as the delimiter. You can change the delimiter to something else by configuring <code>Navigator.delimiter</code>. You have learned how to register routes and navigate in Compass. Next, you will learn how to customize the handling code to your need.</p>
<h2 id="Location"><a href="#Location" class="headerlink" title="Location"></a>Location</h2><p><code>Navigator</code> parses and works with <code>Location</code> under the hood. Given the <code>URN</code> of <code>post:BYOkwgXnwr3</code>, you get a <code>Location</code> where <code>path</code> is the route pattern, and <code>arguments</code> contain the resolved parameters.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">path = <span class="string">"post:&#123;postId&#125;"</span></span><br><span class="line">arguments = [</span><br><span class="line">  <span class="string">"postId"</span>: <span class="string">"BYOkwgXnwr3"</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>To actually perform the navigation, you assign a closure that takes a <code>Location</code> to <code>Navigator.handle</code>.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Navigator</span>.handle = &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] location <span class="keyword">in</span></span><br><span class="line">  <span class="keyword">guard</span> <span class="keyword">let</span> `<span class="keyword">self</span>` = <span class="keyword">self</span> <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> arguments = location.arguments</span><br><span class="line"></span><br><span class="line">  <span class="keyword">switch</span> location.path &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"post:&#123;postId&#125;"</span>:</span><br><span class="line">      <span class="keyword">let</span> postController = <span class="type">PostController</span>(postId: postID)</span><br><span class="line">      <span class="keyword">self</span>.rootController.pushViewController(postController, animated: <span class="literal">true</span>)</span><br><span class="line">    <span class="keyword">default</span>: </span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The <code>let</code>self<code>= self</code> dance is to ensure <code>self</code> isn’t released by the time this closure is executed. If it is released, the routing it’s about to perform is likely invalid, and you return without doing anything instead. You should typically do the above  in the components that own the root controller, such as <code>AppDelegate</code> as seen above.  That’s the basic of Compass. Astute readers may have noticed that it does not scale, as the number of <code>switch</code> statements will grow as the number of routes and endpoints increase in your app. This is where the <code>Routable</code> protocol comes in.  Anything conforming to <code>Routable</code> knows how to handle a specific route. Apps may have many modular sections, and each section may have a set of routes. Compass handles these scenario by using a composite <code>Routable</code> named <code>Router</code> that groups them . You can have a router for a pre-login module, a post-login module, premium features module, and so on. </p>
<p><img src="https://user-images.githubusercontent.com/2284279/33277894-2eff78de-d39a-11e7-8554-bf064b621921.png" alt="untitled 2 2017-08-30 09-53-58"></p>
<p>In the next section, you’ll change PhotoFeed to use <code>Router</code> and <code>Routable</code>.</p>
<h1 id="Router-to-the-Rescue"><a href="#Router-to-the-Rescue" class="headerlink" title="Router to the Rescue"></a>Router to the Rescue</h1><p>The first step is to include Compass in your project. Using <code>CocoaPods</code>, this is an easy task. Edit the <code>Podfile</code> with the project and type <code>pod &#39;Compass&#39;, &#39;~&gt; 5.0&#39;</code> just before the <code>end</code> statement. Then open Terminal and execute the following:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod install</span><br></pre></td></tr></table></figure>

<p>The version of Compass used in this tutorial is <code>5.1.0</code>.</p>
<h2 id="Registering-a-Router"><a href="#Registering-a-Router" class="headerlink" title="Registering a Router"></a>Registering a Router</h2><p><img src="https://user-images.githubusercontent.com/2284279/33277916-3da628f6-d39a-11e7-9652-b45ea4a935fd.png" alt="untitled 2 2017-08-30 10-04-50"></p>
<p>To start, you’ll create a simple router to handle all post-login routes. Open <em>AppDelegate.swift</em>, and import Compass at the top of the file:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Compass</span><br></pre></td></tr></table></figure>

<p>Next, add the following router declaration under the <code>var mainController: MainController?</code> declaration:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> postLoginRouter = <span class="type">Router</span>()</span><br></pre></td></tr></table></figure>

<p>Then declare a function called <code>setupRouting</code>, you ‘ll do this in an extension to separate the routing setup from the main code in <code>AppDelegate</code>. </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">AppDelegate</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">setupRouting</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// [1] Register scheme</span></span><br><span class="line">    <span class="type">Navigator</span>.scheme = <span class="string">"photofeed"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// [2] Configure routes for Router</span></span><br><span class="line">    postLoginRouter.routes = [:]</span><br><span class="line"></span><br><span class="line">    <span class="comment">// [3] Register routes you 'd like to support</span></span><br><span class="line">    <span class="type">Navigator</span>.routes = <span class="type">Array</span>(postLoginRouter.routes.keys)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// [4] Do the handling</span></span><br><span class="line">    <span class="type">Navigator</span>.handle = &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] location <span class="keyword">in</span></span><br><span class="line">      <span class="keyword">guard</span> <span class="keyword">let</span> selectedController = <span class="keyword">self</span>?.mainController?.selectedViewController <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// [5] Choose the current visible controller</span></span><br><span class="line">      <span class="keyword">let</span> currentController = (selectedController <span class="keyword">as</span>? <span class="type">UINavigationController</span>)?.topViewController</span><br><span class="line">        ?? selectedController</span><br><span class="line"></span><br><span class="line">      <span class="comment">// [6] Navigate</span></span><br><span class="line">      <span class="keyword">self</span>?.postLoginRouter.navigate(to: location, from: currentController)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Here’s what you do in the above method:</p>
<ol>
<li>Declare a scheme for Compass to work. This is your application URL scheme. This shines when you wish to support deep linking .</li>
<li>Register all the routes in your app. <code>Router</code> accepts a mapping of route and <code>Routable</code> conformers. This is empty for now, but you will add several routes in a moment.</li>
<li>A <code>Navigator</code> can manage multiple routers. In this case, you only register one router.</li>
<li>This is where you supply the handling closure. <code>Navigator</code> uses this to handle a resolved location request.</li>
<li>Screens in one modular section originate from one root or parent view controller. In order to show something from the route, you should try to push or present it from the selected most-visible view controller. In this project, the root is a <code>UITabBarController</code>, so you try to get the top controller from the current selected navigation. The selection of <code>current controller</code> depends on the module and your app use cases, so Compass let you decide it.  If you use the side menu drawer, then you can just change the selected view controller.</li>
<li>Finally, since <code>Router</code> is a composite <code>Routable</code>, you dispatch to it the <code>Location</code>.</li>
</ol>
<p><img src="https://user-images.githubusercontent.com/2284279/33277961-531e6342-d39a-11e7-9199-158a469a3709.png" alt="main storyboard 2017-08-30 10-37-16"></p>
<p>Finally, you need to call this newly added function. Add the following line right above <code>window?.makeKeyAndVisible()</code>:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setupRouting()</span><br></pre></td></tr></table></figure>

<p>Build and run. Nothing seems to work yet! To make things happen, you’ll need to add all the route handlers. You’ll do this in the next section.</p>
<h2 id="Implementing-the-Route-Handlers"><a href="#Implementing-the-Route-Handlers" class="headerlink" title="Implementing the Route Handlers"></a>Implementing the Route Handlers</h2><p>First, create a new file and name it <code>Routers.swift</code>. This is where you’ll declare all of your route handlers. At the beginning of the file, add <code>import Compass</code>. Compass declares a simple protocol — <code>Routable</code> — that decides what to do with a given <code>Location</code> request from a <code>Current Controller</code>. If a request can’t be handled, it will throw with <code>RouteError</code>. Its implementation looks like this: </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">protocol</span> <span class="title">Routable</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">navigate</span><span class="params">(to location: Location, from currentController: CurrentController)</span></span> <span class="keyword">throws</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>It’s an incredibly simple protocol. Any routes you create only need to implement that single method. Now create your first handler to deal with user info request. </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">UserRoute</span>: <span class="title">Routable</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">navigate</span><span class="params">(to location: Location, from currentController: CurrentController)</span></span> <span class="keyword">throws</span> &#123;</span><br><span class="line">    <span class="comment">// [1] Examine arguments</span></span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> userId = location.arguments[<span class="string">"userId"</span>] <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// [2] Create the controller</span></span><br><span class="line">    <span class="keyword">let</span> controller = <span class="type">UIStoryboard</span>(name: <span class="string">"Main"</span>, bundle: <span class="literal">nil</span>).instantiateViewController(withIdentifier: <span class="string">"UserController"</span>) <span class="keyword">as</span>! <span class="type">UserController</span></span><br><span class="line">    controller.userId = userId</span><br><span class="line">    currentController.navigationController?.pushViewController(controller, animated: <span class="literal">true</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This is called when you touch the post author on the feed. Here’s what’s happening:</p>
<ol>
<li><code>UserRoute</code> deals with <code>user:{userId} urn</code>, so <code>location.arguments[&quot;userId&quot;]</code> should contain the correct <code>userId</code> to inject into <code>UserController</code>.</li>
<li>This app uses storyboards to make the UI, so get the correct view controller based on its identifier. Remember tha <code>currentController</code> is the current visible controller in the navigation stack. So you ask for its <code>UINavigationController</code> to push a new view controller.</li>
</ol>
<p>Right below this router, add one more route for the screen shown when the user wants to see who likes a particular post:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">LikesRoute</span>: <span class="title">Routable</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">navigate</span><span class="params">(to location: Location, from currentController: CurrentController)</span></span> <span class="keyword">throws</span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> mediaId = location.arguments[<span class="string">"mediaId"</span>] <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> controller = <span class="type">UIStoryboard</span>(name: <span class="string">"Main"</span>, bundle: <span class="literal">nil</span>).instantiateViewController(withIdentifier: <span class="string">"LikesController"</span>) <span class="keyword">as</span>! <span class="type">LikesController</span></span><br><span class="line">    controller.mediaId = mediaId</span><br><span class="line">    currentController.navigationController?.pushViewController(controller, animated: <span class="literal">true</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="The-remaining-Route"><a href="#The-remaining-Route" class="headerlink" title="The remaining Route"></a>The remaining Route</h3><p>Now it’s your turn to write the other route handlers: <code>CommentsRoute, FollowingRoute, FollowerRoute</code>. See if you can figure it out first, you can find the solution below. Here’s what you should have:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">CommentsRoute</span>: <span class="title">Routable</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">navigate</span><span class="params">(to location: Location, from currentController: CurrentController)</span></span> <span class="keyword">throws</span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> mediaId = location.arguments[<span class="string">"mediaId"</span>] <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> controller = <span class="type">UIStoryboard</span>(name: <span class="string">"Main"</span>, bundle: <span class="literal">nil</span>).instantiateViewController(withIdentifier: <span class="string">"CommentsController"</span>) <span class="keyword">as</span>! <span class="type">CommentsController</span></span><br><span class="line">    controller.mediaId = mediaId</span><br><span class="line">    currentController.navigationController?.pushViewController(controller, animated: <span class="literal">true</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">FollowingRoute</span>: <span class="title">Routable</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">navigate</span><span class="params">(to location: Location, from currentController: CurrentController)</span></span> <span class="keyword">throws</span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> userId = location.arguments[<span class="string">"userId"</span>] <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> controller = <span class="type">UIStoryboard</span>(name: <span class="string">"Main"</span>, bundle: <span class="literal">nil</span>).instantiateViewController(withIdentifier: <span class="string">"FollowingController"</span>) <span class="keyword">as</span>! <span class="type">FollowingController</span></span><br><span class="line">    controller.userId = userId</span><br><span class="line">    currentController.navigationController?.pushViewController(controller, animated: <span class="literal">true</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">FollowerRoute</span>: <span class="title">Routable</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">navigate</span><span class="params">(to location: Location, from currentController: CurrentController)</span></span> <span class="keyword">throws</span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> userId = location.arguments[<span class="string">"userId"</span>] <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> controller = <span class="type">UIStoryboard</span>(name: <span class="string">"Main"</span>, bundle: <span class="literal">nil</span>).instantiateViewController(withIdentifier: <span class="string">"FollowerController"</span>) <span class="keyword">as</span>! <span class="type">FollowerController</span></span><br><span class="line">    controller.userId = userId</span><br><span class="line">    currentController.navigationController?.pushViewController(controller, animated: <span class="literal">true</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="The-LogoutRoute"><a href="#The-LogoutRoute" class="headerlink" title="The LogoutRoute"></a>The LogoutRoute</h3><p>There is one more route to add: the one you’ll use for logout. <code>LogoutRoute</code> is quite tricky, as it usually involves changing the current root view controller. Who knows this better than the app delegate? Open <em>AppDelegate.swift</em> and add the following code at the very bottom:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">LogoutRoute</span>: <span class="title">Routable</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">navigate</span><span class="params">(to location: Location, from currentController: CurrentController)</span></span> <span class="keyword">throws</span> &#123;</span><br><span class="line">    <span class="type">APIClient</span>.shared.accessToken = <span class="literal">nil</span></span><br><span class="line">    (<span class="type">UIApplication</span>.shared.delegate <span class="keyword">as</span>! <span class="type">AppDelegate</span>).showLogin()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Now that you’ve implemented all of the route handlers, you will have to tell <code>Navigator</code> which route is used for which URN. Still in <em>AppDelegate.swift</em>, find <code>postLoginRouter.routes = [:]</code> and replace it with the following:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">postLoginRouter.routes = [</span><br><span class="line">  <span class="string">"user:&#123;userId&#125;"</span>: <span class="type">UserRoute</span>(),</span><br><span class="line">  <span class="string">"comments:&#123;mediaId&#125;"</span>: <span class="type">CommentsRoute</span>(),</span><br><span class="line">  <span class="string">"likes:&#123;mediaId&#125;"</span>: <span class="type">LikesRoute</span>(),</span><br><span class="line">  <span class="string">"following:&#123;userId&#125;"</span>: <span class="type">FollowingRoute</span>(),</span><br><span class="line">  <span class="string">"follower:&#123;userId&#125;"</span>: <span class="type">FollowerRoute</span>(),</span><br><span class="line">  <span class="string">"logout"</span>: <span class="type">LogoutRoute</span>()</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>Build the app and everything should compile. Now all that’s left is to actually <em>all</em> all of the code you’ve written!</p>
<h2 id="Refactoring-Time"><a href="#Refactoring-Time" class="headerlink" title="Refactoring Time"></a>Refactoring Time</h2><p>It’s time to refactor all the code in <code>UIViewController</code> by replacing all the navigation code with your new routing instructions. Start by freeing the <code>FeedController</code> from the unnecessary tasks of navigation. Open <em>FeedController.swift</em> and add the following import to the top of the file:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Compass</span><br></pre></td></tr></table></figure>

<p>Next, look for <code>// MARK: - MediaCellDelegate</code> and replace the three <code>MediaCell</code> delegate methods with the following:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">mediaCell</span><span class="params">(<span class="number">_</span> cell: MediaCell, didViewLikes mediaId: String)</span></span> &#123;</span><br><span class="line">  <span class="keyword">try</span>? <span class="type">Navigator</span>.navigate(urn: <span class="string">"likes:\(mediaId)"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">mediaCell</span><span class="params">(<span class="number">_</span> cell: MediaCell, didViewComments mediaId: String)</span></span> &#123;</span><br><span class="line">  <span class="keyword">try</span>? <span class="type">Navigator</span>.navigate(urn: <span class="string">"comments:\(mediaId)"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">mediaCell</span><span class="params">(<span class="number">_</span> cell: MediaCell, didSelectUserName userId: String)</span></span> &#123;</span><br><span class="line">  <span class="keyword">try</span>? <span class="type">Navigator</span>.navigate(urn: <span class="string">"user:\(userId)"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>For these three cases, you simply want to navigate to another screen. Therefore, all you need to do is tell the <code>Navigator</code> where you want to go. For simplicity, you use <code>try?</code> to deal with any code that throws. Build and run the app. Search for your favorite post in the feed, and tap on the author, the post comments or likes to go to the target screen. The app behaves the same as it did before, but the code is now clean and declarative. Now do the same with <em>UserController.swift</em>. Add the following import to the top of the file:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Compass</span><br></pre></td></tr></table></figure>

<p>Replace the code after <code>// MARK: - UserViewDelegate</code> with the following:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">userView</span><span class="params">(<span class="number">_</span> view: UserView, didViewFollower userId: String)</span></span> &#123;</span><br><span class="line">  <span class="keyword">try</span>? <span class="type">Navigator</span>.navigate(urn: <span class="string">"follower:\(userId)"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">userView</span><span class="params">(<span class="number">_</span> view: UserView, didViewFollowing userId: String)</span></span> &#123;</span><br><span class="line">  <span class="keyword">try</span>? <span class="type">Navigator</span>.navigate(urn: <span class="string">"following:\(userId)"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Your task now is to refactor with the last route <code>LogoutRoute</code>. Open <em>MenuController.swift</em> and add the following to the top:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Compass</span><br></pre></td></tr></table></figure>

<p>Remove the <code>logout</code> method altogether. Find the following:</p>
<figure class="highlight plain"><figcaption><span>indexPath.section </span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">  logout()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>…and replace it with:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> indexPath.section == <span class="type">Section</span>.account.rawValue, indexPath.row == <span class="number">0</span> &#123;</span><br><span class="line">  <span class="keyword">try</span>? <span class="type">Navigator</span>.navigate(urn: <span class="string">"logout"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Build and run the app, navigate to the menu and tap <em>Logout</em>. You should be taken to the login screen.</p>
<h1 id="Handling-Deep-Linking"><a href="#Handling-Deep-Linking" class="headerlink" title="Handling Deep Linking"></a>Handling Deep Linking</h1><p><a href="https://en.wikipedia.org/wiki/Mobile_deep_linking">Deep linking</a> allows your apps to be opened via a predefined URN. The system identifies each app via its <a href="https://developer.apple.com/library/content/documentation/iPhone/Conceptual/iPhoneOSProgrammingGuide/Inter-AppCommunication/Inter-AppCommunication.html">URL scheme</a>. For web pages, the scheme is usually <code>http</code>, <code>https</code>. For <em>Instagram</em> it is, quite handily, <code>instagram</code>. Use cases for this are inter-app navigation and app advertisements. For examples, the Messenger app uses this to open the user profile in the Facebook app, and Twitter uses this to open the App Store to install another app from an advertisement. In order for user to be redirected back to PhotoFeed, you need to specify a custom URL scheme for your app. Remember where you declared <code>Navigator.scheme = &quot;photofeed&quot;</code>? PhotoFeed just so happens to conform to this URL scheme, so deep links already worked — and you didn’t even know it! Build and run the app, then switch to Safari. Type <code>photofeed://</code> in the address bar, then tap Go. That will trigger your app to open. The app opens, but PhotoFeed doesn’t parse any parameters in the URL to go anywhere useful. Time to change that! Your app responds to the URL scheme opening by implementing a <code>UIApplicationDelegate</code> method. Add the following after <code>setupRouting</code> in <code>AppDelegate.swift</code>:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">application</span><span class="params">(<span class="number">_</span> app: UIApplication, <span class="keyword">open</span> url: URL, options: [UIApplicationOpenURLOptionsKey : <span class="keyword">Any</span>] = [:])</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">  <span class="keyword">try</span>? <span class="type">Navigator</span>.navigate(url: url)</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Navigator</code> parses and handles this for you. Build and run again. Go to Safari app, type <code>photofeed://user:self</code> and tap Go. Photofeed will open and show the currently logged in users’ profile. Because you already had <code>UserRoute</code>, the requested URL was handled gracefully. Your app may already be presenting a particular screen when a routing request comes, but you’ve anticipated this by resetting the navigation controller or presentation stack to show the requested screen. This simple solution works for most cases. Again, it’s recommended you pick the topmost visible view controller as the current controller in <code>Navigator.handle</code>.</p>
<p><img src="https://user-images.githubusercontent.com/2284279/33277990-709ae7c4-d39a-11e7-99b2-27acb7a1c5d0.png" alt="artboard 5"></p>
<p>Deep linking is usually considered external navigation, in that the routing requests come from outside your app. Thanks to the central routing system that you developed, the code to handle external and internal routing requests is very much the same and involves no code duplication at all.</p>
<h1 id="Routing-with-Push-Notifications"><a href="#Routing-with-Push-Notifications" class="headerlink" title="Routing with Push Notifications"></a>Routing with Push Notifications</h1><p>Push notifications help engage users with your app. You may have received messages like “Hey, checkout today ‘s most popular stories” on <em>Medium</em>, “Your friend has a birthday today” on Facebook, … and when you tap those banners, you are taken straight to that particular screen. How cool is that? This is achievable with your URL routing approach. Imagine users tapping a push notification banner saying “You’re a celebrity on PhotoFeed — check out your profile now!” and being sent directly to their profile screen. To accomplish this, you simply have to embed the URN info into the push payload and handle that in your app.</p>
<h2 id="Setting-up"><a href="#Setting-up" class="headerlink" title="Setting up"></a>Setting up</h2><p>To start, you’ll need to specify your bundle ID. Go to <code>Target Settings\General</code> to change your bundle ID as push notification requires a unique bundle ID to work. Your project uses <code>com.fantageek.PhotoFeed</code> by default.</p>
<p><img src="https://user-images.githubusercontent.com/2284279/33278026-8e1fe01a-d39a-11e7-982f-854ab7056aca.png" alt="step1_bundleid"> </p>
<p>Next, you’ll need to register your <em>App ID</em>. Go to <a href="https://developer.apple.com/account/ios/certificate">Member Center</a> and register your App ID. Remember your <em>Team ID</em>, as you will need it in the final step. Also tick the <em>Push Notification</em> checkbox under <em>Application Services</em>. </p>
<p><img src="https://user-images.githubusercontent.com/2284279/33278038-94947866-d39a-11e7-9386-8fffcd5bf9cf.png" alt="step1_appid"></p>
<p>Now you’ll need to generate your <em>Authentication Key</em>. Apple provides <a href="https://developer.apple.com/news/?id=09222016a">Token Authentication</a> as a new authentication mechanism for push notifications. The token is easy to generate, works for all your apps, and mostly, it never expires. Still in <a href="https://developer.apple.com/account/ios/authkey/">Member Center</a>, create a new <em>Key</em> and download it as a <code>.p8</code> file. Remember your <em>Key ID</em> as you will need it in the final step. </p>
<p><img src="https://user-images.githubusercontent.com/2284279/33278050-9bb3ccc8-d39a-11e7-99b8-076138e5b559.png" alt="step2_key"></p>
<p>Next up: enabling push notification capability. Back in Xcode, go to <code>Target Settings\Capabilities</code> and enable <em>Push Notifications</em>, which will add <code>PhotoFeed.entitlements</code> to your project. </p>
<p><img src="https://user-images.githubusercontent.com/2284279/33278054-a21dde8c-d39a-11e7-907b-b1ec620050b4.png" alt="step3_capability"></p>
<p>The next step is to register for push notifications. Open <code>MainController.swift</code> and add the following import to the top of <em>MainController.swift</em>:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UserNotifications</span><br></pre></td></tr></table></figure>

<p>You want to enable push notification only after login, so <code>MainController</code> is the perfect place. <a href="https://developer.apple.com/documentation/usernotifications">UserNotifications</a> is recommended for app targeting iOS 10 and above.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// [1] Register to get device token for remote notifications</span></span><br><span class="line">  <span class="type">UIApplication</span>.shared.registerForRemoteNotifications()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// [2] Register to handle push notification UI</span></span><br><span class="line">  <span class="keyword">let</span> options: <span class="type">UNAuthorizationOptions</span> = [.alert, .sound, .badge]</span><br><span class="line">  <span class="type">UNUserNotificationCenter</span>.current().requestAuthorization(options: options) &#123; (granted, error) <span class="keyword">in</span></span><br><span class="line">    <span class="built_in">print</span>(error <span class="keyword">as</span> <span class="type">Any</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The permission dialog is shown once, so make sure you accept it. It’s time to handle the device token. Open <code>AppDelegate.swift</code>, and add the following to the end of <code>extension AppDelegate</code>:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">application</span><span class="params">(<span class="number">_</span> application: UIApplication, didRegisterForRemoteNotificationsWithDeviceToken deviceToken: Data)</span></span> &#123;</span><br><span class="line">  <span class="comment">// [1] Parse to token string</span></span><br><span class="line">  <span class="keyword">let</span> token = deviceToken.<span class="built_in">map</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">String</span>(format: <span class="string">"%02.2hhx"</span>, $<span class="number">0</span>)</span><br><span class="line">  &#125;.joined()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// [2] Log it</span></span><br><span class="line">  <span class="built_in">print</span>(<span class="string">"Your device token is \(token)"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This is where you get device token if your app successfully connects to APNs. Normally, you would send this device token to the backend so they can organize , but in this tutorial we just log it. It is required in the tool to be able to target a particular device.</p>
<h2 id="Handling-payload"><a href="#Handling-payload" class="headerlink" title="Handling payload"></a>Handling payload</h2><p>Open <code>AppDelegate.swift</code> and add the following to th end of <code>extension AppDelegate</code>:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">application</span><span class="params">(<span class="number">_</span> application: UIApplication, didReceiveRemoteNotification userInfo: [AnyHashable : <span class="keyword">Any</span>], fetchCompletionHandler completionHandler: @escaping <span class="params">(UIBackgroundFetchResult)</span></span></span> -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">  <span class="comment">// [1] Always call the completion handler</span></span><br><span class="line">  <span class="keyword">defer</span> &#123;</span><br><span class="line">    completionHandler(.newData)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// [2] Convert into JSON dictionary</span></span><br><span class="line">  <span class="keyword">guard</span> <span class="keyword">let</span> json = userInfo <span class="keyword">as</span>? [<span class="type">String</span>: <span class="type">Any</span>] <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// [3] Parse to aps</span></span><br><span class="line">  <span class="keyword">guard</span> <span class="keyword">let</span> aps = json[<span class="string">"aps"</span>] <span class="keyword">as</span>? [<span class="type">String</span>: <span class="type">Any</span>] <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// [4] Parse to urn</span></span><br><span class="line">  <span class="keyword">guard</span> <span class="keyword">let</span> urn = aps[<span class="string">"urn"</span>] <span class="keyword">as</span>? <span class="type">String</span> <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span>? <span class="type">Navigator</span>.navigate(urn: urn)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This method is called when your app receives push notification payload and is running. The above code is relatively straightforward: it first tries to parse the <code>urn</code> information from the payload, then tells <code>Navigator</code> to do the job . Build and run the app on the device, since push notifications won’t work on the simulator. Log in to the app if prompted. Once on the main screen, grant push notification permissions to the app in order to receive alerts. You should see the <code>device token</code> logged to your Xcode console. </p>
<div align="center">
<img src="https://user-images.githubusercontent.com/2284279/33278064-abbe6592-d39a-11e7-81cd-b3affc3ee4b6.PNG" height="500" />
</div>

<h2 id="Testing-Push-Notifications"><a href="#Testing-Push-Notifications" class="headerlink" title="Testing Push Notifications"></a>Testing Push Notifications</h2><p>In this tutorial, you’ll use a tool called <a href="https://github.com/onmyway133/PushNotifications">PushNotifications</a> to help you easily create push notifications for your app. Download the tool <code>PushNotifications</code> from <a href="https://github.com/onmyway133/PushNotifications/releases">here</a>. This tool sends payloads directly to APNs.</p>
<p><img src="https://user-images.githubusercontent.com/2284279/33278070-b3094632-d39a-11e7-81f6-62f1ed04130b.png" alt="step4_test"></p>
<p>Choose <code>iOS\Token</code> to use <code>Token Authentication</code>, you get that by creating and downloading your <code>Key</code> from <a href="https://developer.apple.com/account/ios/authkey/">Certificates, Identifiers &amp; Profiles</a>. Browse for the <code>.p8</code> auth key file that you downloaded earlier. Enter <code>Team ID</code>, you can check it by going to <a href="https://developer.apple.com/account/#/membership">Membership Details</a> Enter <code>Key ID</code>, this is the ID associated with the <code>Key</code> from the first step. Enter <code>Bundle ID</code> and <code>device token</code>. Paste the following into as. It is a traditional payload associated with the URN.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   <span class="attr">"aps"</span>:&#123;</span><br><span class="line">      <span class="attr">"alert"</span>:<span class="string">"You become a celebrity on PhotoFeed, checkout your profile now"</span>,</span><br><span class="line">      <span class="attr">"urn"</span>: <span class="string">"user:self"</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Since you’re debugging with Xcode, select <code>Sandbox</code> as environment.</p>
<div align="center">
<img src="https://user-images.githubusercontent.com/2284279/33278079-baef3ece-d39a-11e7-8818-56b54ed01a1d.PNG" height="500" />
</div>


<p>Tap <code>Send</code> now. If your app is in the background, an alert will appear. Tapping it will take you to your app and show you your user profile. Bravo! You just implemented deep linking in push notification, thanks again to the URL routing.</p>
<h1 id="Read-more"><a href="#Read-more" class="headerlink" title="Read more"></a>Read more</h1><p>Here is the <a href="https://github.com/onmyway133/PhotoFeed/tree/finish">final project</a> with all the code from this tutorial. You now understand central routing patterns, have mastered Compass and even refactored a real-world app. However, there is no silver bullet that works well for all apps. You need to understand your requirements and adjust accordingly. If you want to learn more about other navigation patterns, here are a few suggestions: </p>
<ul>
<li><a href="http://khanlou.com/2015/10/coordinators-redux/">Coordinator</a></li>
<li><a href="http://albertodebortoli.com/blog/2014/09/03/flow-controllers-on-ios-for-a-better-navigation-control/">Flow controller</a></li>
<li><a href="https://www.objc.io/issues/13-architecture/viper/">Routing in VIPER</a></li>
</ul>
<p>Remember, it’s not only about the code, but also about the user experience that your app provides. So please make sure you conform to the guidelines <a href="https://developer.apple.com/ios/human-interface-guidelines/interaction/navigation">Navigation in Human Interface Guidelines iOS</a>.</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-11-14T13:40:31.000Z" title="2017-11-14T13:40:31.000Z">2017-11-14</time><span class="level-item">15 minutes read (About 2300 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/Coordinator-and-FlowController/">Coordinator and FlowController</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/106">#106</a></strong></p>
<p>Every new architecture that comes out, either <a href="https://github.com/onmyway133/fantastic-ios-architecture">iOS</a> or <a href="https://github.com/onmyway133/fantastic-android-architecture">Android</a>, makes me very excited. I’m always looking for ways to structure apps in a better way. But after some times, I see that we’re too creative in creating architecture, aka constraint, that is too far away from the platform that we’re building. I often think “If we’re going too far from the system, then it’s very hard to go back”</p>
<p>I like things that embrace the system. One of them is <a href="http://khanlou.com/2015/10/coordinators-redux/">Coordinator</a> which helps in encapsulation and navigation. Thanks to my friend <a href="https://github.com/vadymmarkov/">Vadym</a> for showing me <code>Coordinator</code> in action.</p>
<p>The below screenshot from @khanlou ‘s <a href="https://www.youtube.com/watch?v=a1g3k3NObkE">talk</a> at CocoaHeads Stockholm clearly says many things about <code>Coordinator</code></p>
<div align="center">
<img src="https://user-images.githubusercontent.com/2284279/32828592-d03ad9a0-c9ef-11e7-8759-cb0292d668df.png" />
<br />
</div>

<p>But after reading <a href="https://davedelong.com/blog/2017/11/06/a-better-mvc-part-3-fixing-massive-view-controller/">A Better MVC</a>, I think we can leverage view controller containment to do navigation using <code>UIViewController</code> only.</p>
<p>Since I tend to call view controllers as <code>LoginController, ProfileController, ...</code> and the term <code>flow</code> to group those related screens, what should we call a <code>Coordinator</code> that inherits from <code>UIViewController</code> 🤔 Let’s call it <code>FlowController</code> 😎 . </p>
<p>The name is not that important, but the concept is simple. <code>FlowController</code> was also inspired by this <a href="http://albertodebortoli.com/blog/2014/09/03/flow-controllers-on-ios-for-a-better-navigation-control/">Flow Controllers on iOS for a Better Navigation Control</a> back in 2014. The idea is from awesome iOS people, this is just a sum up from my experience 😇 </p>
<p>So <code>FlowController</code> can just a <code>UIViewController</code> friendly version of <code>Coordinator</code>. Let see how <code>FlowController</code> fits better into <code>MVC</code></p>
<blockquote class="twitter-tweet" data-lang="no"><p lang="en" dir="ltr">«UIViewController is the center of the universe.»<br><br>— <a href="https://twitter.com/onmyway133?ref_src=twsrc%5Etfw">@onmyway133</a></p>&mdash; Elvis Nuñez (@3lvis) <a href="https://twitter.com/3lvis/status/916234962357153792?ref_src=twsrc%5Etfw">6. oktober 2017</a></blockquote>

<h2 id="1-FlowController-and-AppDelegate"><a href="#1-FlowController-and-AppDelegate" class="headerlink" title="1. FlowController and AppDelegate"></a>1. FlowController and AppDelegate</h2><p>Your application starts from <code>AppDelegate</code>, in that you setup <code>UIWindow</code>. So we should follow the same “top down” approach for <code>FlowController</code>, starting with <code>AppFlowController</code>. You can construct all dependencies that your app need for <code>AppFlowController</code>, so that it can pass to other child <code>FlowController</code>.</p>
<p><code>AppDelegate</code> is also considered <a href="http://blog.ploeh.dk/2011/07/28/CompositionRoot/">Composition Root</a></p>
<p>Here is how to declare <code>AppFlowController</code> in <code>AppDelegate</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">DependencyContainer</span>: <span class="title">AuthServiceContainer</span>, <span class="title">PhoneServiceContainer</span>, <span class="title">NetworkingServiceContainer</span>,</span></span><br><span class="line"><span class="class">  <span class="title">LocationServiceContainer</span>, <span class="title">MapServiceContainer</span>, <span class="title">HealthServiceContainer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> authService: <span class="type">AuthServiceProtocol</span></span><br><span class="line">  <span class="keyword">let</span> phoneService: <span class="type">PhoneService</span></span><br><span class="line">  <span class="keyword">let</span> networkingService: <span class="type">NetworkingService</span></span><br><span class="line">  <span class="keyword">let</span> locationService: <span class="type">LocationService</span></span><br><span class="line">  <span class="keyword">let</span> mapService: <span class="type">MapService</span></span><br><span class="line">  <span class="keyword">let</span> healthService: <span class="type">HealthService</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">make</span><span class="params">()</span></span> -&gt; <span class="type">DependencyContainer</span> &#123;</span><br><span class="line">    <span class="comment">// Configure and make DependencyContainer here</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@UIApplicationMain</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AppDelegate</span>: <span class="title">UIResponder</span>, <span class="title">UIApplicationDelegate</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> window: <span class="type">UIWindow?</span></span><br><span class="line">  <span class="keyword">var</span> appFlowController: <span class="type">AppFlowController!</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">application</span><span class="params">(<span class="number">_</span> application: UIApplication,</span></span></span><br><span class="line"><span class="function"><span class="params">                   didFinishLaunchingWithOptions launchOptions: [UIApplicationLaunchOptionsKey: <span class="keyword">Any</span>]?)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    appFlowController = <span class="type">AppFlowController</span>(</span><br><span class="line">      dependencyContainer: <span class="type">DependencyContainer</span>.make()</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    window = <span class="type">UIWindow</span>(frame: <span class="type">UIScreen</span>.main.bounds)</span><br><span class="line">    window?.rootViewController = appFlowController</span><br><span class="line">    window?.makeKeyAndVisible()</span><br><span class="line"></span><br><span class="line">    appFlowController.start()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Here are some hypothetical <code>FlowController</code> that you may encounter</p>
<ul>
<li>AppFlowController: manages UIWindow and check whether to show onboarding, login or main depending on authentication state<ul>
<li>OnboardingFlowController: manages <code>UIPageViewController</code> and maybe ask for some permissions</li>
<li>LoginFlowController: manages <code>UINavigationController</code> to show login, sms verification, forget password, and optionally start <code>SignUpFlowController</code></li>
<li>MainFlowController: manages <code>UITabBarController</code> with each tab serving main features<ul>
<li>FeedFlowController: show feed with list of items</li>
<li>ProfileFlowController: show profile</li>
<li>SettingsFlowController: show settings, and maybe call logout, this will delegates up the <code>FlowController</code> chain.</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>The cool thing about <code>FlowController</code> is it makes your code very self contained, and grouped by features. So it’s easy to move all related things to its own package if you like.</p>
<h2 id="2-FlowController-as-container-view-controller"><a href="#2-FlowController-as-container-view-controller" class="headerlink" title="2. FlowController as container view controller"></a>2. FlowController as container view controller</h2><blockquote>
<p>In general, a view controller should manage either sequence or UI, but not both.</p>
</blockquote>
<p>Basically, <code>FlowController</code> is just a container view controller to solve the <code>sequence</code>, based on a simple concept called <code>composition</code>. It manages many child view controllers in its flow. Let’ say we have a <code>ProductFlowController</code> that groups together flow related to displaying products, <code>ProductListController</code>, <code>ProductDetailController</code>, <code>ProductAuthorController</code>, <code>ProductMapController</code>, … Each can delegate to the <code>ProductFlowController</code> to express its intent, like <code>ProductListController</code> can delegate to say “product did tap”, so that <code>ProductFlowController</code> can construct and present the next screen in the flow, based on the embedded <code>UINavigationController</code> inside it.</p>
<p>Normally, a <code>FlowController</code> just displays 1 child <code>FlowController</code> at a time, so normally we can just update its frame</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">AppFlowController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLayoutSubviews</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.viewDidLayoutSubviews()</span><br><span class="line"></span><br><span class="line">    childViewControllers.first?.view.frame = view.bounds</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-FlowController-as-dependency-container"><a href="#3-FlowController-as-dependency-container" class="headerlink" title="3. FlowController as dependency container"></a>3. FlowController as dependency container</h2><p>Each view controller inside the flow can have different dependencies, so it’s not fair if the first view controller needs to carry all the stuff just to be able to pass down to the next view controllers. Here are some dependencies</p>
<ul>
<li>ProductListController: ProductNetworkingService</li>
<li>ProductDetailController: ProductNetworkingService, ImageDowloaderService, ProductEditService</li>
<li>ProductAuthorController: AuthorNetworkingService, ImageDowloaderService</li>
<li>ProductMapController: LocationService, MapService</li>
</ul>
<p>Instead the <code>FlowController</code> can carry all the dependencies needed for that whole flow, so it can pass down to the view controller if needed.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ProductDependencyContainer</span> </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> productNetworkingService: <span class="type">ProductNetworkingService</span></span><br><span class="line">  <span class="keyword">let</span> imageDownloaderService: <span class="type">ImageDownloaderService</span></span><br><span class="line">  <span class="keyword">let</span> productEditService: <span class="type">ProductEditService</span></span><br><span class="line">  <span class="keyword">let</span> authorNetworkingService: <span class="type">AuthorNetworkingService</span></span><br><span class="line">  <span class="keyword">let</span> locationService: <span class="type">LocationService</span></span><br><span class="line">  <span class="keyword">let</span> mapService: <span class="type">MapService</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProductFlowController</span> </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> dependencyContainer: <span class="type">ProductDependencyContainer</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">init</span>(dependencyContainer: <span class="type">ProductDependencyContainer</span>) &#123;</span><br><span class="line">    <span class="keyword">self</span>.dependencyContainer = dependencyContainer</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">ProductFlowController</span>: <span class="title">ProductListControllerDelegate</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">productListController</span><span class="params">(<span class="number">_</span> controller: ProductListController, didSelect product: Product)</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> productDetailController = <span class="type">ProductDetailController</span>(</span><br><span class="line">      productNetworkingService: dependencyContainer.productNetworkingService,</span><br><span class="line">      productEditService: dependencyContainer.productEditService,</span><br><span class="line">      imageDownloaderService: dependencyContainer.imageDownloaderService</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    productDetailController.delegate = <span class="keyword">self</span></span><br><span class="line">    embeddedNavigationController.pushViewController(productDetailController, animated: <span class="literal">true</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Here are some ways that you can use to pass dependencies into <code>FlowController</code></p>
<ul>
<li><a href="http://merowing.info/2017/04/using-protocol-compositon-for-dependency-injection/">Using protocol compositon for dependency injection</a></li>
<li><a href="https://www.swiftbysundell.com/posts/dependency-injection-using-factories-in-swift">Dependency injection using factories in Swift</a></li>
</ul>
<h2 id="4-Adding-or-removing-child-FlowController"><a href="#4-Adding-or-removing-child-FlowController" class="headerlink" title="4. Adding or removing child FlowController"></a>4. Adding or removing child FlowController</h2><p><strong>Coordinator</strong></p>
<p>With <code>Coordinator</code>, you need to keep an array of child <code>Coordinators</code>, and maybe use address (<code>===</code> operator) to identify them</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Coordinator</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">var</span> children: [<span class="type">Coordinator</span>] = []</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(child: Coordinator)</span></span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> !children.<span class="built_in">contains</span>(<span class="keyword">where</span>: &#123; $<span class="number">0</span> === child &#125;) <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    children.append(child)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">remove</span><span class="params">(child: Coordinator)</span></span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> index = children.index(<span class="keyword">where</span>: &#123; $<span class="number">0</span> === child &#125;) <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    children.remove(at: index)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">removeAll</span><span class="params">()</span></span> &#123;</span><br><span class="line">    children.removeAll()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>FlowController</strong></p>
<p>With <code>FlowController</code>, since it is <code>UIViewController</code> subclass, it has <code>viewControllers</code> to hold all those child <code>FlowController</code>. Just add these extensions to simplify your adding or removing of child <code>UIViewController</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(childController: UIViewController)</span></span> &#123;</span><br><span class="line">    addChildViewController(childController)</span><br><span class="line">    view.addSubview(childController.view)</span><br><span class="line">    childController.didMove(toParentViewController: <span class="keyword">self</span>)</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">remove</span><span class="params">(childController: UIViewController)</span></span> &#123;</span><br><span class="line">    childController.willMove(toParentViewController: <span class="literal">nil</span>)</span><br><span class="line">    childController.view.removeFromSuperview()</span><br><span class="line">    childController.removeFromParentViewController()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>And see in action how <code>AppFlowController</code> work with adding</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">AppFlowController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">start</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> authService.isAuthenticated &#123;</span><br><span class="line">      startMain()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      startLogin()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">startLogin</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> loginFlowController = <span class="type">LoginFlowController</span>(</span><br><span class="line">    loginFlowController.delegate = <span class="keyword">self</span></span><br><span class="line">    add(childController: loginFlowController)</span><br><span class="line">    loginFlowController.start()</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">fileprivate</span> <span class="function"><span class="keyword">func</span> <span class="title">startMain</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> mainFlowController = <span class="type">MainFlowController</span>()</span><br><span class="line">    mainFlowController.delegate = <span class="keyword">self</span></span><br><span class="line">    add(childController: mainFlowController)</span><br><span class="line">    mainFlowController.start()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>and with removing when the child <code>FlowController</code> finishes</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">AppFlowController</span>: <span class="title">LoginFlowControllerDelegate</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">loginFlowControllerDidFinish</span><span class="params">(<span class="number">_</span> flowController: LoginFlowController)</span></span> &#123;</span><br><span class="line">    remove(childController: flowController)</span><br><span class="line">    startMain()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-AppFlowController-does-not-need-to-know-about-UIWindow"><a href="#5-AppFlowController-does-not-need-to-know-about-UIWindow" class="headerlink" title="5. AppFlowController does not need to know about UIWindow"></a>5. AppFlowController does not need to know about UIWindow</h2><p><strong>Coordinator</strong></p>
<p>Usually you have an <code>AppCoordinator</code>, which is held by <code>AppDelegate</code>, as the root of your <code>Coordinator</code> chain. Based on login status, it will determine which <code>LoginController</code> or <code>MainController</code> will be set as the <code>rootViewController</code>, in order to do that, it needs to be injected a <code>UIWindow</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">window = <span class="type">UIWindow</span>(frame: <span class="type">UIScreen</span>.main.bounds)</span><br><span class="line">appCoordinator = <span class="type">AppCoordinator</span>(window: window!)</span><br><span class="line">appCoordinator.start()</span><br><span class="line">window?.makeKeyAndVisible()</span><br></pre></td></tr></table></figure>

<p>You can guess that in the <code>start</code> method of <code>AppCoordinator</code>, it must set <code>rootViewController</code> before <code>window?.makeKeyAndVisible()</code> is called.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">AppCoordinator</span>: <span class="title">Coordinator</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">let</span> window: <span class="type">UIWindow</span></span><br><span class="line"> </span><br><span class="line">  <span class="keyword">init</span>(window: <span class="type">UIWindow</span>) &#123;</span><br><span class="line">    <span class="keyword">self</span>.window = window</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">start</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> dependencyContainer.authService.isAuthenticated &#123;</span><br><span class="line">      startMain()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      startLogin()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>FlowController</strong></p>
<p>But with <code>AppFlowController</code>, you can treat it like a normal <code>UIViewController</code>, so just setting it as the <code>rootViewController</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">appFlowController = <span class="type">AppFlowController</span>(</span><br><span class="line">window = <span class="type">UIWindow</span>(frame: <span class="type">UIScreen</span>.main.bounds)</span><br><span class="line">window?.rootViewController = appFlowController</span><br><span class="line">window?.makeKeyAndVisible()</span><br><span class="line"></span><br><span class="line">appFlowController.start()</span><br></pre></td></tr></table></figure>

<h2 id="6-LoginFlowController-can-manage-its-own-flow"><a href="#6-LoginFlowController-can-manage-its-own-flow" class="headerlink" title="6. LoginFlowController can manage its own flow"></a>6. LoginFlowController can manage its own flow</h2><p>Supposed we have login flow based on <code>UINavigationController</code> that can display <code>LoginController</code>, <code>ForgetPasswordController</code>, <code>SignUpController</code></p>
<p><strong>Coordinator</strong></p>
<p>What should we do in the <code>start</code> method of <code>LoginCoordinator</code>? Construct the initial controller <code>LoginController</code> and set it as the <code>rootViewController</code> of the <code>UINavigationController</code>? <code>LoginCoordinator</code> can create this embedded <code>UINavigationController</code> internally, but then it is not attached to the <code>rootViewController</code> of <code>UIWindow</code>, because <code>UIWindow</code> is kept privately inside the parent <code>AppCoordinator</code>.</p>
<p>We can pass <code>UIWindow</code> to <code>LoginCoordinator</code> but then it knows too much. One way is to construct <code>UINavigationController</code> from <code>AppCoordinator</code> and pass that to <code>LoginCoordinator</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">AppCoordinator</span>: <span class="title">Coordinator</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">let</span> window: <span class="type">UIWindow</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">startLogin</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> navigationController = <span class="type">UINavigationController</span>()</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">let</span> loginCoordinator = <span class="type">LoginCoordinator</span>(navigationController: navigationController)</span><br><span class="line"> </span><br><span class="line">    loginCoordinator.delegate = <span class="keyword">self</span></span><br><span class="line">    add(child: loginCoordinator)</span><br><span class="line">    window.rootViewController = navigationController</span><br><span class="line">    loginCoordinator.start()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginCoordinator</span>: <span class="title">Coordinator</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">let</span> navigationController: <span class="type">UINavigationController</span></span><br><span class="line"> </span><br><span class="line">  <span class="keyword">init</span>(navigationController: <span class="type">UINavigationController</span>) &#123;</span><br><span class="line">    <span class="keyword">self</span>.navigationController = navigationController</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">start</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> loginController = <span class="type">LoginController</span>(dependencyContainer: dependencyContainer)</span><br><span class="line">    loginController.delegate = <span class="keyword">self</span></span><br><span class="line"> </span><br><span class="line">    navigationController.viewControllers = [loginController]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>FlowController</strong></p>
<p><code>LoginFlowController</code> leverages <code>container view controller</code> so it fits nicely with the way <code>UIKit</code> works. Here <code>AppFlowController</code> can just add <code>LoginFlowController</code> and <code>LoginFlowController</code> can just create its own <code>embeddedNavigationController</code>.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">AppFlowController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">startLogin</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> loginFlowController = <span class="type">LoginFlowController</span>(</span><br><span class="line">      dependencyContainer: dependencyContainer</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    loginFlowController.delegate = <span class="keyword">self</span></span><br><span class="line">    add(childController: loginFlowController)</span><br><span class="line">    loginFlowController.start()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginFlowController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">let</span> dependencyContainer: <span class="type">DependencyContainer</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">var</span> embeddedNavigationController: <span class="type">UINavigationController!</span></span><br><span class="line">  <span class="keyword">weak</span> <span class="keyword">var</span> delegate: <span class="type">LoginFlowControllerDelegate?</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">init</span>(dependencyContainer: <span class="type">DependencyContainer</span>) &#123;</span><br><span class="line">    <span class="keyword">self</span>.dependencyContainer = dependencyContainer</span><br><span class="line">    <span class="keyword">super</span>.<span class="keyword">init</span>(nibName: <span class="literal">nil</span>, bundle: <span class="literal">nil</span>)</span><br><span class="line"></span><br><span class="line">    embeddedNavigationController = <span class="type">UINavigationController</span>()</span><br><span class="line">    add(childController: embeddedNavigationController)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">start</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> loginController = <span class="type">LoginController</span>(dependencyContainer: dependencyContainer)</span><br><span class="line">    loginController.delegate = <span class="keyword">self</span></span><br><span class="line"></span><br><span class="line">    embeddedNavigationController.viewControllers = [loginController]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="7-FlowController-and-responder-chain"><a href="#7-FlowController-and-responder-chain" class="headerlink" title="7. FlowController and responder chain"></a>7. FlowController and responder chain</h2><p><strong>Coordinator</strong></p>
<p>Sometimes we want a quick way to bubble up message to parent <code>Coordinator</code>, one way to do that is to replicate <code>UIResponder</code> chain using <code>associated object</code> and protocol extensions, like <a href="http://aplus.rs/2017/highly-maintainable-app-architecture/">Inter-connect with Coordinator</a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="class"><span class="keyword">struct</span> <span class="title">AssociatedKeys</span> </span>&#123;</span><br><span class="line">		<span class="keyword">static</span> <span class="keyword">var</span> <span class="type">ParentCoordinator</span> = <span class="string">"ParentCoordinator"</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">var</span> parentCoordinator: <span class="type">Any?</span> &#123;</span><br><span class="line">		<span class="keyword">get</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> objc_getAssociatedObject(<span class="keyword">self</span>, &amp;<span class="type">AssociatedKeys</span>.<span class="type">ParentCoordinator</span>)</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">set</span> &#123;</span><br><span class="line">			objc_setAssociatedObject(<span class="keyword">self</span>, &amp;<span class="type">AssociatedKeys</span>.<span class="type">ParentCoordinator</span>, newValue, .<span class="type">OBJC_ASSOCIATION_ASSIGN</span>)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">Coordinator</span>&lt;<span class="title">T</span>: <span class="title">UIViewController</span>&gt;: <span class="title">UIResponder</span>, <span class="title">Coordinating</span> </span>&#123;</span><br><span class="line">	<span class="keyword">open</span> <span class="keyword">var</span> parent: <span class="type">Coordinating?</span>	</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">override</span> <span class="keyword">open</span> <span class="keyword">var</span> coordinatingResponder: <span class="type">UIResponder?</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> parent <span class="keyword">as</span>? <span class="type">UIResponder</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>FlowController</strong></p>
<p>Since <code>FlowController</code> is <code>UIViewController</code>, which inherits from <code>UIResponder</code>, responder chain happens out of the box</p>
<blockquote>
<p>Responder objects—that is, instances of UIResponder—constitute the event-handling backbone of a UIKit app. Many key objects are also responders, including the UIApplication object, UIViewController objects, and all UIView objects (which includes UIWindow). As events occur, UIKit dispatches them to your app’s responder objects for handling.</p>
</blockquote>
<h2 id="8-FlowController-and-trait-collection"><a href="#8-FlowController-and-trait-collection" class="headerlink" title="8. FlowController and trait collection"></a>8. FlowController and trait collection</h2><p><strong>FlowController</strong></p>
<p>I very much like how <a href="https://github.com/kickstarter/ios-oss/blob/master/Kickstarter-iOS.playground/Sources/playgroundController.swift#L43">Kickstarter</a> uses trait collection in testing. Well, since <code>FlowController</code> is a parent view controller, we can just override its trait collection, and that will affect the size classes of all view controllers inside that flow.</p>
<p>As in <a href="https://davedelong.com/blog/2017/11/06/a-better-mvc-part-2-fixing-encapsulation/">A Better MVC, Part 2: Fixing Encapsulation</a></p>
<blockquote>
<p>The huge advantage of this approach is that system features come free. Trait collection propagation is free. View lifecycle callbacks are free. Safe area layout margins are generally free. The responder chain and preferred UI state callbacks are free. And future additions to UIViewController are also free.</p>
</blockquote>
<p>From <a href="https://developer.apple.com/documentation/uikit/uiviewcontroller/1621406-setoverridetraitcollection">setOverrideTraitCollection</a></p>
<blockquote>
<p>When implementing a custom container view controller, you can use this method to change the traits of any embedded child view controllers to something more appropriate for your layout. Making such a change alters other view controller behaviors associated with that child</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> trait = <span class="type">UITraitCollection</span>(traitsFrom: [</span><br><span class="line">  .<span class="keyword">init</span>(horizontalSizeClass: .compact),</span><br><span class="line">  .<span class="keyword">init</span>(verticalSizeClass: .regular),</span><br><span class="line">  .<span class="keyword">init</span>(userInterfaceIdiom: .phone)</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">appFlowController.setOverrideTraitCollection(trait, forChildViewController: loginFlowController)</span><br></pre></td></tr></table></figure>

<h2 id="9-FlowController-and-back-button"><a href="#9-FlowController-and-back-button" class="headerlink" title="9. FlowController and back button"></a>9. FlowController and back button</h2><p><strong>Coordinator</strong></p>
<p>One problem with <code>UINavigationController</code> is that clicking on the default <code>back button</code> pops the view controller out of the navigation stack, so <code>Coordinator</code> is not aware of that. With <code>Coordinator</code> you needs to keep <code>Coordinator</code> and <code>UIViewController</code> in sync, add try to hook up <code>UINavigationControllerDelegate</code> in order to clean up. Like in <a href="http://khanlou.com/2017/05/back-buttons-and-coordinators/">Back Buttons and Coordinators</a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Coordinator</span>: <span class="title">UINavigationControllerDelegate</span> </span>&#123;    </span><br><span class="line">	<span class="function"><span class="keyword">func</span> <span class="title">navigationController</span><span class="params">(navigationController: UINavigationController,</span></span></span><br><span class="line"><span class="function"><span class="params">		didShowViewController viewController: UIViewController, animated: Bool)</span></span> &#123;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// ensure the view controller is popping</span></span><br><span class="line">		<span class="keyword">guard</span></span><br><span class="line">		  <span class="keyword">let</span> fromViewController = navigationController.transitionCoordinator?.viewController(forKey: .from),</span><br><span class="line">		  !navigationController.viewControllers.<span class="built_in">contains</span>(fromViewController) <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">    	&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// and it's the right type</span></span><br><span class="line">		<span class="keyword">if</span> fromViewController <span class="keyword">is</span> <span class="type">FirstViewControllerInCoordinator</span>) &#123;</span><br><span class="line">			<span class="comment">//deallocate the relevant coordinator</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Or creating a class called <code>NavigationController</code> that inside manages a list of child coordinators. Like in <a href="http://irace.me/navigation-coordinators">Navigation coordinators</a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">NavigationController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">  <span class="comment">// MARK: - Inputs</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">let</span> rootViewController: <span class="type">UIViewController</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// MARK: - Mutable state</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">var</span> viewControllersToChildCoordinators: [<span class="type">UIViewController</span>: <span class="type">Coordinator</span>] = [:]</span><br><span class="line"></span><br><span class="line">  <span class="comment">// MARK: - Lazy views</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="built_in">lazy</span> <span class="keyword">var</span> childNavigationController: <span class="type">UINavigationController</span> =</span><br><span class="line">      <span class="type">UINavigationController</span>(rootViewController: <span class="keyword">self</span>.rootViewController)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// MARK: - Initialization</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">init</span>(rootViewController: <span class="type">UIViewController</span>) &#123;</span><br><span class="line">    <span class="keyword">self</span>.rootViewController = rootViewController</span><br><span class="line"></span><br><span class="line">    <span class="keyword">super</span>.<span class="keyword">init</span>(nibName: <span class="literal">nil</span>, bundle: <span class="literal">nil</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>FlowController</strong></p>
<p>Since <code>FlowController</code> is just plain <code>UIViewController</code>, you don’t need to manually manage child <code>FlowController</code>. The child <code>FlowController</code> is gone when you pop or dismiss. If we want to listen to <code>UINavigationController</code> events, we can just handle that inside the <code>FlowController</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginFlowController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">let</span> dependencyContainer: <span class="type">DependencyContainer</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">var</span> embeddedNavigationController: <span class="type">UINavigationController!</span></span><br><span class="line">  <span class="keyword">weak</span> <span class="keyword">var</span> delegate: <span class="type">LoginFlowControllerDelegate?</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">init</span>(dependencyContainer: <span class="type">DependencyContainer</span>) &#123;</span><br><span class="line">    <span class="keyword">self</span>.dependencyContainer = dependencyContainer</span><br><span class="line">    <span class="keyword">super</span>.<span class="keyword">init</span>(nibName: <span class="literal">nil</span>, bundle: <span class="literal">nil</span>)</span><br><span class="line"></span><br><span class="line">    embeddedNavigationController = <span class="type">UINavigationController</span>()</span><br><span class="line">    embeddedNavigationController.delegate = <span class="keyword">self</span></span><br><span class="line">    add(childController: embeddedNavigationController)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">LoginFlowController</span>: <span class="title">UINavigationControllerDelegate</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">navigationController</span><span class="params">(<span class="number">_</span> navigationController: UINavigationController, willShow viewController: UIViewController, animated: Bool)</span></span> &#123;</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="10-FlowController-and-callback"><a href="#10-FlowController-and-callback" class="headerlink" title="10. FlowController and callback"></a>10. FlowController and callback</h2><p>We can use <code>delegate</code> pattern to notify <code>FlowController</code> to show another view controller in the flow</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">ProductFlowController</span>: <span class="title">ProductListControllerDelegate</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">productListController</span><span class="params">(<span class="number">_</span> controller: ProductListController, didSelect product: Product)</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> productDetailController = <span class="type">ProductDetailController</span>(</span><br><span class="line">      productNetworkingService: dependencyContainer.productNetworkingService,</span><br><span class="line">      productEditService: dependencyContainer.productEditService,</span><br><span class="line">      imageDownloaderService: dependencyContainer.imageDownloaderService</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    productDetailController.delegate = <span class="keyword">self</span></span><br><span class="line">    embeddedNavigationController.pushViewController(productDetailController, animated: <span class="literal">true</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Another approach is to use <code>closure</code> as callback, as proposed by <a href="https://twitter.com/merowing_/status/930755494502981632">@merowing_</a>, and also in his post <a href="http://merowing.info/2016/01/improve-your-ios-architecture-with-flowcontrollers/">Improve your iOS Architecture with FlowControllers</a></p>
<blockquote>
<p>Using closures as triggers rather than delegate allows for more readable and specialized implementation, and multiple contexts</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ProductFlowController</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">start</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> productListController = <span class="type">ProductListController</span>(</span><br><span class="line">      productNetworkingService: dependencyContainer.productNetworkingService</span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    productListController.didSelectProduct = &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] product <span class="keyword">in</span></span><br><span class="line">      <span class="keyword">self</span>?.showDetail(<span class="keyword">for</span>: product)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    embeddedNavigationController.viewControllers = [productListController]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="11-FlowController-and-deep-linking"><a href="#11-FlowController-and-deep-linking" class="headerlink" title="11. FlowController and deep linking"></a>11. FlowController and deep linking</h2><p>TBD. In the mean while, here are some readings about the UX</p>
<ul>
<li><a href="https://developer.android.com/design/patterns/navigation.html">Navigation with Back and Up</a></li>
<li><a href="https://developer.apple.com/documentation/usernotifications/unusernotificationcenterdelegate/1649518-usernotificationcenter">UserNotification</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-11-10T11:43:26.000Z" title="2017-11-10T11:43:26.000Z">2017-11-10</time><span class="level-item">5 minutes read (About 816 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/Please-reconsidering-your-choice-of-libraries/">Please reconsidering your choice of libraries</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/105">#105</a></strong></p>
<p>Are you willing to take vaccines you don’t know about?</p>
<p>I like open source. I ‘ve made some and contributed to some. I also use other people ‘s open source libraries and <a href="https://github.com/onmyway133/blog/issues?utf8=%E2%9C%93&q=Learning%20from%20Open%20Source">learn</a> a lot from them 😇 </p>
<p>Open source can help us build better, faster and maybe more <a href="https://github.com/onmyway133/blog/issues/85">performant</a> software by basing on other people ‘s hard work. We can also collaborate and make it better. But it’s also a double edges sword if you’re not judging carefully. </p>
<h3 id="Putting-a-little-bit-more-dedication"><a href="#Putting-a-little-bit-more-dedication" class="headerlink" title="Putting a little bit more dedication"></a>Putting a little bit more dedication</h3><p>You can skip this post if your project is just for fun, and you don’t care about future maintenance. If you’re making client or product projects, you should care and put a little more dedication into it. The company and your teammates trust you to do the good work. </p>
<p>I’ve admitted that I ‘ve done <code>node.js</code> and <code>electron.js</code>. The choice is because it’s just a utility that I want to make quickly, and there ‘s many <code>node.js</code> packages that I can use immediately. I have little experience in <code>node.js</code>, so I accept the risk do get the work done. But if you’re experienced developer in your platform, and it’s your important project, then it’s a different story 💥 </p>
<p>I’m kind of experimental person, so I always want to try new things. But I also learn the hard way to not over engineer, and to live as close to the system as possible. I just read <a href="http://aplus.rs/2017/much-ado-about-ios-app-architecture/">Much ado about iOS app architecture</a> and I agree with most of the points, that we shouldn’t fight the SDK and replace system frameworks.</p>
<p>To me, using 3rd libraries is like giving your life to someone else ‘s hands, that you can’t make any decision for your future. Please don’t just <code>pod install</code> and consider it done 🙏 </p>
<h3 id="What-about-the-stars"><a href="#What-about-the-stars" class="headerlink" title="What about the stars"></a>What about the stars</h3><p>People tend to follow those that have lots of followers, and to star a project with lots of stars. Don’t trust the stars. It means nearly nothing. The star is just the result of some marketing effort. Being featured or not in a newsletter can make 1k stars difference. Just because it was featured in a newsletter does not necessarily mean that it is good 😬 </p>
<p>You should judge it yourself by checking how good the source code is, how many documentation are available, and whether there is unit tests or not. The author is just human, so he can’t help maintain the library forever. You’re taking a big risk if you don’t have good picture of the library.</p>
<p>The system, especially iOS, changes very often. There are some libraries that try to “replicate” system APIs or perform type checking for every possible types. It can be that the author pick the most common use cases, or just trying to provide a cleaner APIs to the user. But if things change, will that author be willing to fix that? Will you be stuck there and making another issue asking for help? We’re making life better, not traps for everyone to fall into 🙀 </p>
<p>Here I don’t try to blame anyone, “you is not your work”. I just say that you should check it more thoroughly. You can consult your colleagues and discuss if it’s good to integrate. Most of the time, pulling a huge library just for some tiny syntactic sugar does not worth it</p>
<details> 
  <summary>I just put some random links here and you can determine if you like or not</summary>

<ul>
<li><a href="https://github.com/radex/SwiftyUserDefaults/blob/master/Sources/SwiftyUserDefaults.swift#L145">https://github.com/radex/SwiftyUserDefaults/blob/master/Sources/SwiftyUserDefaults.swift#L145</a><ul>
<li><a href="https://github.com/jiecao-fm/SwiftTheme/blob/master/Source/UIKit%2BTheme.swift#L183">https://github.com/jiecao-fm/SwiftTheme/blob/master/Source/UIKit%2BTheme.swift#L183</a></li>
<li><a href="https://github.com/erichoracek/Motif/blob/7ec2dfce45cd93cb5ae22f4f512a41a499138fd5/Examples/ButtonsExample/ThemeThemeSymbols.m#L10">https://github.com/erichoracek/Motif/blob/7ec2dfce45cd93cb5ae22f4f512a41a499138fd5/Examples/ButtonsExample/ThemeThemeSymbols.m#L10</a></li>
<li><a href="https://github.com/vhesener/Closures/blob/master/Xcode/Closures/Source/UITableView.swift#L251">https://github.com/vhesener/Closures/blob/master/Xcode/Closures/Source/UITableView.swift#L251</a></li>
<li><a href="https://github.com/Draveness/DKNightVersion/blob/master/DKNightVersion/UIKit/UITableView%2BNight.m#L29">https://github.com/Draveness/DKNightVersion/blob/master/DKNightVersion/UIKit/UITableView%2BNight.m#L29</a></li>
<li><a href="https://github.com/tombenner/nui/blob/master/NUI/Core/NUISwizzler.m#L15">https://github.com/tombenner/nui/blob/master/NUI/Core/NUISwizzler.m#L15</a></li>
<li><a href="https://github.com/square/SuperDelegate/blob/master/Sources/SuperDelegate%2BLocalNotifications.swift#L53">https://github.com/square/SuperDelegate/blob/master/Sources/SuperDelegate%2BLocalNotifications.swift#L53</a></li>
<li><a href="https://github.com/orta/ARAnalytics/blob/master/ARDSL.m#L113">https://github.com/orta/ARAnalytics/blob/master/ARDSL.m#L113</a></li>
<li><a href="https://github.com/SnapKit/SnapKit/blob/develop/Source/ConstraintMakerRelatable.swift#L43">https://github.com/SnapKit/SnapKit/blob/develop/Source/ConstraintMakerRelatable.swift#L43</a>  </li>
<li><a href="https://github.com/saoudrizwan/DynamicJSON/blob/master/Sources/DynamicJSON.swift#L54">https://github.com/saoudrizwan/DynamicJSON/blob/master/Sources/DynamicJSON.swift#L54</a></details>

</li>
</ul>
</li>
</ul>
<h3 id="Please"><a href="#Please" class="headerlink" title="Please"></a>Please</h3><p>Would you take a very big risk for so little return ? Always implement and imagine that you will be the next maintainer for the project, then you will act differently.</p>
<p>So the next time, please reconsider your choice of libraries. Take 1 step back and analyse a bit ❤️ </p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-10-31T12:56:13.000Z" title="2017-10-31T12:56:13.000Z">2017-10-31</time><span class="level-item">2 minutes read (About 322 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/Diff-algorithm/">Diff algorithm</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/99">#99</a></strong></p>
<p>I’ve been searching for efficient ways to diff collections, here are some interesting papers that I find</p>
<p><strong>Myers</strong> </p>
<ul>
<li><a href="http://www.xmailserver.org/diff2.pdf">An O(ND) Difference Algorithm and Its Variations</a></li>
<li><a href="https://github.com/wokalski/Diff.swift">https://github.com/wokalski/Diff.swift</a></li>
<li><a href="https://github.com/kpdecker/jsdiff">https://github.com/kpdecker/jsdiff</a></li>
<li><a href="https://github.com/raywenderlich/swift-algorithm-club/pull/693/files">https://github.com/raywenderlich/swift-algorithm-club/pull/693/files</a></li>
</ul>
<p><strong>Wu</strong> </p>
<ul>
<li><a href="https://publications.mpi-cbg.de/Wu_1990_6334.pdf">An O(NP) Sequence Comparison Algorithm</a></li>
<li><a href="https://github.com/kazuhiro4949/EditDistance">https://github.com/kazuhiro4949/EditDistance</a></li>
<li><a href="https://github.com/cubicdaiya/onp">https://github.com/cubicdaiya/onp</a></li>
<li><a href="https://github.com/hattya/go.diff/blob/master/diff.go">https://github.com/hattya/go.diff/blob/master/diff.go</a></li>
<li><a href="https://gist.github.com/tociyuki/acedd33ca4913f1ab8e9">https://gist.github.com/tociyuki/acedd33ca4913f1ab8e9</a></li>
<li><a href="http://t2y.hatenablog.jp/entry/20090802/1249146010">http://t2y.hatenablog.jp/entry/20090802/1249146010</a></li>
</ul>
<p><strong>Wagner–Fischer</strong></p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Wagner%E2%80%93Fischer_algorithm">https://en.wikipedia.org/wiki/Wagner%E2%80%93Fischer_algorithm</a>)</li>
<li><a href="http://davedelong.tumblr.com/post/134367865668/edit-distance-and-edit-steps">http://davedelong.tumblr.com/post/134367865668/edit-distance-and-edit-steps</a></li>
<li><a href="https://github.com/osteslag/Changeset">https://github.com/osteslag/Changeset</a></li>
<li><a href="https://github.com/onmyway133/DeepDiff">https://github.com/onmyway133/DeepDiff</a></li>
</ul>
<p><strong>Common Longest Subsequence</strong></p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Longest_common_subsequence_problem">https://en.wikipedia.org/wiki/Longest_common_subsequence_problem</a></li>
<li><a href="https://github.com/jflinter/Dwifft">https://github.com/jflinter/Dwifft</a></li>
<li><a href="https://github.com/Frugghi/SwiftLCS">https://github.com/Frugghi/SwiftLCS</a></li>
</ul>
<p><strong>Heckel</strong></p>
<ul>
<li><a href="http://documents.scribd.com/docs/10ro9oowpo1h81pgh1as.pdf">http://documents.scribd.com/docs/10ro9oowpo1h81pgh1as.pdf</a></li>
<li><a href="https://dl.acm.org/citation.cfm?id=359467">A technique for isolating differences between files</a></li>
<li><a href="https://github.com/mcudich/HeckelDiff">https://github.com/mcudich/HeckelDiff</a></li>
<li><a href="https://github.com/Instagram/IGListKit/blob/40625f8ff960cc1fd73400bf57a7a367470d1ef3/Source/Common/IGListDiff.mm">IGListDiff</a></li>
<li><a href="https://github.com/andre-alves/PHDiff">https://github.com/andre-alves/PHDiff</a></li>
<li><a href="https://gist.github.com/ndarville/3166060">https://gist.github.com/ndarville/3166060</a></li>
<li><a href="https://github.com/myndzi/heckel-diff">https://github.com/myndzi/heckel-diff</a></li>
<li><a href="https://johnresig.com/projects/javascript-diff-algorithm/">https://johnresig.com/projects/javascript-diff-algorithm/</a></li>
<li><a href="https://stackoverflow.com/questions/42755035/difficulty-understanding-paul-heckels-diff-algorithm">https://stackoverflow.com/questions/42755035/difficulty-understanding-paul-heckels-diff-algorithm</a></li>
<li><a href="https://github.com/RACCommunity/FlexibleDiff/blob/diffing/FlexibleDiff/Changeset.swift">https://github.com/RACCommunity/FlexibleDiff/blob/diffing/FlexibleDiff/Changeset.swift</a></li>
<li><a href="https://github.com/onmyway133/DeepDiff">https://github.com/onmyway133/DeepDiff</a></li>
<li><a href="https://github.com/ra1028/DifferenceKit">https://github.com/ra1028/DifferenceKit</a></li>
</ul>
<p><strong>Hunt-Szymanski</strong></p>
<ul>
<li><a href="http://www.imada.sdu.dk/~rolf/Edu/DM823/E16/HuntSzymanski.pdf">The Hunt-Szymanski Algorithm for LCS</a></li>
</ul>
<h2 id="Read-more"><a href="#Read-more" class="headerlink" title="Read more"></a>Read more</h2><ul>
<li><a href="http://wiki.c2.com/?DiffAlgorithm">http://wiki.c2.com/?DiffAlgorithm</a></li>
<li><a href="https://stackoverflow.com/questions/9065536/text-comparison-algorithm">https://stackoverflow.com/questions/9065536/text-comparison-algorithm</a></li>
<li><a href="https://neil.fraser.name/writing/diff/">https://neil.fraser.name/writing/diff/</a></li>
<li><a href="https://github.com/davedelong/SE-0240">https://github.com/davedelong/SE-0240</a></li>
<li><a href="https://forums.swift.org/t/se-0240-ordered-collection-diffing/19514">https://forums.swift.org/t/se-0240-ordered-collection-diffing/19514</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-10-31T10:46:53.000Z" title="2017-10-31T10:46:53.000Z">2017-10-31</time><span class="level-item">a minute read (About 206 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-use-safeAreaLayoutGuide-in-iOS-10/">How to use safeAreaLayoutGuide in iOS 10</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/98">#98</a></strong></p>
<p>The <a href="https://developer.apple.com/documentation/uikit/uiview/2891102-safearealayoutguide">safeAreaLayoutGuide</a> was introduced in iOS 11. And it is advised to stop using <code>topLayoutGuide</code> <code>bottomLayoutGuide</code> as these are deprecated.</p>
<p>To use <code>safeAreaLayoutGuide</code>, you need to do iOS version check</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> #available(iOS <span class="number">11.0</span>, *) &#123;</span><br><span class="line">  headerView.topAnchor.constraint(equalTo: view.safeAreaLayoutGuide.topAnchor, constant: <span class="number">20</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  headerView.topAnchor.constraint(equalTo: view.topAnchor, constant: <span class="number">20</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Maybe we can introduce a common property that can be used across many iOS versions, let’s call it <code>compatibleSafeAreaLayoutGuide</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">UIView</span> </span>&#123;</span><br><span class="line">  <span class="comment">/// Use safeAreaLayoutGuide on iOS 11+, otherwise default to dummy layout guide</span></span><br><span class="line">  <span class="keyword">var</span> compatibleSafeAreaLayoutGuide: <span class="type">UILayoutGuide</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> #available(iOS <span class="number">11</span>, *) &#123;</span><br><span class="line">      <span class="keyword">return</span> safeAreaLayoutGuide</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> <span class="keyword">let</span> layoutGuide = <span class="keyword">self</span>.associatedLayoutGuide &#123;</span><br><span class="line">        <span class="keyword">return</span> layoutGuide</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> layoutGuide = <span class="type">UILayoutGuide</span>()</span><br><span class="line">        <span class="type">Constraint</span>.on(</span><br><span class="line">          layoutGuide.topAnchor.constraint(equalTo: topAnchor),</span><br><span class="line">          layoutGuide.bottomAnchor.constraint(equalTo: bottomAnchor),</span><br><span class="line">          layoutGuide.leftAnchor.constraint(equalTo: leftAnchor),</span><br><span class="line">          layoutGuide.rightAnchor.constraint(equalTo: rightAnchor)</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="keyword">self</span>.associatedLayoutGuide = layoutGuide</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> layoutGuide</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="class"><span class="keyword">struct</span> <span class="title">AssociatedKeys</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> layoutGuide = <span class="string">"layoutGuide"</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">fileprivate</span> <span class="keyword">var</span> associatedLayoutGuide: <span class="type">UILayoutGuide?</span> &#123;</span><br><span class="line">    <span class="keyword">get</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> objc_getAssociatedObject(<span class="keyword">self</span>, &amp;<span class="type">AssociatedKeys</span>.layoutGuide) <span class="keyword">as</span>? <span class="type">UILayoutGuide</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">set</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> <span class="keyword">let</span> newValue = newValue &#123;</span><br><span class="line">        objc_setAssociatedObject(</span><br><span class="line">          <span class="keyword">self</span>, &amp;<span class="type">AssociatedKeys</span>.layoutGuide,</span><br><span class="line">          newValue <span class="keyword">as</span> <span class="type">UILayoutGuide?</span>,</span><br><span class="line">         .<span class="type">OBJC_ASSOCIATION_RETAIN_NONATOMIC</span></span><br><span class="line">        )</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This way we can simply do</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">headerView.topAnchor.constraint(equalTo: view.compatibleSafeAreaLayoutGuide.topAnchor, constant: <span class="number">20</span>)</span><br></pre></td></tr></table></figure>

<h2 id="Read-more"><a href="#Read-more" class="headerlink" title="Read more"></a>Read more</h2><ul>
<li><a href="https://useyourloaf.com/blog/safe-area-layout-guide/">https://useyourloaf.com/blog/safe-area-layout-guide/</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-10-25T10:19:33.000Z" title="2017-10-25T10:19:33.000Z">2017-10-25</time><span class="level-item">a minute read (About 192 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/Learning-from-Open-Source-Using-Coordinator/">Learning from Open Source  Using Coordinator</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/97">#97</a></strong></p>
<p>The <a href="http://khanlou.com/2015/10/coordinators-redux/">Coordinator</a> pattern can be useful to manage dependencies and handle navigation for your view controllers. It can be seen from <a href="https://github.com/backchannel/BackchannelSDK-iOS">BackchannelSDK-iOS</a>, take a look at <a href="https://github.com/backchannel/BackchannelSDK-iOS/blob/611de61611a9609d708920e2b602b2edbcc26b20/Source/Authentication/BAKCreateProfileCoordinator.m">BAKCreateProfileCoordinator</a> for example</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">BAKCreateProfileCoordinator</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithUser:(BAKUser *)user navigationController:(<span class="built_in">UINavigationController</span> *)navigationController configuration:(BAKRemoteConfiguration *)configuration &#123;</span><br><span class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> init];</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">self</span>) <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    </span><br><span class="line">    _navigationController = navigationController;</span><br><span class="line">    _user = user;</span><br><span class="line">    _profileViewController = [[BAKProfileFormViewController alloc] init];</span><br><span class="line">    [<span class="keyword">self</span> configureProfileForm];</span><br><span class="line">    _configuration = configuration;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)start &#123;</span><br><span class="line">    [<span class="keyword">self</span>.profileViewController updateDisplayName:<span class="keyword">self</span>.user.displayName];</span><br><span class="line">    [<span class="keyword">self</span>.navigationController pushViewController:<span class="keyword">self</span>.profileViewController animated:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)profileViewControllerDidTapAvatarButton:(BAKProfileFormViewController *)profileViewController &#123;</span><br><span class="line">    BAKChooseImageCoordinator *imageChooser = [[BAKChooseImageCoordinator alloc] initWithViewController:<span class="keyword">self</span>.navigationController];</span><br><span class="line">    imageChooser.delegate = <span class="keyword">self</span>;</span><br><span class="line">    [<span class="keyword">self</span>.childCoordinators addObject:imageChooser];</span><br><span class="line">    [imageChooser start];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)imageChooserDidCancel:(BAKChooseImageCoordinator *)imageChooser &#123;</span><br><span class="line">    [<span class="keyword">self</span>.childCoordinators removeObject:imageChooser];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Look how it holds <code>navigationController</code> as root element to do navigation, and how it manages <code>childCoordinators</code></p>
<p><img src="https://user-images.githubusercontent.com/2284279/32437135-a56f3294-c2e6-11e7-8a65-801d542fed4e.png" alt="coordinator"></p>
<h3 id="Read-more"><a href="#Read-more" class="headerlink" title="Read more"></a>Read more</h3><ul>
<li><a href="https://www.youtube.com/watch?v=a1g3k3NObkE">Coordinators – Soroush Khanlou</a></li>
</ul>
</div></article></div><nav class="pagination is-centered mt-4" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/tags/swift/page/9/">Previous</a></div><div class="pagination-next"><a href="/tags/swift/page/11/">Next</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/tags/swift/">1</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/tags/swift/page/9/">9</a></li><li><a class="pagination-link is-current" href="/tags/swift/page/10/">10</a></li><li><a class="pagination-link" href="/tags/swift/page/11/">11</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="" src="https://avatars1.githubusercontent.com/u/2284279?s=460&amp;v=4" alt="onmyway133"></figure><p class="title is-size-4 is-block line-height-inherit">onmyway133</p><p class="is-size-6 is-block">iOS, macOS, Android, React. Serial maker. Writer. Speaker.</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Oslo, Norway</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">679</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">52</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/onmyway133" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/onmyway133"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com/onmyway133"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile is-mobile" href="https://onmyway133.com/apps" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Apps</span></span><span class="level-right"><span class="level-item tag">onmyway133.com</span></span></a></li><li><a class="level is-mobile is-mobile" href="https://learntalks.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Learn Talks</span></span><span class="level-right"><span class="level-item tag">learntalks.com</span></span></a></li><li><a class="level is-mobile is-mobile" href="https://wwdctogether.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">WWDC Together</span></span><span class="level-right"><span class="level-item tag">wwdctogether.com</span></span></a></li></ul></div></div></div><!--!--><div class="card widget"><div class="card-content"><h3 class="menu-label">Recent</h3><article class="media"><div class="media-content size-small"><p><time dateTime="2020-12-31T06:45:13.000Z">2020-12-31</time></p><p class="title is-6"><a class="link-muted" href="/blog/How-to-disable-scrolling-in-NSTextView-for-macOS/">How to disable scrolling in NSTextView for macOS</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-12-31T05:16:15.000Z">2020-12-31</time></p><p class="title is-6"><a class="link-muted" href="/blog/How-to-override-attribute-string-in-Swift/">How to override attribute string in Swift</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-12-31T04:32:35.000Z">2020-12-31</time></p><p class="title is-6"><a class="link-muted" href="/blog/How-to-make-view-appear-with-delay-in-SwiftUI/">How to make view appear with delay in SwiftUI</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-12-31T04:11:06.000Z">2020-12-31</time></p><p class="title is-6"><a class="link-muted" href="/blog/How-to-make-attributed-string-Text-in-SwiftUI-for-macOS/">How to make attributed string Text in SwiftUI for macOS</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-12-30T04:30:52.000Z">2020-12-30</time></p><p class="title is-6"><a class="link-muted" href="/blog/How-to-do-copy-paste-delete-in-Swift-for-macOS/">How to do copy paste delete in Swift for macOS</a></p><p class="is-uppercase"></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/archives/2020/12/"><span class="level-start"><span class="level-item">December 2020</span></span><span class="level-end"><span class="level-item tag">29</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/11/"><span class="level-start"><span class="level-item">November 2020</span></span><span class="level-end"><span class="level-item tag">15</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/10/"><span class="level-start"><span class="level-item">October 2020</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/09/"><span class="level-start"><span class="level-item">September 2020</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/08/"><span class="level-start"><span class="level-item">August 2020</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/06/"><span class="level-start"><span class="level-item">June 2020</span></span><span class="level-end"><span class="level-item tag">14</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/05/"><span class="level-start"><span class="level-item">May 2020</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/04/"><span class="level-start"><span class="level-item">April 2020</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/03/"><span class="level-start"><span class="level-item">March 2020</span></span><span class="level-end"><span class="level-item tag">21</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/02/"><span class="level-start"><span class="level-item">February 2020</span></span><span class="level-end"><span class="level-item tag">20</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/01/"><span class="level-start"><span class="level-item">January 2020</span></span><span class="level-end"><span class="level-item tag">30</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/12/"><span class="level-start"><span class="level-item">December 2019</span></span><span class="level-end"><span class="level-item tag">36</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/11/"><span class="level-start"><span class="level-item">November 2019</span></span><span class="level-end"><span class="level-item tag">38</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/10/"><span class="level-start"><span class="level-item">October 2019</span></span><span class="level-end"><span class="level-item tag">49</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/09/"><span class="level-start"><span class="level-item">September 2019</span></span><span class="level-end"><span class="level-item tag">50</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/08/"><span class="level-start"><span class="level-item">August 2019</span></span><span class="level-end"><span class="level-item tag">39</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/07/"><span class="level-start"><span class="level-item">July 2019</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/06/"><span class="level-start"><span class="level-item">June 2019</span></span><span class="level-end"><span class="level-item tag">41</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/05/"><span class="level-start"><span class="level-item">May 2019</span></span><span class="level-end"><span class="level-item tag">49</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/04/"><span class="level-start"><span class="level-item">April 2019</span></span><span class="level-end"><span class="level-item tag">27</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/03/"><span class="level-start"><span class="level-item">March 2019</span></span><span class="level-end"><span class="level-item tag">24</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/02/"><span class="level-start"><span class="level-item">February 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/12/"><span class="level-start"><span class="level-item">December 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/05/"><span class="level-start"><span class="level-item">May 2018</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/04/"><span class="level-start"><span class="level-item">April 2018</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/02/"><span class="level-start"><span class="level-item">February 2018</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/01/"><span class="level-start"><span class="level-item">January 2018</span></span><span class="level-end"><span class="level-item tag">14</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/12/"><span class="level-start"><span class="level-item">December 2017</span></span><span class="level-end"><span class="level-item tag">14</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/11/"><span class="level-start"><span class="level-item">November 2017</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/10/"><span class="level-start"><span class="level-item">October 2017</span></span><span class="level-end"><span class="level-item tag">18</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/09/"><span class="level-start"><span class="level-item">September 2017</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/08/"><span class="level-start"><span class="level-item">August 2017</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/07/"><span class="level-start"><span class="level-item">July 2017</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/06/"><span class="level-start"><span class="level-item">June 2017</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/05/"><span class="level-start"><span class="level-item">May 2017</span></span><span class="level-end"><span class="level-item tag">35</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/04/"><span class="level-start"><span class="level-item">April 2017</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/algorithm/"><span class="tag">algorithm</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/android/"><span class="tag">android</span><span class="tag is-grey-lightest">34</span></a></div><div class="control"><a class="tags has-addons" href="/tags/apple-script/"><span class="tag">apple script</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/catalyst/"><span class="tag">catalyst</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ci/"><span class="tag">ci</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cloud/"><span class="tag">cloud</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cocoapods/"><span class="tag">cocoapods</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/combine/"><span class="tag">combine</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/core-data/"><span class="tag">core data</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/csharp/"><span class="tag">csharp</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/css/"><span class="tag">css</span><span class="tag is-grey-lightest">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/dart/"><span class="tag">dart</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/database/"><span class="tag">database</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/design/"><span class="tag">design</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/electron/"><span class="tag">electron</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/firebase/"><span class="tag">firebase</span><span class="tag is-grey-lightest">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/flutter/"><span class="tag">flutter</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/git/"><span class="tag">git</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/github/"><span class="tag">github</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/go/"><span class="tag">go</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/google/"><span class="tag">google</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/iOS/"><span class="tag">iOS</span><span class="tag is-grey-lightest">166</span></a></div><div class="control"><a class="tags has-addons" href="/tags/javascript/"><span class="tag">javascript</span><span class="tag is-grey-lightest">50</span></a></div><div class="control"><a class="tags has-addons" href="/tags/kotlin/"><span class="tag">kotlin</span><span class="tag is-grey-lightest">27</span></a></div><div class="control"><a class="tags has-addons" href="/tags/layout/"><span class="tag">layout</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/life/"><span class="tag">life</span><span class="tag is-grey-lightest">12</span></a></div><div class="control"><a class="tags has-addons" href="/tags/links/"><span class="tag">links</span><span class="tag is-grey-lightest">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/macOS/"><span class="tag">macOS</span><span class="tag is-grey-lightest">119</span></a></div><div class="control"><a class="tags has-addons" href="/tags/machine-learning/"><span class="tag">machine learning</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/maps/"><span class="tag">maps</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/networking/"><span class="tag">networking</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/node/"><span class="tag">node</span><span class="tag is-grey-lightest">11</span></a></div><div class="control"><a class="tags has-addons" href="/tags/objc/"><span class="tag">objc</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/react/"><span class="tag">react</span><span class="tag is-grey-lightest">23</span></a></div><div class="control"><a class="tags has-addons" href="/tags/react-native/"><span class="tag">react native</span><span class="tag is-grey-lightest">14</span></a></div><div class="control"><a class="tags has-addons" href="/tags/realm/"><span class="tag">realm</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/rx/"><span class="tag">rx</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/script/"><span class="tag">script</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/spm/"><span class="tag">spm</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/swift/"><span class="tag">swift</span><span class="tag is-grey-lightest">323</span></a></div><div class="control"><a class="tags has-addons" href="/tags/swiftUI/"><span class="tag">swiftUI</span><span class="tag is-grey-lightest">78</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tech/"><span class="tag">tech</span><span class="tag is-grey-lightest">14</span></a></div><div class="control"><a class="tags has-addons" href="/tags/terminal/"><span class="tag">terminal</span><span class="tag is-grey-lightest">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/testing/"><span class="tag">testing</span><span class="tag is-grey-lightest">17</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tool/"><span class="tag">tool</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/unity/"><span class="tag">unity</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/voip/"><span class="tag">voip</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/watchOS/"><span class="tag">watchOS</span><span class="tag is-grey-lightest">11</span></a></div><div class="control"><a class="tags has-addons" href="/tags/web/"><span class="tag">web</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/work/"><span class="tag">work</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/wwdc/"><span class="tag">wwdc</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/xcode/"><span class="tag">xcode</span><span class="tag is-grey-lightest">24</span></a></div></div></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Subscribe to Updates</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=c2r59mmt2n5k0o5dt5vv3nq4u4&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="c2r59mmt2n5k0o5dt5vv3nq4u4" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button is-primary" type="submit" value="Subscribe"></div></div></form></div></div></div><div class="card widget"><div class="card-content"><div class="notification is-danger">You need to set <code>client_id</code> and <code>slot_id</code> to show this AD unit. Please set it in <code>_config.yml</code>.</div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/z.png" alt="onmyway133" height="28"></a><p class="size-small"><span>&copy; 2020 Khoa Pham</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/onmyway133"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            site: {
                url: 'https://onmyway133.github.io',
                external_link: {"enable":true,"exclude":[]}
            },
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to Top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>