<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="generator" content="Hexo 4.2.0"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Tag: swift - onmyway133</title><meta description="What you don&amp;#39;t know is what you haven&amp;#39;t learned"><meta property="og:type" content="blog"><meta property="og:title" content="onmyway133"><meta property="og:url" content="https://onmyway133.github.io/"><meta property="og:site_name" content="onmyway133"><meta property="og:description" content="What you don&amp;#39;t know is what you haven&amp;#39;t learned"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://onmyway133.github.io/img/og_image.png"><meta property="article:author" content="Khoa Pham"><meta property="article:tag" content="ios"><meta property="article:tag" content=" android"><meta property="article:tag" content="javascript"><meta property="article:tag" content=" react"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><meta property="twitter:creator" content="@onmyway133"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://onmyway133.github.io"},"headline":"onmyway133","image":["https://onmyway133.github.io/img/og_image.png"],"author":{"@type":"Person","name":"Khoa Pham"},"description":"What you don&#39;t know is what you haven&#39;t learned"}</script><link rel="alternative" href="/atom.xml" title="onmyway133" type="application/atom+xml"><link rel="icon" href="/img/favicon.ico"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=UA-40119591-5" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'UA-40119591-5');</script><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><script data-ad-client="ca-pub-3656459401405265" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" async></script></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/z.png" alt="onmyway133" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/apps">Apps</a><a class="navbar-item" href="/gumroad">Gumroad</a><a class="navbar-item" href="/about">About</a><a class="navbar-item" href="/opensource">Open Source</a><a class="navbar-item" href="/writing">Writing</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/speaking">Speaking</a><a class="navbar-item" href="/news">News</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/onmyway133"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/tags">Tags</a></li><li class="is-active"><a href="#" aria-current="page">swift</a></li></ul></nav></div></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2021-01-01T22:39:18.000Z" title="2021-01-01T22:39:18.000Z">2021-01-01</time><span class="level-item">a minute read (About 212 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-use-GeometryReader-in-SwiftUI/">How to use GeometryReader in SwiftUI</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/735">#735</a></strong></p>
<p>From my previous post <a href="https://onmyway133.com/blog/how-to-use-flexible-frame-in-swiftui/">How to use flexible frame in SwiftUI</a> we know that certain views have different frame behaviors. 2 of them are <code>.overlay</code> and <code>GeometryReader</code> that takes up whole size proposed by parent.</p>
<p>By default <code>GeometryReader</code> takes up whole width and height of parent, and align its content as <code>.topLeading</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ContentView_Previews</span>: <span class="title">PreviewProvider</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">Rectangle</span>()</span><br><span class="line">                .fill(<span class="type">Color</span>.gray)</span><br><span class="line">                .overlay(</span><br><span class="line">                    <span class="type">GeometryReader</span> &#123; geo <span class="keyword">in</span></span><br><span class="line">                        <span class="type">Text</span>(<span class="string">"\(Int(geo.size.width))x\(Int(geo.size.height))"</span>)</span><br><span class="line">                            .bold()</span><br><span class="line">                    &#125;</span><br><span class="line">                )</span><br><span class="line">        &#125;</span><br><span class="line">        .frame(width: <span class="number">300</span>, height: <span class="number">300</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img width="446" alt="Screenshot 2021-01-02 at 00 37 17" src="https://user-images.githubusercontent.com/2284279/103447949-ac06e000-4c92-11eb-84e7-f03843572aa1.png">

<p>To align content center, we can specify frame with <code>geo</code> information</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ContentView_Previews</span>: <span class="title">PreviewProvider</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">Rectangle</span>()</span><br><span class="line">                .fill(<span class="type">Color</span>.gray)</span><br><span class="line">                .overlay(</span><br><span class="line">                    <span class="type">GeometryReader</span> &#123; geo <span class="keyword">in</span></span><br><span class="line">                        <span class="type">Text</span>(<span class="string">"\(Int(geo.size.width))x\(Int(geo.size.height))"</span>)</span><br><span class="line">                            .bold()</span><br><span class="line">                            .frame(width: geo.size.width, height: geo.size.height, alignment: .center)</span><br><span class="line">                    &#125;</span><br><span class="line">                )</span><br><span class="line">        &#125;</span><br><span class="line">        .frame(width: <span class="number">300</span>, height: <span class="number">300</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The result is that Text is center aligned</p>
<img width="485" alt="Screenshot 2021-01-02 at 00 39 13" src="https://user-images.githubusercontent.com/2284279/103447975-f12b1200-4c92-11eb-90ed-dd47f1318795.png">

<p>If we were to implement GeometryReader, it would look like this</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">GeometryReader</span>&lt;<span class="title">Content</span>: <span class="title">View</span>&gt;: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> content: (<span class="type">CGSize</span>) -&gt; <span class="type">Content</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">size</span><span class="params">(proposedSize: CGSize)</span></span> -&gt; <span class="type">CGSize</span> &#123;</span><br><span class="line">        <span class="comment">// Take up whole size proposed by parent</span></span><br><span class="line">        proposedSize</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">buildBody</span><span class="params">(calculatedSize: CGSize)</span></span> -&gt; some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="comment">// Pass in the calculated size</span></span><br><span class="line">        content(calculatedSize)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<p><strong>Updated at</strong> 2021-01-01 23:42:34</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2021-01-01T21:41:45.000Z" title="2021-01-01T21:41:45.000Z">2021-01-01</time><span class="level-item">9 minutes read (About 1350 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-use-flexible-frame-in-SwiftUI/">How to use flexible frame in SwiftUI</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/734">#734</a></strong></p>
<p>In SwiftUI there are fixed frame and flexible frame modifiers.</p>
<h2 id="Fixed-frame-Positions-this-view-within-an-invisible-frame-with-the-specified-size"><a href="#Fixed-frame-Positions-this-view-within-an-invisible-frame-with-the-specified-size" class="headerlink" title="Fixed frame Positions this view within an invisible frame with the specified size."></a>Fixed frame <a href="https://developer.apple.com/documentation/swiftui/list/frame(width:height:alignment:)">Positions this view within an invisible frame with the specified size.</a></h2><blockquote>
<p>Use this method to specify a fixed size for a view’s width, height, or both. If you only specify one of the dimensions, the resulting view assumes this view’s sizing behavior in the other dimension.</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">VStack</span> &#123;</span><br><span class="line">    <span class="type">Ellipse</span>()</span><br><span class="line">        .fill(<span class="type">Color</span>.purple)</span><br><span class="line">        .frame(width: <span class="number">200</span>, height: <span class="number">100</span>)</span><br><span class="line">    <span class="type">Ellipse</span>()</span><br><span class="line">        .fill(<span class="type">Color</span>.blue)</span><br><span class="line">        .frame(height: <span class="number">100</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Flexible-frame-frame-minWidth-idealWidth-maxWidth-minHeight-idealHeight-maxHeight-alignment"><a href="#Flexible-frame-frame-minWidth-idealWidth-maxWidth-minHeight-idealHeight-maxHeight-alignment" class="headerlink" title="Flexible frame frame(minWidth:idealWidth:maxWidth:minHeight:idealHeight:maxHeight:alignment:)"></a>Flexible frame <a href="https://developer.apple.com/documentation/swiftui/list/frame(minwidth:idealwidth:maxwidth:minheight:idealheight:maxheight:alignment:)">frame(minWidth:idealWidth:maxWidth:minHeight:idealHeight:maxHeight:alignment:)</a></h2><p>Read the documentation carefully</p>
<blockquote>
<p>Always specify at least one size characteristic when calling this method. Pass nil or leave out a characteristic to indicate that the frame should adopt this view’s sizing behavior, constrained by the other non-nil arguments.</p>
</blockquote>
<blockquote>
<p>The size proposed to this view is the size proposed to the frame, limited by any constraints specified, and with any ideal dimensions specified replacing any corresponding unspecified dimensions in the proposal.</p>
</blockquote>
<blockquote>
<p>If no minimum or maximum constraint is specified in a given dimension, the frame adopts the sizing behavior of its child in that dimension. If both constraints are specified in a dimension, the frame unconditionally adopts the size proposed for it, clamped to the constraints. Otherwise, the size of the frame in either dimension is:</p>
</blockquote>
<blockquote>
<p>If a minimum constraint is specified and the size proposed for the frame by the parent is less than the size of this view, the proposed size, clamped to that minimum.</p>
</blockquote>
<blockquote>
<p>If a maximum constraint is specified and the size proposed for the frame by the parent is greater than the size of this view, the proposed size, clamped to that maximum.</p>
</blockquote>
<blockquote>
<p>Otherwise, the size of this view.</p>
</blockquote>
<h2 id="Experiment-with-different-proposed-frame"><a href="#Experiment-with-different-proposed-frame" class="headerlink" title="Experiment with different proposed frame"></a>Experiment with different proposed frame</h2><p>To understand the explanation above, I prepare a Swift playground to examine with 3 scenarios: when both <code>minWidth</code> and <code>maxWidth</code> are provided, when either <code>minWidth</code> or <code>maxWidth</code> is provided. I use <code>width</code> for horizontal dimension but the same applies in vertical direction with <code>height</code>.</p>
<p>I have a <code>View</code> called <code>Examine</code> to demonstrate flexible frame. Here we have a flexible frame with red border and red text showing its size where you can specify <code>minWidth</code> and <code>maxWidth</code>. </p>
<p>Inside it is the content with a fixed frame with blue border and blue text showing content size where you can specify <code>contentWidth</code>. Finally there’s <code>parentWidth</code> where we specify proposed width to our red flexible frame.</p>
<p>The variations for our scenarios are that proposed width falls outside and inside <code>minWidth</code>, <code>contentWidth</code>, and <code>maxWidth</code> range.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Examine</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> parentWidth: <span class="type">CGFloat</span></span><br><span class="line">    <span class="keyword">let</span> contentWidth: <span class="type">CGFloat</span></span><br><span class="line">    <span class="keyword">var</span> minWidth: <span class="type">CGFloat?</span></span><br><span class="line">    <span class="keyword">var</span> maxWidth: <span class="type">CGFloat?</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Rectangle</span>()</span><br><span class="line">            .fill(<span class="type">Color</span>.gray)</span><br><span class="line">            .border(<span class="type">Color</span>.black, width: <span class="number">3</span>)</span><br><span class="line">            .frame(width: contentWidth)</span><br><span class="line">            .overlay(</span><br><span class="line">                <span class="type">GeometryReader</span> &#123; geo <span class="keyword">in</span></span><br><span class="line">                    <span class="type">Text</span>(<span class="string">"\(geo.size.width)"</span>)</span><br><span class="line">                        .foregroundColor(<span class="type">Color</span>.blue)</span><br><span class="line">                        .offset(x: <span class="number">0</span>, y: -<span class="number">20</span>)</span><br><span class="line">                        .center()</span><br><span class="line">                &#125;</span><br><span class="line">            )</span><br><span class="line">            .border(<span class="type">Color</span>.blue, width: <span class="number">2</span>)</span><br><span class="line">            .frame(minWidth: minWidth, maxWidth: maxWidth)</span><br><span class="line">            .overlay(</span><br><span class="line">                <span class="type">GeometryReader</span> &#123; geo <span class="keyword">in</span></span><br><span class="line">                    <span class="type">Text</span>(<span class="string">"\(geo.size.width)"</span>)</span><br><span class="line">                        .foregroundColor(<span class="type">Color</span>.red)</span><br><span class="line">                        .center()</span><br><span class="line">                &#125;</span><br><span class="line">            )</span><br><span class="line">            .border(<span class="type">Color</span>.red, width: <span class="number">1</span>)</span><br><span class="line">            .frame(width: parentWidth, height: <span class="number">100</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">center</span><span class="params">()</span></span> -&gt; some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">Spacer</span>()</span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="type">Spacer</span>()</span><br><span class="line">                <span class="keyword">self</span></span><br><span class="line">                <span class="type">Spacer</span>()</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">Spacer</span>()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Examine_Previews</span>: <span class="title">PreviewProvider</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Group</span> &#123;</span><br><span class="line">            <span class="type">Group</span> &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">"Both minWidth and maxWidth"</span>)</span><br><span class="line">                <span class="type">Examine</span>(parentWidth: <span class="number">75</span>, contentWidth: <span class="number">150</span>, minWidth: <span class="number">100</span>, maxWidth: <span class="number">200</span>)</span><br><span class="line">                    .help(<span class="string">"proposed size &lt; min width"</span>)</span><br><span class="line">                <span class="type">Examine</span>(parentWidth: <span class="number">125</span>, contentWidth: <span class="number">150</span>, minWidth: <span class="number">100</span>, maxWidth: <span class="number">200</span>)</span><br><span class="line">                    .help(<span class="string">"min width &lt; proposed size &lt; content"</span>)</span><br><span class="line">                <span class="type">Examine</span>(parentWidth: <span class="number">175</span>, contentWidth: <span class="number">150</span>, minWidth: <span class="number">100</span>, maxWidth: <span class="number">200</span>)</span><br><span class="line">                    .help(<span class="string">"min width &lt; content &lt; proposed size"</span>)</span><br><span class="line">                <span class="type">Examine</span>(parentWidth: <span class="number">300</span>, contentWidth: <span class="number">150</span>, minWidth: <span class="number">100</span>, maxWidth: <span class="number">200</span>)</span><br><span class="line">                    .help(<span class="string">"min width &lt; content &lt; max width &lt; proposed size"</span>)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="type">Group</span> &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">"Just minWidth"</span>)</span><br><span class="line">                <span class="type">Examine</span>(parentWidth: <span class="number">75</span>, contentWidth: <span class="number">150</span>, minWidth: <span class="number">100</span>)</span><br><span class="line">                <span class="type">Examine</span>(parentWidth: <span class="number">125</span>, contentWidth: <span class="number">150</span>, minWidth: <span class="number">100</span>)</span><br><span class="line">                <span class="type">Examine</span>(parentWidth: <span class="number">175</span>, contentWidth: <span class="number">150</span>, minWidth: <span class="number">100</span>)</span><br><span class="line">                <span class="type">Examine</span>(parentWidth: <span class="number">175</span>, contentWidth: <span class="number">75</span>, minWidth: <span class="number">100</span>)</span><br><span class="line">                    .help(<span class="string">"content &lt; minWidth"</span>)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="type">Group</span> &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">"Just maxWidth"</span>)</span><br><span class="line">                <span class="type">Examine</span>(parentWidth: <span class="number">75</span>, contentWidth: <span class="number">150</span>, maxWidth: <span class="number">200</span>)</span><br><span class="line">                <span class="type">Examine</span>(parentWidth: <span class="number">125</span>, contentWidth: <span class="number">150</span>, maxWidth: <span class="number">200</span>)</span><br><span class="line">                <span class="type">Examine</span>(parentWidth: <span class="number">175</span>, contentWidth: <span class="number">150</span>, maxWidth: <span class="number">200</span>)</span><br><span class="line">                <span class="type">Examine</span>(parentWidth: <span class="number">300</span>, contentWidth: <span class="number">225</span>, maxWidth: <span class="number">200</span>)</span><br><span class="line">                    .help(<span class="string">"content &gt; maxWidth"</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Observation"><a href="#Observation" class="headerlink" title="Observation"></a>Observation</h3><p>Here are the results with different variations of specifying  <code>parentWidth</code> aka proposed width.</p>
<p>🍑 <strong><em>Scenario 1</em></strong>: both minWidth and maxWidth are specified</p>
<p>Our red flexible frame clamps proposed width between its <code>minWidth</code> and <code>maxWidth</code>, ignoring <code>contentWidth</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> redWidth = clamp(minWidth, parentWidth, maxWidth)</span><br></pre></td></tr></table></figure>

<img width="682" alt="Screenshot 2021-01-01 at 23 30 19" src="https://user-images.githubusercontent.com/2284279/103447291-57ab3280-4c89-11eb-9779-99c34162cf56.png">

<p>🍅 <strong><em>Scenario 2</em></strong>: only minWidth is specified</p>
<p>Our red flexible frame clamps proposed width between its <code>minWidth</code> and <code>contentWidth</code>. In case <code>content</code> is less than <code>minWidth</code>, then final width is <code>minWidth</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> redWidth = clamp(minWidth, parentWidth, contentWidth)</span><br></pre></td></tr></table></figure>

<img width="668" alt="Screenshot 2021-01-01 at 23 51 46" src="https://user-images.githubusercontent.com/2284279/103447491-50395880-4c8c-11eb-9395-d0b4b8e3faa1.png">


<p>🍏 <strong><em>Scenario 3</em></strong>: only maxWidth is specified</p>
<p>Our red flexible frame clamps proposed width between its <code>contentWidth</code> and <code>maxWidth</code>. In case <code>content</code> is more than <code>maxWidth</code>, then  final width is <code>maxWidth</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> redWidth = clamp(contentWidth, parentWidth, maxWidth)</span><br></pre></td></tr></table></figure>

<img width="675" alt="Screenshot 2021-01-01 at 23 52 27" src="https://user-images.githubusercontent.com/2284279/103447500-69420980-4c8c-11eb-86c8-db15d95c0829.png">

<h2 id="What-are-idealWidth-and-idealHeight"><a href="#What-are-idealWidth-and-idealHeight" class="headerlink" title="What are idealWidth and idealHeight"></a>What are idealWidth and idealHeight</h2><p>In SwiftUI, view takes proposed frame from its parent, then proposes its to its child, and reports the size it wants from it’s child and its proposed frame from parent. The reported frame is the final frame used by that view.</p>
<p>When we use <code>.frame</code> modifier, SwiftUI does not changes the frame of that view directly. Instead it creates a container around that view.</p>
<p>There are 4 kinds of frame behavior depending on which View we are using. Some have mixed behavior.</p>
<ul>
<li>Sum up frames from its children then report the final frame. For example <code>HStack</code>, <code>VStack</code></li>
<li>Merely use the proposed frame. For example <code>GeometryReader</code>, <code>.overlay</code>, <code>Rectangle</code></li>
<li>Use more space than proposed. For example texts with <code>fixedSize</code></li>
<li>Use only space needed for its content and respect proposed frame as max</li>
</ul>
<h3 id="Fix-the-size-to-its-ideal-size"><a href="#Fix-the-size-to-its-ideal-size" class="headerlink" title="Fix the size to its ideal size"></a>Fix the size to its ideal size</h3><p>Some View like <code>Text</code> or <code>Image</code> has intrinsic content size, means it has implicit <code>idealWidth</code> and <code>idealHeight</code>. Some like <code>Rectangle</code> we need to explicit set <code>.frame(idealWidth: idealHeight)</code>. And these ideal width and height are only applied if we specify <code>fixedSize</code></p>
<p>To understand this, let’s read <a href="https://developer.apple.com/documentation/swiftui/view/fixedsize()">fixedSize</a></p>
<blockquote>
<p>Fixes this view at its ideal size.<br>During the layout of the view hierarchy, each view proposes a size to each child view it contains. If the child view doesn’t need a fixed size it can accept and conform to the size offered by the parent.<br>For example, a Text view placed in an explicitly sized frame wraps and truncates its string to remain within its parent’s bounds:</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Text</span>(<span class="string">"A single line of text, too long to fit in a box."</span>)</span><br><span class="line">    .frame(width: <span class="number">200</span>, height: <span class="number">200</span>)</span><br><span class="line">    .border(<span class="type">Color</span>.gray)</span><br></pre></td></tr></table></figure>

<img width="382" alt="Screenshot 2021-01-02 at 00 15 14" src="https://user-images.githubusercontent.com/2284279/103447744-97751880-4c8f-11eb-93a0-9a8ff96024f1.png">

<blockquote>
<p>The fixedSize() modifier can be used to create a view that maintains the ideal size of its children both dimensions:</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Text</span>(<span class="string">"A single line of text, too long to fit in a box."</span>)</span><br><span class="line">    .fixedSize()</span><br><span class="line">    .frame(width: <span class="number">200</span>, height: <span class="number">200</span>)</span><br><span class="line">    .border(<span class="type">Color</span>.gray)</span><br></pre></td></tr></table></figure>

<img width="523" alt="Screenshot 2021-01-02 at 00 16 11" src="https://user-images.githubusercontent.com/2284279/103447755-ba9fc800-4c8f-11eb-93d8-1bbe1dfd4f3c.png">

<blockquote>
<p>You can think of fixedSize() as the creation of a counter proposal to the view size proposed to a view by its parent. The ideal size of a view, and the specific effects of fixedSize() depends on the particular view and how you have configured it.</p>
</blockquote>
<p>To view this in playground, I have prepared this snippet</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Text_Previews</span>: <span class="title">PreviewProvider</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span>(spacing: <span class="number">16</span>) &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">"A single line of text, too long to fit in a box."</span>)</span><br><span class="line">                .fixedSize()</span><br><span class="line">                .border(<span class="type">Color</span>.red)</span><br><span class="line">                .frame(width: <span class="number">200</span>, height: <span class="number">200</span>)</span><br><span class="line">                .border(<span class="type">Color</span>.gray)</span><br><span class="line">        &#125;</span><br><span class="line">        .padding()</span><br><span class="line">        .frame(width: <span class="number">500</span>, height: <span class="number">500</span>)</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Here we can see that our canvas is 500x500, and the <code>Text</code> grows outside its parent frame 200x200</p>
<img width="666" alt="Screenshot 2021-01-02 at 00 17 29" src="https://user-images.githubusercontent.com/2284279/103447779-e8850c80-4c8f-11eb-9126-65d4da3e28ed.png">

<h3 id="Play-with-Rectangle"><a href="#Play-with-Rectangle" class="headerlink" title="Play with Rectangle"></a>Play with Rectangle</h3><p>Remember that shapes like <code>Rectangle</code> takes up all the proposed size. When we explicitly specify <code>fixedSize</code>, the<code>idealWidth</code> and <code>idealHeight</code> are used.</p>
<p>Here I have 3 rectangle</p>
<p>🍎 Red: There are no ideal size explicitly specified, so SwiftUI uses a magic number <code>10</code> as the size<br>🍏 Green: We specify frame directly and no idealWidth, idealHeight and no fixedSize, so this rectangle takes up full frame<br>🧊 Blue: The outer gray box has height 50, but this rectangle uses <code>idealWidth</code> and <code>idealHeight</code> of 200 because we specify <code>fixedSize</code> </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ContentView_Previews</span>: <span class="title">PreviewProvider</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span>(spacing: <span class="number">16</span>) &#123;</span><br><span class="line">            <span class="type">Rectangle</span>()</span><br><span class="line">                .fill(<span class="type">Color</span>.red)</span><br><span class="line">                .fixedSize()</span><br><span class="line"></span><br><span class="line">            <span class="type">Rectangle</span>()</span><br><span class="line">                .fill(<span class="type">Color</span>.green)</span><br><span class="line">                .frame(width: <span class="number">100</span>, height: <span class="number">100</span>)</span><br><span class="line"></span><br><span class="line">            <span class="type">Rectangle</span>()</span><br><span class="line">                .fill(<span class="type">Color</span>.blue)</span><br><span class="line">                .frame(idealWidth: <span class="number">200</span>, idealHeight: <span class="number">200</span>)</span><br><span class="line">                .fixedSize(horizontal: <span class="literal">true</span>, vertical: <span class="literal">true</span>)</span><br><span class="line">                .frame(height: <span class="number">50</span>)</span><br><span class="line">                .border(<span class="type">Color</span>.gray)</span><br><span class="line">        &#125;</span><br><span class="line">        .padding()</span><br><span class="line">        .frame(width: <span class="number">500</span>, height: <span class="number">500</span>)</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img width="613" alt="Screenshot 2021-01-02 at 00 23 29" src="https://user-images.githubusercontent.com/2284279/103447838-be801a00-4c90-11eb-85d6-eff53ecd987e.png">

<hr>
<p><strong>Updated at</strong> 2021-01-01 23:25:08</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-12-31T06:45:13.000Z" title="2020-12-31T06:45:13.000Z">2020-12-31</time><span class="level-item">a few seconds read (About 79 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-disable-scrolling-in-NSTextView-for-macOS/">How to disable scrolling in NSTextView for macOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/733">#733</a></strong></p>
<p><code>NSTextView</code> has this handy method to make scrollable NSTextView <code>NSTextView.scrollableTextView()</code>. The solution is to get to the responder outside enclosing <code>NSScrollView</code>, in my case it is the SwiftUI hosting view</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DisabledScrollTextView</span>: <span class="title">NSTextView</span> </span>&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">scrollWheel</span><span class="params">(with event: NSEvent)</span></span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 1st nextResponder is NSClipView</span></span><br><span class="line">        <span class="comment">// 2nd nextResponder is NSScrollView</span></span><br><span class="line">        <span class="comment">// 3rd nextResponder is NSResponder SwiftUIPlatformViewHost</span></span><br><span class="line">        <span class="keyword">self</span>.nextResponder?.nextResponder?.nextResponder?.scrollWheel(with: event)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Then-we-can-construct-with-our-new-DisabledScrollTextView-scrollableTextView"><a href="#Then-we-can-construct-with-our-new-DisabledScrollTextView-scrollableTextView" class="headerlink" title="Then we can construct with our new DisabledScrollTextView.scrollableTextView"></a>Then we can construct with our new <code>DisabledScrollTextView.scrollableTextView</code></h2><p><strong>Updated at</strong> 2020-12-31 07:45:19</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-12-31T05:16:15.000Z" title="2020-12-31T05:16:15.000Z">2020-12-31</time><span class="level-item">a few seconds read (About 40 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-override-attribute-string-in-Swift/">How to override attribute string in Swift</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/732">#732</a></strong></p>
<p>Use <code>NSMutableAttributedString</code> and add attribute for whole range</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a: <span class="type">NSAttributedString</span></span><br><span class="line"><span class="keyword">let</span> m: <span class="type">NSMutableAttributedString</span> = <span class="type">NSMutableAttributedString</span>(attributedString: a)</span><br><span class="line"><span class="keyword">let</span> range = <span class="type">NSRange</span>(location: <span class="number">0</span>, length: a.length)</span><br><span class="line">m.addAttribute(.backgroundColor, value: <span class="type">NSColor</span>.clear, range: range)</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-12-31T04:32:35.000Z" title="2020-12-31T04:32:35.000Z">2020-12-31</time><span class="level-item">a few seconds read (About 35 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-make-view-appear-with-delay-in-SwiftUI/">How to make view appear with delay in SwiftUI</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/731">#731</a></strong></p>
<p>Sometimes we don’t want to show progress view right away</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">HUDProgressView</span>()</span><br><span class="line">    .transition(</span><br><span class="line">        <span class="type">AnyTransition</span>.asymmetric(</span><br><span class="line">            insertion: <span class="type">AnyTransition</span>.opacity.animation(<span class="type">Animation</span>.<span class="keyword">default</span>.delay(<span class="number">1</span>)),</span><br><span class="line">            removal: <span class="type">AnyTransition</span>.opacity)</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>
<hr>
<p><strong>Updated at</strong> 2020-12-31 05:33:00</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-12-31T04:11:06.000Z" title="2020-12-31T04:11:06.000Z">2020-12-31</time><span class="level-item">a minute read (About 145 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-make-attributed-string-Text-in-SwiftUI-for-macOS/">How to make attributed string Text in SwiftUI for macOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/730">#730</a></strong></p>
<p>Use <code>NSTextField</code> with <code>maximumNumberOfLines</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> AppKit</span><br><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">AttributedText</span>: <span class="title">NSViewRepresentable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> attributedString: <span class="type">NSAttributedString</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(<span class="number">_</span> attributedString: <span class="type">NSAttributedString</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.attributedString = attributedString</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">makeNSView</span><span class="params">(context: Context)</span></span> -&gt; <span class="type">NSTextField</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> textField = <span class="type">NSTextField</span>()</span><br><span class="line"></span><br><span class="line">        textField.lineBreakMode = .byClipping</span><br><span class="line">        textField.maximumNumberOfLines = <span class="number">0</span></span><br><span class="line">        textField.isBordered = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> textField</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">updateNSView</span><span class="params">(<span class="number">_</span> nsView: NSTextField, context: Context)</span></span> &#123;</span><br><span class="line">        nsView.attributedStringValue = attributedString</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>TextField has problem with wrapping, we can use TextView</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">AttributedTextView</span>: <span class="title">NSViewRepresentable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">typealias</span> <span class="type">NSViewType</span> = <span class="type">NSScrollView</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> attributedText: <span class="type">NSAttributedString?</span></span><br><span class="line">    <span class="keyword">let</span> isSelectable: <span class="type">Bool</span></span><br><span class="line">    <span class="keyword">var</span> insetSize: <span class="type">CGSize</span> = .zero</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">makeNSView</span><span class="params">(context: Context)</span></span> -&gt; <span class="type">NSViewType</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> scrollView = <span class="type">NSTextView</span>.scrollableTextView()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> textView = scrollView.documentView <span class="keyword">as</span>! <span class="type">NSTextView</span></span><br><span class="line">        textView.drawsBackground = <span class="literal">false</span></span><br><span class="line">        textView.textColor = .controlTextColor</span><br><span class="line">        textView.textContainerInset = insetSize</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> scrollView</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">updateNSView</span><span class="params">(<span class="number">_</span> nsView: NSViewType, context: Context)</span></span> &#123;</span><br><span class="line">        <span class="keyword">let</span> textView = (nsView.documentView <span class="keyword">as</span>! <span class="type">NSTextView</span>)</span><br><span class="line">        textView.isSelectable = isSelectable</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> attributedText = attributedText,</span><br><span class="line">            attributedText != textView.attributedString() &#123;</span><br><span class="line">            textView.textStorage?.setAttributedString(attributedText)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> lineLimit = context.environment.lineLimit &#123;</span><br><span class="line">            textView.textContainer?.maximumNumberOfLines = lineLimit</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<p><strong>Updated at</strong> 2020-12-31 05:51:42</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-12-30T04:30:52.000Z" title="2020-12-30T04:30:52.000Z">2020-12-30</time><span class="level-item">a few seconds read (About 71 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-do-copy-paste-delete-in-Swift-for-macOS/">How to do copy paste delete in Swift for macOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/729">#729</a></strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NSApplicationMain</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AppDelegate</span>: <span class="title">NSObject</span>, <span class="title">NSApplicationDelegate</span> </span>&#123;</span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">copy</span><span class="params">(<span class="number">_</span> sender: <span class="keyword">Any</span>)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"copy"</span>, sender)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">paste</span><span class="params">(<span class="number">_</span> sender: <span class="keyword">Any</span>)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"paste"</span>, sender)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>For delete, we can listen to keyDown in <code>NSWindow</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyWindow</span>: <span class="title">NSWindow</span> </span>&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">keyDown</span><span class="params">(with event: NSEvent)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.keyDown(with: event)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">guard</span></span><br><span class="line">            <span class="keyword">let</span> deleteScalar = <span class="type">UnicodeScalar</span>(<span class="type">NSDeleteCharacter</span>),</span><br><span class="line">            event.charactersIgnoringModifiers == <span class="type">String</span>(deleteScalar)</span><br><span class="line">        <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">NotificationCenter</span>.<span class="keyword">default</span>.post(<span class="type">Notification</span>(name: .didKeyboardDeleteItem))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<p><strong>Updated at</strong> 2020-12-30 05:48:29</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-12-30T04:11:52.000Z" title="2020-12-30T04:11:52.000Z">2020-12-30</time><span class="level-item">a few seconds read (About 60 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-make-simple-NSItemProvider-in-Swift/">How to make simple NSItemProvider in Swift</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/728">#728</a></strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">NSItemProvider</span>(object: <span class="type">StringProvider</span>(string: string))</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StringProvider</span>: <span class="title">NSObject</span>, <span class="title">NSItemProviderWriting</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> string: <span class="type">String</span></span><br><span class="line">    <span class="keyword">init</span>(string: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.string = string</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> writableTypeIdentifiersForItemProvider: [<span class="type">String</span>] &#123;</span><br><span class="line">        <span class="keyword">return</span> [(kUTTypeData) <span class="keyword">as</span> <span class="type">String</span>]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">loadData</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        withTypeIdentifier typeIdentifier: String,</span></span></span><br><span class="line"><span class="function"><span class="params">        forItemProviderCompletionHandler completionHandler: @escaping <span class="params">(Data?, Error?)</span></span></span> -&gt; <span class="type">Void</span></span><br><span class="line">    ) -&gt; <span class="type">Progress?</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> data = string.data(using: .utf8)</span><br><span class="line">        completionHandler(data, <span class="literal">nil</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Progress</span>(totalUnitCount: <span class="number">100</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-12-27T21:11:35.000Z" title="2020-12-27T21:11:35.000Z">2020-12-27</time><span class="level-item">a few seconds read (About 36 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-use-hashtag-raw-string-in-Swift/">How to use hashtag raw string in Swift</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/727">#727</a></strong></p>
<p>Use <code>#</code> in Swift 5 to specify raw string, for example regular expression</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#<span class="string">"^#?(?:[0-9a-fA-F]&#123;3&#125;)&#123;1,2&#125;$"</span>#</span><br></pre></td></tr></table></figure>

<h2 id="Read-more"><a href="#Read-more" class="headerlink" title="Read more"></a>Read more</h2><ul>
<li><a href="https://www.hackingwithswift.com/articles/162/how-to-use-raw-strings-in-swift">https://www.hackingwithswift.com/articles/162/how-to-use-raw-strings-in-swift</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-12-26T20:42:53.000Z" title="2020-12-26T20:42:53.000Z">2020-12-26</time><span class="level-item">a few seconds read (About 62 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-make-UserDefaults-property-wrapper/">How to make UserDefaults property wrapper</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/726">#726</a></strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@propertyWrapper</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">UserDefault</span>&lt;<span class="title">Value</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> key: <span class="type">String</span></span><br><span class="line">    <span class="keyword">let</span> defaultValue: <span class="type">Value</span></span><br><span class="line">    <span class="keyword">let</span> container: <span class="type">UserDefaults</span> = .standard</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> wrappedValue: <span class="type">Value</span> &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> container.object(forKey: key) <span class="keyword">as</span>? <span class="type">Value</span> ?? defaultValue</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">set</span> &#123;</span><br><span class="line">            container.<span class="keyword">set</span>(newValue, forKey: key)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Then we can use it as property and provide default value</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">KeepHistoryService</span> </span>&#123;</span><br><span class="line">    @<span class="type">UserDefault</span>(key: <span class="string">"keepHistoryCheckDate"</span>, defaultValue: <span class="literal">nil</span>)</span><br><span class="line">    <span class="keyword">var</span> checkDate: <span class="type">Date?</span></span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-12-26T20:09:15.000Z" title="2020-12-26T20:09:15.000Z">2020-12-26</time><span class="level-item">a few seconds read (About 107 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-use-Set-to-check-for-bool-in-Swift/">How to use Set to check for bool in Swift</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/725">#725</a></strong></p>
<p>When you want to check for existence using <code>Bool</code>, consider using <code>Set</code> over Dictionary with <code>Bool</code>, as <code>Set</code> guarantee uniqueness. If using <code>Dictionary</code> instead, the value for key is <code>Optional&lt;Bool&gt;</code> where we have to check for both optional and true false within.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Book</span>: <span class="title">Hashable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> id: <span class="type">UUID</span></span><br><span class="line">    <span class="keyword">let</span> name: <span class="type">String</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> book1 = <span class="type">Book</span>(id: <span class="type">UUID</span>(), name: <span class="string">"1"</span>)</span><br><span class="line"><span class="keyword">let</span> book2 = <span class="type">Book</span>(id: <span class="type">UUID</span>(), name: <span class="string">"2"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">useDictionary</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> hasChecked: [<span class="type">Book</span>: <span class="type">Bool</span>] = [:]</span><br><span class="line">    hasChecked[book1] = <span class="literal">true</span></span><br><span class="line">    <span class="built_in">print</span>(hasChecked[book1] == <span class="type">Optional</span>&lt;<span class="type">Bool</span>&gt;(<span class="literal">true</span>))</span><br><span class="line">    <span class="built_in">print</span>(hasChecked[book2] == <span class="type">Optional</span>&lt;<span class="type">Bool</span>&gt;.<span class="keyword">none</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">useSet</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> hasChecked: <span class="type">Set</span>&lt;<span class="type">Book</span>&gt; = <span class="type">Set</span>()</span><br><span class="line">    hasChecked.insert(book1)</span><br><span class="line">    <span class="built_in">print</span>(hasChecked.<span class="built_in">contains</span>(book1))</span><br><span class="line">    <span class="built_in">print</span>(hasChecked.<span class="built_in">contains</span>(book2))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-12-26T20:02:18.000Z" title="2020-12-26T20:02:18.000Z">2020-12-26</time><span class="level-item">a few seconds read (About 88 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-make-visual-effect-blur-in-SwiftUI-for-macOS/">How to make visual effect blur in SwiftUI for macOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/724">#724</a></strong></p>
<p>We can use <code>.blur</code> modifier, but with <code>VisualEffectView</code> gives us more options for material and blending mode.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">VisualEffectView</span>: <span class="title">NSViewRepresentable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> material: <span class="type">NSVisualEffectView</span>.<span class="type">Material</span></span><br><span class="line">    <span class="keyword">let</span> blendingMode: <span class="type">NSVisualEffectView</span>.<span class="type">BlendingMode</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">init</span>(</span><br><span class="line">        material: <span class="type">NSVisualEffectView</span>.<span class="type">Material</span> = .contentBackground,</span><br><span class="line">        blendingMode: <span class="type">NSVisualEffectView</span>.<span class="type">BlendingMode</span> = .withinWindow</span><br><span class="line">    ) &#123;</span><br><span class="line">        <span class="keyword">self</span>.material = material</span><br><span class="line">        <span class="keyword">self</span>.blendingMode = blendingMode</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">makeNSView</span><span class="params">(context: Context)</span></span> -&gt; <span class="type">NSVisualEffectView</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> visualEffectView = <span class="type">NSVisualEffectView</span>()</span><br><span class="line">        visualEffectView.material = material</span><br><span class="line">        visualEffectView.blendingMode = blendingMode</span><br><span class="line">        visualEffectView.state = <span class="type">NSVisualEffectView</span>.<span class="type">State</span>.active</span><br><span class="line">        <span class="keyword">return</span> visualEffectView</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">updateNSView</span><span class="params">(<span class="number">_</span> visualEffectView: NSVisualEffectView, context: Context)</span></span> &#123;</span><br><span class="line">        visualEffectView.material = material</span><br><span class="line">        visualEffectView.blendingMode = blendingMode</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-12-26T19:51:44.000Z" title="2020-12-26T19:51:44.000Z">2020-12-26</time><span class="level-item">a minute read (About 121 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-make-simple-HUD-in-SwiftUI/">How to make simple HUD in SwiftUI</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/723">#723</a></strong></p>
<p>Use <code>@ViewBuilder</code> to build dynamic content for our HUD. For blur effect, here I use <code>NSVisualEffectView</code>, but we can use <code>.blur</code> modifier also</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">HUD</span>&lt;<span class="title">Content</span>&gt;: <span class="title">View</span> <span class="title">where</span> <span class="title">Content</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> content: () -&gt; <span class="type">Content</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(@<span class="type">ViewBuilder</span> content: @escaping () -&gt; <span class="type">Content</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.content = content</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: some <span class="type">View</span> &#123;</span><br><span class="line">        content()</span><br><span class="line">        .frame(width: <span class="number">80</span>, height: <span class="number">80</span>)</span><br><span class="line">        .background(</span><br><span class="line">            <span class="type">VisualEffectView</span>(material: .hudWindow)</span><br><span class="line">                .clipShape(<span class="type">RoundedRectangle</span>(cornerRadius: <span class="number">12</span>))</span><br><span class="line">                .shadow(color: <span class="type">Color</span>.black.opacity(<span class="number">0.22</span>), radius: <span class="number">12</span>, x: <span class="number">0</span>, y: <span class="number">5</span>)</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Then we can make some wrappers for information and progress HUD</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">HUD</span>&lt;<span class="title">Content</span>&gt;: <span class="title">View</span> <span class="title">where</span> <span class="title">Content</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> content: () -&gt; <span class="type">Content</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(@<span class="type">ViewBuilder</span> content: @escaping () -&gt; <span class="type">Content</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.content = content</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: some <span class="type">View</span> &#123;</span><br><span class="line">        content()</span><br><span class="line">        .frame(width: <span class="number">80</span>, height: <span class="number">80</span>)</span><br><span class="line">        .background(</span><br><span class="line">            <span class="type">VisualEffectView</span>()</span><br><span class="line">        )</span><br><span class="line">        .cornerRadius(<span class="number">10</span>)</span><br><span class="line">        .shadow(color: <span class="type">Color</span>.gray.opacity(<span class="number">0.3</span>), radius: <span class="number">1</span>, x: <span class="number">0</span>, y: <span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<p><strong>Updated at</strong> 2020-12-26 20:59:10</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-12-25T21:29:23.000Z" title="2020-12-25T21:29:23.000Z">2020-12-25</time><span class="level-item">a few seconds read (About 30 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-force-set-frame-explicitly-for-NSWindow/">How to force set frame explicitly for NSWindow</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/721">#721</a></strong></p>
<p>For <code>setFrame</code> to take effect</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mainWindow.setFrame(rect, display: <span class="literal">true</span>)</span><br></pre></td></tr></table></figure>

<p>we can remove auto save frame flag</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mainWindow.setFrameAutosaveName(<span class="string">"MyApp.MainWindow"</span>)</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-12-23T08:01:34.000Z" title="2020-12-23T08:01:34.000Z">2020-12-23</time><span class="level-item">a few seconds read (About 87 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-rotate-NSStatusItem/">How to rotate NSStatusItem</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/720">#720</a></strong></p>
<p><code>NSStatusItem</code> is backed by <code>NSButton</code>, we can animate this inner button. We need to specify <code>position</code> and <code>anchorPoint</code> for button’s layer so it rotates around its center point</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">guard</span></span><br><span class="line">    <span class="keyword">let</span> button = statusItem.button</span><br><span class="line"><span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> animation = <span class="type">CABasicAnimation</span>(keyPath: <span class="string">"transform.rotation.z"</span>)</span><br><span class="line">animation.fromValue = <span class="number">0</span></span><br><span class="line">animation.toValue = <span class="type">CGFloat</span>.pi * <span class="number">2</span></span><br><span class="line">animation.duration = <span class="number">0.25</span></span><br><span class="line">animation.repeatCount = <span class="number">1</span></span><br><span class="line">button.layer?.position = <span class="type">NSPoint</span>(x: <span class="type">NSMidX</span>(button.frame), y: <span class="type">NSMidY</span>(button.frame))</span><br><span class="line">button.layer?.anchorPoint = <span class="type">NSPoint</span>(x: <span class="number">0.5</span>, y: <span class="number">0.5</span>)</span><br><span class="line">button.layer?.add(animation, forKey: <span class="string">"rotate"</span>)</span><br></pre></td></tr></table></figure>
<hr>
<p><strong>Updated at</strong> 2020-12-26 21:21:00</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-12-23T04:19:17.000Z" title="2020-12-23T04:19:17.000Z">2020-12-23</time><span class="level-item">a minute read (About 127 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-make-sharing-menu-in-SwiftUI-for-macOS/">How to make sharing menu in SwiftUI for macOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/718">#718</a></strong></p>
<p>Use <code>NSSharingService.sharingServices(forItems:)</code> with an array of one empty string gives a list of sharing items. There we show <code>image</code> and <code>title</code> of each menu item.</p>
<p>We should cache sharing items as that can cause performance issue</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> AppKit</span><br><span class="line"><span class="keyword">import</span> EasySwiftUI</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">NSSharingService</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">let</span> items = <span class="type">NSSharingService</span>.sharingServices(forItems: [<span class="string">""</span>])</span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">submenu</span><span class="params">(text: String)</span></span> -&gt; some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Menu</span>(</span><br><span class="line">            content: &#123;</span><br><span class="line">                <span class="type">ForEach</span>(items, id: \.title) &#123; item <span class="keyword">in</span></span><br><span class="line">                    <span class="type">Button</span>(action: &#123; item.perform(withItems: [string]) &#125;) &#123;</span><br><span class="line">                        <span class="type">Image</span>(nsImage: item.image)</span><br><span class="line">                        <span class="type">Text</span>(item.title)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            label: &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">"Share"</span>)</span><br><span class="line">                <span class="type">Image</span>(systemName: <span class="type">SFSymbol</span>.squareAndArrowUp.rawValue)</span><br><span class="line">            &#125;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Alternative, you can trigger <code>NSSharingServicePicker</code> from a button, it shows a context menu with sharing options</p>
<h2 id="Read-more"><a href="#Read-more" class="headerlink" title="Read more"></a>Read more</h2><ul>
<li><a href="https://stackoverflow.com/questions/60952334/swiftui-using-nssharingservicepicker-in-macos">https://stackoverflow.com/questions/60952334/swiftui-using-nssharingservicepicker-in-macos</a></li>
</ul>
<hr>
<p><strong>Updated at</strong> 2020-12-25 22:57:57</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-12-16T04:30:50.000Z" title="2020-12-16T04:30:50.000Z">2020-12-16</time><span class="level-item">2 minutes read (About 289 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-do-didSet-for-State-and-Binding-in-SwiftUI/">How to do didSet for State and Binding in SwiftUI</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/714">#714</a></strong></p>
<p>Below is an example of a parent <code>ContentView</code> with <code>State</code> and a child <code>Sidebar</code> with a <code>Binding</code>.</p>
<p>The <code>didSet</code> is only called for the property that is changed. </p>
<p>When we click <code>Button in ContentView</code>, that changes <code>State</code> property, so only the <code>didSet</code> in <code>ContentView</code> is called<br>When we click <code>Button in Sidebar</code>, that changes <code>Binding</code> property, so only the <code>didSet</code> in <code>Sidebar</code> is called</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Tag</span>: <span class="title">String</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> all</span><br><span class="line">    <span class="keyword">case</span> settings</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ContentView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    @<span class="type">State</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> tag: <span class="type">Tag</span> = .all &#123;</span><br><span class="line">        <span class="keyword">didSet</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"ContentView \(tag)"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Sidebar</span>(tag: $tag)</span><br><span class="line">        <span class="type">Button</span>(action: &#123; tag = .settings &#125;) &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">"Button in ContentView"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Sidebar</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    @<span class="type">Binding</span></span><br><span class="line">    <span class="keyword">var</span> tag: <span class="type">Tag</span> &#123;</span><br><span class="line">        <span class="keyword">didSet</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"Sidebar \(tag)"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(tag.rawValue)</span><br><span class="line">        <span class="type">Button</span>(action: &#123; tag = .settings &#125;) &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">"Button in Sidebar"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Custom-Binding-with-get-set"><a href="#Custom-Binding-with-get-set" class="headerlink" title="Custom Binding with get set"></a>Custom Binding with get set</h3><p>Another way to observe Binding changes is to use custom <code>Binding</code> with <code>get, set</code>. Here even if we click <code>Button in ContentView</code>, the <code>set</code> block is triggered and here we can change <code>State</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> body: some <span class="type">View</span> &#123;</span><br><span class="line">    <span class="type">Sidebar</span>(tag: <span class="type">Binding</span>&lt;<span class="type">Tag</span>&gt;(</span><br><span class="line">        <span class="keyword">get</span>: &#123; tag &#125;,</span><br><span class="line">        <span class="keyword">set</span>: &#123; newTag <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">self</span>.tag = newTag</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"ContentView newTag \(newTag)"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    ))</span><br><span class="line">    <span class="type">Button</span>(action: &#123; tag = .settings &#125;) &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">"Button in ContentView"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Convenient-new-Binding"><a href="#Convenient-new-Binding" class="headerlink" title="Convenient new Binding"></a>Convenient new Binding</h3><p>We can also make convenient extension on Binding to return new <code>Binding</code>, with a hook allowing us to inspect newValue. So we can call like <code>Sidebar(tag: $tag.didSet</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Binding</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">didSet</span><span class="params">(<span class="number">_</span> <span class="keyword">didSet</span>: @escaping <span class="params">(Value)</span></span></span> -&gt; <span class="type">Void</span>) -&gt; <span class="type">Binding</span>&lt;<span class="type">Value</span>&gt; &#123;</span><br><span class="line">        <span class="type">Binding</span>(</span><br><span class="line">            <span class="keyword">get</span>: &#123; wrappedValue &#125;,</span><br><span class="line">            <span class="keyword">set</span>: &#123; newValue <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">self</span>.wrappedValue = newValue</span><br><span class="line">                <span class="keyword">didSet</span>(newValue)</span><br><span class="line">            &#125;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ContentView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    @<span class="type">State</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> tag: <span class="type">Tag</span> = .all &#123;</span><br><span class="line">        <span class="keyword">didSet</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"ContentView \(tag)"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Sidebar</span>(tag: $tag.<span class="keyword">didSet</span> &#123; newValue <span class="keyword">in</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"ContentView newTag \(newValue)"</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="type">Button</span>(action: &#123; tag = .settings &#125;) &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">"Button in ContentView"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<p><strong>Updated at</strong> 2021-02-06 21:57:28</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-12-15T04:18:34.000Z" title="2020-12-15T04:18:34.000Z">2020-12-15</time><span class="level-item">a minute read (About 219 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-add-toolbar-programatically-in-macOS/">How to add toolbar programatically in macOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/713">#713</a></strong></p>
<p>To setup toolbar, we need to implement <code>NSToolbarDelegate</code> that provides toolbar items. This delegate is responsible for many things</p>
<ul>
<li>Set visible and allowed items with <code>toolbarDefaultItemIdentifiers</code></li>
<li>Provide item with <code>itemForItemIdentifier</code></li>
<li>Being notified with <code>toolbarWillAddItem</code> and <code>toolbarDidRemoveItem</code></li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">window.toolbarStyle = .unifiedCompact</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> toolbar = <span class="type">NSToolbar</span>(identifier: <span class="string">"Toolbar"</span>)</span><br><span class="line">toolbar.displayMode = .iconAndLabel</span><br><span class="line">toolbar.delegate = (<span class="type">NSApp</span>.delegate <span class="keyword">as</span>! <span class="type">AppDelegate</span>)</span><br><span class="line">toolbar.insertItem(withItemIdentifier: .add, at: <span class="number">0</span>)</span><br><span class="line">toolbar.insertItem(withItemIdentifier: .settings, at: <span class="number">1</span>)</span><br><span class="line">window.toolbar = toolbar</span><br></pre></td></tr></table></figure>

<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">NSToolbarItem</span>.<span class="title">Identifier</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> add = <span class="type">NSToolbarItem</span>.<span class="type">Identifier</span>(rawValue: <span class="string">"Add"</span>)</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> settings = <span class="type">NSToolbarItem</span>.<span class="type">Identifier</span>(rawValue: <span class="string">"Settings"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">AppDelegate</span>: <span class="title">NSToolbarDelegate</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">toolbar</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="number">_</span> toolbar: NSToolbar,</span></span></span><br><span class="line"><span class="function"><span class="params">        itemForItemIdentifier itemIdentifier: NSToolbarItem.Identifier,</span></span></span><br><span class="line"><span class="function"><span class="params">        willBeInsertedIntoToolbar flag: Bool</span></span></span><br><span class="line"><span class="function"><span class="params">    )</span></span> -&gt; <span class="type">NSToolbarItem?</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> itemIdentifier &#123;</span><br><span class="line">        <span class="keyword">case</span> .add:</span><br><span class="line">            <span class="keyword">let</span> item = <span class="type">NSToolbarItem</span>(itemIdentifier: itemIdentifier)</span><br><span class="line">            item.label = <span class="string">"Add"</span></span><br><span class="line">            item.image = <span class="type">NSImage</span>(named: <span class="type">NSImage</span>.<span class="type">Name</span>(<span class="string">"add"</span>))</span><br><span class="line">            <span class="keyword">let</span> menuItem: <span class="type">NSMenuItem</span> = <span class="type">NSMenuItem</span>()</span><br><span class="line">            menuItem.submenu = <span class="literal">nil</span></span><br><span class="line">            menuItem.title = <span class="string">"Add"</span></span><br><span class="line">            item.menuFormRepresentation = menuItem</span><br><span class="line">            item.toolTip = <span class="string">"Click here to add new entry"</span></span><br><span class="line">            <span class="keyword">return</span> item</span><br><span class="line">        <span class="keyword">case</span> .settings:</span><br><span class="line">            <span class="keyword">let</span> item = <span class="type">NSToolbarItem</span>(itemIdentifier: itemIdentifier)</span><br><span class="line">            item.label = <span class="string">"Settings"</span></span><br><span class="line">            <span class="keyword">let</span> button = <span class="type">NSButton</span>(image: <span class="type">NSImage</span>(named: <span class="type">NSImage</span>.<span class="type">Name</span>(<span class="string">"gear"</span>))!, target: <span class="literal">nil</span>, action: <span class="literal">nil</span>)</span><br><span class="line">            button.bezelStyle = .texturedRounded</span><br><span class="line">            item.view = button</span><br><span class="line">            <span class="keyword">return</span> item</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">toolbarDefaultItemIdentifiers</span><span class="params">(<span class="number">_</span> toolbar: NSToolbar)</span></span> -&gt; [<span class="type">NSToolbarItem</span>.<span class="type">Identifier</span>] &#123;</span><br><span class="line">        [.add, .settings]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">toolbarAllowedItemIdentifiers</span><span class="params">(<span class="number">_</span> toolbar: NSToolbar)</span></span> -&gt; [<span class="type">NSToolbarItem</span>.<span class="type">Identifier</span>] &#123;</span><br><span class="line">        [.add, .settings]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Read-more"><a href="#Read-more" class="headerlink" title="Read more"></a>Read more</h2><ul>
<li><a href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Toolbars/Tasks/AddRemoveToolbarItems.html">Adding and Removing Toolbar Items</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-12-14T10:17:31.000Z" title="2020-12-14T10:17:31.000Z">2020-12-14</time><span class="level-item">a minute read (About 220 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-declare-network-Error-with-enum-in-Swift/">How to declare network Error with enum in Swift</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/712">#712</a></strong></p>
<p>Describe all possible paths in your program with enum. This is great to track down bugs and to not miss representing potential cases in UI. Errors can come from app layer, backend layer to network issues.</p>
<p>Enum is handy in both UIKit and SwiftUI</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">NetworkError</span>: <span class="title">Swift</span>.<span class="title">Error</span> </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">enum</span> <span class="title">RequestError</span> </span>&#123;</span><br><span class="line">        <span class="keyword">case</span> invalidRequest(<span class="type">URLRequest</span>)</span><br><span class="line">        <span class="keyword">case</span> encodingError(<span class="type">Swift</span>.<span class="type">EncodingError</span>)</span><br><span class="line">        <span class="keyword">case</span> other(<span class="type">NSError</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">enum</span> <span class="title">ServerError</span> </span>&#123;</span><br><span class="line">        <span class="keyword">case</span> decodingError(<span class="type">Swift</span>.<span class="type">DecodingError</span>)</span><br><span class="line">        <span class="keyword">case</span> noInternetConnection</span><br><span class="line">        <span class="keyword">case</span> timeout</span><br><span class="line">        <span class="keyword">case</span> internalServerError</span><br><span class="line">        <span class="keyword">case</span> other(statusCode: <span class="type">Int</span>, response: <span class="type">HTTPURLResponse</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> requestError(<span class="type">RequestError</span>)</span><br><span class="line">    <span class="keyword">case</span> serverError(<span class="type">ServerError</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>and note that Foundation has <code>NSError</code> with a bunch of well defined error code ready to use. We can use this before introduce our custom error cases</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">var</span> <span class="type">NSURLErrorUnknown</span>: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">var</span> <span class="type">NSURLErrorCancelled</span>: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">var</span> <span class="type">NSURLErrorBadURL</span>: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">var</span> <span class="type">NSURLErrorTimedOut</span>: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">var</span> <span class="type">NSURLErrorUnsupportedURL</span>: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">var</span> <span class="type">NSURLErrorCannotFindHost</span>: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">var</span> <span class="type">NSURLErrorCannotConnectToHost</span>: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">var</span> <span class="type">NSURLErrorNetworkConnectionLost</span>: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">var</span> <span class="type">NSURLErrorDNSLookupFailed</span>: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">var</span> <span class="type">NSURLErrorHTTPTooManyRedirects</span>: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">var</span> <span class="type">NSURLErrorResourceUnavailable</span>: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">var</span> <span class="type">NSURLErrorNotConnectedToInternet</span>: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">var</span> <span class="type">NSURLErrorRedirectToNonExistentLocation</span>: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">var</span> <span class="type">NSURLErrorBadServerResponse</span>: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">var</span> <span class="type">NSURLErrorUserCancelledAuthentication</span>: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">var</span> <span class="type">NSURLErrorUserAuthenticationRequired</span>: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">var</span> <span class="type">NSURLErrorZeroByteResource</span>: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">var</span> <span class="type">NSURLErrorCannotDecodeRawData</span>: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">var</span> <span class="type">NSURLErrorCannotDecodeContentData</span>: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">var</span> <span class="type">NSURLErrorCannotParseResponse</span>: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-12-13T18:54:22.000Z" title="2020-12-13T18:54:22.000Z">2020-12-13</time><span class="level-item">a few seconds read (About 106 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-programatically-select-row-in-List-in-SwiftUI/">How to programatically select row in List in SwiftUI</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/711">#711</a></strong></p>
<p><code>List</code> has a selection parameter where we can pass selection binding. As we can see here <code>selection</code> is of type optional <code>Binding&lt;Set&lt;SelectionValue&gt;&gt;?</code> where <code>SelectionValue</code> is any thing conforming to <code>Hasable</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@available</span>(iOS <span class="number">13.0</span>, macOS <span class="number">10.15</span>, tvOS <span class="number">13.0</span>, watchOS <span class="number">6.0</span>, *)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">List</span>&lt;<span class="title">SelectionValue</span>, <span class="title">Content</span>&gt; : <span class="title">View</span> <span class="title">where</span> <span class="title">SelectionValue</span> : <span class="title">Hashable</span>, <span class="title">Content</span> : <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="meta">@available</span>(watchOS, unavailable)</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">init</span>(selection: <span class="type">Binding</span>&lt;<span class="type">Set</span>&lt;<span class="type">SelectionValue</span>&gt;&gt;?, @<span class="type">ViewBuilder</span> content: () -&gt; <span class="type">Content</span>)</span><br></pre></td></tr></table></figure>

<p>So we can programatically control selection by tagging row with our own <code>Tag</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SideView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">enum</span> <span class="title">Tag</span>: <span class="title">String</span>, <span class="title">Hashable</span> </span>&#123;</span><br><span class="line">        <span class="keyword">case</span> all</span><br><span class="line">        <span class="keyword">case</span> settings</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @<span class="type">State</span></span><br><span class="line">    <span class="keyword">var</span> selection: <span class="type">Tag?</span> = .all</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">List</span> &#123;</span><br><span class="line">            all</span><br><span class="line">                .tag(<span class="type">Tag</span>.all)</span><br><span class="line">            categories</span><br><span class="line">            settings</span><br><span class="line">                .tag(<span class="type">Tag</span>.settings)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-12-07T10:24:19.000Z" title="2020-12-07T10:24:19.000Z">2020-12-07</time><span class="level-item">3 minutes read (About 484 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-mock-UNNotificationResponse-in-unit-tests/">How to mock UNNotificationResponse in unit tests</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/708">#708</a></strong></p>
<p>The best way to test is to not have to mock at all. The second best way is to have your own abstraction over the things you would like to test, either it is in form of protocol or some function injection.</p>
<p>But in case you want a quick way to test things, and want to test as real as possible, then for some cases we can be creative to mock the real objects.</p>
<p>One practical example is when we have some logic to handle notification, either showing or deep link user to certain screen. From iOS 10, notifications are to be delivered via <code>UNUserNotificationCenterDelegate</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@available</span>(iOS <span class="number">10.0</span>, *)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">protocol</span> <span class="title">UNUserNotificationCenterDelegate</span> : <span class="title">NSObjectProtocol</span> </span>&#123;</span><br><span class="line">    <span class="meta">@available</span>(iOS <span class="number">10.0</span>, *)</span><br><span class="line">    <span class="keyword">optional</span> <span class="function"><span class="keyword">func</span> <span class="title">userNotificationCenter</span><span class="params">(<span class="number">_</span> center: UNUserNotificationCenter, didReceive response: UNNotificationResponse, withCompletionHandler completionHandler: @escaping <span class="params">()</span></span></span> -&gt; <span class="type">Void</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>and all we get is <code>UNNotificationResponse</code> which has no real way to construct it.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@available</span>(iOS <span class="number">10.0</span>, *)</span><br><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">UNNotificationResponse</span> : <span class="title">NSObject</span>, <span class="title">NSCopying</span>, <span class="title">NSSecureCoding</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// The notification to which the user responded.</span></span><br><span class="line">    <span class="meta">@NSCopying</span> <span class="keyword">open</span> <span class="keyword">var</span> notification: <span class="type">UNNotification</span> &#123; <span class="keyword">get</span> &#125;</span><br></pre></td></tr></table></figure>

<p>That class inherits from <code>NSCopying</code> which means it is constructed from <code>NSCoder</code>, but how do we init it?</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> response = <span class="type">UNNotificationResponse</span>(coder: ???)</span><br></pre></td></tr></table></figure>

<h2 id="NSObject-and-NSCoder"><a href="#NSObject-and-NSCoder" class="headerlink" title="NSObject and NSCoder"></a>NSObject and NSCoder</h2><p>The trick is, since <code>UNNotificationResponse</code> is <code>NSObject</code> subclass, it is key value compliant, and since it is also <code>NSCopying</code> compliant, we can make a mock coder to construct it</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">KeyedArchiver</span>: <span class="title">NSKeyedArchiver</span> </span>&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">decodeObject</span><span class="params">(forKey <span class="number">_</span>: String)</span></span> -&gt; <span class="type">Any</span> &#123; <span class="string">""</span> &#125;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">decodeInt64</span><span class="params">(forKey key: String)</span></span> -&gt; <span class="type">Int64</span> &#123; <span class="number">0</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>On iOS 12, we need to add <code>decodeInt64</code> method, otherwise <code>UNNotificationResponse</code> init fails. This is not needed on iOS 14</p>
<p><code>UNNotificationResponse</code> has a read only <code>UNNotification</code>, which has a readonly <code>UNNotificationRequest</code>, which can be constructed from a <code>UNNotificationContent</code></p>
<p>Luckily <code>UNNotificationContent</code> has a counterpart <code>UNMutableNotificationContent</code></p>
<p>Now we can make a simple extension on <code>UNNotificationResponse</code> to quickly create that object in tests</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">extension</span> <span class="title">UNNotificationResponse</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">with</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        userInfo: [AnyHashable: <span class="keyword">Any</span>],</span></span></span><br><span class="line"><span class="function"><span class="params">        actionIdentifier: String = UNNotificationDefaultActionIdentifier</span></span></span><br><span class="line"><span class="function"><span class="params">    )</span></span> <span class="keyword">throws</span> -&gt; <span class="type">UNNotificationResponse</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> content = <span class="type">UNMutableNotificationContent</span>()</span><br><span class="line">        content.userInfo = userInfo</span><br><span class="line">        <span class="keyword">let</span> request = <span class="type">UNNotificationRequest</span>(</span><br><span class="line">            identifier: <span class="string">""</span>,</span><br><span class="line">            content: content,</span><br><span class="line">            trigger: <span class="literal">nil</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> notification = <span class="keyword">try</span> <span class="type">XCTUnwrap</span>(<span class="type">UNNotification</span>(coder: <span class="type">KeyedArchiver</span>()))</span><br><span class="line">        notification.setValue(request, forKey: <span class="string">"request"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> response = <span class="keyword">try</span> <span class="type">XCTUnwrap</span>(<span class="type">UNNotificationResponse</span>(coder: <span class="type">KeyedArchiver</span>()))</span><br><span class="line">        response.setValue(notification, forKey: <span class="string">"notification"</span>)</span><br><span class="line">        response.setValue(actionIdentifier, forKey: <span class="string">"actionIdentifier"</span>)</span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>We can then test like normal</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">testResponse</span><span class="params">()</span></span> <span class="keyword">throws</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> data: [<span class="type">AnyHashable</span>: <span class="type">Any</span>] = [</span><br><span class="line">        <span class="string">"data"</span>: [</span><br><span class="line">            <span class="string">"type"</span>: <span class="string">"OPEN_ARTICLE"</span>,</span><br><span class="line">            <span class="string">"articleId"</span>: <span class="string">"1"</span>,</span><br><span class="line">            <span class="string">"articleType"</span>: <span class="string">"Fiction"</span>,</span><br><span class="line">            <span class="string">"articleTag"</span>: <span class="string">"1"</span></span><br><span class="line">        ]</span><br><span class="line">    ]</span><br><span class="line">    <span class="keyword">let</span> response = <span class="keyword">try</span> <span class="type">UNNotificationResponse</span>.with(userInfo: data)</span><br><span class="line">    <span class="keyword">let</span> centerDelegate = <span class="type">ArticleCenterDelegate</span>()</span><br><span class="line">    centerDelegate.userNotificationCenter(</span><br><span class="line">        <span class="type">UNUserNotificationCenter</span>.current(),</span><br><span class="line">        didReceive: response,</span><br><span class="line">        withCompletionHandler: &#123;&#125;</span><br><span class="line">    )</span><br><span class="line">    <span class="type">XCTAssertEqual</span>(response.notification.request.content.userInfo[<span class="string">"type"</span>], <span class="string">"OPEN_ARTICLE"</span>)</span><br><span class="line">    <span class="type">XCTAssertEqual</span>(centerDelegate.didOpenArticle, <span class="literal">true</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="decodeObject-for-key"><a href="#decodeObject-for-key" class="headerlink" title="decodeObject for key"></a>decodeObject for key</h2><p>Another way is to build a proper <code>KeyedArchiver</code> that checks key and return correct property. Note that we can reuse the same <code>NSKeyedArchiver</code> to nested properties.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">KeyedArchiver</span>: <span class="title">NSKeyedArchiver</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> request: <span class="type">UNNotificationRequest</span></span><br><span class="line">    <span class="keyword">let</span> actionIdentifier: <span class="type">String</span></span><br><span class="line">    <span class="keyword">let</span> notification: <span class="type">UNNotification</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">decodeObject</span><span class="params">(forKey key: String)</span></span> -&gt; <span class="type">Any?</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> key &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">"request"</span>:</span><br><span class="line">            <span class="keyword">return</span> request</span><br><span class="line">        <span class="keyword">case</span> <span class="string">"actionIdentifier"</span>:</span><br><span class="line">            <span class="keyword">return</span> actionIdentifier</span><br><span class="line">        <span class="keyword">case</span> <span class="string">"notification"</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="type">UNNotification</span>(coder: <span class="keyword">self</span>)</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<p><strong>Updated at</strong> 2020-12-07 11:49:55</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-12-07T05:16:58.000Z" title="2020-12-07T05:16:58.000Z">2020-12-07</time><span class="level-item">a minute read (About 147 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-support-right-click-menu-to-NSStatusItem/">How to support right click menu to NSStatusItem</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/707">#707</a></strong></p>
<p>The trick is to set the button oinside of <code>statusItem</code> to send actions on both <code>leftMouseUp</code> and <code>rightMouseUp</code>.</p>
<p>Another thing to note is we use <code>popUpMenu</code> on <code>NSStatusItem</code>, although it is marked as deprecated on macOS 10.14. We can set <code>menu</code> but that overrides left click. </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Omnia</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">let</span> statusItem = <span class="type">NSStatusBar</span>.system.statusItem(withLength: <span class="type">NSStatusItem</span>.squareLength)</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">let</span> statusItemMenuHandler = <span class="type">MenuHandler</span>()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">setupStatusMenu</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> button = statusItem.button &#123;</span><br><span class="line">        button.image = <span class="type">NSImage</span>(named: <span class="type">NSImage</span>.<span class="type">Name</span>(<span class="string">"statusMenuIcon"</span>))</span><br><span class="line">        button.contentTintColor = <span class="type">NSColor</span>.black</span><br><span class="line">        button.action = #selector(statusMenuButtonTouched(<span class="number">_</span>:))</span><br><span class="line">        button.sendAction(on: [.leftMouseUp, .rightMouseUp]) <span class="comment">// This is important</span></span><br><span class="line"></span><br><span class="line">        statusItemMenuHandler.add(title: <span class="string">"About"</span>, action: &#123;</span><br><span class="line">            <span class="type">NSWorkspace</span>.shared.<span class="keyword">open</span>(<span class="type">URL</span>(string: <span class="string">"https://onmyway133.com/pushhero"</span>)!)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@objc</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">statusMenuButtonTouched</span><span class="params">(<span class="number">_</span> sender: NSStatusBarButton)</span></span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> event = <span class="type">NSApp</span>.currentEvent <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">    <span class="keyword">switch</span> event.type &#123;</span><br><span class="line">    <span class="keyword">case</span> .rightMouseUp:</span><br><span class="line">        statusItem.popUpMenu(statusItemMenuHandler.menu)</span><br><span class="line">        <span class="comment">// statusItem.menu = statusItemMenuHandler.menu // this overrides left click</span></span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        popover.toggle()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<p><strong>Updated at</strong> 2020-12-08 05:11:24</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-12-07T05:04:21.000Z" title="2020-12-07T05:04:21.000Z">2020-12-07</time><span class="level-item">a few seconds read (About 87 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-convert-struct-to-Core-Data-NSManagedObject/">How to convert struct to Core Data NSManagedObject</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/706">#706</a></strong></p>
<p>Use <code>Mirror</code> and set key value as <code>NSManagedObject</code> subclasses from <code>NSObject</code> </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> CoreData</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ManagedObjectConverter</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">convert</span>&lt;M&gt;<span class="params">(m: M, context: NSManagedObjectContext)</span></span> <span class="keyword">throws</span> -&gt; <span class="type">NSManagedObject</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> entityName = <span class="type">String</span>(describing: m)</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> entityDescription = <span class="type">NSEntityDescription</span>.entity(</span><br><span class="line">            forEntityName: entityName,</span><br><span class="line">            <span class="keyword">in</span>: context</span><br><span class="line">        ) <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="type">AppError</span>.parsing</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> managedObject = <span class="type">NSManagedObject</span>(</span><br><span class="line">            entity: entityDescription,</span><br><span class="line">            insertInto: context</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> mirror = <span class="type">Mirror</span>(reflecting: m)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">guard</span> mirror.displayStyle == .<span class="keyword">struct</span> <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="type">AppError</span>.parsing</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> <span class="keyword">case</span> <span class="keyword">let</span> (label?, anyValue) <span class="keyword">in</span> mirror.children &#123;</span><br><span class="line">            managedObject.setValue(anyValue, forKey: label)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> managedObject</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<p><strong>Updated at</strong> 2020-12-07 06:05:04</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-12-05T04:31:35.000Z" title="2020-12-05T04:31:35.000Z">2020-12-05</time><span class="level-item">a few seconds read (About 100 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-declare-Error-in-Swift/">How to declare Error in Swift</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/704">#704</a></strong></p>
<p>We used to declare enum that conforms to <code>Error</code>, but any type like struct or class can conform to Error as well.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">NetworkError</span>: <span class="title">Error</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> failToCreateRequest</span><br><span class="line">    <span class="keyword">case</span> failToParseResponse</span><br><span class="line">    <span class="keyword">case</span> failToReachServe</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">DetailError</span>: <span class="title">Error</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> networkError: <span class="type">Error</span></span><br><span class="line">    <span class="keyword">let</span> createdAt: <span class="type">Date</span></span><br><span class="line">    <span class="keyword">let</span> tag: <span class="type">String</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">TrackError</span>: <span class="title">Error</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> trackId: <span class="type">String</span></span><br><span class="line">    <span class="keyword">let</span> detailError: <span class="type">DetailError</span></span><br><span class="line">    <span class="keyword">let</span> trackSession: <span class="type">String</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(trackId: <span class="type">String</span>, detailError: <span class="type">DetailError</span>, trackSession: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.trackId = trackId</span><br><span class="line">        <span class="keyword">self</span>.detailError = detailError</span><br><span class="line">        <span class="keyword">self</span>.trackSession = trackSession</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> networkError = <span class="type">NetworkError</span>.failToCreateRequest</span><br><span class="line"><span class="keyword">let</span> detailError = <span class="type">DetailError</span>(networkError: networkError, createdAt: <span class="type">Date</span>(), tag: <span class="string">"0.1"</span>)</span><br><span class="line"><span class="keyword">let</span> trackError = <span class="type">TrackError</span>(trackId: <span class="string">"AB-01"</span>, detailError: detailError, trackSession: <span class="string">"101"</span>)</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-11-30T19:26:10.000Z" title="2020-11-30T19:26:10.000Z">2020-11-30</time><span class="level-item">14 minutes read (About 2040 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-convert-from-paid-to-free-with-IAP/">How to convert from paid to free with IAP</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/703">#703</a></strong></p>
<h2 id="What-is-receipt"><a href="#What-is-receipt" class="headerlink" title="What is receipt"></a>What is receipt</h2><p>Read <a href="https://stackoverflow.com/questions/45615106/when-to-refresh-a-receipt-vs-restore-purchases-in-ios">When to refresh a receipt vs restore purchases in iOS?</a></p>
<p>From iOS 7, every app downloaded from the store has a receipt (for downloading/buying the app) at <code>appStoreReceiptURL</code>. When users purchases something via In App Purchase, the content at <code>appStoreReceiptURL</code> is updated with purchases information. Most of the cases, you just need to refresh the receipt (at appStoreReceiptURL) so that you know which transactions users have made.</p>
<p><strong>Note</strong></p>
<ul>
<li>Receipt is generated and bundled with your app when user download the app, whether it is free or paid</li>
<li>When user makes IAP, receipt is updated with IAP information</li>
<li>When user downloads an app (download free, or purchase paid app), they get future updates (whether free or paid) forever.</li>
<li>Call <code>SKReceiptRefreshRequest</code> or <code>SKPaymentQueue.restoreCompletedTransactions</code> asks for Appstore credential</li>
<li>When we build the app from Xcode or download from Testflight, receipt is not bundled within the app since the app is not downloaded from AppStore. We can use <code>SKReceiptRefreshRequest</code> to download receipt from sandbox Appstore</li>
<li><code>restoreCompletedTransactions</code> updates app receipt</li>
<li>Receipt is stored locally on device, so when user uninstalls and reinstalls your app, there’s no in app purchases information, this is when you should refresh receipt or <code>restoreCompletedTransactions</code></li>
</ul>
<p>Users restore transactions to maintain access to content they’ve already purchased. For example, when they upgrade to a new phone, they don’t lose all of the items they purchased on the old phone. Include some mechanism in your app to let the user restore their purchases, such as a Restore Purchases button. Restoring purchases prompts for the user’s App Store credentials, which interrupts the flow of your app: because of this, don’t automatically restore purchases, especially not every time your app is launched.</p>
<p>In most cases, all your app needs to do is refresh its receipt and deliver the products in its receipt. The refreshed receipt contains a record of the user’s purchases in this app, on this device or any other device. However, some apps need to take an alternate approach for one of the following reasons:</p>
<ul>
<li>If you use Apple-hosted content, restoring completed transactions gives your app the transaction objects it uses to download the content. If you need to support versions of iOS earlier than iOS 7, where the app receipt isn’t available, restore completed transactions instead.</li>
<li>Refreshing the receipt asks the App Store for the latest copy of the receipt. Refreshing a receipt does not create any new transactions.</li>
<li>Restoring completed transactions creates a new transaction for every completed transaction the user made, essentially replaying history for your transaction queue observer.</li>
</ul>
<p>More about receipt, from WWDC 2017, What’s new in StoreKit session <a href="https://developer.apple.com/videos/play/wwdc2017/303/">https://developer.apple.com/videos/play/wwdc2017/303/</a></p>
<p><img src="https://user-images.githubusercontent.com/2284279/100661732-38507b00-3354-11eb-9198-104410e5ddfb.png" alt="receipt"></p>
<p>You can also watch WWDC 2017, session Advanced StoreKit for more detail <a href="https://developer.apple.com/videos/play/wwdc2017/305/">https://developer.apple.com/videos/play/wwdc2017/305/</a></p>
<p><img src="https://user-images.githubusercontent.com/2284279/100661745-3d152f00-3354-11eb-943d-9c6d9b79000d.png" alt="receipt tips"></p>
<h2 id="Restoring-Purchased-Products"><a href="#Restoring-Purchased-Products" class="headerlink" title="Restoring Purchased Products"></a>Restoring Purchased Products</h2><p>Read <a href="https://developer.apple.com/documentation/storekit/in-app_purchase/restoring_purchased_products">Restoring Purchased Products</a></p>
<blockquote>
<p>Users sometimes need to restore purchased content, such as when they upgrade to a new phone.</p>
</blockquote>
<blockquote>
<p>Don’t automatically restore purchases, especially when your app is launched. Restoring purchases prompts for the user’s App Store credentials, which interrupts the flow of your app</p>
</blockquote>
<blockquote>
<p>In most cases, you only need to refresh the app receipt and deliver the products listed on the receipt. The refreshed receipt contains a record of the user’s purchases in this app, from any device the user’s App Store account is logged into</p>
</blockquote>
<blockquote>
<p>Refreshing a receipt doesn’t create new transactions; it requests the latest copy of the receipt from the App Store</p>
</blockquote>
<blockquote>
<p>Restoring completed transactions creates a new transaction for every transaction previously completed, essentially replaying history for your transaction queue observer. Your app maintains its own state to keep track of why it’s restoring completed transactions and how to handle them.</p>
</blockquote>
<h2 id="What-are-the-different-IAP-types"><a href="#What-are-the-different-IAP-types" class="headerlink" title="What are the different IAP types"></a>What are the different IAP types</h2><p>From AppStore</p>
<h3 id="Consumable-pay-everytime"><a href="#Consumable-pay-everytime" class="headerlink" title="Consumable (pay everytime)"></a>Consumable (pay everytime)</h3><p>A consumable In-App Purchase must be purchased every time the user downloads it. One-time services, such as fish food in a fishing app, are usually implemented as consumables.</p>
<h3 id="Non-Consumable-one-time-payment"><a href="#Non-Consumable-one-time-payment" class="headerlink" title="Non-Consumable (one time payment)"></a>Non-Consumable (one time payment)</h3><p>Non-consumable In-App Purchases only need to be purchased once by users. Services that do not expire or decrease with use are usually implemented as non-consumables, such as new race tracks for a game app.</p>
<h3 id="Auto-Renewable-Subscriptions-will-deduct-money-from-your-credit-card-on-a-cycle-complete"><a href="#Auto-Renewable-Subscriptions-will-deduct-money-from-your-credit-card-on-a-cycle-complete" class="headerlink" title="Auto-Renewable Subscriptions (will deduct money from your credit card on a cycle complete)"></a>Auto-Renewable Subscriptions (will deduct money from your credit card on a cycle complete)</h3><p>Auto-renewable Subscriptions allow the user to purchase updating and dynamic content for a set duration of time. Subscriptions renew automatically unless the user opts out, such as magazine subscriptions.</p>
<h3 id="Free-Subscription-no-payment-and-is-still-visible-even-you-did-not-submitted-your-account-detail-to-itunes-connect"><a href="#Free-Subscription-no-payment-and-is-still-visible-even-you-did-not-submitted-your-account-detail-to-itunes-connect" class="headerlink" title="Free Subscription (no payment and is still visible even you did not submitted your account detail to itunes connect)"></a>Free Subscription (no payment and is still visible even you did not submitted your account detail to itunes connect)</h3><p>Free subscriptions are a way for developers to put free subscription content in Newsstand. Once a user signs up for a free subscription, it will be available on all devices associated with the user’s Apple ID. Note that free subscriptions do not expire and can only be offered in Newsstand-enabled apps.</p>
<h3 id="Non-Renewing-need-to-renew-manually"><a href="#Non-Renewing-need-to-renew-manually" class="headerlink" title="Non-Renewing (need to renew manually)"></a>Non-Renewing (need to renew manually)</h3><p>Subscription Non-Renewing Subscriptions allow the sale of services with a limited duration. Non-Renewing Subscriptions must be used for In-App Purchases that offer time-based access to static content. Examples include a one week subscription to voice guidance feature within a navigation app or an annual subscription to online catalog of archived video or audio.</p>
<h2 id="When-is-app-receipt-missing"><a href="#When-is-app-receipt-missing" class="headerlink" title="When is app receipt missing"></a>When is app receipt missing</h2><p>Read <a href="https://developer.apple.com/documentation/storekit/skreceiptrefreshrequest">SKReceiptRefreshRequest</a></p>
<blockquote>
<p>Use this API to request a new receipt if the receipt is invalid or missing</p>
</blockquote>
<p>Receipt is stored locally on device. It can be missing in case user sync or restore device.</p>
<p>Watch <a href="https://asciiwwdc.com/2014/sessions/305">WWDC 2014 - 305 Preventing Unauthorized Purchases with Receipts</a></p>
<h2 id="How-to-check-receipt-existence"><a href="#How-to-check-receipt-existence" class="headerlink" title="How to check receipt existence"></a>How to check receipt existence</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Bundle</span>.main.appStoreReceiptURL</span><br><span class="line">checkResourceIsReachable</span><br></pre></td></tr></table></figure>

<h2 id="How-to-read-receipt"><a href="#How-to-read-receipt" class="headerlink" title="How to read receipt"></a>How to read receipt</h2><p>Read <a href="https://www.raywenderlich.com/9257-in-app-purchases-receipt-validation-tutorial">In-App Purchases: Receipt Validation Tutorial</a></p>
<blockquote>
<p>The receipt consists of a single file in the app bundle. The file is in a format called PKCS #7. The payload consists of a set of receipt attributes in a cross-platform format called ASN.1</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="number">12</span>: <span class="comment">// Receipt Creation Date</span></span><br><span class="line">  <span class="keyword">var</span> dateStartPtr = ptr</span><br><span class="line">  receiptCreationDate = readASN1Date(ptr: &amp;dateStartPtr, maxLength: length)</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="number">17</span>: <span class="comment">// IAP Receipt</span></span><br><span class="line">  <span class="built_in">print</span>(<span class="string">"IAP Receipt."</span>)</span><br><span class="line">  </span><br><span class="line"><span class="keyword">case</span> <span class="number">19</span>: <span class="comment">// Original App Version</span></span><br><span class="line">  <span class="keyword">var</span> stringStartPtr = ptr</span><br><span class="line">  originalAppVersion = readASN1String(ptr: &amp;stringStartPtr, maxLength: length)</span><br></pre></td></tr></table></figure>

<p>Use <a href="https://github.com/tikhop/TPInAppReceipt">TPInAppReceipt</a> which includes certificates.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> <span class="type">InAppReceipt</span>.localReceipt()</span><br></pre></td></tr></table></figure>

<p>Check <a href="https://developer.apple.com/library/archive/releasenotes/General/ValidateAppStoreReceipt/Chapters/ReceiptFields.html">Receipt Fields</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Original Application Version</span><br><span class="line">The version of the app that was originally purchased.</span><br><span class="line">ASN.1 Field Type 19</span><br><span class="line">ASN.1 Field Value UTF8STRING</span><br></pre></td></tr></table></figure>

<p><strong>Note</strong></p>
<blockquote>
<p>This corresponds to the value of CFBundleVersion (in iOS) or CFBundleShortVersionString (in macOS) in the Info.plist file when the purchase was originally made</p>
</blockquote>
<p><code>CFBundleVersion</code> is build number, and <code>CFBundleShortVersionString</code> is app version</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">In-App Purchase Receipt</span><br><span class="line">The receipt for an in-app purchase.</span><br><span class="line">ASN.1 Field Type 17</span><br></pre></td></tr></table></figure>

<p>Read <a href="https://developer.apple.com/documentation/storekit/in-app_purchase/validating_receipts_with_the_app_store">Validating Receipts with the App Store</a></p>
<p>Sample <code>verifyReceipt</code> json</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"receipt"</span>: &#123;</span><br><span class="line">        <span class="attr">"receipt_type"</span>: <span class="string">"ProductionSandbox"</span>,</span><br><span class="line">        <span class="attr">"adam_id"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">"app_item_id"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">"bundle_id"</span>: <span class="string">"com.example.app.ios"</span>,</span><br><span class="line">        <span class="attr">"application_version"</span>: <span class="string">"3"</span>,</span><br><span class="line">        <span class="attr">"download_id"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">"version_external_identifier"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">"receipt_creation_date"</span>: <span class="string">"2018-11-13 16:46:31 Etc/GMT"</span>,</span><br><span class="line">        <span class="attr">"receipt_creation_date_ms"</span>: <span class="string">"1542127591000"</span>,</span><br><span class="line">        <span class="attr">"receipt_creation_date_pst"</span>: <span class="string">"2018-11-13 08:46:31 America/Los_Angeles"</span>,</span><br><span class="line">        <span class="attr">"request_date"</span>: <span class="string">"2018-11-13 17:10:31 Etc/GMT"</span>,</span><br><span class="line">        <span class="attr">"request_date_ms"</span>: <span class="string">"1542129031280"</span>,</span><br><span class="line">        <span class="attr">"request_date_pst"</span>: <span class="string">"2018-11-13 09:10:31 America/Los_Angeles"</span>,</span><br><span class="line">        <span class="attr">"original_purchase_date"</span>: <span class="string">"2013-08-01 07:00:00 Etc/GMT"</span>,</span><br><span class="line">        <span class="attr">"original_purchase_date_ms"</span>: <span class="string">"1375340400000"</span>,</span><br><span class="line">        <span class="attr">"original_purchase_date_pst"</span>: <span class="string">"2013-08-01 00:00:00 America/Los_Angeles"</span>,</span><br><span class="line">        <span class="attr">"original_application_version"</span>: <span class="string">"1.0"</span>,</span><br><span class="line">        <span class="attr">"in_app"</span>: [&#123;</span><br><span class="line">            <span class="attr">"quantity"</span>: <span class="string">"1"</span>,</span><br><span class="line">            <span class="attr">"product_id"</span>: <span class="string">"test2"</span>,</span><br><span class="line">            <span class="attr">"transaction_id"</span>: <span class="string">"1000000472106082"</span>,</span><br><span class="line">            <span class="attr">"original_transaction_id"</span>: <span class="string">"1000000472106082"</span>,</span><br><span class="line">            <span class="attr">"purchase_date"</span>: <span class="string">"2018-11-13 16:46:31 Etc/GMT"</span>,</span><br><span class="line">            <span class="attr">"purchase_date_ms"</span>: <span class="string">"1542127591000"</span>,</span><br><span class="line">            <span class="attr">"purchase_date_pst"</span>: <span class="string">"2018-11-13 08:46:31 America/Los_Angeles"</span>,</span><br><span class="line">            <span class="attr">"original_purchase_date"</span>: <span class="string">"2018-11-13 16:46:31 Etc/GMT"</span>,</span><br><span class="line">            <span class="attr">"original_purchase_date_ms"</span>: <span class="string">"1542127591000"</span>,</span><br><span class="line">            <span class="attr">"original_purchase_date_pst"</span>: <span class="string">"2018-11-13 08:46:31 America/Los_Angeles"</span>,</span><br><span class="line">            <span class="attr">"is_trial_period"</span>: <span class="string">"false"</span></span><br><span class="line">        &#125;]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"status"</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">"environment"</span>: <span class="string">"Sandbox"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Verify your receipt first with the production URL; then verify with the sandbox URL if you receive a 21007 status code. This approach ensures you do not have to switch between URLs while your application is tested, reviewed by App Review, or live in the App Store.</p>
</blockquote>
<h2 id="Show-me-the-code"><a href="#Show-me-the-code" class="headerlink" title="Show me the code"></a>Show me the code</h2><p>Let’s use enum to represent possible states for each resource. Here’s simple case where we only have 1 non consumable IAP product.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">IAPError</span>: <span class="title">Error</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> failedToRefreshReceipt</span><br><span class="line">    <span class="keyword">case</span> failedToRequestProduct</span><br><span class="line">    <span class="keyword">case</span> failedToPurchase</span><br><span class="line">    <span class="keyword">case</span> receiptNotFound</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">IAPResourceState</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> notAsked</span><br><span class="line">    <span class="keyword">case</span> loading</span><br><span class="line">    <span class="keyword">case</span> success(<span class="type">T</span>)</span><br><span class="line">    <span class="keyword">case</span> failure(<span class="type">IAPError</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">PricingPlan</span>: <span class="title">ObservableObject</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> pro = (<span class="type">Bundle</span>.main.bundleIdentifier ?? <span class="string">""</span>) + <span class="string">".pro"</span></span><br><span class="line"></span><br><span class="line">    @<span class="type">Published</span></span><br><span class="line">    <span class="keyword">var</span> isPro: <span class="type">Bool</span> = <span class="literal">false</span></span><br><span class="line">    @<span class="type">Published</span></span><br><span class="line">    <span class="keyword">var</span> product: <span class="type">IAPResourceState</span>&lt;<span class="type">SKProduct</span>&gt; = .notAsked</span><br><span class="line">    @<span class="type">Published</span></span><br><span class="line">    <span class="keyword">var</span> purchase: <span class="type">IAPResourceState</span>&lt;<span class="type">SKPayment</span>&gt; = .notAsked</span><br><span class="line">    @<span class="type">Published</span></span><br><span class="line">    <span class="keyword">var</span> receipt: <span class="type">IAPResourceState</span>&lt;<span class="type">InAppReceipt</span>&gt; = .notAsked</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Let’s have a central place for managing all IAP operations, called <code>IAPManager</code>, it can update our <code>ObservableObject</code> <code>PricingPlan</code> hence triggers update to SwiftUI.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> StoreKit</span><br><span class="line"><span class="keyword">import</span> TPInAppReceipt</span><br><span class="line"><span class="keyword">import</span> Version</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">IAPManager</span>: <span class="title">NSObject</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">let</span> pricingPlan: <span class="type">PricingPlan</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">let</span> paymentQueue: <span class="type">SKPaymentQueue</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(pricingPlan: <span class="type">PricingPlan</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.pricingPlan = pricingPlan</span><br><span class="line">        <span class="keyword">self</span>.paymentQueue = <span class="type">SKPaymentQueue</span>.<span class="keyword">default</span>()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">self</span>.paymentQueue.add(<span class="keyword">self</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">requestProducts</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">let</span> identifiers = <span class="type">PricingPlan</span>.pro</span><br><span class="line">        <span class="keyword">let</span> request = <span class="type">SKProductsRequest</span>(productIdentifiers: <span class="type">Set</span>(arrayLiteral: identifiers))</span><br><span class="line">        request.delegate = <span class="keyword">self</span></span><br><span class="line">        pricingPlan.product = .loading</span><br><span class="line">        request.start()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">purchase</span><span class="params">(product: SKProduct)</span></span> &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="type">SKPaymentQueue</span>.canMakePayments() <span class="keyword">else</span> &#123;</span><br><span class="line">            showAlert(text: <span class="string">"You are not allowed to make payment. Please check device settings."</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        pricingPlan.purchase = .loading</span><br><span class="line">        <span class="keyword">let</span> payment = <span class="type">SKPayment</span>(product: product)</span><br><span class="line">        paymentQueue.add(payment)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">refreshReceipt</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">let</span> request = <span class="type">SKReceiptRefreshRequest</span>()</span><br><span class="line">        request.delegate = <span class="keyword">self</span></span><br><span class="line">        request.start()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">restorePurchase</span><span class="params">()</span></span> &#123;</span><br><span class="line">        paymentQueue.restoreCompletedTransactions()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Refresh-receipt"><a href="#Refresh-receipt" class="headerlink" title="Refresh receipt"></a>Refresh receipt</h3><p>You can use <code>restoreCompletedTransactions</code> if you simply <code>finishTransaction</code> and grant user pro feature, like in this simple tutorial <a href="https://www.raywenderlich.com/5456-in-app-purchase-tutorial-getting-started">In-App Purchase Tutorial: Getting Started</a>, search for <code>SKPaymentTransactionObserver</code>. <code>restoreCompletedTransactions</code> also updates receipt.</p>
<p>Otherwise refreshing receipt is a better idea. It serves both case when receipt is not there locally and when you want to restore transactions. With receipt refreshing, no restored transactions are created and <code>SKPaymentTransactionObserver</code> is not called, so we need to check receipt proactively.</p>
<p>Either <code>restoreCompletedTransactions</code>  or <code>SKReceiptRefreshRequest</code> asks for AppStore credential so you should present a button there and ask user.</p>
<h3 id="Check-local-receipt"><a href="#Check-local-receipt" class="headerlink" title="Check local receipt"></a>Check local receipt</h3><p>Try to locate local receipt and examine it.</p>
<ul>
<li>If it is not there (missing, corrupted), refresh receipt</li>
<li>If it’s there, check if it was from a version when the app was still as paid. Notice the difference in meaning of <code>originalAppVersion</code> in macOS and iOS</li>
<li>If it is not paid, check if this receipt contains In App Purchase information for our product</li>
</ul>
<p>In practice, we need to perform some basic checks on receipt, like bundle id, app version, device id. Read <a href="https://www.raywenderlich.com/9257-in-app-purchases-receipt-validation-tutorial">In-App Purchases: Receipt Validation Tutorial</a>, search for <code>Validating the Receipt</code>. <code>TPInAppReceipt</code> also has some handy <code>verify</code> functions</p>
<p>Besides verifying receipt locally, it is advisable to call <a href="https://developer.apple.com/documentation/appstorereceipts/verifyreceipt">verifyreceipt</a> either on device, or better on serve to let Apple verify receipt and returns you a human readable json for receipt information.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">checkReceipt</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="type">DispatchQueue</span>.main.async &#123;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> receipt = <span class="keyword">try</span> <span class="type">InAppReceipt</span>.localReceipt()</span><br><span class="line">            <span class="keyword">self</span>.pricingPlan.receipt = .success(receipt)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">self</span>.isPaid(receipt: receipt) &#123;</span><br><span class="line">                <span class="keyword">self</span>.pricingPlan.isPro = <span class="literal">true</span></span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> receipt.containsPurchase(ofProductIdentifier: <span class="type">PricingPlan</span>.pro) &#123;</span><br><span class="line">                <span class="keyword">self</span>.pricingPlan.isPro = <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="keyword">self</span>.pricingPlan.receipt = .failure(.receiptNotFound)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">isPaid</span><span class="params">(receipt: InAppReceipt)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    #<span class="keyword">if</span> os(macOS)</span><br><span class="line">    <span class="comment">// originalAppVersion is CFBundleShortVersionString</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> version = <span class="type">Version</span>(receipt.originalAppVersion) &#123;</span><br><span class="line">        <span class="keyword">return</span> version &lt; versionToIAP</span><br><span class="line">    &#125;</span><br><span class="line">    #<span class="keyword">else</span></span><br><span class="line">    <span class="comment">// originalAppVersion is CFBundleVersion</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> buildNumber = <span class="type">Int</span>(receipt.originalAppVersion) &#123;</span><br><span class="line">        <span class="keyword">return</span> buildNumber &lt; buildNumberToIAP</span><br><span class="line">    &#125;</span><br><span class="line">    #endif</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Finally, observe <code>SKProductsRequestDelegate</code> which also conforms to <code>SKRequestDelegate</code> for both product and receipt refresh request</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">IAPManager</span>: <span class="title">SKProductsRequestDelegate</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">productsRequest</span><span class="params">(<span class="number">_</span> request: SKProductsRequest, didReceive response: SKProductsResponse)</span></span> &#123;</span><br><span class="line">        <span class="type">DispatchQueue</span>.main.async &#123;</span><br><span class="line">            <span class="keyword">guard</span> <span class="keyword">let</span> product = response.products.first <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">self</span>.pricingPlan.product = .failure(<span class="type">IAPError</span>.failedToRequestProduct)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">self</span>.pricingPlan.product = .success(product)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">request</span><span class="params">(<span class="number">_</span> request: SKRequest, didFailWithError error: Error)</span></span> &#123;</span><br><span class="line">        <span class="type">DispatchQueue</span>.main.async &#123;</span><br><span class="line">            <span class="keyword">switch</span> request &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="keyword">is</span> <span class="type">SKProductsRequest</span>:</span><br><span class="line">                <span class="keyword">self</span>.pricingPlan.product = .failure(<span class="type">IAPError</span>.failedToRequestProduct)</span><br><span class="line">            <span class="keyword">case</span> <span class="keyword">is</span> <span class="type">SKReceiptRefreshRequest</span>:</span><br><span class="line">                <span class="keyword">self</span>.pricingPlan.receipt = .failure(<span class="type">IAPError</span>.failedToRefreshReceipt)</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">requestDidFinish</span><span class="params">(<span class="number">_</span> request: SKRequest)</span></span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> request &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="keyword">is</span> <span class="type">SKReceiptRefreshRequest</span>:</span><br><span class="line">            checkReceipt()</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<p><strong>Updated at</strong> 2020-12-04 06:58:17</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-11-17T12:05:29.000Z" title="2020-11-17T12:05:29.000Z">2020-11-17</time><span class="level-item">3 minutes read (About 388 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-search-using-regular-expression-in-Xcode/">How to search using regular expression in Xcode</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/698">#698</a></strong></p>
<p>Xcode has powerful search. We can constrain search to be scoped in workspace, project or some folders. We can also constrain case sensitivity. </p>
<p>Another cool thing that people tend to overlook is, besides searching based on text, we can search based on references, definitions, call hierarchy, and 🎉 regular expressions.</p>
<img width="1374" alt="Screenshot 2020-12-11 at 11 27 48" src="https://user-images.githubusercontent.com/2284279/101893352-e8b84d80-3ba4-11eb-9a54-8fd46bd970ba.png">


<p>Searching for regular expression gives us extra power when it comes to limit our search based on some criteria. For example when we are about to refactor some <code>NSLayoutAnchor</code> code and we want to find all <code>NSLayoutConstraint.</code> calls that stops at  <code>bottomAnchor</code></p>
<p>Here ‘s how to search <code>NSLayoutConstraint</code> calls that involves <code>bottomAnchor</code> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(NSLayoutConstraint(.*[\r\n])*).+?(?&#x3D;bottomAnchor)</span><br></pre></td></tr></table></figure>

<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">NSLayoutConstraint</span>.activate([</span><br><span class="line">    child.leadingAnchor.constraint(equalTo: parent.safeAreaLayoutGuide.leadingAnchor),</span><br><span class="line">    child.trailingAnchor.constraint(equalTo: parent.safeAreaLayoutGuide.trailingAnchor),</span><br><span class="line">    child.topAnchor.constraint(equalTo: parent.safeAreaLayoutGuide.topAnchor),</span><br><span class="line">    child.bottomAnchor.constraint(equalTo: parent.safeAreaLayoutGuide.bottomAnchor)</span><br><span class="line">])</span><br></pre></td></tr></table></figure>

<p>Another tip when searching for regular expression is that we can use <a href="https://regex101.com/">https://regex101.com/</a> to validate and fine tune our regex. Below are breakdowns of our regex. Note how we use <code>/.+?(?=abc)/</code> to define “search until”</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;</span><br><span class="line">(NSLayoutConstraint(.*[\r\n])*).+?(?&#x3D;bottomAnchor)</span><br><span class="line">&#x2F;</span><br><span class="line">gm</span><br><span class="line">1st Capturing Group (NSLayoutConstraint(.*[\r\n])*)</span><br><span class="line">NSLayoutConstraint matches the characters NSLayoutConstraint literally (case sensitive)</span><br><span class="line">2nd Capturing Group (.*[\r\n])*</span><br><span class="line">* Quantifier — Matches between zero and unlimited times, as many times as possible, giving back as needed (greedy)</span><br><span class="line">A repeated capturing group will only capture the last iteration. Put a capturing group around the repeated group to capture all iterations or use a non-capturing group instead if you&#39;re not interested in the data</span><br><span class="line">.* matches any character (except for line terminators)</span><br><span class="line">* Quantifier — Matches between zero and unlimited times, as many times as possible, giving back as needed (greedy)</span><br><span class="line">Match a single character present in the list below [\r\n]</span><br><span class="line">\r matches a carriage return (ASCII 13)</span><br><span class="line">\n matches a line-feed (newline) character (ASCII 10)</span><br><span class="line">.+? matches any character (except for line terminators)</span><br><span class="line">+? Quantifier — Matches between one and unlimited times, as few times as possible, expanding as needed (lazy)</span><br><span class="line">Positive Lookahead (?&#x3D;bottomAnchor)</span><br><span class="line">Assert that the Regex below matches</span><br><span class="line">bottomAnchor matches the characters bottomAnchor literally (case sensitive)</span><br><span class="line">Global pattern flags</span><br><span class="line">g modifier: global. All matches (don&#39;t return after first match)</span><br><span class="line">m modifier: multi line. Causes ^ and $ to match the begin&#x2F;end of each line (not only begin&#x2F;end of string)</span><br></pre></td></tr></table></figure>


<hr>
<p><strong>Updated at</strong> 2020-12-11 10:35:14</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-11-15T05:23:39.000Z" title="2020-11-15T05:23:39.000Z">2020-11-15</time><span class="level-item">a few seconds read (About 51 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-write-to-temporary-file-in-Swift/">How to write to temporary file in Swift</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/697">#697</a></strong></p>
<p>Use <code>temporaryDirectory</code> from <code>FileManager</code> and <code>String.write</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">writeTempFile</span><span class="params">(books: [Book])</span></span> -&gt; <span class="type">URL</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> url = <span class="type">FileManager</span>.<span class="keyword">default</span>.temporaryDirectory</span><br><span class="line">        .appendingPathComponent(<span class="type">UUID</span>().uuidString)</span><br><span class="line">        .appendingPathExtension(<span class="string">"txt"</span>)</span><br><span class="line">    <span class="keyword">let</span> string = books</span><br><span class="line">        .<span class="built_in">map</span>(&#123;</span><br><span class="line">            <span class="string">"book '\($0.url.path)'"</span></span><br><span class="line">        &#125;)</span><br><span class="line">        .joined(separator: <span class="string">"\n"</span>)</span><br><span class="line">    <span class="keyword">try</span>? string.write(to: url, atomically: <span class="literal">true</span>, encoding: .utf8)</span><br><span class="line">    <span class="keyword">return</span> url</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-11-14T05:17:15.000Z" title="2020-11-14T05:17:15.000Z">2020-11-14</time><span class="level-item">a minute read (About 130 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-use-functions-with-default-arguments-in-Swift/">How to use functions with default arguments in Swift</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/696">#696</a></strong></p>
<p>Which methods do you think are used here</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Cocoa</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Robot</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> a: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">let</span> b: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">let</span> <span class="built_in">c</span>: <span class="type">Int</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(a: <span class="type">Int</span> = <span class="number">1</span>, <span class="built_in">c</span>: <span class="type">Int</span> = <span class="number">3</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.a = a</span><br><span class="line">        <span class="keyword">self</span>.b = <span class="number">0</span></span><br><span class="line">        <span class="keyword">self</span>.<span class="built_in">c</span> = <span class="built_in">c</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Init with a=\(a) and c=\(c)"</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(a: <span class="type">Int</span> = <span class="number">1</span>, b: <span class="type">Int</span> = <span class="number">2</span>, <span class="built_in">c</span>: <span class="type">Int</span> = <span class="number">3</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.a = a</span><br><span class="line">        <span class="keyword">self</span>.b = b</span><br><span class="line">        <span class="keyword">self</span>.<span class="built_in">c</span> = <span class="built_in">c</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Init with a\(a), b=\(b) and c=\(c)"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> r1 = <span class="type">Robot</span>(<span class="built_in">c</span>: <span class="number">10</span>)</span><br><span class="line"><span class="keyword">let</span> r2 = <span class="type">Robot</span>(a: <span class="number">5</span>, <span class="built_in">c</span>: <span class="number">10</span>)</span><br><span class="line"><span class="keyword">let</span> r3 = <span class="type">Robot</span>(a: <span class="number">5</span>, b: <span class="number">7</span>, <span class="built_in">c</span>: <span class="number">10</span>)</span><br><span class="line"><span class="keyword">let</span> r4 = <span class="type">Robot</span>(a: <span class="number">5</span>)</span><br><span class="line"><span class="keyword">let</span> r5 = <span class="type">Robot</span>(b: <span class="number">5</span>)</span><br></pre></td></tr></table></figure>

<p>The log is </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Init</span> with a=<span class="number">1</span> and <span class="built_in">c</span>=<span class="number">10</span></span><br><span class="line"><span class="type">Init</span> with a=<span class="number">5</span> and <span class="built_in">c</span>=<span class="number">10</span></span><br><span class="line"><span class="type">Init</span> with a5, b=<span class="number">7</span> and <span class="built_in">c</span>=<span class="number">10</span></span><br><span class="line"><span class="type">Init</span> with a=<span class="number">5</span> and <span class="built_in">c</span>=<span class="number">3</span></span><br><span class="line"><span class="type">Init</span> with a1, b=<span class="number">5</span> and <span class="built_in">c</span>=<span class="number">3</span></span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-11-14T04:32:19.000Z" title="2020-11-14T04:32:19.000Z">2020-11-14</time><span class="level-item">a few seconds read (About 98 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-check-IAP-Transaction-error/">How to check IAP Transaction error</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/695">#695</a></strong></p>
<p>Inspect <code>SKPaymentTransaction</code> for <code>error</code>. In Swift, any <code>Error</code> can be safely bridged into <code>NSError</code> there you can check <code>errorDomain</code> and <code>code</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">handleFailure</span><span class="params">(<span class="number">_</span> transaction: SKPaymentTransaction)</span></span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> error = transaction.error <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">    <span class="keyword">let</span> nsError = error <span class="keyword">as</span> <span class="type">NSError</span></span><br><span class="line">    <span class="keyword">guard</span> nsError.domain == <span class="type">SKError</span>.errorDomain <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span> nsError.code &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="type">SKError</span>.clientInvalid.rawValue, <span class="type">SKError</span>.paymentNotAllowed.rawValue:</span><br><span class="line">        showAlert(text: <span class="string">"You are not allowed to make payment."</span>)</span><br><span class="line">    <span class="keyword">case</span> <span class="type">SKError</span>.paymentCancelled.rawValue:</span><br><span class="line">        showAlert(text: <span class="string">"Payment has been cancelled."</span>)</span><br><span class="line">    <span class="keyword">case</span> <span class="type">SKError</span>.unknown.rawValue, <span class="type">SKError</span>.paymentInvalid.rawValue:</span><br><span class="line">        <span class="keyword">fallthrough</span></span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        showAlert(text: <span class="string">"Something went wrong making payment."</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-11-14T03:49:39.000Z" title="2020-11-14T03:49:39.000Z">2020-11-14</time><span class="level-item">a minute read (About 199 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-use-nested-ObservableObject-in-SwiftUI/">How to use nested ObservableObject in SwiftUI</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/694">#694</a></strong></p>
<p>I usually structure my app to have 1 main <code>ObservableObject</code> called <code>Store</code> with multiple properties in it.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Store</span>: <span class="title">ObservableObject</span> </span>&#123;</span><br><span class="line">    @<span class="type">Published</span> <span class="keyword">var</span> pricingPlan: <span class="type">PricingPlan</span>()</span><br><span class="line">    @<span class="type">Published</span> <span class="keyword">var</span> preferences: <span class="type">Preferences</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Preferences</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> opensAtLogin: <span class="type">Bool</span> = <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">PricingPlan</span>: <span class="title">ObservableObject</span> </span>&#123;</span><br><span class="line">    @<span class="type">Published</span> <span class="keyword">var</span> isPro: <span class="type">Bool</span> = <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>SwiftUI for now does not work with nested <code>ObservableObject</code>, so if I pass <code>Store</code> to PricingView, changes in <code>PricingPlan</code> does not trigger view update in PricingView.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">MainView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    @<span class="type">ObservedObject</span></span><br><span class="line">    <span class="keyword">var</span> store: <span class="type">Store</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123; geo <span class="keyword">in</span></span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        .sheet(isPresented: $showsPricing) &#123;</span><br><span class="line">            <span class="type">PricingView</span>(</span><br><span class="line">                isPresented: $showsPricing,</span><br><span class="line">                store: store</span><br><span class="line">            )</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>There are some workarounds</p>
<h3 id="Pass-nested-ObservableObject"><a href="#Pass-nested-ObservableObject" class="headerlink" title="Pass nested ObservableObject"></a>Pass nested ObservableObject</h3><p>So that View observes both parent and nested objects.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">PricingView</span>(</span><br><span class="line">    store: store,</span><br><span class="line">    pricingPlan: store.pricingPlan</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="Use-struct"><a href="#Use-struct" class="headerlink" title="Use struct"></a>Use struct</h3><p>This forces us to deal with immutability also, as with reference type PricingPlan, someone could just save a reference to it and alter it at some point.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PricingPlan</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Listen-to-nested-objects-changes"><a href="#Listen-to-nested-objects-changes" class="headerlink" title="Listen to nested objects changes"></a>Listen to nested objects changes</h3><p>Every <code>ObservableObject</code> has a synthesized property <code>objectWillChange</code> that triggers when any <code>@Publisshed</code> property changes</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Store</span>: <span class="title">ObservableObject</span> </span>&#123;</span><br><span class="line">    @<span class="type">Published</span> <span class="keyword">var</span> pricingPlan = <span class="type">PricingPlan</span>()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> anyCancellable: <span class="type">AnyCancellable?</span> = <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>() &#123;</span><br><span class="line">        anyCancellable = pricingPlan.objectWillChange.sink &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] <span class="number">_</span> <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">self</span>?.objectWillChange.send()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></div></article></div><nav class="pagination is-centered mt-4" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/tags/swift/">Previous</a></div><div class="pagination-next"><a href="/tags/swift/page/3/">Next</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/tags/swift/">1</a></li><li><a class="pagination-link is-current" href="/tags/swift/page/2/">2</a></li><li><a class="pagination-link" href="/tags/swift/page/3/">3</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/tags/swift/page/12/">12</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="" src="https://avatars1.githubusercontent.com/u/2284279?s=460&amp;v=4" alt="onmyway133"></figure><p class="title is-size-4 is-block line-height-inherit">onmyway133</p><p class="is-size-6 is-block">iOS, macOS, Android, React. Serial maker. Writer. Speaker.</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Oslo, Norway</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">723</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">54</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/onmyway133" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/onmyway133"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com/onmyway133"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile is-mobile" href="https://onmyway133.com/apps" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Apps</span></span><span class="level-right"><span class="level-item tag">onmyway133.com</span></span></a></li><li><a class="level is-mobile is-mobile" href="https://learntalks.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Learn Talks</span></span><span class="level-right"><span class="level-item tag">learntalks.com</span></span></a></li><li><a class="level is-mobile is-mobile" href="https://wwdctogether.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">WWDC Together</span></span><span class="level-right"><span class="level-item tag">wwdctogether.com</span></span></a></li></ul></div></div></div><!--!--><div class="card widget"><div class="card-content"><h3 class="menu-label">Recent</h3><article class="media"><div class="media-content size-small"><p><time dateTime="2021-02-17T19:25:20.000Z">2021-02-17</time></p><p class="title is-6"><a class="link-muted" href="/blog/How-to-make-simple-search-bar-in-SwiftUI/">How to make simple search bar in SwiftUI</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2021-02-17T18:30:50.000Z">2021-02-17</time></p><p class="title is-6"><a class="link-muted" href="/blog/How-to-fix-share-and-action-extension-not-showing-up-in-iOS-14/">How to fix share and action extension not showing up in iOS 14</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2021-02-10T05:25:27.000Z">2021-02-10</time></p><p class="title is-6"><a class="link-muted" href="/blog/How-to-add-home-screen-quick-action-in-SwiftUI/">How to add home screen quick action in SwiftUI</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2021-02-08T18:40:48.000Z">2021-02-08</time></p><p class="title is-6"><a class="link-muted" href="/blog/How-to-use-EquatableView-in-SwiftUI/">How to use EquatableView in SwiftUI</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2021-02-08T18:34:20.000Z">2021-02-08</time></p><p class="title is-6"><a class="link-muted" href="/blog/How-to-add-new-property-in-Codable-struct-in-SwiftUI/">How to add new property in Codable struct in SwiftUI</a></p><p class="is-uppercase"></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/archives/2021/02/"><span class="level-start"><span class="level-item">February 2021</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2021/01/"><span class="level-start"><span class="level-item">January 2021</span></span><span class="level-end"><span class="level-item tag">33</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/12/"><span class="level-start"><span class="level-item">December 2020</span></span><span class="level-end"><span class="level-item tag">29</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/11/"><span class="level-start"><span class="level-item">November 2020</span></span><span class="level-end"><span class="level-item tag">15</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/10/"><span class="level-start"><span class="level-item">October 2020</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/09/"><span class="level-start"><span class="level-item">September 2020</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/08/"><span class="level-start"><span class="level-item">August 2020</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/06/"><span class="level-start"><span class="level-item">June 2020</span></span><span class="level-end"><span class="level-item tag">14</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/05/"><span class="level-start"><span class="level-item">May 2020</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/04/"><span class="level-start"><span class="level-item">April 2020</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/03/"><span class="level-start"><span class="level-item">March 2020</span></span><span class="level-end"><span class="level-item tag">21</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/02/"><span class="level-start"><span class="level-item">February 2020</span></span><span class="level-end"><span class="level-item tag">20</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/01/"><span class="level-start"><span class="level-item">January 2020</span></span><span class="level-end"><span class="level-item tag">30</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/12/"><span class="level-start"><span class="level-item">December 2019</span></span><span class="level-end"><span class="level-item tag">36</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/11/"><span class="level-start"><span class="level-item">November 2019</span></span><span class="level-end"><span class="level-item tag">38</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/10/"><span class="level-start"><span class="level-item">October 2019</span></span><span class="level-end"><span class="level-item tag">49</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/09/"><span class="level-start"><span class="level-item">September 2019</span></span><span class="level-end"><span class="level-item tag">50</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/08/"><span class="level-start"><span class="level-item">August 2019</span></span><span class="level-end"><span class="level-item tag">39</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/07/"><span class="level-start"><span class="level-item">July 2019</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/06/"><span class="level-start"><span class="level-item">June 2019</span></span><span class="level-end"><span class="level-item tag">41</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/05/"><span class="level-start"><span class="level-item">May 2019</span></span><span class="level-end"><span class="level-item tag">50</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/04/"><span class="level-start"><span class="level-item">April 2019</span></span><span class="level-end"><span class="level-item tag">27</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/03/"><span class="level-start"><span class="level-item">March 2019</span></span><span class="level-end"><span class="level-item tag">24</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/02/"><span class="level-start"><span class="level-item">February 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/12/"><span class="level-start"><span class="level-item">December 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/05/"><span class="level-start"><span class="level-item">May 2018</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/04/"><span class="level-start"><span class="level-item">April 2018</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/02/"><span class="level-start"><span class="level-item">February 2018</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/01/"><span class="level-start"><span class="level-item">January 2018</span></span><span class="level-end"><span class="level-item tag">14</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/12/"><span class="level-start"><span class="level-item">December 2017</span></span><span class="level-end"><span class="level-item tag">14</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/11/"><span class="level-start"><span class="level-item">November 2017</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/10/"><span class="level-start"><span class="level-item">October 2017</span></span><span class="level-end"><span class="level-item tag">18</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/09/"><span class="level-start"><span class="level-item">September 2017</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/08/"><span class="level-start"><span class="level-item">August 2017</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/07/"><span class="level-start"><span class="level-item">July 2017</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/06/"><span class="level-start"><span class="level-item">June 2017</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/05/"><span class="level-start"><span class="level-item">May 2017</span></span><span class="level-end"><span class="level-item tag">35</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/04/"><span class="level-start"><span class="level-item">April 2017</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/algorithm/"><span class="tag">algorithm</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/android/"><span class="tag">android</span><span class="tag is-grey-lightest">34</span></a></div><div class="control"><a class="tags has-addons" href="/tags/apple-script/"><span class="tag">apple script</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/catalyst/"><span class="tag">catalyst</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ci/"><span class="tag">ci</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cloud/"><span class="tag">cloud</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cocoapods/"><span class="tag">cocoapods</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/combine/"><span class="tag">combine</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/core-data/"><span class="tag">core data</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/csharp/"><span class="tag">csharp</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/css/"><span class="tag">css</span><span class="tag is-grey-lightest">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/dart/"><span class="tag">dart</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/database/"><span class="tag">database</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/design/"><span class="tag">design</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/electron/"><span class="tag">electron</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/featured/"><span class="tag">featured</span><span class="tag is-grey-lightest">10</span></a></div><div class="control"><a class="tags has-addons" href="/tags/firebase/"><span class="tag">firebase</span><span class="tag is-grey-lightest">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/flutter/"><span class="tag">flutter</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/git/"><span class="tag">git</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/github/"><span class="tag">github</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/go/"><span class="tag">go</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/google/"><span class="tag">google</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/iOS/"><span class="tag">iOS</span><span class="tag is-grey-lightest">173</span></a></div><div class="control"><a class="tags has-addons" href="/tags/javascript/"><span class="tag">javascript</span><span class="tag is-grey-lightest">51</span></a></div><div class="control"><a class="tags has-addons" href="/tags/kotlin/"><span class="tag">kotlin</span><span class="tag is-grey-lightest">27</span></a></div><div class="control"><a class="tags has-addons" href="/tags/layout/"><span class="tag">layout</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/life/"><span class="tag">life</span><span class="tag is-grey-lightest">14</span></a></div><div class="control"><a class="tags has-addons" href="/tags/links/"><span class="tag">links</span><span class="tag is-grey-lightest">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/macOS/"><span class="tag">macOS</span><span class="tag is-grey-lightest">133</span></a></div><div class="control"><a class="tags has-addons" href="/tags/machine-learning/"><span class="tag">machine learning</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/maps/"><span class="tag">maps</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/networking/"><span class="tag">networking</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/node/"><span class="tag">node</span><span class="tag is-grey-lightest">13</span></a></div><div class="control"><a class="tags has-addons" href="/tags/objc/"><span class="tag">objc</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/react/"><span class="tag">react</span><span class="tag is-grey-lightest">24</span></a></div><div class="control"><a class="tags has-addons" href="/tags/react-native/"><span class="tag">react native</span><span class="tag is-grey-lightest">14</span></a></div><div class="control"><a class="tags has-addons" href="/tags/realm/"><span class="tag">realm</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/rx/"><span class="tag">rx</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/script/"><span class="tag">script</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/spm/"><span class="tag">spm</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/swift/"><span class="tag">swift</span><span class="tag is-grey-lightest">355</span></a></div><div class="control"><a class="tags has-addons" href="/tags/swiftUI/"><span class="tag">swiftUI</span><span class="tag is-grey-lightest">98</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tech/"><span class="tag">tech</span><span class="tag is-grey-lightest">14</span></a></div><div class="control"><a class="tags has-addons" href="/tags/terminal/"><span class="tag">terminal</span><span class="tag is-grey-lightest">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/testing/"><span class="tag">testing</span><span class="tag is-grey-lightest">17</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tool/"><span class="tag">tool</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tweet/"><span class="tag">tweet</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/unity/"><span class="tag">unity</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/voip/"><span class="tag">voip</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/watchOS/"><span class="tag">watchOS</span><span class="tag is-grey-lightest">11</span></a></div><div class="control"><a class="tags has-addons" href="/tags/web/"><span class="tag">web</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/work/"><span class="tag">work</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/wwdc/"><span class="tag">wwdc</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/xcode/"><span class="tag">xcode</span><span class="tag is-grey-lightest">24</span></a></div></div></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Subscribe to Updates</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=c2r59mmt2n5k0o5dt5vv3nq4u4&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="c2r59mmt2n5k0o5dt5vv3nq4u4" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button is-primary" type="submit" value="Subscribe"></div></div></form></div></div></div><div class="card widget"><div class="card-content"><div class="notification is-danger">You need to set <code>client_id</code> and <code>slot_id</code> to show this AD unit. Please set it in <code>_config.yml</code>.</div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/z.png" alt="onmyway133" height="28"></a><p class="size-small"><span>&copy; 2021 Khoa Pham</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/onmyway133"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            site: {
                url: 'https://onmyway133.github.io',
                external_link: {"enable":true,"exclude":[]}
            },
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to Top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>