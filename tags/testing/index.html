<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="generator" content="Hexo 4.2.0"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Tag: testing - onmyway133</title><meta description="What you don&amp;#39;t know is what you haven&amp;#39;t learned"><meta property="og:type" content="blog"><meta property="og:title" content="onmyway133"><meta property="og:url" content="https://onmyway133.github.io/"><meta property="og:site_name" content="onmyway133"><meta property="og:description" content="What you don&amp;#39;t know is what you haven&amp;#39;t learned"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://onmyway133.github.io/img/og_image.png"><meta property="article:author" content="Khoa Pham"><meta property="article:tag" content="ios"><meta property="article:tag" content=" android"><meta property="article:tag" content="javascript"><meta property="article:tag" content=" react"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><meta property="twitter:creator" content="@onmyway133"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://onmyway133.github.io"},"headline":"onmyway133","image":["https://onmyway133.github.io/img/og_image.png"],"author":{"@type":"Person","name":"Khoa Pham"},"description":"What you don&#39;t know is what you haven&#39;t learned"}</script><link rel="alternative" href="/atom.xml" title="onmyway133" type="application/atom+xml"><link rel="icon" href="/img/favicon.ico"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=UA-40119591-5" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'UA-40119591-5');</script><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><script data-ad-client="ca-pub-3656459401405265" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" async></script></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/z.png" alt="onmyway133" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/apps">Apps</a><a class="navbar-item" href="/gumroad">Gumroad</a><a class="navbar-item" href="/about">About</a><a class="navbar-item" href="/opensource">Open Source</a><a class="navbar-item" href="/writing">Writing</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/speaking">Speaking</a><a class="navbar-item" href="/news">News</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/onmyway133"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/tags">Tags</a></li><li class="is-active"><a href="#" aria-current="page">testing</a></li></ul></nav></div></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-12-07T10:24:19.000Z" title="2020-12-07T10:24:19.000Z">2020-12-07</time><span class="level-item">3 minutes read (About 484 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-mock-UNNotificationResponse-in-unit-tests/">How to mock UNNotificationResponse in unit tests</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/708">#708</a></strong></p>
<p>The best way to test is to not have to mock at all. The second best way is to have your own abstraction over the things you would like to test, either it is in form of protocol or some function injection.</p>
<p>But in case you want a quick way to test things, and want to test as real as possible, then for some cases we can be creative to mock the real objects.</p>
<p>One practical example is when we have some logic to handle notification, either showing or deep link user to certain screen. From iOS 10, notifications are to be delivered via <code>UNUserNotificationCenterDelegate</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@available</span>(iOS <span class="number">10.0</span>, *)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">protocol</span> <span class="title">UNUserNotificationCenterDelegate</span> : <span class="title">NSObjectProtocol</span> </span>&#123;</span><br><span class="line">    <span class="meta">@available</span>(iOS <span class="number">10.0</span>, *)</span><br><span class="line">    <span class="keyword">optional</span> <span class="function"><span class="keyword">func</span> <span class="title">userNotificationCenter</span><span class="params">(<span class="number">_</span> center: UNUserNotificationCenter, didReceive response: UNNotificationResponse, withCompletionHandler completionHandler: @escaping <span class="params">()</span></span></span> -&gt; <span class="type">Void</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>and all we get is <code>UNNotificationResponse</code> which has no real way to construct it.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@available</span>(iOS <span class="number">10.0</span>, *)</span><br><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">UNNotificationResponse</span> : <span class="title">NSObject</span>, <span class="title">NSCopying</span>, <span class="title">NSSecureCoding</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// The notification to which the user responded.</span></span><br><span class="line">    <span class="meta">@NSCopying</span> <span class="keyword">open</span> <span class="keyword">var</span> notification: <span class="type">UNNotification</span> &#123; <span class="keyword">get</span> &#125;</span><br></pre></td></tr></table></figure>

<p>That class inherits from <code>NSCopying</code> which means it is constructed from <code>NSCoder</code>, but how do we init it?</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> response = <span class="type">UNNotificationResponse</span>(coder: ???)</span><br></pre></td></tr></table></figure>

<h2 id="NSObject-and-NSCoder"><a href="#NSObject-and-NSCoder" class="headerlink" title="NSObject and NSCoder"></a>NSObject and NSCoder</h2><p>The trick is, since <code>UNNotificationResponse</code> is <code>NSObject</code> subclass, it is key value compliant, and since it is also <code>NSCopying</code> compliant, we can make a mock coder to construct it</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">KeyedArchiver</span>: <span class="title">NSKeyedArchiver</span> </span>&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">decodeObject</span><span class="params">(forKey <span class="number">_</span>: String)</span></span> -&gt; <span class="type">Any</span> &#123; <span class="string">""</span> &#125;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">decodeInt64</span><span class="params">(forKey key: String)</span></span> -&gt; <span class="type">Int64</span> &#123; <span class="number">0</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>On iOS 12, we need to add <code>decodeInt64</code> method, otherwise <code>UNNotificationResponse</code> init fails. This is not needed on iOS 14</p>
<p><code>UNNotificationResponse</code> has a read only <code>UNNotification</code>, which has a readonly <code>UNNotificationRequest</code>, which can be constructed from a <code>UNNotificationContent</code></p>
<p>Luckily <code>UNNotificationContent</code> has a counterpart <code>UNMutableNotificationContent</code></p>
<p>Now we can make a simple extension on <code>UNNotificationResponse</code> to quickly create that object in tests</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">extension</span> <span class="title">UNNotificationResponse</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">with</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        userInfo: [AnyHashable: <span class="keyword">Any</span>],</span></span></span><br><span class="line"><span class="function"><span class="params">        actionIdentifier: String = UNNotificationDefaultActionIdentifier</span></span></span><br><span class="line"><span class="function"><span class="params">    )</span></span> <span class="keyword">throws</span> -&gt; <span class="type">UNNotificationResponse</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> content = <span class="type">UNMutableNotificationContent</span>()</span><br><span class="line">        content.userInfo = userInfo</span><br><span class="line">        <span class="keyword">let</span> request = <span class="type">UNNotificationRequest</span>(</span><br><span class="line">            identifier: <span class="string">""</span>,</span><br><span class="line">            content: content,</span><br><span class="line">            trigger: <span class="literal">nil</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> notification = <span class="keyword">try</span> <span class="type">XCTUnwrap</span>(<span class="type">UNNotification</span>(coder: <span class="type">KeyedArchiver</span>()))</span><br><span class="line">        notification.setValue(request, forKey: <span class="string">"request"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> response = <span class="keyword">try</span> <span class="type">XCTUnwrap</span>(<span class="type">UNNotificationResponse</span>(coder: <span class="type">KeyedArchiver</span>()))</span><br><span class="line">        response.setValue(notification, forKey: <span class="string">"notification"</span>)</span><br><span class="line">        response.setValue(actionIdentifier, forKey: <span class="string">"actionIdentifier"</span>)</span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>We can then test like normal</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">testResponse</span><span class="params">()</span></span> <span class="keyword">throws</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> data: [<span class="type">AnyHashable</span>: <span class="type">Any</span>] = [</span><br><span class="line">        <span class="string">"data"</span>: [</span><br><span class="line">            <span class="string">"type"</span>: <span class="string">"OPEN_ARTICLE"</span>,</span><br><span class="line">            <span class="string">"articleId"</span>: <span class="string">"1"</span>,</span><br><span class="line">            <span class="string">"articleType"</span>: <span class="string">"Fiction"</span>,</span><br><span class="line">            <span class="string">"articleTag"</span>: <span class="string">"1"</span></span><br><span class="line">        ]</span><br><span class="line">    ]</span><br><span class="line">    <span class="keyword">let</span> response = <span class="keyword">try</span> <span class="type">UNNotificationResponse</span>.with(userInfo: data)</span><br><span class="line">    <span class="keyword">let</span> centerDelegate = <span class="type">ArticleCenterDelegate</span>()</span><br><span class="line">    centerDelegate.userNotificationCenter(</span><br><span class="line">        <span class="type">UNUserNotificationCenter</span>.current(),</span><br><span class="line">        didReceive: response,</span><br><span class="line">        withCompletionHandler: &#123;&#125;</span><br><span class="line">    )</span><br><span class="line">    <span class="type">XCTAssertEqual</span>(response.notification.request.content.userInfo[<span class="string">"type"</span>], <span class="string">"OPEN_ARTICLE"</span>)</span><br><span class="line">    <span class="type">XCTAssertEqual</span>(centerDelegate.didOpenArticle, <span class="literal">true</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="decodeObject-for-key"><a href="#decodeObject-for-key" class="headerlink" title="decodeObject for key"></a>decodeObject for key</h2><p>Another way is to build a proper <code>KeyedArchiver</code> that checks key and return correct property. Note that we can reuse the same <code>NSKeyedArchiver</code> to nested properties.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">KeyedArchiver</span>: <span class="title">NSKeyedArchiver</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> request: <span class="type">UNNotificationRequest</span></span><br><span class="line">    <span class="keyword">let</span> actionIdentifier: <span class="type">String</span></span><br><span class="line">    <span class="keyword">let</span> notification: <span class="type">UNNotification</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">decodeObject</span><span class="params">(forKey key: String)</span></span> -&gt; <span class="type">Any?</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> key &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">"request"</span>:</span><br><span class="line">            <span class="keyword">return</span> request</span><br><span class="line">        <span class="keyword">case</span> <span class="string">"actionIdentifier"</span>:</span><br><span class="line">            <span class="keyword">return</span> actionIdentifier</span><br><span class="line">        <span class="keyword">case</span> <span class="string">"notification"</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="type">UNNotification</span>(coder: <span class="keyword">self</span>)</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<p><strong>Updated at</strong> 2020-12-07 11:49:55</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-11-04T09:02:01.000Z" title="2020-11-04T09:02:01.000Z">2020-11-04</time><span class="level-item">a few seconds read (About 67 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-avoid-multiple-match-elements-in-UITests-from-iOS-13/">How to avoid multiple match elements in UITests from iOS 13</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/691">#691</a></strong></p>
<p>Supposed we want to present a ViewController, and there exist both <code>UIToolbar</code> in both the presenting and presented view controllers.</p>
<p>From iOS 13, the model style is not full screen and interactive. From UITests perspective there are 2 UIToolbar, we need to specify the correct one to avoid multiple match errors</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> editButton = app.toolbars[<span class="string">"EditArticle.Toolbar"</span>].buttons[<span class="string">"Edit"</span>]</span><br></pre></td></tr></table></figure>
<hr>
<p><strong>Updated at</strong> 2020-11-04 10:02:29</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-11-04T08:28:50.000Z" title="2020-11-04T08:28:50.000Z">2020-11-04</time><span class="level-item">a minute read (About 130 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-use-accessibility-container-in-UITests/">How to use accessibility container in UITests</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/690">#690</a></strong></p>
<p>Use <code>accessibilityElements</code> to specify containment for <code>contentView</code> and buttons. You can use Accessibility Inspector from Xcode to verify.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ArticleCell</span>: <span class="title">UICollectionViewCell</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> authorLabel: <span class="type">UILabel</span></span><br><span class="line">    <span class="keyword">let</span> dateLabel: <span class="type">UILabel</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> viewLabel: <span class="type">UILabel</span></span><br><span class="line">    <span class="keyword">let</span> deleteButton: <span class="type">UIButton</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">setupAccessibility</span><span class="params">()</span></span> &#123;</span><br><span class="line">        contentView.isAccessibilityElement = <span class="literal">true</span></span><br><span class="line">        contentView.accessibilityLabel = <span class="string">"This article is written by Nobita on Dec 4th 2020"</span></span><br><span class="line"></span><br><span class="line">        viewLabel.isAccessibilityElement = <span class="literal">true</span> <span class="comment">// Default is false</span></span><br><span class="line">        viewLabel.accessibilityTraits.insert(.button) <span class="comment">// Treat UILabel as button to VoiceOver</span></span><br><span class="line"></span><br><span class="line">        accessibilityElements = [contentView, viewLabel, deleteButton]</span><br><span class="line">        isAccessibilityElement = <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This works OK under Voice Over and Accessibility Inspector. However in iOS 14 UITests, only the contentView is recognizable. The workaround is to use <code>XCUICoordinate</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> deleteButton = cell.buttons[<span class="string">"Delete article"</span>]</span><br><span class="line"><span class="keyword">if</span> deleteButton.waitForExistence(timeout: <span class="number">1</span>) &#123;</span><br><span class="line">    deleteButton.tap()</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> coordinate = cell.coordinate(</span><br><span class="line">        withNormalizedOffset: <span class="type">CGVector</span>(dx: <span class="number">0.9</span>, dy: <span class="number">0.9</span>)</span><br><span class="line">    )</span><br><span class="line">    coordinate.tap()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<p><strong>Updated at</strong> 2020-11-04 09:42:05</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-04-29T07:40:35.000Z" title="2020-04-29T07:40:35.000Z">2020-04-29</time><span class="level-item">a few seconds read (About 81 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-test-DispatchQueue-in-Swift/">How to test DispatchQueue in Swift</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/646">#646</a></strong></p>
<h2 id="Sync-the-DispatchQueue"><a href="#Sync-the-DispatchQueue" class="headerlink" title="Sync the DispatchQueue"></a>Sync the DispatchQueue</h2><p>Pass <code>DispatchQueue</code> and call <code>queue.sync</code> to sync all async works before asserting</p>
<h2 id="Use-mock"><a href="#Use-mock" class="headerlink" title="Use mock"></a>Use mock</h2><p>Use <code>DispatchQueueType</code> and in mock, call the work immediately</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">protocol</span> <span class="title">DispatchQueueType</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">async</span><span class="params">(execute work: @escaping @convention<span class="params">(block)</span></span></span> () -&gt; <span class="type">Void</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">DispatchQueue</span>: <span class="title">DispatchQueueType</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">async</span><span class="params">(execute work: @escaping @convention<span class="params">(block)</span></span></span> () -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">        async(group: <span class="literal">nil</span>, qos: .unspecified, flags: [], execute: work)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">MockDispatchQueue</span>: <span class="title">DispatchQueueType</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">async</span><span class="params">(execute work: @escaping @convention<span class="params">(block)</span></span></span> () -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">        work()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-04-28T07:23:52.000Z" title="2020-04-28T07:23:52.000Z">2020-04-28</time><span class="level-item">a few seconds read (About 56 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-assert-asynchronously-in-XCTest/">How to assert asynchronously in XCTest</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/644">#644</a></strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> XCTest</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">XCTestCase</span> </span>&#123;</span><br><span class="line">    <span class="comment">/// Asynchronously assertion</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">XCTAssertWait</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        timeout: TimeInterval = <span class="number">1</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="number">_</span> expression: @escaping <span class="params">()</span></span></span> -&gt; <span class="type">Void</span>,</span><br><span class="line">        <span class="number">_</span>: <span class="type">String</span> = <span class="string">""</span>,</span><br><span class="line">        file <span class="number">_</span>: <span class="type">StaticString</span> = #file,</span><br><span class="line">        line <span class="number">_</span>: <span class="type">UInt</span> = #line</span><br><span class="line">    ) &#123;</span><br><span class="line">        <span class="keyword">let</span> expectation = <span class="keyword">self</span>.expectation(description: #function)</span><br><span class="line">        <span class="type">DispatchQueue</span>.main.asyncAfter(deadline: .now() + timeout) &#123;</span><br><span class="line">            expression()</span><br><span class="line">            expectation.fulfill()</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> waiter = <span class="type">XCTWaiter</span>()</span><br><span class="line">        <span class="type">XCTAssertTrue</span>(waiter.wait(<span class="keyword">for</span>: [expectation], timeout: timeout + <span class="number">1</span>) == .completed)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>Updated at</strong> 2020-04-28 09:23:59</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-03-20T11:24:38.000Z" title="2020-03-20T11:24:38.000Z">2020-03-20</time><span class="level-item">a few seconds read (About 70 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-iterate-over-XCUIElementQuery-in-UITests/">How to iterate over XCUIElementQuery in UITests</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/628">#628</a></strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">XCUIElementQuery</span>: <span class="title">Sequence</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">typealias</span> <span class="type">Iterator</span> = <span class="type">AnyIterator</span>&lt;<span class="type">XCUIElement</span>&gt;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">makeIterator</span><span class="params">()</span></span> -&gt; <span class="type">Iterator</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> index = <span class="type">UInt</span>(<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="type">AnyIterator</span> &#123;</span><br><span class="line">            <span class="keyword">guard</span> index &lt; <span class="keyword">self</span>.<span class="built_in">count</span> <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">let</span> element = <span class="keyword">self</span>.element(boundBy: <span class="type">Int</span>(index))</span><br><span class="line">            index = index + <span class="number">1</span></span><br><span class="line">            <span class="keyword">return</span> element</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">NSPredicate</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">label</span><span class="params">(<span class="built_in">contains</span> string: String)</span></span> -&gt; <span class="type">NSPredicate</span> &#123;</span><br><span class="line">        <span class="type">NSPredicate</span>(format: <span class="string">"label CONTAINS %@"</span>, string)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> books = app.collectionViews.cells.matching(</span><br><span class="line">    <span class="type">NSPredicate</span>.label(<span class="built_in">contains</span>: <span class="string">"book"</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> book <span class="keyword">in</span> books &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-01-23T13:01:07.000Z" title="2020-01-23T13:01:07.000Z">2020-01-23</time><span class="level-item">a minute read (About 196 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-test-drag-and-drop-in-UITests/">How to test drag and drop in UITests</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/583">#583</a></strong></p>
<p>In UITests, we can use <code>press</code> from <code>XCUIElement</code> to test drag and drop</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> fromCat = app.buttons[<span class="string">"cat1"</span>].firstMatch</span><br><span class="line"><span class="keyword">let</span> toCat = app.buttons[<span class="string">"cat2"</span>]</span><br><span class="line"><span class="keyword">let</span> fromCoordinate = fromCat.coordinate(withNormalizedOffset: <span class="type">CGVector</span>(dx: <span class="number">0</span>, dy: <span class="number">0</span>))</span><br><span class="line"><span class="keyword">let</span> toCoordinate = toCat.coordinate(withNormalizedOffset: <span class="type">CGVector</span>(dx: <span class="number">0</span>, dy: -<span class="number">0.5</span>))</span><br><span class="line">fromCoordinate.press(forDuration: <span class="number">1</span>, thenDragTo: toCoordinate)</span><br></pre></td></tr></table></figure>

<p>and then take screenshot</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> screenshot = <span class="type">XCUIScreen</span>.main.screenshot()</span><br><span class="line"><span class="keyword">let</span> attachment = <span class="type">XCTAttachment</span>(screenshot: screenshot)</span><br><span class="line">attachment.lifetime = .keepAlways</span><br><span class="line">attachment.name = name</span><br><span class="line">add(attachment)</span><br></pre></td></tr></table></figure>

<p>Screenshot capturing happens after the action, so it may be too late. One way is to inject launch arguments, like <code>app.launchArguments.append(&quot;--dragdrop&quot;)</code> to alter some code in the app.</p>
<p>We can also swizzle gesture recognizer to alter behavior</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">UILongPressGestureRecognizer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@objc</span> <span class="keyword">var</span> uiTests_state: <span class="type">UIGestureRecognizer</span>.<span class="type">State</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> state = <span class="keyword">self</span>.uiTests_state</span><br><span class="line">        <span class="keyword">if</span> state == .ended &#123;</span><br><span class="line">            <span class="keyword">return</span> .changed</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> state</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> originalSelector = #selector(getter: <span class="type">UILongPressGestureRecognizer</span>.state)</span><br><span class="line"><span class="keyword">let</span> swizzledSelector = #selector(getter: <span class="type">UILongPressGestureRecognizer</span>.uiTests_state)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> originalMethod = class_getInstanceMethod(<span class="type">UILongPressGestureRecognizer</span>.<span class="keyword">self</span>, originalSelector)!</span><br><span class="line"><span class="keyword">let</span> swizzledMethod = class_getInstanceMethod(<span class="type">UILongPressGestureRecognizer</span>.<span class="keyword">self</span>, swizzledSelector)!</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> didAddMethod = class_addMethod(<span class="type">UILongPressGestureRecognizer</span>.<span class="keyword">self</span>, originalSelector, method_getImplementation(swizzledMethod), method_getTypeEncoding(swizzledMethod))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> didAddMethod &#123;</span><br><span class="line">    class_replaceMethod(<span class="type">UILongPressGestureRecognizer</span>.<span class="keyword">self</span>, swizzledSelector, method_getImplementation(originalMethod), method_getTypeEncoding(originalMethod))</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    method_exchangeImplementations(originalMethod, swizzledMethod)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-01-12T06:33:39.000Z" title="2020-01-12T06:33:39.000Z">2020-01-12</time><span class="level-item">a minute read (About 213 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-generate-XCTest-test-methods/">How to generate XCTest test methods</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/576">#576</a></strong></p>
<h2 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h2><p>See <a href="https://github.com/onmyway133/Spek">Spek</a></p>
<h3 id="Override-testInvocations-to-specify-test-methods"><a href="#Override-testInvocations-to-specify-test-methods" class="headerlink" title="Override testInvocations to specify test methods"></a>Override testInvocations to specify test methods</h3><p><a href="https://developer.apple.com/documentation/xctest/xctestcase/1496271-testinvocations">https://developer.apple.com/documentation/xctest/xctestcase/1496271-testinvocations</a></p>
<blockquote>
<p>Returns an array of invocations representing each test method in the test case.</p>
</blockquote>
<p>Because <code>testInvocations</code> is unavailable in Swift, we need  to use ObjC</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"include/SpekHelperTestCase.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">SpekHelperTestCase</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">instancetype</span>)init &#123;</span><br><span class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> initWithInvocation: <span class="literal">nil</span>];</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="built_in">NSArray</span>&lt;<span class="built_in">NSInvocation</span> *&gt; *)testInvocations &#123;</span><br><span class="line">    <span class="built_in">NSArray</span>&lt;<span class="built_in">NSString</span> *&gt; *selectorStrings = [<span class="keyword">self</span> spekGenerateTestMethodNames];</span><br><span class="line">    <span class="built_in">NSMutableArray</span>&lt;<span class="built_in">NSInvocation</span> *&gt; *invocations = [<span class="built_in">NSMutableArray</span> arrayWithCapacity:selectorStrings.count];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">NSString</span> *selectorString <span class="keyword">in</span> selectorStrings) &#123;</span><br><span class="line">        SEL selector = <span class="built_in">NSSelectorFromString</span>(selectorString);</span><br><span class="line">        <span class="built_in">NSMethodSignature</span> *signature = [<span class="keyword">self</span> instanceMethodSignatureForSelector:selector];</span><br><span class="line">        <span class="built_in">NSInvocation</span> *invocation = [<span class="built_in">NSInvocation</span> invocationWithMethodSignature:signature];</span><br><span class="line">        invocation.selector = selector;</span><br><span class="line"></span><br><span class="line">        [invocations addObject:invocation];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> invocations;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="built_in">NSArray</span>&lt;<span class="built_in">NSString</span> *&gt; *)spekGenerateTestMethodNames &#123;</span><br><span class="line">    <span class="keyword">return</span> @[];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>

<h3 id="Generate-test-methods"><a href="#Generate-test-methods" class="headerlink" title="Generate test methods"></a>Generate test methods</h3><p>Calculate based on Describe and It, and use Objc runtime <code>class_addMethod</code> to add instance methods</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">SpekTestCase</span>: <span class="title">SpekHelperTestCase</span> </span>&#123;</span><br><span class="line">    <span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">func</span> <span class="title">makeDescribe</span>() -&gt; <span class="title">Describe</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Describe</span>(<span class="string">"empty"</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    #<span class="keyword">if</span> canImport(<span class="type">SpekHelper</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">func</span> <span class="title">spekGenerateTestMethodNames</span>() -&gt; [<span class="title">String</span>] </span>&#123;</span><br><span class="line">        <span class="keyword">let</span> describe = <span class="type">Self</span>.makeDescribe()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> names: [<span class="type">String</span>] = []</span><br><span class="line">        generate(describe: describe, names: &amp;names)</span><br><span class="line">        <span class="keyword">return</span> names</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">addInstanceMethod</span><span class="params">(name: String, closure: @escaping <span class="params">()</span></span></span> -&gt; <span class="type">Void</span>) -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> block: <span class="meta">@convention</span>(block) (<span class="type">SpekTestCase</span>) -&gt; <span class="type">Void</span> = &#123; spekTestCase <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">let</span> <span class="number">_</span> = spekTestCase</span><br><span class="line">            closure()</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> implementation = imp_implementationWithBlock(block <span class="keyword">as</span> <span class="type">Any</span>)</span><br><span class="line">        <span class="keyword">let</span> selector = <span class="type">NSSelectorFromString</span>(name)</span><br><span class="line">        class_addMethod(<span class="keyword">self</span>, selector, implementation, <span class="string">"v@:"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> name</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Read-more"><a href="#Read-more" class="headerlink" title="Read more"></a>Read more</h2><ul>
<li><a href="https://github.com/Quick/Quick">https://github.com/Quick/Quick</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-12-10T21:07:02.000Z" title="2019-12-10T21:07:02.000Z">2019-12-10</time><span class="level-item">a few seconds read (About 107 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-use-passed-launch-arguments-in-UITests/">How to use passed launch arguments in UITests</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/537">#537</a></strong></p>
<h2 id="Specify-launch-arguments"><a href="#Specify-launch-arguments" class="headerlink" title="Specify launch arguments"></a>Specify launch arguments</h2><p>In <code>xcodebuild</code>, specify launch arguments.</p>
<p>You can specify this under Launch Arguments in Run action of the app scheme or UITest scheme</p>
<img width="897" alt="Screenshot 2019-12-10 at 23 27 02" src="https://user-images.githubusercontent.com/2284279/70574543-a41a6080-1ba4-11ea-9fe0-596f24bca3ce.png">


<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-<span class="type">AppleLanguages</span> (jp) -<span class="type">AppleLocale</span> (jp_JP)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">(lldb) po ProcessInfo().arguments</span><br><span class="line">▿ <span class="number">11</span> elements</span><br><span class="line">  - <span class="number">0</span> : <span class="string">"/Users/khoa/Library/Developer/CoreSimulator/Devices/561F2B45-26B2-4897-98C4-8A917AEB48D2/data/Containers/Bundle/Application/436E0A43-8323-4F53-BBE0-6F75F674916F/TestAppUITests-Runner.app/TestAppUITests-Runner"</span></span><br><span class="line">  - <span class="number">1</span> : <span class="string">"-AppleLanguages"</span></span><br><span class="line">  - <span class="number">2</span> : <span class="string">"(ja)"</span></span><br><span class="line">  - <span class="number">3</span> : <span class="string">"-AppleTextDirection"</span></span><br><span class="line">  - <span class="number">4</span> : <span class="string">"NO"</span></span><br><span class="line">  - <span class="number">5</span> : <span class="string">"-AppleLocale"</span></span><br><span class="line">  - <span class="number">6</span> : <span class="string">"ja_JP"</span></span><br><span class="line">  - <span class="number">7</span> : <span class="string">"-NSTreatUnknownArgumentsAsOpen"</span></span><br><span class="line">  - <span class="number">8</span> : <span class="string">"NO"</span></span><br><span class="line">  - <span class="number">9</span> : <span class="string">"-ApplePersistenceIgnoreState"</span></span><br><span class="line">  - <span class="number">10</span> : <span class="string">"YES"</span></span><br></pre></td></tr></table></figure>

<p>In UITests, pass launch arguments from UITest scheme to UITest application</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.launchArguments += <span class="type">ProcessInfo</span>().arguments</span><br></pre></td></tr></table></figure>

<h2 id="Environments"><a href="#Environments" class="headerlink" title="Environments"></a>Environments</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ProcessInfo</span>().environment <span class="comment">// [String: String]</span></span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-11-01T08:48:43.000Z" title="2019-11-01T08:48:43.000Z">2019-11-01</time><span class="level-item">a minute read (About 165 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-add-monkey-test-to-iOS-apps/">How to add monkey test to iOS apps</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/484">#484</a></strong></p>
<p>Use <a href="https://github.com/zalando/SwiftMonkey">SwiftMonkey</a> which adds random UITests gestures</p>
<p>Add to UITests target</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">target <span class="string">'MyAppUITests'</span> <span class="keyword">do</span></span><br><span class="line">  pod <span class="string">'R.swift'</span>, <span class="string">'~&gt; 5.0'</span></span><br><span class="line">  pod <span class="string">'SwiftMonkey'</span>, <span class="string">'~&gt; 2.1.0'</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<h2 id="Troubleshooting"><a href="#Troubleshooting" class="headerlink" title="Troubleshooting"></a>Troubleshooting</h2><h3 id="Failed-to-determine-hittability-of-Button"><a href="#Failed-to-determine-hittability-of-Button" class="headerlink" title="Failed to determine hittability of Button"></a>Failed to determine hittability of Button</h3><blockquote>
<p>Failed to determine hittability of Button: Unable to fetch parameterized attribute XC_kAXXCParameterizedAttributeConvertHostedViewPositionFromContext, remote interface does not have this capability.</p>
</blockquote>
<p>This happens when using SwiftMonkey and somewhere in our code uses <code>isHittable</code>, so best to avoid that by having isolated monkey test only</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> XCTest</span><br><span class="line"><span class="keyword">import</span> SwiftMonkey</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MonkeyTests</span>: <span class="title">XCTestCase</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> app: <span class="type">XCUIApplication!</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">setUp</span><span class="params">()</span></span> &#123;</span><br><span class="line">        continueAfterFailure = <span class="literal">false</span></span><br><span class="line">        app = <span class="type">XCUIApplication</span>()</span><br><span class="line">        app.launch()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">testMonkey</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">let</span> monkey = <span class="type">Monkey</span>(frame: app.frame)</span><br><span class="line">        monkey.addDefaultUIAutomationActions()</span><br><span class="line">        monkey.addXCTestTapAlertAction(interval: <span class="number">100</span>, application: app)</span><br><span class="line">        monkey.monkeyAround()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Another workaround is possibly use <code>addDefaultXCTestPublicActions</code> other than <code>addDefaultUIAutomationActions</code></p>
<h3 id="UI-Test-Activity"><a href="#UI-Test-Activity" class="headerlink" title="UI Test Activity:"></a>UI Test Activity:</h3><blockquote>
<p>Assertion Failure: MonkeyXCTest.swift:33: Failed to get matching snapshots: Timed out while evaluating UI query.</p>
</blockquote>
<p>This seems related to SwiftMonkey trying to snapshot. Workaround is to remove</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">monkey.addXCTestTapAlertAction(interval: <span class="number">100</span>, application: app)</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-10-29T12:57:33.000Z" title="2019-10-29T12:57:33.000Z">2019-10-29</time><span class="level-item">3 minutes read (About 522 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-configure-test-target-in-Xcode/">How to configure test target in Xcode</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/478">#478</a></strong></p>
<h4 id="This-applies-to"><a href="#This-applies-to" class="headerlink" title="This applies to"></a>This applies to</h4><ul>
<li>Main targets<ul>
<li>App</li>
<li>Framework</li>
</ul>
</li>
<li>Test targets<ul>
<li>Unit tests</li>
<li>UI tests</li>
</ul>
</li>
</ul>
<h4 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h4><p>Dependencies used</p>
<ul>
<li>Main target: <a href="http://github.com/hyperoslo/Sugar">Sugar</a></li>
<li>Test target: <a href="https://github.com/Quick/Nimble">Nimble</a>, <a href="https://github.com/Quick/Quick">Quick</a></li>
</ul>
<p>Examples</p>
<ul>
<li>Cocoapods</li>
<li>Carthage</li>
</ul>
<h4 id="Notes"><a href="#Notes" class="headerlink" title="Notes"></a>Notes</h4><ul>
<li>Make sure test target can link to all the frameworks it needs. This includes frameworks that Test targets use, and possibly frameworks that Main target uses !</li>
<li>Remember to “Clean Build Folder” and “Clear Derived Data” so that you’re sure it works. Sometimes Xcode caches.</li>
</ul>
<h3 id="Errors"><a href="#Errors" class="headerlink" title="Errors"></a>Errors</h3><p>Errors occur mostly due to linker error</p>
<ul>
<li>Test target X encountered an error (Early unexpected exit, operation never finished bootstrapping - no restart will be attempted</li>
<li>Framework not found</li>
</ul>
<h2 id="Cocoapods"><a href="#Cocoapods" class="headerlink" title="Cocoapods"></a>Cocoapods</h2><h4 id="1-Pod"><a href="#1-Pod" class="headerlink" title="1. Pod"></a>1. Pod</h4><p>Test targets need to include pods that Main target uses !</p>
<p>or we’ll get “Framework not found”</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">app_pods</span></span></span><br><span class="line">	pod <span class="string">'Sugar'</span>, <span class="string">'~&gt; 1.0'</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_pods</span></span></span><br><span class="line">	pod <span class="string">'Nimble'</span>, <span class="string">'~&gt; 3.2'</span></span><br><span class="line">	pod <span class="string">'Quick'</span>, <span class="string">'~&gt; 0.9'</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">target <span class="string">'TeaApp'</span> <span class="keyword">do</span></span><br><span class="line">	app_pods</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">target <span class="string">'TeaAppTests'</span> <span class="keyword">do</span></span><br><span class="line">	app_pods</span><br><span class="line">	test_pods</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">target <span class="string">'TeaAppUITests'</span> <span class="keyword">do</span></span><br><span class="line">	app_pods</span><br><span class="line">	test_pods</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<h4 id="2-Link-Binaries-with-Library"><a href="#2-Link-Binaries-with-Library" class="headerlink" title="2. Link Binaries with Library"></a>2. Link Binaries with Library</h4><p>Cocoapods builds a framework that contains all the frameworks the Test targets need, and configure it for us</p>
<p><img src="Screenshots/cocoapods_link_binaries.png" alt=""></p>
<h4 id="3-Runpath-Search-Paths"><a href="#3-Runpath-Search-Paths" class="headerlink" title="3. Runpath Search Paths"></a>3. Runpath Search Paths</h4><ul>
<li>Go to Test target Build Settings</li>
<li>Add <code>$(FRAMEWORK_SEARCH_PATHS)</code></li>
</ul>
<p><img src="Screenshots/cocoapods_runpath_search_paths.png" alt=""></p>
<h2 id="Carthage"><a href="#Carthage" class="headerlink" title="Carthage"></a>Carthage</h2><h4 id="1-Cartfile"><a href="#1-Cartfile" class="headerlink" title="1. Cartfile"></a>1. Cartfile</h4><p>We usually have</p>
<ul>
<li>Cartfile for Main target</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">github <span class="string">"hyperoslo/Sugar"</span> ~&gt; <span class="number">1.0</span></span><br></pre></td></tr></table></figure>

<ul>
<li>Cartfile.private for Test target</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">github <span class="string">"Quick/Nimble"</span></span><br><span class="line">github <span class="string">"Quick/Quick"</span></span><br></pre></td></tr></table></figure>

<h4 id="2-Link-Binaries-with-Libraries"><a href="#2-Link-Binaries-with-Libraries" class="headerlink" title="2. Link Binaries with Libraries"></a>2. Link Binaries with Libraries</h4><ul>
<li>Go to Test target build phase</li>
<li>Drag built frameworks from <code>Carthage/Build</code></li>
<li>In rare case, we need to drag frameworks that the Main target uses</li>
<li>In rare case, we need to drag the Main target framework</li>
</ul>
<p><img src="Screenshots/carthage_link_binaries.png" alt=""></p>
<h4 id="3-Framework-Search-Paths"><a href="#3-Framework-Search-Paths" class="headerlink" title="3. Framework Search Paths"></a>3. Framework Search Paths</h4><p>Configure correct path</p>
<ul>
<li>Go to Test target Built Settings</li>
<li>Configure Framework Search Paths</li>
</ul>
<p><img src="Screenshots/carthage_framework_search_paths.png" alt=""></p>
<h4 id="4-Runpath-Search-Paths"><a href="#4-Runpath-Search-Paths" class="headerlink" title="4. Runpath Search Paths"></a>4. Runpath Search Paths</h4><ul>
<li>Go to Test target Build Settings</li>
<li>Add <code>$(FRAMEWORK_SEARCH_PATHS)</code></li>
</ul>
<p><img src="Screenshots/cocoapods_runpath_search_paths.png" alt=""></p>
<h4 id="5-Copy-Files-maybe"><a href="#5-Copy-Files-maybe" class="headerlink" title="5. Copy Files (maybe)"></a>5. Copy Files (maybe)</h4><p>From <a href="https://github.com/Carthage/Carthage/blob/0.11/README.md#adding-frameworks-to-unit-tests-or-a-framework">Adding frameworks to unit tests or a framework</a></p>
<blockquote>
<p>In rare cases, you may want to also copy each dependency into the build product (e.g., to embed dependencies within the outer framework, or make sure dependencies are present in a test bundle). To do this, create a new “Copy Files” build phase with the “Frameworks” destination, then add the framework reference there as well.</p>
</blockquote>
<p><img src="Screenshots/carthage_copy_files.png" alt=""></p>
<h2 id="Runpath-Search-Paths-and-Install-name"><a href="#Runpath-Search-Paths-and-Install-name" class="headerlink" title="Runpath Search Paths and Install name"></a>Runpath Search Paths and Install name</h2><p>Question</p>
<ul>
<li>Why preconfigured run path “@executable_path/Frameworks” and “@loader_path/Frameworks” not work?</li>
<li>Why configuring runpath to “$(FRAMEWORK_SEARCH_PATHS)” works ?</li>
<li>Why framework has install name “@rpath/Sugar.framework/Sugar” ?</li>
</ul>
<p>Reference</p>
<ul>
<li><a href="https://developer.apple.com/library/mac/documentation/DeveloperTools/Conceptual/DynamicLibraries/100-Articles/RunpathDependentLibraries.html">Run-Path Dependent Libraries</a></li>
<li><a href="https://www.mikeash.com/pyblog/friday-qa-2009-11-06-linking-and-install-names.html">Linking and Install Names</a></li>
</ul>
<h2 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h2><ul>
<li><a href="https://github.com/onmyway133/TestTarget">https://github.com/onmyway133/TestTarget</a></li>
<li><a href="https://stackoverflow.com/questions/34990175/test-target-x-encountered-an-error-early-unexpected-exit-operation-never-finis/36343395#36343395">https://stackoverflow.com/questions/34990175/test-target-x-encountered-an-error-early-unexpected-exit-operation-never-finis/36343395#36343395</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-09-06T07:03:02.000Z" title="2019-09-06T07:03:02.000Z">2019-09-06</time><span class="level-item">2 minutes read (About 234 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-test-Date-with-timezone-aware-in-Swift/">How to test Date with timezone aware in Swift</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/402">#402</a></strong></p>
<p>I want to test if a date has passed another date</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> base =  <span class="type">Date</span>(timeIntervalSince1970: <span class="number">1567756697</span>)</span><br><span class="line"><span class="type">XCTAssertEqual</span>(validator.hasPassed(event: event, date: base), <span class="literal">true</span>)</span><br></pre></td></tr></table></figure>

<p>My <code>hasPassed</code> is using Calendar.current</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">minuteSinceMidnight</span><span class="params">(date: Date)</span></span> -&gt; <span class="type">MinuteSinceMidnight</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> calendar = <span class="type">Calendar</span>.current</span><br><span class="line">    <span class="keyword">let</span> start = calendar.startOfDay(<span class="keyword">for</span>: date)</span><br><span class="line">    <span class="keyword">return</span> <span class="type">Int</span>(date.timeIntervalSince(start)) / <span class="number">60</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>But the minute is always having timezone applied. Even if I try with <code>DateComponents</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">minuteSinceMidnight</span><span class="params">(date: Date)</span></span> -&gt; <span class="type">MinuteSinceMidnight</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> components = calendar.dateComponents([.hour, .minute], from: date)</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> hour = components.hour, <span class="keyword">let</span> minute = components.minute <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> hour * <span class="number">60</span> + minute</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>As long as I use <code>Calendar</code>, it always has timezone applied.</p>
<p>Checking this time interval <code>1567756697</code> on <a href="https://www.epochconverter.com/">https://www.epochconverter.com/</a></p>
<blockquote>
<p>Assuming that this timestamp is in seconds:<br>GMT: Friday, September 6, 2019 7:58:17 PM<br>Your time zone: Friday, September 6, 2019 9:58:17 PM GMT+02:00 DST</p>
</blockquote>
<p>Because I have GMT+2, there will always be 2 hours offset. This works in app, but not in test because of the way I construct Date with time interval.</p>
<p>One way is to have test data using string construction, and provide timezone to <code>DateFormatter</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> formatter = <span class="type">ISO8601DateFormatter</span>()</span><br><span class="line"><span class="keyword">let</span> date = formatter.date(from: <span class="string">"2019-07-58T12:39:00Z"</span>)</span><br><span class="line"><span class="keyword">let</span> string = formatter.string(from: <span class="type">Date</span>())</span><br></pre></td></tr></table></figure>

<p>Another way is to have a fixed timezone for Calendar</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> calendar = <span class="type">Calendar</span>.current</span><br><span class="line">calendar.timeZone = <span class="type">TimeZone</span>(secondsFromGMT: <span class="number">0</span>)!</span><br></pre></td></tr></table></figure>

<p>Another way is to adjust existing date</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">calendar.date(bySettingHour: <span class="number">20</span>, minute: <span class="number">02</span>, second: <span class="number">00</span>, of: <span class="type">Date</span>()</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-06-25T09:01:49.000Z" title="2019-06-25T09:01:49.000Z">2019-06-25</time><span class="level-item">a minute read (About 127 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-organise-test-files/">How to organise test files</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/327">#327</a></strong></p>
<p>In terms of tests, we usually have files for unit test, UI test, integeration test and mock.</p>
<blockquote>
<p>Out of sight, out of mind.</p>
</blockquote>
<p>Unit tests are for checking specific functions and classes, it’s more convenient to browse them side by side with source file. For example in Javascript, Kotlin and Swift</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">index.js</span><br><span class="line">index.test.js</span><br><span class="line">index.mock.js</span><br></pre></td></tr></table></figure>

<figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">LocationManager.kt</span><br><span class="line">LocationManager.mock.kt</span><br><span class="line">LocationManager.test.kt</span><br></pre></td></tr></table></figure>

<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">BasketHandler</span>.swift</span><br><span class="line"><span class="type">BasketHandler</span>.mock.swift</span><br><span class="line"><span class="type">BasketHandler</span>.test.swift</span><br></pre></td></tr></table></figure>

<p>Integration tests check features or sub features, and may cover many source files, it’s better to place them in <code>feature</code> folders</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">- Features</span><br><span class="line">  - Cart</span><br><span class="line">    - Sources</span><br><span class="line">    - Tests</span><br><span class="line">      - Cart.test.swift</span><br><span class="line">      - Validator.test.swift</span><br><span class="line">  - Profile</span><br><span class="line">    - Sources</span><br><span class="line">    - Tests</span><br><span class="line">      - Updater.test.swift</span><br><span class="line">      - AvatarUploader.test.swift</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-05-21T06:48:44.000Z" title="2019-05-21T06:48:44.000Z">2019-05-21</time><span class="level-item">a minute read (About 142 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-test-LaunchScreen-in-iOS/">How to test LaunchScreen in iOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/249">#249</a></strong></p>
<p>Making splash screen with <code>LaunchScreen.storyboard</code> is now the default way to do in iOS. Testing it with UITests is a bit tricky as this screen is showed the system, and if we test that, we are just testing the system.</p>
<p>What we should test is the content we put in the LaunchScreen storyboard. Is it showing correctly on different screen sizes? Is it missing any texts or images?</p>
<p>One way to test that is via Unit Test. LaunchScreen storyboard always come with 1 <code>UIViewController</code> configured as an initial view controller</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LauncScreenTests</span>: <span class="title">XCTestCase</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">testLaunchScreen</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">let</span> launchScreen = <span class="type">UIStoryboard</span>(name: <span class="string">"LaunchScreen"</span>, bundle: <span class="literal">nil</span>)</span><br><span class="line">        <span class="keyword">let</span> viewController = launchScreen.instantiateInitialViewController()!</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> label = viewController.view.subviews.compactMap(&#123; $<span class="number">0</span> <span class="keyword">as</span>? <span class="type">UILabel</span> &#125;).first!</span><br><span class="line">        <span class="type">XCTAssertEqual</span>(label.text, <span class="string">"Welcome to my app"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> imageView = viewController.view.subviews.compactMap(&#123; $<span class="number">0</span> <span class="keyword">as</span>? <span class="type">UIImageView</span> &#125;).first!</span><br><span class="line">        <span class="type">XCTAssertNotNil</span>(imageView.image)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2018-01-08T14:12:54.000Z" title="2018-01-08T14:12:54.000Z">2018-01-08</time><span class="level-item">a minute read (About 168 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-deal-with-animation-in-UITests-in-iOS/">How to deal with animation in UITests in iOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/143">#143</a></strong></p>
<p>Today I was writing tests and get this error related to <code>app idle</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">t &#x3D;    23.06s         Assertion Failure: &lt;unknown&gt;:0: Failed to scroll to visible (by AX action) Button, 0x6000003827d0, traits: 8858370049, label: &#39;cart&#39;, error: Error -25204 performing AXAction 2003 on element &lt;XCAccessibilityElement: 0x7fc391a2bd60&gt; pid: 91461, elementOrHash.elementID: 140658975676048.128</span><br></pre></td></tr></table></figure>

<p>It turns out that the project uses a HUD that is performing some progress animation. Even it was being called <code>HUD.hide()</code>, the problem still exists. </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">t &#x3D;    31.55s     Wait for no.example.MyApp to idle</span><br><span class="line"> t &#x3D;    91.69s         App animations complete notification not received, will attempt to continue.</span><br><span class="line"> t &#x3D;    91.70s Tap Target Application 0x6040002a1260</span><br><span class="line"> t &#x3D;    91.70s     Wait for no.example.MyApp to id</span><br></pre></td></tr></table></figure>

<p>No matter how I call <code>sleep,</code>wait`, still the problem</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sleep(<span class="number">10</span>)</span><br><span class="line">app.tap()</span><br><span class="line"><span class="number">_</span> = checkoutButton.waitForExistence(timeout: <span class="number">10</span>)</span><br></pre></td></tr></table></figure>

<p>The fix is to disable animation. Start with setting argument when running tests</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">app.launchArguments.append(<span class="string">"--UITests"</span>)</span><br><span class="line">app.launch</span><br></pre></td></tr></table></figure>

<p>Then in <code>AppDelegate</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">application</span><span class="params">(<span class="number">_</span> application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplicationLaunchOptionsKey: <span class="keyword">Any</span>]?)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> <span class="type">CommandLine</span>.arguments.<span class="built_in">contains</span>(<span class="string">"--UITests"</span>) &#123;</span><br><span class="line">    <span class="type">UIView</span>.setAnimationsEnabled(<span class="literal">false</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-09-13T08:58:16.000Z" title="2017-09-13T08:58:16.000Z">2017-09-13</time><span class="level-item">2 minutes read (About 344 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-use-Given-When-Then-in-Swift-tests/">How to use Given When Then in Swift tests</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/73">#73</a></strong></p>
<h3 id="Spec"><a href="#Spec" class="headerlink" title="Spec"></a>Spec</h3><p>Using <code>spec</code> testing framework like <a href="https://github.com/Quick/Quick">Quick</a> is nice, which enables <code>BDD</code> style.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">describe(<span class="string">"the 'Documentation' directory"</span>) &#123;</span><br><span class="line">  it(<span class="string">"has everything you need to get started"</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> sections = <span class="type">Directory</span>(<span class="string">"Documentation"</span>).sections</span><br><span class="line">    expect(sections).to(contain(<span class="string">"Organized Tests with Quick Examples and Example Groups"</span>))</span><br><span class="line">    expect(sections).to(contain(<span class="string">"Installing Quick"</span>))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  context(<span class="string">"if it doesn't have what you're looking for"</span>) &#123;</span><br><span class="line">    it(<span class="string">"needs to be updated"</span>) &#123;</span><br><span class="line">      <span class="keyword">let</span> you = <span class="type">You</span>(awesome: <span class="literal">true</span>)</span><br><span class="line">      expect&#123;you.submittedAnIssue&#125;.toEventually(beTruthy())</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>But in case you don’t want additional frameworks, and want to live closer to Apple SDKs as much as possible, here are few tips.</p>
<h3 id="Naming"><a href="#Naming" class="headerlink" title="Naming"></a>Naming</h3><p>This is from the book that I really like <a href="http://artofunittesting.com/">The Art of Unit Testing</a>. If you don’t mind the underscore, you can follow <a href="http://osherove.com/blog/2005/4/3/naming-standards-for-unit-tests.html">UnitOfWork_StateUnderTest_ExpectedBehavior</a> structure</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">func testSum_NegativeNumberAs1stParam_ExceptionThrown()</span><br><span class="line">func testSum_NegativeNumberAs2ndParam_ExceptionThrown()</span><br><span class="line">func testSum_simpleValues_Calculated()</span><br></pre></td></tr></table></figure>

<h3 id="Given-When-Then"><a href="#Given-When-Then" class="headerlink" title="Given When Then"></a>Given When Then</h3><p>This is from BDD, and practised a lot in <a href="https://github.com/cucumber/cucumber/wiki/Given-When-Then">Cucumber</a>. You can read more on <a href="https://martinfowler.com/bliki/GivenWhenThen.html">https://martinfowler.com/bliki/GivenWhenThen.html</a>.</p>
<p>First, add some more extensions to <code>XCTestCase</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> XCTest</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">XCTestCase</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">given</span><span class="params">(<span class="number">_</span> description: String, closure: <span class="params">()</span></span></span> <span class="keyword">throws</span> -&gt; <span class="type">Void</span>) <span class="keyword">throws</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> closure()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">when</span><span class="params">(<span class="number">_</span> description: String, closure: <span class="params">()</span></span></span> <span class="keyword">throws</span> -&gt; <span class="type">Void</span>) <span class="keyword">throws</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> closure()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">then</span><span class="params">(<span class="number">_</span> description: String, closure: <span class="params">()</span></span></span> <span class="keyword">throws</span> -&gt; <span class="type">Void</span>) <span class="keyword">throws</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> closure()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Then, in order to test, just follow <code>given when then</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">testRemoveObject</span><span class="params">()</span></span> <span class="keyword">throws</span> &#123;</span><br><span class="line">  <span class="keyword">try</span> given(<span class="string">"set to storage"</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> storage.setObject(testObject, forKey: key)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> when(<span class="string">"remove object from storage"</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> storage.removeObject(forKey: key)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> then(<span class="string">"there is no object in memory"</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> memoryObject = <span class="keyword">try</span>? storage.memoryCache.object(forKey: key) <span class="keyword">as</span> <span class="type">User</span></span><br><span class="line">    <span class="type">XCTAssertNil</span>(memoryObject)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> then(<span class="string">"there is no object on disk"</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> diskObject = <span class="keyword">try</span>? storage.diskCache.object(forKey: key) <span class="keyword">as</span> <span class="type">User</span></span><br><span class="line">    <span class="type">XCTAssertNil</span>(diskObject)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>I find this more interesting than comments. All are code and descriptive. It can also be developed further to throw the <code>description</code> text.</p>
<hr>
<p><strong>Updated at</strong> 2020-12-18 15:15:26</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-06-02T10:59:14.000Z" title="2017-06-02T10:59:14.000Z">2017-06-02</time><span class="level-item">3 minutes read (About 425 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-run-UI-Test-with-system-alert-in-iOS/">How to run UI Test with system alert in iOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/48">#48</a></strong></p>
<p>Continue my post <a href="https://github.com/onmyway133/blog/issues/45">https://github.com/onmyway133/blog/issues/45</a>. When you work with features, like map view, you mostly need permissions, and in UITests you need to test for system alerts.</p>
<h3 id="Add-interruption-monitor"><a href="#Add-interruption-monitor" class="headerlink" title="Add interruption monitor"></a>Add interruption monitor</h3><p>This is the code. Note that you need to call <code>app.tap()</code> to interact with the app again, in order for interruption monitor to work</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">addUIInterruptionMonitor(withDescription: <span class="string">"Location permission"</span>, handler: &#123; alert <span class="keyword">in</span></span><br><span class="line">  alert.buttons[<span class="string">"Allow"</span>].tap()</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.tap()</span><br></pre></td></tr></table></figure>

<p>Note that you don’t always need to handle the returned value of <code>addUIInterruptionMonitor</code></p>
<h3 id="Only-tap-when-needed"><a href="#Only-tap-when-needed" class="headerlink" title="Only tap when needed"></a>Only tap when needed</h3><p>One problem with this approach is that when there is no system alert (you already touched to allow before), then <code>app.tap()</code> will tap on your main screen. In my app which uses map view, it will tap on some pins, which will present another screen, which is not correct.</p>
<p>Since <code>app.alerts</code> does not work, my 2nd attempt is to check for <code>app.windows.count</code>. Unfortunately, it always shows 5 windows whether alert is showing or not. I know 1 is for main window, 1 is for status bar, the other 3 windows I have no idea.</p>
<p>The 3rd attempt is to check that underlying elements (behind alert) can’t be touched, which is to use <code>isHittable</code>. This property does not work, it always returns <code>true</code></p>
<h3 id="Check-the-content"><a href="#Check-the-content" class="headerlink" title="Check the content"></a>Check the content</h3><p>This uses the assumption that we only tests for when user hits <code>Allow</code> button. So only if alert is answered with <code>Allow</code>, then we have permission to display our content. For my map view, I check that there are some pins on the map. See <a href="https://github.com/onmyway133/blog/issues/45">https://github.com/onmyway133/blog/issues/45</a> on how to mock location and identify the pins</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if app.otherElements.matching(identifier: &quot;myPin&quot;).count &#x3D;&#x3D; 0 &#123;</span><br><span class="line">  app.tap()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="When-there-is-no-permission"><a href="#When-there-is-no-permission" class="headerlink" title="When there is no permission"></a>When there is no permission</h3><p>So how can we test that user has denied your request? In my map view, if user does not allow location permission, I show a popup asking user to go to Settings and change it, otherwise, they can’t interact with the map.</p>
<p>I don’t know how to toggle location in <code>Privacy</code> in <code>Settings</code>, maybe <code>XCUISiriService</code> can help. But 1 thing we can do is to mock the application</p>
<p>Before you launch the app in <code>UITests</code>, add some arguments</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.launchArguments.append(&quot;--UITests-mockNoLocationPermission&quot;)</span><br></pre></td></tr></table></figure>

<p>and in the app, we need to check for this <code>arguments</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">checkLocationPermission</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">if</span> <span class="type">CommandLine</span>.arguments.<span class="built_in">contains</span>(<span class="string">"--UITests-mockNoLocationPermission"</span>) &#123;</span><br><span class="line">    showNoLocationPopupAndAskUserToEnableInSettings()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="That’s-it-In-UITests-we-can-test-whether-that-no-location-permission-popup-appears-or-not"><a href="#That’s-it-In-UITests-we-can-test-whether-that-no-location-permission-popup-appears-or-not" class="headerlink" title="That’s it. In UITests, we can test whether that no location permission popup appears or not"></a>That’s it. In <code>UITests</code>, we can test whether that <code>no location permission popup</code> appears or not</h2><p><strong>Updated at</strong> 2020-06-02 02:12:36</p>
</div></article></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="" src="https://avatars1.githubusercontent.com/u/2284279?s=460&amp;v=4" alt="onmyway133"></figure><p class="title is-size-4 is-block line-height-inherit">onmyway133</p><p class="is-size-6 is-block">iOS, macOS, Android, React. Serial maker. Writer. Speaker.</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Oslo, Norway</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">673</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">52</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/onmyway133" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/onmyway133"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com/onmyway133"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile is-mobile" href="https://onmyway133.com/apps" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Apps</span></span><span class="level-right"><span class="level-item tag">onmyway133.com</span></span></a></li><li><a class="level is-mobile is-mobile" href="https://learntalks.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Learn Talks</span></span><span class="level-right"><span class="level-item tag">learntalks.com</span></span></a></li><li><a class="level is-mobile is-mobile" href="https://wwdctogether.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">WWDC Together</span></span><span class="level-right"><span class="level-item tag">wwdctogether.com</span></span></a></li></ul></div></div></div><!--!--><div class="card widget"><div class="card-content"><h3 class="menu-label">Recent</h3><article class="media"><div class="media-content size-small"><p><time dateTime="2020-12-27T21:11:35.000Z">2020-12-27</time></p><p class="title is-6"><a class="link-muted" href="/blog/How-to-use-hashtag-raw-string-in-Swift/">How to use hashtag raw string in Swift</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-12-26T20:42:53.000Z">2020-12-26</time></p><p class="title is-6"><a class="link-muted" href="/blog/How-to-make-UserDefaults-property-wrapper/">How to make UserDefaults property wrapper</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-12-26T20:09:15.000Z">2020-12-26</time></p><p class="title is-6"><a class="link-muted" href="/blog/How-to-use-Set-to-check-for-bool-in-Swift/">How to use Set to check for bool in Swift</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-12-26T20:02:18.000Z">2020-12-26</time></p><p class="title is-6"><a class="link-muted" href="/blog/How-to-make-visual-effect-blur-in-SwiftUI-for-macOS/">How to make visual effect blur in SwiftUI for macOS</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-12-26T19:51:44.000Z">2020-12-26</time></p><p class="title is-6"><a class="link-muted" href="/blog/How-to-make-simple-HUD-in-SwiftUI/">How to make simple HUD in SwiftUI</a></p><p class="is-uppercase"></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/archives/2020/12/"><span class="level-start"><span class="level-item">December 2020</span></span><span class="level-end"><span class="level-item tag">23</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/11/"><span class="level-start"><span class="level-item">November 2020</span></span><span class="level-end"><span class="level-item tag">15</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/10/"><span class="level-start"><span class="level-item">October 2020</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/09/"><span class="level-start"><span class="level-item">September 2020</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/08/"><span class="level-start"><span class="level-item">August 2020</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/06/"><span class="level-start"><span class="level-item">June 2020</span></span><span class="level-end"><span class="level-item tag">14</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/05/"><span class="level-start"><span class="level-item">May 2020</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/04/"><span class="level-start"><span class="level-item">April 2020</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/03/"><span class="level-start"><span class="level-item">March 2020</span></span><span class="level-end"><span class="level-item tag">21</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/02/"><span class="level-start"><span class="level-item">February 2020</span></span><span class="level-end"><span class="level-item tag">20</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/01/"><span class="level-start"><span class="level-item">January 2020</span></span><span class="level-end"><span class="level-item tag">30</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/12/"><span class="level-start"><span class="level-item">December 2019</span></span><span class="level-end"><span class="level-item tag">36</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/11/"><span class="level-start"><span class="level-item">November 2019</span></span><span class="level-end"><span class="level-item tag">38</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/10/"><span class="level-start"><span class="level-item">October 2019</span></span><span class="level-end"><span class="level-item tag">49</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/09/"><span class="level-start"><span class="level-item">September 2019</span></span><span class="level-end"><span class="level-item tag">50</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/08/"><span class="level-start"><span class="level-item">August 2019</span></span><span class="level-end"><span class="level-item tag">39</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/07/"><span class="level-start"><span class="level-item">July 2019</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/06/"><span class="level-start"><span class="level-item">June 2019</span></span><span class="level-end"><span class="level-item tag">41</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/05/"><span class="level-start"><span class="level-item">May 2019</span></span><span class="level-end"><span class="level-item tag">49</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/04/"><span class="level-start"><span class="level-item">April 2019</span></span><span class="level-end"><span class="level-item tag">27</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/03/"><span class="level-start"><span class="level-item">March 2019</span></span><span class="level-end"><span class="level-item tag">24</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/02/"><span class="level-start"><span class="level-item">February 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/12/"><span class="level-start"><span class="level-item">December 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/05/"><span class="level-start"><span class="level-item">May 2018</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/04/"><span class="level-start"><span class="level-item">April 2018</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/02/"><span class="level-start"><span class="level-item">February 2018</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/01/"><span class="level-start"><span class="level-item">January 2018</span></span><span class="level-end"><span class="level-item tag">14</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/12/"><span class="level-start"><span class="level-item">December 2017</span></span><span class="level-end"><span class="level-item tag">14</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/11/"><span class="level-start"><span class="level-item">November 2017</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/10/"><span class="level-start"><span class="level-item">October 2017</span></span><span class="level-end"><span class="level-item tag">18</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/09/"><span class="level-start"><span class="level-item">September 2017</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/08/"><span class="level-start"><span class="level-item">August 2017</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/07/"><span class="level-start"><span class="level-item">July 2017</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/06/"><span class="level-start"><span class="level-item">June 2017</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/05/"><span class="level-start"><span class="level-item">May 2017</span></span><span class="level-end"><span class="level-item tag">35</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/04/"><span class="level-start"><span class="level-item">April 2017</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/algorithm/"><span class="tag">algorithm</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/android/"><span class="tag">android</span><span class="tag is-grey-lightest">34</span></a></div><div class="control"><a class="tags has-addons" href="/tags/apple-script/"><span class="tag">apple script</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/catalyst/"><span class="tag">catalyst</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ci/"><span class="tag">ci</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cloud/"><span class="tag">cloud</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cocoapods/"><span class="tag">cocoapods</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/combine/"><span class="tag">combine</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/core-data/"><span class="tag">core data</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/csharp/"><span class="tag">csharp</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/css/"><span class="tag">css</span><span class="tag is-grey-lightest">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/dart/"><span class="tag">dart</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/database/"><span class="tag">database</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/design/"><span class="tag">design</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/electron/"><span class="tag">electron</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/firebase/"><span class="tag">firebase</span><span class="tag is-grey-lightest">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/flutter/"><span class="tag">flutter</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/git/"><span class="tag">git</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/github/"><span class="tag">github</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/go/"><span class="tag">go</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/google/"><span class="tag">google</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/iOS/"><span class="tag">iOS</span><span class="tag is-grey-lightest">166</span></a></div><div class="control"><a class="tags has-addons" href="/tags/javascript/"><span class="tag">javascript</span><span class="tag is-grey-lightest">50</span></a></div><div class="control"><a class="tags has-addons" href="/tags/kotlin/"><span class="tag">kotlin</span><span class="tag is-grey-lightest">27</span></a></div><div class="control"><a class="tags has-addons" href="/tags/layout/"><span class="tag">layout</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/life/"><span class="tag">life</span><span class="tag is-grey-lightest">12</span></a></div><div class="control"><a class="tags has-addons" href="/tags/links/"><span class="tag">links</span><span class="tag is-grey-lightest">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/macOS/"><span class="tag">macOS</span><span class="tag is-grey-lightest">116</span></a></div><div class="control"><a class="tags has-addons" href="/tags/machine-learning/"><span class="tag">machine learning</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/maps/"><span class="tag">maps</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/networking/"><span class="tag">networking</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/node/"><span class="tag">node</span><span class="tag is-grey-lightest">11</span></a></div><div class="control"><a class="tags has-addons" href="/tags/objc/"><span class="tag">objc</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/react/"><span class="tag">react</span><span class="tag is-grey-lightest">23</span></a></div><div class="control"><a class="tags has-addons" href="/tags/react-native/"><span class="tag">react native</span><span class="tag is-grey-lightest">14</span></a></div><div class="control"><a class="tags has-addons" href="/tags/realm/"><span class="tag">realm</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/rx/"><span class="tag">rx</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/script/"><span class="tag">script</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/spm/"><span class="tag">spm</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/swift/"><span class="tag">swift</span><span class="tag is-grey-lightest">317</span></a></div><div class="control"><a class="tags has-addons" href="/tags/swiftUI/"><span class="tag">swiftUI</span><span class="tag is-grey-lightest">76</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tech/"><span class="tag">tech</span><span class="tag is-grey-lightest">14</span></a></div><div class="control"><a class="tags has-addons" href="/tags/terminal/"><span class="tag">terminal</span><span class="tag is-grey-lightest">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/testing/"><span class="tag">testing</span><span class="tag is-grey-lightest">17</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tool/"><span class="tag">tool</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/unity/"><span class="tag">unity</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/voip/"><span class="tag">voip</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/watchOS/"><span class="tag">watchOS</span><span class="tag is-grey-lightest">11</span></a></div><div class="control"><a class="tags has-addons" href="/tags/web/"><span class="tag">web</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/work/"><span class="tag">work</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/wwdc/"><span class="tag">wwdc</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/xcode/"><span class="tag">xcode</span><span class="tag is-grey-lightest">24</span></a></div></div></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Subscribe to Updates</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=c2r59mmt2n5k0o5dt5vv3nq4u4&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="c2r59mmt2n5k0o5dt5vv3nq4u4" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button is-primary" type="submit" value="Subscribe"></div></div></form></div></div></div><div class="card widget"><div class="card-content"><div class="notification is-danger">You need to set <code>client_id</code> and <code>slot_id</code> to show this AD unit. Please set it in <code>_config.yml</code>.</div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/z.png" alt="onmyway133" height="28"></a><p class="size-small"><span>&copy; 2020 Khoa Pham</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/onmyway133"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            site: {
                url: 'https://onmyway133.github.io',
                external_link: {"enable":true,"exclude":[]}
            },
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to Top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>