<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="generator" content="Hexo 4.2.0"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Tag: swiftUI - onmyway133</title><meta description="What you don&amp;#39;t know is what you haven&amp;#39;t learned"><meta property="og:type" content="blog"><meta property="og:title" content="onmyway133"><meta property="og:url" content="https://onmyway133.github.io/"><meta property="og:site_name" content="onmyway133"><meta property="og:description" content="What you don&amp;#39;t know is what you haven&amp;#39;t learned"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://onmyway133.github.io/img/og_image.png"><meta property="article:author" content="Khoa Pham"><meta property="article:tag" content="ios"><meta property="article:tag" content=" android"><meta property="article:tag" content="javascript"><meta property="article:tag" content=" react"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><meta property="twitter:creator" content="@onmyway133"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://onmyway133.github.io"},"headline":"onmyway133","image":["https://onmyway133.github.io/img/og_image.png"],"author":{"@type":"Person","name":"Khoa Pham"},"description":"What you don&#39;t know is what you haven&#39;t learned"}</script><link rel="alternative" href="/atom.xml" title="onmyway133" type="application/atom+xml"><link rel="icon" href="/img/favicon.ico"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=UA-40119591-5" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'UA-40119591-5');</script><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><script data-ad-client="ca-pub-3656459401405265" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" async></script></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/z.png" alt="onmyway133" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/apps">Apps</a><a class="navbar-item" href="/gumroad">Gumroad</a><a class="navbar-item" href="/about">About</a><a class="navbar-item" href="/opensource">Open Source</a><a class="navbar-item" href="/writing">Writing</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/speaking">Speaking</a><a class="navbar-item" href="/news">News</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/onmyway133"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/tags">Tags</a></li><li class="is-active"><a href="#" aria-current="page">swiftUI</a></li></ul></nav></div></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-11-02T22:46:18.000Z" title="2019-11-02T22:46:18.000Z">2019-11-02</time><span class="level-item">3 minutes read (About 442 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-get-Binding-via-dollar-prefix-in-SwiftUI/">How to get Binding via dollar prefix in SwiftUI</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/488">#488</a></strong></p>
<p>The dollar is not a prefix, it seems to be a generated code for property wrapper, and each kind of property wrapper can determine which value it return via this dollar sign</p>
<p><code>State</code> and <code>ObservedObject</code> are popular property wrappers in SwiftUI</p>
<h2 id="State"><a href="#State" class="headerlink" title="State"></a>State</h2><p>Read <a href="https://developer.apple.com/documentation/swiftui/state">State</a></p>
<blockquote>
<p>A persistent value of a given type, through which a view reads and monitors the value.</p>
</blockquote>
<p>If we have a simple State, we can access its 3 forms</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@<span class="type">State</span> <span class="keyword">private</span> <span class="keyword">var</span> image: <span class="type">UIImage</span></span><br></pre></td></tr></table></figure>

<p>and here is what </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">image <span class="comment">// UIImage</span></span><br><span class="line">_image <span class="comment">// State&lt;UIImage&gt;</span></span><br><span class="line">$image <span class="comment">// Binding&lt;UIImage&gt;</span></span><br></pre></td></tr></table></figure>

<p>Also, with State, we can access <code>Binding</code> via <code>projectedValue</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_image.projectedValue &#x2F;&#x2F; Binding&lt;UIImage&gt;</span><br></pre></td></tr></table></figure>

<h2 id="ObservableObject"><a href="#ObservableObject" class="headerlink" title="ObservableObject"></a>ObservableObject</h2><p>Read <a href="https://developer.apple.com/documentation/swiftui/observedobject">ObservedObject</a></p>
<p>For a simple <code>ObservableObject</code>, we can see its 3 forms</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewModel</span>: <span class="title">ObservableObject</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> objectWillChange = <span class="type">ObservableObjectPublisher</span>()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> image: <span class="type">UIImage?</span> &#123;</span><br><span class="line">        <span class="keyword">didSet</span> &#123;</span><br><span class="line">            objectWillChange.send()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@<span class="type">ObservedObject</span> <span class="keyword">var</span> viewModel: <span class="type">ViewModel</span> = <span class="type">ViewModel</span>()</span><br></pre></td></tr></table></figure>

<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">viewModel <span class="comment">// ViewModel</span></span><br><span class="line">_viewModel <span class="comment">// ObservedObject&lt;ViewModel&gt;</span></span><br><span class="line">$viewModel <span class="comment">// ObservedObject&lt;ViewModel&gt;.Wrapper</span></span><br></pre></td></tr></table></figure>

<p>If we view the source code of <code>ObservableObject</code>, we can see its <code>Wrapper</code> which uses <code>dynamicMemberLookup</code> to provide <code>Binding</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">@propertyWrapper <span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">ObservedObject</span>&lt;<span class="title">ObjectType</span>&gt; : <span class="title">DynamicProperty</span> <span class="title">where</span> <span class="title">ObjectType</span> : <span class="title">ObservableObject</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// A wrapper of the underlying `ObservableObject` that can create</span></span><br><span class="line">    <span class="comment">/// `Binding`s to its properties using dynamic member lookup.</span></span><br><span class="line">    @dynamicMemberLookup <span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">Wrapper</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/// Creates a `Binding` to a value semantic property of a</span></span><br><span class="line">        <span class="comment">/// reference type.</span></span><br><span class="line">        <span class="comment">///</span></span><br><span class="line">        <span class="comment">/// If `Value` is not value semantic, the updating behavior for</span></span><br><span class="line">        <span class="comment">/// any views that make use of the resulting `Binding` is</span></span><br><span class="line">        <span class="comment">/// unspecified.</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">subscript</span>&lt;<span class="type">Subject</span>&gt;(dynamicMember keyPath: <span class="type">ReferenceWritableKeyPath</span>&lt;<span class="type">ObjectType</span>, <span class="type">Subject</span>&gt;) -&gt; <span class="type">Binding</span>&lt;<span class="type">Subject</span>&gt; &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">init</span>(initialValue: <span class="type">ObjectType</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">init</span>(wrappedValue: <span class="type">ObjectType</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> wrappedValue: <span class="type">ObjectType</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> projectedValue: <span class="type">ObservedObject</span>&lt;<span class="type">ObjectType</span>&gt;.<span class="type">Wrapper</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Derived-State"><a href="#Derived-State" class="headerlink" title="Derived State"></a>Derived State</h2><p>If we have a struct with <code>@State</code> in a SwiftUI view, we can access its property as Binding. This derived state mechanism is done via Dynamic keypath member lookup  feature of Swift 5.1</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ViewModel</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> image: <span class="type">UIImage?</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">MainView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    @<span class="type">State</span> <span class="keyword">private</span> <span class="keyword">var</span> viewModel: <span class="type">ViewModel</span> = <span class="type">ViewModel</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Take a look at the interface of <code>Binding</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// A value and a means to mutate it.</span></span><br><span class="line"><span class="meta">@available</span>(iOS <span class="number">13.0</span>, <span class="type">OSX</span> <span class="number">10.15</span>, tvOS <span class="number">13.0</span>, watchOS <span class="number">6.0</span>, *)</span><br><span class="line">@propertyWrapper @dynamicMemberLookup <span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">Binding</span>&lt;<span class="title">Value</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">/// Creates a new `Binding` focused on `Subject` using a key path.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">subscript</span>&lt;<span class="type">Subject</span>&gt;(dynamicMember keyPath: <span class="type">WritableKeyPath</span>&lt;<span class="type">Value</span>, <span class="type">Subject</span>&gt;) -&gt; <span class="type">Binding</span>&lt;<span class="type">Subject</span>&gt; &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>So if use <code>$viewModel.image</code> we can access its property as Binding</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">viewModel.image <span class="comment">// UIImage?</span></span><br><span class="line">$viewModel.image <span class="comment">// Binding&lt;UIImage?&gt;</span></span><br><span class="line">$viewModel.$image <span class="comment">// Value of type 'ViewModel' has no member '$image'</span></span><br></pre></td></tr></table></figure>

<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>So now we know how to get <code>Binding</code> from <code>State</code> and <code>ObservableObject</code>, and the mysterious dollar sign. These are both convenient but confusing at first, but if we use it more, it will make more sense and hopefully we can learn to do the same for our own property wrappers</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-11-02T22:09:43.000Z" title="2019-11-02T22:09:43.000Z">2019-11-02</time><span class="level-item">8 minutes read (About 1193 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-modify-state-from-state-in-SwiftUI/">How to modify state from state in SwiftUI</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/487">#487</a></strong></p>
<p>In case we have to modify state when another state is known, we can encapsulate all those states in <code>ObservableObject</code> and use <code>onReceive</code> to check the state we want to act on.</p>
<p>See code <a href="https://github.com/onmyway133/Avengers/blob/master/Avengers/Features/MainView.swift">Avengers</a></p>
<p>If we were to modify state from within <code>body</code> function call, we will get warnings</p>
<blockquote>
<p>Modifying state during view update, this will cause undefined behavior.</p>
</blockquote>
<p>This is similar to the warning when we change state inside <code>render</code> in React</p>
<p>For example, when we get an image, we want to do some logic based on that image and modify result state. Here we use <code>var objectWillChange = ObservableObjectPublisher()</code> to notify state change, and because <code>onReceive</code> requires <code>Publisher</code>, we use <code>let imagePublisher = PassthroughSubject&lt;UIImage, Never&gt;()</code></p>
<p>Note that we use <code>$</code> prefix from a variable to form <code>Binding</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> Combine</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewModel</span>: <span class="title">ObservableObject</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> objectWillChange = <span class="type">ObservableObjectPublisher</span>()</span><br><span class="line">    <span class="keyword">let</span> imagePublisher = <span class="type">PassthroughSubject</span>&lt;<span class="type">UIImage</span>, <span class="type">Never</span>&gt;()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> image: <span class="type">UIImage?</span> &#123;</span><br><span class="line">        <span class="keyword">willSet</span> &#123;</span><br><span class="line">            objectWillChange.send()</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> image = image &#123;</span><br><span class="line">                imagePublisher.send(image)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> isDetecting: <span class="type">Bool</span> = <span class="literal">false</span> &#123;</span><br><span class="line">        <span class="keyword">willSet</span> &#123;</span><br><span class="line">            objectWillChange.send()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> result: <span class="type">String?</span> &#123;</span><br><span class="line">        <span class="keyword">willSet</span> &#123;</span><br><span class="line">            objectWillChange.send()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">MainView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    @<span class="type">State</span> <span class="keyword">private</span> <span class="keyword">var</span> showImagePicker: <span class="type">Bool</span> = <span class="literal">false</span></span><br><span class="line">    @<span class="type">ObservedObject</span> <span class="keyword">var</span> viewModel: <span class="type">ViewModel</span> = <span class="type">ViewModel</span>()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">let</span> detector = <span class="type">Detector</span>()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            makeImage()</span><br><span class="line">                .styleFit()</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> viewModel.isDetecting &#123;</span><br><span class="line">                <span class="type">ActivityIndicator</span>(</span><br><span class="line">                    isAnimating: $viewModel.isDetecting,</span><br><span class="line">                    style: .large</span><br><span class="line">                )</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            makeResult()</span><br><span class="line"></span><br><span class="line">            <span class="type">Button</span>(action: &#123;</span><br><span class="line">                <span class="keyword">self</span>.showImagePicker.toggle()</span><br><span class="line">            &#125;, label: &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">"Choose image"</span>)</span><br><span class="line">            &#125;)</span><br><span class="line">            .sheet(isPresented: $showImagePicker, content: &#123;</span><br><span class="line">                <span class="type">ImagePicker</span>(image: <span class="keyword">self</span>.$viewModel.image, isPresented: <span class="keyword">self</span>.$showImagePicker)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        .onReceive(viewModel.imagePublisher, perform: &#123; image <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">self</span>.detect(image: image)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">makeImage</span><span class="params">()</span></span> -&gt; <span class="type">Image</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> image = <span class="keyword">self</span>.viewModel.image &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="type">Image</span>(uiImage: image)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="type">Image</span>(<span class="string">"placeholder"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">makeResult</span><span class="params">()</span></span> -&gt; <span class="type">Text</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> result = viewModel.result &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="type">Text</span>(result)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="type">Text</span>(<span class="string">""</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">detect</span><span class="params">(image: UIImage)</span></span> &#123;</span><br><span class="line">        viewModel.isDetecting = <span class="literal">true</span></span><br><span class="line">        <span class="keyword">try</span>? detector.detect(image: image, completion: &#123; result <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">switch</span> result &#123;</span><br><span class="line">            <span class="keyword">case</span> .success(<span class="keyword">let</span> string):</span><br><span class="line">                <span class="keyword">self</span>.viewModel.result = string</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">self</span>.viewModel.result = <span class="string">""</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">self</span>.viewModel.isDetecting = <span class="literal">false</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Use-Published"><a href="#Use-Published" class="headerlink" title="Use Published"></a>Use Published</h2><p>See <a href="https://developer.apple.com/documentation/combine/observableobject">ObservableObject</a> </p>
<blockquote>
<p>By default an ObservableObject synthesizes an objectWillChange publisher that emits the changed value before any of its @Published properties changes.</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Contact</span>: <span class="title">ObservableObject</span> </span>&#123;</span><br><span class="line">    @<span class="type">Published</span> <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    @<span class="type">Published</span> <span class="keyword">var</span> age: <span class="type">Int</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(name: <span class="type">String</span>, age: <span class="type">Int</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.name = name</span><br><span class="line">        <span class="keyword">self</span>.age = age</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">haveBirthday</span><span class="params">()</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        age += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> age</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> john = <span class="type">Contact</span>(name: <span class="string">"John Appleseed"</span>, age: <span class="number">24</span>)</span><br><span class="line">john.objectWillChange.sink &#123; <span class="number">_</span> <span class="keyword">in</span> <span class="built_in">print</span>(<span class="string">"\(john.age) will change"</span>) &#125;</span><br><span class="line"><span class="built_in">print</span>(john.haveBirthday())</span><br><span class="line"><span class="comment">// Prints "24 will change"</span></span><br><span class="line"><span class="comment">// Prints "25"</span></span><br></pre></td></tr></table></figure>

<p>We should use <code>@Published</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewModel</span>: <span class="title">ObservableObject</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> objectWillChange = <span class="type">ObservableObjectPublisher</span>()</span><br><span class="line"></span><br><span class="line">    @<span class="type">Published</span> <span class="keyword">var</span> image: <span class="type">UIImage?</span></span><br><span class="line">    @<span class="type">Published</span> <span class="keyword">var</span> isDetecting: <span class="type">Bool</span> = <span class="literal">false</span></span><br><span class="line">    @<span class="type">Published</span> <span class="keyword">var</span> result: <span class="type">String?</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Note that we should not use <code>objectWillChange</code> as</p>
<blockquote>
<p>By default an ObservableObject synthesizes an objectWillChange publisher that emits the changed value before any of its @Published properties changes.</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.onReceive(viewModel.$image, perform: &#123; image <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> image = image &#123;</span><br><span class="line">        <span class="keyword">self</span>.detect(image: image)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>We need to manually notify using <code>objectWillChange</code> !! Maybe this is a SwiftUI bug</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">detect</span><span class="params">(image: UIImage)</span></span> &#123;</span><br><span class="line">    viewModel.isDetecting = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">try</span>? detector.detect(image: image, completion: &#123; result <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">switch</span> result &#123;</span><br><span class="line">        <span class="keyword">case</span> .success(<span class="keyword">let</span> string):</span><br><span class="line">            <span class="keyword">self</span>.viewModel.result = string</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">self</span>.viewModel.result = <span class="string">""</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">self</span>.viewModel.isDetecting = <span class="literal">false</span></span><br><span class="line">        <span class="keyword">self</span>.viewModel.objectWillChange.send()</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>If we remove the declaration of <code>var objectWillChange = ObservableObjectPublisher()</code>, then it works automatically</p>
<h2 id="objectWillChange"><a href="#objectWillChange" class="headerlink" title="objectWillChange"></a>objectWillChange</h2><p>Learn more about the history of <code>objectWillChange</code></p>
<p><a href="https://twitter.com/luka_bernardi/status/1155944329363349504?lang=no">https://twitter.com/luka_bernardi/status/1155944329363349504?lang=no</a></p>
<blockquote>
<p>In Beta 5 ObjectBinding is now defined in Combine as ObservableObject (the property wrapper is now @ObservedObject). There is also a new property wrapper @Published where we automatically synthesize the objectWillChange publisher and call it on willSet.</p>
</blockquote>
<blockquote>
<p>It’ll objectWillChange.send() in the property willSet it’s defined on.<br>It just removes the boilerplate that you had to write before but otherwise behaves the same.</p>
</blockquote>
<h2 id="State-vs-ObservedObject"><a href="#State-vs-ObservedObject" class="headerlink" title="State vs ObservedObject"></a>State vs ObservedObject</h2><p>If we were to use <code>@State</code> instead of <code>@ObservedObject</code>, it still compiles, but after we pick an image, which should change the <code>image</code> property of our <code>viewModel</code>, the view is not reloaded.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">MainView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    @<span class="type">State</span> <span class="keyword">private</span> <span class="keyword">var</span> showImagePicker: <span class="type">Bool</span> = <span class="literal">false</span></span><br><span class="line">    @<span class="type">State</span> <span class="keyword">private</span> <span class="keyword">var</span> viewModel: <span class="type">ViewModel</span> = <span class="type">ViewModel</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Note that we can’t use <code>@Published</code> inside <code>struct</code></p>
<blockquote>
<p>‘wrappedValue’ is unavailable: @Published is only available on properties of classes</p>
</blockquote>
<p><code>@State</code> is for internal usage within a view, and should use struct and primitive  data structure. SwiftUI keeps <code>@State</code> property in a separate memory place to preserve it during many reload cycles.</p>
<p><code>@Observabled</code> is meant for sharing reference objects across views</p>
<p>To to use <code>@State</code> we should use struct, and to use <code>onReceive</code> we should introduce another <code>Publisher</code> like <code>imagePublisher</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ViewModel</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> imagePublisher = <span class="type">PassthroughSubject</span>&lt;<span class="type">UIImage?</span>, <span class="type">Never</span>&gt;()</span><br><span class="line">    <span class="keyword">var</span> image: <span class="type">UIImage?</span> &#123;</span><br><span class="line">        <span class="keyword">didSet</span> &#123;</span><br><span class="line">            imagePublisher.send(image)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> isDetecting: <span class="type">Bool</span> = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">var</span> result: <span class="type">String?</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">MainView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    @<span class="type">State</span> <span class="keyword">private</span> <span class="keyword">var</span> showImagePicker: <span class="type">Bool</span> = <span class="literal">false</span></span><br><span class="line">    @<span class="type">State</span> <span class="keyword">private</span> <span class="keyword">var</span> viewModel: <span class="type">ViewModel</span> = <span class="type">ViewModel</span>()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">let</span> detector = <span class="type">Detector</span>()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            makeImage()</span><br><span class="line">                .styleFit()</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> viewModel.isDetecting &#123;</span><br><span class="line">                <span class="type">ActivityIndicator</span>(</span><br><span class="line">                    isAnimating: $viewModel.isDetecting,</span><br><span class="line">                    style: .large</span><br><span class="line">                )</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            makeResult()</span><br><span class="line"></span><br><span class="line">            <span class="type">Button</span>(action: &#123;</span><br><span class="line">                <span class="keyword">self</span>.showImagePicker.toggle()</span><br><span class="line">            &#125;, label: &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">"Choose image"</span>)</span><br><span class="line">            &#125;)</span><br><span class="line">            .sheet(isPresented: $showImagePicker, content: &#123;</span><br><span class="line">                <span class="type">ImagePicker</span>(image: <span class="keyword">self</span>.$viewModel.image, isPresented: <span class="keyword">self</span>.$showImagePicker)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        .onReceive(viewModel.imagePublisher, perform: &#123; image <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> image = image &#123;</span><br><span class="line">                <span class="keyword">self</span>.detect(image: image)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The dollar sign for <code>State</code> to access nested properties, like <code>$viewModel.image</code> is called derived Binding, and is achieved via Keypath member lookup feature of Swift 5.1.</p>
<p>Take a look at <code>projectedValue: Binding&lt;Value&gt;</code> from <code>State</code> and <code>subscript&lt;Subject&gt;(dynamicMember keyPath</code> from <code>Binding</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@available</span>(iOS <span class="number">13.0</span>, <span class="type">OSX</span> <span class="number">10.15</span>, tvOS <span class="number">13.0</span>, watchOS <span class="number">6.0</span>, *)</span><br><span class="line">@propertyWrapper <span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">State</span>&lt;<span class="title">Value</span>&gt; : <span class="title">DynamicProperty</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Initialize with the provided initial value.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">init</span>(wrappedValue value: <span class="type">Value</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Initialize with the provided initial value.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">init</span>(initialValue value: <span class="type">Value</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// The current state value.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> wrappedValue: <span class="type">Value</span> &#123; <span class="keyword">get</span> <span class="keyword">nonmutating</span> <span class="keyword">set</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Produces the binding referencing this state value</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> projectedValue: <span class="type">Binding</span>&lt;<span class="type">Value</span>&gt; &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// A value and a means to mutate it.</span></span><br><span class="line"><span class="meta">@available</span>(iOS <span class="number">13.0</span>, <span class="type">OSX</span> <span class="number">10.15</span>, tvOS <span class="number">13.0</span>, watchOS <span class="number">6.0</span>, *)</span><br><span class="line">@propertyWrapper @dynamicMemberLookup <span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">Binding</span>&lt;<span class="title">Value</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// The transaction used for any changes to the binding's value.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> transaction: <span class="type">Transaction</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Initializes from functions to read and write the value.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">init</span>(<span class="keyword">get</span>: @escaping () -&gt; <span class="type">Value</span>, <span class="keyword">set</span>: @escaping (<span class="type">Value</span>) -&gt; <span class="type">Void</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Initializes from functions to read and write the value.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">init</span>(<span class="keyword">get</span>: @escaping () -&gt; <span class="type">Value</span>, <span class="keyword">set</span>: @escaping (<span class="type">Value</span>, <span class="type">Transaction</span>) -&gt; <span class="type">Void</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Creates a binding with an immutable `value`.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">constant</span><span class="params">(<span class="number">_</span> value: Value)</span></span> -&gt; <span class="type">Binding</span>&lt;<span class="type">Value</span>&gt;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// The value referenced by the binding. Assignments to the value</span></span><br><span class="line">    <span class="comment">/// will be immediately visible on reading (assuming the binding</span></span><br><span class="line">    <span class="comment">/// represents a mutable location), but the view changes they cause</span></span><br><span class="line">    <span class="comment">/// may be processed asynchronously to the assignment.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> wrappedValue: <span class="type">Value</span> &#123; <span class="keyword">get</span> <span class="keyword">nonmutating</span> <span class="keyword">set</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// The binding value, as "unwrapped" by accessing `$foo` on a `@Binding` property.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> projectedValue: <span class="type">Binding</span>&lt;<span class="type">Value</span>&gt; &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Creates a new `Binding` focused on `Subject` using a key path.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">subscript</span>&lt;<span class="type">Subject</span>&gt;(dynamicMember keyPath: <span class="type">WritableKeyPath</span>&lt;<span class="type">Value</span>, <span class="type">Subject</span>&gt;) -&gt; <span class="type">Binding</span>&lt;<span class="type">Subject</span>&gt; &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Read-more"><a href="#Read-more" class="headerlink" title="Read more"></a>Read more</h2><ul>
<li><a href="https://www.freecodecamp.org/news/get-pro-with-react-setstate-in-10-minutes-d38251d1c781/">https://www.freecodecamp.org/news/get-pro-with-react-setstate-in-10-minutes-d38251d1c781/</a></li>
<li><a href="https://stackoverflow.com/questions/56551131/what-does-the-dollar-sign-do-in-this-example">https://stackoverflow.com/questions/56551131/what-does-the-dollar-sign-do-in-this-example</a></li>
<li><a href="https://stackoverflow.com/questions/44037611/how-to-avoid-setstate-inside-render-when-state-depends-on-render?rq=1">https://stackoverflow.com/questions/44037611/how-to-avoid-setstate-inside-render-when-state-depends-on-render?rq=1</a></li>
<li><a href="https://stackoverflow.com/questions/57459727/why-an-observedobject-array-is-not-updated-in-my-swiftui-application">https://stackoverflow.com/questions/57459727/why-an-observedobject-array-is-not-updated-in-my-swiftui-application</a></li>
<li><a href="https://www.pointfree.co/blog/posts/30-swiftui-and-state-management-corrections">https://www.pointfree.co/blog/posts/30-swiftui-and-state-management-corrections</a></li>
<li><a href="https://www.hackingwithswift.com/quick-start/swiftui/whats-the-difference-between-observedobject-state-and-environmentobject">https://www.hackingwithswift.com/quick-start/swiftui/whats-the-difference-between-observedobject-state-and-environmentobject</a></li>
<li><a href="https://swiftui-lab.com/state-changes/">Safely Updating The View State</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-11-02T21:02:33.000Z" title="2019-11-02T21:02:33.000Z">2019-11-02</time><span class="level-item">a few seconds read (About 56 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-show-loading-indicator-in-SwiftUI/">How to show loading indicator in SwiftUI</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/486">#486</a></strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ActivityIndicator</span>: <span class="title">UIViewRepresentable</span> </span>&#123;</span><br><span class="line">    @<span class="type">Binding</span> <span class="keyword">var</span> isAnimating: <span class="type">Bool</span></span><br><span class="line">    <span class="keyword">let</span> style: <span class="type">UIActivityIndicatorView</span>.<span class="type">Style</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">makeUIView</span><span class="params">(context: UIViewRepresentableContext&lt;ActivityIndicator&gt;)</span></span> -&gt; <span class="type">UIActivityIndicatorView</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">UIActivityIndicatorView</span>(style: style)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">updateUIView</span><span class="params">(<span class="number">_</span> uiView: UIActivityIndicatorView, context: UIViewRepresentableContext&lt;ActivityIndicator&gt;)</span></span> &#123;</span><br><span class="line">        isAnimating ? uiView.startAnimating() : uiView.stopAnimating()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ActivityIndicator_Previews</span>: <span class="title">PreviewProvider</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ActivityIndicator</span>(isAnimating: .constant(<span class="literal">true</span>), style: .large)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-11-02T20:41:52.000Z" title="2019-11-02T20:41:52.000Z">2019-11-02</time><span class="level-item">4 minutes read (About 664 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-show-image-picker-in-SwiftUI/">How to show image picker in SwiftUI</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/485">#485</a></strong></p>
<p>The easiest way to show image picker in iOS is to use <code>UIImagePickerController</code>, and we can bridge that to SwiftUI via <code>UIViewControllerRepresentable</code></p>
<h2 id="First-attempt-use-Environment"><a href="#First-attempt-use-Environment" class="headerlink" title="First attempt, use Environment"></a>First attempt, use Environment</h2><p>We conform to <code>UIViewControllerRepresentable</code> and make a Coordinator, which is the recommended way to manage the bridging with <code>UIViewController</code>.</p>
<p>There’s some built in environment property we can use, one of those is <code>presentationMode</code> where we can call <code>dismiss</code> to dismiss the modal.</p>
<p>My first attempt looks like below</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">ImagePicker</span>: <span class="title">UIViewControllerRepresentable</span> </span>&#123;</span><br><span class="line">    @<span class="type">Environment</span>(\.presentationMode) <span class="keyword">private</span> <span class="keyword">var</span> presentationMode</span><br><span class="line">    @<span class="type">Binding</span> <span class="keyword">var</span> image: <span class="type">UIImage?</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">makeCoordinator</span><span class="params">()</span></span> -&gt; <span class="type">ImagePicker</span>.<span class="type">Coordinator</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">ImagePicker</span>.<span class="type">Coordinator</span>(</span><br><span class="line">            presentationMode: presentationMode,</span><br><span class="line">            image: $image</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">makeUIViewController</span><span class="params">(context: UIViewControllerRepresentableContext&lt;ImagePicker&gt;)</span></span> -&gt; <span class="type">UIImagePickerController</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> controller = <span class="type">UIImagePickerController</span>()</span><br><span class="line">        controller.delegate = context.coordinator</span><br><span class="line">        <span class="keyword">return</span> controller</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">updateUIViewController</span><span class="params">(<span class="number">_</span> uiViewController: UIImagePickerController, context: UIViewControllerRepresentableContext&lt;ImagePicker&gt;)</span></span> &#123;</span><br><span class="line">        <span class="comment">// No op</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">extension</span> <span class="title">ImagePicker</span> </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Coordinator</span>: <span class="title">NSObject</span>, <span class="title">UINavigationControllerDelegate</span> </span>&#123;</span><br><span class="line">        @<span class="type">Binding</span> <span class="keyword">var</span> presentationMode: <span class="type">PresentationMode</span></span><br><span class="line">        @<span class="type">Binding</span> <span class="keyword">var</span> image: <span class="type">UIImage?</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">init</span>(presentationMode: <span class="type">Binding</span>&lt;<span class="type">PresentationMode</span>&gt;, image: <span class="type">Binding</span>&lt;<span class="type">UIImage?</span>&gt;) &#123;</span><br><span class="line">            <span class="keyword">self</span>._presentationMode = presentationMode</span><br><span class="line">            <span class="keyword">self</span>._image = image</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">ImagePicker</span>.<span class="title">Coordinator</span>: <span class="title">UIImagePickerControllerDelegate</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">imagePickerController</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="number">_</span> picker: UIImagePickerController,</span></span></span><br><span class="line"><span class="function"><span class="params">        didFinishPickingMediaWithInfo info: [UIImagePickerController.InfoKey: <span class="keyword">Any</span>])</span></span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.image = info[<span class="type">UIImagePickerController</span>.<span class="type">InfoKey</span>.originalImage] <span class="keyword">as</span>? <span class="type">UIImage</span></span><br><span class="line">        presentationMode.dismiss()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">imagePickerControllerDidCancel</span><span class="params">(<span class="number">_</span> picker: UIImagePickerController)</span></span> &#123;</span><br><span class="line">        presentationMode.dismiss()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Signatures"><a href="#Signatures" class="headerlink" title="Signatures"></a>Signatures</h3><p>We need to be aware of the types of these property wrappers</p>
<p>Where we declare environment, <code>presentationMode</code> is of type <code>Binding&lt;PresentationMode&gt;</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@<span class="type">Environment</span>(\.presentationMode) <span class="keyword">private</span> <span class="keyword">var</span> presentationMode</span><br></pre></td></tr></table></figure>

<p>Given a Binding declaration, for example <code>@Binding var image: UIImage?</code>, <code>image</code> is of type <code>UIImage?</code> but <code>$image</code> is <code>Binding&lt;UIImage?&gt;</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">makeCoordinator</span><span class="params">()</span></span> -&gt; <span class="type">ImagePicker</span>.<span class="type">Coordinator</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">ImagePicker</span>.<span class="type">Coordinator</span>(</span><br><span class="line">        image: $image,</span><br><span class="line">        isPresented: $isPresented</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>When we want to assign to variables in <code>init</code>, we use <code>_image</code> to use mutable <code>Binding&lt;UIImage?&gt;</code> because <code>self.$image</code> gives us immutable <code>Binding&lt;UIImage?&gt;</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Coordinator</span>: <span class="title">NSObject</span>, <span class="title">UINavigationControllerDelegate</span> </span>&#123;</span><br><span class="line">    @<span class="type">Binding</span> <span class="keyword">var</span> presentationMode: <span class="type">PresentationMode</span></span><br><span class="line">    @<span class="type">Binding</span> <span class="keyword">var</span> image: <span class="type">UIImage?</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">init</span>(presentationMode: <span class="type">Binding</span>&lt;<span class="type">PresentationMode</span>&gt;, image: <span class="type">Binding</span>&lt;<span class="type">UIImage?</span>&gt;) &#123;</span><br><span class="line">        <span class="keyword">self</span>._presentationMode = presentationMode</span><br><span class="line">        <span class="keyword">self</span>._image = image</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="How-to-use"><a href="#How-to-use" class="headerlink" title="How to use"></a>How to use</h3><p>To show modal, we use <code>sheet</code> and use a state <code>@State var showImagePicker: Bool = false</code> to control its  presentation</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Button</span>(action: &#123;</span><br><span class="line">    <span class="keyword">self</span>.showImagePicker.toggle()</span><br><span class="line">&#125;, label: &#123;</span><br><span class="line">    <span class="type">Text</span>(<span class="string">"Choose image"</span>)</span><br><span class="line">&#125;)</span><br><span class="line">.sheet(isPresented: $showImagePicker, content: &#123;</span><br><span class="line">    <span class="type">ImagePicker</span>(image: <span class="keyword">self</span>.$image)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="Environment-outside-body"><a href="#Environment-outside-body" class="headerlink" title="Environment outside body"></a>Environment outside body</h3><p>If we run the above code, it will crash because of we access environment value <code>presentationMode</code> in <code>makeCoordinator</code> and this is outside <code>body</code></p>
<blockquote>
<p>Fatal error: Reading Environment&lt;Binding<PresentationMode>&gt; outside View.body</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">makeCoordinator</span><span class="params">()</span></span> -&gt; <span class="type">ImagePicker</span>.<span class="type">Coordinator</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">ImagePicker</span>.<span class="type">Coordinator</span>(</span><br><span class="line">        presentationMode: presentationMode,</span><br><span class="line">        image: $image</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Second-attempt-pass-closure"><a href="#Second-attempt-pass-closure" class="headerlink" title="Second attempt, pass closure"></a>Second attempt, pass closure</h2><p>So instead of passing environment <code>presentationMode</code>, we can pass closure, just like in React where we pass functions to child component.</p>
<p>So <code>ImagePicker</code> can just accept a closure called <code>onDone</code>, and the component that uses it can do the dismissal.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Button</span>(action: &#123;</span><br><span class="line">    <span class="keyword">self</span>.showImagePicker.toggle()</span><br><span class="line">&#125;, label: &#123;</span><br><span class="line">    <span class="type">Text</span>(<span class="string">"Choose image"</span>)</span><br><span class="line">&#125;)</span><br><span class="line">.sheet(isPresented: $showImagePicker, content: &#123;</span><br><span class="line">    <span class="type">ImagePicker</span>(image: <span class="keyword">self</span>.$image, onDone: &#123;</span><br><span class="line">        <span class="keyword">self</span>.presentationMode.wrappedValue.dismiss()</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>Unfortunately, although the <code>onDone</code> gets called, the modal is not dismissed.</p>
<h2 id="Use-Binding-instead-of-Environment"><a href="#Use-Binding-instead-of-Environment" class="headerlink" title="Use Binding instead of Environment"></a>Use Binding instead of Environment</h2><p>Maybe there are betters way, but we can use Binding to replace usage of Environment.</p>
<p>We can do that by accepting <code>Binding</code> and change the <code>isPresented</code> state</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">ImagePicker</span>: <span class="title">UIViewControllerRepresentable</span> </span>&#123;</span><br><span class="line">    @<span class="type">Binding</span> <span class="keyword">var</span> image: <span class="type">UIImage?</span></span><br><span class="line">    @<span class="type">Binding</span> <span class="keyword">var</span> isPresented: <span class="type">Bool</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">makeCoordinator</span><span class="params">()</span></span> -&gt; <span class="type">ImagePicker</span>.<span class="type">Coordinator</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">ImagePicker</span>.<span class="type">Coordinator</span>(</span><br><span class="line">            image: $image,</span><br><span class="line">            isPresented: $isPresented</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">makeUIViewController</span><span class="params">(context: UIViewControllerRepresentableContext&lt;ImagePicker&gt;)</span></span> -&gt; <span class="type">UIImagePickerController</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> controller = <span class="type">UIImagePickerController</span>()</span><br><span class="line">        controller.delegate = context.coordinator</span><br><span class="line">        <span class="keyword">return</span> controller</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">updateUIViewController</span><span class="params">(<span class="number">_</span> uiViewController: UIImagePickerController, context: UIViewControllerRepresentableContext&lt;ImagePicker&gt;)</span></span> &#123;</span><br><span class="line">        <span class="comment">// No op</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">extension</span> <span class="title">ImagePicker</span> </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Coordinator</span>: <span class="title">NSObject</span>, <span class="title">UINavigationControllerDelegate</span> </span>&#123;</span><br><span class="line">        @<span class="type">Binding</span> <span class="keyword">var</span> isPresented: <span class="type">Bool</span></span><br><span class="line">        @<span class="type">Binding</span> <span class="keyword">var</span> image: <span class="type">UIImage?</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">init</span>(image: <span class="type">Binding</span>&lt;<span class="type">UIImage?</span>&gt;, isPresented: <span class="type">Binding</span>&lt;<span class="type">Bool</span>&gt;) &#123;</span><br><span class="line">            <span class="keyword">self</span>._image = image</span><br><span class="line">            <span class="keyword">self</span>._isPresented = isPresented</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">ImagePicker</span>.<span class="title">Coordinator</span>: <span class="title">UIImagePickerControllerDelegate</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">imagePickerController</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="number">_</span> picker: UIImagePickerController,</span></span></span><br><span class="line"><span class="function"><span class="params">        didFinishPickingMediaWithInfo info: [UIImagePickerController.InfoKey: <span class="keyword">Any</span>])</span></span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.image = info[<span class="type">UIImagePickerController</span>.<span class="type">InfoKey</span>.originalImage] <span class="keyword">as</span>? <span class="type">UIImage</span></span><br><span class="line">        isPresented = <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">imagePickerControllerDidCancel</span><span class="params">(<span class="number">_</span> picker: UIImagePickerController)</span></span> &#123;</span><br><span class="line">        isPresented = <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>How to use it</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Button</span>(action: &#123;</span><br><span class="line">    <span class="keyword">self</span>.showImagePicker.toggle()</span><br><span class="line">&#125;, label: &#123;</span><br><span class="line">    <span class="type">Text</span>(<span class="string">"Choose image"</span>)</span><br><span class="line">&#125;)</span><br><span class="line">.sheet(isPresented: $showImagePicker, content: &#123;</span><br><span class="line">    <span class="type">ImagePicker</span>(image: <span class="keyword">self</span>.$image, isPresented: <span class="keyword">self</span>.$showImagePicker)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="Pass-ImagePicker-to-Coordinator"><a href="#Pass-ImagePicker-to-Coordinator" class="headerlink" title="Pass ImagePicker to Coordinator"></a>Pass ImagePicker to Coordinator</h2><ul>
<li><a href="https://www.youtube.com/watch?v=Ek_r-7aRp3A">Using coordinators to manage SwiftUI view controllers</a></li>
</ul>
<p>So that we can call <code>parent.presentationMode.wrappedValue.dismiss()</code></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-10-31T11:15:42.000Z" title="2019-10-31T11:15:42.000Z">2019-10-31</time><span class="level-item">a few seconds read (About 58 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-use-array-of-strings-in-ForEach-in-SwiftUI/">How to use array of strings in ForEach in SwiftUI</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/483">#483</a></strong></p>
<p>Every item in list must be uniquely identifiable</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">List</span> &#123;</span><br><span class="line">    <span class="type">ForEach</span>(books, id: \.bookId) &#123; book <span class="keyword">in</span></span><br><span class="line">        <span class="type">NavigationLink</span>(destination:</span><br><span class="line">            <span class="type">BookView</span>(book: book)</span><br><span class="line">                .navigationBarTitle(book.name)</span><br><span class="line">        ) &#123;</span><br><span class="line">            <span class="type">VStack</span> &#123;</span><br><span class="line">                <span class="type">Text</span>(book.name)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In case of primitive, we can just provide <code>id</code> to conform to <code>Identifiable</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">String</span>: <span class="title">Identifiable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> id: <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-10-31T10:24:54.000Z" title="2019-10-31T10:24:54.000Z">2019-10-31</time><span class="level-item">a few seconds read (About 66 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-make-multiline-Text-in-SwiftUI-in-watchOS/">How to make multiline Text in SwiftUI in watchOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/482">#482</a></strong></p>
<p><code>lineLimit</code> does not seem to work, use <a href="https://developer.apple.com/documentation/swiftui/group/3284808-fixedsize">fixedSize</a> instead</p>
<blockquote>
<p>Fixes this view at its ideal size.</p>
</blockquote>
<blockquote>
<p>A view that fixes this view at its ideal size in the dimensions given in fixedDimensions.</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Text</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">styleText</span><span class="params">()</span></span> -&gt; some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span></span><br><span class="line">            .font(.footnote)</span><br><span class="line">            .foregroundColor(.gray)</span><br><span class="line">            .lineLimit(<span class="number">10</span>)</span><br><span class="line">            .fixedSize(horizontal: <span class="literal">false</span>, vertical: <span class="literal">true</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-10-17T07:01:27.000Z" title="2019-10-17T07:01:27.000Z">2019-10-17</time><span class="level-item">2 minutes read (About 239 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-reload-data-without-using-onAppear-in-SwiftUI-in-watchOS/">How to reload data without using onAppear in SwiftUI in watchOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/468">#468</a></strong></p>
<p>From <a href="https://developer.apple.com/documentation/swiftui/text/3276931-onappear">onAppeear</a></p>
<blockquote>
<p>Adds an action to perform when the view appears.</p>
</blockquote>
<p>In theory, this should be triggered every time this view appears. But in practice, it is only called when it is pushed on navigation stack, not when we return to it.</p>
<p>So if user goes to a bookmark in a bookmark list, unbookmark an item and go back to the bookmark list, <code>onAppear</code> is not called again and the list is not updated.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">BookmarksView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> service: <span class="type">Service</span></span><br><span class="line">    @<span class="type">State</span> <span class="keyword">var</span> items: [<span class="type">AnyItem</span>]</span><br><span class="line">    @<span class="type">EnvironmentObject</span> <span class="keyword">var</span> storeContainer: <span class="type">StoreContainer</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">List</span>(items)  &#123; item <span class="keyword">in</span></span><br><span class="line">            makeItemRow(item: item)</span><br><span class="line">                .padding([.top, .bottom], <span class="number">4</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        .onAppear(perform: &#123;</span><br><span class="line">            <span class="keyword">self</span>.items = storeContainer.bookmarks(service: service).<span class="built_in">map</span>(&#123; <span class="type">AnyItem</span>(item: $<span class="number">0</span>) &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>So instead of relying on UI state, we should rely on data state, by listening to <code>onReceive</code> and update our local <code>@State</code> </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">BookmarksView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> service: <span class="type">Service</span></span><br><span class="line">    @<span class="type">State</span> <span class="keyword">var</span> items: [<span class="type">AnyItem</span>]</span><br><span class="line">    @<span class="type">EnvironmentObject</span> <span class="keyword">var</span> storeContainer: <span class="type">StoreContainer</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">List</span>(items)  &#123; item <span class="keyword">in</span></span><br><span class="line">            makeItemRow(item: item)</span><br><span class="line">                .padding([.top, .bottom], <span class="number">4</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        .onAppear(perform: &#123;</span><br><span class="line">            <span class="keyword">self</span>.reload()</span><br><span class="line">        &#125;)</span><br><span class="line">        .onReceive(storeContainer.objectWillChange, perform: &#123; <span class="number">_</span> <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">self</span>.reload()</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">reload</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.items = storeContainer.bookmarks(service: service).<span class="built_in">map</span>(&#123; <span class="type">AnyItem</span>(item: $<span class="number">0</span>) &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Inside our <code>ObservableObject</code>, we need to trigger changes notification</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">StoreContainer</span>: <span class="title">ObservableObject</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> objectWillChange = <span class="type">PassthroughSubject</span>&lt;(), <span class="type">Never</span>&gt;()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">bookmark</span><span class="params">(item: ItemProtocol)</span></span> &#123;</span><br><span class="line">        <span class="keyword">defer</span> &#123;</span><br><span class="line">            objectWillChange.send(())</span><br><span class="line">        &#125;        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">unbookmark</span><span class="params">(item: ItemProtocol)</span></span> &#123;</span><br><span class="line">        <span class="keyword">defer</span> &#123;</span><br><span class="line">            objectWillChange.send(())</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<p><strong>Updated at</strong> 2020-10-03 10:43:47</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-10-17T06:03:56.000Z" title="2019-10-17T06:03:56.000Z">2019-10-17</time><span class="level-item">a minute read (About 188 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-use-EnvironmentObject-in-SwiftUI-for-watchOS/">How to use EnvironmentObject in SwiftUI for watchOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/467">#467</a></strong></p>
<p>Declare top dependencies in ExtensionDelegate</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ExtensionDelegate</span>: <span class="title">NSObject</span>, <span class="title">WKExtensionDelegate</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> storeContainer = <span class="type">StoreContainer</span>()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">applicationDidEnterBackground</span><span class="params">()</span></span> &#123;</span><br><span class="line">        storeContainer.save()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Reference that in <code>HostingController</code>. Note that we need to change from generic <code>MainView</code> to <code>WKHostingController&lt;AnyView&gt;</code> as <code>environmentObject</code> returns <code>View</code> protocol</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HostingController</span>: <span class="title">WKHostingController</span>&lt;<span class="title">AnyView</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> storeContainer: <span class="type">StoreContainer!</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">awake</span><span class="params">(withContext context: <span class="keyword">Any</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.awake(withContext: context)</span><br><span class="line">        <span class="keyword">self</span>.storeContainer = (<span class="type">WKExtension</span>.shared().delegate <span class="keyword">as</span>! <span class="type">ExtensionDelegate</span>).storeContainer</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">var</span> body: <span class="type">AnyView</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">AnyView</span>(<span class="type">MainView</span>()</span><br><span class="line">            .environmentObject(storeContainer)</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In theory, the environment object will be propagated down the view hierarchy, but in practice it throws error. So a workaround now is to just pass that environment object down manually</p>
<blockquote>
<p>Fatal error: No ObservableObject of type SomeType found<br>A View.environmentObject(_:) for StoreContainer.Type may be missing as an ancestor of this view</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">MainView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    @<span class="type">EnvironmentObject</span> <span class="keyword">var</span> storeContainer: <span class="type">StoreContainer</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">List</span>(services.<span class="built_in">map</span>(&#123; <span class="type">AnyService</span>($<span class="number">0</span>) &#125;)) &#123; anyService <span class="keyword">in</span></span><br><span class="line">                <span class="type">NavigationLink</span>(destination:</span><br><span class="line">                    <span class="type">ItemsView</span>(service: anyService.service)</span><br><span class="line">                        .navigationBarTitle(anyService.service.name)</span><br><span class="line">                        .onDisappear(perform: &#123;</span><br><span class="line">                            anyService.service.requestCancellable?.cancel()</span><br><span class="line">                        &#125;)</span><br><span class="line">                        .environmentObject(storeContainer)</span><br><span class="line">                ) &#123;</span><br><span class="line">                    <span class="type">HStack</span> &#123;</span><br><span class="line">                        <span class="type">Image</span>(anyService.service.name)</span><br><span class="line">                            .resizable()</span><br><span class="line">                            .frame(width: <span class="number">30</span>, height: <span class="number">30</span>, alignment: .leading)</span><br><span class="line">                        <span class="type">Text</span>(anyService.service.name)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;.listStyle(<span class="type">CarouselListStyle</span>())</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<p><strong>Updated at</strong> 2020-06-26 03:54:01</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-10-09T06:28:41.000Z" title="2019-10-09T06:28:41.000Z">2019-10-09</time><span class="level-item">a minute read (About 217 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-make-container-view-in-SwiftUI/">How to make container view in SwiftUI</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/450">#450</a></strong></p>
<p>Following the signatures of <code>ScrollView</code> and <code>Group</code>, we can create our own container</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">ScrollView</span>&lt;<span class="title">Content</span>&gt; : <span class="title">View</span> <span class="title">where</span> <span class="title">Content</span> : <span class="title">View</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// The content of the scroll view.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> content: <span class="type">Content</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Group</span> : <span class="title">View</span> <span class="title">where</span> <span class="title">Content</span> : <span class="title">View</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// The type of view representing the body of this view.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// When you create a custom view, Swift infers this type from your</span></span><br><span class="line">    <span class="comment">/// implementation of the required `body` property.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">typealias</span> <span class="type">Body</span> = <span class="type">Never</span></span><br><span class="line"></span><br><span class="line">    @inlinable <span class="keyword">public</span> <span class="keyword">init</span>(@<span class="type">ViewBuilder</span> content: () -&gt; <span class="type">Content</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>For example, below is a <code>FullWidth</code> that encapsulate a child element and make it full width</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">FullWidth</span>&lt;<span class="title">Content</span>&gt;: <span class="title">View</span> <span class="title">where</span> <span class="title">Content</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> content: <span class="type">Content</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">GeometryReader</span> &#123; geometry <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">self</span>.content</span><br><span class="line">                .frame(width: geometry.size.width, height: geometry.size.width, alignment: .center)</span><br><span class="line">                .padding(.bottom, geometry.size.width)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @inlinable <span class="keyword">public</span> <span class="keyword">init</span>(@<span class="type">ViewBuilder</span> content: () -&gt; <span class="type">Content</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.content = content()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">FullWidth_Previews</span>: <span class="title">PreviewProvider</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">FullWidth</span> &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">""</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>One problem with <code>GeometryReader</code> is that the size of the children can’t affect the size of its container. We need  to apply Geometry at the root level</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> body: some <span class="type">View</span> &#123;</span><br><span class="line">    <span class="type">GeometryReader</span> &#123; geometry <span class="keyword">in</span></span><br><span class="line">        <span class="type">ScrollView</span> &#123;</span><br><span class="line">            <span class="type">VStack</span>(alignment: .leading, spacing: <span class="number">8</span>) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">"title"</span>)</span><br><span class="line">                <span class="type">RemoteImage</span>(url: <span class="keyword">self</span>.item.url)</span><br><span class="line">                    .frame(width: geometry.size.width, height: geometry.size.height, alignment: .center)</span><br><span class="line">                <span class="type">Text</span>(<span class="string">"footer"</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-10-08T11:41:16.000Z" title="2019-10-08T11:41:16.000Z">2019-10-08</time><span class="level-item">a few seconds read (About 102 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-show-web-content-as-QR-code-in-SwiftUI-in-watchOS/">How to show web content as QR code in SwiftUI in watchOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/449">#449</a></strong></p>
<p><code>WatchKit</code> does not have Web component, despite the fact that we can view web content</p>
<ul>
<li><a href="https://www.imore.com/how-view-web-pages-apple-watch-watchos-5">https://www.imore.com/how-view-web-pages-apple-watch-watchos-5</a></li>
</ul>
<p>A workaround is to show url as QR code</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">QRCodeView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> title: <span class="type">String</span></span><br><span class="line">    <span class="keyword">let</span> url: <span class="type">URL</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">GeometryReader</span> &#123; geometry <span class="keyword">in</span></span><br><span class="line">            <span class="type">VStack</span> &#123;</span><br><span class="line">                <span class="keyword">self</span>.makeImage(size: geometry.size)</span><br><span class="line">                    .padding(.top, <span class="number">10</span>)</span><br><span class="line">                <span class="type">Text</span>(<span class="string">"Scan to open"</span>)</span><br><span class="line">                    .font(.system(.footnote))</span><br><span class="line">            &#125;.navigationBarTitle(<span class="keyword">self</span>.title)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">makeImage</span><span class="params">(size: CGSize)</span></span> -&gt; some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> value = size.height - <span class="number">30</span></span><br><span class="line">        <span class="keyword">return</span> <span class="type">RemoteImage</span>(url: <span class="keyword">self</span>.url)</span><br><span class="line">            .frame(width: value, height: value, alignment: .center)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-10-08T11:37:48.000Z" title="2019-10-08T11:37:48.000Z">2019-10-08</time><span class="level-item">a minute read (About 194 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-load-remote-image-in-SwiftUI/">How to load remote image in SwiftUI</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/448">#448</a></strong></p>
<p>Use <code>ObservableObject</code> and <code>onReceive</code> to receive event. <code>URLSession.dataTask</code> reports in background queue, so need to <code>.receive(on: RunLoop.main)</code> to receive events on main queue.</p>
<p>For better dependency injection, need to use <code>ImageLoader</code> from <a href="https://developer.apple.com/documentation/swiftui/environment">Environment</a></p>
<p>There should be a way to propagate event from <code>Publisher</code> to another <code>Publisher</code>, for now we use <code>sink</code></p>
<p><code>ImageLoader.swift</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Combine</span><br><span class="line"><span class="keyword">import</span> WatchKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ImageLoader</span>: <span class="title">ObservableObject</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> cancellable: <span class="type">AnyCancellable?</span></span><br><span class="line">    <span class="keyword">let</span> objectWillChange = <span class="type">PassthroughSubject</span>&lt;<span class="type">UIImage?</span>, <span class="type">Never</span>&gt;()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">load</span><span class="params">(url: URL)</span></span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.cancellable = <span class="type">URLSession</span>.shared</span><br><span class="line">            .dataTaskPublisher(<span class="keyword">for</span>: url)</span><br><span class="line">            .<span class="built_in">map</span>(&#123; $<span class="number">0</span>.data &#125;)</span><br><span class="line">            .eraseToAnyPublisher()</span><br><span class="line">            .receive(on: <span class="type">RunLoop</span>.main)</span><br><span class="line">            .<span class="built_in">map</span>(&#123; <span class="type">UIImage</span>(data: $<span class="number">0</span>) &#125;)</span><br><span class="line">            .replaceError(with: <span class="literal">nil</span>)</span><br><span class="line">            .sink(receiveValue: &#123; image <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">self</span>.objectWillChange.send(image)</span><br><span class="line">            &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">cancel</span><span class="params">()</span></span> &#123;</span><br><span class="line">        cancellable?.cancel()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>RemoteImage.swift</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> WatchKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">RemoteImage</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> url: <span class="type">URL</span></span><br><span class="line">    <span class="keyword">let</span> imageLoader = <span class="type">ImageLoader</span>()</span><br><span class="line">    @<span class="type">State</span> <span class="keyword">var</span> image: <span class="type">UIImage?</span> = <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Group</span> &#123;</span><br><span class="line">            makeContent()</span><br><span class="line">        &#125;</span><br><span class="line">        .onReceive(imageLoader.objectWillChange, perform: &#123; image <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">self</span>.image = image</span><br><span class="line">        &#125;)</span><br><span class="line">        .onAppear(perform: &#123;</span><br><span class="line">            <span class="keyword">self</span>.imageLoader.load(url: <span class="keyword">self</span>.url)</span><br><span class="line">        &#125;)</span><br><span class="line">        .onDisappear(perform: &#123;</span><br><span class="line">            <span class="keyword">self</span>.imageLoader.cancel()</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">makeContent</span><span class="params">()</span></span> -&gt; some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> image = image &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="type">AnyView</span>(</span><br><span class="line">                <span class="type">Image</span>(uiImage: image)</span><br><span class="line">                    .resizable()</span><br><span class="line">                    .aspectRatio(contentMode: .fit)</span><br><span class="line">            )</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="type">AnyView</span>(<span class="type">Text</span>(<span class="string">"😢"</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-10-08T11:35:51.000Z" title="2019-10-08T11:35:51.000Z">2019-10-08</time><span class="level-item">a minute read (About 136 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-do-navigation-in-SwiftUI-in-watchOS/">How to do navigation in SwiftUI in watchOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/447">#447</a></strong></p>
<p><a href="https://developer.apple.com/documentation/swiftui/navigationview">NavigationView</a> is not available on <code>WatchKit</code>, but we can just use <code>NavigationLink</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">List</span>(services.<span class="built_in">map</span>(&#123; <span class="type">AnyService</span>($<span class="number">0</span>) &#125;)) &#123; anyService <span class="keyword">in</span></span><br><span class="line">    <span class="type">NavigationLink</span>(destination:</span><br><span class="line">        <span class="type">ItemsView</span>(service: anyService.service)</span><br><span class="line">            .navigationBarTitle(anyService.service.name)</span><br><span class="line">            .onDisappear(perform: &#123;</span><br><span class="line">                anyService.service.requestCancellable?.cancel()</span><br><span class="line">            &#125;)</span><br><span class="line">    ) &#123;</span><br><span class="line">        <span class="type">HStack</span> &#123;</span><br><span class="line">            <span class="type">Image</span>(anyService.service.name)</span><br><span class="line">                .resizable()</span><br><span class="line">                .frame(width: <span class="number">30</span>, height: <span class="number">30</span>, alignment: .leading)</span><br><span class="line">            <span class="type">Text</span>(anyService.service.name)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Adding <code>NavigationLink</code> to a View adds a round shadow cropping effect, which is usually not want we want. </p>
<p>But we shouldn’t wrap <code>Button</code> as <code>Button</code> handles its own touch event, plus it has double shadow effect.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">NavigationLink</span>(destination:</span><br><span class="line">    <span class="type">QRCodeView</span>(title: item.title, url: item.url)</span><br><span class="line">) &#123;</span><br><span class="line">    <span class="type">Button</span>(action: &#123;&#125;) &#123;</span><br><span class="line">         <span class="type">Text</span>(<span class="string">"Open"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Just use Text and it’s good to go</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">NavigationLink</span>(destination:</span><br><span class="line">    <span class="type">QRCodeView</span>(title: item.title, url: item.url)</span><br><span class="line">) &#123;</span><br><span class="line">    <span class="type">Text</span>(<span class="string">"Open"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-10-07T12:08:38.000Z" title="2019-10-07T12:08:38.000Z">2019-10-07</time><span class="level-item">a minute read (About 221 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-use-protocol-in-List-in-SwiftUI/">How to use protocol in List in SwiftUI</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/446">#446</a></strong></p>
<p>Suppose we have Service protocol, and want to use in List</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Service</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">MainView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> services = [</span><br><span class="line">        <span class="type">Car</span>()</span><br><span class="line">        <span class="type">Plane</span>()</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">List</span>(services) &#123; service <span class="keyword">in</span></span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="type">Image</span>(service.name)</span><br><span class="line">                <span class="type">Text</span>(service.name)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This is not possible because item in List needs to conform to <code>Identifiable</code></p>
<blockquote>
<p>Protocol type ‘Service’ cannot conform to ‘Identifiable’ because only concrete types can conform to protocols</p>
</blockquote>
<h2 id="Type-eraser"><a href="#Type-eraser" class="headerlink" title="Type eraser"></a>Type eraser</h2><p>In the same way that SwiftUI uses type eraser, for example <code>AnyView</code>, we can introduce <code>AnyService</code> to work around this</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> body: some <span class="type">View</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> useImage &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">AnyView</span>(<span class="type">Image</span>(<span class="string">"my image"</span>))</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">AnyView</span>(<span class="type">Text</span>(<span class="string">"my text"</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Make AnyService conform to <code>Identifiable</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">AnyService</span>: <span class="title">Identifiable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> id: <span class="type">String</span></span><br><span class="line">    <span class="keyword">let</span> service: <span class="type">Service</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(<span class="number">_</span> service: <span class="type">Service</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.service = service</span><br><span class="line">        <span class="keyword">self</span>.id = service.name</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Then in our View, we just need to declare services wrapped inside AnyService</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">MainView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> services = [</span><br><span class="line">        <span class="type">AnyService</span>(<span class="type">Car</span>()),</span><br><span class="line">        <span class="type">AnyService</span>(<span class="type">Plane</span>())</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">List</span>(services) &#123; anyService <span class="keyword">in</span></span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="type">Image</span>(anyService.service.name)</span><br><span class="line">                <span class="type">Text</span>(anyService.service.name)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>A bit refactoring, we can just declare normal services and map them</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">MainView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> services: [<span class="type">Service</span>] = [</span><br><span class="line">        <span class="type">Car</span>(),</span><br><span class="line">        <span class="type">Plane</span>()</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">List</span>(services.<span class="built_in">map</span>(&#123; <span class="type">AnyService</span>($<span class="number">0</span> &#125;)) &#123; anyService <span class="keyword">in</span></span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="type">Image</span>(anyService.service.name)</span><br><span class="line">                <span class="type">Text</span>(anyService.service.name)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><nav class="pagination is-centered mt-4" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/tags/swiftUI/page/3/">Previous</a></div><div class="pagination-next is-invisible is-hidden-mobile"><a href="/tags/swiftUI/page/5/">Next</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/tags/swiftUI/">1</a></li><li><a class="pagination-link" href="/tags/swiftUI/page/2/">2</a></li><li><a class="pagination-link" href="/tags/swiftUI/page/3/">3</a></li><li><a class="pagination-link is-current" href="/tags/swiftUI/page/4/">4</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="" src="https://avatars1.githubusercontent.com/u/2284279?s=460&amp;v=4" alt="onmyway133"></figure><p class="title is-size-4 is-block line-height-inherit">onmyway133</p><p class="is-size-6 is-block">iOS, macOS, Android, React. Serial maker. Writer. Speaker.</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Oslo, Norway</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">733</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">54</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/onmyway133" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/onmyway133"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com/onmyway133"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile is-mobile" href="https://onmyway133.com/apps" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Apps</span></span><span class="level-right"><span class="level-item tag">onmyway133.com</span></span></a></li><li><a class="level is-mobile is-mobile" href="https://learntalks.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Learn Talks</span></span><span class="level-right"><span class="level-item tag">learntalks.com</span></span></a></li><li><a class="level is-mobile is-mobile" href="https://wwdctogether.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">WWDC Together</span></span><span class="level-right"><span class="level-item tag">wwdctogether.com</span></span></a></li></ul></div></div></div><!--!--><div class="card widget"><div class="card-content"><h3 class="menu-label">Recent</h3><article class="media"><div class="media-content size-small"><p><time dateTime="2021-02-28T21:15:24.000Z">2021-02-28</time></p><p class="title is-6"><a class="link-muted" href="/blog/How-to-use-with-block-configure-in-Swift/">How to use with block configure in Swift</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2021-02-26T12:14:41.000Z">2021-02-26</time></p><p class="title is-6"><a class="link-muted" href="/blog/How-to-use-Core-Data/">How to use Core Data</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2021-02-26T08:09:09.000Z">2021-02-26</time></p><p class="title is-6"><a class="link-muted" href="/blog/How-to-force-resolve-Swift-Package-in-Xcode/">How to force resolve Swift Package in Xcode</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2021-02-25T21:42:08.000Z">2021-02-25</time></p><p class="title is-6"><a class="link-muted" href="/blog/How-to-listen-to-remote-changes-in-CloudKit-CoreData/">How to listen to remote changes in CloudKit CoreData</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2021-02-25T20:56:27.000Z">2021-02-25</time></p><p class="title is-6"><a class="link-muted" href="/blog/How-to-listen-to-Published-outside-of-SwiftUI-view/">How to listen to Published outside of SwiftUI view</a></p><p class="is-uppercase"></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/archives/2021/02/"><span class="level-start"><span class="level-item">February 2021</span></span><span class="level-end"><span class="level-item tag">20</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2021/01/"><span class="level-start"><span class="level-item">January 2021</span></span><span class="level-end"><span class="level-item tag">32</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/12/"><span class="level-start"><span class="level-item">December 2020</span></span><span class="level-end"><span class="level-item tag">29</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/11/"><span class="level-start"><span class="level-item">November 2020</span></span><span class="level-end"><span class="level-item tag">15</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/10/"><span class="level-start"><span class="level-item">October 2020</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/09/"><span class="level-start"><span class="level-item">September 2020</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/08/"><span class="level-start"><span class="level-item">August 2020</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/06/"><span class="level-start"><span class="level-item">June 2020</span></span><span class="level-end"><span class="level-item tag">14</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/05/"><span class="level-start"><span class="level-item">May 2020</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/04/"><span class="level-start"><span class="level-item">April 2020</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/03/"><span class="level-start"><span class="level-item">March 2020</span></span><span class="level-end"><span class="level-item tag">21</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/02/"><span class="level-start"><span class="level-item">February 2020</span></span><span class="level-end"><span class="level-item tag">20</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/01/"><span class="level-start"><span class="level-item">January 2020</span></span><span class="level-end"><span class="level-item tag">31</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/12/"><span class="level-start"><span class="level-item">December 2019</span></span><span class="level-end"><span class="level-item tag">36</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/11/"><span class="level-start"><span class="level-item">November 2019</span></span><span class="level-end"><span class="level-item tag">38</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/10/"><span class="level-start"><span class="level-item">October 2019</span></span><span class="level-end"><span class="level-item tag">49</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/09/"><span class="level-start"><span class="level-item">September 2019</span></span><span class="level-end"><span class="level-item tag">50</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/08/"><span class="level-start"><span class="level-item">August 2019</span></span><span class="level-end"><span class="level-item tag">39</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/07/"><span class="level-start"><span class="level-item">July 2019</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/06/"><span class="level-start"><span class="level-item">June 2019</span></span><span class="level-end"><span class="level-item tag">41</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/05/"><span class="level-start"><span class="level-item">May 2019</span></span><span class="level-end"><span class="level-item tag">50</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/04/"><span class="level-start"><span class="level-item">April 2019</span></span><span class="level-end"><span class="level-item tag">27</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/03/"><span class="level-start"><span class="level-item">March 2019</span></span><span class="level-end"><span class="level-item tag">24</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/02/"><span class="level-start"><span class="level-item">February 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/12/"><span class="level-start"><span class="level-item">December 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/05/"><span class="level-start"><span class="level-item">May 2018</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/04/"><span class="level-start"><span class="level-item">April 2018</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/02/"><span class="level-start"><span class="level-item">February 2018</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/01/"><span class="level-start"><span class="level-item">January 2018</span></span><span class="level-end"><span class="level-item tag">14</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/12/"><span class="level-start"><span class="level-item">December 2017</span></span><span class="level-end"><span class="level-item tag">14</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/11/"><span class="level-start"><span class="level-item">November 2017</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/10/"><span class="level-start"><span class="level-item">October 2017</span></span><span class="level-end"><span class="level-item tag">18</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/09/"><span class="level-start"><span class="level-item">September 2017</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/08/"><span class="level-start"><span class="level-item">August 2017</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/07/"><span class="level-start"><span class="level-item">July 2017</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/06/"><span class="level-start"><span class="level-item">June 2017</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/05/"><span class="level-start"><span class="level-item">May 2017</span></span><span class="level-end"><span class="level-item tag">35</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/04/"><span class="level-start"><span class="level-item">April 2017</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/algorithm/"><span class="tag">algorithm</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/android/"><span class="tag">android</span><span class="tag is-grey-lightest">34</span></a></div><div class="control"><a class="tags has-addons" href="/tags/apple-script/"><span class="tag">apple script</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/catalyst/"><span class="tag">catalyst</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ci/"><span class="tag">ci</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cloud/"><span class="tag">cloud</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cocoapods/"><span class="tag">cocoapods</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/combine/"><span class="tag">combine</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/core-data/"><span class="tag">core data</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/csharp/"><span class="tag">csharp</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/css/"><span class="tag">css</span><span class="tag is-grey-lightest">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/dart/"><span class="tag">dart</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/database/"><span class="tag">database</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/design/"><span class="tag">design</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/electron/"><span class="tag">electron</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/featured/"><span class="tag">featured</span><span class="tag is-grey-lightest">10</span></a></div><div class="control"><a class="tags has-addons" href="/tags/firebase/"><span class="tag">firebase</span><span class="tag is-grey-lightest">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/flutter/"><span class="tag">flutter</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/git/"><span class="tag">git</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/github/"><span class="tag">github</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/go/"><span class="tag">go</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/google/"><span class="tag">google</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/iOS/"><span class="tag">iOS</span><span class="tag is-grey-lightest">174</span></a></div><div class="control"><a class="tags has-addons" href="/tags/javascript/"><span class="tag">javascript</span><span class="tag is-grey-lightest">51</span></a></div><div class="control"><a class="tags has-addons" href="/tags/kotlin/"><span class="tag">kotlin</span><span class="tag is-grey-lightest">27</span></a></div><div class="control"><a class="tags has-addons" href="/tags/layout/"><span class="tag">layout</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/life/"><span class="tag">life</span><span class="tag is-grey-lightest">14</span></a></div><div class="control"><a class="tags has-addons" href="/tags/links/"><span class="tag">links</span><span class="tag is-grey-lightest">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/macOS/"><span class="tag">macOS</span><span class="tag is-grey-lightest">137</span></a></div><div class="control"><a class="tags has-addons" href="/tags/machine-learning/"><span class="tag">machine learning</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/maps/"><span class="tag">maps</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/networking/"><span class="tag">networking</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/node/"><span class="tag">node</span><span class="tag is-grey-lightest">13</span></a></div><div class="control"><a class="tags has-addons" href="/tags/objc/"><span class="tag">objc</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/react/"><span class="tag">react</span><span class="tag is-grey-lightest">24</span></a></div><div class="control"><a class="tags has-addons" href="/tags/react-native/"><span class="tag">react native</span><span class="tag is-grey-lightest">14</span></a></div><div class="control"><a class="tags has-addons" href="/tags/realm/"><span class="tag">realm</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/rx/"><span class="tag">rx</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/script/"><span class="tag">script</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/spm/"><span class="tag">spm</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/swift/"><span class="tag">swift</span><span class="tag is-grey-lightest">364</span></a></div><div class="control"><a class="tags has-addons" href="/tags/swiftUI/"><span class="tag">swiftUI</span><span class="tag is-grey-lightest">103</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tech/"><span class="tag">tech</span><span class="tag is-grey-lightest">14</span></a></div><div class="control"><a class="tags has-addons" href="/tags/terminal/"><span class="tag">terminal</span><span class="tag is-grey-lightest">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/testing/"><span class="tag">testing</span><span class="tag is-grey-lightest">17</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tool/"><span class="tag">tool</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tweet/"><span class="tag">tweet</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/unity/"><span class="tag">unity</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/voip/"><span class="tag">voip</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/watchOS/"><span class="tag">watchOS</span><span class="tag is-grey-lightest">11</span></a></div><div class="control"><a class="tags has-addons" href="/tags/web/"><span class="tag">web</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/work/"><span class="tag">work</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/wwdc/"><span class="tag">wwdc</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/xcode/"><span class="tag">xcode</span><span class="tag is-grey-lightest">25</span></a></div></div></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Subscribe to Updates</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=c2r59mmt2n5k0o5dt5vv3nq4u4&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="c2r59mmt2n5k0o5dt5vv3nq4u4" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button is-primary" type="submit" value="Subscribe"></div></div></form></div></div></div><div class="card widget"><div class="card-content"><div class="notification is-danger">You need to set <code>client_id</code> and <code>slot_id</code> to show this AD unit. Please set it in <code>_config.yml</code>.</div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/z.png" alt="onmyway133" height="28"></a><p class="size-small"><span>&copy; 2021 Khoa Pham</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/onmyway133"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            site: {
                url: 'https://onmyway133.github.io',
                external_link: {"enable":true,"exclude":[]}
            },
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to Top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>