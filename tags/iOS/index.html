<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="generator" content="Hexo 4.2.0"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Tag: iOS - onmyway133</title><meta description="What you don&amp;#39;t know is what you haven&amp;#39;t learned"><meta property="og:type" content="blog"><meta property="og:title" content="onmyway133"><meta property="og:url" content="https://onmyway133.github.io/"><meta property="og:site_name" content="onmyway133"><meta property="og:description" content="What you don&amp;#39;t know is what you haven&amp;#39;t learned"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://onmyway133.github.io/img/og_image.png"><meta property="article:author" content="Khoa Pham"><meta property="article:tag" content="ios"><meta property="article:tag" content=" android"><meta property="article:tag" content="javascript"><meta property="article:tag" content=" react"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><meta property="twitter:creator" content="@onmyway133"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://onmyway133.github.io"},"headline":"onmyway133","image":["https://onmyway133.github.io/img/og_image.png"],"author":{"@type":"Person","name":"Khoa Pham"},"description":"What you don&#39;t know is what you haven&#39;t learned"}</script><link rel="alternative" href="/atom.xml" title="onmyway133" type="application/atom+xml"><link rel="icon" href="/img/favicon.ico"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=UA-40119591-5" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'UA-40119591-5');</script><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><script data-ad-client="ca-pub-3656459401405265" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" async></script></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/z.png" alt="onmyway133" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/apps">Apps</a><a class="navbar-item" href="/gumroad">Gumroad</a><a class="navbar-item" href="/about">About</a><a class="navbar-item" href="/opensource">Open Source</a><a class="navbar-item" href="/writing">Writing</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/speaking">Speaking</a><a class="navbar-item" href="/news">News</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/onmyway133"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/tags">Tags</a></li><li class="is-active"><a href="#" aria-current="page">iOS</a></li></ul></nav></div></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2021-01-07T08:25:52.000Z" title="2021-01-07T08:25:52.000Z">2021-01-07</time><span class="level-item">a few seconds read (About 111 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-check-app-going-to-background-in-SwiftUI/">How to check app going to background in SwiftUI</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/746">#746</a></strong></p>
<p>From iOS 13, the default is to support multiple scene, so the the old UIApplicationDelegate lifecycle does not work. Double check your <code>Info.plist</code> for <code>UIApplicationSceneManifest</code> key</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">key</span>&gt;</span>UIApplicationSceneManifest<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>UIApplicationSupportsMultipleScenes<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">true</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>One way to be notified about application life cycle is to use <code>UIApplicationDelegateAdaptor</code> and via <code>NotificationCenter</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> FontAwesomeSwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">AppDelegate</span>: <span class="title">NSObject</span>, <span class="title">UIApplicationDelegate</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">application</span><span class="params">(<span class="number">_</span> application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey : <span class="keyword">Any</span>]? = <span class="literal">nil</span>)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="type">FontAwesome</span>.register()</span><br><span class="line">        <span class="type">PreferenceManager</span>.shared.load()</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@main</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">MyAwesomeApp</span>: <span class="title">App</span> </span>&#123;</span><br><span class="line">    @<span class="type">UIApplicationDelegateAdaptor</span>(<span class="type">AppDelegate</span>.<span class="keyword">self</span>)</span><br><span class="line">    <span class="keyword">var</span> appDelegate</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: some <span class="type">Scene</span> &#123;</span><br><span class="line">        <span class="type">WindowGroup</span> &#123;</span><br><span class="line">            <span class="type">MainView</span>(store: <span class="type">Store</span>.shared)</span><br><span class="line">                .onReceive(</span><br><span class="line">                    <span class="type">NotificationCenter</span>.<span class="keyword">default</span>.publisher(</span><br><span class="line">                        <span class="keyword">for</span>: <span class="type">UIApplication</span>.didEnterBackgroundNotification)) &#123; <span class="number">_</span> <span class="keyword">in</span></span><br><span class="line">                    <span class="type">PreferenceManager</span>.shared.save()</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2021-01-05T06:07:53.000Z" title="2021-01-05T06:07:53.000Z">2021-01-05</time><span class="level-item">28 minutes read (About 4150 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-make-Auto-Layout-more-convenient-in-iOS/">How to make Auto Layout more convenient in iOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/742">#742</a></strong></p>
<p>Auto Layout has been around since macOS 10.7 and iOS 6.0 as a nicer way to do layouts over the old resizing masks. Besides some rare cases when we need to manually specify origins and sizes, Auto Layout is the preferred way to do declarative layouts whether we choose to do UI in code or Storyboard. The Auto Layout APIs have some improvements over the years, there are also some sugar libraries that add easy syntaxes, so more choices for developers.</p>
<p>In this article, let’s take a review of how layout has improved over the years, from manual layout, autoresizing masks and finally to Auto Layout. I will mention a few takes on some libraries and how to abstract Auto Layout using the builder pattern. There are also some notes about the view life cycle and APIs improvements that might be overlooked. These are of course based on my experience and varies because of personal tastes but I hope you‘ll find something useful.</p>
<p>Although the article mention iOS, the same learning applies to watchOS, tvOS and macOS too. </p>
<h2 id="Positioning-a-view-before-Auto-Layout"><a href="#Positioning-a-view-before-Auto-Layout" class="headerlink" title="Positioning a view before Auto Layout"></a>Positioning a view before Auto Layout</h2><p>When I first started iOS programming in early 2014, I read a book about Auto Layout and that book detailed lots of scenarios that completely confused me. It didn’t take long until I tried Auto Layout in an app and I realized it w as so simple. In its simplest sense, a view needs a position and a size to be correctly shown on the screen, everything else is just extra. In Auto Layout’s term, we need to specify enough constraints to position and size the view.</p>
<h3 id="Manual-layout-using-CGRect"><a href="#Manual-layout-using-CGRect" class="headerlink" title="Manual layout using CGRect"></a>Manual layout using CGRect</h3><p>If we take a look back at the way we do a manual layout with the frame, there are origins and sizes. For example, here is how to position a red box that stretches accordingly with the width of the view controller.</p>
<p><img src="https://cdn-images-1.medium.com/max/2336/1*ScTtKYui6Ml0z0ocYR9uDA.png" alt=""></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> box = <span class="type">UIView</span>()</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        </span><br><span class="line">        box.backgroundColor = <span class="type">UIColor</span>.red</span><br><span class="line">        view.addSubview(box)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLayoutSubviews</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLayoutSubviews()</span><br><span class="line">        </span><br><span class="line">        box.frame = <span class="type">CGRect</span>(x: <span class="number">20</span>, y: <span class="number">50</span>, width: view.frame.size.width - <span class="number">40</span>, height: <span class="number">100</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>viewDidLoad is called when the view property of view controller is loaded, we need to wait until viewDidLayoutSubviews so that we have access to the final bounds. When the bounds change for a view controller’s view, the view adjusts the positions of its subviews and then the system calls this method.</p>
<h3 id="Why-is-view-size-correct-in-viewDidLoad"><a href="#Why-is-view-size-correct-in-viewDidLoad" class="headerlink" title="Why is view size correct in viewDidLoad"></a>Why is view size correct in viewDidLoad</h3><p>viewDidLoad is definitely not the recommended way to do manual layout but there are times we still see that its view is correctly sized and fills the screen. This is when we need to read <a href="https://developer.apple.com/documentation/uikit/uiviewcontroller">View Management</a> in UIViewController more thoroughly:</p>
<blockquote>
<p>Each view controller manages a view hierarchy, the root view of which is stored in the <a href="https://developer.apple.com/documentation/uikit/uiviewcontroller/1621460-view">*view</a>*property of this class. The root view acts primarily as a container for the rest of the view hierarchy. The size and position of the root view is determined by the object that owns it, which is either a parent view controller or the app’s window. The view controller that is owned by the window is the app’s root view controller and its view is sized to fill the window.<br>A view controller’s root view is always sized to fit its assigned space.</p>
</blockquote>
<p>It can also be that the view has fixed size in xib or storyboard but we should control the size explicitly and do that in the right view controller method to avoid unexpected behaviors.</p>
<h3 id="Autoresizing-masks"><a href="#Autoresizing-masks" class="headerlink" title="Autoresizing masks"></a>Autoresizing masks</h3><p><img src="https://cdn-images-1.medium.com/max/2000/1*yn3czZbudyVVlr-a3J1l9A.png" alt=""></p>
<p>Autoresizing mask was the old way to make layout a bit more declarative, also called <em>springs and struts</em> layout system. It is integer bit mask that determines how the receiver resizes itself when its superview’s bounds change. Combining these constants lets you specify which dimensions of the view should grow or shrink relative to the superview. The default value of this property is none, which indicates that the view should not be resized at all.</p>
<p>While we can specify which edges we want to fix and which should be flexible, it is confusing in the ways we do in xib and in code.</p>
<p>In the above screenshot, we pin the top of the red box to the top of the screen, and that is fixed distance. When the view changes size, the width and height of the red box changes proportionally, but the top spacing remains fixed.</p>
<p>In code, instead of specifying autoresizing in terms of fixed distance, we use flexible terms to specify which edges should be flexible.</p>
<p>To achieve the same red box on the top of the screen, we need to specify a flexible width and a flexible bottom margin. This means the left, right and top edges are fixed.</p>
<pre><code>box.autoresizingMask = [.flexibleWidth, .flexibleBottomMargin]</code></pre><p>Here are a few more scenarios</p>
<ul>
<li><p>Horizontally fixed distance from the left: [.flexibleRightMargin]</p>
</li>
<li><p>Center horizontally [.flexibleLeftMargin, .flexibleRightMargin]</p>
</li>
<li><p>Vertically fixed distance from the top: [.flexibleBottomMargin]</p>
</li>
<li><p>Center vertically [.flexibleTopMargin, .flexibleBottomMargin]</p>
</li>
</ul>
<p>These are not very intuitive and the way these are scaled proportionally may not fit our expectation. Also, note that multiple options can be done on the same axis.</p>
<blockquote>
<p>When more than one option along the same axis is set, the default behavior is to distribute the size difference proportionally among the flexible portions. The larger the flexible portion, relative to the other flexible portions, the more it is likely to grow. For example, suppose this property includes the <a href="apple-reference-documentation://hsNSe_v1m3">flexibleWidth</a> and <a href="apple-reference-documentation://hsW_P6WgME">flexibleRightMargin</a>constants but does not include the <em>flexibleLeftMargin</em> constant, thus indicating that the width of the view’s left margin is fixed but that the view’s width and right margin may change.</p>
</blockquote>
<p>Understanding of autoresizing masks won’t waste your time, we will come back to it in a few minutes 😉</p>
<h2 id="Auto-Layout-to-the-rescue"><a href="#Auto-Layout-to-the-rescue" class="headerlink" title="Auto Layout to the rescue"></a>Auto Layout to the rescue</h2><p>Auto Layout, together with dynamic text and size classes, are recommended ways to build <a href="https://developer.apple.com/design/adaptivity/">adaptive user interfaces</a> as there the number of iOS devices with different screen sizes grows.</p>
<h3 id="A-constraint-based-layout-system"><a href="#A-constraint-based-layout-system" class="headerlink" title="A constraint-based layout system"></a>A constraint-based layout system</h3><p>Auto Layout is described via <a href="https://developer.apple.com/documentation/uikit/nslayoutconstraint">NSLayoutConstraint</a> by defining constraints between 2 objects. Here is the simple formula to remember:</p>
<pre><code>item1.attribute1 = multiplier × item2.attribute2 + constant</code></pre><p>Here is how to replicate that red box with NSLayoutConstraint. We need to specify which property of which view should be connected to another property of another view. Auto Layout supports many attributes such ascenterX, centerY and topMargin.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> marginTop = <span class="type">NSLayoutConstraint</span>(item: box, attribute: .top, relatedBy: .<span class="built_in">equal</span>, toItem: view, attribute: .top, multiplier: <span class="number">1.0</span>, constant: <span class="number">50</span>)</span><br><span class="line"><span class="keyword">let</span> marginLeft = <span class="type">NSLayoutConstraint</span>(item: box, attribute: .<span class="keyword">left</span>, relatedBy: .<span class="built_in">equal</span>, toItem: view, attribute: .<span class="keyword">left</span>, multiplier: <span class="number">1.0</span>, constant: <span class="number">20</span>)</span><br><span class="line"><span class="keyword">let</span> marginRight = <span class="type">NSLayoutConstraint</span>(item: box, attribute: .<span class="keyword">right</span>, relatedBy: .<span class="built_in">equal</span>, toItem: view, attribute: .<span class="keyword">right</span>, multiplier: <span class="number">1.0</span>, constant: -<span class="number">20</span>)</span><br><span class="line"><span class="keyword">let</span> height = <span class="type">NSLayoutConstraint</span>(item: box, attribute: .height, relatedBy: .<span class="built_in">equal</span>, toItem: <span class="literal">nil</span>, attribute: .notAnAttribute, multiplier: <span class="number">1.0</span>, constant: <span class="number">100</span>)</span><br><span class="line"><span class="type">NSLayoutConstraint</span>.activate([marginTop, marginLeft, marginRight, height])</span><br></pre></td></tr></table></figure>

<h3 id="translatesAutoresizingMaskIntoConstraints"><a href="#translatesAutoresizingMaskIntoConstraints" class="headerlink" title="translatesAutoresizingMaskIntoConstraints"></a>translatesAutoresizingMaskIntoConstraints</h3><p>If we run the above code, we will get into the popular warning message regarding translatesAutoresizingMaskIntoConstraints</p>
<pre><code>[LayoutConstraints] Unable to simultaneously satisfy constraints.
 Probably at least one of the constraints in the following list is one you don&apos;t want. 
 Try this: 
  (1) look at each constraint and try to figure out which you don&apos;t expect; 
  (2) find the code that added the unwanted constraint or constraints and fix it. 
 (Note: If you&apos;re seeing NSAutoresizingMaskLayoutConstraints that you don&apos;t understand, refer to the documentation for the UIView property translatesAutoresizingMaskIntoConstraints) 
(
    &quot;&lt;NSAutoresizingMaskLayoutConstraint:0x600003ef2300 h=--&amp; v=--&amp; UIView:0x7fb66c5059f0.midX == 0   (active)&gt;&quot;,
    &quot;&lt;NSLayoutConstraint:0x600003e94b90 H:|-(20)-[UIView:0x7fb66c5059f0](LTR)   (active, names: &apos;|&apos;:UIView:0x7fb66c50bce0 )&gt;&quot;
)</code></pre><p>If you need some help deciphering this, there is <a href="https://www.wtfautolayout.com/">wtfautolayout</a> that does a good job on explaining what’s really happening.</p>
<p><img src="https://cdn-images-1.medium.com/max/3884/1*6bzhDTPpCUhitq4GbTVAmw.png" alt=""></p>
<p>It is said that resizing masks has been reimplemented using Auto Layout under the hood, and there is always NSAutoresizingMaskLayoutConstraint added to the view, hence the midX constraint.</p>
<p>We should never mix resizing masks and Auto Layout to avoid unwanted behavior, the fix is simply to disable translatesAutoresizingMaskIntoConstraints</p>
<pre><code>box.translatesAutoresizingMaskIntoConstraints = false</code></pre><p>This property is false by default for views from xib or storyboard but holds true if we declare layout in code. The intention is for the system to create a set of constraints that duplicate the behavior specified by the view’s autoresizing mask. This also lets you modify the view’s size and location using the view’s frame, bounds, or center properties, allowing you to create a static, frame-based layout within Auto Layout.</p>
<h3 id="Visual-Format-Language"><a href="#Visual-Format-Language" class="headerlink" title="Visual Format Language"></a>Visual Format Language</h3><p>The Visual Format Language lets you use ASCII-art like strings to define your constraints. I see it is used in some code bases so it’s good to know it.</p>
<p>Here is how to recreate the red box using VFL. We need to specify constraints for both horizontal and vertical direction. Note that the same format string may result in multiple constraints:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> views = [<span class="string">"box"</span> : box]</span><br><span class="line"><span class="keyword">let</span> horizontal = <span class="string">"H:|-20-[box]-20-|"</span></span><br><span class="line"><span class="keyword">let</span> vertical = <span class="string">"V:|-50-[box(100)]"</span></span><br><span class="line"><span class="keyword">let</span> horizontalConstraints = <span class="type">NSLayoutConstraint</span>.constraints(withVisualFormat: horioptions: [], metrics: <span class="literal">nil</span>, views: views)</span><br><span class="line"><span class="keyword">let</span> verticalConstraints = <span class="type">NSLayoutConstraint</span>.constraints(withVisualFormat: veoptions: [], metrics: <span class="literal">nil</span>, views: views)</span><br><span class="line"><span class="type">NSLayoutConstraint</span>.activate([horizontalConstraints, verticalConstraints].flatMap(&#123; $<span class="number">0</span> &#125;))</span><br></pre></td></tr></table></figure>

<p>Visual Format Language is a bit nicer than the verbose NSLayoutConstraint initializer, but it encourages string format, which is error-prone.</p>
<h3 id="addConstraint-and-activate"><a href="#addConstraint-and-activate" class="headerlink" title="addConstraint and activate"></a>addConstraint and activate</h3><p>This may seem trivial but I see in modern code bases, there is still usage of addConstraint . This was old and hard to use, as we must find the nearest common ancestor view of the 2 views that envolve in Auto Layout.</p>
<p>Starting from iOS 8, there is isActive and the static activate functions that ease this adding constraints process a lot. Basically what it does is to activate or deactivate the constraint with calls to<a href="apple-reference-documentation://hs6gkFVJuz">addConstraint(_:)</a> and <a href="apple-reference-documentation://hsYzji4l8L">removeConstraint(_:)</a> on the view that is the closest common ancestor of the items managed by this constraint.</p>
<h3 id="NSLayoutAnchor"><a href="#NSLayoutAnchor" class="headerlink" title="NSLayoutAnchor"></a>NSLayoutAnchor</h3><p>Starting with macOS 10.11 and iOS 9, there was NSLayoutAnchor that simplifies Auto Layout a lot. Auto Layout was declarative, but a bit verbose, now it is simpler than ever with an anchoring system.</p>
<p>Here is how to achieve that same red box</p>
<pre><code>NSLayoutConstraint.activate([
    box.topAnchor.constraint(equalTo: view.topAnchor, constant: 50),
    box.leftAnchor.constraint(equalTo: view.leftAnchor, constant: 20),
    box.rightAnchor.constraint(equalTo: view.rightAnchor, constant: -20),
    box.heightAnchor.constraint(equalToConstant: 100)
])</code></pre><p>The cool thing about NSLayoutAnchor is its generic constrained API design. Constraints are divided into X-axis, Y-axis and dimension anchor type that makes it hard to make mistakes.</p>
<pre><code>open class NSLayoutXAxisAnchor : NSLayoutAnchor&lt;NSLayoutXAxisAnchor&gt;
open class NSLayoutDimension : NSLayoutAnchor&lt;NSLayoutDimension&gt;</code></pre><p>For example, we can’t pin the top anchor to the left anchor as they are in different axis, and it makes no sense. Attempt to do the following results in compilation issue as Swift strong type system ensures correctness.</p>
<pre><code>box.topAnchor.constraint(equalTo: view.leftAnchor, constant: 50),</code></pre><h3 id="Ambiguous-error-message-with-NSLayoutAnchor"><a href="#Ambiguous-error-message-with-NSLayoutAnchor" class="headerlink" title="Ambiguous error message with NSLayoutAnchor"></a>Ambiguous error message with NSLayoutAnchor</h3><p>I’ve gone into a few cases where the error messages from NSLayoutAnchor don’t help. If we mistakenly connect topAnchor with centerXAnchor, which are not possible as they are from different axes.</p>
<pre><code>NSLayoutConstraint.activate([
    box.topAnchor.constraint(equalTo: view.centerXAnchor, constant: 50)
])</code></pre><p>Xcode complains of unwrapped UIView problem which may confuse us even more.</p>
<pre><code>Value of optional type &apos;UIView?&apos; must be unwrapped to refer to member &apos;centerXAnchor&apos; of wrapped base type &apos;UIView&apos;</code></pre><p>Another puzzle, regarding this code</p>
<pre><code>NSLayoutConstraint.activate([
    imageView.centerYAnchor.constraint(equalTo: view.centerYAnchor),
    imageView.leftAnchor.constraint(equalTo: view.leftAnchor, constant: 8),
    imageView.heightAnchor.constraint(equalToConstant: view.heightAnchor, mult0.7),
    imageView.widthAnchor.constraint(equalTo: imageView.heightAnchor, multiplier: 1.0)
])</code></pre><p>Xcode is complaining about ‘Int’ is not convertible to ‘CGFloat’ which is very misleading. Can you spot the error?</p>
<p>The problem is that we are using equalToConstant , not equalTo . The generic constraints of NSLayoutAnchor is giving us misleading errors and can waste lots of time of us trying to figure out the subtle typos.</p>
<h2 id="Abstractions-over-Auto-Layout"><a href="#Abstractions-over-Auto-Layout" class="headerlink" title="Abstractions over Auto Layout"></a>Abstractions over Auto Layout</h2><p>NSLayoutAnchor is getting more popular now but it is not without any flaws. Depending on personal taste, there might be some other forms of abstractions over Auto Layout, namely Cartography and SnapKit, which I ‘ve used and loved. Here are a few of my takes on those.</p>
<h3 id="Cartography"><a href="#Cartography" class="headerlink" title="Cartography"></a>Cartography</h3><p><a href="https://github.com/robb/Cartography">Cartography</a> is one of the most popular ways to do Auto Layout in iOS. It uses operators which makes constraints very clear:</p>
<pre><code>constrain(button1, button2) { button1, button2 in
    button1.right == button2.left - 12
}</code></pre><p>What I don’t like about Cartography is that we have to repeat parameter names and that the parameters inside closure are just proxies, not real views and there is a limit on the number of constrain items.</p>
<p>Another huge con was that long compilation time issue due to excessive use of operators <a href="https://github.com/robb/Cartography/issues/215">Very long compile time in large functions</a>. Although Swift compilation time is getting better, this was a big problem. I even had to write a script to remove Cartography to use simple NSLayoutAnchor, so take a look at <a href="https://gist.github.com/onmyway133/c486939f82fc4d3a8ed4be21538fdd32">AutoLayoutConverter</a>, which converts Cartography code from</p>
<pre><code>constrain(logoImnageView, view1, view2) { logoImageView, view1, view2 in
    logoImageView.with == 74
    view1.left == view2.left + 20
}</code></pre><p>to simple NSLayoutAnchor</p>
<pre><code>Constraint.on(
  logoImageView.widthAnchor.constraint(equalToConstant: 74),
  view1.leftAnchor.constraint(equalTo: view2.leftAnchor, constant: 20),
)</code></pre><p>There are always tradeoffs but to reduce compilation time at the time was a top priority.</p>
<h3 id="SnapKit"><a href="#SnapKit" class="headerlink" title="SnapKit"></a>SnapKit</h3><p><a href="https://github.com/SnapKit/SnapKit">SnapKit</a>, originally Masonry, is perhaps the most popular Auto Layout wrapper</p>
<pre><code>box.snp.makeConstraints { (make) -&gt; Void in
   make.width.height.equalTo(50)
   make.center.equalTo(self.view)
}</code></pre><p>The syntax is nice and with snp namespace to avoid extension name clashes, which I love.</p>
<p>The thing I don’t like about SnapKit is that limited closure. We can only work on 1 view at a time, and the make inside closure is just a proxy, which does not seem intuitive.</p>
<p>Imagine if we’re gonna make paging views or <a href="https://github.com/onmyway133/blog/issues/22">piano</a>, where each view is stacked side by side. We need a lot of SnapKit calls as we can only work on 1 view at a time. Also, there is no clear relationship where we connect with the other view.</p>
<p><img src="https://cdn-images-1.medium.com/max/3882/0*4zvVsKPnTaG5ZXgm.png" alt="[https://github.com/onmyway133/blog/issues/22](https://github.com/onmyway133/blog/issues/22)"><em><a href="https://github.com/onmyway133/blog/issues/22">https://github.com/onmyway133/blog/issues/22</a></em></p>
<pre><code>keyB.snp.makeConstraints { (make) -&gt; Void in
   make.left.equalTo(self.keyA.right)
}

keyC.snp.makeConstraints { (make) -&gt; Void in
   make.left.equalTo(self.keyB.right)
}

keyD.snp.makeConstraints { (make) -&gt; Void in
   make.left.equalTo(self.keyC.right)
}</code></pre><h3 id="The-many-overloading-functions"><a href="#The-many-overloading-functions" class="headerlink" title="The many overloading functions"></a>The many overloading functions</h3><p>There are also attempts to build simple Auto Layout wrapper functions but that escalates very quickly.</p>
<p>We might begin with an extension that pins edge constraints to superview.</p>
<pre><code>box.pinEdgesToSuperview()</code></pre><p>But a view does not always pin to its superview, it can be to another view, then we add another function</p>
<pre><code>box.pinEdgesToView(_ view: UIView)</code></pre><p>It would be nice if there is some padding, isn’t it? Let’s add insets options</p>
<pre><code>box.pinEdgesToView(_ view: UIView, insets: UIEdgeInsets)</code></pre><p>There might be cases where we only want to pin top, left, and right and not the bottom, let’s add another parameter</p>
<pre><code>box.pinEdgesToView(_ view: UIView, insets: UIEdgeInsets, exclude: NSLayoutConstraint.Attribute)</code></pre><p>Constraints are not always 1000 priorities, it can be lower. We need to support that</p>
<pre><code>box.pinEdgesToView(_ view: UIView, insets: UIEdgeInsets, exclude: NSLayoutConstraint.Attribute, priority: NSLayoutConstraint.Priority)</code></pre><p>We might exclude more than one properties or set different priority levels for each constraint. The simple wrapper with overloading functions and default parameters are just like building rigid abstraction based on premature assumptions. This just limits us in the long run and not scalable 😢</p>
<h2 id="Embracing-Auto-Layout"><a href="#Embracing-Auto-Layout" class="headerlink" title="Embracing Auto Layout"></a>Embracing Auto Layout</h2><p>All the Auto Layout frameworks out there are just convenient ways to build NSLayoutConstraint, in fact, these are what you normally need</p>
<ul>
<li><p>Call addSubview so that view is in the hierarchy</p>
</li>
<li><p>Set translatesAutoresizingMaskIntoConstraints = false</p>
</li>
<li><p>Set isActive = true to enable constraints</p>
</li>
</ul>
<p>Here is how to make an extension on NSLayoutConstraint that disables translatesAutoresizingMaskIntoConstraints for the involved views. Code is from <a href="https://github.com/onmyway133/Omnia/blob/master/Sources/iOS/NSLayoutConstraint.swift">Omnia</a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">extension</span> <span class="title">NSLayoutConstraint</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/// Disable auto resizing mask and activate constraints</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// - Parameter constraints: constraints to activate</span></span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">on</span><span class="params">(<span class="number">_</span> constraints: [NSLayoutConstraint])</span></span> &#123;</span><br><span class="line">        constraints.forEach &#123;</span><br><span class="line">            ($<span class="number">0</span>.firstItem <span class="keyword">as</span>? <span class="type">UIView</span>)?.translatesAutoresizingMaskIntoConstraints = <span class="literal">false</span></span><br><span class="line">            $<span class="number">0</span>.isActive = <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">on</span><span class="params">(<span class="number">_</span> constraintsArray: [[NSLayoutConstraint]])</span></span> &#123;</span><br><span class="line">        <span class="keyword">let</span> constraints = constraintsArray.flatMap(&#123; $<span class="number">0</span> &#125;)</span><br><span class="line">        <span class="type">NSLayoutConstraint</span>.on(constraints)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Here before we activate constraints, we find the firstItem then disables translatesAutoresizingMaskIntoConstraints. From Swift 4.2 there is a separation between compactMap and flatMap so we can safely use flatMap to flatten an array of arrays. This is useful when we have an <a href="https://github.com/onmyway133/Omnia/blob/master/Sources/iOS/UIView.swift">array of arrays</a> of constraints.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">extension</span> <span class="title">UIView</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">pinCenter</span><span class="params">(view: UIView)</span></span> -&gt; [<span class="type">NSLayoutConstraint</span>] &#123;</span><br><span class="line">        <span class="keyword">return</span> [</span><br><span class="line">            centerXAnchor.constraint(equalTo: view.centerXAnchor),</span><br><span class="line">            centerYAnchor.constraint(equalTo: view.centerYAnchor)</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">pin</span><span class="params">(size: CGSize)</span></span> -&gt; [<span class="type">NSLayoutConstraint</span>] &#123;</span><br><span class="line">        <span class="keyword">return</span> [</span><br><span class="line">            widthAnchor.constraint(equalToConstant: size.width),</span><br><span class="line">            heightAnchor.constraint(equalToConstant: size.height)</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>With that, we can pin the red box with a certain size and to the center of the screen:</p>
<pre><code>NSLayoutConstraint.on([
    box.pinCenter(view: view),
    box.pin(size: CGSize(width: 100, height: 50))
])</code></pre><p>This is a very thin but powerful wrapper over NSLayoutAnchor and we can expand it the way we need. It sadly has some problems, like we can’t easily change the priority, as we have to reference the constraint 😢</p>
<pre><code>let topConstraint = box.topAnchor.constraint(equalTo: view.topAnchor, constant: 50)
topConstraint.priority = UILayoutPriority.defaultLow

NSLayoutConstraint.on([
    topConstraint
])</code></pre><h2 id="Making-Auto-Layout-more-convenient-with-the-builder-pattern"><a href="#Making-Auto-Layout-more-convenient-with-the-builder-pattern" class="headerlink" title="Making Auto Layout more convenient with the builder pattern"></a>Making Auto Layout more convenient with the builder pattern</h2><p>The above extension on NSLayoutConstraint works well. However, if you’re like me who wants even more declarative and fast Auto Layout code, we can use the builder pattern to make Auto Layout even nicer. The builder pattern can be applied to many parts of the code but I find it very well suited for Auto Layout. The final code is <a href="https://github.com/onmyway133/Anchors">Anchors</a> on GitHub, and I will detail how to make it.</p>
<p>Here is what we want to achieve to quickly position 4 views:</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/0*bH2VP8h2rWp0pgqm.gif" alt=""></p>
<pre><code>activate(
  boxA.anchor.top.left,
  boxB.anchor.top.right,
  boxC.anchor.bottom.left,
  boxD.anchor.bottom.right
)</code></pre><p>Most of the times, we want to anchor to parent view, so that should be implicitly done for us. I like to have anchor namespace to avoid extension naming clashes and to make it the starting point for all our convenient Auto Layout code. Let’s identify a few core concepts</p>
<h3 id="Which-objects-can-interact-with-Auto-Layout"><a href="#Which-objects-can-interact-with-Auto-Layout" class="headerlink" title="Which objects can interact with Auto Layout?"></a>Which objects can interact with Auto Layout?</h3><p>Currently, there are 3 types of objects that can interact withAuto Layout</p>
<ul>
<li><p>UIView</p>
</li>
<li><p><a href="https://developer.apple.com/documentation/uikit/uilayoutsupport">UILayoutSupport</a>, from iOS 7, for UIViewController to get bottomLayoutGuide and topLayoutGuide . In iOS 11, we should use <a href="https://developer.apple.com/documentation/uikit/uiview/2891102-safearealayoutguide">safeAreaLayoutGuide</a> from UIView instead</p>
</li>
<li><p><a href="https://developer.apple.com/documentation/uikit/uilayoutguide">UILayoutGuide</a>: using invisible UIView to do Auto Layout is expensive, that’s why Apple introduced layout guides in iOS 9 to help.</p>
</li>
</ul>
<p>So to support these 3 with anchor namespace, we can make Anchor object that holds AnyObject as behind the scene, NSLayoutConstraint works with AnyObject:</p>
<pre><code>public class Anchor: ConstraintProducer {
  let item: AnyObject

/// Init with View
  convenience init(view: View) {
    self.init(item: view)
  }

/// Init with Layout Guide
  convenience init(layoutGuide: LayoutGuide) {
    self.init(item: layoutGuide)
  }

// Init with Item
  public init(item: AnyObject) {
    self.item = item
  }
}</code></pre><p>Now we can define anchor property</p>
<pre><code>public extension View {
  var anchor: Anchor {
    return Anchor(view: self)
  }
}

public extension LayoutGuide {
  var anchor: Anchor {
    return Anchor(layoutGuide: self)
  }
}</code></pre><h3 id="Which-properties-are-needed-in-a-layout-constraint"><a href="#Which-properties-are-needed-in-a-layout-constraint" class="headerlink" title="Which properties are needed in a layout constraint?"></a>Which properties are needed in a layout constraint?</h3><p>The builder patterns make building things declaratively by holding temporary values. Besides from, to, priority, identifier, we need an array of pins to handle cases where there are multiple created constraints. A center constraint results in both centerX and centerY constraints, and an edge constraint results in top, left, bottom and right constraints.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">To</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> anchor(<span class="type">Anchor</span>)</span><br><span class="line">    <span class="keyword">case</span> size</span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">none</span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pin</span> </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> attribute: <span class="type">Attribute</span></span><br><span class="line">  <span class="keyword">var</span> constant: <span class="type">CGFloa</span></span><br><span class="line">  <span class="keyword">init</span>(<span class="number">_</span> attribute:  <span class="type">Attribute</span>, constant: <span class="type">CGFloat</span> = <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">self</span>.attribute = attribute</span><br><span class="line">    <span class="keyword">self</span>.constant = constant</span><br><span class="line">  &#125;</span><br><span class="line"><span class="keyword">let</span> item: <span class="type">AnyObject</span></span><br><span class="line"><span class="comment">// key: attribute</span></span><br><span class="line"><span class="comment">// value: constant</span></span><br><span class="line"><span class="keyword">var</span> pins: [<span class="type">Pin</span>] = [</span><br><span class="line"><span class="keyword">var</span> multiplierValue: <span class="type">CGFloat</span> = <span class="number">1</span></span><br><span class="line"><span class="keyword">var</span> priorityValue: <span class="type">Float?</span></span><br><span class="line"><span class="keyword">var</span> identifierValue: <span class="type">String?</span></span><br><span class="line"><span class="keyword">var</span> referenceBlock: (([<span class="type">NSLayoutConstraint</span>]) -&gt; <span class="type">Void</span>)?</span><br><span class="line"><span class="keyword">var</span> relationValue: <span class="type">Relation</span> = .<span class="built_in">equal</span></span><br><span class="line"><span class="keyword">var</span> toValue: <span class="type">To</span> = .<span class="keyword">none</span></span><br></pre></td></tr></table></figure>

<p>With this, we can also expand our convenient anchor to support more constraints, like spacing horizontally, which adds left and right constraints with correct constants. Because as you know, in Auto Layout, for right and bottom direction, we need to use negative values:</p>
<pre><code>func paddingHorizontally(_ value: CGFloat) -&gt; Anchor {
  removeIfAny(.leading)
  removeIfAny(.trailing
  pins.append(Pin(.leading, constant: value))
  pins.append(Pin(.trailing, constant: -value)
  return self
}</code></pre><h3 id="Inferring-constraints"><a href="#Inferring-constraints" class="headerlink" title="Inferring constraints"></a>Inferring constraints</h3><p>There are times we want to infer constraints, like if we want a view’s height to double its width. Since we already have width, declaring ratio should pair the height to the width.</p>
<pre><code>box.anchor.width.constant(10)
box.anchor.height.ratio(2) // height==width*2</code></pre><p>This is easily achieved by checking our pins array</p>
<pre><code>if sourceAnchor.exists(.width) {
  return Anchor(item: sourceAnchor.item).width
    .equal
    .to(Anchor(item: sourceAnchor.item).height)
    .multiplier(ratio).constraints()
} else if sourceAnchor.exists(.height) {
  return Anchor(item: sourceAnchor.item).height
    .equal
    .to(Anchor(item: sourceAnchor.item).width)
    .multiplier(ratio).constraints()
} else {
  return []
}</code></pre><h3 id="Retrieving-a-constraint"><a href="#Retrieving-a-constraint" class="headerlink" title="Retrieving a constraint"></a>Retrieving a constraint</h3><p>I see we’re used to storing constraint property in order to change its constant later. The constraints property in UIView has enough info and it is the source of truth, so retrieving constraint from that is more preferable.</p>
<p>Here‘s how we find constraint and update that</p>
<pre><code>boxA.anchor.find(.height)?.constant = 100

// later
boxB.anchor.find(.height)?.constant = 100

// later
boxC.anchor.find(.height)?.constant = 100</code></pre><p><img src="https://cdn-images-1.medium.com/max/2000/0*1kvf_QjOnm66j8U0.gif" alt=""></p>
<p>The code to find constraint is very straightforward.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">extension</span> <span class="title">Anchor</span> </span>&#123;</span><br><span class="line"><span class="comment">/// Find a constraint based on an attribute</span></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">find</span><span class="params">(<span class="number">_</span> attribute: Attribute)</span></span> -&gt; <span class="type">NSLayoutConstraint?</span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> view = item <span class="keyword">as</span>? <span class="type">View</span> <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> constraints = view.superview?.constraints</span><br><span class="line">    <span class="keyword">if</span> attribute == .width || attribute == .height &#123;</span><br><span class="line">      constraints?.append(contentsOf: view.constraints)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> constraints?.<span class="built_in">filter</span>(&#123;</span><br><span class="line">      <span class="keyword">guard</span> $<span class="number">0</span>.firstAttribute == attribute <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">    <span class="keyword">guard</span> $<span class="number">0</span>.firstItem <span class="keyword">as</span>? <span class="type">NSObject</span> == view <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;).first</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="How-to-reset-constraints"><a href="#How-to-reset-constraints" class="headerlink" title="How to reset constraints"></a>How to reset constraints</h3><p>One of the patterns I see all over is resetting constraints in UITableViewCell or UICollectionViewCell. Depending on the state, the cell removes certain constraints and add new constraints. <a href="https://github.com/robb/Cartography">Cartography</a> does this well by using group.</p>
<pre><code>constrain(view, replace: group) { view in
    view.top  == view.superview!.top
    view.left == view.superview!.left
}</code></pre><p>If we think about it, NSLayoutConstraint is just layout instructions. It can be activated or deactivated . So if we can group constraints, we can <a href="https://developer.apple.com/documentation/uikit/nslayoutconstraint/1526955-activate">activate</a> or <a href="https://developer.apple.com/documentation/uikit/nslayoutconstraint/1526066-deactivate">deactivate</a> them as a whole.</p>
<p>Here is how to declare 4 groups of constraints, the syntax is from <a href="https://github.com/onmyway133/Anchors">Anchors</a> but this applies to NSLayoutAnchor as well since those generateNSLayoutConstraint under the hood.</p>
<pre><code>let g1 = group(box.anchor.top.left)
let g2 = group(box.anchor.top.right)
let g3 = group(box.anchor.bottom.right)
let g4 = group(box.anchor.bottom.left)</code></pre><h2 id="Where-to-go-from-here"><a href="#Where-to-go-from-here" class="headerlink" title="Where to go from here"></a>Where to go from here</h2><p>In this article, we step a bit in time into manual layout, autoresizing masks and then to the modern Auto Layout. The Auto Layout APIs have improvements over the years and are recommended way to do layout. Learning declarative layout also helps me a lot when I learn Constraint Layout in Android, flexbox in React Native or the widget layout in Flutter.</p>
<p>The post goes through the detailed implementation of how we can build more convenient Auto Layout like <a href="https://github.com/onmyway133/Anchors">Anchors</a> with the builder pattern. In the next article, let’s explore the many ways to debug Auto Layout and how to correctly do Auto Layout for different screen sizes.</p>
<p>In the meantime, let’s play <a href="https://github.com/onmyway133/Anchors">Tetris</a> in Auto Layout, because why not 😉</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/0*4Uuc-FYvpYpeNSrT.gif" alt="[https://github.com/onmyway133/Anchors](https://github.com/onmyway133/Anchors)"><em><a href="https://github.com/onmyway133/Anchors">https://github.com/onmyway133/Anchors</a></em></p>
<pre><code>activate(
  lineBlock.anchor.left.bottom
)

// later
activate(
  firstSquareBlock.anchor.left.equal.to(lineBlock.anchor.right),
  firstSquareBlock.anchor.bottom
)

// later
activate(
  secondSquareBlock.anchor.right.bottom
)</code></pre><h2 id="Read-more"><a href="#Read-more" class="headerlink" title="Read more"></a>Read more</h2><ul>
<li>I originally published on Medium <a href="https://medium.com/flawless-app-stories/how-to-make-auto-layout-more-convenient-in-ios-df3b42fed37f">https://medium.com/flawless-app-stories/how-to-make-auto-layout-more-convenient-in-ios-df3b42fed37f</a></li>
</ul>
<hr>
<p><strong>Updated at</strong> 2021-01-05 07:22:31</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-11-30T19:26:10.000Z" title="2020-11-30T19:26:10.000Z">2020-11-30</time><span class="level-item">14 minutes read (About 2040 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-convert-from-paid-to-free-with-IAP/">How to convert from paid to free with IAP</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/703">#703</a></strong></p>
<h2 id="What-is-receipt"><a href="#What-is-receipt" class="headerlink" title="What is receipt"></a>What is receipt</h2><p>Read <a href="https://stackoverflow.com/questions/45615106/when-to-refresh-a-receipt-vs-restore-purchases-in-ios">When to refresh a receipt vs restore purchases in iOS?</a></p>
<p>From iOS 7, every app downloaded from the store has a receipt (for downloading/buying the app) at <code>appStoreReceiptURL</code>. When users purchases something via In App Purchase, the content at <code>appStoreReceiptURL</code> is updated with purchases information. Most of the cases, you just need to refresh the receipt (at appStoreReceiptURL) so that you know which transactions users have made.</p>
<p><strong>Note</strong></p>
<ul>
<li>Receipt is generated and bundled with your app when user download the app, whether it is free or paid</li>
<li>When user makes IAP, receipt is updated with IAP information</li>
<li>When user downloads an app (download free, or purchase paid app), they get future updates (whether free or paid) forever.</li>
<li>Call <code>SKReceiptRefreshRequest</code> or <code>SKPaymentQueue.restoreCompletedTransactions</code> asks for Appstore credential</li>
<li>When we build the app from Xcode or download from Testflight, receipt is not bundled within the app since the app is not downloaded from AppStore. We can use <code>SKReceiptRefreshRequest</code> to download receipt from sandbox Appstore</li>
<li><code>restoreCompletedTransactions</code> updates app receipt</li>
<li>Receipt is stored locally on device, so when user uninstalls and reinstalls your app, there’s no in app purchases information, this is when you should refresh receipt or <code>restoreCompletedTransactions</code></li>
</ul>
<p>Users restore transactions to maintain access to content they’ve already purchased. For example, when they upgrade to a new phone, they don’t lose all of the items they purchased on the old phone. Include some mechanism in your app to let the user restore their purchases, such as a Restore Purchases button. Restoring purchases prompts for the user’s App Store credentials, which interrupts the flow of your app: because of this, don’t automatically restore purchases, especially not every time your app is launched.</p>
<p>In most cases, all your app needs to do is refresh its receipt and deliver the products in its receipt. The refreshed receipt contains a record of the user’s purchases in this app, on this device or any other device. However, some apps need to take an alternate approach for one of the following reasons:</p>
<ul>
<li>If you use Apple-hosted content, restoring completed transactions gives your app the transaction objects it uses to download the content. If you need to support versions of iOS earlier than iOS 7, where the app receipt isn’t available, restore completed transactions instead.</li>
<li>Refreshing the receipt asks the App Store for the latest copy of the receipt. Refreshing a receipt does not create any new transactions.</li>
<li>Restoring completed transactions creates a new transaction for every completed transaction the user made, essentially replaying history for your transaction queue observer.</li>
</ul>
<p>More about receipt, from WWDC 2017, What’s new in StoreKit session <a href="https://developer.apple.com/videos/play/wwdc2017/303/">https://developer.apple.com/videos/play/wwdc2017/303/</a></p>
<p><img src="https://user-images.githubusercontent.com/2284279/100661732-38507b00-3354-11eb-9198-104410e5ddfb.png" alt="receipt"></p>
<p>You can also watch WWDC 2017, session Advanced StoreKit for more detail <a href="https://developer.apple.com/videos/play/wwdc2017/305/">https://developer.apple.com/videos/play/wwdc2017/305/</a></p>
<p><img src="https://user-images.githubusercontent.com/2284279/100661745-3d152f00-3354-11eb-943d-9c6d9b79000d.png" alt="receipt tips"></p>
<h2 id="Restoring-Purchased-Products"><a href="#Restoring-Purchased-Products" class="headerlink" title="Restoring Purchased Products"></a>Restoring Purchased Products</h2><p>Read <a href="https://developer.apple.com/documentation/storekit/in-app_purchase/restoring_purchased_products">Restoring Purchased Products</a></p>
<blockquote>
<p>Users sometimes need to restore purchased content, such as when they upgrade to a new phone.</p>
</blockquote>
<blockquote>
<p>Don’t automatically restore purchases, especially when your app is launched. Restoring purchases prompts for the user’s App Store credentials, which interrupts the flow of your app</p>
</blockquote>
<blockquote>
<p>In most cases, you only need to refresh the app receipt and deliver the products listed on the receipt. The refreshed receipt contains a record of the user’s purchases in this app, from any device the user’s App Store account is logged into</p>
</blockquote>
<blockquote>
<p>Refreshing a receipt doesn’t create new transactions; it requests the latest copy of the receipt from the App Store</p>
</blockquote>
<blockquote>
<p>Restoring completed transactions creates a new transaction for every transaction previously completed, essentially replaying history for your transaction queue observer. Your app maintains its own state to keep track of why it’s restoring completed transactions and how to handle them.</p>
</blockquote>
<h2 id="What-are-the-different-IAP-types"><a href="#What-are-the-different-IAP-types" class="headerlink" title="What are the different IAP types"></a>What are the different IAP types</h2><p>From AppStore</p>
<h3 id="Consumable-pay-everytime"><a href="#Consumable-pay-everytime" class="headerlink" title="Consumable (pay everytime)"></a>Consumable (pay everytime)</h3><p>A consumable In-App Purchase must be purchased every time the user downloads it. One-time services, such as fish food in a fishing app, are usually implemented as consumables.</p>
<h3 id="Non-Consumable-one-time-payment"><a href="#Non-Consumable-one-time-payment" class="headerlink" title="Non-Consumable (one time payment)"></a>Non-Consumable (one time payment)</h3><p>Non-consumable In-App Purchases only need to be purchased once by users. Services that do not expire or decrease with use are usually implemented as non-consumables, such as new race tracks for a game app.</p>
<h3 id="Auto-Renewable-Subscriptions-will-deduct-money-from-your-credit-card-on-a-cycle-complete"><a href="#Auto-Renewable-Subscriptions-will-deduct-money-from-your-credit-card-on-a-cycle-complete" class="headerlink" title="Auto-Renewable Subscriptions (will deduct money from your credit card on a cycle complete)"></a>Auto-Renewable Subscriptions (will deduct money from your credit card on a cycle complete)</h3><p>Auto-renewable Subscriptions allow the user to purchase updating and dynamic content for a set duration of time. Subscriptions renew automatically unless the user opts out, such as magazine subscriptions.</p>
<h3 id="Free-Subscription-no-payment-and-is-still-visible-even-you-did-not-submitted-your-account-detail-to-itunes-connect"><a href="#Free-Subscription-no-payment-and-is-still-visible-even-you-did-not-submitted-your-account-detail-to-itunes-connect" class="headerlink" title="Free Subscription (no payment and is still visible even you did not submitted your account detail to itunes connect)"></a>Free Subscription (no payment and is still visible even you did not submitted your account detail to itunes connect)</h3><p>Free subscriptions are a way for developers to put free subscription content in Newsstand. Once a user signs up for a free subscription, it will be available on all devices associated with the user’s Apple ID. Note that free subscriptions do not expire and can only be offered in Newsstand-enabled apps.</p>
<h3 id="Non-Renewing-need-to-renew-manually"><a href="#Non-Renewing-need-to-renew-manually" class="headerlink" title="Non-Renewing (need to renew manually)"></a>Non-Renewing (need to renew manually)</h3><p>Subscription Non-Renewing Subscriptions allow the sale of services with a limited duration. Non-Renewing Subscriptions must be used for In-App Purchases that offer time-based access to static content. Examples include a one week subscription to voice guidance feature within a navigation app or an annual subscription to online catalog of archived video or audio.</p>
<h2 id="When-is-app-receipt-missing"><a href="#When-is-app-receipt-missing" class="headerlink" title="When is app receipt missing"></a>When is app receipt missing</h2><p>Read <a href="https://developer.apple.com/documentation/storekit/skreceiptrefreshrequest">SKReceiptRefreshRequest</a></p>
<blockquote>
<p>Use this API to request a new receipt if the receipt is invalid or missing</p>
</blockquote>
<p>Receipt is stored locally on device. It can be missing in case user sync or restore device.</p>
<p>Watch <a href="https://asciiwwdc.com/2014/sessions/305">WWDC 2014 - 305 Preventing Unauthorized Purchases with Receipts</a></p>
<h2 id="How-to-check-receipt-existence"><a href="#How-to-check-receipt-existence" class="headerlink" title="How to check receipt existence"></a>How to check receipt existence</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Bundle</span>.main.appStoreReceiptURL</span><br><span class="line">checkResourceIsReachable</span><br></pre></td></tr></table></figure>

<h2 id="How-to-read-receipt"><a href="#How-to-read-receipt" class="headerlink" title="How to read receipt"></a>How to read receipt</h2><p>Read <a href="https://www.raywenderlich.com/9257-in-app-purchases-receipt-validation-tutorial">In-App Purchases: Receipt Validation Tutorial</a></p>
<blockquote>
<p>The receipt consists of a single file in the app bundle. The file is in a format called PKCS #7. The payload consists of a set of receipt attributes in a cross-platform format called ASN.1</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="number">12</span>: <span class="comment">// Receipt Creation Date</span></span><br><span class="line">  <span class="keyword">var</span> dateStartPtr = ptr</span><br><span class="line">  receiptCreationDate = readASN1Date(ptr: &amp;dateStartPtr, maxLength: length)</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="number">17</span>: <span class="comment">// IAP Receipt</span></span><br><span class="line">  <span class="built_in">print</span>(<span class="string">"IAP Receipt."</span>)</span><br><span class="line">  </span><br><span class="line"><span class="keyword">case</span> <span class="number">19</span>: <span class="comment">// Original App Version</span></span><br><span class="line">  <span class="keyword">var</span> stringStartPtr = ptr</span><br><span class="line">  originalAppVersion = readASN1String(ptr: &amp;stringStartPtr, maxLength: length)</span><br></pre></td></tr></table></figure>

<p>Use <a href="https://github.com/tikhop/TPInAppReceipt">TPInAppReceipt</a> which includes certificates.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> <span class="type">InAppReceipt</span>.localReceipt()</span><br></pre></td></tr></table></figure>

<p>Check <a href="https://developer.apple.com/library/archive/releasenotes/General/ValidateAppStoreReceipt/Chapters/ReceiptFields.html">Receipt Fields</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Original Application Version</span><br><span class="line">The version of the app that was originally purchased.</span><br><span class="line">ASN.1 Field Type 19</span><br><span class="line">ASN.1 Field Value UTF8STRING</span><br></pre></td></tr></table></figure>

<p><strong>Note</strong></p>
<blockquote>
<p>This corresponds to the value of CFBundleVersion (in iOS) or CFBundleShortVersionString (in macOS) in the Info.plist file when the purchase was originally made</p>
</blockquote>
<p><code>CFBundleVersion</code> is build number, and <code>CFBundleShortVersionString</code> is app version</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">In-App Purchase Receipt</span><br><span class="line">The receipt for an in-app purchase.</span><br><span class="line">ASN.1 Field Type 17</span><br></pre></td></tr></table></figure>

<p>Read <a href="https://developer.apple.com/documentation/storekit/in-app_purchase/validating_receipts_with_the_app_store">Validating Receipts with the App Store</a></p>
<p>Sample <code>verifyReceipt</code> json</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"receipt"</span>: &#123;</span><br><span class="line">        <span class="attr">"receipt_type"</span>: <span class="string">"ProductionSandbox"</span>,</span><br><span class="line">        <span class="attr">"adam_id"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">"app_item_id"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">"bundle_id"</span>: <span class="string">"com.example.app.ios"</span>,</span><br><span class="line">        <span class="attr">"application_version"</span>: <span class="string">"3"</span>,</span><br><span class="line">        <span class="attr">"download_id"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">"version_external_identifier"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">"receipt_creation_date"</span>: <span class="string">"2018-11-13 16:46:31 Etc/GMT"</span>,</span><br><span class="line">        <span class="attr">"receipt_creation_date_ms"</span>: <span class="string">"1542127591000"</span>,</span><br><span class="line">        <span class="attr">"receipt_creation_date_pst"</span>: <span class="string">"2018-11-13 08:46:31 America/Los_Angeles"</span>,</span><br><span class="line">        <span class="attr">"request_date"</span>: <span class="string">"2018-11-13 17:10:31 Etc/GMT"</span>,</span><br><span class="line">        <span class="attr">"request_date_ms"</span>: <span class="string">"1542129031280"</span>,</span><br><span class="line">        <span class="attr">"request_date_pst"</span>: <span class="string">"2018-11-13 09:10:31 America/Los_Angeles"</span>,</span><br><span class="line">        <span class="attr">"original_purchase_date"</span>: <span class="string">"2013-08-01 07:00:00 Etc/GMT"</span>,</span><br><span class="line">        <span class="attr">"original_purchase_date_ms"</span>: <span class="string">"1375340400000"</span>,</span><br><span class="line">        <span class="attr">"original_purchase_date_pst"</span>: <span class="string">"2013-08-01 00:00:00 America/Los_Angeles"</span>,</span><br><span class="line">        <span class="attr">"original_application_version"</span>: <span class="string">"1.0"</span>,</span><br><span class="line">        <span class="attr">"in_app"</span>: [&#123;</span><br><span class="line">            <span class="attr">"quantity"</span>: <span class="string">"1"</span>,</span><br><span class="line">            <span class="attr">"product_id"</span>: <span class="string">"test2"</span>,</span><br><span class="line">            <span class="attr">"transaction_id"</span>: <span class="string">"1000000472106082"</span>,</span><br><span class="line">            <span class="attr">"original_transaction_id"</span>: <span class="string">"1000000472106082"</span>,</span><br><span class="line">            <span class="attr">"purchase_date"</span>: <span class="string">"2018-11-13 16:46:31 Etc/GMT"</span>,</span><br><span class="line">            <span class="attr">"purchase_date_ms"</span>: <span class="string">"1542127591000"</span>,</span><br><span class="line">            <span class="attr">"purchase_date_pst"</span>: <span class="string">"2018-11-13 08:46:31 America/Los_Angeles"</span>,</span><br><span class="line">            <span class="attr">"original_purchase_date"</span>: <span class="string">"2018-11-13 16:46:31 Etc/GMT"</span>,</span><br><span class="line">            <span class="attr">"original_purchase_date_ms"</span>: <span class="string">"1542127591000"</span>,</span><br><span class="line">            <span class="attr">"original_purchase_date_pst"</span>: <span class="string">"2018-11-13 08:46:31 America/Los_Angeles"</span>,</span><br><span class="line">            <span class="attr">"is_trial_period"</span>: <span class="string">"false"</span></span><br><span class="line">        &#125;]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"status"</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">"environment"</span>: <span class="string">"Sandbox"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Verify your receipt first with the production URL; then verify with the sandbox URL if you receive a 21007 status code. This approach ensures you do not have to switch between URLs while your application is tested, reviewed by App Review, or live in the App Store.</p>
</blockquote>
<h2 id="Show-me-the-code"><a href="#Show-me-the-code" class="headerlink" title="Show me the code"></a>Show me the code</h2><p>Let’s use enum to represent possible states for each resource. Here’s simple case where we only have 1 non consumable IAP product.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">IAPError</span>: <span class="title">Error</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> failedToRefreshReceipt</span><br><span class="line">    <span class="keyword">case</span> failedToRequestProduct</span><br><span class="line">    <span class="keyword">case</span> failedToPurchase</span><br><span class="line">    <span class="keyword">case</span> receiptNotFound</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">IAPResourceState</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> notAsked</span><br><span class="line">    <span class="keyword">case</span> loading</span><br><span class="line">    <span class="keyword">case</span> success(<span class="type">T</span>)</span><br><span class="line">    <span class="keyword">case</span> failure(<span class="type">IAPError</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">PricingPlan</span>: <span class="title">ObservableObject</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> pro = (<span class="type">Bundle</span>.main.bundleIdentifier ?? <span class="string">""</span>) + <span class="string">".pro"</span></span><br><span class="line"></span><br><span class="line">    @<span class="type">Published</span></span><br><span class="line">    <span class="keyword">var</span> isPro: <span class="type">Bool</span> = <span class="literal">false</span></span><br><span class="line">    @<span class="type">Published</span></span><br><span class="line">    <span class="keyword">var</span> product: <span class="type">IAPResourceState</span>&lt;<span class="type">SKProduct</span>&gt; = .notAsked</span><br><span class="line">    @<span class="type">Published</span></span><br><span class="line">    <span class="keyword">var</span> purchase: <span class="type">IAPResourceState</span>&lt;<span class="type">SKPayment</span>&gt; = .notAsked</span><br><span class="line">    @<span class="type">Published</span></span><br><span class="line">    <span class="keyword">var</span> receipt: <span class="type">IAPResourceState</span>&lt;<span class="type">InAppReceipt</span>&gt; = .notAsked</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Let’s have a central place for managing all IAP operations, called <code>IAPManager</code>, it can update our <code>ObservableObject</code> <code>PricingPlan</code> hence triggers update to SwiftUI.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> StoreKit</span><br><span class="line"><span class="keyword">import</span> TPInAppReceipt</span><br><span class="line"><span class="keyword">import</span> Version</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">IAPManager</span>: <span class="title">NSObject</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">let</span> pricingPlan: <span class="type">PricingPlan</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">let</span> paymentQueue: <span class="type">SKPaymentQueue</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(pricingPlan: <span class="type">PricingPlan</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.pricingPlan = pricingPlan</span><br><span class="line">        <span class="keyword">self</span>.paymentQueue = <span class="type">SKPaymentQueue</span>.<span class="keyword">default</span>()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">self</span>.paymentQueue.add(<span class="keyword">self</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">requestProducts</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">let</span> identifiers = <span class="type">PricingPlan</span>.pro</span><br><span class="line">        <span class="keyword">let</span> request = <span class="type">SKProductsRequest</span>(productIdentifiers: <span class="type">Set</span>(arrayLiteral: identifiers))</span><br><span class="line">        request.delegate = <span class="keyword">self</span></span><br><span class="line">        pricingPlan.product = .loading</span><br><span class="line">        request.start()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">purchase</span><span class="params">(product: SKProduct)</span></span> &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="type">SKPaymentQueue</span>.canMakePayments() <span class="keyword">else</span> &#123;</span><br><span class="line">            showAlert(text: <span class="string">"You are not allowed to make payment. Please check device settings."</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        pricingPlan.purchase = .loading</span><br><span class="line">        <span class="keyword">let</span> payment = <span class="type">SKPayment</span>(product: product)</span><br><span class="line">        paymentQueue.add(payment)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">refreshReceipt</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">let</span> request = <span class="type">SKReceiptRefreshRequest</span>()</span><br><span class="line">        request.delegate = <span class="keyword">self</span></span><br><span class="line">        request.start()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">restorePurchase</span><span class="params">()</span></span> &#123;</span><br><span class="line">        paymentQueue.restoreCompletedTransactions()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Refresh-receipt"><a href="#Refresh-receipt" class="headerlink" title="Refresh receipt"></a>Refresh receipt</h3><p>You can use <code>restoreCompletedTransactions</code> if you simply <code>finishTransaction</code> and grant user pro feature, like in this simple tutorial <a href="https://www.raywenderlich.com/5456-in-app-purchase-tutorial-getting-started">In-App Purchase Tutorial: Getting Started</a>, search for <code>SKPaymentTransactionObserver</code>. <code>restoreCompletedTransactions</code> also updates receipt.</p>
<p>Otherwise refreshing receipt is a better idea. It serves both case when receipt is not there locally and when you want to restore transactions. With receipt refreshing, no restored transactions are created and <code>SKPaymentTransactionObserver</code> is not called, so we need to check receipt proactively.</p>
<p>Either <code>restoreCompletedTransactions</code>  or <code>SKReceiptRefreshRequest</code> asks for AppStore credential so you should present a button there and ask user.</p>
<h3 id="Check-local-receipt"><a href="#Check-local-receipt" class="headerlink" title="Check local receipt"></a>Check local receipt</h3><p>Try to locate local receipt and examine it.</p>
<ul>
<li>If it is not there (missing, corrupted), refresh receipt</li>
<li>If it’s there, check if it was from a version when the app was still as paid. Notice the difference in meaning of <code>originalAppVersion</code> in macOS and iOS</li>
<li>If it is not paid, check if this receipt contains In App Purchase information for our product</li>
</ul>
<p>In practice, we need to perform some basic checks on receipt, like bundle id, app version, device id. Read <a href="https://www.raywenderlich.com/9257-in-app-purchases-receipt-validation-tutorial">In-App Purchases: Receipt Validation Tutorial</a>, search for <code>Validating the Receipt</code>. <code>TPInAppReceipt</code> also has some handy <code>verify</code> functions</p>
<p>Besides verifying receipt locally, it is advisable to call <a href="https://developer.apple.com/documentation/appstorereceipts/verifyreceipt">verifyreceipt</a> either on device, or better on serve to let Apple verify receipt and returns you a human readable json for receipt information.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">checkReceipt</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="type">DispatchQueue</span>.main.async &#123;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> receipt = <span class="keyword">try</span> <span class="type">InAppReceipt</span>.localReceipt()</span><br><span class="line">            <span class="keyword">self</span>.pricingPlan.receipt = .success(receipt)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">self</span>.isPaid(receipt: receipt) &#123;</span><br><span class="line">                <span class="keyword">self</span>.pricingPlan.isPro = <span class="literal">true</span></span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> receipt.containsPurchase(ofProductIdentifier: <span class="type">PricingPlan</span>.pro) &#123;</span><br><span class="line">                <span class="keyword">self</span>.pricingPlan.isPro = <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="keyword">self</span>.pricingPlan.receipt = .failure(.receiptNotFound)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">isPaid</span><span class="params">(receipt: InAppReceipt)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    #<span class="keyword">if</span> os(macOS)</span><br><span class="line">    <span class="comment">// originalAppVersion is CFBundleShortVersionString</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> version = <span class="type">Version</span>(receipt.originalAppVersion) &#123;</span><br><span class="line">        <span class="keyword">return</span> version &lt; versionToIAP</span><br><span class="line">    &#125;</span><br><span class="line">    #<span class="keyword">else</span></span><br><span class="line">    <span class="comment">// originalAppVersion is CFBundleVersion</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> buildNumber = <span class="type">Int</span>(receipt.originalAppVersion) &#123;</span><br><span class="line">        <span class="keyword">return</span> buildNumber &lt; buildNumberToIAP</span><br><span class="line">    &#125;</span><br><span class="line">    #endif</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Finally, observe <code>SKProductsRequestDelegate</code> which also conforms to <code>SKRequestDelegate</code> for both product and receipt refresh request</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">IAPManager</span>: <span class="title">SKProductsRequestDelegate</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">productsRequest</span><span class="params">(<span class="number">_</span> request: SKProductsRequest, didReceive response: SKProductsResponse)</span></span> &#123;</span><br><span class="line">        <span class="type">DispatchQueue</span>.main.async &#123;</span><br><span class="line">            <span class="keyword">guard</span> <span class="keyword">let</span> product = response.products.first <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">self</span>.pricingPlan.product = .failure(<span class="type">IAPError</span>.failedToRequestProduct)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">self</span>.pricingPlan.product = .success(product)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">request</span><span class="params">(<span class="number">_</span> request: SKRequest, didFailWithError error: Error)</span></span> &#123;</span><br><span class="line">        <span class="type">DispatchQueue</span>.main.async &#123;</span><br><span class="line">            <span class="keyword">switch</span> request &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="keyword">is</span> <span class="type">SKProductsRequest</span>:</span><br><span class="line">                <span class="keyword">self</span>.pricingPlan.product = .failure(<span class="type">IAPError</span>.failedToRequestProduct)</span><br><span class="line">            <span class="keyword">case</span> <span class="keyword">is</span> <span class="type">SKReceiptRefreshRequest</span>:</span><br><span class="line">                <span class="keyword">self</span>.pricingPlan.receipt = .failure(<span class="type">IAPError</span>.failedToRefreshReceipt)</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">requestDidFinish</span><span class="params">(<span class="number">_</span> request: SKRequest)</span></span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> request &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="keyword">is</span> <span class="type">SKReceiptRefreshRequest</span>:</span><br><span class="line">            checkReceipt()</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<p><strong>Updated at</strong> 2020-12-04 06:58:17</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-11-04T09:02:01.000Z" title="2020-11-04T09:02:01.000Z">2020-11-04</time><span class="level-item">a few seconds read (About 67 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-avoid-multiple-match-elements-in-UITests-from-iOS-13/">How to avoid multiple match elements in UITests from iOS 13</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/691">#691</a></strong></p>
<p>Supposed we want to present a ViewController, and there exist both <code>UIToolbar</code> in both the presenting and presented view controllers.</p>
<p>From iOS 13, the model style is not full screen and interactive. From UITests perspective there are 2 UIToolbar, we need to specify the correct one to avoid multiple match errors</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> editButton = app.toolbars[<span class="string">"EditArticle.Toolbar"</span>].buttons[<span class="string">"Edit"</span>]</span><br></pre></td></tr></table></figure>
<hr>
<p><strong>Updated at</strong> 2020-11-04 10:02:29</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-10-11T02:11:14.000Z" title="2020-10-11T02:11:14.000Z">2020-10-11</time><span class="level-item">19 minutes read (About 2812 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-test-push-notifications-in-simulator-and-production-iOS-apps/">How to test push notifications in simulator and production iOS apps</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/682">#682</a></strong></p>
<p>After has recently reminded about his updating <a href="https://developer.apple.com/news/?id=c88acm2b">APNs provider API</a> which makes me realised a lot has changed about push notifications, both in terms of client and provider approach. </p>
<blockquote>
<p>The HTTP/2-based Apple Push Notification service (APNs) provider API lets you take advantage of great features, such as authentication with a JSON Web Token, improved error messaging, and per-notification feedback. If you send push notifications with the legacy binary protocol, we strongly recommend upgrading to the APNs provider API.</p>
</blockquote>
<p>From the the iOS client point of view, you pretty much don’t need to care about provider API, as you only need to register for push notification capability and send the device token to your backend, and it’s the backend’s job to send push request to Apple notifications server.</p>
<p>But it’s good to know the underlying mechanism, especially when you want to troubleshoot push notification. Since a push notification failure can be because of many reasons: it could be due to some failed logic in your backend, or that the push certificate has expired, or that you have sent the wrong device token, or that user has turned off push permission in Settings app, or that the push has been delayed.</p>
<p>Here’s also a common abbreviations you need to learn: <code>APNs</code> it is short for Apple Push Notification service. You can think of it as the server your device always has connection with, so you’re ready for any server push messages from it.</p>
<h2 id="What-is-binary-provider-API"><a href="#What-is-binary-provider-API" class="headerlink" title="What is binary provider API"></a>What is binary provider API</h2><p>Push notification feature was first introduced by Apple in 2009 via a fairly complex <a href="https://developer.apple.com/library/archive/documentation/NetworkingInternet/Conceptual/RemoteNotificationsPG/BinaryProviderAPI.html">binary provider API</a></p>
<p><img src="https://user-images.githubusercontent.com/2284279/95670009-ca26dd80-0b86-11eb-8ff9-5dbb4d1d312c.png" alt="binary"></p>
<p>In short, binary provider API is just a specification about which address and which format to send push request to Apple push server. The binary interface of the production environment is available through <code>gateway.push.apple.com, port 2195</code> and development environment <code>gateway.sandbox.push.apple.com, port 2195</code>. The binary interface employs a plain TCP socket for binary content that is streaming in nature.</p>
<p>As you can see in the package instruction above, we need specify frame length and data. Data is a key value pairs of multiple informations like device token, expiration, topic, priority.</p>
<p>Send request to the above addresses via secured TLS or SSL channel. The SSL certificate required for these connections is obtained from your developer account.</p>
<h2 id="The-new-HTTP-2-provider-API"><a href="#The-new-HTTP-2-provider-API" class="headerlink" title="The new HTTP/2 provider API"></a>The new HTTP/2 provider API</h2><p>The new <a href="https://developer.apple.com/documentation/usernotifications/setting_up_a_remote_notification_server/sending_notification_requests_to_apns/">HTTP2/ provider API</a> is recommended, it has detailed error reporting and better throughput. If you use <a href="https://developer.apple.com/documentation/foundation/urlsession">URLSession</a> which supports the HTTP/1.1 and HTTP/2 protocols. HTTP/2 support, as described by RFC 7540, you will feel familiar.</p>
<p>In short, when you have a notification to send to a user, your provider must construct a POST request and send it to Apple Push Notification service (APNs). Your request must include the following information:</p>
<ul>
<li>The JSON payload that you want to send</li>
<li>The device token for the user’s device</li>
<li>Request-header fields specifying how to deliver the notification</li>
<li>For token-based authentication, your provider server’s current authentication token</li>
</ul>
<p>Upon receiving your server’s POST request, APNs validates the request using either the provided authentication token or your server’s certificate. If validation succeeds, APNs uses the provided device token to identify the user’s device. It then tries to send your JSON payload to that device.</p>
<p>So it’s pretty much how you configure <code>URLRequest</code>with <code>URLSession</code>, specify base url, some request headers including the authorization and the payload body.</p>
<p>Use HTTP/2 and TLS 1.2 or later to establish a connection to the new provider API endpoint. For development serverit is <code>api.sandbox.push.apple.com:443</code> and for production server it is <code>api.push.apple.com:443</code>. You then send the request as <code>POST</code> and Apple will do its job to verify and send the push notification to the users device.</p>
<h2 id="Certificate-vs-token-based-authentication"><a href="#Certificate-vs-token-based-authentication" class="headerlink" title="Certificate vs token based authentication"></a>Certificate vs token based authentication</h2><p>To send push request to APNs, you need to authenticate to tell that is really from you. APNs support 2 types of authentication, the traditional way with a certificate, and the recently new recommended way with a p8 token.</p>
<h3 id="Certificate-based-authentication"><a href="#Certificate-based-authentication" class="headerlink" title="Certificate based authentication"></a>Certificate based authentication</h3><p>For <a href="https://developer.apple.com/documentation/usernotifications/setting_up_a_remote_notification_server/establishing_a_certificate-based_connection_to_apns">certificate based authentication</a>, you will need a p12 certificate which you can obtain and generate from your Developer account.</p>
<p><img src="https://user-images.githubusercontent.com/2284279/95670291-81bcef00-0b89-11eb-8e98-92112c414476.png" alt="cer"></p>
<p>Because there are sandbox and production push endpoint, few years ago it was required to have separate sandbox and production environment push certificate, which you had to create separately in your Apple developer account, then in testing need to specify the correct push certificate for each environment.</p>
<p>Now around iOS 10 year we can use just 1 single certificate for both sandbox and production, which is a relief for us developers. When we create certificate on Apple developer page, we need to upload a certificate signing request that we can generate from Keychain Access app. After we download the generated push certificate, download and run it in Keychain, there we can generate p12 key file that contains both certificate and private key to sign our push request.</p>
<p>Certificate and provisioning profiles valid for only 1 year. So every year you have to renew push notification certificates, which is also a good and bad thing. Besides that, every app differs from bundle id, so we kinda have to generate certificate for each app.</p>
<h3 id="Token-based-authentication"><a href="#Token-based-authentication" class="headerlink" title="Token based authentication"></a>Token based authentication</h3><p><a href="https://developer.apple.com/documentation/usernotifications/setting_up_a_remote_notification_server/establishing_a_token-based_connection_to_apns">Token-based authentication</a> offers a stateless way to communicate with APNs. Stateless communication is faster than certificate-based communication because it doesn’t require APNs to look up the certificate, or other information, related to your provider server. There are other advantages to using token-based authentication:</p>
<p>The cool thing about token is that you can use one token to distribute notifications for all of your company’s apps. You can create in your Apple developer account. Key authentication is the recommended way to authenticate with Apple services, so it is used not only for push services, but also for MusicKit and DeviceCheck.</p>
<p><img src="https://user-images.githubusercontent.com/2284279/95670409-a796c380-0b8a-11eb-87a5-169d48e738de.png" alt="key"></p>
<p>When you request a key, Apple gives you a 10-character string with the Key ID which you must include this string in your JSON tokens and an authentication token signing key, specified as a text file (with a .p8 file extension). The key is allowed to download once and you need to keep it properly.</p>
<p>The token that you include with your notification requests uses the JSON Web Token (JWT) specification. The token itself contains four key-value pairs</p>
<img width="811" alt="Screenshot 2020-10-11 at 06 28 34" src="https://user-images.githubusercontent.com/2284279/95670434-ff352f00-0b8a-11eb-8d28-2e5b07a6875e.png">

<p>After all, the JSON Web Token is encoded in this <code>authorization</code> HTTP headers in your request like this</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">authorization &#x3D; bearer eyAia2lkIjogIjhZTDNHM1JSWDciIH0.eyAiaXNzIjogIkM4Nk5WOUpYM0QiLCAiaWF0I</span><br><span class="line">		 jogIjE0NTkxNDM1ODA2NTAiIH0.MEYCIQDzqyahmH1rz1s-LFNkylXEa2lZ_aOCX4daxxTZkVEGzwIhALvkClnx5m5eAT6</span><br><span class="line">		 Lxw7LZtEQcH6JENhJTMArwLf3sXwi</span><br></pre></td></tr></table></figure>

<p>For security, APNs requires you to refresh your token regularly. Refresh your token no more than once every 20 minutes and no less than once every 60 minutes.</p>
<h2 id="How-to-register-for-push-notifications-from-iOS-app"><a href="#How-to-register-for-push-notifications-from-iOS-app" class="headerlink" title="How to register for push notifications from iOS app"></a>How to register for push notifications from iOS app</h2><p>The APIs to register for remote notification has changed over the years.</p>
<h3 id="iOS-7"><a href="#iOS-7" class="headerlink" title="iOS 7"></a>iOS 7</h3><p>In iOS 7, we used to use this method <a href="https://developer.apple.com/documentation/uikit/uiapplication/1623010-registerforremotenotificationtyp?language=objc">registerForRemoteNotificationTypes</a> to register to receive remote notifications of the specified types via Apple Push Notification service.</p>
<p>The types can be <code>UIRemoteNotificationTypeBadge</code>, <code>UIRemoteNotificationTypeAlert</code>, <code>UIRemoteNotificationTypeSound</code></p>
<p>When you send this message, the device initiates the registration process with Apple Push Notification service. If it succeeds, the app delegate receives a device token in the <code>application:didRegisterForRemoteNotificationsWithDeviceToken:</code> method; if registration doesn’t succeed, the delegate is informed via the <code>application:didFailToRegisterForRemoteNotificationsWithError:</code>method. If the app delegate receives a device token, it should connect with its provider and pass it the token.</p>
<h3 id="iOS-8-with-registerUserNotificationSettings"><a href="#iOS-8-with-registerUserNotificationSettings" class="headerlink" title="iOS 8 with registerUserNotificationSettings"></a>iOS 8 with <code>registerUserNotificationSettings</code></h3><p>From iOS 8, there’s separation between asking for a remote notification with device token, and with presenting push message to the user. This confused developers as these 2 things are separate now.</p>
<p>First, we use <a href="https://developer.apple.com/documentation/uikit/uiapplication/1623078-registerforremotenotifications">registerForRemoteNotifications</a> to register to receive remote notifications via Apple Push Notification service.</p>
<p>Call this method to initiate the registration process with Apple Push Notification service. If registration succeeds, the app calls your app delegate object’s <code>application(_:didRegisterForRemoteNotificationsWithDeviceToken:)</code> method and passes it a device token. You should pass this token along to the server you use to generate remote notifications for the device. If registration fails, the app calls its app delegate’s <code>application(_:didFailToRegisterForRemoteNotificationsWithError:)</code> method instead.</p>
<p>In short, this is to receive device token from APNs so we can do silent push notification or other things. Note that we need to enable <code>Remote notification</code> capability for Background modes.</p>
<img width="999" alt="Screenshot 2020-10-11 at 06 39 46" src="https://user-images.githubusercontent.com/2284279/95670516-90f16c00-0b8c-11eb-8569-74fe99007ba5.png">

<p>To present push message to user via alert, banner, badge or sound, we need to explicitly ask for using this method <a href="https://developer.apple.com/documentation/uikit/uiapplication/1622932-registerusernotificationsettings">registerUserNotificationSettings</a> to registers your preferred options for notifying the user.</p>
<p>If your app displays alerts, play sounds, or badges its icon, you must call this method during your launch cycle to request permission to alert the user in these ways. After calling this method, the app calls the <code>application(_ application: UIApplication, didRegister notificationSettings: UIUserNotificationSettings)</code> method of its app delegate to report the results. You can use that method to determine if your request was granted or denied by the user.</p>
<h3 id="iOS-10-with-UserNotifications-framework"><a href="#iOS-10-with-UserNotifications-framework" class="headerlink" title="iOS 10 with UserNotifications framework"></a>iOS 10 with UserNotifications framework</h3><p>In iOS 10, Apple introduced <code>UserNotifications</code> and <code>UserNotificationsUI</code> framework and lots of new features to push notifications like actions and attachments.</p>
<p>To ask for permission to present push message from iOS 10, use the new <code>UNUserNotificationCenter</code> which accepts options and block callback with grant status.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">UNUserNotificationCenter</span>.current().requestAuthorization(options: [.badge, .sound, .alert])</span><br></pre></td></tr></table></figure>

<p><img src="https://user-images.githubusercontent.com/2284279/95670610-d95d5980-0b8d-11eb-86c9-4d4ab16e31f6.png" alt="abc"></p>
<p>There ‘s also <code>UNNotificationAction</code> and <code>UNNotificationAttachment</code> to specify additional actions and attachment to go along with the push message, this is very handy for visual purpose and convenient actions user can perform right away from the push message.</p>
<p>There’s also a convenient <code>UserNotificationsUI</code> that was shipped with iOS 10 that allows us to embed custom view controller from our push message</p>
<p><img src="https://user-images.githubusercontent.com/2284279/95670635-4e309380-0b8e-11eb-88c5-8cd591d8665e.png" alt="ui"></p>
<p>When an iOS device receives a notification containing an alert, the system displays the contents of the alert in two stages. Initially, it displays an abbreviated banner with the title, subtitle, and two to four lines of body text from the notification. If the user presses the abbreviated banner, iOS displays the full notification interface, including any notification-related actions. The system provides the interface for the abbreviated banner, but you can customize the full interface using a notification content app extension.</p>
<p>Also, there is this callback <a href="https://developer.apple.com/documentation/usernotifications/unusernotificationcenterdelegate/1649518-usernotificationcenter">userNotificationCenter _:willPresent</a> that asks the delegate how to handle a notification that arrived while the app was running in the foreground.</p>
<p>If your app is in the foreground when a notification arrives, the shared user notification center calls this method to deliver the notification directly to your app. If you implement this method, you can take whatever actions are necessary to process the notification or show it when your app is running.</p>
<h3 id="iOS-12-with-provisional-push"><a href="#iOS-12-with-provisional-push" class="headerlink" title="iOS 12 with provisional push"></a>iOS 12 with provisional push</h3><p>New in iOS 12 is the <code>UNAuthorizationStatus.provisional</code>, which are notifications that appear silently in the user’s notification center without appearing on the user’s home screen. We can start sending them as soon as a user has downloaded and run your app for the first time. You can send provisional push notifications unlimited times unless the user explicitly turns them off.</p>
<img width="333" alt="Screenshot 2020-10-11 at 06 58 34" src="https://user-images.githubusercontent.com/2284279/95670721-30aff980-0b8f-11eb-89c0-6d4c39d314c0.png">

<p>This is good to send unobtrusive push to users in their Notification Center where they can pick up at a later time.  </p>
<h3 id="iOS-13-with-apns-push-type"><a href="#iOS-13-with-apns-push-type" class="headerlink" title="iOS 13 with apns-push-type"></a>iOS 13 with apns-push-type</h3><p>Starting with iOS 13 and watchOS 6, there is <code>apns-push-type</code> which must accurately reflect the contents of your notification’s payload. If there is a mismatch, or if the header is missing on required systems, APNs may return an error.</p>
<p>The <code>apns-push-type</code> header field has six valid values. The descriptions below describe when and how to use these values. For example <code>alert</code> for notifications that trigger a user interaction and <code>background</code> for notifications that deliver content in the background.</p>
<p>In a WWDC 2019 session <a href="https://developer.apple.com/videos/play/wwdc2019/707/?time=799">Advances in App Background Execution</a>, <code>apns-priority</code> must be set to 5 for <code>content available</code> notifications.</p>
<h3 id="iOS-14-with-ephemeral-authorization-status-and-AppClip"><a href="#iOS-14-with-ephemeral-authorization-status-and-AppClip" class="headerlink" title="iOS 14 with ephemeral authorization status and AppClip"></a>iOS 14 with ephemeral authorization status and AppClip</h3><p>From <a href="https://developer.apple.com/documentation/app_clips/enabling_notifications_in_app_clips">Enable your App Clip to schedule and receive notifications for a short or extended time period.</a></p>
<blockquote>
<p>Some App Clips may need to schedule or receive notifications to provide value. Consider an App Clip that allows users to order food for delivery: By sending notifications, the App Clip informs the user about an upcoming delivery. If notifications are important for your App Clip’s functionality, enable it to schedule or receive notifications for up to 8 hours after each launch.</p>
</blockquote>
<h3 id="Remote-notification-only-with-content-available"><a href="#Remote-notification-only-with-content-available" class="headerlink" title="Remote notification only with content-available"></a>Remote notification only with content-available</h3><p>Besides user interface notification, there is <code>content-available</code> notification that delivers notifications that wake your app and update it in the background. If your app’s server-based content changes infrequently or at irregular intervals, you can use background notifications to notify your app when new content becomes available. Read <a href="https://developer.apple.com/documentation/usernotifications/setting_up_a_remote_notification_server/pushing_background_updates_to_your_app">Pushing Background Updates to Your App</a></p>
<h2 id="Testing-push-notification-in-simulator"><a href="#Testing-push-notification-in-simulator" class="headerlink" title="Testing push notification in simulator"></a>Testing push notification in simulator</h2><p>We have been able to drag images to the Photos app in simulator for years, but new in Xcode 11.4 is the ability to drag push payload to simulator to simulate remote push notification.</p>
<p>All we have to do is create an <code>apns</code> file with <code>Simulator Target Bundle</code> key to specify our app, then drag to the simulator</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"Simulator Target Bundle"</span>: <span class="string">"com.onmyway133.PushHero"</span>,</span><br><span class="line">    <span class="attr">"aps"</span>: &#123;</span><br><span class="line">        <span class="attr">"alert"</span>: <span class="string">"Welcome to Push Hero"</span>,</span><br><span class="line">        <span class="attr">"sound"</span>: <span class="string">"chime"</span>,</span><br><span class="line">        <span class="attr">"badge"</span>: <span class="number">2</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Many of the simulator features can be controlled via <code>xcrun simctl</code> command line tool where you can change status bar time, battery info, start and stop certain simulators and send push with <code>xcrun simctl push</code>. This is very handy in case you want to automate things.</p>
<h2 id="Test-push-notification-easily-with-Push-Hero"><a href="#Test-push-notification-easily-with-Push-Hero" class="headerlink" title="Test push notification easily with Push Hero"></a>Test push notification easily with Push Hero</h2><p>As iOS developers who need to test push notification a lot, I face this challenge. That’s why I made <a href="https://onmyway133.com/pushhero/">Push Hero</a> as a native macOS application that allows us to reliably test push notification. It is written in pure Swift with all the new APNs specification in mind.</p>
<img width="1364" alt="Screenshot 2020-10-08 at 06 17 12" src="https://user-images.githubusercontent.com/2284279/95670862-ec255d80-0b90-11eb-9a8d-694167f69d8d.png">

<p>With Push Hero, we can setup multiple test scenario for different app. Each we can specify the authentication method we want, either with p8 token or p12 certificate based. There’s also input validation and hint helper that explains which field is needed and in which format, so you save time to work on your push testing instead.</p>
<p>New in latest version of Push Hero is the ability to send multiple pushes to multiple device tokens, which is the most frequent request. In the right history pane, there’s information about each request and response content, together with apns id information.</p>
<p>Also in Push Hero is the popup to show explanation for each field, and you need to consult <a href="https://developer.apple.com/documentation/usernotifications/setting_up_a_remote_notification_server/sending_notification_requests_to_apns/">Sending Notification Requests to APNs</a> documentation as there are some specifications there. For example with VoIP push, the <code>apns-topic</code> header field must use your app’s bundle ID with <code>.voip</code> appended to the end. If you’re using certificate-based authentication, you must also register the certificate for VoIP services</p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>Push notification continues to be important for iOS apps, and Apple has over the years improved and changed it for the better. This also means lots of knowledge to keep up with. Understanding provider APNs, setting up certificate and JSON Web Token key can be intimidating and take time.</p>
<p>Hopefully the above summary gets you more understanding into push notification, not only the history of changes in both client and provider API, but also some ways to test it easily.</p>
<hr>
<p><strong>Updated at</strong> 2021-01-01 23:26:17</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-09-15T10:16:47.000Z" title="2020-09-15T10:16:47.000Z">2020-09-15</time><span class="level-item">a minute read (About 118 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-draw-arc-corner-using-Bezier-Path/">How to draw arc corner using Bezier Path</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/673">#673</a></strong></p>
<p>To draw rounded 2 corners at top left and top right, let’s start from bottom left</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> path = <span class="type">UIBezierPath</span>()</span><br><span class="line"><span class="comment">// bottom left</span></span><br><span class="line">path.move(to: <span class="type">CGPoint</span>(x: <span class="number">0</span>, y: bounds.height))</span><br><span class="line"><span class="comment">// top left corner</span></span><br><span class="line">path.addArc(withCenter: <span class="type">CGPoint</span>(x: radius, y: radius), radius: radius, startAngle: <span class="type">CGFloat</span>.pi, endAngle: <span class="type">CGFloat</span>.pi * <span class="number">3</span> / <span class="number">2</span>, clockwise: <span class="literal">true</span>)</span><br><span class="line"><span class="comment">// top right corner</span></span><br><span class="line">path.addArc(withCenter: <span class="type">CGPoint</span>(x: bounds.width - radius, y: radius), radius: radius, startAngle: <span class="type">CGFloat</span>.pi * <span class="number">3</span> / <span class="number">2</span>, endAngle: <span class="number">0</span>, clockwise: <span class="literal">true</span>)</span><br><span class="line"><span class="comment">// bottom right</span></span><br><span class="line">path.addLine(to: <span class="type">CGPoint</span>(x: bounds.width, y: bounds.height))</span><br><span class="line">path.close()</span><br></pre></td></tr></table></figure>

<img width="598" alt="Screenshot 2020-09-15 at 14 16 01" src="https://user-images.githubusercontent.com/2284279/93209165-fdc84080-f75d-11ea-9e95-ed39d749b7d6.png">

<p><img src="https://user-images.githubusercontent.com/2284279/93209263-27816780-f75e-11ea-9de8-d50d72798313.png" alt="cc"></p>
<h2 id="Read-more"><a href="#Read-more" class="headerlink" title="Read more"></a>Read more</h2><ul>
<li><a href="http://ronnqvi.st/thinking-like-a-bzier-path">http://ronnqvi.st/thinking-like-a-bzier-path</a> </li>
</ul>
<hr>
<p><strong>Updated at</strong> 2020-09-15 12:18:11</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-08-14T05:29:45.000Z" title="2020-08-14T05:29:45.000Z">2020-08-14</time><span class="level-item">a minute read (About 120 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-make-dynamic-font-size-for-UIButton/">How to make dynamic font size for UIButton</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/671">#671</a></strong></p>
<p>Use <a href="https://developer.apple.com/documentation/uikit/uicontentsizecategoryadjusting/1771731-adjustsfontforcontentsizecategor?language=objc">adjustsFontForContentSizeCategory</a></p>
<blockquote>
<p>A Boolean that indicates whether the object automatically updates its font when the device’s content size category changes.</p>
</blockquote>
<blockquote>
<p>If you set this property to YES, the element adjusts for a new content size category on a UIContentSizeCategoryDidChangeNotification.</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">button.titleLabel?.adjustsFontForContentSizeCategory = <span class="literal">true</span></span><br><span class="line">button.backgroundColor = <span class="type">UIColor</span>.green</span><br><span class="line">button.titleLabel?.font = <span class="type">UIFont</span>.preferredFont(forTextStyle: .title1)</span><br><span class="line"></span><br><span class="line">label.adjustsFontForContentSizeCategory = <span class="literal">true</span></span><br><span class="line">label.backgroundColor = <span class="type">UIColor</span>.yellow</span><br><span class="line">label.font = <span class="type">UIFont</span>.preferredFont(forTextStyle: .title1)</span><br></pre></td></tr></table></figure>

<p>However it seems view (UIButton or UILabel) size is the same, just the inner text increases in size. A workaround is to put view inside <code>UIStackView</code> so UIButton or UILabel can automatically changes size.</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-08-06T09:39:42.000Z" title="2020-08-06T09:39:42.000Z">2020-08-06</time><span class="level-item">a few seconds read (About 94 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-test-for-view-disappear-in-navigation-controller/">How to test for view disappear in navigation controller</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/670">#670</a></strong></p>
<p>To test for <code>viewWillDisappear</code> during <code>UINavigationController</code> <code>popViewController</code> in unit test, we need to simulate <code>UIWindow</code> so view appearance works.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">PopTests</span>: <span class="title">XCTestCase</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">testPop</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">let</span> window = <span class="type">UIWindow</span>(frame: <span class="type">UIScreen</span>.main.bounds)</span><br><span class="line">        <span class="keyword">let</span> navigationController = <span class="type">UINavigationController</span>()</span><br><span class="line">        window.rootViewController = navigationController</span><br><span class="line">        <span class="keyword">let</span> viewController = <span class="type">DetailViewController</span>()</span><br><span class="line"></span><br><span class="line">        navigationController.viewControllers = [</span><br><span class="line">            <span class="type">UIViewController</span>(),</span><br><span class="line">            viewController</span><br><span class="line">        ]</span><br><span class="line"></span><br><span class="line">        window.makeKeyAndVisible()</span><br><span class="line">        <span class="keyword">let</span> expectation = <span class="type">XCTestExpectation</span>()</span><br><span class="line">        navigationController.popViewController(animated: <span class="literal">false</span>)</span><br><span class="line">        <span class="type">DispatchQueue</span>.main.asyncAfter(deadline: .now() + <span class="number">0.1</span>) &#123;</span><br><span class="line">            <span class="type">XCTAssertTrue</span>(viewController.wasDismissed)</span><br><span class="line">            expectation.fulfill()</span><br><span class="line">        &#125;</span><br><span class="line">        wait(<span class="keyword">for</span>: [expectation], timeout: <span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DetailViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewWillDisappear</span><span class="params">(<span class="number">_</span> animated: Bool)</span></span> &#123;</span><br><span class="line">            <span class="keyword">super</span>.viewWillDisappear(animated)</span><br><span class="line">            <span class="keyword">if</span> isMovingFromParent &#123;</span><br><span class="line">                wasDismissed = <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<p><strong>Updated at</strong> 2020-08-14 07:30:07</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-06-10T17:14:17.000Z" title="2020-06-10T17:14:17.000Z">2020-06-10</time><span class="level-item">a few seconds read (About 29 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-set-text-color-for-UIDatePicker/">How to set text color for UIDatePicker</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/660">#660</a></strong></p>
<p>Apply <code>tintColor</code> does not seem to have effect.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">datePicker.setValue(<span class="type">UIColor</span>.label, forKeyPath: <span class="string">"textColor"</span>)</span><br><span class="line">datePicker.setValue(<span class="literal">false</span>, forKey: <span class="string">"highlightsToday"</span>)</span><br></pre></td></tr></table></figure>
<hr>
<p><strong>Updated at</strong> 2020-06-10 19:15:21</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-03-25T09:57:00.000Z" title="2020-03-25T09:57:00.000Z">2020-03-25</time><span class="level-item">2 minutes read (About 370 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-use-background-in-iOS/">How to use background in iOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/631">#631</a></strong></p>
<h2 id="beginBackgroundTask"><a href="#beginBackgroundTask" class="headerlink" title="beginBackgroundTask"></a>beginBackgroundTask</h2><p><a href="https://developer.apple.com/documentation/uikit/app_and_environment/scenes/preparing_your_ui_to_run_in_the_background/extending_your_app_s_background_execution_time">https://developer.apple.com/documentation/uikit/app_and_environment/scenes/preparing_your_ui_to_run_in_the_background/extending_your_app_s_background_execution_time</a></p>
<blockquote>
<p>When your app moves to the background, the system calls your app delegate’s applicationDidEnterBackground(_:) method. That method has five seconds to perform any tasks and return. Shortly after that method returns, the system puts your app into the suspended state. For most apps, five seconds is enough to perform any crucial tasks, but if you need more time, you can ask UIKit to extend your app’s runtime.</p>
</blockquote>
<blockquote>
<p>You extend your app’s runtime by calling the beginBackgroundTask(withName:expirationHandler:) method. Calling this method gives you extra time to perform important tasks.</p>
</blockquote>
<h2 id="BackgroundTasks"><a href="#BackgroundTasks" class="headerlink" title="BackgroundTasks"></a>BackgroundTasks</h2><ul>
<li><a href="https://stackoverflow.com/questions/57197958/xcode-11-what-is-the-new-background-processing-background-mode">https://stackoverflow.com/questions/57197958/xcode-11-what-is-the-new-background-processing-background-mode</a></li>
<li><a href="https://developer.apple.com/documentation/backgroundtasks">https://developer.apple.com/documentation/backgroundtasks</a></li>
</ul>
<blockquote>
<p>Use the BackgroundTasks framework to keep your app content up to date and run tasks requiring minutes to complete while your app is in the background. Longer tasks can optionally require a powered device and network connectivity.</p>
</blockquote>
<blockquote>
<p>Register launch handlers for tasks when the app launches and schedule them as required. The system will launch your app in the background and execute the tasks.</p>
</blockquote>
<ul>
<li><a href="https://www.andyibanez.com/posts/modern-background-tasks-ios13/">https://www.andyibanez.com/posts/modern-background-tasks-ios13/</a></li>
</ul>
<blockquote>
<p>The main API for using this framework is the BGTaskScheduler . This API constantly monitors the system state such as battery level, background usage, and more, so it chooses the optimal time to run your tasks.</p>
</blockquote>
<blockquote>
<p>To use this API, you begin working when your app is on the foreground. You need to create Background task request. The framework provides an abstract class BGTask, you never use this task directly. Instead, the framework provides two concrete subclasses you can interact with: BGProcessingTask, for long running and maintenance tasks such backup and cleanup, and BGAppRefreshTask to keep your app up-to-date throughout the day.</p>
</blockquote>
<h2 id="URLSession-background"><a href="#URLSession-background" class="headerlink" title="URLSession background"></a>URLSession background</h2><ul>
<li><a href="https://agostini.tech/2018/04/08/background-transfers-using-urlsession/">https://agostini.tech/2018/04/08/background-transfers-using-urlsession/</a></li>
</ul>
<blockquote>
<p>When you create your background download or upload tasks with URLSession, you’re actually scheduling a download (or upload) with the ‘nsurlsessiond’ which is a daemon service that runs as a separate process.</p>
</blockquote>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-02-13T11:20:04.000Z" title="2020-02-13T11:20:04.000Z">2020-02-13</time><span class="level-item">2 minutes read (About 234 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-mask-with-UILabel/">How to mask with UILabel</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/603">#603</a></strong></p>
<p>Need to set correct frame for mask layer or <code>UILabel</code>,  as it is relative to the coordinate of the view to be masked</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> aView = <span class="type">UIView</span>(frame: .<span class="keyword">init</span>(x: <span class="number">100</span>, y: <span class="number">110</span>, width: <span class="number">200</span>, height: <span class="number">100</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> textLayer = <span class="type">CATextLayer</span>()</span><br><span class="line">textLayer.foregroundColor = <span class="type">UIColor</span>.white.cgColor</span><br><span class="line">textLayer.string = <span class="string">"Hello world"</span></span><br><span class="line">textLayer.font = <span class="type">UIFont</span>.preferredFont(forTextStyle: .largeTitle)</span><br><span class="line">textLayer.frame = aView.bounds</span><br><span class="line"></span><br><span class="line">aView.layer.mask = textLayer</span><br></pre></td></tr></table></figure>

<p>Use <code>sizeToFit</code> to ensure frame for <code>UILabel</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> label = <span class="type">UILabel</span>()</span><br><span class="line">label.frame.origin = <span class="type">CGPoint</span>(x: <span class="number">80</span>, y: <span class="number">80</span>)</span><br><span class="line"></span><br><span class="line">label.textColor = <span class="type">UIColor</span>.black</span><br><span class="line">label.font = <span class="type">UIFont</span>.preferredFont(forTextStyle: .largeTitle)</span><br><span class="line">label.text = <span class="string">"ABC"</span></span><br><span class="line">label.sizeToFit()</span><br><span class="line"></span><br><span class="line">aView.mask = label</span><br></pre></td></tr></table></figure>

<p>Change <code>bounds.origin</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">label.frame.origin = <span class="type">CGPoint</span>(x: <span class="number">50</span>, y: <span class="number">50</span>)</span><br><span class="line">aView.bounds.origin = label.frame.origin</span><br></pre></td></tr></table></figure>

<p>Adding label to view hierarchy seems to remove masking effect. Need to set mask later</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">view.addSubview(aView)</span><br><span class="line">view.addSubview(label)</span><br><span class="line">aView.mask = label</span><br></pre></td></tr></table></figure>

<p>Can’t add overlayView to UILabel and use UILabel as mask, cause cycler CALayer</p>
<p>After using UILabel as mask, its superview is nil</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">aView.mask &#x3D; label</span><br><span class="line">label.superview &#x3D;&#x3D; nil</span><br></pre></td></tr></table></figure>

<p>Mask with snapshot from UILabel. Need to set correct frame for aView and maskLayer</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> maskLayer = <span class="type">CALayer</span>()</span><br><span class="line">maskLayer.contents = label.makeScreenshot().cgImage</span><br><span class="line">maskLayer.contentsGravity = .resizeAspect</span><br><span class="line"></span><br><span class="line">aView.frame = label.bounds</span><br><span class="line">maskLayer.frame = aView.bounds</span><br><span class="line">aView.layer.mask = maskLayer</span><br><span class="line">label.addSubview(aView)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">UIView</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">makeScreenshot</span><span class="params">()</span></span> -&gt; <span class="type">UIImage</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> renderer = <span class="type">UIGraphicsImageRenderer</span>(bounds: <span class="keyword">self</span>.bounds)</span><br><span class="line">        <span class="keyword">return</span> renderer.image &#123; (context) <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">self</span>.layer.render(<span class="keyword">in</span>: context.cgContext)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-02-11T13:19:18.000Z" title="2020-02-11T13:19:18.000Z">2020-02-11</time><span class="level-item">a few seconds read (About 52 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-sync-multiple-CAAnimation/">How to sync multiple CAAnimation</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/600">#600</a></strong></p>
<p>Use same <code>CACurrentMediaTime</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">AnimationSyncer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> now = <span class="type">CACurrentMediaTime</span>()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">makeAnimation</span><span class="params">()</span></span> -&gt; <span class="type">CABasicAnimation</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> animation = <span class="type">CABasicAnimation</span>(keyPath: <span class="string">"opacity"</span>)</span><br><span class="line">        animation.fillMode = .forwards</span><br><span class="line">        animation.fromValue = <span class="number">0</span></span><br><span class="line">        animation.toValue = <span class="number">1</span></span><br><span class="line">        animation.repeatCount = .infinity</span><br><span class="line">        animation.duration = <span class="number">2</span></span><br><span class="line">        animation.beginTime = <span class="type">Self</span>.now</span><br><span class="line">        animation.autoreverses = <span class="literal">true</span></span><br><span class="line">        animation.timingFunction = <span class="type">CAMediaTimingFunction</span>(name: .easeInEaseOut)</span><br><span class="line">        <span class="keyword">return</span> animation</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-02-09T21:01:24.000Z" title="2020-02-09T21:01:24.000Z">2020-02-09</time><span class="level-item">6 minutes read (About 898 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-build-SwiftUI-style-UICollectionView-data-source-in-Swift/">How to build SwiftUI style UICollectionView data source in Swift</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/598">#598</a></strong></p>
<p>It’s hard to see any iOS app which don’t use UITableView or UICollectionView, as they are the basic and important foundation to represent data. <code>UICollectionView</code> is very basic to use, yet a bit tedious for common use cases, but if we abstract over it, then it becomes super hard to  customize. Every app is unique, and any attempt to wrap around UICollectionView will fail horribly. A sensable approach for a good abstraction is to make it super easy for normal cases, and easy to customize for advanced scenarios.</p>
<p>I’m always interested in how to make UICollectionView easier and fun to write and have curated many open sources here <a href="https://github.com/onmyway133/fantastic-ios-architecture#data-source">data source</a>. Many of these data source libraries try to come up with totally different namings and complex paradigm which makes it hard to onboard, and many are hard to customize.</p>
<p>In its simplest form, what we want in a UICollectionView data source is <code>cell = f(state)</code>, which means our cell representation is just a function of the state. We just want to set model to the cell, the correct cell, in a type safe manner.</p>
<h2 id="Generic-data-source"><a href="#Generic-data-source" class="headerlink" title="Generic data source"></a>Generic data source</h2><p>The basic is to make a generic data source that sticks with a particular cell</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DataSource</span>&lt;<span class="title">T</span>&gt;: <span class="title">NSObject</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> items: [<span class="type">T</span>]</span><br><span class="line">    <span class="keyword">let</span> configure: (<span class="type">T</span>, <span class="type">UICollectionViewCell</span>) -&gt; <span class="type">Void</span></span><br><span class="line">    <span class="keyword">let</span> select: (<span class="type">UICollectionViewCell</span>, <span class="type">IndexPath</span>) -&gt; <span class="type">Void</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This works for basic usage, and we can create multiple DataSource for each kind of model. The problem is it’s hard to subclass DataSource as generic in Swift and inheritance for ObjcC NSObject don’t work well.</p>
<h2 id="Check-for-the-types"><a href="#Check-for-the-types" class="headerlink" title="Check for the types"></a>Check for the types</h2><p>Seeing the problem with generic data source, I’ve tried another approach with <a href="https://github.com/onmyway133/Upstream">Upstream</a> where it’s easier to declare sections and models.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> sections: [<span class="type">Section</span>] = [</span><br><span class="line">    <span class="type">Section</span>(</span><br><span class="line">        header: <span class="type">Header</span>(model: <span class="type">Model</span>.header(<span class="string">"Information"</span>), viewType: <span class="type">HeaderView</span>.<span class="keyword">self</span>),</span><br><span class="line">        items: [</span><br><span class="line">            <span class="type">Item</span>(model: <span class="type">Model</span>.avatar(avatarUrl), cellType: <span class="type">AvatarCell</span>.<span class="keyword">self</span>),</span><br><span class="line">            <span class="type">Item</span>(model: <span class="type">Model</span>.name(<span class="string">"Thor"</span>), cellType: <span class="type">NameCell</span>.<span class="keyword">self</span>),</span><br><span class="line">            <span class="type">Item</span>(model: <span class="type">Model</span>.location(<span class="string">"Asgard"</span>), cellType: <span class="type">NameCell</span>.<span class="keyword">self</span>)</span><br><span class="line">        ]</span><br><span class="line">    ),</span><br><span class="line">    <span class="type">Section</span>(</span><br><span class="line">        header: <span class="type">Header</span>(model: <span class="type">Model</span>.header(<span class="string">"Skills"</span>), viewType: <span class="type">HeaderView</span>.<span class="keyword">self</span>),</span><br><span class="line">        items: [</span><br><span class="line">            <span class="type">Item</span>(model: <span class="type">Model</span>.skill(<span class="string">"iOS"</span>), cellType: <span class="type">SkillCell</span>.<span class="keyword">self</span>),</span><br><span class="line">            <span class="type">Item</span>(model: <span class="type">Model</span>.skill(<span class="string">"Android"</span>), cellType: <span class="type">SkillCell</span>.<span class="keyword">self</span>)</span><br><span class="line">        ]</span><br><span class="line">    )</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">adapter.reload(sections: sections)</span><br></pre></td></tr></table></figure>

<p>This uses the Adapter pattern and we need to handle <code>AdapterDelegate</code>. To avoid the generic problem, this Adapter store items as <code>Any</code>, so we need to type cast all the time.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">ProfileViewController</span>: <span class="title">AdapterDelegate</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">configure</span><span class="params">(model: <span class="keyword">Any</span>, view: UIView, indexPath: IndexPath)</span></span> &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> model = model <span class="keyword">as</span>? <span class="type">Model</span> <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span> (model, view) &#123;</span><br><span class="line">        <span class="keyword">case</span> (.avatar(<span class="keyword">let</span> string), <span class="keyword">let</span> cell <span class="keyword">as</span> <span class="type">Avatarcell</span>):</span><br><span class="line">            cell.configure(string: string)</span><br><span class="line">        <span class="keyword">case</span> (.name(<span class="keyword">let</span> name), <span class="keyword">let</span> cell <span class="keyword">as</span> <span class="type">NameCell</span>):</span><br><span class="line">            cell.configure(string: name)</span><br><span class="line">        <span class="keyword">case</span> (.header(<span class="keyword">let</span> string), <span class="keyword">let</span> view <span class="keyword">as</span> <span class="type">HeaderView</span>):</span><br><span class="line">            view.configure(string: string)</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The benefit is that we can easily subclass this Adapter manager to customize the behaviour, here is how to make accordion </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AccordionManager</span>&lt;<span class="title">T</span>&gt;: <span class="title">Manager</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> collapsedSections = <span class="type">Set</span>&lt;<span class="type">Int</span>&gt;()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">tableView</span><span class="params">(<span class="number">_</span> tableView: UITableView, numberOfRowsInSection section: Int)</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> collapsedSections.<span class="built_in">contains</span>(section)</span><br><span class="line">            ? <span class="number">0</span> : sections[section].items.<span class="built_in">count</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">toggle</span><span class="params">(section: Int)</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> collapsedSections.<span class="built_in">contains</span>(section) &#123;</span><br><span class="line">            collapsedSections.remove(section)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            collapsedSections.insert(section)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> indexSet = <span class="type">IndexSet</span>(integer: section)</span><br><span class="line">        tableView?.reloadSections(indexSet, with: .automatic)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="SwiftUI"><a href="#SwiftUI" class="headerlink" title="SwiftUI"></a>SwiftUI</h2><p>SwiftUI comes in iOS 13 with a very concise and easy to use syntax. SwiftUI has good diffing so we just need to update our models so the whole content will be diffed and rendered again.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> body: some <span class="type">View</span> &#123;</span><br><span class="line">    <span class="type">List</span> &#123;</span><br><span class="line">        <span class="type">ForEach</span>(blogs) &#123; blog <span class="keyword">in</span></span><br><span class="line">            <span class="type">VStack</span> &#123;</span><br><span class="line">                <span class="type">Text</span>(blog.name)</span><br><span class="line">            &#125;</span><br><span class="line">            .onTap &#123;</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">"cell was tapped"</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="SwiftUI-style-with-diffing"><a href="#SwiftUI-style-with-diffing" class="headerlink" title="SwiftUI style with diffing"></a>SwiftUI style with diffing</h2><p>I built <a href="https://github.com/onmyway133/DeepDiff">DeepDiff</a> before and it was used by many people. Now I’m pleased to introduce <a href="https://github.com/onmyway133/Micro">Micro</a> which is a SwiftU style with DeepDiff powered  so it performs fast diffing whenever state changes.</p>
<p>With <code>Micro</code> we can just use the familiar <code>forEach</code> to declare <code>Cell</code>, and the returned <code>State</code> will tell <code>DataSource</code> to update the <code>UICollectionView</code>.</p>
<p>Every time <code>state</code> is assigned, <code>UICollectionView</code> will be fast diffed and reloaded. The only requirement is that your model should conform to <code>DiffAware</code> with <code>diffId</code> so DeepDiff knows how to diff for changes.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> dataSource = <span class="type">DataSource</span>(collectionView: collectionView)</span><br><span class="line">dataSource.state = <span class="type">State</span> &#123;</span><br><span class="line">    <span class="type">ForEach</span>(blogs) &#123; blog <span class="keyword">in</span></span><br><span class="line">        <span class="type">Cell</span>&lt;<span class="type">BlogCell</span>&gt;() &#123; context, cell <span class="keyword">in</span></span><br><span class="line">            cell.nameLabel.text = blog.name</span><br><span class="line">        &#125;</span><br><span class="line">        .onSelect &#123; context <span class="keyword">in</span> </span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"cell at index \(context.indexPath.item) is selected"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        .onSize &#123; context <span class="keyword">in</span> </span><br><span class="line">            <span class="type">CGSize</span>(</span><br><span class="line">                width: context.collectionView.frame.size.width, </span><br><span class="line">                height: <span class="number">40</span></span><br><span class="line">            )</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>DataSource</code> is completely overridable, if you want to customize any methods, just subclass <code>DataSource</code>, override methods and access its <code>state.models</code> </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CustomDataSource</span>: <span class="title">DataSource</span> </span>&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">collectionView</span><span class="params">(<span class="number">_</span> collectionView: UICollectionView, didSelectItemAt indexPath: IndexPath)</span></span> &#123;</span><br><span class="line">        <span class="keyword">let</span> blog = state.models[indexPath.item] <span class="keyword">as</span>? <span class="type">Blog</span></span><br><span class="line">        <span class="built_in">print</span>(blog)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Diffable-data-source-in-iOS-13"><a href="#Diffable-data-source-in-iOS-13" class="headerlink" title="Diffable data source in iOS 13"></a>Diffable data source in iOS 13</h2><p>In iOS 13,  Apple adds <a href="https://developer.apple.com/documentation/uikit/views_and_controls/collection_views/using_collection_view_compositional_layouts_and_diffable_data_sources">Using Collection View Compositional Layouts and Diffable Data Sources</a> which is very handy.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">makeDataSource</span><span class="params">()</span></span> -&gt; <span class="type">UITableViewDiffableDataSource</span>&lt;<span class="type">Section</span>, <span class="type">Contact</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> reuseIdentifier = cellReuseIdentifier</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="type">UICollectionViewDiffableDataSource</span>(</span><br><span class="line">        collectionView: collectionView,</span><br><span class="line">        cellProvider: &#123;  collectionView, indexPath, blog <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">let</span> cell = tableView.dequeueReusableCell(</span><br><span class="line">                withIdentifier: reuseIdentifier,</span><br><span class="line">                <span class="keyword">for</span>: indexPath</span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line">            cell.textLabel?.text = blog.name</span><br><span class="line">            cell.detailTextLabel?.text = blog.email</span><br><span class="line">            <span class="keyword">return</span> cell</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This is iOS 13+  only, and the main components are the <code>cellProvider</code> acting as <code>cellForItemAtIndexPath</code>, and the snapshot for diffing. It also supports section.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> snapshot = <span class="type">NSDiffableDataSourceSnapshot</span>&lt;<span class="type">Section</span>, <span class="type">Blog</span>&gt;()</span><br><span class="line">dataSource.apply(snapshot, animatingDifferences: animate)</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-02-02T05:34:09.000Z" title="2020-02-02T05:34:09.000Z">2020-02-02</time><span class="level-item">a few seconds read (About 39 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-weak-link-Combine-in-macOS-10.14-and-iOS-12/">How to weak link Combine in macOS 10.14 and iOS 12</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/593">#593</a></strong></p>
<p><code>#if canImport(Combine)</code> is not enough, need to specify in Other Linker Flags</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">OTHER_LDFLAGS &#x3D; -weak_framework Combine</span><br></pre></td></tr></table></figure>

<h2 id="Read-more"><a href="#Read-more" class="headerlink" title="Read more"></a>Read more</h2><ul>
<li><a href="https://stackoverflow.com/questions/57168931/optional-linking-for-swift-combine-framework-in-xcode-11">https://stackoverflow.com/questions/57168931/optional-linking-for-swift-combine-framework-in-xcode-11</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-01-23T13:01:07.000Z" title="2020-01-23T13:01:07.000Z">2020-01-23</time><span class="level-item">a minute read (About 196 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-test-drag-and-drop-in-UITests/">How to test drag and drop in UITests</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/583">#583</a></strong></p>
<p>In UITests, we can use <code>press</code> from <code>XCUIElement</code> to test drag and drop</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> fromCat = app.buttons[<span class="string">"cat1"</span>].firstMatch</span><br><span class="line"><span class="keyword">let</span> toCat = app.buttons[<span class="string">"cat2"</span>]</span><br><span class="line"><span class="keyword">let</span> fromCoordinate = fromCat.coordinate(withNormalizedOffset: <span class="type">CGVector</span>(dx: <span class="number">0</span>, dy: <span class="number">0</span>))</span><br><span class="line"><span class="keyword">let</span> toCoordinate = toCat.coordinate(withNormalizedOffset: <span class="type">CGVector</span>(dx: <span class="number">0</span>, dy: -<span class="number">0.5</span>))</span><br><span class="line">fromCoordinate.press(forDuration: <span class="number">1</span>, thenDragTo: toCoordinate)</span><br></pre></td></tr></table></figure>

<p>and then take screenshot</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> screenshot = <span class="type">XCUIScreen</span>.main.screenshot()</span><br><span class="line"><span class="keyword">let</span> attachment = <span class="type">XCTAttachment</span>(screenshot: screenshot)</span><br><span class="line">attachment.lifetime = .keepAlways</span><br><span class="line">attachment.name = name</span><br><span class="line">add(attachment)</span><br></pre></td></tr></table></figure>

<p>Screenshot capturing happens after the action, so it may be too late. One way is to inject launch arguments, like <code>app.launchArguments.append(&quot;--dragdrop&quot;)</code> to alter some code in the app.</p>
<p>We can also swizzle gesture recognizer to alter behavior</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">UILongPressGestureRecognizer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@objc</span> <span class="keyword">var</span> uiTests_state: <span class="type">UIGestureRecognizer</span>.<span class="type">State</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> state = <span class="keyword">self</span>.uiTests_state</span><br><span class="line">        <span class="keyword">if</span> state == .ended &#123;</span><br><span class="line">            <span class="keyword">return</span> .changed</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> state</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> originalSelector = #selector(getter: <span class="type">UILongPressGestureRecognizer</span>.state)</span><br><span class="line"><span class="keyword">let</span> swizzledSelector = #selector(getter: <span class="type">UILongPressGestureRecognizer</span>.uiTests_state)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> originalMethod = class_getInstanceMethod(<span class="type">UILongPressGestureRecognizer</span>.<span class="keyword">self</span>, originalSelector)!</span><br><span class="line"><span class="keyword">let</span> swizzledMethod = class_getInstanceMethod(<span class="type">UILongPressGestureRecognizer</span>.<span class="keyword">self</span>, swizzledSelector)!</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> didAddMethod = class_addMethod(<span class="type">UILongPressGestureRecognizer</span>.<span class="keyword">self</span>, originalSelector, method_getImplementation(swizzledMethod), method_getTypeEncoding(swizzledMethod))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> didAddMethod &#123;</span><br><span class="line">    class_replaceMethod(<span class="type">UILongPressGestureRecognizer</span>.<span class="keyword">self</span>, swizzledSelector, method_getImplementation(originalMethod), method_getTypeEncoding(originalMethod))</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    method_exchangeImplementations(originalMethod, swizzledMethod)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-01-22T11:06:45.000Z" title="2020-01-22T11:06:45.000Z">2020-01-22</time><span class="level-item">6 minutes read (About 906 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-set-corner-radius-in-iOS/">How to set corner radius in iOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/582">#582</a></strong></p>
<h2 id="Use-View-Debugging"><a href="#Use-View-Debugging" class="headerlink" title="Use View Debugging"></a>Use View Debugging</h2><p>Run on device, <code>Xcode -&gt; Debug -&gt; View debugging -&gt; Rendering -&gt; Color blended layer</code><br>On <code>Simulator -&gt; Debug -&gt; Color Blended Layer</code></p>
<h2 id="Corner-radius"><a href="#Corner-radius" class="headerlink" title="Corner radius"></a>Corner radius</h2><ul>
<li><a href="https://twitter.com/timoliverau/status/1135999854176395264">https://twitter.com/timoliverau/status/1135999854176395264</a></li>
</ul>
<blockquote>
<p>Okay. Talked to a Core Animation engineer again:</p>
</blockquote>
<blockquote>
<ul>
<li>cornerRadius was deliberately improved in Metal so it could be used everywhere.</li>
<li>Using a bitmap is WAY heavier in terms of memory and performance.</li>
<li>CALayer maskLayer is still heavy.</li>
</ul>
</blockquote>
<p><a href="https://developer.apple.com/documentation/quartzcore/calayer/1410818-cornerradius">https://developer.apple.com/documentation/quartzcore/calayer/1410818-cornerradius</a></p>
<blockquote>
<p>Setting the radius to a value greater than 0.0 causes the layer to begin drawing rounded corners on its background. By default, the corner radius does not apply to the image in the layer’s contents property; it applies only to the background color and border of the layer. However, setting the masksToBounds property to true causes the content to be clipped to the rounded corners.</p>
</blockquote>
<p><a href="https://developer.apple.com/documentation/quartzcore/calayer/1410896-maskstobounds">https://developer.apple.com/documentation/quartzcore/calayer/1410896-maskstobounds</a></p>
<blockquote>
<p>When the value of this property is true, Core Animation creates an implicit clipping mask that matches the bounds of the layer and includes any corner radius effects. If a value for the mask property is also specified, the two masks are multiplied to get the final mask value.</p>
</blockquote>
<h2 id="Mask-layer"><a href="#Mask-layer" class="headerlink" title="Mask layer"></a>Mask layer</h2><p><code>layer.cornerRadius</code>, with or without <code>layer.maskedCorners</code> causes blending<br>Use mask layer instead of <code>layer.cornerRadius</code> to avoid blending, but mask causes offscreen rendering</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> mask = <span class="type">CAShapeLayer</span>()</span><br><span class="line"><span class="keyword">let</span> path = <span class="type">UIBezierPath</span>(</span><br><span class="line">    roundedRect: bounds,</span><br><span class="line">    byRoundingCorners: [.topLeft, .topRight, .bottomLeft, .bottomRight],</span><br><span class="line">    cornerRadii: <span class="type">CGSize</span>(width: <span class="number">20</span>, height: <span class="number">20</span>)</span><br><span class="line">)</span><br><span class="line">mask.path = path.cgPath</span><br><span class="line">layer.mask = mask</span><br></pre></td></tr></table></figure>
<h2 id="Offscreen-rendering"><a href="#Offscreen-rendering" class="headerlink" title="Offscreen rendering"></a>Offscreen rendering</h2><ul>
<li><a href="https://www.objc.io/issues/3-views/moving-pixels-onto-the-screen/">https://www.objc.io/issues/3-views/moving-pixels-onto-the-screen/</a></li>
</ul>
<blockquote>
<p>Instruments’ Core Animation Tool has an option called Color Offscreen-Rendered Yellow that will color regions yellow that have been rendered with an offscreen buffer (this option is also available in the Simulator’s Debug menu). Be sure to also check Color Hits Green and Misses Red. Green is for whenever an offscreen buffer is reused, while red is for when it had to be re-created.</p>
</blockquote>
<ul>
<li><a href="https://thoughtbot.com/blog/designing-for-ios-graphics-performance">https://thoughtbot.com/blog/designing-for-ios-graphics-performance</a></li>
</ul>
<blockquote>
<p>Offscreen drawing on the other hand refers to the process of generating bitmap graphics in the background using the CPU before handing them off to the GPU for onscreen rendering. In iOS, offscreen drawing occurs automatically in any of the following cases:</p>
</blockquote>
<blockquote>
<p>Core Graphics (any class prefixed with CG<em>)<br>The drawRect() method, even with an empty implementation.<br>CALayers with a shouldRasterize property set to YES.<br>CALayers using masks (setMasksToBounds) and dynamic shadows (setShadow</em>).<br>Any text displayed on screen, including Core Text.<br>Group opacity (UIViewGroupOpacity).</p>
</blockquote>
<h2 id="Instruments"><a href="#Instruments" class="headerlink" title="Instruments"></a>Instruments</h2><ul>
<li>Colors <a href="https://felixha.wordpress.com/2014/04/28/graphics-performance-tuning/">https://felixha.wordpress.com/2014/04/28/graphics-performance-tuning/</a></li>
</ul>
<h2 id="Read-more"><a href="#Read-more" class="headerlink" title="Read more"></a>Read more</h2><ul>
<li><a href="https://texturegroup.org/docs/corner-rounding.html">Corner Rounding</a></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">@abstract Sets the corner rounding method to use on the ASDisplayNode.</span><br><span class="line">There are three types of corner rounding provided by Texture: CALayer, Precomposited, and Clipping.</span><br><span class="line"></span><br><span class="line">- ASCornerRoundingTypeDefaultSlowCALayer: uses CALayer&#39;s inefficient .cornerRadius property. Use</span><br><span class="line">this type of corner in situations in which there is both movement through and movement underneath</span><br><span class="line">the corner (very rare). This uses only .cornerRadius.</span><br><span class="line"></span><br><span class="line">- ASCornerRoundingTypePrecomposited: corners are drawn using bezier paths to clip the content in a</span><br><span class="line">CGContext &#x2F; UIGraphicsContext. This requires .backgroundColor and .cornerRadius to be set. Use opaque</span><br><span class="line">background colors when possible for optimal efficiency, but transparent colors are supported and much</span><br><span class="line">more efficient than CALayer. The only limitation of this approach is that it cannot clip children, and</span><br><span class="line">thus works best for ASImageNodes or containers showing a background around their children.</span><br><span class="line"></span><br><span class="line">- ASCornerRoundingTypeClipping: overlays 4 separate opaque corners on top of the content that needs</span><br><span class="line">corner rounding. Requires .backgroundColor and .cornerRadius to be set. Use clip corners in situations</span><br><span class="line">in which is movement through the corner, with an opaque background (no movement underneath the corner).</span><br><span class="line">Clipped corners are ideal for animating &#x2F; resizing views, and still outperform CALayer.</span><br></pre></td></tr></table></figure>

<ul>
<li><a href="https://www.hackingwithswift.com/articles/79/how-to-find-and-fix-slow-drawing-using-instruments">https://www.hackingwithswift.com/articles/79/how-to-find-and-fix-slow-drawing-using-instruments</a></li>
<li><a href="https://stackoverflow.com/questions/35685726/uibezierpath-doesnt-work-in-topright-corner-and-bottomright-corner/43808103">https://stackoverflow.com/questions/35685726/uibezierpath-doesnt-work-in-topright-corner-and-bottomright-corner/43808103</a></li>
<li><a href="https://stackoverflow.com/questions/6731545/when-does-a-view-or-layer-require-offscreen-rendering">https://stackoverflow.com/questions/6731545/when-does-a-view-or-layer-require-offscreen-rendering</a></li>
</ul>
<blockquote>
<p>Generally, on iOS, pixel effects and Quartz / Core Graphics drawing are not hardware accelerated, and most other things are.<br>The following things are not hardware accelerated, which means that they need to be done in software (offscreen):<br>Anything done in a drawRect. If your view has a drawRect, even an empty one, the drawing is not done in hardware, and there is a performance penalty.<br>Any layer with the shouldRasterize property set to YES.<br>Any layer with a mask or drop shadow.<br>Text (any kind, including UILabels, CATextLayers, Core Text, etc).<br>Any drawing you do yourself (either onscreen or offscreen) using a CGContext.</p>
</blockquote>
<ul>
<li>Make overlay view <a href="https://stackoverflow.com/questions/13979935/setting-corner-radius-on-a-cell-kills-uicollectionviews-performance">https://stackoverflow.com/questions/13979935/setting-corner-radius-on-a-cell-kills-uicollectionviews-performance</a></li>
<li><a href="http://www.lukeparham.com/blog/2018/3/6/friends-dont-let-friends-render-offscreen">http://www.lukeparham.com/blog/2018/3/6/friends-dont-let-friends-render-offscreen</a></li>
</ul>
<blockquote>
<p>For example, writing your own draw method with Core Graphics means your rendering will technically be done in software (offscreen) as opposed to being hardware accelerated like it is when you use a normal CALayer. This is why manually rendering a UIImage with a CGContext is slower than just assigning the image to a UIImageView.</p>
</blockquote>
<ul>
<li><a href="https://github.com/seedante/OptimizationForOffscreenRender">https://github.com/seedante/OptimizationForOffscreenRender</a></li>
</ul>
<blockquote>
<p>if layer’s contents is nil or this contents has a transparent background, you just need to set cornerRadius. For UILabel, UITextView and UIButton, you can just set layer’s backgroundColor and cornerRadius to get a rounded corner. Note: UILabel’s backgroundColor is not its layer’s backgroundColor.</p>
</blockquote>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-01-20T13:21:29.000Z" title="2020-01-20T13:21:29.000Z">2020-01-20</time><span class="level-item">3 minutes read (About 407 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-work-with-SceneDelegate-in-iOS-12/">How to work with SceneDelegate in iOS 12</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/580">#580</a></strong></p>
<h2 id="Events"><a href="#Events" class="headerlink" title="Events"></a>Events</h2><h3 id="open-url"><a href="#open-url" class="headerlink" title="open url"></a>open url</h3><ul>
<li><a href="https://stackoverflow.com/questions/58624786/method-applicationopenurloptions-is-not-called">https://stackoverflow.com/questions/58624786/method-applicationopenurloptions-is-not-called</a></li>
</ul>
<blockquote>
<p>Implement scene(_:openURLContexts:) in your scene delegate.</p>
</blockquote>
<blockquote>
<p>If the URL launches your app, you will get scene(_:willConnectTo:options:) instead and it’s in the options.</p>
</blockquote>
<h3 id="life-cycle"><a href="#life-cycle" class="headerlink" title="life cycle"></a>life cycle</h3><ul>
<li><a href="https://stackoverflow.com/questions/56508764/app-delegate-methods-arent-being-called-in-ios-13">https://stackoverflow.com/questions/56508764/app-delegate-methods-arent-being-called-in-ios-13</a></li>
</ul>
<blockquote>
<p>Here’s how it works: If you have an “Application Scene Manifest” in your Info.plist and your app delegate has a configurationForConnectingSceneSession method, the UIApplication won’t send background and foreground lifecycle messages to your app delegate. That means the code in these methods won’t run:</p>
</blockquote>
<blockquote>
<p>applicationDidBecomeActive<br>applicationWillResignActive<br>applicationDidEnterBackground<br>applicationWillEnterForeground<br>The app delegate will still receive the willFinishLaunchingWithOptions: and didFinishLaunchingWithOptions: method calls so any code in those methods will work as before.</p>
</blockquote>
<h3 id="UIApplication-notifications"><a href="#UIApplication-notifications" class="headerlink" title="UIApplication notifications"></a>UIApplication notifications</h3><p>Notifications still trigger in iOS 13 if adopting SceneDelegate</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">UIApplication</span>.didBecomeActiveNotification</span><br><span class="line"><span class="type">UIApplication</span>.willResignActiveNotification</span><br></pre></td></tr></table></figure>
<p><a href="https://developer.apple.com/documentation/uikit/app_and_environment/scenes/preparing_your_ui_to_run_in_the_foreground">https://developer.apple.com/documentation/uikit/app_and_environment/scenes/preparing_your_ui_to_run_in_the_foreground</a></p>
<blockquote>
<p>Use foreground transitions to prepare your app’s UI to appear onscreen. An app’s transition to the foreground is usually in response to a user action. For example, when the user taps the app’s icon, the system launches the app and brings it to the foreground. Use a foreground transition to update your app’s UI, acquire resources, and start the services you need to handle user requests.</p>
</blockquote>
<blockquote>
<p>All state transitions result in UIKit sending notifications to the appropriate delegate object:</p>
</blockquote>
<blockquote>
<p>In iOS 13 and later—A UISceneDelegate object.<br>In iOS 12 and earlier—The UIApplicationDelegate object.</p>
</blockquote>
<blockquote>
<p>You can support both types of delegate objects, but UIKit always uses scene delegate objects when they are available. UIKit notifies only the scene delegate associated with the specific scene that is entering the foreground. For information about how to configure scene support, see Specifying the Scenes Your App Supports.</p>
</blockquote>
<h3 id="keyWindow"><a href="#keyWindow" class="headerlink" title="keyWindow"></a>keyWindow</h3><p>Show most recent active<code>UIWindow</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">UIApplication</span>.shared.keyWindow</span><br></pre></td></tr></table></figure>

<blockquote>
<p>This property holds the UIWindow object in the windows array that is most recently sent the makeKeyAndVisible() message.</p>
</blockquote>
<h2 id="AppDelegate-vs-SceneDelegate"><a href="#AppDelegate-vs-SceneDelegate" class="headerlink" title="AppDelegate vs SceneDelegate"></a>AppDelegate vs SceneDelegate</h2><h3 id="Get-sceneDelegate-from-AppDelegate"><a href="#Get-sceneDelegate-from-AppDelegate" class="headerlink" title="Get sceneDelegate from AppDelegate"></a>Get sceneDelegate from AppDelegate</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">UIApplication</span>.shared.openSessions.first?.scene?.delegate</span><br></pre></td></tr></table></figure>

<h3 id="order"><a href="#order" class="headerlink" title="order"></a>order</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SceneDelegate</span>.sceneDidBecomeActive</span><br><span class="line"><span class="type">UIApplication</span>.didBecomeActiveNotification</span><br><span class="line"><span class="type">SceneDelegate</span>.sceneWillResignActive</span><br><span class="line"><span class="type">UIApplication</span>.willResignActiveNotification</span><br></pre></td></tr></table></figure>

<h2 id="Read-more"><a href="#Read-more" class="headerlink" title="Read more"></a>Read more</h2><ul>
<li><a href="https://www.donnywals.com/add-ios-12-support-to-a-new-xcode-11-project/">https://www.donnywals.com/add-ios-12-support-to-a-new-xcode-11-project/</a></li>
<li><a href="https://www.donnywals.com/adding-support-for-multiple-windows-to-your-ipados-app/">https://www.donnywals.com/adding-support-for-multiple-windows-to-your-ipados-app/</a></li>
<li><a href="https://www.donnywals.com/understanding-the-ios-13-scene-delegate/">https://www.donnywals.com/understanding-the-ios-13-scene-delegate/</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-01-06T14:12:19.000Z" title="2020-01-06T14:12:19.000Z">2020-01-06</time><span class="level-item">a few seconds read (About 14 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-make-rotation-in-same-direction-in-iOS/">How to make rotation in same direction in iOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/571">#571</a></strong></p>
<p>From <code>CGFloat.pi / 2</code> to <code>-CGFloat.pi / 2 + epsilon</code></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-01-06T12:30:09.000Z" title="2020-01-06T12:30:09.000Z">2020-01-06</time><span class="level-item">3 minutes read (About 431 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-get-updated-safeAreaInsets-in-iOS/">How to get updated safeAreaInsets in iOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/570">#570</a></strong></p>
<h1 id="Use-viewSafeArea"><a href="#Use-viewSafeArea" class="headerlink" title="Use viewSafeArea"></a>Use viewSafeArea</h1><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@available</span>(iOS <span class="number">11.0</span>, *)</span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewSafeAreaInsetsDidChange</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.viewSafeAreaInsetsDidChange()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">self</span>.collectionView.reloadData()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Use <a href="https://developer.apple.com/documentation/uikit/uiview/2891102-safearealayoutguide">https://developer.apple.com/documentation/uikit/uiview/2891102-safearealayoutguide</a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">view.safeAreaLayoutGuide.layoutFrame</span><br></pre></td></tr></table></figure>

<p><a href="https://developer.apple.com/documentation/uikit/uiview/2891103-safeareainsets">https://developer.apple.com/documentation/uikit/uiview/2891103-safeareainsets</a></p>
<blockquote>
<p>For the view controller’s root view, the insets account for the status bar, other visible bars, and any additional insets that you specified using the additionalSafeAreaInsets property of your view controller. For other views in the view hierarchy, the insets reflect only the portion of the view that is covered. For example, if a view is entirely within the safe area of its superview, the edge insets in this property are 0.</p>
</blockquote>
<p>Use UICollectionView.contentInsetAdjustmentBehavior</p>
<h2 id="Nested-view"><a href="#Nested-view" class="headerlink" title="Nested view"></a>Nested view</h2><p>For UICollectionView inside Cell inside UICollectionView, its insets is 0, but its parent parent is correct, which is the original cell</p>
<p>UICollectionView -&gt; Cell -&gt; ContentView -&gt; UICollectionView</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">collectionView.superview?.superview?.safeAreaInsets</span><br></pre></td></tr></table></figure>

<p>viewWillAppear: safeAreaInsets is not set to collectionView<br>viewDidAppear: safeAreaInsets is set to collectionView and cells, but not to nested collectionView</p>
<p>In <code>viewSafeAreaInsetsDidChange</code>, invalidate outer and nested <code>collectionViewLayout</code></p>
<h2 id="Use-extendedLayoutIncludesOpaqueBars"><a href="#Use-extendedLayoutIncludesOpaqueBars" class="headerlink" title="Use extendedLayoutIncludesOpaqueBars"></a>Use extendedLayoutIncludesOpaqueBars</h2><p><a href="https://developer.apple.com/documentation/uikit/uiviewcontroller/1621404-extendedlayoutincludesopaquebars">https://developer.apple.com/documentation/uikit/uiviewcontroller/1621404-extendedlayoutincludesopaquebars</a></p>
<blockquote>
<p>A Boolean value indicating whether or not the extended layout includes opaque bars.</p>
</blockquote>
<p>Seems to affect left and right insets</p>
<ul>
<li><a href="https://stackoverflow.com/questions/18798792/explaining-difference-between-automaticallyadjustsscrollviewinsets-extendedlayo">https://stackoverflow.com/questions/18798792/explaining-difference-between-automaticallyadjustsscrollviewinsets-extendedlayo</a></li>
<li><a href="https://medium.com/@wailord/extended-layout-in-ios-pre-ios-11-5eff2debf28">https://medium.com/@wailord/extended-layout-in-ios-pre-ios-11-5eff2debf28</a></li>
</ul>
<h2 id="Seemingly-related-to-UIPresentationController"><a href="#Seemingly-related-to-UIPresentationController" class="headerlink" title="Seemingly related to UIPresentationController"></a>Seemingly related to UIPresentationController</h2><p>But it’s not, it is because of when safeAreaInsets is available, and how it is passed to nested view</p>
<p>When invalidating collection view layout with custom <code>UIPresentationController</code>, <code>alongsideTransition</code> is called twice, the first time with old <code>safeAreaInsets</code>, and the second time with latest <code>safeAreaInsets</code></p>
<p>And the layout invalidation uses the old insets.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewWillTransition</span><span class="params">(to size: CGSize, with coordinator: UIViewControllerTransitionCoordinator)</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.viewWillTransition(to: size, with: coordinator)</span><br><span class="line">    coordinator.animate(alongsideTransition: &#123; <span class="number">_</span> <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">self</span>.collectionViewLayout.invalidateLayout()</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Dispatch</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// UIViewController subclass</span></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewWillTransition</span><span class="params">(to size: CGSize, with coordinator: UIViewControllerTransitionCoordinator)</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.viewWillTransition(to: size, with: coordinator)</span><br><span class="line">    coordinator.animate(alongsideTransition: &#123; <span class="number">_</span> <span class="keyword">in</span></span><br><span class="line">        <span class="type">DispatchQueue</span>.main.async &#123;</span><br><span class="line">            <span class="keyword">self</span>.collectionViewLayout.invalidateLayout()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Call layoutIfNeeded</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// UIPresentationController subclass</span></span><br><span class="line"><span class="keyword">override</span> <span class="keyword">var</span> frameOfPresentedViewInContainerView: <span class="type">CGRect</span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> containerView = containerView <span class="keyword">else</span> &#123; <span class="keyword">return</span> .zero &#125;</span><br><span class="line">    </span><br><span class="line">    presentedView?.setNeedsLayout()</span><br><span class="line">    presentedView?.layoutIfNeeded()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ...</span><br></pre></td></tr></table></figure>

<h2 id="Check"><a href="#Check" class="headerlink" title="Check"></a>Check</h2><p>Check that UICollectionView or the view you’re working on is in view hierarchy</p>
<ul>
<li><a href="https://stackoverflow.com/questions/46271186/safe-area-not-work-properly-on-iphone-x-when-subviews-are-not-in-the-view-area">https://stackoverflow.com/questions/46271186/safe-area-not-work-properly-on-iphone-x-when-subviews-are-not-in-the-view-area</a></li>
</ul>
<p>Check that you’re using code in viewDidLayoutSubviews when safeAreaInsets is known</p>
<h2 id="Read-more"><a href="#Read-more" class="headerlink" title="Read more"></a>Read more</h2><ul>
<li><a href="https://www.appcoda.com/presentation-controllers-tutorial/">https://www.appcoda.com/presentation-controllers-tutorial/</a></li>
<li><a href="https://fluffy.es/4-ios13-breaking-changes/">https://fluffy.es/4-ios13-breaking-changes/</a></li>
<li><a href="https://developer.apple.com/documentation/uikit/uiview/positioning_content_relative_to_the_safe_area">https://developer.apple.com/documentation/uikit/uiview/positioning_content_relative_to_the_safe_area</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-01-06T12:01:57.000Z" title="2020-01-06T12:01:57.000Z">2020-01-06</time><span class="level-item">a minute read (About 194 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-disable-implicit-decoration-view-animation-in-UICollectionView/">How to disable implicit decoration view animation in UICollectionView</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/569">#569</a></strong></p>
<p>From documentation <a href="https://developer.apple.com/documentation/uikit/uicollectionviewlayout/1617726-initiallayoutattributesforappear">https://developer.apple.com/documentation/uikit/uicollectionviewlayout/1617726-initiallayoutattributesforappear</a></p>
<blockquote>
<p>This method is called after the prepare(forCollectionViewUpdates:) method and before the finalizeCollectionViewUpdates() method for any decoration views that are about to be inserted. Your implementation should return the layout information that describes the initial position and state of the view. The collection view uses this information as the starting point for any animations. (The end point of the animation is the view’s new location in the collection view.) If you return nil, the layout object uses the item’s final attributes for both the start and end points of the animation.</p>
</blockquote>
<blockquote>
<p>The default implementation of this method returns nil.</p>
</blockquote>
<p>Although the doc says “The default implementation of this method returns nil”, calling <code>super.initialLayoutAttributesForAppearingDecorationElement</code> gives somehow implicit animation. The workaround is to explicitly return nil</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">initialLayoutAttributesForAppearingDecorationElement</span><span class="params">(ofKind elementKind: String, at decorationIndexPath: IndexPath)</span></span> -&gt; <span class="type">UICollectionViewLayoutAttributes?</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">finalLayoutAttributesForDisappearingDecorationElement</span><span class="params">(ofKind elementKind: String, at decorationIndexPath: IndexPath)</span></span> -&gt; <span class="type">UICollectionViewLayoutAttributes?</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Decoration seems to be removed when all items are removed. Workaround is to check and only add decoration when there is preferred data or cell</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-01-04T06:46:50.000Z" title="2020-01-04T06:46:50.000Z">2020-01-04</time><span class="level-item">7 minutes read (About 988 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-make-simple-adapter-for-delegate-and-datasource-for-UICollectionView-and-UITableView/">How to make simple adapter for delegate and datasource for UICollectionView and UITableView</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/567">#567</a></strong></p>
<h2 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h2><ul>
<li><a href="https://github.com/onmyway133/Upstream/">Upstream</a></li>
</ul>
<h2 id="Make-open-Adapter"><a href="#Make-open-Adapter" class="headerlink" title="Make open Adapter"></a>Make open Adapter</h2><ul>
<li><a href="https://github.com/onmyway133/Upstream">https://github.com/onmyway133/Upstream</a></li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">protocol</span> <span class="title">AdapterDelegate</span>: <span class="title">class</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// Apply model to view</span></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">configure</span><span class="params">(model: <span class="keyword">Any</span>, view: UIView, indexPath: IndexPath)</span></span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/// Handle view selection</span></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">select</span><span class="params">(model: <span class="keyword">Any</span>)</span></span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/// Size the view</span></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">size</span><span class="params">(model: <span class="keyword">Any</span>, containerSize: CGSize)</span></span> -&gt; <span class="type">CGSize</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// Act as DataSource and Delegate for UICollectionView, UITableView</span></span><br><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">Adapter</span>: <span class="title">NSObject</span>,</span></span><br><span class="line"><span class="class">  <span class="title">UICollectionViewDataSource</span>, <span class="title">UICollectionViewDelegateFlowLayout</span>,</span></span><br><span class="line"><span class="class"><span class="title">UITableViewDataSource</span>, <span class="title">UITableViewDelegate</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">var</span> sections: [<span class="type">Section</span>] = []</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">weak</span> <span class="keyword">var</span> collectionView: <span class="type">UICollectionView?</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">weak</span> <span class="keyword">var</span> tableView: <span class="type">UITableView?</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">weak</span> <span class="keyword">var</span> delegate: <span class="type">AdapterDelegate?</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> registryService = <span class="type">RegistryService</span>()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// MARK: - Initialiser</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">required</span> <span class="keyword">init</span>(collectionView: <span class="type">UICollectionView</span>) &#123;</span><br><span class="line">    <span class="keyword">self</span>.collectionView = collectionView</span><br><span class="line">    <span class="keyword">super</span>.<span class="keyword">init</span>()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">required</span> <span class="keyword">init</span>(tableView: <span class="type">UITableView</span>) &#123;</span><br><span class="line">    <span class="keyword">self</span>.tableView = tableView</span><br><span class="line">    <span class="keyword">super</span>.<span class="keyword">init</span>()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// MARK: - UICollectionViewDataSource</span></span><br><span class="line">  <span class="keyword">open</span> <span class="function"><span class="keyword">func</span> <span class="title">numberOfSections</span><span class="params">(<span class="keyword">in</span> collectionView: UICollectionView)</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> sections.<span class="built_in">count</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">open</span> <span class="function"><span class="keyword">func</span> <span class="title">collectionView</span><span class="params">(<span class="number">_</span> collectionView: UICollectionView,</span></span></span><br><span class="line"><span class="function"><span class="params">                           numberOfItemsInSection section: Int)</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> sections[section].items.<span class="built_in">count</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">open</span> <span class="function"><span class="keyword">func</span> <span class="title">collectionView</span><span class="params">(<span class="number">_</span> collectionView: UICollectionView,</span></span></span><br><span class="line"><span class="function"><span class="params">                           cellForItemAt indexPath: IndexPath)</span></span> -&gt; <span class="type">UICollectionViewCell</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> item = sections[indexPath.section].items[indexPath.row]</span><br><span class="line">    <span class="keyword">let</span> cell = collectionView.dequeueReusableCell(</span><br><span class="line">      withReuseIdentifier: item.cellType.typeName,</span><br><span class="line">      <span class="keyword">for</span>: indexPath)</span><br><span class="line"></span><br><span class="line">    delegate?.configure(model: item.model, view: cell, indexPath: indexPath)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> cell</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">open</span> <span class="function"><span class="keyword">func</span> <span class="title">collectionView</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="number">_</span> collectionView: UICollectionView,</span></span></span><br><span class="line"><span class="function"><span class="params">    viewForSupplementaryElementOfKind kind: String,</span></span></span><br><span class="line"><span class="function"><span class="params">    at indexPath: IndexPath)</span></span> -&gt; <span class="type">UICollectionReusableView</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> header = sections[indexPath.section].header,</span><br><span class="line">      kind == <span class="type">UICollectionElementKindSectionHeader</span> &#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">let</span> view = collectionView.dequeueReusableSupplementaryView(</span><br><span class="line">        ofKind: <span class="type">UICollectionElementKindSectionHeader</span>,</span><br><span class="line">        withReuseIdentifier: header.viewType.typeName,</span><br><span class="line">        <span class="keyword">for</span>: indexPath</span><br><span class="line">      )</span><br><span class="line"></span><br><span class="line">      delegate?.configure(model: header.model, view: view, indexPath: indexPath)</span><br><span class="line">      <span class="keyword">return</span> view</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> <span class="keyword">let</span> footer = sections[indexPath.section].footer,</span><br><span class="line">      kind == <span class="type">UICollectionElementKindSectionFooter</span> &#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">let</span> view = collectionView.dequeueReusableSupplementaryView(</span><br><span class="line">        ofKind: <span class="type">UICollectionElementKindSectionFooter</span>,</span><br><span class="line">        withReuseIdentifier: footer.viewType.typeName,</span><br><span class="line">        <span class="keyword">for</span>: indexPath</span><br><span class="line">      )</span><br><span class="line"></span><br><span class="line">      delegate?.configure(model: footer.model, view: view, indexPath: indexPath)</span><br><span class="line">      <span class="keyword">return</span> view</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> view = <span class="type">DummyReusableView</span>()</span><br><span class="line">      view.isHidden = <span class="literal">true</span></span><br><span class="line">      <span class="keyword">return</span> view</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// MARK: - UICollectionViewDelegate</span></span><br><span class="line">  <span class="keyword">open</span> <span class="function"><span class="keyword">func</span> <span class="title">collectionView</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="number">_</span> collectionView: UICollectionView,</span></span></span><br><span class="line"><span class="function"><span class="params">    didSelectItemAt indexPath: IndexPath)</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> item = sections[indexPath.section].items[indexPath.row]</span><br><span class="line">    delegate?.select(model: item.model)</span><br><span class="line">    collectionView.deselectItem(at: indexPath, animated: <span class="literal">true</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">open</span> <span class="function"><span class="keyword">func</span> <span class="title">collectionView</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="number">_</span> collectionView: UICollectionView,</span></span></span><br><span class="line"><span class="function"><span class="params">    layout collectionViewLayout: UICollectionViewLayout,</span></span></span><br><span class="line"><span class="function"><span class="params">    sizeForItemAt indexPath: IndexPath)</span></span> -&gt; <span class="type">CGSize</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> item = sections[indexPath.section].items[indexPath.row]</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> size = delegate?.size(model: item.model, containerSize: collectionView.frame.size) &#123;</span><br><span class="line">      <span class="keyword">return</span> size</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> size = (collectionViewLayout <span class="keyword">as</span>? <span class="type">UICollectionViewFlowLayout</span>)?.itemSize &#123;</span><br><span class="line">      <span class="keyword">return</span> size</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> collectionView.frame.size</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">open</span> <span class="function"><span class="keyword">func</span> <span class="title">collectionView</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="number">_</span> collectionView: UICollectionView,</span></span></span><br><span class="line"><span class="function"><span class="params">    layout collectionViewLayout: UICollectionViewLayout,</span></span></span><br><span class="line"><span class="function"><span class="params">    referenceSizeForHeaderInSection section: Int)</span></span> -&gt; <span class="type">CGSize</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> header = sections[section].header <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> .zero</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> size = delegate?.size(model: header.model, containerSize: collectionView.frame.size) <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> .zero</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> size</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">open</span> <span class="function"><span class="keyword">func</span> <span class="title">collectionView</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="number">_</span> collectionView: UICollectionView,</span></span></span><br><span class="line"><span class="function"><span class="params">    layout collectionViewLayout: UICollectionViewLayout,</span></span></span><br><span class="line"><span class="function"><span class="params">    referenceSizeForFooterInSection section: Int)</span></span> -&gt; <span class="type">CGSize</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> footer = sections[section].footer <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> .zero</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> size = delegate?.size(model: footer.model, containerSize: collectionView.frame.size) <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> .zero</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> size</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// MARK: - Reload</span></span><br><span class="line">  <span class="keyword">open</span> <span class="function"><span class="keyword">func</span> <span class="title">reload</span><span class="params">(sections: [Section])</span></span> &#123;</span><br><span class="line">    <span class="comment">// Registry</span></span><br><span class="line">    registryService.registerIfNeeded(</span><br><span class="line">      collectionView: collectionView,</span><br><span class="line">      tableView: tableView,</span><br><span class="line">      sections: sections</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">self</span>.sections = sections</span><br><span class="line">    collectionView?.reloadData()</span><br><span class="line">    tableView?.reloadData()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// MARK: - UITableViewDataSource</span></span><br><span class="line">  <span class="keyword">open</span> <span class="function"><span class="keyword">func</span> <span class="title">numberOfSections</span><span class="params">(<span class="keyword">in</span> tableView: UITableView)</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> sections.<span class="built_in">count</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">open</span> <span class="function"><span class="keyword">func</span> <span class="title">tableView</span><span class="params">(<span class="number">_</span> tableView: UITableView, numberOfRowsInSection section: Int)</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> sections[section].items.<span class="built_in">count</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">open</span> <span class="function"><span class="keyword">func</span> <span class="title">tableView</span><span class="params">(<span class="number">_</span> tableView: UITableView, cellForRowAt indexPath: IndexPath)</span></span> -&gt; <span class="type">UITableViewCell</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> item = sections[indexPath.section].items[indexPath.row]</span><br><span class="line">    <span class="keyword">let</span> cell = tableView.dequeueReusableCell(</span><br><span class="line">      withIdentifier: item.cellType.typeName,</span><br><span class="line">      <span class="keyword">for</span>: indexPath</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    delegate?.configure(model: item.model, view: cell, indexPath: indexPath)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> cell</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// MARK: - UITableViewDelegate</span></span><br><span class="line">  <span class="keyword">open</span> <span class="function"><span class="keyword">func</span> <span class="title">tableView</span><span class="params">(<span class="number">_</span> tableView: UITableView, didSelectRowAt indexPath: IndexPath)</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> item = sections[indexPath.section].items[indexPath.row]</span><br><span class="line">    delegate?.select(model: item.model)</span><br><span class="line">    tableView.deselectRow(at: indexPath, animated: <span class="literal">true</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">open</span> <span class="function"><span class="keyword">func</span> <span class="title">tableView</span><span class="params">(<span class="number">_</span> tableView: UITableView, heightForRowAt indexPath: IndexPath)</span></span> -&gt; <span class="type">CGFloat</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> item = sections[indexPath.section].items[indexPath.row]</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> size = delegate?.size(model: item.model, containerSize: tableView.frame.size) &#123;</span><br><span class="line">      <span class="keyword">return</span> size.height</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">open</span> <span class="function"><span class="keyword">func</span> <span class="title">tableView</span><span class="params">(<span class="number">_</span> tableView: UITableView, heightForHeaderInSection section: Int)</span></span> -&gt; <span class="type">CGFloat</span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> header = sections[section].header <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> size = delegate?.size(model: header.model, containerSize: tableView.frame.size) <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> size.height</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">open</span> <span class="function"><span class="keyword">func</span> <span class="title">tableView</span><span class="params">(<span class="number">_</span> tableView: UITableView, heightForFooterInSection section: Int)</span></span> -&gt; <span class="type">CGFloat</span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> footer = sections[section].footer <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> size = delegate?.size(model: footer.model, containerSize: tableView.frame.size) <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> size.height</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">open</span> <span class="function"><span class="keyword">func</span> <span class="title">tableView</span><span class="params">(<span class="number">_</span> tableView: UITableView, viewForHeaderInSection section: Int)</span></span> -&gt; <span class="type">UIView?</span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> header = sections[section].header <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> view = tableView.dequeueReusableHeaderFooterView(withIdentifier: header.viewType.typeName) <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    delegate?.configure(model: header.model, view: view, indexPath: <span class="type">IndexPath</span>(row: <span class="number">0</span>, section: section))</span><br><span class="line">    <span class="keyword">return</span> view</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">open</span> <span class="function"><span class="keyword">func</span> <span class="title">tableView</span><span class="params">(<span class="number">_</span> tableView: UITableView, viewForFooterInSection section: Int)</span></span> -&gt; <span class="type">UIView?</span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> footer = sections[section].footer <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> view = tableView.dequeueReusableHeaderFooterView(withIdentifier: footer.viewType.typeName) <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    delegate?.configure(model: footer.model, view: view, indexPath: <span class="type">IndexPath</span>(row: <span class="number">0</span>, section: section))</span><br><span class="line">    <span class="keyword">return</span> view</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Declare-data"><a href="#Declare-data" class="headerlink" title="Declare data"></a>Declare data</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> sections: [<span class="type">Section</span>] = [</span><br><span class="line">  <span class="type">Section</span>(</span><br><span class="line">    header: <span class="type">Header</span>(model: <span class="type">Model</span>.header(<span class="string">"Information"</span>), viewType: <span class="type">HeaderView</span>.<span class="keyword">self</span>),</span><br><span class="line">    items: [</span><br><span class="line">      <span class="type">Item</span>(model: <span class="type">Model</span>.avatar(avatarUrl), cellType: <span class="type">AvatarCell</span>.<span class="keyword">self</span>),</span><br><span class="line">      <span class="type">Item</span>(model: <span class="type">Model</span>.name(<span class="string">"Thor"</span>), cellType: <span class="type">NameCell</span>.<span class="keyword">self</span>),</span><br><span class="line">      <span class="type">Item</span>(model: <span class="type">Model</span>.location(<span class="string">"Asgard"</span>), cellType: <span class="type">NameCell</span>.<span class="keyword">self</span>)</span><br><span class="line">    ]</span><br><span class="line">  ),</span><br><span class="line">  <span class="type">Section</span>(</span><br><span class="line">    header: <span class="type">Header</span>(model: <span class="type">Model</span>.header(<span class="string">"Skills"</span>), viewType: <span class="type">HeaderView</span>.<span class="keyword">self</span>),</span><br><span class="line">    items: [</span><br><span class="line">      <span class="type">Item</span>(model: <span class="type">Model</span>.skill(<span class="string">"iOS"</span>), cellType: <span class="type">SkillCell</span>.<span class="keyword">self</span>),</span><br><span class="line">      <span class="type">Item</span>(model: <span class="type">Model</span>.skill(<span class="string">"Android"</span>), cellType: <span class="type">SkillCell</span>.<span class="keyword">self</span>)</span><br><span class="line">    ]</span><br><span class="line">  )</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">adapter.reload(sections: sections)</span><br></pre></td></tr></table></figure>

<h2 id="Configure-required-blocks"><a href="#Configure-required-blocks" class="headerlink" title="Configure required blocks"></a>Configure required blocks</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">ProfileViewController</span>: <span class="title">AdapterDelegate</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">configure</span><span class="params">(model: <span class="keyword">Any</span>, view: UIView, indexPath: IndexPath)</span></span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> model = model <span class="keyword">as</span>? <span class="type">Model</span> <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span> (model, view) &#123;</span><br><span class="line">    <span class="keyword">case</span> (.avatar(<span class="keyword">let</span> string), <span class="keyword">let</span> cell <span class="keyword">as</span> <span class="type">Avatarcell</span>):</span><br><span class="line">      cell.configure(string: string)</span><br><span class="line">    <span class="keyword">case</span> (.name(<span class="keyword">let</span> name), <span class="keyword">let</span> cell <span class="keyword">as</span> <span class="type">NameCell</span>):</span><br><span class="line">      cell.configure(string: name)</span><br><span class="line">    <span class="keyword">case</span> (.header(<span class="keyword">let</span> string), <span class="keyword">let</span> view <span class="keyword">as</span> <span class="type">HeaderView</span>):</span><br><span class="line">      view.configure(string: string)</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">select</span><span class="params">(model: <span class="keyword">Any</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> model = model <span class="keyword">as</span>? <span class="type">Model</span> <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span> model &#123;</span><br><span class="line">    <span class="keyword">case</span> .skill(<span class="keyword">let</span> skill):</span><br><span class="line">      <span class="keyword">let</span> skillController = <span class="type">SkillController</span>(skill: skill)</span><br><span class="line">      navigationController?.pushViewController(skillController, animated: <span class="literal">true</span>)</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">size</span><span class="params">(model: <span class="keyword">Any</span>, containerSize: CGSize)</span></span> -&gt; <span class="type">CGSize</span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> model = model <span class="keyword">as</span>? <span class="type">Model</span> <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> .zero</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span> model &#123;</span><br><span class="line">    <span class="keyword">case</span> .name:</span><br><span class="line">      <span class="keyword">return</span> <span class="type">CGSize</span>(width: containerSize.width, height: <span class="number">40</span>)</span><br><span class="line">    <span class="keyword">case</span> .avatar:</span><br><span class="line">      <span class="keyword">return</span> <span class="type">CGSize</span>(width: containerSize.width, height: <span class="number">200</span>)</span><br><span class="line">    <span class="keyword">case</span> .header:</span><br><span class="line">      <span class="keyword">return</span> <span class="type">CGSize</span>(width: containerSize.width, height: <span class="number">30</span>)</span><br><span class="line">     <span class="keyword">default</span>:</span><br><span class="line">       <span class="keyword">return</span> .zero</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Extending-Manager"><a href="#Extending-Manager" class="headerlink" title="Extending Manager"></a>Extending Manager</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AccordionManager</span>&lt;<span class="title">T</span>&gt;: <span class="title">Manager</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">var</span> collapsedSections = <span class="type">Set</span>&lt;<span class="type">Int</span>&gt;()</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">tableView</span><span class="params">(<span class="number">_</span> tableView: UITableView, numberOfRowsInSection section: Int)</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> collapsedSections.<span class="built_in">contains</span>(section)</span><br><span class="line">      ? <span class="number">0</span> : sections[section].items.<span class="built_in">count</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">toggle</span><span class="params">(section: Int)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> collapsedSections.<span class="built_in">contains</span>(section) &#123;</span><br><span class="line">      collapsedSections.remove(section)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      collapsedSections.insert(section)</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">let</span> indexSet = <span class="type">IndexSet</span>(integer: section)</span><br><span class="line">    tableView?.reloadSections(indexSet, with: .automatic)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-12-30T14:58:11.000Z" title="2019-12-30T14:58:11.000Z">2019-12-30</time><span class="level-item">a few seconds read (About 62 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-use-safeAreaInsets-in-iOS/">How to use safeAreaInsets in iOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/561">#561</a></strong></p>
<h2 id="Read-more"><a href="#Read-more" class="headerlink" title="Read more"></a>Read more</h2><ul>
<li><a href="https://medium.com/rosberryapps/ios-safe-area-ca10e919526f">https://medium.com/rosberryapps/ios-safe-area-ca10e919526f</a></li>
<li><a href="https://blog.smartnsoft.com/layout-guide-margins-insets-and-safe-area-demystified-on-ios-10-11-d6e7246d7cb8">https://blog.smartnsoft.com/layout-guide-margins-insets-and-safe-area-demystified-on-ios-10-11-d6e7246d7cb8</a></li>
<li><a href="https://www.matrixprojects.net/p/safe-area-insets/">https://www.matrixprojects.net/p/safe-area-insets/</a></li>
<li><a href="https://stackoverflow.com/questions/37796884/on-ios-what-are-the-differences-between-margins-edge-insets-content-insets-a/47614397">https://stackoverflow.com/questions/37796884/on-ios-what-are-the-differences-between-margins-edge-insets-content-insets-a/47614397</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-12-20T14:08:25.000Z" title="2019-12-20T14:08:25.000Z">2019-12-20</time><span class="level-item">a few seconds read (About 14 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/Why-is-didSelectItem-not-called-in-UICollectionView/">Why is didSelectItem not called in UICollectionView</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/550">#550</a></strong></p>
<h2 id="Check"><a href="#Check" class="headerlink" title="Check"></a>Check</h2><ul>
<li>shouldHighlightItem -&gt; shouldSelectItem -&gt; didSelectItem</li>
<li>Gesture recognizer</li>
<li>isUserInteractionEnabled</li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-12-18T13:21:44.000Z" title="2019-12-18T13:21:44.000Z">2019-12-18</time><span class="level-item">a few seconds read (About 20 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-use-deep-link-and-universal-link-in-iOS/">How to use deep link and universal link in iOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/548">#548</a></strong></p>
<ul>
<li><a href="https://stackoverflow.com/questions/35522618/universal-links-on-ios-vs-deep-links-url-schemes">https://stackoverflow.com/questions/35522618/universal-links-on-ios-vs-deep-links-url-schemes</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-12-12T21:05:08.000Z" title="2019-12-12T21:05:08.000Z">2019-12-12</time><span class="level-item">a few seconds read (About 104 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-take-screenshots-for-UITest-in-Xcodee/">How to  take screenshots for UITest in Xcodee</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/539">#539</a></strong></p>
<h2 id="XCUIScreenshot"><a href="#XCUIScreenshot" class="headerlink" title="XCUIScreenshot"></a>XCUIScreenshot</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">XCTestCase</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">takeScreenshot</span><span class="params">(name: String)</span></span> &#123;</span><br><span class="line">        <span class="keyword">let</span> screenshot = <span class="type">XCUIScreen</span>.main.screenshot()</span><br><span class="line">        <span class="keyword">let</span> attach = <span class="type">XCTAttachment</span>(screenshot: screenshot)</span><br><span class="line">        attach.lifetime = .keepAlways</span><br><span class="line">        add(attach)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img width="897" alt="Screenshot 2019-12-12 at 23 02 21" src="https://user-images.githubusercontent.com/2284279/70752739-82031880-1d33-11ea-8b43-1af56db648f7.png">

<h2 id="Gather-screenshot-for-localization"><a href="#Gather-screenshot-for-localization" class="headerlink" title="Gather screenshot for localization"></a>Gather screenshot for localization</h2><ul>
<li><a href="https://developer.apple.com/videos/play/wwdc2019/403/">Creating Great Localized Experiences with Xcode 11</a></li>
</ul>
<h3 id="xcresult-from-Xcode-11"><a href="#xcresult-from-Xcode-11" class="headerlink" title="xcresult from Xcode 11"></a>xcresult from Xcode 11</h3><ul>
<li><a href="https://www.chargepoint.com/engineering/xcparse/">https://www.chargepoint.com/engineering/xcparse/</a></li>
<li><a href="https://github.com/ChargePoint/xcparse">xcparse</a> Command line tool &amp; Swift framework for parsing Xcode 11+ xcresult</li>
</ul>
<h3 id="xcresulttool"><a href="#xcresulttool" class="headerlink" title="xcresulttool"></a>xcresulttool</h3><ul>
<li><a href="https://developer.apple.com/videos/play/wwdc2019/413/?time=2932">Testing in Xcode</a></li>
</ul>
<h2 id="Test-plan"><a href="#Test-plan" class="headerlink" title="Test plan"></a>Test plan</h2><ul>
<li><a href="https://shashikantjagtap.net/wwdc19-getting-started-with-test-plan-for-xctest/">WWDC19: Getting Started with Test Plan for XCTest</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-12-11T08:40:44.000Z" title="2019-12-11T08:40:44.000Z">2019-12-11</time><span class="level-item">a few seconds read (About 66 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-fix-UIToolbar-Auto-Layout-issues/">How to fix UIToolbar Auto Layout issues</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/538">#538</a></strong></p>
<h2 id="Hierarchy"><a href="#Hierarchy" class="headerlink" title="Hierarchy"></a>Hierarchy</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UIToolbar -&gt; _UIToolbarContentView -&gt; _UIButtonBarStackVie</span><br></pre></td></tr></table></figure>

<h3 id="UIToolbarContentView"><a href="#UIToolbarContentView" class="headerlink" title="UIToolbarContentView"></a>UIToolbarContentView</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">_UIToolbarContentView&#39;s width should equal 0</span><br><span class="line">_UIToolbarContentView&#39;s height should equal 0</span><br></pre></td></tr></table></figure>

<p>Workaround that fixes 1 warning</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">toolbar.setItems(items, animated: <span class="literal">false</span>)</span><br><span class="line">toolbar.updateConstraintsIfNeeded()</span><br></pre></td></tr></table></figure>

<p>### </p>
<h2 id="Set-frame-explicitly"><a href="#Set-frame-explicitly" class="headerlink" title="Set frame explicitly"></a>Set frame explicitly</h2><p>Use a non <code>.zero</code> frame that is close to the view bounds width</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> toolbar = <span class="type">UIToolbar</span>(frame: <span class="type">CGRect</span>(x: <span class="number">0</span>, y: <span class="number">0</span>, width: <span class="number">375</span>, height: <span class="number">30</span>))</span><br><span class="line"><span class="type">DispatchQueue</span>.main.async &#123;</span><br><span class="line">    <span class="keyword">self</span>.toolbar.updateConstraintsIfNeeded()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-12-10T21:07:02.000Z" title="2019-12-10T21:07:02.000Z">2019-12-10</time><span class="level-item">a few seconds read (About 107 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-use-passed-launch-arguments-in-UITests/">How to use passed launch arguments in UITests</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/537">#537</a></strong></p>
<h2 id="Specify-launch-arguments"><a href="#Specify-launch-arguments" class="headerlink" title="Specify launch arguments"></a>Specify launch arguments</h2><p>In <code>xcodebuild</code>, specify launch arguments.</p>
<p>You can specify this under Launch Arguments in Run action of the app scheme or UITest scheme</p>
<img width="897" alt="Screenshot 2019-12-10 at 23 27 02" src="https://user-images.githubusercontent.com/2284279/70574543-a41a6080-1ba4-11ea-9fe0-596f24bca3ce.png">


<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-<span class="type">AppleLanguages</span> (jp) -<span class="type">AppleLocale</span> (jp_JP)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">(lldb) po ProcessInfo().arguments</span><br><span class="line">▿ <span class="number">11</span> elements</span><br><span class="line">  - <span class="number">0</span> : <span class="string">"/Users/khoa/Library/Developer/CoreSimulator/Devices/561F2B45-26B2-4897-98C4-8A917AEB48D2/data/Containers/Bundle/Application/436E0A43-8323-4F53-BBE0-6F75F674916F/TestAppUITests-Runner.app/TestAppUITests-Runner"</span></span><br><span class="line">  - <span class="number">1</span> : <span class="string">"-AppleLanguages"</span></span><br><span class="line">  - <span class="number">2</span> : <span class="string">"(ja)"</span></span><br><span class="line">  - <span class="number">3</span> : <span class="string">"-AppleTextDirection"</span></span><br><span class="line">  - <span class="number">4</span> : <span class="string">"NO"</span></span><br><span class="line">  - <span class="number">5</span> : <span class="string">"-AppleLocale"</span></span><br><span class="line">  - <span class="number">6</span> : <span class="string">"ja_JP"</span></span><br><span class="line">  - <span class="number">7</span> : <span class="string">"-NSTreatUnknownArgumentsAsOpen"</span></span><br><span class="line">  - <span class="number">8</span> : <span class="string">"NO"</span></span><br><span class="line">  - <span class="number">9</span> : <span class="string">"-ApplePersistenceIgnoreState"</span></span><br><span class="line">  - <span class="number">10</span> : <span class="string">"YES"</span></span><br></pre></td></tr></table></figure>

<p>In UITests, pass launch arguments from UITest scheme to UITest application</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.launchArguments += <span class="type">ProcessInfo</span>().arguments</span><br></pre></td></tr></table></figure>

<h2 id="Environments"><a href="#Environments" class="headerlink" title="Environments"></a>Environments</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ProcessInfo</span>().environment <span class="comment">// [String: String]</span></span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-12-10T12:46:18.000Z" title="2019-12-10T12:46:18.000Z">2019-12-10</time><span class="level-item">a few seconds read (About 62 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-add-padding-to-left-right-view-in-UITextField/">How to add padding to left right view in UITextField</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/536">#536</a></strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">UITextField</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">setLeftView</span><span class="params">(<span class="number">_</span> view: UIView, padding: CGFloat)</span></span> &#123;</span><br><span class="line">        view.translatesAutoresizingMaskIntoConstraints = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> outerView = <span class="type">UIView</span>()</span><br><span class="line">        outerView.translatesAutoresizingMaskIntoConstraints = <span class="literal">false</span></span><br><span class="line">        outerView.addSubview(view)</span><br><span class="line"></span><br><span class="line">        outerView.frame = <span class="type">CGRect</span>(</span><br><span class="line">            origin: .zero,</span><br><span class="line">            size: <span class="type">CGSize</span>(</span><br><span class="line">                width: view.frame.size.width + padding,</span><br><span class="line">                height: view.frame.size.height + padding</span><br><span class="line">            )</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        view.center = <span class="type">CGPoint</span>(</span><br><span class="line">            x: outerView.bounds.size.width / <span class="number">2</span>,</span><br><span class="line">            y: outerView.bounds.size.height / <span class="number">2</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        leftView = outerView</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-12-10T12:45:08.000Z" title="2019-12-10T12:45:08.000Z">2019-12-10</time><span class="level-item">a few seconds read (About 44 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-set-date-color-in-UIDatePicker-in-iOS-13/">How to set date color in UIDatePicker in iOS 13</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/535">#535</a></strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">datePicker.setValue(<span class="type">UIColor</span>.green, forKey: <span class="string">"textColor"</span>)</span><br><span class="line">datePicker.setValue(<span class="literal">false</span>, forKey: <span class="string">"highlightsToday"</span>)</span><br></pre></td></tr></table></figure>

<p>In iOS 14</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> #available(iOS <span class="number">14.0</span>, *) &#123;</span><br><span class="line">    datePicker.preferredDatePickerStyle = .wheels</span><br><span class="line">    datePicker.tintColor = <span class="type">UIColor</span>.green</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Inspect-attributes"><a href="#Inspect-attributes" class="headerlink" title="Inspect attributes"></a>Inspect attributes</h2><ul>
<li><a href="https://developer.apple.com/documentation/objectivec/nsobject/1415656-attributekeys">https://developer.apple.com/documentation/objectivec/nsobject/1415656-attributekeys</a></li>
</ul>
<hr>
<p><strong>Updated at</strong> 2020-06-24 06:32:07</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-12-06T09:08:23.000Z" title="2019-12-06T09:08:23.000Z">2019-12-06</time><span class="level-item">a few seconds read (About 24 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-fix-cropped-image-in-UIImageView/">How to fix cropped image in UIImageView</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/530">#530</a></strong></p>
<p>Although <code>UIImageView</code> frame is correct, image is still cropped. Watch out for any <code>layer.mask</code> within view  </p>
</div></article></div><nav class="pagination is-centered mt-4" role="navigation" aria-label="pagination"><div class="pagination-previous is-invisible is-hidden-mobile"><a href="/tags/iOS/page/0/">Previous</a></div><div class="pagination-next"><a href="/tags/iOS/page/2/">Next</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link is-current" href="/tags/iOS/">1</a></li><li><a class="pagination-link" href="/tags/iOS/page/2/">2</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/tags/iOS/page/6/">6</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="" src="https://avatars1.githubusercontent.com/u/2284279?s=460&amp;v=4" alt="onmyway133"></figure><p class="title is-size-4 is-block line-height-inherit">onmyway133</p><p class="is-size-6 is-block">iOS, macOS, Android, React. Serial maker. Writer. Speaker.</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Oslo, Norway</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">693</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">54</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/onmyway133" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/onmyway133"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com/onmyway133"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile is-mobile" href="https://onmyway133.com/apps" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Apps</span></span><span class="level-right"><span class="level-item tag">onmyway133.com</span></span></a></li><li><a class="level is-mobile is-mobile" href="https://learntalks.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Learn Talks</span></span><span class="level-right"><span class="level-item tag">learntalks.com</span></span></a></li><li><a class="level is-mobile is-mobile" href="https://wwdctogether.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">WWDC Together</span></span><span class="level-right"><span class="level-item tag">wwdctogether.com</span></span></a></li></ul></div></div></div><!--!--><div class="card widget"><div class="card-content"><h3 class="menu-label">Recent</h3><article class="media"><div class="media-content size-small"><p><time dateTime="2021-01-07T08:25:52.000Z">2021-01-07</time></p><p class="title is-6"><a class="link-muted" href="/blog/How-to-check-app-going-to-background-in-SwiftUI/">How to check app going to background in SwiftUI</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2021-01-06T20:04:59.000Z">2021-01-06</time></p><p class="title is-6"><a class="link-muted" href="/blog/How-to-use-selection-in-List-in-SwiftUI/">How to use selection in List in SwiftUI</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2021-01-06T12:13:34.000Z">2021-01-06</time></p><p class="title is-6"><a class="link-muted" href="/blog/How-to-simplify-communication-patterns-with-closure-in-Swift/">How to simplify communication patterns with closure in Swift</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2021-01-05T20:50:32.000Z">2021-01-05</time></p><p class="title is-6"><a class="link-muted" href="/blog/How-to-use-Apple-keyboard-key-symbols/">How to use Apple keyboard key symbols</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2021-01-05T06:07:53.000Z">2021-01-05</time></p><p class="title is-6"><a class="link-muted" href="/blog/How-to-make-Auto-Layout-more-convenient-in-iOS/">How to make Auto Layout more convenient in iOS</a></p><p class="is-uppercase"></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/archives/2021/01/"><span class="level-start"><span class="level-item">January 2021</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/12/"><span class="level-start"><span class="level-item">December 2020</span></span><span class="level-end"><span class="level-item tag">29</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/11/"><span class="level-start"><span class="level-item">November 2020</span></span><span class="level-end"><span class="level-item tag">15</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/10/"><span class="level-start"><span class="level-item">October 2020</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/09/"><span class="level-start"><span class="level-item">September 2020</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/08/"><span class="level-start"><span class="level-item">August 2020</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/06/"><span class="level-start"><span class="level-item">June 2020</span></span><span class="level-end"><span class="level-item tag">14</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/05/"><span class="level-start"><span class="level-item">May 2020</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/04/"><span class="level-start"><span class="level-item">April 2020</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/03/"><span class="level-start"><span class="level-item">March 2020</span></span><span class="level-end"><span class="level-item tag">21</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/02/"><span class="level-start"><span class="level-item">February 2020</span></span><span class="level-end"><span class="level-item tag">20</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/01/"><span class="level-start"><span class="level-item">January 2020</span></span><span class="level-end"><span class="level-item tag">30</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/12/"><span class="level-start"><span class="level-item">December 2019</span></span><span class="level-end"><span class="level-item tag">36</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/11/"><span class="level-start"><span class="level-item">November 2019</span></span><span class="level-end"><span class="level-item tag">38</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/10/"><span class="level-start"><span class="level-item">October 2019</span></span><span class="level-end"><span class="level-item tag">49</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/09/"><span class="level-start"><span class="level-item">September 2019</span></span><span class="level-end"><span class="level-item tag">50</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/08/"><span class="level-start"><span class="level-item">August 2019</span></span><span class="level-end"><span class="level-item tag">39</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/07/"><span class="level-start"><span class="level-item">July 2019</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/06/"><span class="level-start"><span class="level-item">June 2019</span></span><span class="level-end"><span class="level-item tag">41</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/05/"><span class="level-start"><span class="level-item">May 2019</span></span><span class="level-end"><span class="level-item tag">50</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/04/"><span class="level-start"><span class="level-item">April 2019</span></span><span class="level-end"><span class="level-item tag">27</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/03/"><span class="level-start"><span class="level-item">March 2019</span></span><span class="level-end"><span class="level-item tag">24</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/02/"><span class="level-start"><span class="level-item">February 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/12/"><span class="level-start"><span class="level-item">December 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/05/"><span class="level-start"><span class="level-item">May 2018</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/04/"><span class="level-start"><span class="level-item">April 2018</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/02/"><span class="level-start"><span class="level-item">February 2018</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/01/"><span class="level-start"><span class="level-item">January 2018</span></span><span class="level-end"><span class="level-item tag">14</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/12/"><span class="level-start"><span class="level-item">December 2017</span></span><span class="level-end"><span class="level-item tag">14</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/11/"><span class="level-start"><span class="level-item">November 2017</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/10/"><span class="level-start"><span class="level-item">October 2017</span></span><span class="level-end"><span class="level-item tag">18</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/09/"><span class="level-start"><span class="level-item">September 2017</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/08/"><span class="level-start"><span class="level-item">August 2017</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/07/"><span class="level-start"><span class="level-item">July 2017</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/06/"><span class="level-start"><span class="level-item">June 2017</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/05/"><span class="level-start"><span class="level-item">May 2017</span></span><span class="level-end"><span class="level-item tag">35</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/04/"><span class="level-start"><span class="level-item">April 2017</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/algorithm/"><span class="tag">algorithm</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/android/"><span class="tag">android</span><span class="tag is-grey-lightest">34</span></a></div><div class="control"><a class="tags has-addons" href="/tags/apple-script/"><span class="tag">apple script</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/catalyst/"><span class="tag">catalyst</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ci/"><span class="tag">ci</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cloud/"><span class="tag">cloud</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cocoapods/"><span class="tag">cocoapods</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/combine/"><span class="tag">combine</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/core-data/"><span class="tag">core data</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/csharp/"><span class="tag">csharp</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/css/"><span class="tag">css</span><span class="tag is-grey-lightest">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/dart/"><span class="tag">dart</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/database/"><span class="tag">database</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/design/"><span class="tag">design</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/electron/"><span class="tag">electron</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/featured/"><span class="tag">featured</span><span class="tag is-grey-lightest">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/firebase/"><span class="tag">firebase</span><span class="tag is-grey-lightest">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/flutter/"><span class="tag">flutter</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/git/"><span class="tag">git</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/github/"><span class="tag">github</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/go/"><span class="tag">go</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/google/"><span class="tag">google</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/iOS/"><span class="tag">iOS</span><span class="tag is-grey-lightest">169</span></a></div><div class="control"><a class="tags has-addons" href="/tags/javascript/"><span class="tag">javascript</span><span class="tag is-grey-lightest">50</span></a></div><div class="control"><a class="tags has-addons" href="/tags/kotlin/"><span class="tag">kotlin</span><span class="tag is-grey-lightest">27</span></a></div><div class="control"><a class="tags has-addons" href="/tags/layout/"><span class="tag">layout</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/life/"><span class="tag">life</span><span class="tag is-grey-lightest">14</span></a></div><div class="control"><a class="tags has-addons" href="/tags/links/"><span class="tag">links</span><span class="tag is-grey-lightest">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/macOS/"><span class="tag">macOS</span><span class="tag is-grey-lightest">120</span></a></div><div class="control"><a class="tags has-addons" href="/tags/machine-learning/"><span class="tag">machine learning</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/maps/"><span class="tag">maps</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/networking/"><span class="tag">networking</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/node/"><span class="tag">node</span><span class="tag is-grey-lightest">11</span></a></div><div class="control"><a class="tags has-addons" href="/tags/objc/"><span class="tag">objc</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/react/"><span class="tag">react</span><span class="tag is-grey-lightest">23</span></a></div><div class="control"><a class="tags has-addons" href="/tags/react-native/"><span class="tag">react native</span><span class="tag is-grey-lightest">14</span></a></div><div class="control"><a class="tags has-addons" href="/tags/realm/"><span class="tag">realm</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/rx/"><span class="tag">rx</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/script/"><span class="tag">script</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/spm/"><span class="tag">spm</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/swift/"><span class="tag">swift</span><span class="tag is-grey-lightest">332</span></a></div><div class="control"><a class="tags has-addons" href="/tags/swiftUI/"><span class="tag">swiftUI</span><span class="tag is-grey-lightest">84</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tech/"><span class="tag">tech</span><span class="tag is-grey-lightest">14</span></a></div><div class="control"><a class="tags has-addons" href="/tags/terminal/"><span class="tag">terminal</span><span class="tag is-grey-lightest">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/testing/"><span class="tag">testing</span><span class="tag is-grey-lightest">17</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tool/"><span class="tag">tool</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tweet/"><span class="tag">tweet</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/unity/"><span class="tag">unity</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/voip/"><span class="tag">voip</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/watchOS/"><span class="tag">watchOS</span><span class="tag is-grey-lightest">11</span></a></div><div class="control"><a class="tags has-addons" href="/tags/web/"><span class="tag">web</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/work/"><span class="tag">work</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/wwdc/"><span class="tag">wwdc</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/xcode/"><span class="tag">xcode</span><span class="tag is-grey-lightest">24</span></a></div></div></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Subscribe to Updates</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=c2r59mmt2n5k0o5dt5vv3nq4u4&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="c2r59mmt2n5k0o5dt5vv3nq4u4" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button is-primary" type="submit" value="Subscribe"></div></div></form></div></div></div><div class="card widget"><div class="card-content"><div class="notification is-danger">You need to set <code>client_id</code> and <code>slot_id</code> to show this AD unit. Please set it in <code>_config.yml</code>.</div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/z.png" alt="onmyway133" height="28"></a><p class="size-small"><span>&copy; 2021 Khoa Pham</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/onmyway133"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            site: {
                url: 'https://onmyway133.github.io',
                external_link: {"enable":true,"exclude":[]}
            },
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to Top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>