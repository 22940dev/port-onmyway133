<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="generator" content="Hexo 4.2.0"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Tag: iOS - onmyway133</title><meta description="What you don&amp;#39;t know is what you haven&amp;#39;t learned"><meta property="og:type" content="blog"><meta property="og:title" content="onmyway133"><meta property="og:url" content="https://onmyway133.github.io/"><meta property="og:site_name" content="onmyway133"><meta property="og:description" content="What you don&amp;#39;t know is what you haven&amp;#39;t learned"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://onmyway133.github.io/img/og_image.png"><meta property="article:author" content="Khoa Pham"><meta property="article:tag" content="ios"><meta property="article:tag" content=" android"><meta property="article:tag" content="javascript"><meta property="article:tag" content=" react"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><meta property="twitter:creator" content="@onmyway133"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://onmyway133.github.io"},"headline":"onmyway133","image":["https://onmyway133.github.io/img/og_image.png"],"author":{"@type":"Person","name":"Khoa Pham"},"description":"What you don&#39;t know is what you haven&#39;t learned"}</script><link rel="alternative" href="/atom.xml" title="onmyway133" type="application/atom+xml"><link rel="icon" href="/img/favicon.ico"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=UA-40119591-5" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'UA-40119591-5');</script><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><script data-ad-client="ca-pub-3656459401405265" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" async></script></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/z.png" alt="onmyway133" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/apps">Apps</a><a class="navbar-item" href="/gumroad">Gumroad</a><a class="navbar-item" href="/about">About</a><a class="navbar-item" href="/opensource">Open Source</a><a class="navbar-item" href="/writing">Writing</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/speaking">Speaking</a><a class="navbar-item" href="/news">News</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/onmyway133"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/tags">Tags</a></li><li class="is-active"><a href="#" aria-current="page">iOS</a></li></ul></nav></div></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-11-25T11:58:42.000Z" title="2019-11-25T11:58:42.000Z">2019-11-25</time><span class="level-item">a few seconds read (About 81 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-test-UserDefaults-in-iOS/">How to test UserDefaults in iOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/518">#518</a></strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> userDefaults = <span class="type">UserDefaults</span>(suiteName: suiteName)</span><br><span class="line">userDefaults.removePersistentDomain(forName: suiteName)</span><br></pre></td></tr></table></figure>

<p><a href="https://developer.apple.com/documentation/foundation/userdefaults/1417339-removepersistentdomain">https://developer.apple.com/documentation/foundation/userdefaults/1417339-removepersistentdomain</a></p>
<blockquote>
<p>Calling this method is equivalent to initializing a user defaults object with init(suiteName:) passing domainName, and calling the removeObject(forKey:) method on each of its keys.</p>
</blockquote>
<h2 id="Read-more"><a href="#Read-more" class="headerlink" title="Read more"></a>Read more</h2><ul>
<li><a href="https://www.swiftbysundell.com/articles/the-power-of-userdefaults-in-swift/">https://www.swiftbysundell.com/articles/the-power-of-userdefaults-in-swift/</a></li>
<li><a href="http://dscoder.com/defaults.html">http://dscoder.com/defaults.html</a></li>
<li><a href="https://medium.com/swift-india/userdefaults-under-the-hood-457461c8d262">https://medium.com/swift-india/userdefaults-under-the-hood-457461c8d262</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-11-13T11:23:55.000Z" title="2019-11-13T11:23:55.000Z">2019-11-13</time><span class="level-item">a minute read (About 156 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-make-Swift-Package-Manager-package-for-multiple-platforms/">How to make Swift Package Manager package for multiple platforms</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/504">#504</a></strong></p>
<p><a href="https://twitter.com/NeoNacho/status/1181245484867801088?s=20">https://twitter.com/NeoNacho/status/1181245484867801088?s=20</a></p>
<blockquote>
<p>There’s no way to have platform specific sources or targets today, so you’ll have to take a different approach. I would recommend wrapping all OS specific files in #if os and just having one target. For tests, you could do something similar, one test target, but conditional tests</p>
</blockquote>
<p>Every files are in <code>Sources</code> folder, so we can use platform and version checks. For example <a href="https://github.com/onmyway133/Omnia">Omnia</a> is a Swift Package Manager that supports iOS, tvOS, watchOS, macOS and Catalyst.</p>
<p>For macOS only code, need to check for AppKit and Catalyst</p>
<p><code>https://github.com/onmyway133/Omnia/blob/master/Sources/macOS/ClickedCollectionView.swift</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#<span class="keyword">if</span> canImport(<span class="type">AppKit</span>) &amp;&amp; !targetEnvironment(macCatalyst)</span><br></pre></td></tr></table></figure>

<p>For SwiftUI feature, need to check for iOS 13 and macOS 10.15</p>
<p><code>https://github.com/onmyway133/Omnia/blob/master/Sources/SwiftUI/Utils/ImageLoader.swift</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@available</span>(iOS <span class="number">13.0</span>, <span class="type">OSX</span> <span class="number">10.15</span>, tvOS <span class="number">13.0</span>, watchOS <span class="number">6.0</span>, *)</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-11-10T21:19:39.000Z" title="2019-11-10T21:19:39.000Z">2019-11-10</time><span class="level-item">3 minutes read (About 407 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-refresh-receipt-and-restore-in-app-purchase-in-iOS/">How to refresh receipt and restore in app purchase in iOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/496">#496</a></strong></p>
<p>Read this <a href="https://developer.apple.com/library/archive/documentation/NetworkingInternet/Conceptual/StoreKitGuide/Chapters/Restoring.html#//apple_ref/doc/uid/TP40008267-CH8-SW9">Restoring Purchased Products</a> to understand the purposes between the 2.</p>
<p>From iOS 7, every app downloaded from the store has a receipt (for downloading/buying the app) at <code>appStoreReceiptURL</code>. When users purchases something via In App Purchase, the content at <code>appStoreReceiptURL</code> is updated with purchases information. Most of the cases, you just need to refresh the receipt (at <code>appStoreReceiptURL</code>) so that you know which transactions users have made.</p>
<blockquote>
<p>Users restore transactions to maintain access to content they’ve already purchased. For example, when they upgrade to a new phone, they don’t lose all of the items they purchased on the old phone. Include some mechanism in your app to let the user restore their purchases, such as a Restore Purchases button. Restoring purchases <strong>prompts for the user’s App Store credentials</strong>, which interrupts the flow of your app: because of this, don’t automatically restore purchases, especially not every time your app is launched.</p>
</blockquote>
<blockquote>
<p><strong>In most cases, all your app needs to do is refresh its receipt</strong> and deliver the products in its receipt. The refreshed receipt contains a record of the user’s purchases in this app, on this device or any other device. However, some apps need to take an alternate approach for one of the following reasons:</p>
</blockquote>
<blockquote>
<p>If you use <strong>Apple-hosted content</strong>, restoring completed transactions gives your app the transaction objects it uses to download the content.<br>If you need to support versions of iOS earlier than iOS 7, where the app receipt isn’t available, restore completed transactions instead.</p>
</blockquote>
<blockquote>
<p>Refreshing the receipt asks the App Store for the latest copy of the receipt. <strong>Refreshing a receipt does not create any new transactions.</strong></p>
</blockquote>
<blockquote>
<p>Restoring completed transactions creates a new transaction for every completed transaction the user made, essentially replaying history for your transaction queue observer.</p>
</blockquote>
<p>More about receipt, from WWDC 2017, What’s new in StoreKit session <a href="https://developer.apple.com/videos/play/wwdc2017/303/">https://developer.apple.com/videos/play/wwdc2017/303/</a></p>
<p><a href="https://i.stack.imgur.com/XoZOv.png"><img src="https://i.stack.imgur.com/XoZOv.png" alt="enter image description here"></a></p>
<p>You can also watch WWDC 2017, session Advanced StoreKit for more detail <a href="https://developer.apple.com/videos/play/wwdc2017/305/">https://developer.apple.com/videos/play/wwdc2017/305/</a></p>
<p><a href="https://i.stack.imgur.com/h2cg9.png"><img src="https://i.stack.imgur.com/h2cg9.png" alt="enter image description here"></a></p>
<hr>
<p>Original answer <a href="https://stackoverflow.com/questions/45615106/when-to-refresh-a-receipt-vs-restore-purchases-in-ios/52162283#52162283">https://stackoverflow.com/questions/45615106/when-to-refresh-a-receipt-vs-restore-purchases-in-ios/52162283#52162283</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-11-01T08:48:43.000Z" title="2019-11-01T08:48:43.000Z">2019-11-01</time><span class="level-item">a minute read (About 165 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-add-monkey-test-to-iOS-apps/">How to add monkey test to iOS apps</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/484">#484</a></strong></p>
<p>Use <a href="https://github.com/zalando/SwiftMonkey">SwiftMonkey</a> which adds random UITests gestures</p>
<p>Add to UITests target</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">target <span class="string">'MyAppUITests'</span> <span class="keyword">do</span></span><br><span class="line">  pod <span class="string">'R.swift'</span>, <span class="string">'~&gt; 5.0'</span></span><br><span class="line">  pod <span class="string">'SwiftMonkey'</span>, <span class="string">'~&gt; 2.1.0'</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<h2 id="Troubleshooting"><a href="#Troubleshooting" class="headerlink" title="Troubleshooting"></a>Troubleshooting</h2><h3 id="Failed-to-determine-hittability-of-Button"><a href="#Failed-to-determine-hittability-of-Button" class="headerlink" title="Failed to determine hittability of Button"></a>Failed to determine hittability of Button</h3><blockquote>
<p>Failed to determine hittability of Button: Unable to fetch parameterized attribute XC_kAXXCParameterizedAttributeConvertHostedViewPositionFromContext, remote interface does not have this capability.</p>
</blockquote>
<p>This happens when using SwiftMonkey and somewhere in our code uses <code>isHittable</code>, so best to avoid that by having isolated monkey test only</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> XCTest</span><br><span class="line"><span class="keyword">import</span> SwiftMonkey</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MonkeyTests</span>: <span class="title">XCTestCase</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> app: <span class="type">XCUIApplication!</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">setUp</span><span class="params">()</span></span> &#123;</span><br><span class="line">        continueAfterFailure = <span class="literal">false</span></span><br><span class="line">        app = <span class="type">XCUIApplication</span>()</span><br><span class="line">        app.launch()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">testMonkey</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">let</span> monkey = <span class="type">Monkey</span>(frame: app.frame)</span><br><span class="line">        monkey.addDefaultUIAutomationActions()</span><br><span class="line">        monkey.addXCTestTapAlertAction(interval: <span class="number">100</span>, application: app)</span><br><span class="line">        monkey.monkeyAround()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Another workaround is possibly use <code>addDefaultXCTestPublicActions</code> other than <code>addDefaultUIAutomationActions</code></p>
<h3 id="UI-Test-Activity"><a href="#UI-Test-Activity" class="headerlink" title="UI Test Activity:"></a>UI Test Activity:</h3><blockquote>
<p>Assertion Failure: MonkeyXCTest.swift:33: Failed to get matching snapshots: Timed out while evaluating UI query.</p>
</blockquote>
<p>This seems related to SwiftMonkey trying to snapshot. Workaround is to remove</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">monkey.addXCTestTapAlertAction(interval: <span class="number">100</span>, application: app)</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-10-29T13:08:00.000Z" title="2019-10-29T13:08:00.000Z">2019-10-29</time><span class="level-item">2 minutes read (About 344 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-use-CommonCrypto-in-iOS/">How to use CommonCrypto in iOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/480">#480</a></strong></p>
<h2 id="Use-modulemap"><a href="#Use-modulemap" class="headerlink" title="Use modulemap"></a>Use modulemap</h2><h3 id="modulemap-approach"><a href="#modulemap-approach" class="headerlink" title="modulemap approach"></a>modulemap approach</h3><p>I use <code>modulemap</code> in my wrapper around CommonCrypto <a href="https://github.com/onmyway133/arcane">https://github.com/onmyway133/arcane</a>, <a href="https://github.com/onmyway133/Reindeer">https://github.com/onmyway133/Reindeer</a></p>
<p>For those getting <code>header not found</code>, please take a look <a href="https://github.com/onmyway133/Arcane/issues/4">https://github.com/onmyway133/Arcane/issues/4</a> or run <code>xcode-select --install</code></p>
<ul>
<li>Make a folder <code>CCommonCrypto</code> containing <code>module.modulemap</code></li>
</ul>
<pre><code>module CCommonCrypto {
  header &quot;/usr/include/CommonCrypto/CommonCrypto.h&quot;
  export *
}</code></pre><ul>
<li>Go to Built Settings -&gt; Import Paths</li>
</ul>
<pre><code>${SRCROOT}/Sources/CCommonCrypto</code></pre><h3 id="Cocoapods-with-modulemap-approach"><a href="#Cocoapods-with-modulemap-approach" class="headerlink" title="Cocoapods with modulemap approach"></a>Cocoapods with modulemap approach</h3><ul>
<li><p>Here is the podspec <a href="https://github.com/onmyway133/Arcane/blob/master/Arcane.podspec">https://github.com/onmyway133/Arcane/blob/master/Arcane.podspec</a></p>
<pre><code>s.source_files = &apos;Sources/**/*.swift&apos;
s.xcconfig = { &apos;SWIFT_INCLUDE_PATHS&apos; =&gt;
&apos;$(PODS_ROOT)/CommonCryptoSwift/Sources/CCommonCrypto&apos; }
s.preserve_paths = &apos;Sources/CCommonCrypto/module.modulemap&apos;</code></pre></li>
<li><p>Using <code>module_map</code> does not work, see <a href="https://github.com/CocoaPods/CocoaPods/issues/5271">https://github.com/CocoaPods/CocoaPods/issues/5271</a></p>
</li>
<li><p>Using Local Development Pod with <code>path</code> does not work, see <a href="https://github.com/CocoaPods/CocoaPods/issues/809">https://github.com/CocoaPods/CocoaPods/issues/809</a></p>
</li>
<li><p>That’s why you see that my Example Podfile <a href="https://github.com/onmyway133/CommonCrypto.swift/blob/master/Example/CommonCryptoSwiftDemo/Podfile">https://github.com/onmyway133/CommonCrypto.swift/blob/master/Example/CommonCryptoSwiftDemo/Podfile</a> points to the git repo</p>
<pre><code>target &apos;CommonCryptoSwiftDemo&apos; do
  pod &apos;CommonCryptoSwift&apos;, :git =&gt; &apos;https://github.com/onmyway133/CommonCrypto.swift&apos;
end</code></pre></li>
</ul>
<h3 id="public-header-approach"><a href="#public-header-approach" class="headerlink" title="public header approach"></a>public header approach</h3><ul>
<li><p><a href="https://github.com/honghaoz/Ji">Ji</a> is a wrapper around libxml2, and it uses public header approach</p>
</li>
<li><p>It has a header file <a href="https://github.com/honghaoz/Ji/blob/master/Source/Ji.h">https://github.com/honghaoz/Ji/blob/master/Source/Ji.h</a> with <code>Target Membership</code> set to <code>Public</code></p>
</li>
<li><p>It has a list of header files for libxml2 <a href="https://github.com/honghaoz/Ji/tree/master/Source/Ji-libxml">https://github.com/honghaoz/Ji/tree/master/Source/Ji-libxml</a></p>
</li>
<li><p>It has Build Settings -&gt; Header Search Paths</p>
<pre><code>$(SDKROOT)/usr/include/libxml2</code></pre></li>
<li><p>It has Build Settings -&gt; Other Linker Flags</p>
<pre><code>-lxml2</code></pre></li>
</ul>
<h3 id="Cocoapods-with-public-header-approach"><a href="#Cocoapods-with-public-header-approach" class="headerlink" title="Cocoapods with public header approach"></a>Cocoapods with public header approach</h3><ul>
<li>Take a look at the podspec <a href="https://github.com/honghaoz/Ji/blob/master/Ji.podspec">https://github.com/honghaoz/Ji/blob/master/Ji.podspec</a></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s.libraries        &#x3D; &quot;xml2&quot;</span><br><span class="line">s.xcconfig         &#x3D; &#123; &#39;HEADER_SEARCH_PATHS&#39; &#x3D;&gt;           &#39;$(SDKROOT)&#x2F;usr&#x2F;include&#x2F;libxml2&#39;, &#39;OTHER_LDFLAGS&#39; &#x3D;&gt; &#39;-lxml2&#39; &#125;</span><br></pre></td></tr></table></figure>

<p><strong>🐝 Interesting related posts</strong></p>
<ul>
<li><a href="https://stackoverflow.com/questions/24004732/how-to-call-c-from-swift">https://stackoverflow.com/questions/24004732/how-to-call-c-from-swift</a></li>
<li><a href="https://spin.atomicobject.com/2015/02/23/c-libraries-swift/">https://spin.atomicobject.com/2015/02/23/c-libraries-swift/</a></li>
</ul>
<h2 id="CommonCrypto-from-Xcode-10"><a href="#CommonCrypto-from-Xcode-10" class="headerlink" title="CommonCrypto from Xcode 10"></a>CommonCrypto from Xcode 10</h2><p>From Xcode 10, we can just</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> CommonCrypto</span><br></pre></td></tr></table></figure>

<h2 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h2><ul>
<li><a href="https://github.com/onmyway133/Arcane">https://github.com/onmyway133/Arcane</a></li>
<li><a href="https://stackoverflow.com/questions/25248598/importing-commoncrypto-in-a-swift-framework/37125785#37125785">https://stackoverflow.com/questions/25248598/importing-commoncrypto-in-a-swift-framework/37125785#37125785</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-10-29T12:57:33.000Z" title="2019-10-29T12:57:33.000Z">2019-10-29</time><span class="level-item">3 minutes read (About 522 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-configure-test-target-in-Xcode/">How to configure test target in Xcode</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/478">#478</a></strong></p>
<h4 id="This-applies-to"><a href="#This-applies-to" class="headerlink" title="This applies to"></a>This applies to</h4><ul>
<li>Main targets<ul>
<li>App</li>
<li>Framework</li>
</ul>
</li>
<li>Test targets<ul>
<li>Unit tests</li>
<li>UI tests</li>
</ul>
</li>
</ul>
<h4 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h4><p>Dependencies used</p>
<ul>
<li>Main target: <a href="http://github.com/hyperoslo/Sugar">Sugar</a></li>
<li>Test target: <a href="https://github.com/Quick/Nimble">Nimble</a>, <a href="https://github.com/Quick/Quick">Quick</a></li>
</ul>
<p>Examples</p>
<ul>
<li>Cocoapods</li>
<li>Carthage</li>
</ul>
<h4 id="Notes"><a href="#Notes" class="headerlink" title="Notes"></a>Notes</h4><ul>
<li>Make sure test target can link to all the frameworks it needs. This includes frameworks that Test targets use, and possibly frameworks that Main target uses !</li>
<li>Remember to “Clean Build Folder” and “Clear Derived Data” so that you’re sure it works. Sometimes Xcode caches.</li>
</ul>
<h3 id="Errors"><a href="#Errors" class="headerlink" title="Errors"></a>Errors</h3><p>Errors occur mostly due to linker error</p>
<ul>
<li>Test target X encountered an error (Early unexpected exit, operation never finished bootstrapping - no restart will be attempted</li>
<li>Framework not found</li>
</ul>
<h2 id="Cocoapods"><a href="#Cocoapods" class="headerlink" title="Cocoapods"></a>Cocoapods</h2><h4 id="1-Pod"><a href="#1-Pod" class="headerlink" title="1. Pod"></a>1. Pod</h4><p>Test targets need to include pods that Main target uses !</p>
<p>or we’ll get “Framework not found”</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">app_pods</span></span></span><br><span class="line">	pod <span class="string">'Sugar'</span>, <span class="string">'~&gt; 1.0'</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_pods</span></span></span><br><span class="line">	pod <span class="string">'Nimble'</span>, <span class="string">'~&gt; 3.2'</span></span><br><span class="line">	pod <span class="string">'Quick'</span>, <span class="string">'~&gt; 0.9'</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">target <span class="string">'TeaApp'</span> <span class="keyword">do</span></span><br><span class="line">	app_pods</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">target <span class="string">'TeaAppTests'</span> <span class="keyword">do</span></span><br><span class="line">	app_pods</span><br><span class="line">	test_pods</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">target <span class="string">'TeaAppUITests'</span> <span class="keyword">do</span></span><br><span class="line">	app_pods</span><br><span class="line">	test_pods</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<h4 id="2-Link-Binaries-with-Library"><a href="#2-Link-Binaries-with-Library" class="headerlink" title="2. Link Binaries with Library"></a>2. Link Binaries with Library</h4><p>Cocoapods builds a framework that contains all the frameworks the Test targets need, and configure it for us</p>
<p><img src="Screenshots/cocoapods_link_binaries.png" alt=""></p>
<h4 id="3-Runpath-Search-Paths"><a href="#3-Runpath-Search-Paths" class="headerlink" title="3. Runpath Search Paths"></a>3. Runpath Search Paths</h4><ul>
<li>Go to Test target Build Settings</li>
<li>Add <code>$(FRAMEWORK_SEARCH_PATHS)</code></li>
</ul>
<p><img src="Screenshots/cocoapods_runpath_search_paths.png" alt=""></p>
<h2 id="Carthage"><a href="#Carthage" class="headerlink" title="Carthage"></a>Carthage</h2><h4 id="1-Cartfile"><a href="#1-Cartfile" class="headerlink" title="1. Cartfile"></a>1. Cartfile</h4><p>We usually have</p>
<ul>
<li>Cartfile for Main target</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">github <span class="string">"hyperoslo/Sugar"</span> ~&gt; <span class="number">1.0</span></span><br></pre></td></tr></table></figure>

<ul>
<li>Cartfile.private for Test target</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">github <span class="string">"Quick/Nimble"</span></span><br><span class="line">github <span class="string">"Quick/Quick"</span></span><br></pre></td></tr></table></figure>

<h4 id="2-Link-Binaries-with-Libraries"><a href="#2-Link-Binaries-with-Libraries" class="headerlink" title="2. Link Binaries with Libraries"></a>2. Link Binaries with Libraries</h4><ul>
<li>Go to Test target build phase</li>
<li>Drag built frameworks from <code>Carthage/Build</code></li>
<li>In rare case, we need to drag frameworks that the Main target uses</li>
<li>In rare case, we need to drag the Main target framework</li>
</ul>
<p><img src="Screenshots/carthage_link_binaries.png" alt=""></p>
<h4 id="3-Framework-Search-Paths"><a href="#3-Framework-Search-Paths" class="headerlink" title="3. Framework Search Paths"></a>3. Framework Search Paths</h4><p>Configure correct path</p>
<ul>
<li>Go to Test target Built Settings</li>
<li>Configure Framework Search Paths</li>
</ul>
<p><img src="Screenshots/carthage_framework_search_paths.png" alt=""></p>
<h4 id="4-Runpath-Search-Paths"><a href="#4-Runpath-Search-Paths" class="headerlink" title="4. Runpath Search Paths"></a>4. Runpath Search Paths</h4><ul>
<li>Go to Test target Build Settings</li>
<li>Add <code>$(FRAMEWORK_SEARCH_PATHS)</code></li>
</ul>
<p><img src="Screenshots/cocoapods_runpath_search_paths.png" alt=""></p>
<h4 id="5-Copy-Files-maybe"><a href="#5-Copy-Files-maybe" class="headerlink" title="5. Copy Files (maybe)"></a>5. Copy Files (maybe)</h4><p>From <a href="https://github.com/Carthage/Carthage/blob/0.11/README.md#adding-frameworks-to-unit-tests-or-a-framework">Adding frameworks to unit tests or a framework</a></p>
<blockquote>
<p>In rare cases, you may want to also copy each dependency into the build product (e.g., to embed dependencies within the outer framework, or make sure dependencies are present in a test bundle). To do this, create a new “Copy Files” build phase with the “Frameworks” destination, then add the framework reference there as well.</p>
</blockquote>
<p><img src="Screenshots/carthage_copy_files.png" alt=""></p>
<h2 id="Runpath-Search-Paths-and-Install-name"><a href="#Runpath-Search-Paths-and-Install-name" class="headerlink" title="Runpath Search Paths and Install name"></a>Runpath Search Paths and Install name</h2><p>Question</p>
<ul>
<li>Why preconfigured run path “@executable_path/Frameworks” and “@loader_path/Frameworks” not work?</li>
<li>Why configuring runpath to “$(FRAMEWORK_SEARCH_PATHS)” works ?</li>
<li>Why framework has install name “@rpath/Sugar.framework/Sugar” ?</li>
</ul>
<p>Reference</p>
<ul>
<li><a href="https://developer.apple.com/library/mac/documentation/DeveloperTools/Conceptual/DynamicLibraries/100-Articles/RunpathDependentLibraries.html">Run-Path Dependent Libraries</a></li>
<li><a href="https://www.mikeash.com/pyblog/friday-qa-2009-11-06-linking-and-install-names.html">Linking and Install Names</a></li>
</ul>
<h2 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h2><ul>
<li><a href="https://github.com/onmyway133/TestTarget">https://github.com/onmyway133/TestTarget</a></li>
<li><a href="https://stackoverflow.com/questions/34990175/test-target-x-encountered-an-error-early-unexpected-exit-operation-never-finis/36343395#36343395">https://stackoverflow.com/questions/34990175/test-target-x-encountered-an-error-early-unexpected-exit-operation-never-finis/36343395#36343395</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-10-22T18:25:18.000Z" title="2019-10-22T18:25:18.000Z">2019-10-22</time><span class="level-item">2 minutes read (About 366 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-use-external-display-in-iOS/">How to use external display in iOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/473">#473</a></strong></p>
<h2 id="Before-iOS-13"><a href="#Before-iOS-13" class="headerlink" title="Before iOS 13"></a>Before iOS 13</h2><p>Use <code>UIScreen.didConnectNotification</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">NotificationCenter</span>.<span class="keyword">default</span>.addObserver(forName: <span class="type">UIScreen</span>.didConnectNotification,</span><br><span class="line">                         object: <span class="literal">nil</span>, queue: <span class="literal">nil</span>) &#123; (notification) <span class="keyword">in</span></span><br><span class="line">        <span class="comment">// Get the new screen information.</span></span><br><span class="line">        <span class="keyword">let</span> newScreen = notification.object <span class="keyword">as</span>! <span class="type">UIScreen</span></span><br><span class="line">        <span class="keyword">let</span> screenDimensions = newScreen.bounds</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Configure a window for the screen.</span></span><br><span class="line">        <span class="keyword">let</span> newWindow = <span class="type">UIWindow</span>(frame: screenDimensions)</span><br><span class="line">        newWindow.screen = newScreen</span><br><span class="line">        <span class="comment">// Install a custom root view controller in the window.</span></span><br><span class="line">        <span class="keyword">self</span>.configureAuxilliaryInterface(with: newWindow)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// You must show the window explicitly.</span></span><br><span class="line">        newWindow.isHidden = <span class="literal">false</span></span><br><span class="line">        <span class="comment">// Save a reference to the window in a local array.</span></span><br><span class="line">        <span class="keyword">self</span>.additionalWindows.append(newWindow)&#125;</span><br></pre></td></tr></table></figure>

<h2 id="From-iOS-13"><a href="#From-iOS-13" class="headerlink" title="From iOS 13"></a>From iOS 13</h2><p>Handle <code>configurationForConnecting</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@UIApplicationMain</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AppDelegate</span>: <span class="title">UIResponder</span>, <span class="title">UIApplicationDelegate</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> newWindow: <span class="type">UIWindow!</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// MARK: UISceneSession Lifecycle</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">application</span><span class="params">(<span class="number">_</span> application: UIApplication, configurationForConnecting connectingSceneSession: UISceneSession, options: UIScene.ConnectionOptions)</span></span> -&gt; <span class="type">UISceneConfiguration</span> &#123;</span><br><span class="line">        <span class="comment">// Called when a new scene session is being created.</span></span><br><span class="line">        <span class="comment">// Use this method to select a configuration to create the new scene with.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                        <span class="built_in">print</span>(<span class="type">UIApplication</span>.shared.connectedScenes)</span><br><span class="line">        <span class="keyword">let</span> scene = <span class="type">UIWindowScene</span>(session: connectingSceneSession, connectionOptions: options)</span><br><span class="line"></span><br><span class="line">                        <span class="comment">// Configure a window for the screen.</span></span><br><span class="line">                        <span class="keyword">self</span>.newWindow = <span class="type">UIWindow</span>(frame: <span class="type">CGRect</span>(x: <span class="number">0</span>, y: <span class="number">0</span>, width: <span class="number">1000</span>, height: <span class="number">500</span>))</span><br><span class="line">        <span class="comment">//                self.newWindow.backgroundColor = UIColor.yellow</span></span><br><span class="line">                        <span class="comment">// Install a custom root view controller in the window.</span></span><br><span class="line"></span><br><span class="line">                        <span class="keyword">let</span> viewController = <span class="type">UIStoryboard</span>(name: <span class="string">"Main"</span>, bundle: <span class="literal">nil</span>).instantiateViewController(identifier: <span class="string">"other"</span>) <span class="keyword">as</span>! <span class="type">OtherViewController</span></span><br><span class="line">                        <span class="keyword">self</span>.newWindow.rootViewController = viewController</span><br><span class="line">                        <span class="keyword">self</span>.newWindow.windowScene = scene</span><br><span class="line"></span><br><span class="line">                        <span class="comment">// You must show the window explicitly.</span></span><br><span class="line">                        <span class="keyword">self</span>.newWindow.isHidden = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="type">UISceneConfiguration</span>(name: <span class="string">"External configuration"</span>, sessionRole: connectingSceneSession.role)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Or we can declare in plist</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>UIApplicationSupportsMultipleScenes<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">false</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>UISceneConfigurations<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">key</span>&gt;</span>UIWindowSceneSessionRoleApplication<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">key</span>&gt;</span>UISceneConfigurationName<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">string</span>&gt;</span>Default Configuration<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">key</span>&gt;</span>UISceneDelegateClassName<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">string</span>&gt;</span>$(PRODUCT_MODULE_NAME).SceneDelegate<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">key</span>&gt;</span>UISceneStoryboardFile<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">string</span>&gt;</span>Main<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">key</span>&gt;</span>UIWindowSceneSessionRoleExternalDisplay<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">key</span>&gt;</span>UISceneConfigurationName<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">string</span>&gt;</span>External configuration<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">key</span>&gt;</span>UISceneDelegateClassName<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">string</span>&gt;</span>$(PRODUCT_MODULE_NAME).OtherSceneDelegate<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">key</span>&gt;</span>UISceneStoryboardFile<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">string</span>&gt;</span>Other<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="Read-more"><a href="#Read-more" class="headerlink" title="Read more"></a>Read more</h2><ul>
<li><a href="https://medium.com/@hacknicity/external-display-support-on-ios-665cd1774511">External Display Support on iOS</a></li>
<li><a href="https://www.swiftjectivec.com/supporting-external-displays/">Supporting External Displays</a></li>
<li><a href="https://www.swiftbysundell.com/articles/building-ipad-pro-features-in-swift/">Building iPad Pro features in Swift</a></li>
<li><a href="https://stackoverflow.com/questions/58415368/how-can-i-display-different-content-on-different-screens-in-ios-13">How can I display different content on different screens in iOS 13?</a></li>
<li><a href="https://developer.apple.com/documentation/uikit/windows_and_screens/displaying_content_on_a_connected_screen">Displaying Content on a Connected Screen</a></li>
<li><a href="https://www.bignerdranch.com/blog/adding-external-display-support-to-your-ios-app-is-ridiculously-easy/">Adding External Display Support To Your iOS App Is Ridiculously Easy</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-10-21T08:55:27.000Z" title="2019-10-21T08:55:27.000Z">2019-10-21</time><span class="level-item">3 minutes read (About 486 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-show-error-message-like-Snack-Bar-in-iOS/">How to show error message like Snack Bar in iOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/472">#472</a></strong></p>
<h2 id="Build-error-view"><a href="#Build-error-view" class="headerlink" title="Build error view"></a>Build error view</h2><p>Use convenient code from <a href="https://github.com/onmyway133/Omnia">Omnia</a></p>
<p>To make view height dynamic, pin <code>UILabel</code> to edges and center</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ErrorMessageView</span>: <span class="title">UIView</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> box: <span class="type">UIView</span> = &#123;</span><br><span class="line">        <span class="keyword">let</span> view = <span class="type">UIView</span>()</span><br><span class="line">        view.backgroundColor = <span class="type">R</span>.color.primary</span><br><span class="line">        view.layer.cornerRadius = <span class="number">6</span></span><br><span class="line">        <span class="keyword">return</span> view</span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> label: <span class="type">UILabel</span> = &#123;</span><br><span class="line">        <span class="keyword">let</span> label = <span class="type">UILabel</span>()</span><br><span class="line">        label.styleAsText()</span><br><span class="line">        label.textColor = <span class="type">R</span>.color.darkText</span><br><span class="line">        label.numberOfLines = <span class="number">0</span></span><br><span class="line">        <span class="keyword">return</span> label</span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">init</span>(frame: <span class="type">CGRect</span>) &#123;</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(frame: frame)</span><br><span class="line">        setup()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">init</span>?(coder: <span class="type">NSCoder</span>) &#123;</span><br><span class="line">        <span class="built_in">fatalError</span>()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">setup</span><span class="params">()</span></span> &#123;</span><br><span class="line">        addSubviews([box, label])</span><br><span class="line">        <span class="type">NSLayoutConstraint</span>.on([</span><br><span class="line">            box.pinEdges(view: <span class="keyword">self</span>, inset: <span class="type">UIEdgeInsets</span>.all(<span class="number">16</span>)),</span><br><span class="line">            label.pinEdges(view: box, inset: <span class="type">UIEdgeInsets</span>.all(<span class="number">8</span>))</span><br><span class="line">        ])</span><br><span class="line"></span><br><span class="line">        <span class="type">NSLayoutConstraint</span>.on([</span><br><span class="line">            box.heightAnchor.constraint(greaterThanOrEqualToConstant: <span class="number">48</span>)</span><br><span class="line">        ])</span><br><span class="line"></span><br><span class="line">        <span class="type">NSLayoutConstraint</span>.on([</span><br><span class="line">            label.centerYAnchor.constraint(equalTo: centerYAnchor)</span><br><span class="line">        ])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Show-and-hide"><a href="#Show-and-hide" class="headerlink" title="Show and hide"></a>Show and hide</h2><p>Use Auto Layout and basic UIView animation. Use debouncer to avoid <code>hide</code> gets called for the new <code>show</code>. Use debouncer instead of <code>DispatchQueue.main.asyncAfter</code> because it can cancel the previous <code>DispatchWorkItem</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ErrorMessageHandler</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> view: <span class="type">UIView</span></span><br><span class="line">    <span class="keyword">let</span> errorMessageView = <span class="type">ErrorMessageView</span>()</span><br><span class="line">    <span class="keyword">let</span> debouncer = <span class="type">Debouncer</span>(delay: <span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(view: <span class="type">UIView</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.view = view</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">show</span><span class="params">(text: String)</span></span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.errorMessageView.label.text = text</span><br><span class="line">        view.addSubview(errorMessageView)</span><br><span class="line">        <span class="type">NSLayoutConstraint</span>.on([</span><br><span class="line">            errorMessageView.leftAnchor.constraint(equalTo: view.leftAnchor),</span><br><span class="line">            errorMessageView.rightAnchor.constraint(equalTo: view.rightAnchor),</span><br><span class="line">            errorMessageView.bottomAnchor.constraint(equalTo: view.safeAreaLayoutGuide.bottomAnchor)</span><br><span class="line">        ])</span><br><span class="line"></span><br><span class="line">        toggle(shows: <span class="literal">true</span>)</span><br><span class="line">        debouncer.run &#123;</span><br><span class="line">            <span class="keyword">self</span>.hide()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">hide</span><span class="params">()</span></span> &#123;</span><br><span class="line">        toggle(shows: <span class="literal">false</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">toggle</span><span class="params">(shows: Bool)</span></span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.errorMessageView.alpha = shows ? <span class="number">0</span> : <span class="number">1.0</span></span><br><span class="line">        <span class="type">UIView</span>.animate(withDuration: <span class="number">0.25</span>, animations: &#123;</span><br><span class="line">            <span class="keyword">self</span>.errorMessageView.alpha = shows ? <span class="number">1.0</span> : <span class="number">0</span></span><br><span class="line">        &#125;, completion: &#123; <span class="number">_</span> <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">if</span> shows &#123;</span><br><span class="line">                <span class="keyword">self</span>.view.bringSubviewToFront(<span class="keyword">self</span>.errorMessageView)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">self</span>.errorMessageView.removeFromSuperview()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Handle-keyboard"><a href="#Handle-keyboard" class="headerlink" title="Handle keyboard"></a>Handle keyboard</h2><p>If we add this error message on UIView in ViewController and we use <a href="https://onmyway133.github.io/blog/How-to-handle-keyboard-for-UITextField-in-scrolling-UIStackView-in-iOS/">KeyboardHandler</a> to scroll the entire view, then this snack bar will move up as well</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ErrorMessageHandler</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">let</span> errorMessageView = <span class="type">ErrorMessageView</span>()</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> view = <span class="type">UIView</span>()</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> bottomOffset: <span class="type">CGFloat</span> = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">on</span><span class="params">(view: UIView, bottomOffset: CGFloat)</span></span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.view = view</span><br><span class="line">        <span class="keyword">self</span>.bottomOffset = bottomOffset</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="UIView-animation-completion"><a href="#UIView-animation-completion" class="headerlink" title="UIView animation completion"></a>UIView animation completion</h2><p>One tricky thing is that if we call <code>hide</code> and then <code>show</code> immediately, the completion of <code>hide</code> will be called after and then remove the view.</p>
<p>When we start animation again, the previous animation is not finished, so we need to check</p>
<p>Read <a href="https://developer.apple.com/documentation/uikit/uiview/1622451-animate">UIView.animate</a></p>
<blockquote>
<p>completion<br>A block object to be executed when the animation sequence ends. This block has no return value and takes a single Boolean argument that indicates whether or not the animations actually finished before the completion handler was called. If the duration of the animation is 0, this block is performed at the beginning of the next run loop cycle. This parameter may be NULL.</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">toggle</span><span class="params">(shows: Bool)</span></span> &#123;</span><br><span class="line">    <span class="keyword">self</span>.errorMessageView.alpha = shows ? <span class="number">0</span> : <span class="number">1.0</span></span><br><span class="line">    <span class="type">UIView</span>.animate(withDuration: <span class="number">0.25</span>, delay: <span class="number">0</span>, options: .curveEaseInOut, animations: &#123;</span><br><span class="line">        <span class="keyword">self</span>.errorMessageView.alpha = shows ? <span class="number">1.0</span> : <span class="number">0</span></span><br><span class="line">    &#125;, completion: &#123; finished <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">if</span> shows &#123;</span><br><span class="line">            <span class="keyword">self</span>.view.bringSubviewToFront(<span class="keyword">self</span>.errorMessageView)</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> finished &#123;</span><br><span class="line">            <span class="keyword">self</span>.errorMessageView.removeFromSuperview()</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// No op</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-10-18T11:26:07.000Z" title="2019-10-18T11:26:07.000Z">2019-10-18</time><span class="level-item">a few seconds read (About 53 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-hide-tab-bar-when-push-in-iOS/">How to hide tab bar when push in iOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/471">#471</a></strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> navigationController = <span class="type">UINavigationController</span>(rootViewController: viewControllerA)</span><br><span class="line">navigationController.pushViewController(viewControllerB, animated: <span class="literal">true</span>)</span><br></pre></td></tr></table></figure>

<p>In view controller B, need to set <code>hidesBottomBarWhenPushed</code> in init</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ViewControllerB</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> mainView = <span class="type">EditPaymentMethodView</span>()</span><br><span class="line">    <span class="keyword">var</span> scenario: <span class="type">PaymentMethodScenario!</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>() &#123;</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(nibName: <span class="literal">nil</span>, bundle: <span class="literal">nil</span>)</span><br><span class="line"></span><br><span class="line">        hidesBottomBarWhenPushed = <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">init</span>?(coder: <span class="type">NSCoder</span>) &#123;</span><br><span class="line">        <span class="built_in">fatalError</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-10-17T12:05:36.000Z" title="2019-10-17T12:05:36.000Z">2019-10-17</time><span class="level-item">a few seconds read (About 42 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-add-trailing-image-to-UILabel-in-iOS/">How to add trailing image to UILabel in iOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/470">#470</a></strong></p>
<p>Use <code>NSTextAttachment</code> inside <code>NSAttributedString</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">UILabel</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">addTrailing</span><span class="params">(image: UIImage)</span></span> &#123;</span><br><span class="line">        <span class="keyword">let</span> attachment = <span class="type">NSTextAttachment</span>()</span><br><span class="line">        attachment.image = image</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> attachmentString = <span class="type">NSAttributedString</span>(attachment: attachment)</span><br><span class="line">        <span class="keyword">let</span> string = <span class="type">NSMutableAttributedString</span>(string: <span class="keyword">self</span>.text!, attributes: [:])</span><br><span class="line"></span><br><span class="line">        string.append(attachmentString)</span><br><span class="line">        <span class="keyword">self</span>.attributedText = string</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-10-17T09:13:07.000Z" title="2019-10-17T09:13:07.000Z">2019-10-17</time><span class="level-item">a minute read (About 140 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-handle-different-states-in-a-screen-in-iOS/">How to handle different states in a screen in iOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/469">#469</a></strong></p>
<p>If there are lots of logics and states inside a screen, it is best to introduce parent and child container, and switch child depends on state. Each child acts as a State handler.</p>
<p>In less logic case, we can introduce a Scenario class that holds the state. So the <code>ViewController</code> can be very slim. The thing with State is that all possible scenarios are clear and required to be handled</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDetailScenario</span> </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">enum</span> <span class="title">State</span> </span>&#123;</span><br><span class="line">        <span class="keyword">case</span> unknown</span><br><span class="line">        <span class="keyword">case</span> getUser(<span class="type">Email</span>)</span><br><span class="line">        <span class="keyword">case</span> newUser(<span class="type">Email</span>)</span><br><span class="line">        <span class="keyword">case</span> existingUser(<span class="type">User</span>)</span><br><span class="line">        <span class="keyword">case</span> failure(<span class="type">Error</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> state: <span class="type">State</span> = .unknown(<span class="literal">nil</span>) &#123;</span><br><span class="line">        <span class="keyword">didSet</span> &#123;</span><br><span class="line">            <span class="keyword">self</span>.reload()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">reload</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> state &#123;</span><br><span class="line">        <span class="keyword">case</span> .unknown:</span><br><span class="line">            handleUnknown()</span><br><span class="line">        <span class="keyword">case</span> .getUser(<span class="keyword">let</span> email):</span><br><span class="line">            handleGetUser(email: email)</span><br><span class="line">        <span class="keyword">case</span> .newUser(<span class="keyword">let</span> email):</span><br><span class="line">            handleNewUser(email: email)</span><br><span class="line">        <span class="keyword">case</span> .existingUser(<span class="keyword">let</span> user):</span><br><span class="line">            handleExistingUser(user: user</span><br><span class="line">        <span class="keyword">case</span> .failure(<span class="keyword">let</span> error):</span><br><span class="line">            logError(error)</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-10-16T06:05:05.000Z" title="2019-10-16T06:05:05.000Z">2019-10-16</time><span class="level-item">a few seconds read (About 27 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-structure-classes/">How to structure classes</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/466">#466</a></strong></p>
<p>iOS</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">View Controller -&gt; View Model | Logic Handler -&gt; Data Handler -&gt; Repo</span><br></pre></td></tr></table></figure>

<p>Android</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Activity -&gt; Fragment -&gt; View Model | Logic Handler -&gt; Data Handler -&gt; Repo</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-10-14T06:49:31.000Z" title="2019-10-14T06:49:31.000Z">2019-10-14</time><span class="level-item">a few seconds read (About 33 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-zoom-to-fit-many-coordinates-in-Google-Maps-in-iOS/">How to zoom to fit many coordinates in Google Maps in iOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/463">#463</a></strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">zoom</span><span class="params">(location1: CLLocation, location2: CLLocation)</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> bounds = <span class="type">GMSCoordinateBounds</span>(coordinate: location1.coordinate, coordinate: location2.coordinate)</span><br><span class="line">    <span class="keyword">let</span> update = <span class="type">GMSCameraUpdate</span>.fit(bounds, withPadding: <span class="number">16</span>)</span><br><span class="line">    mapView.animate(with: update)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-10-11T11:22:09.000Z" title="2019-10-11T11:22:09.000Z">2019-10-11</time><span class="level-item">a minute read (About 115 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-use-Codable-to-store-preferences-in-Swift/">How to use Codable to store preferences in Swift</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/462">#462</a></strong></p>
<p>Using object, we don’t need to care about <code>nil</code> vs <code>false</code> like in UserDefaults, our object is the source of truth</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StoringHandler</span>&lt;<span class="title">T</span>: <span class="title">Codable</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">let</span> key: <span class="type">Storage</span>.<span class="type">Keys</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">let</span> storage = <span class="type">Deps</span>.storage</span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(key: <span class="type">Storage</span>.<span class="type">Keys</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.key = key</span><br><span class="line">        load()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> object: <span class="type">T?</span> &#123;</span><br><span class="line">        <span class="keyword">didSet</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> object = object &#123;</span><br><span class="line">                <span class="keyword">try</span>? storage.save(object: object, key: key)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">try</span>? storage.clear(key: key)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">load</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.object = <span class="keyword">try</span>? storage.load(key: key, <span class="keyword">as</span>: <span class="type">T</span>.<span class="keyword">self</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Then subclass <code>StoringHandler</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">OnboardInfo</span>: <span class="title">Codable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> hasOnboarded: <span class="type">Bool</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">OnboardingHandler</span>: <span class="title">StoringHandler</span>&lt;<span class="title">OnboardInfo</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> storage = <span class="type">Deps</span>.storage</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> hasOnboarded: <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> object?.hasOnboarded ?? <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">set</span> &#123;</span><br><span class="line">            object = <span class="type">OnboardInfo</span>(hasOnboarded: newValue)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-10-11T11:17:14.000Z" title="2019-10-11T11:17:14.000Z">2019-10-11</time><span class="level-item">2 minutes read (About 271 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-custom-UIAlertController-in-iOS/">How to custom UIAlertController in iOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/461">#461</a></strong></p>
<p>With <a href="https://developer.apple.com/documentation/uikit/uialertcontroller">UIAlertController</a> we can add buttons and textfields, and just that</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">addAction</span><span class="params">(UIAlertAction)</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">addTextField</span><span class="params">(configurationHandler: <span class="params">(<span class="params">(UITextField)</span></span></span></span> -&gt; <span class="type">Void</span>)?)</span><br></pre></td></tr></table></figure>

<p>To add custom content to UIAlertController, there are some workarounds</p>
<h3 id="Add-content-onto-UITextField"><a href="#Add-content-onto-UITextField" class="headerlink" title="Add content onto UITextField"></a>Add content onto UITextField</h3><p>Restyle <code>UITextField</code> and add custom content</p>
<h3 id="Subclass-UIAlertController-and-handle-UI-in-viewWillAppear"><a href="#Subclass-UIAlertController-and-handle-UI-in-viewWillAppear" class="headerlink" title="Subclass UIAlertController and handle UI in viewWillAppear"></a>Subclass UIAlertController and handle UI in viewWillAppear</h3><p>By subclassing we can tweak the whole view hierarchy and listen to events like layout subviews, but this can be very fragile.</p>
<h3 id="Make-custom-UIViewController-that-looks-like-UIAlertController"><a href="#Make-custom-UIViewController-that-looks-like-UIAlertController" class="headerlink" title="Make custom UIViewController that looks like UIAlertController"></a>Make custom UIViewController that looks like UIAlertController</h3><p>This is the correct way but takes too much time to imitate UIAlertController, and have to deal with UIVisualEffectView, resize view for different screen sizes and dark mode</p>
<h3 id="Add-view-to-UIAlertController-view"><a href="#Add-view-to-UIAlertController-view" class="headerlink" title="Add view to UIAlertController view"></a>Add view to UIAlertController view</h3><p>We can detect <code>UILabel</code> to add our custom view below it, using <a href="https://onmyway133.github.io/blog/How-to-find-subview-recursively-in-Swift/">How to find subview recursively in Swift</a></p>
<p>But a less work approach is to add it above buttons, this is easily achieved by offsetting bottom.</p>
<img width="295" alt="alert" src="https://user-images.githubusercontent.com/2284279/66654203-ff2de680-ec39-11e9-995a-60435532f184.png">

<p>The trick is here is to have line breaks in message to leave space for our custom view.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> controller = <span class="type">UIAlertController</span>(</span><br><span class="line">    title: title,</span><br><span class="line">    message: message + <span class="type">String</span>(repeating: <span class="string">"\n"</span>, <span class="built_in">count</span>: <span class="number">10</span>),</span><br><span class="line">    preferredStyle: .alert</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> continueAction = <span class="type">UIAlertAction</span>(</span><br><span class="line">    title: <span class="type">R</span>.string.localizable.<span class="keyword">continue</span>(),</span><br><span class="line">    style: .<span class="keyword">default</span>) &#123; <span class="number">_</span> <span class="keyword">in</span></span><br><span class="line">        action()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> cancelAction = <span class="type">UIAlertAction</span>(title: <span class="type">R</span>.string.localizable.cancel(), style: .cancel)</span><br><span class="line">controller.addAction(cancelAction)</span><br><span class="line">controller.addAction(continueAction)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> customView = <span class="type">UIView</span>()</span><br><span class="line">customView.backgroundColor = <span class="type">UIColor</span>.green</span><br><span class="line"></span><br><span class="line">controller.view.addSubview(customView)</span><br><span class="line"><span class="type">NSLayoutConstraint</span>.on([</span><br><span class="line">    customView.leftAnchor.constraint(equalTo: controller.view.leftAnchor),</span><br><span class="line">    customView.rightAnchor.constraint(equalTo: controller.view.rightAnchor),</span><br><span class="line">    customView.bottomAnchor.constraint(equalTo: controller.view.bottomAnchor, constant: -<span class="number">50</span>),</span><br><span class="line">    customView.heightAnchor.constraint(equalToConstant: <span class="number">100</span>)</span><br><span class="line">])</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-10-11T09:06:50.000Z" title="2019-10-11T09:06:50.000Z">2019-10-11</time><span class="level-item">a few seconds read (About 43 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-find-subview-recursively-in-Swift/">How to find subview recursively in Swift</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/460">#460</a></strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">UIView</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">findRecursively</span>&lt;T: UIView&gt;<span class="params">(type: T.<span class="keyword">Type</span>, match: <span class="params">(T)</span></span></span> -&gt; <span class="type">Bool</span>) -&gt; <span class="type">T?</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> view <span class="keyword">in</span> subviews &#123;</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> subview = view <span class="keyword">as</span>? <span class="type">T</span>, match(subview) &#123;</span><br><span class="line">                <span class="keyword">return</span> subview</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> view.findRecursively(type: type, match: match)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-10-11T06:54:23.000Z" title="2019-10-11T06:54:23.000Z">2019-10-11</time><span class="level-item">9 minutes read (About 1419 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-deal-with-multiple-scenarios-with-Push-Notification-in-iOS/">How to deal with multiple scenarios with Push Notification in iOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/459">#459</a></strong></p>
<p>Here are my notes when working with Push Notification</p>
<h3 id="How-to-register"><a href="#How-to-register" class="headerlink" title="How to register"></a>How to register</h3><p><strong>Register to receive push notification</strong></p>
<p>registerForRemoteNotificationTypes is deprecated in iOS 8+</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">UIApplication</span>.sharedApplication().registerForRemoteNotifications()</span><br></pre></td></tr></table></figure>

<p><strong>Register to alert user through UI</strong></p>
<blockquote>
<p>If your app displays alerts, play sounds, or badges its icon, you must call this method during your launch cycle to request permission to alert the user in these ways</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> types: <span class="type">UIUserNotificationType</span> = [.<span class="type">Badge</span>, .<span class="type">Sound</span>, .<span class="type">Alert</span>]</span><br><span class="line"><span class="keyword">let</span> categories = <span class="type">Set</span>&lt;<span class="type">UIUserNotificationCategory</span>&gt;()</span><br><span class="line"><span class="keyword">let</span> settings = <span class="type">UIUserNotificationSettings</span>(forTypes: types, categories: categories)</span><br><span class="line"></span><br><span class="line"><span class="type">UIApplication</span>.sharedApplication().registerUserNotificationSettings(settings)</span><br></pre></td></tr></table></figure>

<p>You don’t need to wait for registerUserNotificationSettings to callback before calling registerForRemoteNotifications</p>
<p>From iOS 10, use <code>UNNotifications</code> framework <a href="https://onmyway133.github.io/blog/How-to-register-for-alert-push-notification-in-iOS/">https://onmyway133.github.io/blog/How-to-register-for-alert-push-notification-in-iOS/</a></p>
<h3 id="When-to-register"><a href="#When-to-register" class="headerlink" title="When to register"></a><strong>When to register</strong></h3><p>From <a href="https://developer.apple.com/library/mac/documentation/NetworkingInternet/Conceptual/RemoteNotificationsPG/Chapters/IPhoneOSClientImp.html">Registering, Scheduling, and Handling User Notifications</a></p>
<blockquote>
<p>Never cache a device token; always get the token from the system whenever you need it. If your app previously registered for remote notifications, calling the registerForRemoteNotifications method again does not incur any additional overhead, and iOS returns the existing device token to your app delegate immediately. In addition, iOS calls your delegate method any time the device token changes, not just in response to your app registering or re-registering<br>The user can change the notification settings for your app at any time using the Settings app. Because settings can change, always call the registerUserNotificationSettings: at launch time and use the application:didRegisterUserNotificationSettings: method to get the response. If the user disallows specific notification types, avoid using those types when configuring local and remote notifications for your app.</p>
</blockquote>
<p><strong>didReceiveRemoteNotification</strong></p>
<p>About application:didReceiveRemoteNotification:</p>
<blockquote>
<p>Implement the application:didReceiveRemoteNotification:fetchCompletionHandler: method instead of this one whenever possible. If your delegate implements both methods, the app object calls the application:didReceiveRemoteNotification:fetchCompletionHandler: method.<br>If the app is not running when a remote notification arrives, the method launches the app and provides the appropriate information in the launch options dictionary. The app does not call this method to handle that remote notification. Instead, your implementation of the application:willFinishLaunchingWithOptions: or application:didFinishLaunchingWithOptions: method needs to get the remote notification payload data and respond appropriately.</p>
</blockquote>
<p>About application:didReceiveRemoteNotification:fetchCompletionHandler:</p>
<p>This is for silent push notification with <code>content-available</code></p>
<blockquote>
<p>Unlike the application:didReceiveRemoteNotification: method, which is called only when your app is running in the foreground, the system calls this method when your app is running in the foreground or background<br>In addition, if you enabled the remote notifications background mode, the system launches your app (or wakes it from the suspended state) and puts it in the background state when a push notification arrives. However, the system does not automatically launch your app if the user has force-quit it. In that situation, the user must relaunch your app or restart the device before the system attempts to launch your app automatically again.<br>If the user opens your app from the system-displayed alert, the system may call this method again when your app is about to enter the foreground so that you can update your user interface and display information pertaining to the notification.</p>
</blockquote>
<h3 id="How-to-handle"><a href="#How-to-handle" class="headerlink" title="How to handle"></a>How to handle</h3><p>Usually, the use of push notification is to display a specific article, a specific DetailViewControllerin your app. So the good practices are</p>
<ul>
<li><p>When the app is in foreground: Gently display some kind of alert view and ask the user whether he would like to go to that specific page or not</p>
</li>
<li><p>When user is brought from background to foreground, or from terminated to foreground: Just navigate to that specific page. For example, if you use UINavigationController, you can set that specific page the top most ViewController, if you use UITabBarController, you can set that specific page the selected tab, something like that</p>
</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">- <span class="function"><span class="keyword">func</span> <span class="title">handlePushNotification</span><span class="params">(userInfo: NSDictionary)</span></span> &#123;</span><br><span class="line">    <span class="comment">// Check applicationState</span></span><br><span class="line">	<span class="keyword">if</span> (applicationState == <span class="type">UIApplicationStateActive</span>) &#123;</span><br><span class="line">        <span class="comment">// Application is running in foreground</span></span><br><span class="line">        showAlertForPushNotification(userInfo)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (applicationState == <span class="type">UIApplicationStateBackground</span> || applicationState == <span class="type">UIApplicationStateInactive</span>) &#123;</span><br><span class="line">    <span class="comment">// Application is brought from background or launched after terminated</span></span><br><span class="line">        handlePushNotification(userInfo)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Here we create another method handlePushNotification to handle push notification. When you receive push notification, 3 cases can occur</p>
<h3 id="Case-1-Foreground"><a href="#Case-1-Foreground" class="headerlink" title="Case 1: Foreground"></a>Case 1: Foreground</h3><p><strong>Loud push</strong></p>
<ul>
<li><p>No system alert</p>
</li>
<li><p>application:didReceiveRemoteNotification:fetchCompletionHandler: is called</p>
</li>
</ul>
<p><strong>Silent push</strong></p>
<ul>
<li><p>No system alert</p>
</li>
<li><p>application:didReceiveRemoteNotification:fetchCompletionHandler: is called</p>
</li>
</ul>
<h3 id="Case-2-Background"><a href="#Case-2-Background" class="headerlink" title="Case 2: Background"></a>Case 2: Background</h3><p><strong>Loud push</strong></p>
<ul>
<li><p>System alert</p>
</li>
<li><p>No method called</p>
</li>
<li><p>Tap notification and application:didReceiveRemoteNotification:fetchCompletionHandler: is called</p>
</li>
<li><p>Tap on App Icon and nothing is called</p>
</li>
</ul>
<p><strong>Silent push</strong></p>
<ul>
<li><p>No system alert</p>
</li>
<li><p>application:didReceiveRemoteNotification:fetchCompletionHandler: is called. If app is suspended, its state changed to UIApplicationStateBackground</p>
</li>
<li><p>Tap notification and application:didReceiveRemoteNotification:fetchCompletionHandler: is called</p>
</li>
<li><p>Tap on App Icon and nothing is called</p>
</li>
</ul>
<h3 id="Case-3-Terminated"><a href="#Case-3-Terminated" class="headerlink" title="Case 3: Terminated"></a>Case 3: Terminated</h3><p><strong>Loud push</strong></p>
<ul>
<li><p>System alert</p>
</li>
<li><p>No method called</p>
</li>
<li><p>Tap notification and application:didFinishLaunchingWithOptions: with launchOptions, application:didReceiveRemoteNotification:fetchCompletionHandler: is called</p>
</li>
<li><p>Tap on App Icon and application:didFinishLaunchingWithOptions: is called with launchOptions set to nil</p>
</li>
</ul>
<p><strong>Silent push</strong></p>
<ul>
<li><p>No system alert</p>
</li>
<li><p>application:didReceiveRemoteNotification:fetchCompletionHandler: is called. If app was not killed by user, it is woke up and state changed to UIApplicationStateInactive.</p>
</li>
<li><p>Tap notification and application:didFinishLaunchingWithOptions: with launchOptions, application:didReceiveRemoteNotification:fetchCompletionHandler: is called</p>
</li>
<li><p>Tap on App Icon and application:didFinishLaunchingWithOptions: is called with launchOptions set to nil</p>
</li>
</ul>
<h3 id="System-alert"><a href="#System-alert" class="headerlink" title="System alert"></a>System alert</h3><p>System alert only show if the payload contains alert</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"aps"</span> : &#123;</span><br><span class="line">        <span class="attr">"alert"</span> : &#123;</span><br><span class="line">            <span class="attr">"title"</span> : <span class="string">"Game Request"</span>,</span><br><span class="line">            <span class="attr">"body"</span> : <span class="string">"Bob wants to play poker"</span>,</span><br><span class="line">            <span class="attr">"action-loc-key"</span> : <span class="string">"PLAY"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"badge"</span> : <span class="number">5</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"param1"</span> : <span class="string">"bar"</span>,</span><br><span class="line">    <span class="attr">"param2"</span> : [ <span class="string">"bang"</span>,  <span class="string">"whiz"</span> ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Silent-push-payload"><a href="#Silent-push-payload" class="headerlink" title="Silent push payload"></a>Silent push payload</h3><p>For now I see that silent push must contain sound for application:didReceiveRemoteNotification:fetchCompletionHandler: to be called when app is in background</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"> “aps”: &#123;</span><br><span class="line"> “content-available”: <span class="number">1</span>,</span><br><span class="line"> “alert”: “hello” <span class="comment">// include this if we want to show alert</span></span><br><span class="line"> “sound”: “” <span class="comment">// this does the trick</span></span><br><span class="line"> &#125;,</span><br><span class="line"> “param1”: <span class="number">1</span>,</span><br><span class="line"> “param2”: “text”</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Read <a href="https://developer.apple.com/documentation/usernotifications/setting_up_a_remote_notification_server/pushing_background_updates_to_your_app">Pushing Background Updates to Your App</a></p>
<blockquote>
<p>If your app’s server-based content changes infrequently or at irregular intervals, you can use background notifications to notify your app when new content becomes available. A background notification is a remote notification that doesn’t display an alert, play a sound, or badge your app’s icon. It wakes your app in the background and gives it time to initiate downloads from your server and update its content.</p>
</blockquote>
<blockquote>
<p>The system treats background notifications as low-priority: you can use them to refresh your app’s content, but the system doesn’t guarantee their delivery. In addition, the system may throttle the delivery of background notifications if the total number becomes excessive. The number of background notifications allowed by the system depends on current conditions, but don’t try to send more than two or three per hour.</p>
</blockquote>
<h2 id="How-to-test-Push-notification"><a href="#How-to-test-Push-notification" class="headerlink" title="How to test Push notification"></a>How to test Push notification</h2><p>I built a macOS app called <a href="https://github.com/onmyway133/PushNotifications">PushNotification</a> for you to test push notification. It works with certificate and the new key authentication with APNS. Please give it a try</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/0*59zWlEQGvO8-OXMq.png" alt=""></p>
<p>Tutorials that use PushNotifications</p>
<ul>
<li><a href="https://itnext.io/introductory-push-notifications-fa6f68ace251">https://itnext.io/introductory-push-notifications-fa6f68ace251</a></li>
<li><a href="https://www.raywenderlich.com/8164-push-notifications-tutorial-getting-started">https://www.raywenderlich.com/8164-push-notifications-tutorial-getting-started</a></li>
</ul>
<h2 id="Troubleshooting"><a href="#Troubleshooting" class="headerlink" title="Troubleshooting"></a>Troubleshooting</h2><h3 id="Silent-notification-with-push-notification-enabled"><a href="#Silent-notification-with-push-notification-enabled" class="headerlink" title="Silent notification with push notification enabled"></a>Silent notification with push notification enabled</h3><p>In theory, if user disables push notification then silent notification still goes through </p>
<p><a href="https://stackoverflow.com/questions/31450403/didreceiveremotenotification-not-working-in-the-background">https://stackoverflow.com/questions/31450403/didreceiveremotenotification-not-working-in-the-background</a></p>
<p>but <code>sound</code> key should be present</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    aps = &#123;</span><br><span class="line">        "content-available" : 1,</span><br><span class="line">        sound : ""</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>When open the app, <code>didReceiveRemoteNotification</code> is called immediately with the silent push message</p>
<h2 id="Where-to-go-from-here"><a href="#Where-to-go-from-here" class="headerlink" title="Where to go from here"></a>Where to go from here</h2><p>I hope you find this article useful. iOS changes fast so some the things I mention may be outdated by the time you read, if so please let me know. Here are some more interesting links</p>
<ul>
<li><a href="https://developer.apple.com/library/ios/documentation/NetworkingInternet/Conceptual/RemoteNotificationsPG/Chapters/IPhoneOSClientImp.html">Scheduling, Registering, and Handling Notifications</a></li>
<li><a href="http://www.abdus.me/ios-programming-tips/handle-push-notifications-when-arrived-ios/">Handle push notifications when arrived in iOS application</a></li>
<li><a href="http://stackoverflow.com/questions/5099483/how-to-respond-to-push-notification-view-if-app-is-already-running-in-the-backgr">How to respond to push notification view if app is already running in the background</a></li>
<li><a href="http://stackoverflow.com/questions/5056689/didreceiveremotenotification-when-in-background">didReceiveRemoteNotification when in background</a></li>
<li><a href="https://samwize.com/2015/08/07/how-to-handle-remote-notification-with-background-mode-enabled/">How to handle remote notification with background mode enabled</a></li>
<li><a href="http://stackoverflow.com/questions/20569201/remote-notification-method-called-twice">Remote notification method called twice</a></li>
</ul>
<hr>
<p>Original post <a href="https://medium.com/fantageek/push-notification-in-ios-46d979e5f7ec">https://medium.com/fantageek/push-notification-in-ios-46d979e5f7ec</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-10-11T06:04:26.000Z" title="2019-10-11T06:04:26.000Z">2019-10-11</time><span class="level-item">a minute read (About 154 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-use-Apple-certificate-in-Xcode-11/">How to use Apple certificate in Xcode 11</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/458">#458</a></strong></p>
<p>For push notification, we can now use just Production Certificate for 2 environments (production and sandbox) instead of Development and Production certificates.</p>
<p>Now for code signing, with Xcode 11 <a href="https://developer.apple.com/documentation/xcode_release_notes/xcode_11_release_notes">https://developer.apple.com/documentation/xcode_release_notes/xcode_11_release_notes</a> we can just use Apple Development and Apple Distribution certificate for multiple platforms</p>
<blockquote>
<p> Signing and capabilities settings are now combined within a new Signing &amp; Capabilities tab in the Project Editor. The new tab enables using different app capabilities across multiple build configurations. The new capabilities library makes it possible to search for available capabilities</p>
</blockquote>
<blockquote>
<p>Xcode 11 supports the new Apple Development and Apple Distribution certificate types. These certificates support building, running, and distributing apps on any Apple platform. Preexisting iOS and macOS development and distribution certificates continue to work, however, new certificates you create in Xcode 11 use the new types. Previous versions of Xcode don’t support these certificates</p>
</blockquote>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-10-10T11:14:20.000Z" title="2019-10-10T11:14:20.000Z">2019-10-10</time><span class="level-item">2 minutes read (About 346 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-use-provisional-notification-in-iOS-12/">How to use provisional notification in iOS  12</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/456">#456</a></strong></p>
<p>From <a href="https://developer.apple.com/videos/play/wwdc2018/710/?time=1797">WWDC 2018  What’s New in User Notifications</a></p>
<blockquote>
<p>Instead, the notifications from your app will automatically start getting delivered.</p>
</blockquote>
<blockquote>
<p>Notifications that are delivered with provisional authorization will have a prompt like this on the notification itself. And this will help the users decide after having received a few notifications whether they want to keep getting these notifications or whether they want to turn them off</p>
</blockquote>
<blockquote>
<p>It’s an automatic trial of the notifications from your app to help your users make a more informed decision about whether they want these notifications.</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">notificationCenter.requestAuthorization(  </span><br><span class="line">     options:[.badge, .sound, .alert, .provisional]) &#123;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>From <a href="http://info.localytics.com/blog/ios-12-brings-new-power-to-push-notifications">http://info.localytics.com/blog/ios-12-brings-new-power-to-push-notifications</a></p>
<blockquote>
<p> Provisional Authorization takes advantage of another new feature in iOS 12: the ability for messages to be “delivered quietly.” When a notification is delivered quietly, it can only be seen in the iOS Notification Center, which the user accesses by swiping down from the top of their phone. They don’t appear as banners or show up on the lock screen. As you might have guessed, quiet notifications also don’t make a sound.</p>
</blockquote>
<p><img src="https://info.localytics.com/hs-fs/hubfs/Provisional%20Push%20Keep%20Confirmation%20on%20iPhone.png?width=500&name=Provisional%20Push%20Keep%20Confirmation%20on%20iPhone.png" alt=""></p>
<blockquote>
<p> If a user taps the “Keep” button, they can decide whether they want your app’s notifications to start getting delivered prominently (i.e. fully opt-in to push notifications) or continue to receive them quietly (i.e. pushes continue to get sent directly to the Notification Center).</p>
</blockquote>
<blockquote>
<p>The intent of Provisional Authorization is to give users a trial run with your app’s notifications. Apple created Provisional Authorization because it realized that it’s impossible for users to make an informed choice about whether or not they want to receive push notifications from an app until they’ve seen what kinds of messages the app is going to send them.</p>
</blockquote>
<hr>
<p><strong>Updated at</strong> 2020-11-11 02:04:01</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-10-10T10:50:26.000Z" title="2019-10-10T10:50:26.000Z">2019-10-10</time><span class="level-item">2 minutes read (About 292 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-check-if-push-notification-is-actually-enabled-in-iOS/">How to check if push notification is actually enabled in iOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/455">#455</a></strong></p>
<p>There are times we want to log if user can receive push notification. We may be tempted to merely use <code>isRegisteredForRemoteNotifications</code> but that is not enough. From a user ‘s point of view, they can either receive push notification or not. But behind the scene, many factors are in the game. It can be that user has disabled push notification in app settings or in iOS Settings. It can also be that user enables push notification but disables all sound or banner display mechanism.</p>
<p><code>isRegisteredForRemoteNotifications</code> is that your app has connected to APNS and get device token, this can be for silent push notification<br><code>currentUserNotificationSettings</code> is for user permissions, without this, there is no alert, banner or sound push notification delivered to the app<br>Here is the check</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">var</span> isPushNotificationEnabled: <span class="type">Bool</span> &#123;</span><br><span class="line">  <span class="keyword">guard</span> <span class="keyword">let</span> settings = <span class="type">UIApplication</span>.shared.currentUserNotificationSettings</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="type">UIApplication</span>.shared.isRegisteredForRemoteNotifications</span><br><span class="line">    &amp;&amp; !settings.types.isEmpty</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>For iOS 10, with the introduction of <code>UserNotifications</code> framework, instead of checking for <code>currentUserNotificationSettings</code>, you should use UserNotifications framework</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">center.getNotificationSettings(completionHandler: &#123; settings <span class="keyword">in</span></span><br><span class="line">  <span class="keyword">switch</span> settings.authorizationStatus &#123;</span><br><span class="line">  <span class="keyword">case</span> .authorized, .provisional:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"authorized"</span>)</span><br><span class="line">  <span class="keyword">case</span> .denied:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"denied"</span>)</span><br><span class="line">  <span class="keyword">case</span> .notDetermined:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"not determined, ask user for permission now"</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>Push notification can be delivered to our apps in many ways, and we can ask for that</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">UNUserNotificationCenter</span>.current()</span><br><span class="line">  .requestAuthorization(options: [.alert, .sound, .badge])</span><br></pre></td></tr></table></figure>

<p>User can go to Settings app and turn off any of those at any time, so it’s best to check for that in the settings object</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">UNNotificationSettings</span> : <span class="title">NSObject</span>, <span class="title">NSCopying</span>, <span class="title">NSSecureCoding</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> authorizationStatus: <span class="type">UNAuthorizationStatus</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> soundSetting: <span class="type">UNNotificationSetting</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> badgeSetting: <span class="type">UNNotificationSetting</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> alertSetting: <span class="type">UNNotificationSetting</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> notificationCenterSetting: <span class="type">UNNotificationSetting</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Original answer <a href="https://stackoverflow.com/a/44407710/1418457">https://stackoverflow.com/a/44407710/1418457</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-10-10T10:45:29.000Z" title="2019-10-10T10:45:29.000Z">2019-10-10</time><span class="level-item">a minute read (About 216 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-use-UserNotificationsUI-in-iOS/">How to use UserNotificationsUI in iOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/454">#454</a></strong></p>
<p>From documentation <a href="https://developer.apple.com/documentation/usernotificationsui">https://developer.apple.com/documentation/usernotificationsui</a></p>
<blockquote>
<p>Customize how local and remote notifications appear on the user’s device by adding a notification content app extension to the bundle of your iOS app. Your extension manages a custom view controller, which you use to present the content from incoming notifications. When a notification arrives, the system displays your view controller in addition to, or in place of, the default system interface.</p>
</blockquote>
<p><a href="https://developer.apple.com/documentation/usernotificationsui/customizing_the_appearance_of_notifications">https://developer.apple.com/documentation/usernotificationsui/customizing_the_appearance_of_notifications</a></p>
<blockquote>
<p>When an iOS device receives a notification containing an alert, the system displays the contents of the alert in two stages. Initially, it displays an abbreviated banner with the title, subtitle, and two to four lines of body text from the notification. If the user presses the abbreviated banner, iOS displays the full notification interface, including any notification-related actions. The system provides the interface for the abbreviated banner, but you can customize the full interface using a notification content app extension.</p>
</blockquote>
<p><img src="https://docs-assets.developer.apple.com/published/ff99a71282/b6f2b1aa-fb42-4517-b5b8-9e955c6455da.png" alt=""></p>
<p>Use <code>Notification Content Extension</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">didReceive</span><span class="params">(<span class="number">_</span> notification: UNNotification)</span></span> &#123;</span><br><span class="line">   <span class="keyword">self</span>.bodyText?.text = notification.request.content.body</span><br><span class="line">   <span class="keyword">self</span>.headlineText?.text = notification.request.content.title</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-10-10T07:57:27.000Z" title="2019-10-10T07:57:27.000Z">2019-10-10</time><span class="level-item">a minute read (About 176 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-register-for-alert-push-notification-in-iOS/">How to  register for alert push notification in iOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/452">#452</a></strong></p>
<p>Use <code>UserNotifications</code> framework</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> FirebaseMessaging</span><br><span class="line"><span class="keyword">import</span> UserNotifications</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">PushHandler</span>: <span class="title">NSObject</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">let</span> center = <span class="type">UNUserNotificationCenter</span>.current()</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">let</span> options: <span class="type">UNAuthorizationOptions</span> = [.alert]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">setup</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="type">Messaging</span>.messaging().delegate = <span class="keyword">self</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">register</span><span class="params">()</span></span> &#123;</span><br><span class="line">        center.requestAuthorization(options: options, completionHandler: &#123; granted, error <span class="keyword">in</span></span><br><span class="line">            <span class="built_in">print</span>(granted, error)</span><br><span class="line">            <span class="keyword">self</span>.getSettings()</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">getSettings</span><span class="params">()</span></span> &#123;</span><br><span class="line">        center.getNotificationSettings(completionHandler: &#123; settings <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">guard</span></span><br><span class="line">                <span class="keyword">case</span> <span class="keyword">let</span> .authorized = settings.authorizationStatus,</span><br><span class="line">                <span class="keyword">case</span> <span class="keyword">let</span> .enabled = settings.alertSetting,</span><br><span class="line">                settings.alertStyle != .<span class="keyword">none</span></span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// TODO</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">handle</span><span class="params">(userInfo: [AnyHashable: <span class="keyword">Any</span>])</span></span> &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">PushHandler</span>: <span class="title">MessagingDelegate</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">messaging</span><span class="params">(<span class="number">_</span> messaging: Messaging, didReceiveRegistrationToken fcmToken: String)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(fcmToken)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">messaging</span><span class="params">(<span class="number">_</span> messaging: Messaging, didReceive remoteMessage: MessagingRemoteMessage)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(remoteMessage)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@UIApplicationMain</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AppDelegate</span>: <span class="title">UIResponder</span>, <span class="title">UIApplicationDelegate</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">application</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="number">_</span> application: UIApplication,</span></span></span><br><span class="line"><span class="function"><span class="params">        didReceiveRemoteNotification userInfo: [AnyHashable: <span class="keyword">Any</span>],</span></span></span><br><span class="line"><span class="function"><span class="params">        fetchCompletionHandler completionHandler: @escaping <span class="params">(UIBackgroundFetchResult)</span></span></span> -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">        completionHandler(.noData)</span><br><span class="line"></span><br><span class="line">        <span class="type">Deps</span>.pushHandler.handle(userInfo: userInfo)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>A test message from Firebase looks like</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[AnyHashable(&quot;google.c.a.e&quot;): 1, AnyHashable(&quot;google.c.a.ts&quot;): 1570701857, AnyHashable(&quot;aps&quot;): &#123;</span><br><span class="line">    alert &#x3D;     &#123;</span><br><span class="line">        body &#x3D; Test;</span><br><span class="line">        title &#x3D; Test;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;, AnyHashable(&quot;google.c.a.udt&quot;): 0, AnyHashable(&quot;google.c.a.c_l&quot;): Test, AnyHashable(&quot;gcm.message_id&quot;): 1570701857965182, AnyHashable(&quot;google.c.a.c_id&quot;): 1257698497812622975, AnyHashable(&quot;gcm.n.e&quot;): 1]</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-10-07T05:43:56.000Z" title="2019-10-07T05:43:56.000Z">2019-10-07</time><span class="level-item">a few seconds read (About 91 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-fix-unreadable-ASCII-characters-in-Swift/">How to fix unreadable ASCII characters in Swift</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/444">#444</a></strong></p>
<p>To avoid compiler error <code>Unprintable ASCII character found in source file</code>, from Swift 5, we can use <code>isASCII</code>.</p>
<p>Run this from the generator app that generates Swift code.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> normalized = weirdString.<span class="built_in">filter</span>(&#123; $<span class="number">0</span>.isASCII &#125;)</span><br></pre></td></tr></table></figure>

<p>For more check, see Character <a href="https://developer.apple.com/documentation/swift/character/3127011-isletter">https://developer.apple.com/documentation/swift/character/3127011-isletter</a></p>
<p>Watch out for</p>
<ul>
<li>Delete/House symbol ⌂ code 127 (0x7f)</li>
</ul>
<p>The above does not seem to work, use find to find <code></code> character (copy Sublime Text to see 0x7f character)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find .&#x2F; -type f -exec sed -i &#39;&#39; -e &#39;s&#x2F;&#x2F;&#x2F;&#39; &#123;&#125; \;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-10-03T06:39:35.000Z" title="2019-10-03T06:39:35.000Z">2019-10-03</time><span class="level-item">a few seconds read (About 30 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-get-url-of-app-on-the-iOS-AppStore/">How to get url of app on the iOS AppStore</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/440">#440</a></strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;itunes.apple.com&#x2F;[country]&#x2F;app&#x2F;[App–Name]&#x2F;id[App-ID]?mt&#x3D;8</span><br></pre></td></tr></table></figure>

<p>For example <a href="https://apps.apple.com/nl/app/cutters/id1466739130">https://apps.apple.com/nl/app/cutters/id1466739130</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-09-30T18:15:00.000Z" title="2019-09-30T18:15:00.000Z">2019-09-30</time><span class="level-item">a few seconds read (About 39 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-handle-UICollectionView-reloadData-with-selected-index-path/">How to handle UICollectionView reloadData with selected index path</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/434">#434</a></strong></p>
<p>When calling <code>collectionView.reloadData()</code>, selected indexpath stays the same, but be aware that order of data may have changed</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> selectedData = ...</span><br><span class="line"><span class="keyword">let</span> indexPathForSelectedData = ...</span><br><span class="line"></span><br><span class="line">collectionView.scrollToItem(</span><br><span class="line">    at: indexPathForSelectedData,</span><br><span class="line">    at: .centeredHorizontally,</span><br><span class="line">    animated: <span class="literal">false</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-09-17T11:05:11.000Z" title="2019-09-17T11:05:11.000Z">2019-09-17</time><span class="level-item">2 minutes read (About 287 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-use-Firebase-ID-token/">How to use Firebase ID token</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/424">#424</a></strong></p>
<ul>
<li><a href="https://medium.com/@jwngr/demystifying-firebase-auth-tokens-e0c533ed330c">https://medium.com/@jwngr/demystifying-firebase-auth-tokens-e0c533ed330c</a></li>
</ul>
<blockquote>
<p>One confusing point here that people often do not realize is that even though the custom token itself expires after one hour, a modern client SDK authenticated with that custom token will stay authenticated beyond that hour! What happens under the hood is that the custom token is sent to the Firebase Auth service in exchange for an ID token and refresh token pair which are used to keep the client SDK authenticated</p>
</blockquote>
<blockquote>
<p>As with custom tokens, ID tokens are short-lived JWTs, lasting for just one hour. In order to allow end users to stay logged in for more than one hour, the modern SDKs transparently refresh a user’s ID token on your behalf using a refresh token</p>
</blockquote>
<blockquote>
<p>If your app includes a custom backend server, ID tokens can and should be used to communicate securely with it. Instead of sending requests with a user’s raw uid which can be easily spoofed by a malicious client, send the user’s ID token which can be verified via a Firebase Admin SDK </p>
</blockquote>
<ul>
<li><a href="https://firebase.google.com/docs/auth/admin/verify-id-tokens#retrieve_id_tokens_on_clients">https://firebase.google.com/docs/auth/admin/verify-id-tokens#retrieve_id_tokens_on_clients</a></li>
</ul>
<blockquote>
<p>When a user or device successfully signs in, Firebase creates a corresponding ID token that uniquely identifies them and grants them access to several resources, such as Firebase Realtime Database and Cloud Storage. You can re-use that ID token to identify the user or device on your custom backend server. To retrieve the ID token from the client, make sure the user is signed in and then get the ID token from the signed-in user:</p>
</blockquote>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-09-17T07:44:33.000Z" title="2019-09-17T07:44:33.000Z">2019-09-17</time><span class="level-item">a few seconds read (About 69 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-constrain-to-views-inside-UICollectionViewCell-in-iOS/">How to constrain to views inside UICollectionViewCell in iOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/422">#422</a></strong></p>
<p>To constrain views outside to elements inside <code>UICollectionViewCell</code>, we can use <code>UILayoutGuide</code>.</p>
<p>Need to make layout guide the same constraints as the real elements</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> imageViewGuide = <span class="type">UILayoutGuide</span>()</span><br><span class="line">collectionView.addLayoutGuide(imageViewGuide)</span><br><span class="line"><span class="type">NSLayoutConstraint</span>.on([</span><br><span class="line">    imageViewGuide.topAnchor.constraint(equalTo: collectionView.topAnchor, constant: <span class="number">16</span>),</span><br><span class="line">    imageViewGuide.heightAnchor.constraint(equalTo: collectionView.heightAnchor, multiplier: <span class="number">0.5</span>)</span><br><span class="line">])</span><br></pre></td></tr></table></figure>

<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">NSLayoutConstraint</span>.on([</span><br><span class="line">    loadingIndicator.centerXAnchor.constraint(equalTo: collectionView.centerXAnchor),</span><br><span class="line">    loadingIndicator.centerYAnchor.constraint(equalTo: imageViewGuide.centerYAnchor)</span><br><span class="line">])</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-09-16T09:14:07.000Z" title="2019-09-16T09:14:07.000Z">2019-09-16</time><span class="level-item">a few seconds read (About 92 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-secure-CVC-in-STPPaymentCardTextField-in-Stripe-for-iOS/">How to secure CVC in STPPaymentCardTextField in Stripe for iOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/421">#421</a></strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">maskCvcIfAny</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">guard</span></span><br><span class="line">        <span class="keyword">let</span> view = paymentTextField.subviews.first(<span class="keyword">where</span>: &#123; !($<span class="number">0</span> <span class="keyword">is</span> <span class="type">UIImageView</span>) &#125;),</span><br><span class="line">        <span class="keyword">let</span> cvcField = view.subviews</span><br><span class="line">			.compactMap(&#123; $<span class="number">0</span> <span class="keyword">as</span>? <span class="type">UITextField</span> &#125;)</span><br><span class="line">			.first(<span class="keyword">where</span>: &#123; $<span class="number">0</span>.tag == <span class="number">2</span> &amp;&amp; ($<span class="number">0</span>.accessibilityLabel ?? <span class="string">""</span>).lowercased().<span class="built_in">contains</span>(<span class="string">"cvc"</span>)  &#125;)</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    cvcField.isSecureTextEntry = <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>where tag is in <code>STPPaymentCardTextFieldViewModel.h</code></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="built_in">NS_ENUM</span>(<span class="built_in">NSInteger</span>, STPCardFieldType) &#123;</span><br><span class="line">    STPCardFieldTypeNumber,</span><br><span class="line">    STPCardFieldTypeExpiration,</span><br><span class="line">    STPCardFieldTypeCVC,</span><br><span class="line">    STPCardFieldTypePostalCode,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>Also, need to check <code>accessibilityLabel</code> in <code>STPPaymentCardTextField.m</code></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">NSString</span> *)defaultCVCPlaceholder &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.viewModel.brand == STPCardBrandAmex) &#123;</span><br><span class="line">        <span class="keyword">return</span> STPLocalizedString(<span class="string">@"CVV"</span>, <span class="string">@"Label for entering CVV in text field"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> STPLocalizedString(<span class="string">@"CVC"</span>, <span class="string">@"Label for entering CVC in text field"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-09-12T11:32:10.000Z" title="2019-09-12T11:32:10.000Z">2019-09-12</time><span class="level-item">a minute read (About 179 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-easily-parse-deep-json-in-Swift/">How to easily parse deep json in Swift</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/414">#414</a></strong></p>
<p><code>Codable</code> is awesome, but sometimes we just need to quickly get value in a deepy nested JSON. In the same way I did for Dart <a href="https://github.com/onmyway133/blog/issues/198">How to resolve deep json object in Dart</a>, let’s make that in Swift.</p>
<p>See <a href="https://github.com/onmyway133/Omnia/blob/master/Sources/Shared/JSON.swift">https://github.com/onmyway133/Omnia/blob/master/Sources/Shared/JSON.swift</a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">resolve</span>&lt;T&gt;<span class="params">(<span class="number">_</span> jsonDictionary: [String: <span class="keyword">Any</span>], keyPath: String)</span></span> -&gt; <span class="type">T?</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> current: <span class="type">Any?</span> = jsonDictionary</span><br><span class="line"></span><br><span class="line">    keyPath.<span class="built_in">split</span>(separator: <span class="string">"."</span>).forEach &#123; component <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> maybeInt = <span class="type">Int</span>(component), <span class="keyword">let</span> array = current <span class="keyword">as</span>? <span class="type">Array</span>&lt;<span class="type">Any</span>&gt; &#123;</span><br><span class="line">            current = array[maybeInt]</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> <span class="keyword">let</span> dictionary = current <span class="keyword">as</span>? <span class="type">JSONDictionary</span> &#123;</span><br><span class="line">            current = dictionary[<span class="type">String</span>(component)]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> current <span class="keyword">as</span>? <span class="type">T</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>So we can just resolve via key path</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">JSONTests</span>: <span class="title">XCTestCase</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">let</span> json: [<span class="type">String</span>: <span class="type">Any</span>] = [</span><br><span class="line">            <span class="string">"outside"</span>: [</span><br><span class="line">                <span class="string">"object"</span>: [</span><br><span class="line">                    <span class="string">"number"</span>: <span class="number">1</span>,</span><br><span class="line">                    <span class="string">"text"</span>: <span class="string">"hello"</span></span><br><span class="line">                ],</span><br><span class="line">                <span class="string">"arrayOfObjects"</span>: [</span><br><span class="line">                    [</span><br><span class="line">                        <span class="string">"number"</span>: <span class="number">2</span>,</span><br><span class="line">                        <span class="string">"text"</span>: <span class="string">"two"</span></span><br><span class="line">                    ],</span><br><span class="line">                    [</span><br><span class="line">                        <span class="string">"number"</span>: <span class="number">3</span>,</span><br><span class="line">                        <span class="string">"text"</span>: <span class="string">"three"</span></span><br><span class="line">                    ]</span><br><span class="line">                ],</span><br><span class="line">                <span class="string">"arrayOfArrays"</span>: [</span><br><span class="line">                    [</span><br><span class="line">                        <span class="string">"one"</span>, <span class="string">"two"</span>, <span class="string">"three"</span>, <span class="string">"four"</span></span><br><span class="line">                    ],</span><br><span class="line">                    [</span><br><span class="line">                        <span class="string">"five"</span>, <span class="string">"six"</span>, <span class="string">"seven"</span></span><br><span class="line">                    ]</span><br><span class="line">                ]</span><br><span class="line">            ]</span><br><span class="line">        ]</span><br><span class="line"></span><br><span class="line">        <span class="type">XCTAssertEqual</span>(resolve(json, keyPath: <span class="string">"outside.object.number"</span>), <span class="number">1</span>)</span><br><span class="line">        <span class="type">XCTAssertEqual</span>(resolve(json, keyPath: <span class="string">"outside.object.text"</span>), <span class="string">"hello"</span>)</span><br><span class="line">        <span class="type">XCTAssertEqual</span>(resolve(json, keyPath: <span class="string">"outside.arrayOfObjects.1.number"</span>), <span class="number">3</span>)</span><br><span class="line">        <span class="type">XCTAssertEqual</span>(resolve(json, keyPath: <span class="string">"outside.arrayOfArrays.1.1"</span>), <span class="string">"six"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-09-10T09:23:47.000Z" title="2019-09-10T09:23:47.000Z">2019-09-10</time><span class="level-item">3 minutes read (About 391 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-speed-up-GMSMarker-in-Google-Maps-for-iOS/">How to speed up GMSMarker in Google Maps for iOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/412">#412</a></strong></p>
<ul>
<li>Google Maps with a lot of pin, and no clustering can have bad performance if there are complex view in the marker.</li>
<li>The workaround is to use manual layout and rasterization</li>
</ul>
<p><a href="https://developer.apple.com/documentation/quartzcore/calayer/1410905-shouldrasterize">shouldRasterize</a></p>
<blockquote>
<p>When the value of this property is true, the layer is rendered as a bitmap in its local coordinate space and then composited to the destination with any other content. Shadow effects and any filters in the filters property are rasterized and included in the bitmap. However, the current opacity of the layer is not rasterized. If the rasterized bitmap requires scaling during compositing, the filters in the minificationFilter and magnificationFilter properties are applied as needed.</p>
</blockquote>
<p>In the <code>class PinView: UIView</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">isOpaque = <span class="literal">true</span></span><br><span class="line">layer.shouldRasterize = <span class="literal">true</span></span><br><span class="line">layer.rasterizationScale = <span class="type">UIScreen</span>.main.scale</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">StopMarker</span>: <span class="title">GMSMarker</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> stop: <span class="type">Stop</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">let</span> pinView = <span class="type">PinView</span>()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(stop: <span class="type">Stop</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.stop = stop</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>()</span><br><span class="line">        <span class="keyword">self</span>.position = stop.toCoordinate()</span><br><span class="line">        <span class="keyword">self</span>.iconView = pinView</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Read-more"><a href="#Read-more" class="headerlink" title="Read more"></a>Read more</h2><ul>
<li><a href="http://angelolloqui.com/blog/30-iOS-Performance-tips-I-Drawing-shadows">iOS Performance tips I: Drawing shadows</a></li>
</ul>
<blockquote>
<p>When your app needs to draw something on the screen, the GPU takes your layer hierarchy (UIView is just a wrapper on top of CALayer, which in the end are OpenGL textures) and applies one by one on top of each other based on their x,y,z position. In regular rendering, the whole operation happens in special frame buffers that the display will directly read for rendering on the screen, repeating the process at a rate around 60 times per second.</p>
</blockquote>
<blockquote>
<p>Of course the process have some drawbacks as well. The main one is that offscreen rendering requires a context switch (GPU has to change to a different memory area to perform the drawing) and then copying the resulting composited layer into the frame buffer. Every time any of the composited layers change, the cache needs to be redrawn again. This is why in many circumstances offscreen rendering is not a good idea, as it requires additional computation when need to be rerendered. Besides, the layer requires extra video memory which of course is limited, so use it with caution. </p>
</blockquote>
<ul>
<li><a href="https://www.objc.io/issues/3-views/moving-pixels-onto-the-screen/">Getting Pixels onto the Screen</a></li>
<li><a href="https://stackoverflow.com/questions/19405741/when-should-i-set-layer-shouldrasterize-to-yes">https://stackoverflow.com/questions/19405741/when-should-i-set-layer-shouldrasterize-to-yes</a></li>
</ul>
</div></article></div><nav class="pagination is-centered mt-4" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/tags/iOS/">Previous</a></div><div class="pagination-next"><a href="/tags/iOS/page/3/">Next</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/tags/iOS/">1</a></li><li><a class="pagination-link is-current" href="/tags/iOS/page/2/">2</a></li><li><a class="pagination-link" href="/tags/iOS/page/3/">3</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/tags/iOS/page/6/">6</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="" src="https://avatars1.githubusercontent.com/u/2284279?s=460&amp;v=4" alt="onmyway133"></figure><p class="title is-size-4 is-block line-height-inherit">onmyway133</p><p class="is-size-6 is-block">iOS, macOS, Android, React. Serial maker. Writer. Speaker.</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Oslo, Norway</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">689</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">54</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/onmyway133" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/onmyway133"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com/onmyway133"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile is-mobile" href="https://onmyway133.com/apps" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Apps</span></span><span class="level-right"><span class="level-item tag">onmyway133.com</span></span></a></li><li><a class="level is-mobile is-mobile" href="https://learntalks.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Learn Talks</span></span><span class="level-right"><span class="level-item tag">learntalks.com</span></span></a></li><li><a class="level is-mobile is-mobile" href="https://wwdctogether.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">WWDC Together</span></span><span class="level-right"><span class="level-item tag">wwdctogether.com</span></span></a></li></ul></div></div></div><!--!--><div class="card widget"><div class="card-content"><h3 class="menu-label">Recent</h3><article class="media"><div class="media-content size-small"><p><time dateTime="2021-01-05T06:07:53.000Z">2021-01-05</time></p><p class="title is-6"><a class="link-muted" href="/blog/How-to-make-Auto-Layout-more-convenient-in-iOS/">How to make Auto Layout more convenient in iOS</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2021-01-04T05:47:09.000Z">2021-01-04</time></p><p class="title is-6"><a class="link-muted" href="/blog/How-to-use-Core-Data/">How to use Core Data</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2021-01-04T05:44:31.000Z">2021-01-04</time></p><p class="title is-6"><a class="link-muted" href="/blog/How-to-form-product-idea/">How to form product idea</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2021-01-04T05:43:09.000Z">2021-01-04</time></p><p class="title is-6"><a class="link-muted" href="/blog/How-to-join-AppStore-Small-Business-Program/">How to join AppStore Small Business Program</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2021-01-04T05:41:17.000Z">2021-01-04</time></p><p class="title is-6"><a class="link-muted" href="/blog/How-to-deep-work/">How to deep work</a></p><p class="is-uppercase"></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/archives/2021/01/"><span class="level-start"><span class="level-item">January 2021</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/12/"><span class="level-start"><span class="level-item">December 2020</span></span><span class="level-end"><span class="level-item tag">29</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/11/"><span class="level-start"><span class="level-item">November 2020</span></span><span class="level-end"><span class="level-item tag">15</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/10/"><span class="level-start"><span class="level-item">October 2020</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/09/"><span class="level-start"><span class="level-item">September 2020</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/08/"><span class="level-start"><span class="level-item">August 2020</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/06/"><span class="level-start"><span class="level-item">June 2020</span></span><span class="level-end"><span class="level-item tag">14</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/05/"><span class="level-start"><span class="level-item">May 2020</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/04/"><span class="level-start"><span class="level-item">April 2020</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/03/"><span class="level-start"><span class="level-item">March 2020</span></span><span class="level-end"><span class="level-item tag">21</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/02/"><span class="level-start"><span class="level-item">February 2020</span></span><span class="level-end"><span class="level-item tag">20</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/01/"><span class="level-start"><span class="level-item">January 2020</span></span><span class="level-end"><span class="level-item tag">30</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/12/"><span class="level-start"><span class="level-item">December 2019</span></span><span class="level-end"><span class="level-item tag">36</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/11/"><span class="level-start"><span class="level-item">November 2019</span></span><span class="level-end"><span class="level-item tag">38</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/10/"><span class="level-start"><span class="level-item">October 2019</span></span><span class="level-end"><span class="level-item tag">49</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/09/"><span class="level-start"><span class="level-item">September 2019</span></span><span class="level-end"><span class="level-item tag">50</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/08/"><span class="level-start"><span class="level-item">August 2019</span></span><span class="level-end"><span class="level-item tag">39</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/07/"><span class="level-start"><span class="level-item">July 2019</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/06/"><span class="level-start"><span class="level-item">June 2019</span></span><span class="level-end"><span class="level-item tag">41</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/05/"><span class="level-start"><span class="level-item">May 2019</span></span><span class="level-end"><span class="level-item tag">50</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/04/"><span class="level-start"><span class="level-item">April 2019</span></span><span class="level-end"><span class="level-item tag">27</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/03/"><span class="level-start"><span class="level-item">March 2019</span></span><span class="level-end"><span class="level-item tag">24</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/02/"><span class="level-start"><span class="level-item">February 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/12/"><span class="level-start"><span class="level-item">December 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/05/"><span class="level-start"><span class="level-item">May 2018</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/04/"><span class="level-start"><span class="level-item">April 2018</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/02/"><span class="level-start"><span class="level-item">February 2018</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/01/"><span class="level-start"><span class="level-item">January 2018</span></span><span class="level-end"><span class="level-item tag">14</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/12/"><span class="level-start"><span class="level-item">December 2017</span></span><span class="level-end"><span class="level-item tag">14</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/11/"><span class="level-start"><span class="level-item">November 2017</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/10/"><span class="level-start"><span class="level-item">October 2017</span></span><span class="level-end"><span class="level-item tag">18</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/09/"><span class="level-start"><span class="level-item">September 2017</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/08/"><span class="level-start"><span class="level-item">August 2017</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/07/"><span class="level-start"><span class="level-item">July 2017</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/06/"><span class="level-start"><span class="level-item">June 2017</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/05/"><span class="level-start"><span class="level-item">May 2017</span></span><span class="level-end"><span class="level-item tag">35</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/04/"><span class="level-start"><span class="level-item">April 2017</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/algorithm/"><span class="tag">algorithm</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/android/"><span class="tag">android</span><span class="tag is-grey-lightest">34</span></a></div><div class="control"><a class="tags has-addons" href="/tags/apple-script/"><span class="tag">apple script</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/catalyst/"><span class="tag">catalyst</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ci/"><span class="tag">ci</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cloud/"><span class="tag">cloud</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cocoapods/"><span class="tag">cocoapods</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/combine/"><span class="tag">combine</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/core-data/"><span class="tag">core data</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/csharp/"><span class="tag">csharp</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/css/"><span class="tag">css</span><span class="tag is-grey-lightest">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/dart/"><span class="tag">dart</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/database/"><span class="tag">database</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/design/"><span class="tag">design</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/electron/"><span class="tag">electron</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/featured/"><span class="tag">featured</span><span class="tag is-grey-lightest">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/firebase/"><span class="tag">firebase</span><span class="tag is-grey-lightest">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/flutter/"><span class="tag">flutter</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/git/"><span class="tag">git</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/github/"><span class="tag">github</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/go/"><span class="tag">go</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/google/"><span class="tag">google</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/iOS/"><span class="tag">iOS</span><span class="tag is-grey-lightest">168</span></a></div><div class="control"><a class="tags has-addons" href="/tags/javascript/"><span class="tag">javascript</span><span class="tag is-grey-lightest">50</span></a></div><div class="control"><a class="tags has-addons" href="/tags/kotlin/"><span class="tag">kotlin</span><span class="tag is-grey-lightest">27</span></a></div><div class="control"><a class="tags has-addons" href="/tags/layout/"><span class="tag">layout</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/life/"><span class="tag">life</span><span class="tag is-grey-lightest">14</span></a></div><div class="control"><a class="tags has-addons" href="/tags/links/"><span class="tag">links</span><span class="tag is-grey-lightest">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/macOS/"><span class="tag">macOS</span><span class="tag is-grey-lightest">119</span></a></div><div class="control"><a class="tags has-addons" href="/tags/machine-learning/"><span class="tag">machine learning</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/maps/"><span class="tag">maps</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/networking/"><span class="tag">networking</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/node/"><span class="tag">node</span><span class="tag is-grey-lightest">11</span></a></div><div class="control"><a class="tags has-addons" href="/tags/objc/"><span class="tag">objc</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/react/"><span class="tag">react</span><span class="tag is-grey-lightest">23</span></a></div><div class="control"><a class="tags has-addons" href="/tags/react-native/"><span class="tag">react native</span><span class="tag is-grey-lightest">14</span></a></div><div class="control"><a class="tags has-addons" href="/tags/realm/"><span class="tag">realm</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/rx/"><span class="tag">rx</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/script/"><span class="tag">script</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/spm/"><span class="tag">spm</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/swift/"><span class="tag">swift</span><span class="tag is-grey-lightest">329</span></a></div><div class="control"><a class="tags has-addons" href="/tags/swiftUI/"><span class="tag">swiftUI</span><span class="tag is-grey-lightest">82</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tech/"><span class="tag">tech</span><span class="tag is-grey-lightest">14</span></a></div><div class="control"><a class="tags has-addons" href="/tags/terminal/"><span class="tag">terminal</span><span class="tag is-grey-lightest">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/testing/"><span class="tag">testing</span><span class="tag is-grey-lightest">17</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tool/"><span class="tag">tool</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tweet/"><span class="tag">tweet</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/unity/"><span class="tag">unity</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/voip/"><span class="tag">voip</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/watchOS/"><span class="tag">watchOS</span><span class="tag is-grey-lightest">11</span></a></div><div class="control"><a class="tags has-addons" href="/tags/web/"><span class="tag">web</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/work/"><span class="tag">work</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/wwdc/"><span class="tag">wwdc</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/xcode/"><span class="tag">xcode</span><span class="tag is-grey-lightest">24</span></a></div></div></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Subscribe to Updates</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=c2r59mmt2n5k0o5dt5vv3nq4u4&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="c2r59mmt2n5k0o5dt5vv3nq4u4" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button is-primary" type="submit" value="Subscribe"></div></div></form></div></div></div><div class="card widget"><div class="card-content"><div class="notification is-danger">You need to set <code>client_id</code> and <code>slot_id</code> to show this AD unit. Please set it in <code>_config.yml</code>.</div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/z.png" alt="onmyway133" height="28"></a><p class="size-small"><span>&copy; 2021 Khoa Pham</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/onmyway133"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            site: {
                url: 'https://onmyway133.github.io',
                external_link: {"enable":true,"exclude":[]}
            },
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to Top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>