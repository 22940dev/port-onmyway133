<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="generator" content="Hexo 4.2.0"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Tag: iOS - onmyway133</title><meta description="What you don&amp;#39;t know is what you haven&amp;#39;t learned"><meta property="og:type" content="blog"><meta property="og:title" content="onmyway133"><meta property="og:url" content="https://onmyway133.github.io/"><meta property="og:site_name" content="onmyway133"><meta property="og:description" content="What you don&amp;#39;t know is what you haven&amp;#39;t learned"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://onmyway133.github.io/img/og_image.png"><meta property="article:author" content="Khoa Pham"><meta property="article:tag" content="ios"><meta property="article:tag" content=" android"><meta property="article:tag" content="javascript"><meta property="article:tag" content=" react"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><meta property="twitter:creator" content="@onmyway133"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://onmyway133.github.io"},"headline":"onmyway133","image":["https://onmyway133.github.io/img/og_image.png"],"author":{"@type":"Person","name":"Khoa Pham"},"description":"What you don&#39;t know is what you haven&#39;t learned"}</script><link rel="alternative" href="/atom.xml" title="onmyway133" type="application/atom+xml"><link rel="icon" href="/img/favicon.ico"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=UA-40119591-5" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'UA-40119591-5');</script><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><script data-ad-client="ca-pub-3656459401405265" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" async></script></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/z.png" alt="onmyway133" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/apps">Apps</a><a class="navbar-item" href="/gumroad">Gumroad</a><a class="navbar-item" href="/about">About</a><a class="navbar-item" href="/opensource">Open Source</a><a class="navbar-item" href="/writing">Writing</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/speaking">Speaking</a><a class="navbar-item" href="/news">News</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/onmyway133"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/tags">Tags</a></li><li class="is-active"><a href="#" aria-current="page">iOS</a></li></ul></nav></div></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-06-29T17:19:34.000Z" title="2019-06-29T17:19:34.000Z">2019-06-29</time><span class="level-item">2 minutes read (About 334 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-use-NSSecureCoding-in-Swift/">How to use NSSecureCoding in Swift</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/334">#334</a></strong></p>
<p><a href="https://developer.apple.com/documentation/foundation/nssecurecoding">NSSecureCoding</a> has been around since iOS 6 and has had some API changes in iOS 12</p>
<blockquote>
<p>A protocol that enables encoding and decoding in a manner that is robust against object substitution attacks.</p>
</blockquote>
<p><a href="https://developer.apple.com/documentation/foundation/nscoder/2292924-decodeobject">https://developer.apple.com/documentation/foundation/nscoder/2292924-decodeobject</a></p>
<blockquote>
<p>If the coder responds true to requiresSecureCoding, then the coder calls failWithError(_:) in either of the following cases:<br>The class indicated by cls doesn’t implement NSSecureCoding.<br>The unarchived class doesn’t match cls, nor do any of its superclasses.</p>
</blockquote>
<blockquote>
<p>If the coder doesn’t require secure coding, it ignores the cls parameter and does not check the decoded object.</p>
</blockquote>
<p>The class must subclass from <code>NSObject</code> and conform to <code>NSSecureCoding</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Note</span>: <span class="title">NSObject</span>, <span class="title">NSSecureCoding</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> supportsSecureCoding: <span class="type">Bool</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">encode</span><span class="params">(with aCoder: NSCoder)</span></span> &#123;</span><br><span class="line">        aCoder.encode(id, forKey: <span class="string">"id"</span>)</span><br><span class="line">        aCoder.encode(text, forKey: <span class="string">"text"</span>)</span><br><span class="line">        aCoder.encode(date, forKey: <span class="string">"date"</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">init</span>?(coder aDecoder: <span class="type">NSCoder</span>) &#123;</span><br><span class="line">        <span class="keyword">guard</span></span><br><span class="line">            <span class="keyword">let</span> id = aDecoder.decodeObject(of: [<span class="type">NSString</span>.<span class="keyword">self</span>], forKey: <span class="string">"id"</span>) <span class="keyword">as</span>? <span class="type">String</span>,</span><br><span class="line">            <span class="keyword">let</span> text = aDecoder.decodeObject(of: [<span class="type">NSString</span>.<span class="keyword">self</span>], forKey: <span class="string">"text"</span>) <span class="keyword">as</span>? <span class="type">String</span>,</span><br><span class="line">            <span class="keyword">let</span> date = aDecoder.decodeObject(of: [<span class="type">NSDate</span>.<span class="keyword">self</span>], forKey: <span class="string">"date"</span>) <span class="keyword">as</span>? <span class="type">Date</span></span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">self</span>.id = id</span><br><span class="line">        <span class="keyword">self</span>.text = text</span><br><span class="line">        <span class="keyword">self</span>.date = date</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> id: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> text = <span class="string">"untitled"</span></span><br><span class="line">    <span class="keyword">var</span> date: <span class="type">Date</span> = <span class="type">Date</span>()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">init</span>() &#123;</span><br><span class="line">        id = <span class="type">UUID</span>().uuidString</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>First, we need to serialize to Data, then use <a href="https://github.com/onmyway133/EasyStash">EasyStash</a> for easy persistency</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> securedItems = items.<span class="built_in">map</span>(&#123; <span class="type">SecuredClientLoggerItem</span>(item: $<span class="number">0</span>) &#125;)</span><br><span class="line">    <span class="keyword">if</span> #available(iOS <span class="number">11.0</span>, *) &#123;</span><br><span class="line">        <span class="keyword">let</span> data = <span class="keyword">try</span> <span class="type">NSKeyedArchiver</span>.archivedData(</span><br><span class="line">            withRootObject: securedItems,</span><br><span class="line">            requiringSecureCoding: <span class="literal">true</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> data.write(to: fileUrl)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="number">_</span> = <span class="type">NSKeyedArchiver</span>.archiveRootObject(</span><br><span class="line">            securedItems,</span><br><span class="line">            toFile: fileUrl.path</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(error)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Then we can use <code>unarchiveTopLevelObjectWithData</code> to unarchive array</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> data = <span class="keyword">try</span> <span class="type">Data</span>(contentsOf: fileUrl)</span><br><span class="line">    <span class="keyword">let</span> notes = <span class="keyword">try</span> <span class="type">NSKeyedUnarchiver</span>.unarchiveTopLevelObjectWithData(data) <span class="keyword">as</span>? [<span class="type">Note</span>]</span><br><span class="line">    <span class="comment">// notes is of type [Note]?</span></span><br><span class="line">&#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(error)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Note that for UUID, NSCoding seems to convert to UUID instead of String</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> id = aDecoder.decodeObject(</span><br><span class="line">    of: [<span class="type">NSUUID</span>.<span class="keyword">self</span>],</span><br><span class="line">    forKey: <span class="string">"id"</span></span><br><span class="line">) <span class="keyword">as</span>? <span class="type">UUID</span>,</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-06-27T11:30:34.000Z" title="2019-06-27T11:30:34.000Z">2019-06-27</time><span class="level-item">2 minutes read (About 231 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-simplify-pager-interaction-with-Rx/">How to simplify pager interaction with Rx</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/333">#333</a></strong></p>
<p>In a traditional pager with many pages of content, and a bottom navigation with previous and next button. Each page may have different content, and depending on each state, may block the next button.</p>
<p>The state of next button should state in real time depending on state in each page content, and when user moves back and forth between pages, the state of next button should be reflected as well.</p>
<p>We might have</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">ViewController</span>: <span class="title">BottomNavigationDelegate</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">bottomNavigationCanGoNext</span><span class="params">(currentIndex: Int)</span></span> -&gt; <span class="type">Bool</span> &#123;&#125;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">bottomNavigationDidMoveTo</span><span class="params">(index: Int)</span></span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">ViewController</span>: <span class="title">PreferencePageDelegate</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">preferencePageDidSelect</span><span class="params">(itemCount: Int)</span></span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">ViewController</span>: <span class="title">FormPageDelegate</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">formPageDidCheck</span><span class="params">(valid: Bool)</span></span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">ViewController</span>: <span class="title">ConsentPageDelegate</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">consentPageDidAccept</span><span class="params">(agree: Bool)</span></span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The indirect communications between each page, bottom navigation and ViewController get complicated and out of hands very quickly.</p>
<p>This is a perfect problem for Rx to solve. If we look closely, the state of next button is a derivative of current index, how many items selected in preferences, valid form and agreement status.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BottomNavigation</span> </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> index = <span class="type">PublishSubject</span>&lt;<span class="type">Int</span>&gt;()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PreferencePage</span> </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> itemCount = <span class="type">PublishSubject</span>&lt;<span class="type">Int</span>&gt;()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FormPage</span> </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> valid = <span class="type">PublishSubject</span>&lt;<span class="type">Bool</span>&gt;()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConsentPage</span> </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> agree = <span class="type">PublishSubject</span>&lt;<span class="type">Bool</span>&gt;()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> canNext = <span class="type">Observable</span></span><br><span class="line">  .combineLatest(bottomNavigation.index, preferencePage.itemCount, formPage.valid, consentPage.agree)</span><br><span class="line">  .<span class="built_in">map</span>(&#123; (index, itemCount, valid, agree) -&gt; <span class="type">Bool</span> <span class="keyword">in</span></span><br><span class="line">    <span class="comment">// Logic goes here to reduce, for example</span></span><br><span class="line">    <span class="keyword">switch</span> index &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0</span>: <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">      <span class="keyword">case</span> <span class="number">1</span>: <span class="keyword">return</span> itemCount &gt; <span class="number">2</span></span><br><span class="line">      <span class="keyword">case</span> <span class="number">2</span>: <span class="keyword">return</span> valid</span><br><span class="line">      <span class="keyword">case</span> <span class="number">3</span>: <span class="type">Return</span> agree</span><br><span class="line">      <span class="keyword">default</span>: <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-06-26T08:36:04.000Z" title="2019-06-26T08:36:04.000Z">2019-06-26</time><span class="level-item">5 minutes read (About 823 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-handle-keyboard-for-UITextField-in-scrolling-UIStackView-in-iOS/">How to handle keyboard for UITextField in scrolling UIStackView in iOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/329">#329</a></strong></p>
<p>Firstly, to make UIStackView scrollable, embed it inside UIScrollView. Read <a href="https://github.com/onmyway133/blog/issues/324">How to embed UIStackView inside UIScrollView in iOS</a></p>
<p>It’s best to listen to <code>keyboardWillChangeFrameNotification</code> as it contains frame changes for Keyboard in different situation like custom keyboard, languages.</p>
<blockquote>
<p>Posted immediately prior to a change in the keyboard’s frame.</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">KeyboardHandler</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> scrollView: <span class="type">UIScrollView</span></span><br><span class="line">    <span class="keyword">let</span> stackView: <span class="type">UIStackView</span></span><br><span class="line">    <span class="keyword">var</span> observer: <span class="type">AnyObject?</span></span><br><span class="line">    <span class="keyword">var</span> keyboardHeightConstraint: <span class="type">NSLayoutConstraint!</span></span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Info</span> </span>&#123;</span><br><span class="line">        <span class="keyword">let</span> frame: <span class="type">CGRect</span></span><br><span class="line">        <span class="keyword">let</span> duration: <span class="type">Double</span></span><br><span class="line">        <span class="keyword">let</span> animationOptions: <span class="type">UIView</span>.<span class="type">AnimationOptions</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(scrollView: <span class="type">UIScrollView</span>, stackView: <span class="type">UIStackView</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.scrollView = scrollView</span><br><span class="line">        <span class="keyword">self</span>.stackView = stackView</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>To make scrollView scroll beyond its <code>contentSize</code>, we can change its <code>contentInset.bottom</code>. Another way is to add a dummy view with certain height to <code>UIStackView</code> and alter its <code>NSLayoutConstraint</code> <code>constant</code></p>
<p>We can’t access <code>self</code> inside init, so it’s best to have setup function</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">setup</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> space = <span class="type">UIView</span>()</span><br><span class="line">    keyboardHeightConstraint = space.heightAnchor.constraint(equalToConstant: <span class="number">0</span>)</span><br><span class="line">    <span class="type">NSLayoutConstraint</span>.on([keyboardHeightConstraint])</span><br><span class="line">    stackView.addArrangedSubview(spa</span><br><span class="line">    observer = <span class="type">NotificationCenter</span>.<span class="keyword">default</span>.addObserver(</span><br><span class="line">        forName: <span class="type">UIResponder</span>.keyboardWillChangeFrameNotification,</span><br><span class="line">        object: <span class="literal">nil</span>,</span><br><span class="line">        queue: .main,</span><br><span class="line">        using: &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] notification <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">self</span>?.handle(notification)</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Convert <code>Notification</code> to a convenient <code>Info</code> struct</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">convert</span><span class="params">(notification: Notification)</span></span> -&gt; <span class="type">Info?</span> &#123;</span><br><span class="line">    <span class="keyword">guard</span></span><br><span class="line">        <span class="keyword">let</span> frameValue = notification.userInfo?[<span class="type">UIResponder</span>.keyboardFrameEndUserInfoKey] <span class="type">NSValue</span>,</span><br><span class="line">        <span class="keyword">let</span> durationotification.userInfo?[<span class="type">UIResponder</span>.keyboardAnimationDurationUserInfoKey] <span class="keyword">as</span>? <span class="type">NSNumber</span>,</span><br><span class="line">        <span class="keyword">let</span> raw = notification.userInfo?[<span class="type">UIResponder</span>.keyboardAnimationCurveUserInfoKey] <span class="type">NSNumber</span></span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">  </span><br><span class="line">    <span class="keyword">return</span> <span class="type">Info</span>(</span><br><span class="line">        frame: frameValue.cgRectValue,</span><br><span class="line">        duration: duration.doubleValue,</span><br><span class="line">        animationOptions: <span class="type">UIView</span>.<span class="type">AnimationOptions</span>(rawValue: raw.uintValue)</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Then we can compare with UIScreen to check if Keyboard is showing or hiding</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">handle</span><span class="params">(<span class="number">_</span> notification: Notification)</span></span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> info = convert(notification: notification) <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">  </span><br><span class="line">    <span class="keyword">let</span> isHiding = info.frame.origin.y == <span class="type">UIScreen</span>.main.bounds.height</span><br><span class="line">    keyboardHeightConstraint.constant = isHiding ? <span class="number">0</span> : info.frame.hei</span><br><span class="line">    <span class="type">UIView</span>.animate(</span><br><span class="line">        withDuration: info.duration,</span><br><span class="line">        delay: <span class="number">0</span>,</span><br><span class="line">        options: info.animationOptions,</span><br><span class="line">        animations: &#123;</span><br><span class="line">            <span class="keyword">self</span>.scrollView.layoutIfNeeded()</span><br><span class="line">            <span class="keyword">self</span>.moveTextFieldIfNeeded(info: info)</span><br><span class="line">    &#125;, completion: <span class="literal">nil</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>To move <code>UITextField</code> we can use <a href="https://developer.apple.com/documentation/uikit/uiscrollview/1619439-scrollrecttovisible"><code>scrollRectToVisible(_:animated:)</code></a> but we have little control over how much we want to scroll</p>
<blockquote>
<p>This method scrolls the content view so that the area defined by rect is just visible inside the scroll view. If the area is already visible, the method does nothing.</p>
</blockquote>
<p>Another way is to check if keyboard overlaps <code>UITextField</code>. To do that we use <a href="https://developer.apple.com/documentation/uikit/uiview/1622504-convertrect"><code>convertRect:toView:</code></a> with <code>nil</code> target so it uses window coordinates. Since keyboard frame is always relative to window, we have frames in same coordinate space.</p>
<blockquote>
<p>Converts a rectangle from the receiver’s coordinate system to that of another view.</p>
</blockquote>
<blockquote>
<p>rect: A rectangle specified in the local coordinate system (bounds) of the receiver.<br>view: The view that is the target of the conversion operation. If view is nil, this method instead converts to window base coordinates. Otherwise, both view and the receiver must belong to the same UIWindow object.</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">moveTextFieldIfNeeded</span><span class="params">(info: Info)</span></span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> input = stackView.arrangedSubviews</span><br><span class="line">        .compactMap(&#123; $<span class="number">0</span> <span class="keyword">as</span>? <span class="type">UITextField</span> &#125;)</span><br><span class="line">        .first(<span class="keyword">where</span>: &#123; $<span class="number">0</span>.isFirstResponder &#125;)</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">  </span><br><span class="line">    <span class="keyword">let</span> inputFrame = input.convert(input.bounds, to: <span class="literal">nil</span>)</span><br><span class="line">    <span class="keyword">if</span> inputFrame.intersects(info.frame) &#123;</span><br><span class="line">        scrollView.setContentOffset(<span class="type">CGPoint</span>(x: <span class="number">0</span>, y: inputFrame.height), animated: <span class="literal">true</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        scrollView.setContentOffset(.zero, animated: <span class="literal">true</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Move-up-the-entire-view"><a href="#Move-up-the-entire-view" class="headerlink" title="Move up the entire view"></a>Move up the entire view</h3><p>For simplicity, we can move up the entire view</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">move</span><span class="params">(info: Info)</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> isHiding = info.frame.origin.y == <span class="type">UIScreen</span>.main.bounds.height</span><br><span class="line">    <span class="keyword">let</span> moveUp = <span class="type">CGAffineTransform</span>(translationX: <span class="number">0</span>, y: -info.frame.height)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span> (view.transform, isHiding) &#123;</span><br><span class="line">    <span class="keyword">case</span> (.identity, <span class="literal">false</span>):</span><br><span class="line">        view.transform = moveUp</span><br><span class="line">    <span class="keyword">case</span> (moveUp, <span class="literal">true</span>):</span><br><span class="line">        view.transform = .identity</span><br><span class="line">     <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Prefer-willShow-and-willHide"><a href="#Prefer-willShow-and-willHide" class="headerlink" title="Prefer willShow and willHide"></a>Prefer willShow and willHide</h3><p>There ‘s an edge case with the above switch on <code>view.transform</code> and <code>isHiding</code> with one time verification sms code, which make it into the correct <code>case</code> handling. It’s safe to just set view.transform depending on <code>show</code> with <code>willHide</code> and <code>willShow</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">KeyboardHandler</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> view: <span class="type">UIView</span></span><br><span class="line">    <span class="keyword">var</span> observerForWillShow: <span class="type">AnyObject?</span></span><br><span class="line">    <span class="keyword">var</span> observerForWillHide: <span class="type">AnyObject?</span></span><br><span class="line">    <span class="keyword">var</span> keyboardHeightConstraint: <span class="type">NSLayoutConstraint!</span></span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Info</span> </span>&#123;</span><br><span class="line">        <span class="keyword">let</span> frame: <span class="type">CGRect</span></span><br><span class="line">        <span class="keyword">let</span> duration: <span class="type">Double</span></span><br><span class="line">        <span class="keyword">let</span> animationOptions: <span class="type">UIView</span>.<span class="type">AnimationOptions</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">init</span>(view: <span class="type">UIView</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.view = view</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">setup</span><span class="params">()</span></span> &#123;</span><br><span class="line">        observerForWillShow = <span class="type">NotificationCenter</span>.<span class="keyword">default</span>.addObserver(</span><br><span class="line">            forName: <span class="type">UIResponder</span>.keyboardWillShowNotification,</span><br><span class="line">            object: <span class="literal">nil</span>,</span><br><span class="line">            queue: .main,</span><br><span class="line">            using: &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] notification <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">self</span>?.handle(notification, show: <span class="literal">true</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        observerForWillHide = <span class="type">NotificationCenter</span>.<span class="keyword">default</span>.addObserver(</span><br><span class="line">            forName: <span class="type">UIResponder</span>.keyboardWillHideNotification,</span><br><span class="line">            object: <span class="literal">nil</span>,</span><br><span class="line">            queue: .main,</span><br><span class="line">            using: &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] notification <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">self</span>?.handle(notification, show: <span class="literal">false</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">handle</span><span class="params">(<span class="number">_</span> notification: Notification, show: Bool)</span></span> &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> info = convert(notification: notification) <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">UIView</span>.animate(</span><br><span class="line">            withDuration: info.duration,</span><br><span class="line">            delay: <span class="number">0</span>,</span><br><span class="line">            options: info.animationOptions,</span><br><span class="line">            animations: &#123;</span><br><span class="line">				<span class="keyword">self</span>.move(info: info, show: show)</span><br><span class="line">        &#125;, completion: <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">move</span><span class="params">(info: Info, show: Bool)</span></span> &#123;</span><br><span class="line">        <span class="keyword">let</span> moveUp = <span class="type">CGAffineTransform</span>(translationX: <span class="number">0</span>, y: -info.frame.height)</span><br><span class="line">        <span class="keyword">if</span> show &#123;</span><br><span class="line">            view.transform = moveUp</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            view.transform = .identity</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">convert</span><span class="params">(notification: Notification)</span></span> -&gt; <span class="type">Info?</span> &#123;</span><br><span class="line">        <span class="keyword">guard</span></span><br><span class="line">            <span class="keyword">let</span> frameValue = notification.userInfo?[<span class="type">UIResponder</span>.keyboardFrameEndUserInfoKey] <span class="keyword">as</span>? <span class="type">NSValue</span>,</span><br><span class="line">            <span class="keyword">let</span> duration = notification.userInfo?[<span class="type">UIResponder</span>.keyboardAnimationDurationUserInfoKey] <span class="keyword">as</span>? <span class="type">NSNumber</span>,</span><br><span class="line">            <span class="keyword">let</span> raw = notification.userInfo?[<span class="type">UIResponder</span>.keyboardAnimationCurveUserInfoKey] <span class="keyword">as</span>? <span class="type">NSNumber</span></span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="type">Info</span>(</span><br><span class="line">            frame: frameValue.cgRectValue,</span><br><span class="line">            duration: duration.doubleValue,</span><br><span class="line">            animationOptions: <span class="type">UIView</span>.<span class="type">AnimationOptions</span>(rawValue: raw.uintValue)</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Read-more"><a href="#Read-more" class="headerlink" title="Read more"></a>Read more</h2><ul>
<li><a href="https://developer.apple.com/library/archive/documentation/StringsTextFonts/Conceptual/TextAndWebiPhoneOS/KeyboardManagement/KeyboardManagement.html#//apple_ref/doc/uid/TP40009542-CH5-SW16">Managing the Keyboard</a></li>
</ul>
<hr>
<p><strong>Updated at</strong> 2020-07-06 07:09:07</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-06-25T12:05:08.000Z" title="2019-06-25T12:05:08.000Z">2019-06-25</time><span class="level-item">2 minutes read (About 311 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-make-simple-form-validator-in-Swift/">How to make simple form validator in Swift</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/328">#328</a></strong></p>
<p>Sometimes we want to validate forms with many fields, for example name, phone, email, and with different rules. If validation fails, we show error message.</p>
<p>We can make simple <code>Validator</code> and <code>Rule</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Validator</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">validate</span><span class="params">(text: String, with rules: [Rule])</span></span> -&gt; <span class="type">String?</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> rules.compactMap(&#123; $<span class="number">0</span>.check(text) &#125;).first</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">validate</span><span class="params">(input: InputView, with rules: [Rule])</span></span> &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> message = validate(text: input.textField.text ?? <span class="string">""</span>, with: rules) <span class="keyword">else</span> &#123;</span><br><span class="line">            input.messageLabel.isHidden = <span class="literal">true</span></span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        input.messageLabel.isHidden = <span class="literal">false</span></span><br><span class="line">        input.messageLabel.text = message</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Rule</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Return nil if matches, error message otherwise</span></span><br><span class="line">    <span class="keyword">let</span> check: (<span class="type">String</span>) -&gt; <span class="type">String?</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> notEmpty = <span class="type">Rule</span>(check: &#123;</span><br><span class="line">        <span class="keyword">return</span> $<span class="number">0</span>.isEmpty ? <span class="string">"Must not be empty"</span> : <span class="literal">nil</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> validEmail = <span class="type">Rule</span>(check: &#123;</span><br><span class="line">        <span class="keyword">let</span> regex = #<span class="string">"[A-Z0-9a-z._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]&#123;2,64&#125;"</span>#</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> predicate = <span class="type">NSPredicate</span>(format: <span class="string">"SELF MATCHES %@"</span>, regex)</span><br><span class="line">        <span class="keyword">return</span> predicate.evaluate(with: $<span class="number">0</span>) ? <span class="literal">nil</span> : <span class="string">"Must have valid email"</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> countryCode = <span class="type">Rule</span>(check: &#123;</span><br><span class="line">        <span class="keyword">let</span> regex = #<span class="string">"^\+\d+.*"</span>#</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> predicate = <span class="type">NSPredicate</span>(format: <span class="string">"SELF MATCHES %@"</span>, regex)</span><br><span class="line">        <span class="keyword">return</span> predicate.evaluate(with: $<span class="number">0</span>) ? <span class="literal">nil</span> : <span class="string">"Must have prefix country code"</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Then we can use very expressively</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> validator = <span class="type">Validator</span>()</span><br><span class="line">validator.validate(input: inputView, with: [.notEmpty, .validEmail])</span><br></pre></td></tr></table></figure>

<p>Then a few tests to make sure it works</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ValidatorTests</span>: <span class="title">XCTestCase</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> validator = <span class="type">Validator</span>()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">testEmpty</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="type">XCTAssertNil</span>(validator.validate(text: <span class="string">"a"</span>, with: [.notEmpty]))</span><br><span class="line">        <span class="type">XCTAssertNotNil</span>(validator.validate(text: <span class="string">""</span>, with: [.notEmpty]))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">testEmail</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="type">XCTAssertNil</span>(validator.validate(text: <span class="string">"onmyway133@gmail.com"</span>, with: [.validEmail]))</span><br><span class="line">        <span class="type">XCTAssertNotNil</span>(validator.validate(text: <span class="string">"onmyway133"</span>, with: [.validEmail]))</span><br><span class="line">        <span class="type">XCTAssertNotNil</span>(validator.validate(text: <span class="string">"onmyway133.com"</span>, with: [.validEmail]))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">testCountryCode</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="type">XCTAssertNil</span>(validator.validate(text: <span class="string">"+47 11 222 333"</span>, with: [.countryCode]))</span><br><span class="line">        <span class="type">XCTAssertNotNil</span>(validator.validate(text: <span class="string">"11 222 333"</span>, with: [.countryCode]))</span><br><span class="line">        <span class="type">XCTAssertNotNil</span>(validator.validate(text: <span class="string">"47 11 222 333"</span>, with: [.countryCode]))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="allSatisfy"><a href="#allSatisfy" class="headerlink" title="allSatisfy"></a>allSatisfy</h2><p>To check if all rules are ok, we can use reduce</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">check</span><span class="params">(text: String, with rules: [Rule])</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> rules.allSatisfy(&#123; $<span class="number">0</span>.check(text).isOk &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Or more concisely, use <code>allSatisfy</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">check</span><span class="params">(text: String, with rules: [Rule])</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> rules.allSatisfy(&#123; $<span class="number">0</span>.check(text).isOk &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-06-25T08:18:40.000Z" title="2019-06-25T08:18:40.000Z">2019-06-25</time><span class="level-item">a few seconds read (About 86 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-deal-with-weak-in-closure-in-Swift/">How to deal with weak in closure in Swift</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/326">#326</a></strong></p>
<p>Traditionally, from Swift 4.2 we need <code>guard let self</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">addButton.didTouch = &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">guard</span></span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">self</span> = <span class="keyword">self</span>,</span><br><span class="line">        <span class="keyword">let</span> product = <span class="keyword">self</span>.purchasedProduct()</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">self</span>.delegate?.productViewController(<span class="keyword">self</span>, didAdd: product)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This is cumbersome, we can invent a higher order function to zip and unwrap the optionals</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">with</span>&lt;A, B&gt;<span class="params">(<span class="number">_</span> op1: A?, <span class="number">_</span> op2: B?, <span class="number">_</span> closure: <span class="params">(A, B)</span></span></span> -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> value1 = op1, <span class="keyword">let</span> value2 = op2 &#123;</span><br><span class="line">        closure(value1, value2)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">addButton.didTouch = &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] <span class="keyword">in</span></span><br><span class="line">    with(<span class="keyword">self</span>, <span class="keyword">self</span>?.purchasedProduct()) &#123;</span><br><span class="line">        $<span class="number">0</span>.delegate?.productViewController($<span class="number">0</span>, didAdd: $<span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-06-24T06:34:53.000Z" title="2019-06-24T06:34:53.000Z">2019-06-24</time><span class="level-item">2 minutes read (About 338 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-make-material-UITextField-with-floating-label-in-iOS/">How to make material UITextField with floating label in iOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/325">#325</a></strong></p>
<ul>
<li>Use <code>UILabel</code> as placeholder and move it</li>
<li>When label is moved up, scale it down 80%. It means it has 10% padding on the left and right when shrinked, so <code>offsetX</code> for translation is 10%</li>
<li>Translation transform should happen before scale</li>
<li>Ideally we can animate font and color change using <code>CATextLayer</code>, but with <code>UILabel</code> we can use <code>UIView.transition</code></li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">MaterialInputView</span>: <span class="title">UIView</span> </span>&#123;</span><br><span class="line">    <span class="built_in">lazy</span> <span class="keyword">var</span> label: <span class="type">UILabel</span> = &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">UILabel</span>()</span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">lazy</span> <span class="keyword">var</span> textField: <span class="type">UITextField</span> = &#123;</span><br><span class="line">        <span class="keyword">let</span> textField = <span class="type">UITextField</span>()</span><br><span class="line">        textField.tintColor = <span class="type">R</span>.color.primary</span><br><span class="line">        textField.textColor = <span class="type">R</span>.color.lightText</span><br><span class="line">        textField.font = <span class="type">R</span>.customFont.medium(<span class="number">16</span>)</span><br><span class="line">        textField.autocapitalizationType = .<span class="keyword">none</span></span><br><span class="line">        textField.autocorrectionType = .no</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> textField</span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">lazy</span> <span class="keyword">var</span> line: <span class="type">UIView</span> = &#123;</span><br><span class="line">        <span class="keyword">let</span> line = <span class="type">UIView</span>()</span><br><span class="line">        line.backgroundColor = <span class="type">R</span>.color.primary</span><br><span class="line">        <span class="keyword">return</span> line</span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Whether label should be moved to top</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> isUp: <span class="type">Bool</span> = <span class="literal">false</span> &#123;</span><br><span class="line">        <span class="keyword">didSet</span> &#123;</span><br><span class="line">            styleLabel(isUp: isUp)</span><br><span class="line">            moveLabel(isUp: isUp)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">init</span>(frame: <span class="type">CGRect</span>) &#123;</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(frame: frame)</span><br><span class="line"></span><br><span class="line">        setup()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">init</span>?(coder aDecoder: <span class="type">NSCoder</span>) &#123;</span><br><span class="line">        <span class="built_in">fatalError</span>()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">setup</span><span class="params">()</span></span> &#123;</span><br><span class="line">        addSubviews([textField, label, line])</span><br><span class="line">        textField.delegate = <span class="keyword">self</span></span><br><span class="line"></span><br><span class="line">        <span class="type">NSLayoutConstraint</span>.on([</span><br><span class="line">            textField.leftAnchor.constraint(equalTo: leftAnchor, constant: <span class="number">16</span>),</span><br><span class="line">            textField.rightAnchor.constraint(equalTo: rightAnchor, constant: -<span class="number">16</span>),</span><br><span class="line">            textField.topAnchor.constraint(equalTo: topAnchor, constant: <span class="number">16</span>),</span><br><span class="line"></span><br><span class="line">            label.leftAnchor.constraint(equalTo: textField.leftAnchor),</span><br><span class="line">            label.centerYAnchor.constraint(equalTo: textField.centerYAnchor),</span><br><span class="line"></span><br><span class="line">            line.leftAnchor.constraint(equalTo: textField.leftAnchor),</span><br><span class="line">            line.rightAnchor.constraint(equalTo: textField.rightAnchor),</span><br><span class="line">            line.topAnchor.constraint(equalTo: textField.bottomAnchor, constant: <span class="number">8</span>),</span><br><span class="line">            line.heightAnchor.constraint(equalToConstant: <span class="number">2</span>)</span><br><span class="line">        ])</span><br><span class="line"></span><br><span class="line">        styleLabel(isUp: <span class="literal">false</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">styleLabel</span><span class="params">(isUp: Bool)</span></span> &#123;</span><br><span class="line">        <span class="type">UIView</span>.transition(</span><br><span class="line">            with: label,</span><br><span class="line">            duration: <span class="number">0.15</span>,</span><br><span class="line">            options: .curveEaseInOut,</span><br><span class="line">            animations: &#123;</span><br><span class="line">                <span class="keyword">if</span> isUp &#123;</span><br><span class="line">                    <span class="keyword">self</span>.label.font = <span class="type">R</span>.customFont.regular(<span class="number">12</span>)</span><br><span class="line">                    <span class="keyword">self</span>.label.textColor = <span class="type">R</span>.color.primary</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">self</span>.label.font = <span class="type">R</span>.customFont.medium(<span class="number">16</span>)</span><br><span class="line">                    <span class="keyword">self</span>.label.textColor = <span class="type">R</span>.color.grayText</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            completion: <span class="literal">nil</span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">moveLabel</span><span class="params">(isUp: Bool)</span></span> &#123;</span><br><span class="line">        <span class="type">UIView</span>.animate(</span><br><span class="line">            withDuration: <span class="number">0.15</span>,</span><br><span class="line">            delay: <span class="number">0</span>,</span><br><span class="line">            options: .curveEaseInOut,</span><br><span class="line">            animations: &#123;</span><br><span class="line">                <span class="keyword">if</span> isUp &#123;</span><br><span class="line">                    <span class="keyword">let</span> offsetX = <span class="keyword">self</span>.label.frame.width * <span class="number">0.1</span></span><br><span class="line">                    <span class="keyword">let</span> translation = <span class="type">CGAffineTransform</span>(translationX: -offsetX, y: -<span class="number">24</span>)</span><br><span class="line">                    <span class="keyword">let</span> scale = <span class="type">CGAffineTransform</span>(scaleX: <span class="number">0.8</span>, y: <span class="number">0.8</span>)</span><br><span class="line">                    <span class="keyword">self</span>.label.transform = translation.concatenating(scale)</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">self</span>.label.transform = .identity</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            completion: <span class="literal">nil</span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">MaterialInputView</span>: <span class="title">UITextFieldDelegate</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">textFieldDidBeginEditing</span><span class="params">(<span class="number">_</span> textField: UITextField)</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> !isUp &#123;</span><br><span class="line">            isUp = <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">textFieldShouldEndEditing</span><span class="params">(<span class="number">_</span> textField: UITextField)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> text = textField.text <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> isUp &amp;&amp; text.isEmpty &#123;</span><br><span class="line">            isUp = <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-06-24T05:56:22.000Z" title="2019-06-24T05:56:22.000Z">2019-06-24</time><span class="level-item">a few seconds read (About 35 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-embed-UIStackView-inside-UIScrollView-in-iOS/">How to embed UIStackView inside UIScrollView in iOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/324">#324</a></strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">view.addSubview(scrollView)</span><br><span class="line">scrollView.addSubview(stackView)</span><br><span class="line"></span><br><span class="line"><span class="type">NSLayoutConstraint</span>.on([</span><br><span class="line">    scrollView.pinEdges(view: view),</span><br><span class="line">    stackView.pinEdges(view: scrollView)</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"><span class="type">NSLayoutConstraint</span>.on([</span><br><span class="line">    stackView.widthAnchor.constraint(equalTo: scrollView.widthAnchor, multiplier: <span class="number">1.0</span>)</span><br><span class="line">])</span><br></pre></td></tr></table></figure>
<hr>
<p><strong>Updated at</strong> 2020-09-07 14:28:15</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-06-19T08:11:34.000Z" title="2019-06-19T08:11:34.000Z">2019-06-19</time><span class="level-item">a few seconds read (About 103 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-make-custom-controller-for-View-in-iOS/">How to make custom controller for View in iOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/318">#318</a></strong></p>
<p>I do UI in code, and usually separate between View and ViewController.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProfileView</span>: <span class="title">UIView</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProfileViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">	<span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">loadView</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.view = <span class="type">ProfileView</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>But in places where using UIViewController and manage their view controller containment hierarchy is not desired, then we can roll out a normal object to act as the controller.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProfileController</span> </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> profileView: <span class="type">ProfileView</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">init</span>(profileView: <span class="type">ProfileView</span>) &#123;</span><br><span class="line">    <span class="keyword">self</span>.profileView = profileView</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">update</span><span class="params">(profile: Profile)</span></span> &#123;</span><br><span class="line">    profileView.nameLabel.text = profile.name</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>If the name Controller sounds confusing with <code>UIViewController</code>, I usually use <code>Handler</code>, which contains other <code>Handler</code> to handle logic for view</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-06-18T07:32:14.000Z" title="2019-06-18T07:32:14.000Z">2019-06-18</time><span class="level-item">a few seconds read (About 36 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/Understanding-device-and-OS-share-for-iOS-and-Android/">Understanding device and OS share for iOS and Android</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/316">#316</a></strong></p>
<ul>
<li><a href="https://medium.com/finn-no/browsers-and-devices-used-in-2018-b5c1a76f819a">Browsers and devices used in 2018</a></li>
<li><a href="https://developer.apple.com/support/app-store/">AppStore measurement</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-06-18T07:12:52.000Z" title="2019-06-18T07:12:52.000Z">2019-06-18</time><span class="level-item">a few seconds read (About 30 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-make-UIPanGestureRecognizer-work-with-horizontal-swipe-in-UICollectionView/">How to make UIPanGestureRecognizer work with horizontal swipe in UICollectionView</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/315">#315</a></strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">PanCollectionViewController</span>: <span class="title">UIGestureRecognizerDelegate</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">gestureRecognizerShouldBegin</span><span class="params">(<span class="number">_</span> gestureRecognizer: UIGestureRecognizer)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> velocity = panGR.velocity(<span class="keyword">in</span>: panGR.view)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">abs</span>(velocity.y) &gt; <span class="built_in">abs</span>(velocity.x)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-06-17T10:53:31.000Z" title="2019-06-17T10:53:31.000Z">2019-06-17</time><span class="level-item">3 minutes read (About 413 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-use-new-APIs-in-iOS/">How to use new APIs  in iOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/313">#313</a></strong></p>
<h2 id="iOS-10"><a href="#iOS-10" class="headerlink" title="iOS 10"></a>iOS 10</h2><p>➕<a href="https://developer.apple.com/documentation/usernotifications">UserNotifications</a></p>
<blockquote>
<p>Push user-facing notifications to the user’s device from a server, or generate them locally from your app.</p>
</blockquote>
<p>➕<a href="https://developer.apple.com/documentation/uikit/uiviewpropertyanimator">UIViewPropertyAnimator</a></p>
<blockquote>
<p>A class that animates changes to views and allows the dynamic modification of those animations.</p>
</blockquote>
<p>➕<a href="https://developer.apple.com/documentation/coredata/nspersistentcontainer">NSPersistentContainer</a></p>
<blockquote>
<p>A container that encapsulates the Core Data stack in your app.</p>
</blockquote>
<p>➕<a href="https://developer.apple.com/documentation/uikit/uifeedbackgenerator">UIFeedbackGenerator</a></p>
<blockquote>
<p>The abstract superclass for all feedback generators.</p>
</blockquote>
<h2 id="iOS-10-3"><a href="#iOS-10-3" class="headerlink" title="iOS 10.3"></a>iOS 10.3</h2><p>➕<a href="https://developer.apple.com/documentation/storekit/skstorereviewcontroller">SKStoreReviewController</a></p>
<blockquote>
<p>An object that controls the process of requesting App Store ratings and reviews from users.</p>
</blockquote>
<h2 id="iOS-11"><a href="#iOS-11" class="headerlink" title="iOS 11"></a>iOS 11</h2><p>➕<a href="https://developer.apple.com/documentation/uikit/uiview/2891102-safearealayoutguide">safeAreaLayoutGuide</a></p>
<blockquote>
<p>The layout guide representing the portion of your view that is unobscured by bars and other content.</p>
</blockquote>
<p>➕<a href="https://developer.apple.com/documentation/coreml">CoreML</a></p>
<blockquote>
<p>Integrate machine learning models into your app.</p>
</blockquote>
<p>➕<a href="https://developer.apple.com/documentation/vision">Vision</a></p>
<blockquote>
<p>Apply computer vision algorithms to perform a variety of tasks on input images and video.</p>
</blockquote>
<p>➕<a href="https://developer.apple.com/documentation/arkit">ARKit</a></p>
<blockquote>
<p>Integrate iOS device camera and motion features to produce augmented reality experiences in your app or game.</p>
</blockquote>
<p>➕<a href="https://developer.apple.com/documentation/devicecheck">DeviceCheck</a></p>
<blockquote>
<p>Access per-device, per-developer data that your associated server can use in its business logic.</p>
</blockquote>
<p>➕<a href="https://developer.apple.com/documentation/uikit/drag_and_drop">Drag and Drop</a></p>
<blockquote>
<p>Bring drag and drop to your app by using interaction APIs with your views.</p>
</blockquote>
<p>➕<a href="https://developer.apple.com/documentation/corenfc">CoreNFC</a></p>
<blockquote>
<p>Detect NFC tags and read messages that contain NDEF data.</p>
</blockquote>
<p>➕<a href="https://developer.apple.com/documentation/quartzcore/calayer/2877488-maskedcorners">maskedCorners</a></p>
<blockquote>
<p>Animatable corner radius</p>
</blockquote>
<h2 id="iOS-12"><a href="#iOS-12" class="headerlink" title="iOS 12"></a>iOS 12</h2><p>➕<a href="https://developer.apple.com/documentation/authenticationservices">AuthenticationServices</a></p>
<blockquote>
<p>Make it easy for users to log into apps and services.</p>
</blockquote>
<h2 id="iOS-13"><a href="#iOS-13" class="headerlink" title="iOS 13"></a>iOS 13</h2><ul>
<li><a href="https://www.hackingwithswift.com/articles/193/whats-new-in-ios-13">https://www.hackingwithswift.com/articles/193/whats-new-in-ios-13</a></li>
<li><a href="https://onesignal.com/blog/ios-13-introduces-4-breaking-changes-to-notifications/">https://onesignal.com/blog/ios-13-introduces-4-breaking-changes-to-notifications/</a></li>
</ul>
<p>➕<a href="https://developer.apple.com/documentation/swiftui">SwiftUI</a></p>
<blockquote>
<p>Declare the user interface and behavior for your app on every platform.</p>
</blockquote>
<p>➕<a href="https://developer.apple.com/documentation/combine">Combine</a></p>
<blockquote>
<p>Customize handling of asynchronous events by combining event-processing operators.</p>
</blockquote>
<p>➕<a href="https://developer.apple.com/documentation/cryptokit">CryptoKit</a></p>
<blockquote>
<p>Perform cryptographic operations securely and efficiently.</p>
</blockquote>
<p>➕<a href="https://developer.apple.com/documentation/uikit/uisearchtextfield">UISearchTextField</a></p>
<blockquote>
<p>Expose UISearchTextField on UISearchBar</p>
</blockquote>
<p>➕<a href="https://developer.apple.com/documentation/metrickit">MetricKit</a></p>
<p>➕CoreSVG</p>
<ul>
<li><a href="https://github.com/SDWebImage/SDWebImageSVGCoder">https://github.com/SDWebImage/SDWebImageSVGCoder</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-06-17T10:53:31.000Z" title="2019-06-17T10:53:31.000Z">2019-06-17</time><span class="level-item">3 minutes read (About 387 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/What&#039;s-new-in-iOS/">What&#039;s new in iOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/313">#313</a></strong></p>
<h2 id="iOS-10"><a href="#iOS-10" class="headerlink" title="iOS 10"></a>iOS 10</h2><p>➕<a href="https://developer.apple.com/documentation/usernotifications">UserNotifications</a></p>
<blockquote>
<p>Push user-facing notifications to the user’s device from a server, or generate them locally from your app.</p>
</blockquote>
<p>➕<a href="https://developer.apple.com/documentation/uikit/uiviewpropertyanimator">UIViewPropertyAnimator</a></p>
<blockquote>
<p>A class that animates changes to views and allows the dynamic modification of those animations.</p>
</blockquote>
<p>➕<a href="https://developer.apple.com/documentation/coredata/nspersistentcontainer">NSPersistentContainer</a></p>
<blockquote>
<p>A container that encapsulates the Core Data stack in your app.</p>
</blockquote>
<p>➕<a href="https://developer.apple.com/documentation/uikit/uifeedbackgenerator">UIFeedbackGenerator</a></p>
<blockquote>
<p>The abstract superclass for all feedback generators.</p>
</blockquote>
<h2 id="iOS-10-3"><a href="#iOS-10-3" class="headerlink" title="iOS 10.3"></a>iOS 10.3</h2><p>➕<a href="https://developer.apple.com/documentation/storekit/skstorereviewcontroller">SKStoreReviewController</a></p>
<blockquote>
<p>An object that controls the process of requesting App Store ratings and reviews from users.</p>
</blockquote>
<h2 id="iOS-11"><a href="#iOS-11" class="headerlink" title="iOS 11"></a>iOS 11</h2><p>➕<a href="https://developer.apple.com/documentation/uikit/uiview/2891102-safearealayoutguide">safeAreaLayoutGuide</a></p>
<blockquote>
<p>The layout guide representing the portion of your view that is unobscured by bars and other content.</p>
</blockquote>
<p>➕<a href="https://developer.apple.com/documentation/coreml">CoreML</a></p>
<blockquote>
<p>Integrate machine learning models into your app.</p>
</blockquote>
<p>➕<a href="https://developer.apple.com/documentation/vision">Vision</a></p>
<blockquote>
<p>Apply computer vision algorithms to perform a variety of tasks on input images and video.</p>
</blockquote>
<p>➕<a href="https://developer.apple.com/documentation/arkit">ARKit</a></p>
<blockquote>
<p>Integrate iOS device camera and motion features to produce augmented reality experiences in your app or game.</p>
</blockquote>
<p>➕<a href="https://developer.apple.com/documentation/devicecheck">DeviceCheck</a></p>
<blockquote>
<p>Access per-device, per-developer data that your associated server can use in its business logic.</p>
</blockquote>
<p>➕<a href="https://developer.apple.com/documentation/uikit/drag_and_drop">Drag and Drop</a></p>
<blockquote>
<p>Bring drag and drop to your app by using interaction APIs with your views.</p>
</blockquote>
<p>➕<a href="https://developer.apple.com/documentation/corenfc">CoreNFC</a></p>
<blockquote>
<p>Detect NFC tags and read messages that contain NDEF data.</p>
</blockquote>
<p>➕<a href="https://developer.apple.com/documentation/quartzcore/calayer/2877488-maskedcorners">maskedCorners</a></p>
<blockquote>
<p>Animatable corner radius</p>
</blockquote>
<h2 id="iOS-12"><a href="#iOS-12" class="headerlink" title="iOS 12"></a>iOS 12</h2><p>➕<a href="https://developer.apple.com/documentation/authenticationservices">AuthenticationServices</a></p>
<blockquote>
<p>Make it easy for users to log into apps and services.</p>
</blockquote>
<h2 id="iOS-13"><a href="#iOS-13" class="headerlink" title="iOS 13"></a>iOS 13</h2><p>➕<a href="https://developer.apple.com/documentation/swiftui">SwiftUI</a></p>
<blockquote>
<p>Declare the user interface and behavior for your app on every platform.</p>
</blockquote>
<p>➕<a href="https://developer.apple.com/documentation/combine">Combine</a></p>
<blockquote>
<p>Customize handling of asynchronous events by combining event-processing operators.</p>
</blockquote>
<p>➕<a href="https://developer.apple.com/documentation/cryptokit">CryptoKit</a></p>
<blockquote>
<p>Perform cryptographic operations securely and efficiently.</p>
</blockquote>
<p>➕<a href="https://developer.apple.com/documentation/uikit/uisearchtextfield">UISearchTextField</a></p>
<blockquote>
<p>Expose UISearchTextField on UISearchBar</p>
</blockquote>
<p>➕<a href="https://developer.apple.com/documentation/metrickit">MetricKit</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-06-17T10:53:31.000Z" title="2019-06-17T10:53:31.000Z">2019-06-17</time><span class="level-item">3 minutes read (About 413 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/Links-for-WWDC/">Links for WWDC</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/313">#313</a></strong></p>
<h2 id="iOS-10"><a href="#iOS-10" class="headerlink" title="iOS 10"></a>iOS 10</h2><p>➕<a href="https://developer.apple.com/documentation/usernotifications">UserNotifications</a></p>
<blockquote>
<p>Push user-facing notifications to the user’s device from a server, or generate them locally from your app.</p>
</blockquote>
<p>➕<a href="https://developer.apple.com/documentation/uikit/uiviewpropertyanimator">UIViewPropertyAnimator</a></p>
<blockquote>
<p>A class that animates changes to views and allows the dynamic modification of those animations.</p>
</blockquote>
<p>➕<a href="https://developer.apple.com/documentation/coredata/nspersistentcontainer">NSPersistentContainer</a></p>
<blockquote>
<p>A container that encapsulates the Core Data stack in your app.</p>
</blockquote>
<p>➕<a href="https://developer.apple.com/documentation/uikit/uifeedbackgenerator">UIFeedbackGenerator</a></p>
<blockquote>
<p>The abstract superclass for all feedback generators.</p>
</blockquote>
<h2 id="iOS-10-3"><a href="#iOS-10-3" class="headerlink" title="iOS 10.3"></a>iOS 10.3</h2><p>➕<a href="https://developer.apple.com/documentation/storekit/skstorereviewcontroller">SKStoreReviewController</a></p>
<blockquote>
<p>An object that controls the process of requesting App Store ratings and reviews from users.</p>
</blockquote>
<h2 id="iOS-11"><a href="#iOS-11" class="headerlink" title="iOS 11"></a>iOS 11</h2><p>➕<a href="https://developer.apple.com/documentation/uikit/uiview/2891102-safearealayoutguide">safeAreaLayoutGuide</a></p>
<blockquote>
<p>The layout guide representing the portion of your view that is unobscured by bars and other content.</p>
</blockquote>
<p>➕<a href="https://developer.apple.com/documentation/coreml">CoreML</a></p>
<blockquote>
<p>Integrate machine learning models into your app.</p>
</blockquote>
<p>➕<a href="https://developer.apple.com/documentation/vision">Vision</a></p>
<blockquote>
<p>Apply computer vision algorithms to perform a variety of tasks on input images and video.</p>
</blockquote>
<p>➕<a href="https://developer.apple.com/documentation/arkit">ARKit</a></p>
<blockquote>
<p>Integrate iOS device camera and motion features to produce augmented reality experiences in your app or game.</p>
</blockquote>
<p>➕<a href="https://developer.apple.com/documentation/devicecheck">DeviceCheck</a></p>
<blockquote>
<p>Access per-device, per-developer data that your associated server can use in its business logic.</p>
</blockquote>
<p>➕<a href="https://developer.apple.com/documentation/uikit/drag_and_drop">Drag and Drop</a></p>
<blockquote>
<p>Bring drag and drop to your app by using interaction APIs with your views.</p>
</blockquote>
<p>➕<a href="https://developer.apple.com/documentation/corenfc">CoreNFC</a></p>
<blockquote>
<p>Detect NFC tags and read messages that contain NDEF data.</p>
</blockquote>
<p>➕<a href="https://developer.apple.com/documentation/quartzcore/calayer/2877488-maskedcorners">maskedCorners</a></p>
<blockquote>
<p>Animatable corner radius</p>
</blockquote>
<h2 id="iOS-12"><a href="#iOS-12" class="headerlink" title="iOS 12"></a>iOS 12</h2><p>➕<a href="https://developer.apple.com/documentation/authenticationservices">AuthenticationServices</a></p>
<blockquote>
<p>Make it easy for users to log into apps and services.</p>
</blockquote>
<h2 id="iOS-13"><a href="#iOS-13" class="headerlink" title="iOS 13"></a>iOS 13</h2><ul>
<li><a href="https://www.hackingwithswift.com/articles/193/whats-new-in-ios-13">https://www.hackingwithswift.com/articles/193/whats-new-in-ios-13</a></li>
<li><a href="https://onesignal.com/blog/ios-13-introduces-4-breaking-changes-to-notifications/">https://onesignal.com/blog/ios-13-introduces-4-breaking-changes-to-notifications/</a></li>
</ul>
<p>➕<a href="https://developer.apple.com/documentation/swiftui">SwiftUI</a></p>
<blockquote>
<p>Declare the user interface and behavior for your app on every platform.</p>
</blockquote>
<p>➕<a href="https://developer.apple.com/documentation/combine">Combine</a></p>
<blockquote>
<p>Customize handling of asynchronous events by combining event-processing operators.</p>
</blockquote>
<p>➕<a href="https://developer.apple.com/documentation/cryptokit">CryptoKit</a></p>
<blockquote>
<p>Perform cryptographic operations securely and efficiently.</p>
</blockquote>
<p>➕<a href="https://developer.apple.com/documentation/uikit/uisearchtextfield">UISearchTextField</a></p>
<blockquote>
<p>Expose UISearchTextField on UISearchBar</p>
</blockquote>
<p>➕<a href="https://developer.apple.com/documentation/metrickit">MetricKit</a></p>
<p>➕CoreSVG</p>
<ul>
<li><a href="https://github.com/SDWebImage/SDWebImageSVGCoder">https://github.com/SDWebImage/SDWebImageSVGCoder</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-06-17T10:53:31.000Z" title="2019-06-17T10:53:31.000Z">2019-06-17</time><span class="level-item">3 minutes read (About 406 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/What-is-new-in-iOS/">What is new in iOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/313">#313</a></strong></p>
<h2 id="iOS-10"><a href="#iOS-10" class="headerlink" title="iOS 10"></a>iOS 10</h2><p>➕<a href="https://developer.apple.com/documentation/usernotifications">UserNotifications</a></p>
<blockquote>
<p>Push user-facing notifications to the user’s device from a server, or generate them locally from your app.</p>
</blockquote>
<p>➕<a href="https://developer.apple.com/documentation/uikit/uiviewpropertyanimator">UIViewPropertyAnimator</a></p>
<blockquote>
<p>A class that animates changes to views and allows the dynamic modification of those animations.</p>
</blockquote>
<p>➕<a href="https://developer.apple.com/documentation/coredata/nspersistentcontainer">NSPersistentContainer</a></p>
<blockquote>
<p>A container that encapsulates the Core Data stack in your app.</p>
</blockquote>
<p>➕<a href="https://developer.apple.com/documentation/uikit/uifeedbackgenerator">UIFeedbackGenerator</a></p>
<blockquote>
<p>The abstract superclass for all feedback generators.</p>
</blockquote>
<h2 id="iOS-10-3"><a href="#iOS-10-3" class="headerlink" title="iOS 10.3"></a>iOS 10.3</h2><p>➕<a href="https://developer.apple.com/documentation/storekit/skstorereviewcontroller">SKStoreReviewController</a></p>
<blockquote>
<p>An object that controls the process of requesting App Store ratings and reviews from users.</p>
</blockquote>
<h2 id="iOS-11"><a href="#iOS-11" class="headerlink" title="iOS 11"></a>iOS 11</h2><p>➕<a href="https://developer.apple.com/documentation/uikit/uiview/2891102-safearealayoutguide">safeAreaLayoutGuide</a></p>
<blockquote>
<p>The layout guide representing the portion of your view that is unobscured by bars and other content.</p>
</blockquote>
<p>➕<a href="https://developer.apple.com/documentation/coreml">CoreML</a></p>
<blockquote>
<p>Integrate machine learning models into your app.</p>
</blockquote>
<p>➕<a href="https://developer.apple.com/documentation/vision">Vision</a></p>
<blockquote>
<p>Apply computer vision algorithms to perform a variety of tasks on input images and video.</p>
</blockquote>
<p>➕<a href="https://developer.apple.com/documentation/arkit">ARKit</a></p>
<blockquote>
<p>Integrate iOS device camera and motion features to produce augmented reality experiences in your app or game.</p>
</blockquote>
<p>➕<a href="https://developer.apple.com/documentation/devicecheck">DeviceCheck</a></p>
<blockquote>
<p>Access per-device, per-developer data that your associated server can use in its business logic.</p>
</blockquote>
<p>➕<a href="https://developer.apple.com/documentation/uikit/drag_and_drop">Drag and Drop</a></p>
<blockquote>
<p>Bring drag and drop to your app by using interaction APIs with your views.</p>
</blockquote>
<p>➕<a href="https://developer.apple.com/documentation/corenfc">CoreNFC</a></p>
<blockquote>
<p>Detect NFC tags and read messages that contain NDEF data.</p>
</blockquote>
<p>➕<a href="https://developer.apple.com/documentation/quartzcore/calayer/2877488-maskedcorners">maskedCorners</a></p>
<blockquote>
<p>Animatable corner radius</p>
</blockquote>
<h2 id="iOS-12"><a href="#iOS-12" class="headerlink" title="iOS 12"></a>iOS 12</h2><p>➕<a href="https://developer.apple.com/documentation/authenticationservices">AuthenticationServices</a></p>
<blockquote>
<p>Make it easy for users to log into apps and services.</p>
</blockquote>
<h2 id="iOS-13"><a href="#iOS-13" class="headerlink" title="iOS 13"></a>iOS 13</h2><ul>
<li><a href="https://www.hackingwithswift.com/articles/193/whats-new-in-ios-13">https://www.hackingwithswift.com/articles/193/whats-new-in-ios-13</a></li>
<li><a href="https://onesignal.com/blog/ios-13-introduces-4-breaking-changes-to-notifications/">https://onesignal.com/blog/ios-13-introduces-4-breaking-changes-to-notifications/</a></li>
</ul>
<p>➕<a href="https://developer.apple.com/documentation/swiftui">SwiftUI</a></p>
<blockquote>
<p>Declare the user interface and behavior for your app on every platform.</p>
</blockquote>
<p>➕<a href="https://developer.apple.com/documentation/combine">Combine</a></p>
<blockquote>
<p>Customize handling of asynchronous events by combining event-processing operators.</p>
</blockquote>
<p>➕<a href="https://developer.apple.com/documentation/cryptokit">CryptoKit</a></p>
<blockquote>
<p>Perform cryptographic operations securely and efficiently.</p>
</blockquote>
<p>➕<a href="https://developer.apple.com/documentation/uikit/uisearchtextfield">UISearchTextField</a></p>
<blockquote>
<p>Expose UISearchTextField on UISearchBar</p>
</blockquote>
<p>➕<a href="https://developer.apple.com/documentation/metrickit">MetricKit</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-06-14T09:28:25.000Z" title="2019-06-14T09:28:25.000Z">2019-06-14</time><span class="level-item">a few seconds read (About 58 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-get-cell-at-center-during-scroll-in-UICollectionView/">How to get cell at center during scroll in UICollectionView</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/311">#311</a></strong></p>
<p>See Omnia <a href="https://github.com/onmyway133/Omnia/blob/master/Sources/iOS/UICollectionView.swift#L30">https://github.com/onmyway133/Omnia/blob/master/Sources/iOS/UICollectionView.swift#L30</a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">HorizontalUsersViewController</span>: <span class="title">UIScrollViewDelegate</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">scrollViewDidEndDecelerating</span><span class="params">(<span class="number">_</span> scrollView: UIScrollView)</span></span> &#123;</span><br><span class="line">        <span class="keyword">let</span> point = view.convert(collectionView.center, to: collectionView)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">guard</span></span><br><span class="line">            <span class="keyword">let</span> indexPath = collectionView.indexPathForItem(at: point),</span><br><span class="line">            indexPath.item &lt; users.<span class="built_in">count</span></span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> user = users[indexPath.item]</span><br><span class="line">        delegate?.didScrollTo(user)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-06-14T09:27:14.000Z" title="2019-06-14T09:27:14.000Z">2019-06-14</time><span class="level-item">a few seconds read (About 18 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-downsample-image-in-iOS/">How to downsample image in iOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/310">#310</a></strong></p>
<ul>
<li><a href="https://www.swiftjectivec.com/optimizing-images/">https://www.swiftjectivec.com/optimizing-images/</a></li>
<li><a href="https://nshipster.com/image-resizing/">https://nshipster.com/image-resizing/</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-06-13T12:02:15.000Z" title="2019-06-13T12:02:15.000Z">2019-06-13</time><span class="level-item">a few seconds read (About 86 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-show-location-in-Apple-Maps-and-Google-Maps-app-in-iOS/">How to show location in Apple Maps and Google Maps app in iOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/309">#309</a></strong></p>
<h2 id="Apple-Maps"><a href="#Apple-Maps" class="headerlink" title="Apple Maps"></a>Apple Maps</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> placemark = <span class="type">MKPlacemark</span>(coordinate: coordinate, addressDictionary: <span class="literal">nil</span>)</span><br><span class="line"><span class="keyword">let</span> mapItem = <span class="type">MKMapItem</span>(placemark: placemark)</span><br><span class="line">mapItem.name = shop.name</span><br><span class="line">mapItem.openInMaps(launchOptions: [:])</span><br></pre></td></tr></table></figure>

<h2 id="Google-Maps"><a href="#Google-Maps" class="headerlink" title="Google Maps"></a>Google Maps</h2><ul>
<li><a href="https://developers.google.com/maps/documentation/urls/ios-urlscheme">https://developers.google.com/maps/documentation/urls/ios-urlscheme</a></li>
<li>Use <code>q</code> to show pin</li>
</ul>
<p>Since iOS 9, we need to declare <code>LSApplicationQueriesSchemes</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">key</span>&gt;</span>LSApplicationQueriesSchemes<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span>&gt;</span>comgooglemaps<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> string = <span class="string">"comgooglemaps://"</span></span><br><span class="line">string += <span class="string">"?q=Food"</span></span><br><span class="line">string += <span class="string">"&amp;center=\(coordinate.latitude),\(coordinate.longitude)"</span></span><br><span class="line">string += <span class="string">"&amp;zoom=15"</span></span><br><span class="line"><span class="keyword">let</span> googleUrl = <span class="type">URL</span>(string: string)!</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="type">UIApplication</span>.shared.canOpenURL(<span class="type">URL</span>(string: <span class="string">"comgooglemaps://"</span>)!) &#123;</span><br><span class="line">    <span class="type">UIApplication</span>.shared.<span class="keyword">open</span>(googleUrl)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-06-13T09:49:44.000Z" title="2019-06-13T09:49:44.000Z">2019-06-13</time><span class="level-item">a few seconds read (About 27 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-format-distance-in-iOS/">How to format distance in iOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/307">#307</a></strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> MapKit</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> formatter = <span class="type">MKDistanceFormatter</span>()</span><br><span class="line">formatter.unitStyle = .abbreviated</span><br><span class="line">formatter.units = .metric</span><br><span class="line">distanceLabel.text = formatter.string(fromDistance: <span class="built_in">distance</span>) <span class="comment">// 700m, 1.7km</span></span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-06-12T09:11:26.000Z" title="2019-06-12T09:11:26.000Z">2019-06-12</time><span class="level-item">a few seconds read (About 89 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-test-drive-view-in-iOS/">How to test drive view in iOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/303">#303</a></strong></p>
<p>Instead of setting up custom framework and Playground, we can just display that specific view as root view controller</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">window.rootViewController = makeTestPlayground()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">makeTestPlayground</span><span class="params">()</span></span> -&gt; <span class="type">UIViewController</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> content = <span class="type">UserCell</span>()</span><br><span class="line">    content.nameLabel.text = <span class="string">"Thor"</span></span><br><span class="line">    content.streetLabel.text = <span class="string">"Asgard"</span></span><br><span class="line">    content.weaponLabel.text = <span class="string">"Hammer"</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> viewController = <span class="type">UIViewController</span>()</span><br><span class="line">    viewController.view.backgroundColor = .white</span><br><span class="line">    viewController.view.addSubview(content)</span><br><span class="line"></span><br><span class="line">    <span class="type">NSLayoutConstraint</span>.on([</span><br><span class="line">        content.centerXAnchor.constraint(equalTo: viewController.view.centerXAnchor),</span><br><span class="line">        content.centerYAnchor.constraint(equalTo: viewController.view.centerYAnchor),</span><br><span class="line">        content.widthAnchor.constraint(equalTo: viewController.view.widthAnchor, multiplier0.<span class="number">9</span>),</span><br><span class="line">        content.heightAnchor.constraint(equalToConstant: <span class="number">200</span>)</span><br><span class="line">    ]</span><br><span class="line">    <span class="keyword">return</span> viewController</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-06-12T08:35:42.000Z" title="2019-06-12T08:35:42.000Z">2019-06-12</time><span class="level-item">4 minutes read (About 566 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-make-carousel-layout-for-UICollectionView-in-iOS/">How to make carousel layout for UICollectionView in iOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/302">#302</a></strong></p>
<h3 id="Based-on-AnimatedCollectionViewLayout"><a href="#Based-on-AnimatedCollectionViewLayout" class="headerlink" title="Based on AnimatedCollectionViewLayout"></a>Based on <a href="https://github.com/KelvinJin/AnimatedCollectionViewLayout">AnimatedCollectionViewLayout</a></h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">CarouselLayout</span>: <span class="title">UICollectionViewFlowLayout</span> </span>&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">layoutAttributesForElements</span><span class="params">(<span class="keyword">in</span> rect: CGRect)</span></span> -&gt; [<span class="type">UICollectionViewLayoutAttributes</span>]? &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> attributes = <span class="keyword">super</span>.layoutAttributesForElements(<span class="keyword">in</span>: rect) <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> collectionView = collectionView <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</span><br><span class="line">        <span class="keyword">return</span> attributes.<span class="built_in">map</span>(&#123; transform(collectionView: collectionView, attribute: $<span class="number">0</span>) &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">shouldInvalidateLayout</span><span class="params">(forBoundsChange newBounds: CGRect)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">transform</span><span class="params">(collectionView: UICollectionView, attribute: UICollectionViewLayoutAttributes)</span></span> -&gt; <span class="type">UICollectionViewLayoutAttributes</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> a = attribute</span><br><span class="line">        <span class="keyword">let</span> width = collectionView.frame.size.width</span><br><span class="line">        <span class="keyword">let</span> itemOffset = a.center.x - collectionView.contentOffset.x</span><br><span class="line">        <span class="keyword">let</span> middleOffset = (itemOffset / width) - <span class="number">0.5</span></span><br><span class="line"></span><br><span class="line">        change(</span><br><span class="line">            width: collectionView.frame.size.width,</span><br><span class="line">            attribute: attribute,</span><br><span class="line">            middleOffset: middleOffset</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> attribute</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">change</span><span class="params">(width: CGFloat, attribute: UICollectionViewLayoutAttributes, middleOffset: CGFloat)</span></span> &#123;</span><br><span class="line">        <span class="keyword">let</span> alpha: <span class="type">CGFloat</span> = <span class="number">0.8</span></span><br><span class="line">        <span class="keyword">let</span> itemSpacing: <span class="type">CGFloat</span> = <span class="number">0.21</span></span><br><span class="line">        <span class="keyword">let</span> scale: <span class="type">CGFloat</span> = <span class="number">1.0</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> scaleFactor = scale - <span class="number">0.1</span> * <span class="built_in">abs</span>(middleOffset)</span><br><span class="line">        <span class="keyword">let</span> scaleTransform = <span class="type">CGAffineTransform</span>(scaleX: scaleFactor, y: scaleFactor)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> translationX = -(width * itemSpacing * middleOffset)</span><br><span class="line">        <span class="keyword">let</span> translationTransform = <span class="type">CGAffineTransform</span>(translationX: translationX, y: <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">        attribute.alpha = <span class="number">1.0</span> - <span class="built_in">abs</span>(middleOffset) + alpha</span><br><span class="line">        attribute.transform = translationTransform.concatenating(scaleTransform)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>How to use</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> layout = <span class="type">CarouselLayout</span>()</span><br><span class="line"></span><br><span class="line">layout.scrollDirection = .horizontal</span><br><span class="line">layout.sectionInset = .zero</span><br><span class="line">layout.minimumInteritemSpacing = <span class="number">0</span></span><br><span class="line">layout.minimumLineSpacing = <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>We can inset cell content and use <code>let scale: CGFloat = 1.0</code> to avoid scaling down center cell</p>
<h3 id="Based-on-CityCollectionViewFlowLayout"><a href="#Based-on-CityCollectionViewFlowLayout" class="headerlink" title="Based on CityCollectionViewFlowLayout"></a>Based on <a href="https://github.com/appcoda/Interactive-Animation/blob/master/CityGuide/Layout/CityCollectionViewFlowLayout.swift">CityCollectionViewFlowLayout</a></h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CityCollectionViewFlowLayout</span>: <span class="title">UICollectionViewFlowLayout</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fileprivate</span> <span class="keyword">var</span> lastCollectionViewSize: <span class="type">CGSize</span> = <span class="type">CGSize</span>.zero</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> scaleOffset: <span class="type">CGFloat</span> = <span class="number">200</span></span><br><span class="line">    <span class="keyword">var</span> scaleFactor: <span class="type">CGFloat</span> = <span class="number">0.9</span></span><br><span class="line">    <span class="keyword">var</span> alphaFactor: <span class="type">CGFloat</span> = <span class="number">0.3</span></span><br><span class="line">    <span class="keyword">var</span> lineSpacing: <span class="type">CGFloat</span> = <span class="number">25.0</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">init</span>?(coder <span class="number">_</span>: <span class="type">NSCoder</span>) &#123;</span><br><span class="line">        <span class="built_in">fatalError</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(itemSize: <span class="type">CGSize</span>) &#123;</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>()</span><br><span class="line">        <span class="keyword">self</span>.itemSize = itemSize</span><br><span class="line">        minimumLineSpacing = lineSpacing</span><br><span class="line">        scrollDirection = .horizontal</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">setItemSize</span><span class="params">(itemSize: CGSize)</span></span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.itemSize = itemSize</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">invalidateLayout</span><span class="params">(with context: UICollectionViewLayoutInvalidationContext)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.invalidateLayout(with: context)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> collectionView = <span class="keyword">self</span>.collectionView <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> collectionView.bounds.size != lastCollectionViewSize &#123;</span><br><span class="line">            configureContentInset()</span><br><span class="line">            lastCollectionViewSize = collectionView.bounds.size</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">targetContentOffset</span><span class="params">(forProposedContentOffset proposedContentOffset: CGPoint, withScrollingVelocity velocity: CGPoint)</span></span> -&gt; <span class="type">CGPoint</span> &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> collectionView = <span class="keyword">self</span>.collectionView <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> proposedContentOffset</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> proposedRect = <span class="type">CGRect</span>(x: proposedContentOffset.x, y: <span class="number">0</span>, width: collectionView.bounds.width, height: collectionView.bounds.height)</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> layoutAttributes = <span class="keyword">self</span>.layoutAttributesForElements(<span class="keyword">in</span>: proposedRect) <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> proposedContentOffset</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">var</span> candidateAttributes: <span class="type">UICollectionViewLayoutAttributes?</span></span><br><span class="line">        <span class="keyword">let</span> proposedContentOffsetCenterX = proposedContentOffset.x + collectionView.bounds.width / <span class="number">2</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> attributes <span class="keyword">in</span> layoutAttributes &#123;</span><br><span class="line">            <span class="keyword">if</span> attributes.representedElementCategory != .cell &#123;</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> candidateAttributes == <span class="literal">nil</span> &#123;</span><br><span class="line">                candidateAttributes = attributes</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">abs</span>(attributes.center.x - proposedContentOffsetCenterX) &lt; <span class="built_in">abs</span>(candidateAttributes!.center.x - proposedContentOffsetCenterX) &#123;</span><br><span class="line">                candidateAttributes = attributes</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> aCandidateAttributes = candidateAttributes <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> proposedContentOffset</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">var</span> newOffsetX = aCandidateAttributes.center.x - collectionView.bounds.size.width / <span class="number">2</span></span><br><span class="line">        <span class="keyword">let</span> offset = newOffsetX - collectionView.contentOffset.x</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (velocity.x &lt; <span class="number">0</span> &amp;&amp; offset &gt; <span class="number">0</span>) || (velocity.x &gt; <span class="number">0</span> &amp;&amp; offset &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">let</span> pageWidth = itemSize.width + minimumLineSpacing</span><br><span class="line">            newOffsetX += velocity.x &gt; <span class="number">0</span> ? pageWidth : -pageWidth</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="type">CGPoint</span>(x: newOffsetX, y: proposedContentOffset.y)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">shouldInvalidateLayout</span><span class="params">(forBoundsChange <span class="number">_</span>: CGRect)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">layoutAttributesForElements</span><span class="params">(<span class="keyword">in</span> rect: CGRect)</span></span> -&gt; [<span class="type">UICollectionViewLayoutAttributes</span>]? &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> collectionView = <span class="keyword">self</span>.collectionView,</span><br><span class="line">            <span class="keyword">let</span> superAttributes = <span class="keyword">super</span>.layoutAttributesForElements(<span class="keyword">in</span>: rect) <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">super</span>.layoutAttributesForElements(<span class="keyword">in</span>: rect)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> contentOffset = collectionView.contentOffset</span><br><span class="line">        <span class="keyword">let</span> size = collectionView.bounds.size</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> visibleRect = <span class="type">CGRect</span>(x: contentOffset.x, y: contentOffset.y, width: size.width, height: size.height)</span><br><span class="line">        <span class="keyword">let</span> visibleCenterX = visibleRect.midX</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">case</span> <span class="keyword">let</span> newAttributesArray <span class="keyword">as</span> [<span class="type">UICollectionViewLayoutAttributes</span>] = <span class="type">NSArray</span>(array: superAttributes, copyItems: <span class="literal">true</span>) <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        newAttributesArray.forEach &#123;</span><br><span class="line">            <span class="keyword">let</span> distanceFromCenter = visibleCenterX - $<span class="number">0</span>.center.x</span><br><span class="line">            <span class="keyword">let</span> absDistanceFromCenter = <span class="built_in">min</span>(<span class="built_in">abs</span>(distanceFromCenter), <span class="keyword">self</span>.scaleOffset)</span><br><span class="line">            <span class="keyword">let</span> scale = absDistanceFromCenter * (<span class="keyword">self</span>.scaleFactor - <span class="number">1</span>) / <span class="keyword">self</span>.scaleOffset + <span class="number">1</span></span><br><span class="line">            $<span class="number">0</span>.transform3D = <span class="type">CATransform3DScale</span>(<span class="type">CATransform3DIdentity</span>, scale, scale, <span class="number">1</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">let</span> alpha = absDistanceFromCenter * (<span class="keyword">self</span>.alphaFactor - <span class="number">1</span>) / <span class="keyword">self</span>.scaleOffset + <span class="number">1</span></span><br><span class="line">            $<span class="number">0</span>.alpha = alpha</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> newAttributesArray</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">configureContentInset</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> collectionView = <span class="keyword">self</span>.collectionView <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> inset = collectionView.bounds.size.width / <span class="number">2</span> - itemSize.width / <span class="number">2</span></span><br><span class="line">        collectionView.contentInset = <span class="type">UIEdgeInsets</span>.<span class="keyword">init</span>(top: <span class="number">0</span>, <span class="keyword">left</span>: inset, bottom: <span class="number">0</span>, <span class="keyword">right</span>: inset)</span><br><span class="line">        collectionView.contentOffset = <span class="type">CGPoint</span>(x: -inset, y: <span class="number">0</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">resetContentInset</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> collectionView = <span class="keyword">self</span>.collectionView <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        collectionView.contentInset = <span class="type">UIEdgeInsets</span>.<span class="keyword">init</span>(top: <span class="number">0</span>, <span class="keyword">left</span>: <span class="number">0</span>, bottom: <span class="number">0</span>, <span class="keyword">right</span>: <span class="number">0</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-06-12T06:30:14.000Z" title="2019-06-12T06:30:14.000Z">2019-06-12</time><span class="level-item">2 minutes read (About 336 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-make-simple-pan-to-dismiss-view-in-iOS/">How to make simple pan to dismiss view in iOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/301">#301</a></strong></p>
<p>Make it more composable using <code>UIViewController</code> subclass and <code>ThroughView</code> to pass hit events to underlying views.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PanViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> animator = <span class="type">UIViewPropertyAnimator</span>(duration: <span class="number">0</span>, curve: .easeOut)</span><br><span class="line">    <span class="built_in">lazy</span> <span class="keyword">var</span> panGR = <span class="type">UIPanGestureRecognizer</span>(target: <span class="keyword">self</span>, action: #selector(handlePan(<span class="number">_</span>: )))</span><br><span class="line">    <span class="keyword">let</span> slideView = <span class="type">UIView</span>()</span><br><span class="line">    <span class="keyword">let</span> gripView = <span class="type">UIView</span>()</span><br><span class="line">    <span class="keyword">var</span> options: <span class="type">Options</span> = <span class="type">Options</span>()</span><br><span class="line">    <span class="keyword">var</span> didHide: (() -&gt; <span class="type">Void</span>)?</span><br><span class="line">    <span class="keyword">let</span> pullDownVelocity: <span class="type">CGFloat</span> = <span class="number">70</span></span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Options</span> </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> contentView: <span class="type">UIView</span> = <span class="type">UIView</span>()</span><br><span class="line">        <span class="keyword">var</span> percentHeight: <span class="type">CGFloat</span> = <span class="number">0.24</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">loadView</span><span class="params">()</span></span> &#123;</span><br><span class="line">        view = <span class="type">ThroughView</span>()</span><br><span class="line">        view.translatesAutoresizingMaskIntoConstraints = <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line"></span><br><span class="line">        setup()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">setup</span><span class="params">()</span></span> &#123;</span><br><span class="line">        slideView.layer.cornerRadius = <span class="number">10</span></span><br><span class="line">        slideView.clipsToBounds = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">        gripView.backgroundColor = <span class="type">UIColor</span>.yellow</span><br><span class="line">        gripView.layer.cornerRadius = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        view.addSubview(slideView)</span><br><span class="line">        slideView.addSubview(gripView)</span><br><span class="line">        slideView.addGestureRecognizer(panGR)</span><br><span class="line"></span><br><span class="line">        <span class="type">NSLayoutConstraint</span>.on([</span><br><span class="line">            slideView.leftAnchor.constraint(equalTo: view.leftAnchor),</span><br><span class="line">            slideView.rightAnchor.constraint(equalTo: view.rightAnchor),</span><br><span class="line">            slideView.heightAnchor.constraint(equalTo: view.heightAnchor),</span><br><span class="line">            slideView.topAnchor.constraint(equalTo: view.bottomAnchor)</span><br><span class="line">        ])</span><br><span class="line"></span><br><span class="line">        <span class="type">NSLayoutConstraint</span>.on([</span><br><span class="line">            gripView.centerXAnchor.constraint(equalTo: slideView.centerXAnchor),</span><br><span class="line">            gripView.topAnchor.constraint(equalTo: slideView.topAnchor, constant: <span class="number">16</span>),</span><br><span class="line">            gripView.widthAnchor.constraint(equalToConstant: <span class="number">30</span>),</span><br><span class="line">            gripView.heightAnchor.constraint(equalToConstant: <span class="number">2</span>)</span><br><span class="line">        ])</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">apply</span><span class="params">(options: Options)</span></span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.options.contentView.removeFromSuperview()</span><br><span class="line">        slideView.insertSubview(options.contentView, at: <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">        <span class="type">NSLayoutConstraint</span>.on([</span><br><span class="line">            options.contentView.leftAnchor.constraint(equalTo: slideView.leftAnchor),</span><br><span class="line">            options.contentView.rightAnchor.constraint(equalTo: slideView.rightAnchor),</span><br><span class="line">            options.contentView.topAnchor.constraint(equalTo: slideView.topAnchor),</span><br><span class="line">            options.contentView.heightAnchor.constraint(equalTo: slideView.heightAnchor, multiplier: options.percentHeight)</span><br><span class="line">        ])</span><br><span class="line"></span><br><span class="line">        <span class="keyword">self</span>.options = options</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@objc</span> <span class="function"><span class="keyword">func</span> <span class="title">handlePan</span><span class="params">(<span class="number">_</span> gr: UIPanGestureRecognizer)</span></span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> gr.state &#123;</span><br><span class="line">        <span class="keyword">case</span> .began:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">case</span> .changed:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">case</span> .ended:</span><br><span class="line">            <span class="keyword">let</span> velocity = gr.velocity(<span class="keyword">in</span>: slideView)</span><br><span class="line">            <span class="keyword">if</span> velocity.y &gt; pullDownVelocity &#123;</span><br><span class="line">                hide()</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">show</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> parentView = view.superview <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        animator = <span class="keyword">self</span>.makeAnimator()</span><br><span class="line">        animator.addAnimations &#123;</span><br><span class="line">            <span class="keyword">self</span>.slideView.transform = <span class="type">CGAffineTransform</span>(</span><br><span class="line">                translationX: <span class="number">0</span>,</span><br><span class="line">                y: -parentView.bounds.height * <span class="keyword">self</span>.options.percentHeight - parentView.safeAreaInsets.bottom</span><br><span class="line">            )</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        animator.startAnimation()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">hide</span><span class="params">()</span></span> &#123;</span><br><span class="line">        animator = <span class="keyword">self</span>.makeAnimator()</span><br><span class="line">        animator.addAnimations &#123;</span><br><span class="line">            <span class="keyword">self</span>.slideView.transform = <span class="type">CGAffineTransform</span>.identity</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        animator.addCompletion(&#123; <span class="number">_</span> <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">self</span>.didHide?()</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        animator.startAnimation()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">makeAnimator</span><span class="params">()</span></span> -&gt; <span class="type">UIViewPropertyAnimator</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">UIViewPropertyAnimator</span>(duration: <span class="number">0.25</span>, dampingRatio: <span class="number">1.0</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThroughView</span>: <span class="title">UIView</span> </span>&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">didMoveToSuperview</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.didMoveToSuperview()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> superview = superview <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">NSLayoutConstraint</span>.on([pinEdges(view: superview)])</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">point</span><span class="params">(inside point: CGPoint, with event: UIEvent?)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> slideView = subviews.first <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> slideView.hitTest(convert(point, to: slideView), with: event) != <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-05-27T06:44:05.000Z" title="2019-05-27T06:44:05.000Z">2019-05-27</time><span class="level-item">3 minutes read (About 386 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-add-indicator-under-tab-bar-buttons-in-iOS/">How to add indicator under tab bar buttons in iOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/288">#288</a></strong></p>
<h2 id="selectionIndicatorImage"><a href="#selectionIndicatorImage" class="headerlink" title="selectionIndicatorImage"></a>selectionIndicatorImage</h2><ul>
<li><a href="https://developer.apple.com/documentation/uikit/uitabbar/1623456-selectionindicatorimage">https://developer.apple.com/documentation/uikit/uitabbar/1623456-selectionindicatorimage</a></li>
<li>Should design image with enough height, transparent background and indicator at the bottom</li>
</ul>
<blockquote>
<p>Use this property to specify a custom selection image. Your image is rendered on top of the tab bar but behind the contents of the tab bar item itself. The default value of this property is nil, which causes the tab bar to apply a default highlight to the selected item</p>
</blockquote>
<h2 id="Custom-UITabBar-or-UITabBarController"><a href="#Custom-UITabBar-or-UITabBarController" class="headerlink" title="Custom UITabBar or UITabBarController"></a>Custom UITabBar or UITabBarController</h2><ul>
<li>Hide existing <code>tabBar</code> <code>tabBar.isHidden = true</code></li>
<li>Position custom buttons</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CustomTabBarController</span>: <span class="title">UITabBarController</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">let</span> bar = <span class="type">UIView</span>()</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> buttons = [<span class="type">UIButton</span>]()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">var</span> viewControllers: [<span class="type">UIViewController</span>]? &#123;</span><br><span class="line">        <span class="keyword">didSet</span> &#123;</span><br><span class="line">        	populate(viewControllers: viewControllers)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line"></span><br><span class="line">        setup()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">setup</span><span class="params">()</span></span> &#123;</span><br><span class="line">        tabBar.isHidden = <span class="literal">true</span></span><br><span class="line">        bar.backgroundColor = <span class="type">R</span>.color.background</span><br><span class="line">        view.addSubview(bar)</span><br><span class="line">        <span class="type">NSLayoutConstraint</span>.on([</span><br><span class="line">            bar.leftAnchor.constraint(equalTo: view.leftAnchor),</span><br><span class="line">            bar.rightAnchor.constraint(equalTo: view.rightAnchor),</span><br><span class="line">            bar.bottomAnchor.constraint(equalTo: view.bottomAnchor),</span><br><span class="line">			bar.topAnchor.constraint(equalTo: tabBar.topAnchor)</span><br><span class="line">        ])</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">populate</span><span class="params">(viewControllers: [UIViewController])</span></span> &#123;</span><br><span class="line">        buttons.forEach &#123;</span><br><span class="line">            $<span class="number">0</span>.removeFromSuperview()</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        buttons = viewControllers.<span class="built_in">map</span>(&#123;</span><br><span class="line">            <span class="keyword">let</span> button = <span class="type">UIButton</span>()</span><br><span class="line">            button.setImage($<span class="number">0</span>.tabBarItem.image, <span class="keyword">for</span>: .normal)</span><br><span class="line">            bar.addSubview(button)</span><br><span class="line">            <span class="keyword">return</span> button</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        view.setNeedsLayout()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLayoutSubviews</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLayoutSubviews()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> padding: <span class="type">CGFloat</span> = <span class="number">20</span></span><br><span class="line">        <span class="keyword">let</span> buttonSize = <span class="type">CGSize</span>(width: <span class="number">30</span>, height: <span class="number">44</span>)</span><br><span class="line">        <span class="keyword">let</span> width = view.bounds.width - padding * <span class="number">20</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (index, button) <span class="keyword">in</span> buttons.enumerated() &#123;</span><br><span class="line">            button.center = <span class="type">CGPoint</span>(x: bar.center.x, y: bar.frame.height/<span class="number">2</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Handle-UITabBarControllerDelegate"><a href="#Handle-UITabBarControllerDelegate" class="headerlink" title="Handle UITabBarControllerDelegate"></a>Handle UITabBarControllerDelegate</h2><ul>
<li>Override <code>func tabBar(_ tabBar: UITabBar, didSelect item: UITabBarItem)</code></li>
<li><code>tabBar.subviews</code> contains 1 private <code>UITabBarBackground</code> and many private <code>UITabBarButton</code></li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CustomTabBarController</span>: <span class="title">UITabBarController</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> indicator: <span class="type">UIView</span> = &#123;</span><br><span class="line">        <span class="keyword">let</span> view = <span class="type">UIView</span>()</span><br><span class="line">        view.backgroundColor = <span class="type">R</span>.color.primary</span><br><span class="line">        view.frame.size = <span class="type">CGSize</span>(width: <span class="number">32</span>, height: <span class="number">2</span>)</span><br><span class="line">        view.layer.cornerRadius = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> view</span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line"></span><br><span class="line">        tabBar.addSubview(indicator)</span><br><span class="line">        <span class="keyword">self</span>.delegate = <span class="keyword">self</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">animate</span><span class="params">(index: Int)</span></span> &#123;</span><br><span class="line">        <span class="keyword">let</span> buttons = tabBar.subviews</span><br><span class="line">            .<span class="built_in">filter</span>(&#123; <span class="type">String</span>(describing: $<span class="number">0</span>).<span class="built_in">contains</span>(<span class="string">"Button"</span>) &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">guard</span> index &lt; buttons.<span class="built_in">count</span> <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> selectedButton = buttons[index]</span><br><span class="line">        <span class="type">UIView</span>.animate(</span><br><span class="line">            withDuration: <span class="number">0.25</span>,</span><br><span class="line">            delay: <span class="number">0</span>,</span><br><span class="line">            options: .curveEaseInOut,</span><br><span class="line">            animations: &#123;</span><br><span class="line">                <span class="keyword">let</span> point = <span class="type">CGPoint</span>(</span><br><span class="line">                    x: selectedButton.center.x,</span><br><span class="line">                    y: selectedButton.frame.maxY - <span class="number">1</span></span><br><span class="line">                )</span><br><span class="line"></span><br><span class="line">                <span class="keyword">self</span>.indicator.center = point</span><br><span class="line">            &#125;,</span><br><span class="line">            completion: <span class="literal">nil</span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLayoutSubviews</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLayoutSubviews()</span><br><span class="line"></span><br><span class="line">        animate(index: selectedIndex)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">CustomTabBarController</span>: <span class="title">UITabBarControllerDelegate</span> </span>&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">tabBar</span><span class="params">(<span class="number">_</span> tabBar: UITabBar, didSelect item: UITabBarItem)</span></span> &#123;</span><br><span class="line">        <span class="keyword">guard</span></span><br><span class="line">            <span class="keyword">let</span> items = tabBar.items,</span><br><span class="line">            <span class="keyword">let</span> index = items.firstIndex(of: item)</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        animate(index: index)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In iOS 13, we need to use <code>viewDidAppear</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidAppear</span><span class="params">(<span class="number">_</span> animated: Bool)</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.viewDidAppear(animated)</span><br><span class="line"></span><br><span class="line">    moveIndicator(index: selectedIndex, animated: <span class="literal">false</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-05-23T16:26:31.000Z" title="2019-05-23T16:26:31.000Z">2019-05-23</time><span class="level-item">5 minutes read (About 686 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-fix-wrong-status-bar-orientation-in-iOS/">How to fix wrong status bar orientation in iOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/280">#280</a></strong></p>
<p>Original post <a href="https://medium.com/fantageek/how-to-fix-wrong-status-bar-orientation-in-ios-f044f840b9ed">https://medium.com/fantageek/how-to-fix-wrong-status-bar-orientation-in-ios-f044f840b9ed</a></p>
<hr>
<p>When I first started iOS, it was iOS 8 at that time, I had a bug that took my nearly a day to figure out. The issue was that the status bar always orients to device orientation despite I already locked my main ViewController to portrait. This was why I started <a href="https://github.com/onmyway133/notes">notes</a> project on GitHub detailing what issues I ‘ve been facing.<br><a href="https://github.com/onmyway133/notes/issues/2"><strong>ViewController is locked to portrait but the status bar rotates when device rotates · Issue #2 ·…</strong><br><em>PROBLEM The rootViewController is locked to portrait. When I rotates, the view controller is portrait, but the status…</em>github.com</a></p>
<p>Now it is iOS 12, and to my surprise people still have this issues. Today I will revise this issue in iOS 12 project and use Swift.</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*kcHatZeSPOe939JafbdixA.png" alt=""></p>
<h2 id="Supported-interface-orientations"><a href="#Supported-interface-orientations" class="headerlink" title="Supported interface orientations"></a>Supported interface orientations</h2><p>Most apps only support portrait mode, with 1 or 2 screens being in landscape for image viewing or video player. So we usually declare Portrait, Landscape Left and Landscape Right.</p>
<p><img src="https://cdn-images-1.medium.com/max/3008/1*mfb71QV7FBufjo3fVm8cuw.png" alt=""></p>
<p>Since iOS 7, apps have simple design with focus on content. UIViewController was given bigger role in appearance specification.</p>
<p>Supposed that we have a MainViewController as the rootViewController and we want this to be locked in portrait mode.</p>
<pre><code>[@UIApplicationMain](http://twitter.com/UIApplicationMain)
class AppDelegate: UIResponder, UIApplicationDelegate {
 var window: UIWindow?
 func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?) -&gt; Bool {
   window = UIWindow(frame: UIScreen.main.bounds)
   window?.rootViewController = MainViewController()
   window?.makeKeyAndVisible()
   return true
 }
}</code></pre><p>There is a property called <a href="https://developer.apple.com/documentation/bundleresources/information_property_list/uiviewcontrollerbasedstatusbarappearance">UIViewControllerBasedStatusBarAppearance</a> that we can specify in Info.plist to assert that we want UIViewController to dynamically control status bar appearance.</p>
<blockquote>
<p>A Boolean value indicating whether the status bar appearance is based on the style preferred for the current view controller.</p>
</blockquote>
<p>Start by declaring in Info.plist</p>
<pre><code>&lt;key&gt;UIViewControllerBasedStatusBarAppearance&lt;/key&gt;
&lt;true/&gt;</code></pre><p>And in MainViewController , lock status bar to portrait</p>
<pre><code>import UIKit

class MainViewController: UIViewController {

let label = UILabel()

override func viewDidLoad() {
    super.viewDidLoad()

view.backgroundColor = .yellow

label.textColor = .red
    label.text = &quot;MainViewController&quot;
    label.font = UIFont.preferredFont(forTextStyle: .headline)
    label.sizeToFit()

view.addSubview(label)
  }

override func viewDidLayoutSubviews() {
    super.viewDidLayoutSubviews()

label.center = CGPoint(x: view.bounds.size.width/2, y: view.bounds.size.height/2)
  }

override var supportedInterfaceOrientations: UIInterfaceOrientationMask {
    return .portrait
  }
}</code></pre><p>The idea is that no matter orientation the device is, the status bar always stays in portrait mode, the same as our MainViewController .</p>
<p>But to my surprise, this is not the case !!! As you can see in the screenshot below, the MainViewController is in portrait, but the status bar is not.</p>
<p><img src="https://cdn-images-1.medium.com/max/3588/1*UFfkghJFiLN1nxnxX7Qr6g.png" alt=""></p>
<h2 id="Stop-mixing-code-and-Storyboard"><a href="#Stop-mixing-code-and-Storyboard" class="headerlink" title="Stop mixing code and Storyboard"></a>Stop mixing code and Storyboard</h2><p>It took me a while to figure out that while I declare UIWindow in code, I also have MainStoryboard that configures UIWindow</p>
<pre><code>&lt;key&gt;UIMainStoryboardFile&lt;/key&gt;
&lt;string&gt;Main&lt;/string&gt;</code></pre><p>And this UIWindow from Storyboard has a default root ViewController</p>
<pre><code>import UIKit

class ViewController: UIViewController {

override func viewDidLoad() {
    super.viewDidLoad()

  }
}</code></pre><h2 id="The-meaning-of-UIViewControllerBasedStatusBarAppearance"><a href="#The-meaning-of-UIViewControllerBasedStatusBarAppearance" class="headerlink" title="The meaning of UIViewControllerBasedStatusBarAppearance"></a>The meaning of UIViewControllerBasedStatusBarAppearance</h2><p>In iOS, the status bar is hidden in landscape by default.</p>
<ul>
<li><p>Setting UIViewControllerBasedStatusBarAppearance to false means that we want this default behaviour</p>
</li>
<li><p>Setting UIViewControllerBasedStatusBarAppearance to true means we want to have control over the status bar appearance. So to hide the status bar, we must override prefersStatusBarHidden in the rootViewController, the presented view controller or the full screen view controller</p>
</li>
</ul>
<p>As you can see, the problem is that the ViewController from UIWindow in Storyboard clashes with our MainViewController in code, hence a lot of confusion.</p>
<p>The solution is simple, remove Main.storyboard and don’t use that in project</p>
<pre><code>&lt;key&gt;UIMainStoryboardFile&lt;/key&gt;
&lt;string&gt;Main&lt;/string&gt;</code></pre><p>Now we get our desired behaviour, status bar and view controllers are always locked to portrait regardless of the device orientation.</p>
<p><img src="https://cdn-images-1.medium.com/max/3588/1*cLVlNzcn3ryJNd5xjxXUoQ.png" alt=""></p>
<p>If you use code like me to setup UI, remember to clean up the generated storyboard and ViewController that comes default when project was generated by Xcode.</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-05-23T16:25:01.000Z" title="2019-05-23T16:25:01.000Z">2019-05-23</time><span class="level-item">10 minutes read (About 1512 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/Best-places-to-learn-iOS-development/">Best places to learn iOS development</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/278">#278</a></strong></p>
<p>Original post <a href="https://medium.com/fantageek/best-places-to-learn-ios-development-85ebebe890cf">https://medium.com/fantageek/best-places-to-learn-ios-development-85ebebe890cf</a></p>
<hr>
<p>It’s good to be software engineers, when you get paid to do what you like best. The good thing about software development is it ‘s changing fast, and challenging. This is also the not good thing, when you need to continuously learn and adapt to keep up with the trends.</p>
<p>This is for those who have been iOS developers for some time. If you have a lot of free time to spend, then congratulations. If you do not, you know the luxury of free time, then it’s time to learn wisely, by selecting only the good resources. But where should I learn from?</p>
<p>Welcome to the technology age, where there are tons to things to keep track of, iOS releases, SDK, 3rd frameworks, build tools, patterns, … Here are my list that I tend to open very often. It is opinionated and date aware. If it was several years ago, then <a href="http://nshipster.com/">http://nshipster.com/</a>, <a href="https://www.objc.io/">https://www.objc.io/</a> should be in the top of the list.</p>
<p>I like to keep track of stuff, via my lists <a href="https://github.com/onmyway133/fantastic-ios">https://github.com/onmyway133/fantastic-ios</a>, <a href="https://github.com/onmyway133/fantastic-ios-architecture">https://github.com/onmyway133/fantastic-ios-architecture</a>, <a href="https://github.com/onmyway133/fantastic-ios-animation">https://github.com/onmyway133/fantastic-ios-animation</a>. Also you should use services like <a href="https://feedly.com/">https://feedly.com/</a> to organise your subscription feed.</p>
<p>The point of this is for continuous learning, so it should be succinct. There is no particular order.</p>
<h2 id="1-Raywenderlich"><a href="#1-Raywenderlich" class="headerlink" title="1. Raywenderlich"></a>1. Raywenderlich</h2><p><a href="https://www.raywenderlich.com/"><strong>Ray Wenderlich | High quality programming tutorials: iOS, Android, Swift, Kotlin, Unity, and more</strong><br><em>Password Autofill allows our apps to automatically populate the username and password and believe it or not, it only…</em>www.raywenderlich.com</a></p>
<p>This is probably one of the most visited site for learning iOS development. All the tutorials are well designed and easy to follow. If you can, you can subscribe to videos <a href="https://videos.raywenderlich.com/courses">https://videos.raywenderlich.com/courses</a>. I myself find watching video much more relaxing. And the team is reviving its Podcast <a href="https://www.raywenderlich.com/rwpodcast">https://www.raywenderlich.com/rwpodcast</a> which I really recommend</p>
<h2 id="2-Swift-Talk"><a href="#2-Swift-Talk" class="headerlink" title="2. Swift Talk"></a>2. Swift Talk</h2><p><a href="https://talk.objc.io/"><strong>Swift Talk · objc.io</strong><br><em>We use the child view controller we created last time to factor out more code from the large view controller.</em>talk.objc.io</a></p>
<p>The people behind objc.io started their swift talks last year. I’m a fan of clean code, so these talks are really helpful when they show how to organise and write code. Also, they have awesome guests from some companies too.</p>
<h2 id="3-NSScreencast"><a href="#3-NSScreencast" class="headerlink" title="3. NSScreencast"></a>3. NSScreencast</h2><p>If you have less time, then this is great option. These covers many aspects of the iOS SDKs, and the videos are weekly.<br><a href="http://nsscreencast.com/episodes"><strong>NSScreencast: Bite-sized Screencasts for iOS Development</strong><br><em>Quality videos on iOS development, released each week.</em>nsscreencast.com</a></p>
<h2 id="4-Swift-By-Sundell"><a href="#4-Swift-By-Sundell" class="headerlink" title="4. Swift By Sundell"></a>4. Swift By Sundell</h2><p>I actually learn a lot from reading John ‘s blog. He shows various tips on iOS programming and the Swift language. Also his podcast is a must subscribe <a href="https://www.swiftbysundell.com/podcast/">https://www.swiftbysundell.com/podcast/</a>. I’ve listened to many podcasts, but I like this best.<br><a href="https://www.swiftbysundell.com"><strong>All posts</strong><br><em>Like many abstractions and patterns in programming, the goal of the builder pattern is to reduce the need to keep…</em>www.swiftbysundell.com</a></p>
<h2 id="5-AppCoda"><a href="#5-AppCoda" class="headerlink" title="5. AppCoda"></a>5. AppCoda</h2><p>I like this because the content is short, and focused. I can easily follow and grasp the gist immediately. And it has large collection of various contents.<br><a href="https://www.appcoda.com/"><strong>AppCoda - Learn Swift &amp; iOS Programming by Doing</strong><br><em>AppCoda is an educational startup that focuses on teaching people how to learn Swift &amp; iOS programming blog. Our…</em>www.appcoda.com</a></p>
<h2 id="6-Use-Your-Loaf"><a href="#6-Use-Your-Loaf" class="headerlink" title="6. Use Your Loaf"></a>6. Use Your Loaf</h2><p>This has updated posts for every new SDK features. Also, the content is short and to the points. It’s like wikipedia for iOS development.<br><a href="https://useyourloaf.com/"><strong>Use Your Loaf</strong><br><em>If you are upgrading to Xcode 10 and migrating to Swift 4.2 you are likely to see a number of errors because Swift 4.2…</em>useyourloaf.com</a></p>
<h2 id="7-iOS-Goodies"><a href="#7-iOS-Goodies" class="headerlink" title="7. iOS Goodies"></a>7. iOS Goodies</h2><p>The number of newsletters now is like stars on the sky. Among them I like iOS Goodies the best. It is driven by community <a href="https://github.com/iOS-Goodies/iOS-Goodies">https://github.com/iOS-Goodies/iOS-Goodies</a> and contains lots of new awesome stuff each week.<br><a href="http://ios-goodies.com/"><strong>iOS Goodies</strong><br><em>weekly iOS newsletter curated by Marius Constantinescu logo by José Torre founded by Rui Peres and Tiago Almeida</em>ios-goodies.com</a></p>
<h2 id="8-Erica-Sadun"><a href="#8-Erica-Sadun" class="headerlink" title="8. Erica Sadun"></a>8. Erica Sadun</h2><p>This is a bit advanced where it discusses Swift languages. But it’s good to read if you want to get yourself to know more about hidden language features.<br><a href="http://ericasadun.com/"><strong>Erica Sadun</strong><br><em>Recently, some of my simulators launched and loaded just fine. Others simply went black. It didn’t seem to matter which…</em>ericasadun.com</a></p>
<h2 id="9-Swifting"><a href="#9-Swifting" class="headerlink" title="9. Swifting"></a>9. Swifting</h2><p>I just discovered this recently, but I kinda like the blog. The number of posts are growing, and those are good reads about iOS SDKs.<br><a href="https://swifting.io/"><strong>swifting.io</strong><br><em>Our dear friend and a founder of swifting.io - Michał, had an accident two months ago. He had a bad luck and got hit by…</em>swifting.io</a></p>
<h2 id="10-Khanlou"><a href="#10-Khanlou" class="headerlink" title="10. Khanlou"></a>10. Khanlou</h2><p>I learn many good patterns and clean code from reading this blog. He suggests many ideas on refactoring code. Really recommend.<br><a href="http://khanlou.com/"><strong>Khanlou</strong><br><em>To convert this into an infinite collection, we need to think about a few things. First, how will we represent an index…</em>khanlou.com</a></p>
<h2 id="11-Ole-Begemann"><a href="#11-Ole-Begemann" class="headerlink" title="11. Ole Begemann"></a>11. Ole Begemann</h2><p>This has been in my favorite list for a long time. Although this is a bit advanced, it is good to dive deep into Swift.<br><a href="https://oleb.net/blog/"><strong>Articles - Ole Begemann</strong><br><em>Edit description</em>oleb.net</a></p>
<h2 id="12-Krzysztof-Zablocki"><a href="#12-Krzysztof-Zablocki" class="headerlink" title="12. Krzysztof Zabłocki"></a>12. Krzysztof Zabłocki</h2><p>This is my favorite, too. This shows many practical advices for iOS development. He also talks about build tool that I really like.<br><a href="http://merowing.info/post/"><strong>Posts</strong><br><em>Have you ever written tests? Usually, they use equality asserts, e.g. XCTAssertEqual, what happens if the object isn’t…</em>merowing.info</a></p>
<h2 id="13-Realm-News"><a href="#13-Realm-News" class="headerlink" title="13. Realm News"></a>13. Realm News</h2><p>Realm collects a huge collection of iOS videos from conferences and meet ups, and it has transcripts too. It’s more than enough to fill your free time.<br><a href="https://academy.realm.io/"><strong>Realm Academy - Expert content from the mobile experts</strong><br><em>Developer videos, articles and tutorials from top conferences, top authors, and community leaders.</em>academy.realm.io</a></p>
<h2 id="14-Big-Nerd-Ranch"><a href="#14-Big-Nerd-Ranch" class="headerlink" title="14. Big Nerd Ranch"></a>14. Big Nerd Ranch</h2><p>This has posts in both iOS and Android. But I really like the contents, very good.<br><a href="https://www.bignerdranch.com/blog/"><strong>App Development and Design Blog | Big Nerd Ranch</strong><br><em>Our blog offers app development and design tutorials, tips and tricks for software engineering and insights for team…</em>www.bignerdranch.com</a></p>
<h2 id="15-Cocoa-with-Love"><a href="#15-Cocoa-with-Love" class="headerlink" title="15. Cocoa with Love"></a>15. Cocoa with Love</h2><p>This is very advanced, and suitable for hardcore fans. I feel small when reading the posts.<br><a href="http://www.cocoawithlove.com/"><strong>Cocoa with Love</strong><br><em>The upcoming CwlViews library offers a syntax for constructing views that has a profound effect on the Cocoa…</em>www.cocoawithlove.com</a></p>
<h2 id="16-Atomic-Spin"><a href="#16-Atomic-Spin" class="headerlink" title="16. Atomic Spin"></a>16. Atomic Spin</h2><p>I really enjoy reading blog posts from Atomic Object. There are posts for many platforms, and about life, so you need to filter for iOS development.<br><a href="https://spin.atomicobject.com/"><strong>Atomic Spin</strong><br><em>More and more studies have shown that the most effective teams are the ones whose members trust each other and feel…</em>spin.atomicobject.com</a></p>
<h2 id="17-Raizlabs"><a href="#17-Raizlabs" class="headerlink" title="17. Raizlabs"></a>17. Raizlabs</h2><p>This has very good articles about iOS. Highly recommend.<br><a href="https://www.raizlabs.com/dev/"><strong>React Native Animations: Part 2 - RaizException - Raizlabs Developer Blog</strong><br><em>When we build apps for our clients, beautiful designs and interactions are important. But equally important is…</em>www.raizlabs.com</a></p>
<h2 id="18-Invasive-Code"><a href="#18-Invasive-Code" class="headerlink" title="18. Invasive Code"></a>18. Invasive Code</h2><p>This has topics for many iOS features. All the contents are good and succinct.<br><a href="https://www.invasivecode.com/weblog/"><strong>iOS Development - <em>Computer Vision iOS Apps</em></strong><br>Computer Vision iOS Appswww.invasivecode.com</a></p>
<h2 id="19-Think-and-Build"><a href="#19-Think-and-Build" class="headerlink" title="19. Think and Build"></a>19. Think and Build</h2><p>I like posts about animation and replicating app features. This has all of them.</p>
<p><a href="http://www.thinkandbuild.it/">http://www.thinkandbuild.it/</a></p>
<h2 id="20-Little-Bites-of-Cocoa"><a href="#20-Little-Bites-of-Cocoa" class="headerlink" title="20. Little Bites of Cocoa"></a>20. Little Bites of Cocoa</h2><p>This has a series of small tips, on how to use iOS SDKs and other 3rd frameworks. Good to know.<br><a href="https://littlebitesofcocoa.com/"><strong>Little Bites of Cocoa - Tips and techniques for iOS and Mac development - Weekday mornings at 9:42…</strong><br><em>Tips and techniques for iOS and Mac development - Weekday mornings at 9:42 AM. The goal of each of these ‘bites’ is to…</em>littlebitesofcocoa.com</a></p>
<h2 id="21-Samwize"><a href="#21-Samwize" class="headerlink" title="21. Samwize ()"></a>21. Samwize ()</h2><p>All the posts are good, short and to the points. Really like this.<br><a href="http://samwize.com/"><strong>@samwize</strong><br><em>¯_(ツ)_/¯</em>samwize.com</a></p>
<p>I think that’s enough. Feel free to share and suggest other awesome blogs that I might miss. Also, it’s good to contribute back to community by writing your blog posts. You will learn a lot by sharing.</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-05-23T14:46:25.000Z" title="2019-05-23T14:46:25.000Z">2019-05-23</time><span class="level-item">an hour read (About 6685 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/Learn-iOS-best-practices-by-building-a-simple-recipes-app/">Learn iOS best practices by building a simple recipes app</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/258">#258</a></strong></p>
<p>I started iOS development when iOS 7 had been announced. And I have learned a bit, through working, advice from colleagues and the iOS community.</p>
<p>In this article, I’d like to share a lot of good practices by taking the example of a simple recipes app. The source code is at GitHub <a href="https://github.com/onmyway133/recipes">Recipes</a>.</p>
<p>The app is a traditional master detail application that showcases a list of recipes together with their detailed information.</p>
<p>There are thousands of ways to solve a problem, and the way a problem is tackled also depends on personal taste. Hopefully, throughout this article you’ll learn something useful — I did learn a lot when I did this project.</p>
<p>I’ve added links to some keywords where I felt further reading would be beneficial. So definitely check them out. Any feedback is welcome.</p>
<p>So let’s get started…</p>
<p>Here is a high level overview of what you’ll be building.</p>
<p><img src="https://user-images.githubusercontent.com/2284279/58270863-09cf0880-7d8b-11e9-9619-44db3dad5709.png" alt="1"></p>
<h2 id="Getting-started"><a href="#Getting-started" class="headerlink" title="Getting started"></a>Getting started</h2><p>Let’s decide on the tool and project settings that we use.</p>
<h3 id="Xcode-and-Swift-version"><a href="#Xcode-and-Swift-version" class="headerlink" title="Xcode and Swift version"></a>Xcode and Swift version</h3><p>At <a href="https://developer.apple.com/videos/wwdc2018/">WWDC 2018</a>, Apple introduced Xcode 10 with Swift 4.2. However, at the time of writing, Xcode 10 is still in beta 5. So let’s stick with the stable Xcode 9 and Swift 4.1. Xcode 4.2 has some cool features — you can play with it through this awesome <a href="https://github.com/ole/whats-new-in-swift-4-2">Playground</a>. It does <strong>not</strong> introduce huge changes from Swift 4.1, so we can easily update our app in the near future if required.</p>
<p>You should set the Swift version in the Project setting instead of the target settings. This means all targets in the project share the same Swift version (4.1).</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*Lxby_2mEek2-H50j3hYFEA.png" alt=""></p>
<h3 id="Minimum-iOS-version-to-support"><a href="#Minimum-iOS-version-to-support" class="headerlink" title="Minimum iOS version to support"></a>Minimum iOS version to support</h3><p>As of summer 2018, iOS 12 is in public beta 5 and we can’t target iOS 12 without Xcode 10. In this post, we use Xcode 9 and the base SDK is iOS 11. Depending on the requirement and user bases, some apps need to support old iOS versions. Although iOS users tend to adopt new iOS versions faster than those who use Android, there are a some that stay with old versions. According to Apples advice, we need to support the <strong>two most recent versions</strong>, which are iOS 10 and iOS 11. As <a href="https://developer.apple.com/support/app-store/">measured by the App Store</a> on May 31, 2018, only 5% of users use iOS 9 and prior.</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*yxSupQXoYTO_laZs8uZe8g.png" alt=""></p>
<p>Targeting new iOS versions means we can take advantages of new SDKs, which Apple engineers improve every year. The <a href="https://developer.apple.com/documentation/uikit/views_and_controls?changes=latest_minor">Apple developer website</a> has an improved change log view. Now it is easier to see what has been added or modified.</p>
<p><img src="https://cdn-images-1.medium.com/max/2190/1*bOAc6e_guz5Bf10CT-Av1Q.png" alt=""></p>
<p>Ideally, to determine when to drop support for old iOS versions, we need analytics about how users use our app.</p>
<h3 id="Organising-the-Xcode-project"><a href="#Organising-the-Xcode-project" class="headerlink" title="Organising the Xcode project"></a>Organising the Xcode project</h3><p>When we create the new project, select both “Include Unit Tests” and “Include UI Tests” as it a recommended practice to write tests early. Recent changes to the XCTest framework, especially in UI Tests, make testing a breeze and are pretty stable.</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*QMr3U0naiK_YbuDKJydcrg.png" alt=""></p>
<p>Before adding new files to the project, take a pause and think about the structure of your app. How do we want to organize the files? We have a few options. We can organize files by feature/module or role/types. Each has its pros and cons and I’ll discuss them below.</p>
<p><strong>By role/type:</strong></p>
<ul>
<li><p><strong>Pros</strong>: There is less thinking involved about where to put files. It’s also easier to apply scripts or filters.</p>
</li>
<li><p><strong>Cons</strong>: It’s hard to correlate if we would want to find multiple files related to the same feature. It would also take time to reorganise files if we want to make them into reusable components in the future.</p>
</li>
</ul>
<p><strong>By feature/module</strong></p>
<ul>
<li><p><strong>Pros</strong>: It makes everything modular and encourages composition.</p>
</li>
<li><p><strong>Cons</strong>: It may get messy when many files of different types are bundled together.</p>
</li>
</ul>
<h3 id="Staying-modular"><a href="#Staying-modular" class="headerlink" title="Staying modular"></a><strong>Staying modular</strong></h3><p>Personally, I try to organize my code by features/components as much as possible. This makes it easier to identify related code to fix, and to add new features easier in the future. It answers the question “What does this app do?” instead of “What is this file?” <a href="http://merowing.info/2014/03/subjective-guide-to-writing-ios-apps-part-1-introduction/">Here is a good article regarding this</a>.</p>
<p>A good rule of thumb is to stay consistent, no matter which structure you choose. 👍</p>
<h2 id="Recipes-app-structure"><a href="#Recipes-app-structure" class="headerlink" title="Recipes app structure"></a>Recipes app structure</h2><p>The following is the app structure that our recipe app uses:</p>
<h3 id="Source"><a href="#Source" class="headerlink" title="Source"></a><strong>Source</strong></h3><p>Contains source code files, split into components:</p>
<ul>
<li><p><strong>Features:</strong> the main features in the app</p>
</li>
<li><p><strong>Home:</strong> the home screen, showing a list of recipes and an open search</p>
</li>
<li><p><strong>List:</strong> shows a list of recipes, including reloading a recipe and showing an empty view when a recipe does not exist</p>
</li>
<li><p><strong>Search:</strong> handle search and debouncing</p>
</li>
<li><p><strong>Detail:</strong> shows detail information</p>
</li>
</ul>
<h3 id="Library"><a href="#Library" class="headerlink" title="Library"></a><strong>Library</strong></h3><p>Contains the core components of our application:</p>
<ul>
<li><p><strong>Flow:</strong> contains FlowController to manage flows</p>
</li>
<li><p><strong>Adapter:</strong> generic data source for UICollectionView</p>
</li>
<li><p><strong>Extension:</strong> convenient extensions for common operations</p>
</li>
<li><p><strong>Model:</strong> The model in the app, parsed from JSON</p>
</li>
</ul>
<h3 id="Resource"><a href="#Resource" class="headerlink" title="Resource"></a><strong>Resource</strong></h3><p>Contains plist, resource, and Storyboard files.</p>
<h2 id="Code-conventions"><a href="#Code-conventions" class="headerlink" title="Code conventions"></a>Code conventions</h2><p>I agree with most of the style guides in <a href="https://github.com/raywenderlich/swift-style-guide">raywenderlich/swift-style-guide</a> and <a href="https://github.com/github/swift-style-guide">github/swift-style-guide</a>. These are straightforward and reasonable to use in a Swift project. Also, check out the official <a href="https://swift.org/documentation/api-design-guidelines/">API Design Guidelines</a> made by the Swift team at Apple on how to write better Swift code.</p>
<p>Whichever style guide you choose to follow, <strong>code clarity</strong> must be your most important goal.</p>
<p>Indentation and the tab-space war is a sensitive topic, but again, it depends on taste. I use four spaces indentation in Android projects, and two spaces in iOS and React. In this Recipes app, I follow consistent and easy-to-reason indentation, which I have written about <a href="https://medium.com/fantageek/indenting-swift-code-a55b04cc3a64">here</a> and <a href="https://medium.com/fantageek/using-camelcase-for-abbreviations-232eb67d872">here</a>.</p>
<h3 id="Documentation"><a href="#Documentation" class="headerlink" title="Documentation"></a>Documentation</h3><p>Good code should explain itself clearly so you don’t need to write comments. If a chunk of code is hard to understand, it’s good to take a pause and refactor it to some methods with descriptive names so it’s the chunk of code is more clear to understand. However, I find documenting classes and methods are also good for your coworkers and future self. According to the <a href="https://swift.org/documentation/api-design-guidelines/">Swift API design guidelines</a>,</p>
<p><strong>Write a documentation comment</strong> for every declaration. Insights gained by writing documentation can have a profound impact on your design, so don’t put it off.</p>
<p>It’s very easy to generate comment template /// in Xcode with Cmd+Alt+/ . If you plan to refactor your code to a framework to share with others in the future, tools like <a href="https://github.com/realm/jazzy">jazzy</a> can generate documentation so other people can follow along.</p>
<h3 id="Marking-sections-of-code"><a href="#Marking-sections-of-code" class="headerlink" title="Marking sections of code"></a>Marking sections of code</h3><p>The use of MARK can be helpful to separate sections of code. It also groups functions nicely in the Navigation Bar. You can also use extension groups, related properties and methods.</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*Jyoy2lvz2w5xKo-fIUJTMw.png" alt=""></p>
<p>For a simple UIViewController we can possible define the following MARKs:</p>
<pre><code>// MARK: - Init
// MARK: - View life cycle
// MARK: - Setup
// MARK: - Action
// MARK: - Data</code></pre><h3 id="Source-control"><a href="#Source-control" class="headerlink" title="Source control"></a>Source control</h3><p>Git is a popular source control system right now. We can use the template .gitignore file from <a href="https://www.gitignore.io/api/swift">gitignore.io/api/swift</a>. There are both pros and cons in <a href="https://guides.cocoapods.org/using/using-cocoapods#should-i-check-the-pods-directory-into-source-control">checking in dependencies</a> files (CocoaPods and Carthage). It depends on your project, but I tend to not commit dependencies (node_modules, Carthage, Pods) in source control to not clutter the code base. It also makes reviewing Pull requests easier.</p>
<p>Whether or not you check in the Pods directory, the Podfile and Podfile.lock should <strong>always</strong> be kept under version control.</p>
<p>I use both iTerm2 to execute commands and <a href="https://www.sourcetreeapp.com/">Source Tree</a> to view branches and staging.</p>
<h3 id="Dependencies"><a href="#Dependencies" class="headerlink" title="Dependencies"></a>Dependencies</h3><p>I have used third party frameworks, and also made and contributed to <a href="https://github.com/onmyway133/blog/issues/5">open source</a> a lot. Using a <a href="https://github.com/onmyway133/blog/issues/105">framework</a> gives you a <a href="https://github.com/onmyway133/blog/issues/85">boost</a> at the start, but it can also limit you a lot in the future. There may be some trivial changes that are very hard to work around. The same thing happens when using <a href="https://medium.com/fantageek/dear-sdk-developers-d8e1434fb702">SDKs</a>. My preference is to pick active open source frameworks. Read the source code and check frameworks carefully, and consult with your team if you plan to use them. A bit of extra caution does no harm.</p>
<p>In this app, I try to use as few dependencies as possible. Just enough to demonstrate how to manage dependencies. Some experienced developers may prefer <a href="https://github.com/Carthage/Carthage">Carthage</a>, a dependency manager as it gives you complete control. Here I choose <a href="https://github.com/CocoaPods/CocoaPods">CocoaPods</a> because its easy to use, and it has worked great so far.</p>
<p>There’s a file called .swift-version of value 4.1 in the root of the project to tell CocoaPods that this project uses Swift 4.1. This looks simple but took me quite some time to figure out. ☹️</p>
<h2 id="Getting-into-the-project"><a href="#Getting-into-the-project" class="headerlink" title="Getting into the project"></a>Getting into the project</h2><p>Let’s craft some launch images and icons to give the project a nice look.</p>
<h3 id="API"><a href="#API" class="headerlink" title="API"></a>API</h3><p>The easy way to learn iOS networking is through public free API services. Here I use food2fork. You can register for an account at <a href="http://food2fork.com/about/api">http://food2fork.com/about/api</a>. There are many other awesome APIs in this <a href="https://github.com/toddmotto/public-apis">public-api</a> repository.</p>
<p>It’s good to keep your credentials in a safe place. I use <a href="https://1password.com/">1Password</a> to generate and store my passwords.</p>
<p>Before we start coding, let’s play with the APIs to see which kinds of requests they require and responses they return. I use the <a href="https://github.com/getinsomnia/insomnia">Insomnia</a> tool to test and analyze API responses. It’s open source, free, and works great. 👍</p>
<p><img src="https://cdn-images-1.medium.com/max/3104/1*yAm50k67Ql-XW0LT3NM-2g.png" alt=""></p>
<h3 id="Launch-screen"><a href="#Launch-screen" class="headerlink" title="Launch screen"></a>Launch screen</h3><p>The first impression is important, so is the Launch Screen. The preferred way is using LaunchScreen.storyboard instead of a static Launch image.</p>
<p>To add a launch image to Asset Catalog, open LaunchScreen.storyboard, add UIImageView , and pin it to the edges of UIView. We should not pin the image to the Safe Area as we want the image to be full screen. Also, unselect any margins in the Auto Layout constraints. Set the contentMode of the UIImageView as Aspect Fill so it stretches with the correct aspect ratio.</p>
<p><img src="https://cdn-images-1.medium.com/max/2334/1*9s_8LJhoTgMpeosbuQrAUQ.png" alt="Configure layout in LaunchScreen."><em>Configure layout in LaunchScreen.</em></p>
<h3 id="App-icon"><a href="#App-icon" class="headerlink" title="App icon"></a>App icon</h3><p>A good practice is to provide all the necessary app icons for each device that you support, and also for places like Notification, Settings, and Springboard. Make sure each image has no transparent pixels, otherwise it results in a black background. This tip is from <a href="https://developer.apple.com/ios/human-interface-guidelines/icons-and-images/app-icon/">Human Interface Guidelines - App Icon</a>.</p>
<p><strong>Keep the background simple and avoid transparency</strong>. Make sure your icon is opaque, and don’t clutter the background. Give it a simple background so it doesn’t overpower other app icons nearby. You don’t need to fill the entire icon with content.</p>
<p>We need to design square images with a size greater than 1024 x 1024 so each is able to downscale to smaller images. You can do this by hand, script, or use this small <a href="https://github.com/onmyway133/IconGenerator">IconGenerator</a> app that I made.</p>
<p>The IconGenerator app can generate icons for iOS in iPhone, iPad, macOS and watchOS apps. The result is the AppIcon.appiconset that we can drag right into the Asset Catalog. Asset Catalog is the way to go for modern Xcode projects.</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*GPAQUNsbFs7xu-JmL6fLIw.png" alt=""></p>
<h3 id="Linting-code-with-SwiftLint"><a href="#Linting-code-with-SwiftLint" class="headerlink" title="Linting code with SwiftLint"></a>Linting code with SwiftLint</h3><p>Regardless of what platform we develop on, it’s good to have a linter to enforce consistent conventions. The most popular tool for Swift projects is <a href="https://github.com/realm/SwiftLint">SwiftLint</a>, made by the awesome people at <a href="https://realm.io/">Realm</a>.</p>
<p>To install it, add pod ‘SwiftLint’, ‘~&gt; 0.25’ to the Podfile. It’s also a good practice to specify the <a href="https://guides.cocoapods.org/syntax/podfile.html#pod">version</a> of the dependencies so pod install won’t accidentally update to a major version that could break your app. Then add a .swiftlint.yml with your preferred configuration. A sample configuration can be found <a href="https://github.com/realm/SwiftLint/blob/master/.swiftlint.yml">here</a>.</p>
<p>Finally, add a new Run Script Phrase to execute swiftlint after compiling.</p>
<p><img src="https://cdn-images-1.medium.com/max/2280/1*ySIPs3Y_Y6dgIEhGSuAVjQ.png" alt=""></p>
<h3 id="Type-safe-resource"><a href="#Type-safe-resource" class="headerlink" title="Type-safe resource"></a>Type-safe resource</h3><p>I use <a href="https://github.com/mac-cain13/R.swift">R.swift</a> to safely manage resources. It can generate type-safe classes to access font, localisable strings, and colors. Whenever we change resource file names, we get compile errors instead of a implicit crash. This prevents us inferring with resources that are actively in use.</p>
<pre><code>imageView.image = R.image.notFound()</code></pre><h2 id="Show-me-the-code"><a href="#Show-me-the-code" class="headerlink" title="Show me the code"></a>Show me the code</h2><p>Let’s dive into the code, starting with the model, flow controllers and service classes.</p>
<h3 id="Designing-the-model"><a href="#Designing-the-model" class="headerlink" title="Designing the model"></a>Designing the model</h3><p>It may sound boring but clients are just a prettier way to represent the API response. The model is perhaps the most basic thing and we use it a lot in the app. It plays such an important role but there can be some obvious bugs related to malformed models and assumptions about how a model should be parsed that need to be considered.</p>
<p>We should test for every model of the app. Ideally, we need automated testing of models from API responses in case the model has changed from the backend.</p>
<p>Starting from Swift 4.0, we can conform our model to <a href="https://developer.apple.com/documentation/swift/codable">Codable</a> to easily serialise to and from JSON. Our Model should be immutable:</p>
<pre><code>struct Recipe: Codable {
  let publisher: String
  let url: URL
  let sourceUrl: String
  let id: String
  let title: String
  let imageUrl: String
  let socialRank: Double
  let publisherUrl: URL

enum CodingKeys: String, CodingKey {
    case publisher
    case url = &quot;f2f_url&quot;
    case sourceUrl = &quot;source_url&quot;
    case id = &quot;recipe_id&quot;
    case title
    case imageUrl = &quot;image_url&quot;
    case socialRank = &quot;social_rank&quot;
    case publisherUrl = &quot;publisher_url&quot;
  }
}</code></pre><p>We can use some test frameworks if you like fancy syntax or an RSpec style. Some third party test frameworks may have issues. I find XCTest good enough.</p>
<pre><code>import XCTest
@testable import Recipes

class RecipesTests: XCTestCase {
  func testParsing() throws {
    let json: [String: Any] = [
      &quot;publisher&quot;: &quot;Two Peas and Their Pod&quot;,
      &quot;f2f_url&quot;: &quot;http://food2fork.com/view/975e33&quot;,
      &quot;title&quot;: &quot;No-Bake Chocolate Peanut Butter Pretzel Cookies&quot;,
      &quot;source_url&quot;: &quot;http://www.twopeasandtheirpod.com/no-bake-chocolate-peanut-butter-pretzel-cookies/&quot;,
      &quot;recipe_id&quot;: &quot;975e33&quot;,
      &quot;image_url&quot;: &quot;http://static.food2fork.com/NoBakeChocolatePeanutButterPretzelCookies44147.jpg&quot;,
      &quot;social_rank&quot;: 99.99999999999974,
      &quot;publisher_url&quot;: &quot;http://www.twopeasandtheirpod.com&quot;
    ]

let data = try JSONSerialization.data(withJSONObject: json, options: [])
    let decoder = JSONDecoder()
    let recipe = try decoder.decode(Recipe.self, from: data)

XCTAssertEqual(recipe.title, &quot;No-Bake Chocolate Peanut Butter Pretzel Cookies&quot;)
    XCTAssertEqual(recipe.id, &quot;975e33&quot;)
    XCTAssertEqual(recipe.url, URL(string: &quot;http://food2fork.com/view/975e33&quot;)!)
  }
}</code></pre><h3 id="Better-navigation-with-FlowController"><a href="#Better-navigation-with-FlowController" class="headerlink" title="Better navigation with FlowController"></a>Better navigation with FlowController</h3><p>Before, I used <a href="https://github.com/hyperoslo/Compass">Compass</a> as a <a href="https://medium.com/flawless-app-stories/url-routing-with-compass-d59c0061e7e2">routing engine</a> in my projects, but over time I’ve found that writing simple Routing code works too.</p>
<p>The FlowController is used to manage many UIViewController related components to a common feature. You may want to read <a href="https://github.com/onmyway133/blog/issues/106">FlowController and Coordinator</a> for other use cases and to get a better understanding.</p>
<p>There is the AppFlowController that manages changing rootViewController. For now it starts the RecipeFlowController.</p>
<pre><code>window = UIWindow(frame: UIScreen.main.bounds)
window?.rootViewController = appFlowController
window?.makeKeyAndVisible()
appFlowController.start()</code></pre><p>RecipeFlowController manages (in fact it is) the UINavigationController, that handles pushing HomeViewController, RecipesDetailViewController, SafariViewController.</p>
<pre><code>final class RecipeFlowController: UINavigationController {
  /// Start the flow
  func start() {
    let service = RecipesService(networking: NetworkService())
    let controller = HomeViewController(recipesService: service)
    viewControllers = [controller]
    controller.select = { [weak self] recipe in
      self?.startDetail(recipe: recipe)
    }
  }

private func startDetail(recipe: Recipe) {}
  private func startWeb(url: URL) {}
}</code></pre><p>The UIViewController can use delegate or closure to notify FlowController about changes or next screens in the flow. For delegate there may be a need to check when there are <strong>two</strong> instances of the same class. Here we use closurefor simplicity.</p>
<h3 id="Auto-Layout"><a href="#Auto-Layout" class="headerlink" title="Auto Layout"></a>Auto Layout</h3><p>Auto Layout has been around since iOS 5, it gets better each year. Although some people still have a problem with it, mostly because of confusing breaking constraints and performance, but personally, I find Auto Layout to be good enough.</p>
<p>I try to use Auto Layout as much as possible to make an adaptive UI. We can use libraries like <a href="https://github.com/onmyway133/Anchors">Anchors</a> to do declarative and fast Auto Layout. However in this app, we’ll just use the NSLayoutAnchor since it is from iOS 9. The code below is inspired by <a href="https://github.com/hyperoslo/Sugar/blob/master/Sources/iOS/Constraint.swift">Constrain</a>t. Remember that Auto Layout in its simplest form involves toggling translatesAutoresizingMaskIntoConstraints and activating isActive constraints.</p>
<pre><code>extension NSLayoutConstraint {
  static func activate(_ constraints: [NSLayoutConstraint]) {
    constraints.forEach {
      ($0.firstItem as? UIView)?.translatesAutoresizingMaskIntoConstraints = false
      $0.isActive = true
    }
  }
}</code></pre><p>There are actually many other layout engines available on GitHub. To get a sense over which one would be suitable to use, check out the <a href="https://github.com/layoutBox/LayoutFrameworkBenchmark">LayoutFrameworkBenchmark</a>.</p>
<p><img src="https://cdn-images-1.medium.com/max/2298/1*f8NMEsKqs6n8llxFR8WGuw.png" alt=""></p>
<h3 id="Architecture"><a href="#Architecture" class="headerlink" title="Architecture"></a>Architecture</h3><p>Architecture is probably the most hyped and discussed topic. I’m a fan of exploring architectures, you can view more posts and frameworks about different architectures <a href="https://github.com/onmyway133/fantastic-ios-architecture">here</a>.</p>
<p>To me, all architectures and patterns define roles for each object and how to connect them. Remember these guiding principles for your choice of architecture:</p>
<ul>
<li><p>encapsuate what varies</p>
</li>
<li><p>favor composition over inheritance</p>
</li>
<li><p>program to interface, not to implementation</p>
</li>
</ul>
<p>After playing around with many different architectures, with and without Rx, I found out that simple MVC is good enough. In this simple project, there is just UIViewController with logic encapsulated in helper Service classes,</p>
<h3 id="Massive-View-Controller"><a href="#Massive-View-Controller" class="headerlink" title="Massive View Controller"></a>Massive View Controller</h3><p>You may have heard people joking about how massive UIViewController is, but in reality, there is no massive view controller. It’s just us writing bad code. However there are ways to <a href="http://khanlou.com/2014/09/8-patterns-to-help-you-destroy-massive-view-controller/">slim</a> it down.</p>
<p>In the recipes app I use,</p>
<ul>
<li><p>Service to inject into the view controller to perform a single task</p>
</li>
<li><p>Generic View to move view and controls declaration to the View layer</p>
</li>
<li><p>Child view controller to compose child view controllers to build more features</p>
</li>
</ul>
<p><a href="http://khanlou.com/2014/09/8-patterns-to-help-you-destroy-massive-view-controller/">Here</a> is a very good article with 8 tips to slim down big controllers.</p>
<h3 id="Access-Control"><a href="#Access-Control" class="headerlink" title="Access Control"></a>Access Control</h3><p>The SWIFT <a href="https://developer.apple.com/library/content/documentation/Swift/Conceptual/Swift_Programming_Language/AccessControl.html">documentation</a> mentions that “access control restricts access to parts of your code from code in other source files and modules. This feature enables you to hide the implementation details of your code, and to specify a preferred interface through which that code can be accessed and used.”</p>
<p>Everything should be private and final by default. This also helps the <a href="https://developer.apple.com/swift/blog/?id=27">compiler</a>. When seeing a public property, we need to search for it across the project before doing anything further with it. If the property is used only within a class, making it private means we don’t need to care if it breaks elsewhere.</p>
<p>Declare properties as final where possible.</p>
<pre><code>final class HomeViewController: UIViewController {}</code></pre><p>Declare properties as private or at least private(set).</p>
<pre><code>final class RecipeDetailView: UIView {
  private let scrollableView = ScrollableView()
  private(set) lazy var imageView: UIImageView = self.makeImageView()
}</code></pre><h3 id="Lazy-properties"><a href="#Lazy-properties" class="headerlink" title="Lazy properties"></a>Lazy properties</h3><p>For properties that can be accessed at a later time, we can declare them as lazyand can use closure for fast construction.</p>
<pre><code>final class RecipeCell: UICollectionViewCell {
  private(set) lazy var containerView: UIView = {
    let view = UIView()
    view.clipsToBounds = true
    view.layer.cornerRadius = 5
    view.backgroundColor = Color.main.withAlphaComponent(0.4)

return view
  }()
}</code></pre><p>We can also use make functions if we plan to reuse the same function for multiple properties.</p>
<pre><code>final class RecipeDetailView: UIView {
  private(set) lazy var imageView: UIImageView = self.makeImageView()

private func makeImageView() -&gt; UIImageView {
    let imageView = UIImageView()
    imageView.contentMode = .scaleAspectFill
    imageView.clipsToBounds = true
    return imageView
  }
}</code></pre><p>This also matches advice from <a href="https://swift.org/documentation/api-design-guidelines/">Strive for Fluent Usage</a>.</p>
<p>Begin names of factory methods with “make”, For example, x.makeIterator().</p>
<h3 id="Code-snippets"><a href="#Code-snippets" class="headerlink" title="Code snippets"></a>Code snippets</h3><p>Some code syntax is hard to remember. Consider using code snippets to auto generate code. This is supported by Xcode and is the preferred way by Apple engineers when they demo.</p>
<pre><code>if #available(iOS 11, *) {
  viewController.navigationItem.searchController = searchController
  viewController.navigationItem.hidesSearchBarWhenScrolling = false
} else {
  viewController.navigationItem.titleView = searchController.searchBar
}</code></pre><p>I made a <a href="https://github.com/hyperoslo/SwiftSnippets">repo</a> with some useful Swift snippets that many enjoy using.</p>
<h3 id="Networking"><a href="#Networking" class="headerlink" title="Networking"></a>Networking</h3><p>Networking in Swift is kind of a solved problem. There are tedious and error-prone tasks like parsing HTTP responses, handling request queues, handling parameter queries. I’ve seen bugs about PATCH requests, <a href="https://github.com/onmyway133/blog/issues/115">lowercased HTTP methods</a>, … We can just use <a href="https://github.com/Alamofire/Alamofire">Alamofire</a>. There’s no need to waste time here.</p>
<p>For this app, since it’s simple and to avoid unnecessary dependencies. We can just use URLSession directly. A resource usually contains URL, path, parameters and the HTTP method.</p>
<pre><code>struct Resource {
  let url: URL
  let path: String?
  let httpMethod: String
  let parameters: [String: String]
}</code></pre><p>A simple network service can just parse Resource to URLRequest and tells URLSession to execute</p>
<pre><code>final class NetworkService: Networking {
  @discardableResult func fetch(resource: Resource, completion: @escaping (Data?) -&gt; Void) -&gt; URLSessionTask? {
    guard let request = makeRequest(resource: resource) else {
      completion(nil)
      return nil
    }

let task = session.dataTask(with: request, completionHandler: { data, _, error in
      guard let data = data, error == nil else {
        completion(nil)
        return
      }

completion(data)
    })

task.resume()
    return task
  }
}</code></pre><p>Use dependency injection. Allow caller to specify URLSessionConfiguration. Here we make use of Swift default parameter to provide the most common option.</p>
<pre><code>init(configuration: URLSessionConfiguration = URLSessionConfiguration.default) {
  self.session = URLSession(configuration: configuration)
}</code></pre><p>I also use <a href="https://developer.apple.com/documentation/foundation/urlqueryitem">URLQueryItem</a> which was from iOS 8. It makes parsing parameters to query items nice and less tedious.</p>
<h3 id="How-to-test-Networking-code"><a href="#How-to-test-Networking-code" class="headerlink" title="How to test Networking code"></a>How to test Networking code</h3><p>We can use <a href="https://developer.apple.com/documentation/foundation/urlprotocol">URLProtocol</a> and <a href="https://developer.apple.com/documentation/foundation/urlcache">URLCache</a> to add a stub for network responses or we can use frameworks like <a href="https://github.com/kylef/Mockingjay">Mockingjay</a> which swizzles URLSessionConfiguration.</p>
<p>I myself prefer using the protocol to test. By using the protocol, the test can create a mock request to provide a stub response.</p>
<pre><code>protocol Networking {
  @discardableResult func fetch(resource: Resource, completion: @escaping (Data?) -&gt; Void) -&gt; URLSessionTask?
}

final class MockNetworkService: Networking {
  let data: Data
  init(fileName: String) {
    let bundle = Bundle(for: MockNetworkService.self)
    let url = bundle.url(forResource: fileName, withExtension: &quot;json&quot;)!
    self.data = try! Data(contentsOf: url)
  }

func fetch(resource: Resource, completion: @escaping (Data?) -&gt; Void) -&gt; URLSessionTask? {
    completion(data)
    return nil
  }
}</code></pre><h3 id="Implementing-cache-for-offline-support"><a href="#Implementing-cache-for-offline-support" class="headerlink" title="Implementing cache for offline support"></a>Implementing cache for offline support</h3><p>I used to contribute and use a library called <a href="https://github.com/hyperoslo/Cache">Cache</a> a lot. What we need from a good cache library is memory and disk cache, memory for fast access, disk for persistency. When we save, we save to both memory and disk. When we load, if memory cache fails, we load from disk, then update memory again. There are many advanced topics about cache like purging, expiry, access frequency. Have a read about them <a href="https://medium.com/hyperoslo/open-source-stories-from-cachable-to-generic-storage-in-cache-418d9a230d51">here</a>.</p>
<p>In this simple app, a homegrown cache service class is enough and a good way to learn how caching works. Everything in Swift can be converted to Data, so we can just save Data to cache. Swift 4 Codable can serialize object to Data.</p>
<p>The code below shows us how to use FileManager for disk cache.</p>
<pre><code>/// Save and load data to memory and disk cache
final class CacheService {

/// For get or load data in memory
  private let memory = NSCache&lt;NSString, NSData&gt;()

/// The path url that contain cached files (mp3 files and image files)
  private let diskPath: URL

/// For checking file or directory exists in a specified path
  private let fileManager: FileManager

/// Make sure all operation are executed serially
  private let serialQueue = DispatchQueue(label: &quot;Recipes&quot;)

init(fileManager: FileManager = FileManager.default) {
    self.fileManager = fileManager
    do {
      let documentDirectory = try fileManager.url(
        for: .documentDirectory,
        in: .userDomainMask,
        appropriateFor: nil,
        create: true
      )
      diskPath = documentDirectory.appendingPathComponent(&quot;Recipes&quot;)
      try createDirectoryIfNeeded()
    } catch {
      fatalError()
    }
  }

func save(data: Data, key: String, completion: (() -&gt; Void)? = nil) {
    let key = MD5(key)

serialQueue.async {
      self.memory.setObject(data as NSData, forKey: key as NSString)
      do {
        try data.write(to: self.filePath(key: key))
        completion?()
      } catch {
        print(error)
      }
    }
  }
}</code></pre><p>To avoid malformed and very long file names, we can hash them. I use MD5 from <a href="https://github.com/onmyway133/SwiftHash">SwiftHash</a>, which gives dead simple usage let key = MD5(key).</p>
<h3 id="How-to-test-Cache"><a href="#How-to-test-Cache" class="headerlink" title="How to test Cache"></a>How to test Cache</h3><p>Since I design Cache operations to be asynchronous, we need to use test expectation. Remember to reset the state before each test so the previous test state does not interfere with the current test. The expectation in XCTestCase makes testing asynchronous code easier than ever. 👍</p>
<pre><code>class CacheServiceTests: XCTestCase {
  let service = CacheService()

override func setUp() {
    super.setUp()

try? service.clear()
  }

func testClear() {
    let expectation = self.expectation(description: #function)
    let string = &quot;Hello world&quot;
    let data = string.data(using: .utf8)!

service.save(data: data, key: &quot;key&quot;, completion: {
      try? self.service.clear()
      self.service.load(key: &quot;key&quot;, completion: {
        XCTAssertNil($0)
        expectation.fulfill()
      })
    })

wait(for: [expectation], timeout: 1)
  }
}</code></pre><h3 id="Loading-remote-Images"><a href="#Loading-remote-Images" class="headerlink" title="Loading remote Images"></a>Loading remote Images</h3><p>I also contribute to <a href="https://github.com/hyperoslo/Imaginary">Imaginary</a> so I know a bit about how it works. For remote images, we need to download and cache it, and the cache key is usually the URL of the remote image.</p>
<p>In our recipese app, let’s build a simple ImageService based on our NetworkService and CacheService. Basically an image is just a network resource that we download and cache. We prefer composition so we’ll include NetworkService and CacheService into ImageService.</p>
<pre><code>/// Check local cache and fetch remote image
final class ImageService {

private let networkService: Networking
  private let cacheService: CacheService
  private var task: URLSessionTask?

init(networkService: Networking, cacheService: CacheService) {
    self.networkService = networkService
    self.cacheService = cacheService
  }
}</code></pre><p>We usually have UICollectionViewand UITableView cells with UIImageView. And since cells are reused, we need to cancel any existing request task before making a new request.</p>
<pre><code>func fetch(url: URL, completion: @escaping (UIImage?) -&gt; Void) {
  // Cancel existing task if any
  task?.cancel()

// Try load from cache
  cacheService.load(key: url.absoluteString, completion: { [weak self] cachedData in
    if let data = cachedData, let image = UIImage(data: data) {
      DispatchQueue.main.async {
        completion(image)
      }
    } else {
      // Try to request from network
      let resource = Resource(url: url)
      self?.task = self?.networkService.fetch(resource: resource, completion: { networkData in
        if let data = networkData, let image = UIImage(data: data) {
          // Save to cache
          self?.cacheService.save(data: data, key: url.absoluteString)
          DispatchQueue.main.async {
            completion(image)
          }
        } else {
          print(&quot;Error loading image at \(url)&quot;)
        }
      })

self?.task?.resume()
    }
  })
}</code></pre><h3 id="Making-image-loading-more-convenient-for-UIImageView"><a href="#Making-image-loading-more-convenient-for-UIImageView" class="headerlink" title="Making image loading more convenient for UIImageView"></a>Making image loading more convenient for UIImageView</h3><p>Let’s add an extension to UIImageView to set the remote image from the URL. I use associated object to keep this ImageService and to cancel old requests. We make good use of associated object to attach ImageService to UIImageView. The point is to cancel the current request when the request is triggered again. This is handy when the image views are rendered in a scrolling list.</p>
<pre><code>extension UIImageView {
  func setImage(url: URL, placeholder: UIImage? = nil) {
    if imageService == nil {
      imageService = ImageService(networkService: NetworkService(), cacheService: CacheService())
    }

self.image = placeholder
    self.imageService?.fetch(url: url, completion: { [weak self] image in
      self?.image = image
    })
  }

private var imageService: ImageService? {
    get {
      return objc_getAssociatedObject(self, &amp;AssociateKey.imageService) as? ImageService
    }
    set {
      objc_setAssociatedObject(
        self,
        &amp;AssociateKey.imageService,
        newValue,
        objc_AssociationPolicy.OBJC_ASSOCIATION_RETAIN_NONATOMIC
      )
    }
  }
}</code></pre><h3 id="Generic-DataSource-for-UITableView-and-UICollectionView"><a href="#Generic-DataSource-for-UITableView-and-UICollectionView" class="headerlink" title="Generic DataSource for UITableView and UICollectionView"></a>Generic DataSource for UITableView and UICollectionView</h3><p>We use UITableView and UICollectionView in almost in every app and almost perform the same thing repeatedly.</p>
<ul>
<li><p>show refresh control while loading</p>
</li>
<li><p>reload list in case of data</p>
</li>
<li><p>show error in case of failure.</p>
</li>
</ul>
<p>There are many wrappers around UITableView and UICollection. Each adds another layer of abstraction, which gives us more power but applies restrictions at the same time.</p>
<p>In this app, I use Adapter to get a generic data source, to make a type safe collection. Because, in the end, all we need is to map from the model to the cells.</p>
<p>I also utilize <a href="https://github.com/hyperoslo/Upstream">Upstream</a> based on this idea. It’s hard to wrap around UITableView and UICollectionView, as many times, it is app specific, so a thin wrapper like Adapter is enough.</p>
<pre><code>final class Adapter&lt;T, Cell: UICollectionViewCell&gt;: NSObject,
UICollectionViewDataSource, UICollectionViewDelegateFlowLayout {
  var items: [T] = []
  var configure: ((T, Cell) -&gt; Void)?
  var select: ((T) -&gt; Void)?
  var cellHeight: CGFloat = 60
}</code></pre><h3 id="Controller-and-View"><a href="#Controller-and-View" class="headerlink" title="Controller and View"></a>Controller and View</h3><p>I ditched Storyboard because of many limitations and many issues. Instead, I use code to make views and define constraints. It is not that hard to follow. Most of the boilerplate code in UIViewController is for creating views and configuring the layout. Let’s move those to the view. You can read more about that <a href="https://github.com/onmyway133/blog/issues/37">here</a>.</p>
<pre><code>/// Used to separate between controller and view
class BaseController&lt;T: UIView&gt;: UIViewController {
  let root = T()

override func loadView() {
    view = root
  }
}

final class RecipeDetailViewController: BaseController&lt;RecipeDetailView&gt; {}</code></pre><h3 id="Handling-responsibilities-with-a-child-View-Controller"><a href="#Handling-responsibilities-with-a-child-View-Controller" class="headerlink" title="Handling responsibilities with a child View Controller"></a>Handling responsibilities with a child View Controller</h3><p>The View controller container is a powerful concept. Each view controller has a separation of concern and can be composed together to create advanced features. I have used RecipeListViewController to manage the UICollectionView and show a list of recipes.</p>
<pre><code>final class RecipeListViewController: UIViewController {
  private(set) var collectionView: UICollectionView!
  let adapter = Adapter&lt;Recipe, RecipeCell&gt;()
  private let emptyView = EmptyView(text: &quot;No recipes found!&quot;)
}</code></pre><p>There is the HomeViewController which embeds this RecipeListViewController</p>
<pre><code>/// Show a list of recipes
final class HomeViewController: UIViewController {

/// When a recipe get select
  var select: ((Recipe) -&gt; Void)?

private var refreshControl = UIRefreshControl()
  private let recipesService: RecipesService
  private let searchComponent: SearchComponent
  private let recipeListViewController = RecipeListViewController()
}</code></pre><h3 id="Composition-and-Dependency-Injection"><a href="#Composition-and-Dependency-Injection" class="headerlink" title="Composition and Dependency Injection"></a>Composition and Dependency Injection</h3><p>I try to build components and compose code whenever I can . We see that ImageService makes use of the NetworkService and CacheService, and RecipeDetailViewController makes use of Recipe and RecipesService</p>
<p>Ideally objects should not create dependencies by themselves. The dependencies should be created outside and passed down from <a href="http://blog.ploeh.dk/2011/07/28/CompositionRoot/">root</a>. In our app the root is AppDelegate and AppFlowController so dependencies should start from here.</p>
<h3 id="App-Transport-Security"><a href="#App-Transport-Security" class="headerlink" title="App Transport Security"></a>App Transport Security</h3><p><img src="https://cdn-images-1.medium.com/max/4000/0*tdRZmIGTGEEUmG87.jpg" alt=""></p>
<p>Since iOS 9, all apps should adopt <a href="https://developer.apple.com/library/content/releasenotes/General/WhatsNewIniOS/Articles/iOS9.html">App Transport Security</a></p>
<blockquote>
<p><em>App Transport Security (ATS) enforces best practices in the secure connections between an app and its back end. ATS prevents accidental disclosure, provides secure default behavior, and is easy to adopt; it is also on by default in iOS 9 and OS X v10.11. You should adopt ATS as soon as possible, regardless of whether you’re creating a new app or updating an existing one.</em></p>
</blockquote>
<p>In our app, some images are obtained over an HTTP connection. We need to exclude it from the security rule, but only for that domain only.</p>
<pre><code>&lt;key&gt;NSAppTransportSecurity&lt;/key&gt;
&lt;dict&gt;
  &lt;key&gt;NSExceptionDomains&lt;/key&gt;
  &lt;dict&gt;
    &lt;key&gt;food2fork.com&lt;/key&gt;
    &lt;dict&gt;
      &lt;key&gt;NSIncludesSubdomains&lt;/key&gt;
      &lt;true/&gt;
      &lt;key&gt;NSExceptionAllowsInsecureHTTPLoads&lt;/key&gt;
      &lt;true/&gt;
    &lt;/dict&gt;
  &lt;/dict&gt;
&lt;/dict&gt;</code></pre><h3 id="A-custom-Scrollable-View"><a href="#A-custom-Scrollable-View" class="headerlink" title="A custom Scrollable View"></a>A custom Scrollable View</h3><p>For the detail screen, we can use UITableView and UICollectionView with different cell types. Here, the views should be static. We can stack using UIStackView. For more flexibility, we can just use UIScrollView.</p>
<pre><code>/// Vertically layout view using Auto Layout in UIScrollView
final class ScrollableView: UIView {
  private let scrollView = UIScrollView()
  private let contentView = UIView()

override init(frame: CGRect) {
    super.init(frame: frame)

scrollView.showsHorizontalScrollIndicator = false
    scrollView.alwaysBounceHorizontal = false
    addSubview(scrollView)

scrollView.addSubview(contentView)

NSLayoutConstraint.activate([
      scrollView.topAnchor.constraint(equalTo: topAnchor),
      scrollView.bottomAnchor.constraint(equalTo: bottomAnchor),
      scrollView.leftAnchor.constraint(equalTo: leftAnchor),
      scrollView.rightAnchor.constraint(equalTo: rightAnchor),

contentView.topAnchor.constraint(equalTo: scrollView.topAnchor),
      contentView.bottomAnchor.constraint(equalTo: scrollView.bottomAnchor),
      contentView.leftAnchor.constraint(equalTo: leftAnchor),
      contentView.rightAnchor.constraint(equalTo: rightAnchor)
    ])
  }
}</code></pre><p>We pin the UIScrollView to the edges. We pin the contentView left and right anchor to self, while pinning the contentView top and bottom anchor to UIScrollView.</p>
<p>The views inside contentView have top and bottom constraints, so when they expand, they expand contentView as well. UIScrollView uses Auto Layout info from this contentView to determine its contentSize. Here is how ScrollableView is used in RecipeDetailView.</p>
<pre><code>scrollableView.setup(pairs: [
  ScrollableView.Pair(view: imageView, inset: UIEdgeInsets(top: 8, left: 0, bottom: 0, right: 0)),
  ScrollableView.Pair(view: ingredientHeaderView, inset: UIEdgeInsets(top: 8, left: 0, bottom: 0, right: 0)),
  ScrollableView.Pair(view: ingredientLabel, inset: UIEdgeInsets(top: 4, left: 8, bottom: 0, right: 0)),
  ScrollableView.Pair(view: infoHeaderView, inset: UIEdgeInsets(top: 4, left: 0, bottom: 0, right: 0)),
  ScrollableView.Pair(view: instructionButton, inset: UIEdgeInsets(top: 8, left: 20, bottom: 0, right: 20)),
  ScrollableView.Pair(view: originalButton, inset: UIEdgeInsets(top: 8, left: 20, bottom: 0, right: 20)),
  ScrollableView.Pair(view: infoView, inset: UIEdgeInsets(top: 16, left: 0, bottom: 20, right: 0))
])</code></pre><h3 id="Adding-search-functionality"><a href="#Adding-search-functionality" class="headerlink" title="Adding search functionality"></a>Adding search functionality</h3><p>From iOS 8 onwards, we can use the <a href="https://developer.apple.com/documentation/uikit/uisearchcontroller">UISearchController</a> to get a default search experience with the search bar and results controller. We’ll encapsuate search functionality into SearchComponent so that it can be pluggable.</p>
<pre><code>final class SearchComponent: NSObject, UISearchResultsUpdating, UISearchBarDelegate {
  let recipesService: RecipesService
  let searchController: UISearchController
  let recipeListViewController = RecipeListViewController()
}</code></pre><p>Starting from <a href="https://www.hackingwithswift.com/articles/5/how-to-adopt-ios-11-user-interface-changes-in-your-app">iOS 11</a>, there ‘s a property called searchController on the UINavigationItem which makes it easy to show the search bar on the navigation bar.</p>
<pre><code>func add(to viewController: UIViewController) {
  if #available(iOS 11, *) {
    viewController.navigationItem.searchController = searchController
    viewController.navigationItem.hidesSearchBarWhenScrolling = false
  } else {
    viewController.navigationItem.titleView = searchController.searchBar
  }

viewController.definesPresentationContext = true
}</code></pre><p>In this app, we need to disable hidesNavigationBarDuringPresentation for now, as it is quite buggy. Hopefully it gets resolved in future iOS updates.</p>
<h3 id="Understanding-Presentation-context"><a href="#Understanding-Presentation-context" class="headerlink" title="Understanding Presentation context"></a>Understanding Presentation context</h3><p>Understanding presentation context is crucial for view controller presentation. In search, we use the searchResultsController.</p>
<pre><code>self.searchController = UISearchController(searchResultsController: recipeListViewController)</code></pre><p>We need to use <a href="https://developer.apple.com/documentation/uikit/uiviewcontroller/1621456-definespresentationcontext">definesPresentationContext</a> on the source view controller (the view controller where we add the search bar into). Without this we get the searchResultsController to be presented over full screen !!!</p>
<blockquote>
<p><em>When using the currentContext or overCurrentContext style to present a view controller, this property controls which existing view controller in your view controller hierarchy is actually covered by the new content. When a context-based presentation occurs, UIKit starts at the presenting view controller and walks up the view controller hierarchy. If it finds a view controller whose value for this property is true, it asks that view controller to present the new view controller. If no view controller defines the presentation context, UIKit asks the window’s root view controller to handle the presentation.</em><br><em>The default value for this property is false. Some system-provided view controllers, such as UINavigationController, change the default value to true.</em></p>
</blockquote>
<h3 id="Debouncing-search-actions"><a href="#Debouncing-search-actions" class="headerlink" title="Debouncing search actions"></a>Debouncing search actions</h3><p>We should not execute search requests for every key stroke the user types in the search bar. Therefore some kind of throttling is needed. We can use DispatchWorkItem to encapsulate the action and send it to the queue. Later we can cancel it.</p>
<pre><code>final class Debouncer {
  private let delay: TimeInterval
  private var workItem: DispatchWorkItem?

init(delay: TimeInterval) {
    self.delay = delay
  }

/// Trigger the action after some delay
  func schedule(action: @escaping () -&gt; Void) {
    workItem?.cancel()
    workItem = DispatchWorkItem(block: action)
    DispatchQueue.main.asyncAfter(deadline: .now() + delay, execute: workItem!)
  }
}</code></pre><h3 id="Testing-debouncing-with-Inverted-expectation"><a href="#Testing-debouncing-with-Inverted-expectation" class="headerlink" title="Testing debouncing with Inverted expectation"></a>Testing debouncing with Inverted expectation</h3><p>To test Debouncer we can use XCTest expectation in <a href="https://developer.apple.com/documentation/xctest/xctestexpectation/2806573-isinverted">inverted</a> mode. Read more about it in <a href="https://www.swiftbysundell.com/posts/unit-testing-asynchronous-swift-code">Unit testing asynchronous Swift code</a>.</p>
<blockquote>
<p><em>To check that a situation does not occur during testing, create an expectation that is fulfilled when the unexpected situation occurs, and set its isInverted property to true. Your test will fail immediately if the inverted expectation is fulfilled.</em></p>
</blockquote>
<pre><code>class DebouncerTests: XCTestCase {
  func testDebouncing() {
    let cancelExpectation = self.expectation(description: &quot;cancel&quot;)
    cancelExpectation.isInverted = true

let completeExpectation = self.expectation(description: &quot;complete&quot;)
    let debouncer = Debouncer(delay: 0.3)

debouncer.schedule {
      cancelExpectation.fulfill()
    }

debouncer.schedule {
      completeExpectation.fulfill()
    }

wait(for: [cancelExpectation, completeExpectation], timeout: 1)
  }
}</code></pre><h3 id="Testing-user-interface-with-UITests"><a href="#Testing-user-interface-with-UITests" class="headerlink" title="Testing user interface with UITests"></a>Testing user interface with UITests</h3><p>Sometimes small refactoring can have a large effect. A disabled button can lead to unusable screens afterward. UITest helps ensuring integrity and functional aspects of the app. Test should be declarative. We can use the <a href="https://github.com/hyperoslo/tine-handel-ios/pull/318">Robot pattern</a>.</p>
<pre><code>class RecipesUITests: XCTestCase {
  var app: XCUIApplication!

  override func setUp() {
    super.setUp()
    continueAfterFailure = false

    app = XCUIApplication()
  }

  func testScrolling() {
    app.launch()

    let collectionView = app.collectionViews.element(boundBy: 0)
    collectionView.swipeUp()
    collectionView.swipeUp()
  }

  func testGoToDetail() {
    app.launch()

    let collectionView = app.collectionViews.element(boundBy: 0)
    let firstCell = collectionView.cells.element(boundBy: 0)
    firstCell.tap()
  }
}</code></pre><p>Here are some of my articles regarding testing.</p>
<ul>
<li><p><a href="https://hackernoon.com/running-uitests-with-facebook-login-in-ios-4ac998940c42">Running UITests with Facebook login in iOS</a></p>
</li>
<li><p><a href="https://medium.com/fantageek/testing-in-swift-with-given-when-then-pattern-cd1a4e1737f9">Testing in Swift with Given When Then pattern</a></p>
</li>
</ul>
<h3 id="Main-thread-guard"><a href="#Main-thread-guard" class="headerlink" title="Main thread guard"></a>Main thread guard</h3><p>Accessing the UI from the background queue can lead to potential problems. Earlier, I needed to use <a href="https://github.com/onmyway133/MainThreadGuard">MainThreadGuard</a>, now that Xcode 9 has <a href="https://developer.apple.com/documentation/code_diagnostics/main_thread_checker">Main Thread Checker</a>, I just enabled that in Xcode.</p>
<blockquote>
<p><em>The Main Thread Checker is a standalone tool for Swift and C languages that detects invalid usage of AppKit, UIKit, and other APIs on a background thread. Updating UI on a thread other than the main thread is a common mistake that can result in missed UI updates, visual defects, data corruptions, and crashes.</em></p>
</blockquote>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*DLKXooWl-av-vsT4-qnZtA.png" alt=""></p>
<h3 id="Measuring-performances-and-issues"><a href="#Measuring-performances-and-issues" class="headerlink" title="Measuring performances and issues"></a>Measuring performances and issues</h3><p>We can use <a href="https://developer.apple.com/library/content/documentation/DeveloperTools/Conceptual/InstrumentsUserGuide/index.html">Instruments</a> to thoroughly profile the app. For quick measurement, we can head over to the Debug Navigator tab and see CPU, Memory and Network usage. Check out <a href="https://medium.com/@kazmiekr/what-every-ios-developer-should-be-doing-with-instruments-d1661eeaf64f">this cool article</a> to learn more about instruments.</p>
<h3 id="Prototyping-with-Playground"><a href="#Prototyping-with-Playground" class="headerlink" title="Prototyping with Playground"></a>Prototyping with Playground</h3><p>Playground is the recommended way to prototype and build apps. At WWDC 2018, Apple introduced <a href="https://developer.apple.com/documentation/createml">Create ML</a> which supports Playground to train model. Check out <a href="https://medium.com/flawless-app-stories/playground-driven-development-in-swift-cf167489fe7b">this cool article</a> to learn more about playground driven development in Swift.</p>
<h2 id="Where-to-go-from-here"><a href="#Where-to-go-from-here" class="headerlink" title="Where to go from here"></a>Where to go from here</h2><p>Thanks for making it this far. I hope you’ve learnt something useful. The best way to learn something is to just do it. If you happen to write the same code again and again, make it as a component. If a problem gives you a hard time, write about it. Share your experience with the world, you will learn a lot.</p>
<hr>
<h2 id="Original-post-https-medium-freecodecamp-org-learn-ios-best-practices-by-building-a-simple-recipes-app-9bcbce4d10d"><a href="#Original-post-https-medium-freecodecamp-org-learn-ios-best-practices-by-building-a-simple-recipes-app-9bcbce4d10d" class="headerlink" title="Original post https://medium.freecodecamp.org/learn-ios-best-practices-by-building-a-simple-recipes-app-9bcbce4d10d"></a>Original post <a href="https://medium.freecodecamp.org/learn-ios-best-practices-by-building-a-simple-recipes-app-9bcbce4d10d">https://medium.freecodecamp.org/learn-ios-best-practices-by-building-a-simple-recipes-app-9bcbce4d10d</a></h2><p><strong>Updated at</strong> 2021-01-01 23:26:13</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-05-21T08:08:34.000Z" title="2019-05-21T08:08:34.000Z">2019-05-21</time><span class="level-item">a few seconds read (About 32 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-move-tab-bar-icons-down-in-iOS/">How to move tab bar icons down in iOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/250">#250</a></strong></p>
<p><code>UITabBarItem</code> subclasses from <code>UIBarItem</code> which has <code>imageInsets</code>. We need both <code>top</code> and <code>bottom</code> to avoid shrinking</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">viewController1.tabBarItem.imageInsets = <span class="type">UIEdgeInsets</span>(top: <span class="number">10</span>, <span class="keyword">left</span>: <span class="number">0</span>, bottom: -<span class="number">10</span>, <span class="keyword">right</span>: <span class="number">0</span>)</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-05-21T06:48:44.000Z" title="2019-05-21T06:48:44.000Z">2019-05-21</time><span class="level-item">a minute read (About 142 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-test-LaunchScreen-in-iOS/">How to test LaunchScreen in iOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/249">#249</a></strong></p>
<p>Making splash screen with <code>LaunchScreen.storyboard</code> is now the default way to do in iOS. Testing it with UITests is a bit tricky as this screen is showed the system, and if we test that, we are just testing the system.</p>
<p>What we should test is the content we put in the LaunchScreen storyboard. Is it showing correctly on different screen sizes? Is it missing any texts or images?</p>
<p>One way to test that is via Unit Test. LaunchScreen storyboard always come with 1 <code>UIViewController</code> configured as an initial view controller</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LauncScreenTests</span>: <span class="title">XCTestCase</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">testLaunchScreen</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">let</span> launchScreen = <span class="type">UIStoryboard</span>(name: <span class="string">"LaunchScreen"</span>, bundle: <span class="literal">nil</span>)</span><br><span class="line">        <span class="keyword">let</span> viewController = launchScreen.instantiateInitialViewController()!</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> label = viewController.view.subviews.compactMap(&#123; $<span class="number">0</span> <span class="keyword">as</span>? <span class="type">UILabel</span> &#125;).first!</span><br><span class="line">        <span class="type">XCTAssertEqual</span>(label.text, <span class="string">"Welcome to my app"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> imageView = viewController.view.subviews.compactMap(&#123; $<span class="number">0</span> <span class="keyword">as</span>? <span class="type">UIImageView</span> &#125;).first!</span><br><span class="line">        <span class="type">XCTAssertNotNil</span>(imageView.image)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-05-20T08:13:11.000Z" title="2019-05-20T08:13:11.000Z">2019-05-20</time><span class="level-item">a few seconds read (About 69 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-enable-black-mode-in-Google-Maps-in-iOS/">How to enable black mode in Google Maps in iOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/246">#246</a></strong></p>
<p>Use GMSMapStyle <a href="https://developers.google.com/maps/documentation/android-sdk/styling">https://developers.google.com/maps/documentation/android-sdk/styling</a><br>Export styling json from <a href="https://mapstyle.withgoogle.com/">https://mapstyle.withgoogle.com/</a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> mapStyleUrl = <span class="type">Bundle</span>.main.url(forResource: <span class="string">"mapStyle"</span>, withExtension: <span class="string">"json"</span>)!</span><br><span class="line">mapView.mapStyle = <span class="keyword">try</span>? <span class="type">GMSMapStyle</span>(contentsOfFileURL: mapStyleUrl)</span><br></pre></td></tr></table></figure>

<p>To change overall color, search for mostly <code>&quot;elementType&quot;: &quot;geometry&quot;</code> and <code>&quot;featureType&quot;: &quot;water&quot;</code></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"elementType"</span>: <span class="string">"geometry"</span>,</span><br><span class="line">    <span class="attr">"stylers"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"color"</span>: <span class="string">"#424242"</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"featureType"</span>: <span class="string">"water"</span>,</span><br><span class="line">    <span class="attr">"elementType"</span>: <span class="string">"geometry"</span>,</span><br><span class="line">    <span class="attr">"stylers"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"color"</span>: <span class="string">"#2E2E2E"</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-05-19T16:33:17.000Z" title="2019-05-19T16:33:17.000Z">2019-05-19</time><span class="level-item">17 minutes read (About 2510 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/Favorite-WWDC-2018-sessions/">Favorite WWDC 2018 sessions</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/245">#245</a></strong></p>
<p>Original post <a href="https://medium.com/fantageek/my-favourite-wwdc-2018-sessions-363d3fc9c9d5">https://medium.com/fantageek/my-favourite-wwdc-2018-sessions-363d3fc9c9d5</a></p>
<hr>
<h1 id="Favourite-WWDC-2018-sessions"><a href="#Favourite-WWDC-2018-sessions" class="headerlink" title="Favourite WWDC 2018 sessions"></a>Favourite WWDC 2018 sessions</h1><p>This year I failed the lottery ticket to WWDC, and I also missed the keynote live stream because I was <a href="https://twitter.com/onmyway133/status/1003584883116167169">sailing</a> on the Christian Radich outside Oslo fjord that day. Luckily all the videos are available on <a href="https://developer.apple.com/videos/wwdc2018/">Apple Developer site</a> very shortly, and we can watch them now on Chrome or the <a href="https://github.com/insidegui/WWDC">unofficial WWDC</a> app on macOS. I recommend the <a href="https://github.com/insidegui/WWDC">WWDC</a> macOS app as it allows to mark favourites and filter, also offers the ability to adjust play speed to 1.25 or 1.5 saves me some time watching.</p>
<p>This year WWDC focuses a lot on privacy, stability, and speed, which are all I wish, so many thanks to Apple engineers who made that happen, and the resit to install the so called <a href="https://twitter.com/bagelturf/status/1004444007424905216?s=21">more stable iOS 12</a> is real. As an iOS engineers, I like to focus more about the necessary things to me, that is about the Swift programming language, new changes in Cocoa Touch, enhancements in Xcode and testing tricks. I also like to explore more <a href="https://medium.com/flawless-app-stories/detecting-avengers-superheroes-in-your-ios-app-with-ibm-watson-and-coreml-fe38e493a4d1">about</a> <a href="https://medium.com/flawless-app-stories/machine-learning-in-ios-turi-create-and-coreml-5ddce0dc8e26">machine</a> <a href="https://medium.com/flawless-app-stories/machine-learning-in-ios-azure-custom-vision-and-coreml-645e93f35eee">learning</a> so I’m very glad that Apple is investing more into this technology with the introduction of Turi Create and Create ML.</p>
<p>To me, APIs come and get deprecated very often and it’s good to know them, but the most important thing is to invest in your programming, debugging and testing skill which you can apply in many other platforms.</p>
<p>Continued from last year <a href="https://medium.com/@onmyway133/my-favourite-wwdc-2017-sessions-a777fa5aabaf">favourites</a> list, below are my favourite sessions with personal notes. Things are listed in no particular order. Hope you find it useful.</p>
<h3 id="Platforms-State-of-the-Union"><a href="#Platforms-State-of-the-Union" class="headerlink" title="Platforms State of the Union"></a><a href="https://developer.apple.com/videos/play/wwdc2018/102/">Platforms State of the Union</a></h3><p>If you don’t have time, you should watch only this session. Platform State of the Union is like keynote for developers as it highlights important changes.</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/0*5zkWPlmZ9oYfY9-O.jpg" alt=""></p>
<ul>
<li><p>Privacy: Apple confirms on its commitment in privacy and security, also introduces password management feature and auto fill on iOS 12. Generating strong password, integrating with 3rd password management and quickly populating OTP field from SMS message have never been easier. <a href="https://support.apple.com/en-us/HT202491">GateKeeper</a> gets some improvements as well and begins to require app to be notarised.</p>
</li>
<li><p>iOS 12: huge improvement in performance, Siri gets smarter with Shortcut support, group calling in FaceTime and grouped notification. Also for emoji fan, Memoji was introduced.</p>
</li>
<li><p>macOS 10.14 Mojave: more with Dark Mode. They demo mostly with Xcode in dark mode, which looks so cool. This year WWDC banner give hints about iOS and macOS cross-platform apps, which is partially true with <a href="https://www.imore.com/marzipan">Marzipan</a>, a way to allow iOS apps to run on the mac.</p>
</li>
<li><p>Xcode 10: with improvements in code editing and source control changes bar indicator. Debugging with memory debug tool, LLDB performance enhancement and particular the new build system completely rewritten in Swift with parallel tasks are exciting news.</p>
</li>
<li><p>Swift 4.2: if you follow swift repo then <a href="https://github.com/ole/whats-new-in-swift-4-2">Swift 4.2</a> may not be very surprising. There are also announcements for Swift 5 plan.</p>
</li>
<li><p>Machine Learning: is never hotter than this. This year we see huge investments in machine learning with Create ML, Turi Create, Natural Language frameworks, CoreML 2, new detection capabilities in Vision.</p>
</li>
<li><p>ARKit 2, watchOS 5, tvOS 12, AppStore Connect and AppStore Connect APIs are some other important news you don’t want to miss.</p>
</li>
</ul>
<h3 id="What’s-new-in-Swift"><a href="#What’s-new-in-Swift" class="headerlink" title="What’s new in Swift"></a><a href="https://developer.apple.com/videos/play/wwdc2018/401/">What’s new in Swift</a></h3><p><img src="https://cdn-images-1.medium.com/max/2000/0*JQCScM5dRcK9dX-_.jpg" alt=""></p>
<p>Together with this session, I recommend you to read <a href="https://www.hackingwithswift.com/articles/77/whats-new-in-swift-4-2">What’s new in Swift 4.2</a> summary which is very succinct. Besides improvement in complication and runtime, Swift 4.2 offers some new features: iterable enum case, synthesised Equatable and Hashable, handy functions for shuffling, random generating. To me, the need to explicitly handle Implicitly unwrapped optional is also a reasonable change.</p>
<h3 id="What’s-New-in-Cocoa-Touch"><a href="#What’s-New-in-Cocoa-Touch" class="headerlink" title="What’s New in Cocoa Touch"></a><a href="https://developer.apple.com/videos/play/wwdc2018/202/">What’s New in Cocoa Touch</a></h3><p><img src="https://cdn-images-1.medium.com/max/2000/0*n1X4HddAZ-4ZHpaf.jpg" alt=""></p>
<p>This is a brief introduction to all changes coming to iOS 12, together with tips on how to be a good iOS citizen. Learn what can affect scrolling experience and prefetching technique, memory consumption and automatic backing stores, how to get the best from UIImage and UIImageView . <a href="https://developer.apple.com/videos/play/wwdc2018/220/">AutoLayout</a> engine got a lot of performance improvement so it won’t bother you any more. To me the most satisfying is to get all the UIKit notifications and classes reorganised under nested types, which makes code reasoning very easy.</p>
<h3 id="Getting-the-Most-out-of-Playgrounds-in-Xcode"><a href="#Getting-the-Most-out-of-Playgrounds-in-Xcode" class="headerlink" title="Getting the Most out of Playgrounds in Xcode"></a><a href="https://developer.apple.com/videos/play/wwdc2018/402/">Getting the Most out of Playgrounds in Xcode</a></h3><p><img src="https://cdn-images-1.medium.com/max/2000/0*cl4xdnHojOq-PNBc.jpg" alt=""></p>
<p>I’ve <a href="https://medium.com/flawless-app-stories/playground-driven-development-in-swift-cf167489fe7b">written about Playground</a> before and I’m very glad that Apple also invests a lot in it. The way people can interact and train model [Create ML](<a href="http://Introducing">http://Introducing</a> Create ML) in Playground is mesmerising. People may question how Playground works so well in session’s demos, but we can’t resist the new changes coming to Playground like Step by Step execution, markup rendering improvements and also how easy it is to consume custom frameworks. We can also now publish our own <a href="https://developer.apple.com/videos/play/wwdc2018/413/">Playground through subscription</a>.</p>
<h3 id="What’s-New-in-Core-ML"><a href="#What’s-New-in-Core-ML" class="headerlink" title="What’s New in Core ML"></a><a href="https://developer.apple.com/videos/play/wwdc2018/708/">What’s New in Core ML</a></h3><p><img src="https://cdn-images-1.medium.com/max/2000/0*1-xUL2gFr-Ys8WQT.jpg" alt=""></p>
<p>Apple starts the machine learning trend last year with the introduction of Core ML. We might be excited and frustrated at the same time as Core ML is powerful but there’s no way we can customise it. Now the <a href="https://developer.apple.com/videos/play/wwdc2018/708/">2</a> <a href="https://developer.apple.com/videos/play/wwdc2018/709/">parts</a> tell us how to implement custom layer and model, techniques to reduce model size like quantisation and flexible model. This makes the foundation for improvement in <a href="https://developer.apple.com/videos/play/wwdc2018/717/">Vision</a> in object tracking and the debut of <a href="https://developer.apple.com/videos/play/wwdc2018/713/">Natural Language</a> framework. Machine learning has never been easier.</p>
<h3 id="What’s-New-in-Testing"><a href="#What’s-New-in-Testing" class="headerlink" title="What’s New in Testing"></a><a href="https://developer.apple.com/videos/play/wwdc2018/403/">What’s New in Testing</a></h3><p>I can’t miss any testing sessions as it is part of every day’s work. How can your program avoids regression bugs and ready for refactoring without any tests?</p>
<p>This session shows improvement in coverage and the introduction of xccov tool to help us build automation on top of coverage report. Parallel distributed testing in Xcode 10 can save us some time to have coffee. Another wonderful news is that tests have multiple order execution mode to avoid bugs due to implicit dependencies.</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/0*7Gw1utFOl4C3PKqV.jpg" alt=""></p>
<h3 id="Testing-Tips-amp-Tricks-🌟"><a href="#Testing-Tips-amp-Tricks-🌟" class="headerlink" title="Testing Tips &amp; Tricks 🌟"></a><a href="https://developer.apple.com/videos/play/wwdc2018/417/">Testing Tips &amp; Tricks</a> 🌟</h3><p><img src="https://cdn-images-1.medium.com/max/2000/0*OHjJdWEhHj7Fc4rq.jpg" alt=""></p>
<p>This is my most favourite. The session starts with a pyramid of tests with unit integration and end-to-end test analogy explanation, then to some very cool tips and tricks.</p>
<ul>
<li>Testing network request: I like the separation of APIRequest and APIRequestLoader with URLSession , dependency injection with default parameter and the customisation of URLProtocol in URLSessionConfiguration</li>
</ul>
<p><img src="https://cdn-images-1.medium.com/max/2066/1*xJzqnw37CZKFhhMwym2HHQ.png" alt=""></p>
<p><img src="https://cdn-images-1.medium.com/max/2684/1*VUxjS-DpOfee7d5zTA1vrg.png" alt=""></p>
<p><img src="https://cdn-images-1.medium.com/max/2326/1*rgRwQla_YK3ADRwxZ4xpkg.png" alt=""></p>
<ul>
<li>Testing notification: Notification is system wide and I try to avoid it as much as possible. This shows how to inject dependency with default parameter and use of own NotificationCenter instead of NotificationCenter.default to ease testing</li>
</ul>
<p><img src="https://cdn-images-1.medium.com/max/2602/1*mXiNRzit8VcFM4_GNM3ebg.png" alt=""></p>
<ul>
<li><p>Testing location: build abstraction with LocationProvider and LocationFetcher . How to use custom protocol and protocol for delegate to mock during test</p>
</li>
<li><p>Testing timer: how to use and mock RunLoop behaviour with Timer</p>
</li>
</ul>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*obf6GcsXcHAbGFy-lUENNw.png" alt=""></p>
<h3 id="Advanced-Debugging-with-Xcode-and-LLDB"><a href="#Advanced-Debugging-with-Xcode-and-LLDB" class="headerlink" title="Advanced Debugging with Xcode and LLDB"></a><a href="https://developer.apple.com/videos/play/wwdc2018/412/">Advanced Debugging with Xcode and LLDB</a></h3><p><img src="https://cdn-images-1.medium.com/max/2000/0*6c81NEXU7tKYPEbQ.jpg" alt=""></p>
<p>LLDB has been improved to enable to debugging reliability experience, issues with AST context corruption, Swift type resolution are now things in the past. We can review how to use some common LLDB commands with handy arguments, and how to use Xcode breakpoint to its best.</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*ZtVpOaDnmt4VsDTHRiB6Ww.png" alt=""></p>
<h3 id="A-Tour-of-UICollectionView-🌟"><a href="#A-Tour-of-UICollectionView-🌟" class="headerlink" title="A Tour of UICollectionView 🌟"></a><a href="https://developer.apple.com/videos/play/wwdc2018/225/">A Tour of UICollectionView</a> 🌟</h3><p><img src="https://cdn-images-1.medium.com/max/2000/0*skJgSTHlTohIj_DT.jpg" alt=""></p>
<p>I begin to use UICollectionView more than UITableView , and it also has same code as NSCollectionView,which is more comfortable solution than the horrible NSTableView .</p>
<ul>
<li>Item size in UICollectionViewLayout : I often rely on UICollectionViewDelegateFlowLayout to specify item size but after watching this session, I feel like moving size related code to Layout object feels more like a good way to go</li>
</ul>
<p><img src="https://cdn-images-1.medium.com/max/2718/1*FS6OykJZ_zIPTzaWPPYk6g.png" alt=""></p>
<ul>
<li><p>Mosaic layout: This is not new, but good to watch again. You learn how to implement custom layout using cached layout attributes</p>
</li>
<li><p>Data Source update: I didn’t expect Apple mentions this, but it is a good lesson on how UICollectionView handles batch update. I ‘ve written about this before in my <a href="https://medium.com/flawless-app-stories/a-better-way-to-update-uicollectionview-data-in-swift-with-diff-framework-924db158db86">A better way to update UICollectionView data in Swift with diff framework</a> and that post gets a lot of attractions. In this session we need to remember that *<em>ordering matters in data source update, but not in collection view update *</em>❗️❗️❗️</p>
</li>
</ul>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*VMqhNo3bXxI-79e-r9iNvA.png" alt=""></p>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*KiWef6geZ3z0-jRaWNuqRg.png" alt=""></p>
<h3 id="Swift-Generics"><a href="#Swift-Generics" class="headerlink" title="Swift Generics"></a><a href="https://developer.apple.com/videos/play/wwdc2018/406/">Swift Generics</a></h3><p><img src="https://cdn-images-1.medium.com/max/2000/0*KWRTeiOV8FBNK3Mu.jpg" alt=""></p>
<p>Generic was a core feature of Swift since the beginning, we all know that it helps us to implement generic code that can work with many types in a type safe manner. This session reminds that I ‘ve never learned enough, especially the reasonable design behind it.</p>
<p>The sessions showcases Collection protocol and its protocol inheritances: MutableCollection , BidirectionalCollection , RandomAccessCollection and how they can be combined to provide generic functionalities for conformers. The associatedtype requirement in each protocol, especially Index and Element, is very minimal and has enough constraints for the protocol to implement lots of necessary functionalities in its protocol extension, which is eye opening for me. I very like to read open source, so looking at the <a href="https://github.com/apple/swift/blob/master/stdlib/public/core/BidirectionalCollection.swift">source code</a> for such protocols helps me understand more.</p>
<p><img src="https://cdn-images-1.medium.com/max/2102/1*QIepiAZqK4QmX2IbLFKz0w.png" alt=""></p>
<p>The part about <a href="https://en.wikipedia.org/wiki/Fisher%E2%80%93Yates_shuffle">Fisher Yates shuffle algorithm</a> details how we can come up with necessary protocol while still make them generic</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*actyrEg4E4qSFYu--K6uzA.png" alt=""></p>
<p>Pay attention to when they mention count and map , you can learn more how each concrete type can hook into the customisation point in protocol extension</p>
<p><img src="https://cdn-images-1.medium.com/max/2704/1*IG15tCSq49SqgvgJrXHDWw.png" alt=""></p>
<p>Finally learn the <a href="https://en.wikipedia.org/wiki/Liskov_substitution_principle">Liskov substitution principle</a> with protocol in class inheritance. You should also <a href="https://developer.apple.com/videos/play/wwdc2018/229/">Using Collections Effectively</a> for how to utilise handy functions in Collection.</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/0*oIKcsw6-H37i2A1t.jpg" alt=""></p>
<h3 id="Data-You-Can-Trust"><a href="#Data-You-Can-Trust" class="headerlink" title="Data You Can Trust"></a><a href="https://developer.apple.com/videos/play/wwdc2018/222/">Data You Can Trust</a></h3><p><img src="https://cdn-images-1.medium.com/max/2000/0*Iv80a99O1g6k-oO4.jpg" alt=""></p>
<p>Although Codable has a lot to offers in term of data integrity, this is good to know about to make sure the data you receive is actually the right data in correct format and structure. <a href="https://twitter.com/mgratzer/status/1003882651038683136">CommonCrypto</a> is also part of new iOS SDK so you don’t need my <a href="https://github.com/onmyway133/Arcane">Arcane</a> library to handle encryption and hashing in your apps.</p>
<h3 id="Embracing-Algorithms"><a href="#Embracing-Algorithms" class="headerlink" title="Embracing Algorithms"></a><a href="https://developer.apple.com/videos/play/wwdc2018/223/">Embracing Algorithms</a></h3><p><img src="https://cdn-images-1.medium.com/max/2000/0*qocdXtZ8cCAJ0mKV.jpg" alt=""></p>
<p>This is the most pleasant to watch as it is like a conversation between the speaker and the imaginary manager Crusty. Here I learn how to be aware of algorithm complexity and also how to utilise built in Foundation functions which are already optimised for performance.</p>
<p>After this session I can’t help myself but going to Swift repo to read the <a href="https://github.com/apple/swift/blob/master/test/Prototypes/Algorithms.swift">Algorithms.swift</a> file immediately.</p>
<h3 id="Image-and-Graphics-Best-Practices"><a href="#Image-and-Graphics-Best-Practices" class="headerlink" title="Image and Graphics Best Practices"></a><a href="https://developer.apple.com/videos/play/wwdc2018/219/">Image and Graphics Best Practices</a></h3><p><img src="https://cdn-images-1.medium.com/max/2000/0*-qDMSLxL89PuOm-m.jpg" alt=""></p>
<p>Learn how image encoding and decoding works through data and image buffer and how that affects memory and performance. There are techniques like downsampling that can tackle this problem. This also recommends against using backing store, and instead, use UIImageView</p>
<p><img src="https://cdn-images-1.medium.com/max/2766/1*mt70wBlbwC9Kz18vXN5THQ.png" alt=""></p>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*uV9Ata-pPnb-US3WrI6Y_A.png" alt=""></p>
<h3 id="A-Guide-to-Turi-Create"><a href="#A-Guide-to-Turi-Create" class="headerlink" title="A Guide to Turi Create"></a><a href="https://developer.apple.com/videos/play/wwdc2018/712/">A Guide to Turi Create</a></h3><p><img src="https://cdn-images-1.medium.com/max/2000/0*yWr3HKYpIslcV-Zz.jpg" alt=""></p>
<p>I’ve <a href="https://medium.com/flawless-app-stories/machine-learning-in-ios-turi-create-and-coreml-5ddce0dc8e26">written about Turi Create</a> before, but it is just scratching the surface of the many tasks offered by Turi. This year Apple releases <a href="https://github.com/apple/turicreate/releases/tag/5.0b1">Turi Create 5</a> with style transfer task, Vision Feature Print, GPU acceleration and recommender model improvements. I can’t wait to explore. And if you take a look at MLDataTable in Create ML framework, it looks like this has Turi ‘s SFrame under the hood.</p>
<p>That’s it. Thanks for reading. What are your favourite sessions this year? Please share in the comment section below</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-05-13T11:43:49.000Z" title="2019-05-13T11:43:49.000Z">2019-05-13</time><span class="level-item">a minute read (About 206 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-use-CAReplicatorLayer-to-make-activity-indicator-in-iOS/">How to use CAReplicatorLayer to make activity indicator in iOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/230">#230</a></strong></p>
<p><a href="https://developer.apple.com/documentation/quartzcore/careplicatorlayer">CAReplicatorLayer</a> is a layer that creates a specified number of sublayer copies with varying geometric, temporal, and color transformations</p>
<p>Here we use <code>instanceTransform</code> which applies transformation matrix around the center of the replicator layer</p>
<p>Below is how we use <code>replicatorLayer</code> to replicate lots of <code>line</code> and rotate them around the center.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> replicatorLayer = <span class="type">CAReplicatorLayer</span>()</span><br><span class="line"><span class="keyword">let</span> animation = <span class="type">CABasicAnimation</span>(keyPath: #keyPath(<span class="type">CALayer</span>.opacity))</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> line = <span class="type">CALayer</span>()</span><br><span class="line"><span class="keyword">let</span> lineCount: <span class="type">Int</span> = <span class="number">12</span></span><br><span class="line"><span class="keyword">let</span> duration: <span class="type">TimeInterval</span> = <span class="number">1.0</span></span><br><span class="line"><span class="keyword">let</span> lineSize: <span class="type">CGSize</span> = <span class="type">CGSize</span>(width: <span class="number">20</span>, height: <span class="number">6</span>)</span><br><span class="line"><span class="keyword">let</span> lineColor: <span class="type">UIColor</span> = <span class="type">UIColor</span>.darkGray</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> angle = <span class="type">CGFloat</span>.pi * <span class="number">2</span> / <span class="type">CGFloat</span>(lineCount)</span><br><span class="line"><span class="keyword">let</span> rotation = <span class="type">CATransform3DMakeRotation</span>(angle, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1.0</span>)</span><br><span class="line"></span><br><span class="line">replicatorLayer.instanceTransform = rotation</span><br><span class="line">replicatorLayer.instanceCount = lineCount</span><br><span class="line">replicatorLayer.instanceDelay = duration / <span class="type">TimeInterval</span>(lineCount)</span><br><span class="line"></span><br><span class="line">line.backgroundColor = lineColor.cgColor</span><br><span class="line">line.frame.size = lineSize</span><br><span class="line">line.cornerRadius = lineSize.height / <span class="number">2</span></span><br><span class="line"></span><br><span class="line">animation.fromValue = <span class="number">1.0</span></span><br><span class="line">animation.toValue = <span class="number">0.0</span></span><br><span class="line">animation.repeatCount = <span class="type">Float</span>.greatestFiniteMagnitude</span><br><span class="line">animation.timingFunction = <span class="type">CAMediaTimingFunction</span>(name: .linear)</span><br><span class="line">animation.duration = duration</span><br><span class="line"></span><br><span class="line">replicatorLayer.addSublayer(line)</span><br><span class="line">layer.addSublayer(replicatorLayer)</span><br><span class="line"></span><br><span class="line"><span class="comment">// x: </span></span><br><span class="line"><span class="comment">// y: half the height, changing affects rotation of lines</span></span><br><span class="line">line.position = <span class="type">CGPoint</span>(x: <span class="number">48</span>, y: <span class="number">75</span>)</span><br><span class="line"></span><br><span class="line">line.add(animation, forKey: <span class="literal">nil</span>)</span><br></pre></td></tr></table></figure>

<p>Pay attention to <code>position</code> of the <code>line</code>. The larger the <code>x</code>, the closer to center. <code>y</code> should be half the height of the replicator layer size, changing it affects the skewness of the <code>line</code>.</p>
<img width="584" alt="indicator" src="https://user-images.githubusercontent.com/2284279/57626103-809f2100-7595-11e9-9851-2df8b6013757.png">
</div></article></div><nav class="pagination is-centered mt-4" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/tags/iOS/page/3/">Previous</a></div><div class="pagination-next"><a href="/tags/iOS/page/5/">Next</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/tags/iOS/">1</a></li><li><a class="pagination-link" href="/tags/iOS/page/2/">2</a></li><li><a class="pagination-link" href="/tags/iOS/page/3/">3</a></li><li><a class="pagination-link is-current" href="/tags/iOS/page/4/">4</a></li><li><a class="pagination-link" href="/tags/iOS/page/5/">5</a></li><li><a class="pagination-link" href="/tags/iOS/page/6/">6</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="" src="https://avatars1.githubusercontent.com/u/2284279?s=460&amp;v=4" alt="onmyway133"></figure><p class="title is-size-4 is-block line-height-inherit">onmyway133</p><p class="is-size-6 is-block">iOS, macOS, Android, React. Serial maker. Writer. Speaker.</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Oslo, Norway</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">721</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">54</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/onmyway133" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/onmyway133"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com/onmyway133"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile is-mobile" href="https://onmyway133.com/apps" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Apps</span></span><span class="level-right"><span class="level-item tag">onmyway133.com</span></span></a></li><li><a class="level is-mobile is-mobile" href="https://learntalks.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Learn Talks</span></span><span class="level-right"><span class="level-item tag">learntalks.com</span></span></a></li><li><a class="level is-mobile is-mobile" href="https://wwdctogether.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">WWDC Together</span></span><span class="level-right"><span class="level-item tag">wwdctogether.com</span></span></a></li></ul></div></div></div><!--!--><div class="card widget"><div class="card-content"><h3 class="menu-label">Recent</h3><article class="media"><div class="media-content size-small"><p><time dateTime="2021-02-10T05:25:27.000Z">2021-02-10</time></p><p class="title is-6"><a class="link-muted" href="/blog/How-to-add-home-screen-quick-action-in-SwiftUI/">How to add home screen quick action in SwiftUI</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2021-02-08T18:40:48.000Z">2021-02-08</time></p><p class="title is-6"><a class="link-muted" href="/blog/How-to-use-EquatableView-in-SwiftUI/">How to use EquatableView in SwiftUI</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2021-02-08T18:34:20.000Z">2021-02-08</time></p><p class="title is-6"><a class="link-muted" href="/blog/How-to-add-new-property-in-Codable-struct-in-SwiftUI/">How to add new property in Codable struct in SwiftUI</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2021-02-06T22:58:36.000Z">2021-02-06</time></p><p class="title is-6"><a class="link-muted" href="/blog/How-to-show-close-button-in-NSTextField-in-AppKit/">How to show close button in NSTextField in AppKit</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2021-02-06T21:23:02.000Z">2021-02-06</time></p><p class="title is-6"><a class="link-muted" href="/blog/How-to-handle-escape-in-NSTextField-in-SwiftUI/">How to handle escape in NSTextField in SwiftUI</a></p><p class="is-uppercase"></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/archives/2021/02/"><span class="level-start"><span class="level-item">February 2021</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2021/01/"><span class="level-start"><span class="level-item">January 2021</span></span><span class="level-end"><span class="level-item tag">33</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/12/"><span class="level-start"><span class="level-item">December 2020</span></span><span class="level-end"><span class="level-item tag">29</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/11/"><span class="level-start"><span class="level-item">November 2020</span></span><span class="level-end"><span class="level-item tag">15</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/10/"><span class="level-start"><span class="level-item">October 2020</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/09/"><span class="level-start"><span class="level-item">September 2020</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/08/"><span class="level-start"><span class="level-item">August 2020</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/06/"><span class="level-start"><span class="level-item">June 2020</span></span><span class="level-end"><span class="level-item tag">14</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/05/"><span class="level-start"><span class="level-item">May 2020</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/04/"><span class="level-start"><span class="level-item">April 2020</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/03/"><span class="level-start"><span class="level-item">March 2020</span></span><span class="level-end"><span class="level-item tag">21</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/02/"><span class="level-start"><span class="level-item">February 2020</span></span><span class="level-end"><span class="level-item tag">20</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/01/"><span class="level-start"><span class="level-item">January 2020</span></span><span class="level-end"><span class="level-item tag">30</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/12/"><span class="level-start"><span class="level-item">December 2019</span></span><span class="level-end"><span class="level-item tag">36</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/11/"><span class="level-start"><span class="level-item">November 2019</span></span><span class="level-end"><span class="level-item tag">38</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/10/"><span class="level-start"><span class="level-item">October 2019</span></span><span class="level-end"><span class="level-item tag">49</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/09/"><span class="level-start"><span class="level-item">September 2019</span></span><span class="level-end"><span class="level-item tag">50</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/08/"><span class="level-start"><span class="level-item">August 2019</span></span><span class="level-end"><span class="level-item tag">39</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/07/"><span class="level-start"><span class="level-item">July 2019</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/06/"><span class="level-start"><span class="level-item">June 2019</span></span><span class="level-end"><span class="level-item tag">41</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/05/"><span class="level-start"><span class="level-item">May 2019</span></span><span class="level-end"><span class="level-item tag">50</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/04/"><span class="level-start"><span class="level-item">April 2019</span></span><span class="level-end"><span class="level-item tag">27</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/03/"><span class="level-start"><span class="level-item">March 2019</span></span><span class="level-end"><span class="level-item tag">24</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/02/"><span class="level-start"><span class="level-item">February 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/12/"><span class="level-start"><span class="level-item">December 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/05/"><span class="level-start"><span class="level-item">May 2018</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/04/"><span class="level-start"><span class="level-item">April 2018</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/02/"><span class="level-start"><span class="level-item">February 2018</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/01/"><span class="level-start"><span class="level-item">January 2018</span></span><span class="level-end"><span class="level-item tag">14</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/12/"><span class="level-start"><span class="level-item">December 2017</span></span><span class="level-end"><span class="level-item tag">14</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/11/"><span class="level-start"><span class="level-item">November 2017</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/10/"><span class="level-start"><span class="level-item">October 2017</span></span><span class="level-end"><span class="level-item tag">18</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/09/"><span class="level-start"><span class="level-item">September 2017</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/08/"><span class="level-start"><span class="level-item">August 2017</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/07/"><span class="level-start"><span class="level-item">July 2017</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/06/"><span class="level-start"><span class="level-item">June 2017</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/05/"><span class="level-start"><span class="level-item">May 2017</span></span><span class="level-end"><span class="level-item tag">35</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/04/"><span class="level-start"><span class="level-item">April 2017</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/algorithm/"><span class="tag">algorithm</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/android/"><span class="tag">android</span><span class="tag is-grey-lightest">34</span></a></div><div class="control"><a class="tags has-addons" href="/tags/apple-script/"><span class="tag">apple script</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/catalyst/"><span class="tag">catalyst</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ci/"><span class="tag">ci</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cloud/"><span class="tag">cloud</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cocoapods/"><span class="tag">cocoapods</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/combine/"><span class="tag">combine</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/core-data/"><span class="tag">core data</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/csharp/"><span class="tag">csharp</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/css/"><span class="tag">css</span><span class="tag is-grey-lightest">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/dart/"><span class="tag">dart</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/database/"><span class="tag">database</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/design/"><span class="tag">design</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/electron/"><span class="tag">electron</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/featured/"><span class="tag">featured</span><span class="tag is-grey-lightest">10</span></a></div><div class="control"><a class="tags has-addons" href="/tags/firebase/"><span class="tag">firebase</span><span class="tag is-grey-lightest">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/flutter/"><span class="tag">flutter</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/git/"><span class="tag">git</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/github/"><span class="tag">github</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/go/"><span class="tag">go</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/google/"><span class="tag">google</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/iOS/"><span class="tag">iOS</span><span class="tag is-grey-lightest">171</span></a></div><div class="control"><a class="tags has-addons" href="/tags/javascript/"><span class="tag">javascript</span><span class="tag is-grey-lightest">51</span></a></div><div class="control"><a class="tags has-addons" href="/tags/kotlin/"><span class="tag">kotlin</span><span class="tag is-grey-lightest">27</span></a></div><div class="control"><a class="tags has-addons" href="/tags/layout/"><span class="tag">layout</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/life/"><span class="tag">life</span><span class="tag is-grey-lightest">14</span></a></div><div class="control"><a class="tags has-addons" href="/tags/links/"><span class="tag">links</span><span class="tag is-grey-lightest">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/macOS/"><span class="tag">macOS</span><span class="tag is-grey-lightest">133</span></a></div><div class="control"><a class="tags has-addons" href="/tags/machine-learning/"><span class="tag">machine learning</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/maps/"><span class="tag">maps</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/networking/"><span class="tag">networking</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/node/"><span class="tag">node</span><span class="tag is-grey-lightest">13</span></a></div><div class="control"><a class="tags has-addons" href="/tags/objc/"><span class="tag">objc</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/react/"><span class="tag">react</span><span class="tag is-grey-lightest">24</span></a></div><div class="control"><a class="tags has-addons" href="/tags/react-native/"><span class="tag">react native</span><span class="tag is-grey-lightest">14</span></a></div><div class="control"><a class="tags has-addons" href="/tags/realm/"><span class="tag">realm</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/rx/"><span class="tag">rx</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/script/"><span class="tag">script</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/spm/"><span class="tag">spm</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/swift/"><span class="tag">swift</span><span class="tag is-grey-lightest">354</span></a></div><div class="control"><a class="tags has-addons" href="/tags/swiftUI/"><span class="tag">swiftUI</span><span class="tag is-grey-lightest">97</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tech/"><span class="tag">tech</span><span class="tag is-grey-lightest">14</span></a></div><div class="control"><a class="tags has-addons" href="/tags/terminal/"><span class="tag">terminal</span><span class="tag is-grey-lightest">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/testing/"><span class="tag">testing</span><span class="tag is-grey-lightest">17</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tool/"><span class="tag">tool</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tweet/"><span class="tag">tweet</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/unity/"><span class="tag">unity</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/voip/"><span class="tag">voip</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/watchOS/"><span class="tag">watchOS</span><span class="tag is-grey-lightest">11</span></a></div><div class="control"><a class="tags has-addons" href="/tags/web/"><span class="tag">web</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/work/"><span class="tag">work</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/wwdc/"><span class="tag">wwdc</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/xcode/"><span class="tag">xcode</span><span class="tag is-grey-lightest">24</span></a></div></div></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Subscribe to Updates</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=c2r59mmt2n5k0o5dt5vv3nq4u4&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="c2r59mmt2n5k0o5dt5vv3nq4u4" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button is-primary" type="submit" value="Subscribe"></div></div></form></div></div></div><div class="card widget"><div class="card-content"><div class="notification is-danger">You need to set <code>client_id</code> and <code>slot_id</code> to show this AD unit. Please set it in <code>_config.yml</code>.</div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/z.png" alt="onmyway133" height="28"></a><p class="size-small"><span>&copy; 2021 Khoa Pham</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/onmyway133"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            site: {
                url: 'https://onmyway133.github.io',
                external_link: {"enable":true,"exclude":[]}
            },
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to Top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>