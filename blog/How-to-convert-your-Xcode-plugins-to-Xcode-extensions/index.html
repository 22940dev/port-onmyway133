<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">

  <!-- PACE Progress Bar START -->
  
    <script src="https://raw.githubusercontent.com/HubSpot/pace/v1.0.2/pace.min.js"></script>
    <link rel="stylesheet" href="https://github.com/HubSpot/pace/raw/master/themes/orange/pace-theme-flash.css">
  
  

  <!-- PACE Progress Bar START -->

  
  <title>how to convert your xcode plugins to xcode extensions | onmyway133</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <meta name="keywords" content="xcode">
  
  
  
  
  <meta name="description" content="Issue #267 Original post https://medium.freecodecamp.org/how-to-convert-your-xcode-plugins-to-xcode-extensions-ac90f32ae0e3  Xcode is an indispensable IDE for iOS and macOS developers. From the early">
<meta name="keywords" content="xcode">
<meta property="og:type" content="article">
<meta property="og:title" content="How to convert your Xcode plugins to Xcode extensions">
<meta property="og:url" content="https://onmyway133.github.io/blog/How-to-convert-your-Xcode-plugins-to-Xcode-extensions/index.html">
<meta property="og:site_name" content="onmyway133">
<meta property="og:description" content="Issue #267 Original post https://medium.freecodecamp.org/how-to-convert-your-xcode-plugins-to-xcode-extensions-ac90f32ae0e3  Xcode is an indispensable IDE for iOS and macOS developers. From the early">
<meta property="og:locale" content="en">
<meta property="og:image" content="https://cdn-images-1.medium.com/max/3732/1*yFFJ_Viy9t95dKt0ehGuFQ.png">
<meta property="og:image" content="https://cdn-images-1.medium.com/max/3104/1*00MyrPD8FnUCCCPZL8G8qg.png">
<meta property="og:image" content="https://cdn-images-1.medium.com/max/3476/0*PJ2uoFz8fm7TLI6F.png">
<meta property="og:image" content="https://cdn-images-1.medium.com/max/2584/1*mk9e6p3myodrOVbspovq-w.png">
<meta property="og:image" content="https://cdn-images-1.medium.com/max/3360/0*2ceF-Oww_gKb8V65">
<meta property="og:image" content="https://cdn-images-1.medium.com/max/2532/1*-DlTVNe370dbXNlxzOmH1g.png">
<meta property="og:image" content="https://cdn-images-1.medium.com/max/2556/1*oMRkzNj6881iK9Tsv3OGRA.png">
<meta property="og:image" content="https://cdn-images-1.medium.com/max/2880/0*EZE4S-PiYPa3fmu4.png">
<meta property="og:image" content="https://cdn-images-1.medium.com/max/3740/1*1K4Ndh9cQiKHNjFq3FELkA.png">
<meta property="og:image" content="https://cdn-images-1.medium.com/max/2880/0*rPYi7qKWFen5Oq5W.png">
<meta property="og:image" content="https://cdn-images-1.medium.com/max/3772/1*Z-87Nylaul0qvQMVBo9JeA.png">
<meta property="og:image" content="https://cdn-images-1.medium.com/max/2880/0*f2mTvSC0HtdbcEZ6.png">
<meta property="og:image" content="https://cdn-images-1.medium.com/max/2720/0*QfHcnpb6WZaMrMDi.png">
<meta property="og:image" content="https://cdn-images-1.medium.com/max/2000/0*9BeVwHROwO7ls9Z0.png">
<meta property="og:image" content="https://cdn-images-1.medium.com/max/3800/1*DWeJnAh6xu1-CLfaABornQ.png">
<meta property="og:image" content="https://cdn-images-1.medium.com/max/2880/0*r080P3DKAy_-zvJu.png">
<meta property="og:image" content="https://cdn-images-1.medium.com/max/5580/1*-8Uw2DfLyJKt0cU4Ogcdvg.png">
<meta property="og:image" content="https://cdn-images-1.medium.com/max/NaN/1*6SSRVpyiSoP_QRa9DOO4ew.png">
<meta property="og:image" content="https://cdn-images-1.medium.com/max/3248/1*xX3TnFjBX7uDh_Wpid7bzA.png">
<meta property="og:image" content="https://cdn-images-1.medium.com/max/3664/1*s3c33Gtd9Hq5u1a0pBrkPQ.png">
<meta property="og:image" content="https://cdn-images-1.medium.com/max/2000/0*3rbc5Xua7YWg4ouW.png">
<meta property="og:image" content="https://cdn-images-1.medium.com/max/5588/1*aZe8ZgEI-KLIDb1vXgVKtw.png">
<meta property="og:image" content="https://cdn-images-1.medium.com/max/3956/1*_MnW2BezYsDlw7x6eQifQg.png">
<meta property="og:image" content="https://cdn-images-1.medium.com/max/3506/1*gpuztyyB9Z3-XDWOnHgn0w.png">
<meta property="og:image" content="https://cdn-images-1.medium.com/max/2000/0*EQW2d3wyAnC1WSui.jpg">
<meta property="og:updated_time" content="2019-11-12T12:12:41.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="How to convert your Xcode plugins to Xcode extensions">
<meta name="twitter:description" content="Issue #267 Original post https://medium.freecodecamp.org/how-to-convert-your-xcode-plugins-to-xcode-extensions-ac90f32ae0e3  Xcode is an indispensable IDE for iOS and macOS developers. From the early">
<meta name="twitter:image" content="https://cdn-images-1.medium.com/max/3732/1*yFFJ_Viy9t95dKt0ehGuFQ.png">
  
    <link rel="alternate" href="/atom.xml" title="onmyway133" type="application/atom+xml">
  
  <link rel="icon" href="/favicon.ico">
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="https://cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <style type="text/css">
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/9749f0/00000000000000000001008f/27/l?subset_id=2&fvd=n5) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/90cf9f/000000000000000000010091/27/l?subset_id=2&fvd=n7) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/8a5494/000000000000000000013365/27/l?subset_id=2&fvd=n4) format("woff2");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/d337d8/000000000000000000010095/27/l?subset_id=2&fvd=i4) format("woff2");font-weight:400;font-style:italic;}</style>
    
  <link rel="stylesheet" id="athemes-headings-fonts-css" href="//fonts.googleapis.com/css?family=Yanone+Kaffeesatz%3A200%2C300%2C400%2C700&amp;ver=4.6.1" type="text/css" media="all">
  <link rel="stylesheet" href="/css/style.css">

  <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.0.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/hiero.css">
  <link rel="stylesheet" href="/css/glyphs.css">
  

  <!-- Custom CSS -->
  <link rel="stylesheet" href="/css/my.css">
  <!-- Google Adsense -->
  
</head>
</html>
<script>
var themeMenus = {};

  themeMenus["/"] = "Home"; 

  themeMenus["/about/"] = "About"; 

  themeMenus["/writing/"] = "writing"; 

  themeMenus["/archives"] = "Archives"; 

  themeMenus["/speaking/"] = "speaking"; 

  themeMenus["/opensource/"] = "open source"; 

  themeMenus["/projects/"] = "projects"; 

  themeMenus["/news/"] = "news"; 

  themeMenus["/gumroad/"] = "gumroad"; 

  themeMenus["/atom.xml"] = "rss"; 

</script>


  <body data-spy="scroll" data-target="#toc" data-offset="50">


  <header id="allheader" class="site-header" role="banner">
  <div class="clearfix container">
      <div class="site-branding">

          <h1 class="site-title">
            
              <a href="/" title="onmyway133" rel="home"> onmyway133 </a>
            
          </h1>

          
            <div class="site-description">What you don&#39;t know is what you haven&#39;t learned</div>
          
            
          <nav id="main-navigation" class="main-navigation" role="navigation">
            <a class="nav-open">Menu</a>
            <a class="nav-close">Close</a>
            <div class="clearfix sf-menu">

              <ul id="main-nav" class="nmenu sf-js-enabled">
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/">Home</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/about/">About</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/writing/">writing</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/archives">Archives</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/speaking/">speaking</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/opensource/">open source</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/projects/">projects</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/news/">news</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/gumroad/">gumroad</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/atom.xml">rss</a> </li>
                    
              </ul>
            </div>
          </nav>


      </div>
  </div>
</header>


  <div id="originBgDiv" style="background: #fff; width: 100%;">

      <div style="max-height:600px; overflow: hidden;  display: flex; display: -webkit-flex; align-items: center;">
        <img id="originBg" width="100%" alt="" src="">
      </div>

  </div>

  <script>
  function setAboutIMG(){
      var imgUrls = "https://avatars1.githubusercontent.com/u/2284279?s=460&v=4".split(",");
      var random = Math.floor((Math.random() * imgUrls.length ));
      if (imgUrls[random].startsWith('http') || imgUrls[random].indexOf('://') >= 0) {
        document.getElementById("originBg").src=imgUrls[random];
      } else {
        document.getElementById("originBg").src='/' + imgUrls[random];
      }
  }
  bgDiv=document.getElementById("originBgDiv");
  if(location.pathname.match('about')){
    setAboutIMG();
    bgDiv.style.display='block';
  }else{
    bgDiv.style.display='none';
  }
  </script>



  <div id="container">
    <div id="wrap">
            
      <div id="content" class="outer">
        
          <section id="main" style="float:none;"><article id="post-How-to-convert-your-Xcode-plugins-to-Xcode-extensions" style="width: 66%; float:left;" class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" class="article-title" itemprop="name">
      How to convert your Xcode plugins to Xcode extensions
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	Posted on <a href="/blog/How-to-convert-your-Xcode-plugins-to-Xcode-extensions/" class="article-date">
	  <time datetime="2019-05-23T16:08:37.000Z" itemprop="datePublished">May 23, 2019</time>
	</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/267" target="_blank" rel="noopener">#267</a></strong></p>
<p>Original post <a href="https://medium.freecodecamp.org/how-to-convert-your-xcode-plugins-to-xcode-extensions-ac90f32ae0e3" target="_blank" rel="noopener">https://medium.freecodecamp.org/how-to-convert-your-xcode-plugins-to-xcode-extensions-ac90f32ae0e3</a></p>
<hr>
<p>Xcode is an indispensable IDE for iOS and macOS developers. From the early days, the ability to build and install custom plugins had given us a huge boost in productivity. It was not long before Apple introduced Xcode extension due to privacy concerns.</p>
<p>I have built a few Xcode plugins and extensions like <a href="https://github.com/onmyway133/XcodeWay" target="_blank" rel="noopener">XcodeWay</a>, <a href="https://github.com/onmyway133/XcodeColorSense" target="_blank" rel="noopener">XcodeColorSense</a>, <a href="https://github.com/onmyway133/XcodeColorSense2" target="_blank" rel="noopener">XcodeColorSense2</a>, and <a href="https://github.com/onmyway133/Xmas" target="_blank" rel="noopener">Xmas</a>. It was a rewarding experience. I learned a lot, and the productivity I gained was considerable. In this post I walkthrough how I converted my Xcode plugins to extensions, and the experience I had in doing so.</p>
<h2 id="My-first-Xcode-plugin-XcodeWay"><a href="#My-first-Xcode-plugin-XcodeWay" class="headerlink" title="My first Xcode plugin: XcodeWay"></a>My first Xcode plugin: XcodeWay</h2><blockquote>
<h1 id="I-choose-a-lazy-person-to-do-a-hard-job-Because-a-lazy-person-will-find-an-easy-way-to-do-it"><a href="#I-choose-a-lazy-person-to-do-a-hard-job-Because-a-lazy-person-will-find-an-easy-way-to-do-it" class="headerlink" title="I choose a lazy person to do a hard job. Because a lazy person will find an easy way to do it"></a>I choose a lazy person to do a hard job. Because a lazy person will find an easy way to do it</h1></blockquote>
<p>I really like the above <a href="https://www.goodreads.com/quotes/568877-i-choose-a-lazy-person-to-do-a-hard-job" target="_blank" rel="noopener">quote from Bill Gates</a>. I try to avoid repetitive and boring tasks. Whenever I find myself doing the same tasks again, I write scripts and tools to automate that. Doing this takes some time, but I will be a bit lazier in the near future.</p>
<p>Besides the interest in building open source <a href="https://github.com/onmyway133/blog/issues/5" target="_blank" rel="noopener">frameworks and tools</a>, I like to extend the IDE I’m using — mostly Xcode.</p>
<p>I first started iOS development in 2014. I wanted a quick way to navigate to many places right from Xcode with the context of the current project. There are many times we want to:</p>
<ul>
<li><p>open the current project folder in “Finder” to change some files</p>
</li>
<li><p>open Terminal to run some commands</p>
</li>
<li><p>open the current file in GitHub to quickly give the link to a workmate</p>
</li>
<li><p>or to open other folders like themes, plugins, code snippets, device logs.</p>
</li>
</ul>
<p>Every little bit of time we save each day counts.</p>
<p>I thought it would be cool idea to write an Xcode plugin that we can do all above things right inside Xcode. Instead of waiting for other people to do it, I pulled up my sleeve and wrote my first Xcode plugin — <a href="https://github.com/onmyway133/XcodeWay" target="_blank" rel="noopener">XcodeWay</a>— and shared it as open source.</p>
<p><img src="https://cdn-images-1.medium.com/max/3732/1*yFFJ_Viy9t95dKt0ehGuFQ.png" alt="XcodeWay works by creating a menu under Editor with lots of options to navigate to other places right from Xcode. It looks simple but there was some hard work required."><em>XcodeWay works by creating a menu under Editor with lots of options to navigate to other places right from Xcode. It looks simple but there was some hard work required.</em></p>
<h2 id="What-are-Xcode-plugins"><a href="#What-are-Xcode-plugins" class="headerlink" title="What are Xcode plugins?"></a>What are Xcode plugins?</h2><p>Xcode plugins are not officially supported by Xcode or recommended by Apple. There are no documents about them. The best places we can learn about them are via existing plugins’ source code and a few tutorials.</p>
<p>An Xcode plugin is just a bundle of type xcplugin and is placed at ~/Library/Application Support/Developer/Shared/Xcode/Plug-ins . Xcode, when starting, will load any Xcode plugins present in this folder. Plugins are run in the same process as Xcode, so could do anything as Xcode. A bug in any plugin can cause Xcode to crash.</p>
<p>To make an Xcode plugin, create a macOS Bundle with one class that extends from NSObject , and have an initialiser that accepts NSBundle , for example in <a href="https://github.com/onmyway133/Xmas/blob/master/Xmas/Xmas.swift" target="_blank" rel="noopener">Xmas</a>:</p>
<p><img src="https://cdn-images-1.medium.com/max/3104/1*00MyrPD8FnUCCCPZL8G8qg.png" alt></p>
<pre><code>class Xmas: NSObject {

  var bundle: NSBundle

  init(bundle: NSBundle) {
    self.bundle = bundle
    super.init()
  }
}</code></pre><p>Inside Info.plist, we need to:</p>
<ul>
<li><p>declare this class as the main entry class for the plugin, and</p>
</li>
<li><p>that this bundle has no UI, because we create UI controls and add to the Xcode interface during runtime</p>
<p>  <key>NSPrincipalClass</key><br>  <string>Xmas</string><br>  <key>XCPluginHasUI</key></p>
  <false>

</false></li>
</ul>
<p>Another problem with Xcode plugins is that we have to continuously update DVTPluginCompatibilityUUIDs . This changes every time a new version of Xcode comes out. Without updating, Xcode will refuse to load the plugin.</p>
<h2 id="What-Xcode-plugins-can-do"><a href="#What-Xcode-plugins-can-do" class="headerlink" title="What Xcode plugins can do"></a>What Xcode plugins can do</h2><p>Many developers build Xcode plugins because they miss specific features found in other IDEs like Sublime Text, AppCode, or Atom.</p>
<p>Since Xcode plugins are loaded in the same process as Xcode, they can do everything that Xcode can. The only limit is our imagination. We can leverage Objective C Runtime to discover private frameworks and functions. Then LLDB and Symbolic breakpoint can be used further to inspect running code and alter their behaviors. We can also use swizzling to change implementation of any running code. Writing Xcode plugins is hard — lots of guessing, and sometimes a good knowledge of assembly is required.</p>
<p>In the golden age of plugins, there was a popular plugin manager, which itself was a plugin, called <a href="https://github.com/alcatraz/Alcatraz" target="_blank" rel="noopener">Alcatraz</a>. It could install other plugins, which basically just downloads the xcplugin file and moves this to the Plug Ins folder.</p>
<p><img src="https://cdn-images-1.medium.com/max/3476/0*PJ2uoFz8fm7TLI6F.png" alt></p>
<p>To get a sense of what plugins can do, let’s take a look at some popular plugins.</p>
<h3 id="Xvim"><a href="#Xvim" class="headerlink" title="Xvim"></a>Xvim</h3><p>First in the list is <a href="https://github.com/XVimProject/XVim" target="_blank" rel="noopener">Xvim</a>, which adds Vim keybindings right inside Xcode. It supports mostly all of the keybindings that we used to have in Terminal.</p>
<p><img src="https://cdn-images-1.medium.com/max/2584/1*mk9e6p3myodrOVbspovq-w.png" alt></p>
<h3 id="SCXcodeMiniMap"><a href="#SCXcodeMiniMap" class="headerlink" title="SCXcodeMiniMap"></a>SCXcodeMiniMap</h3><p>If you miss MiniMap mode in Sublime Text, you can use <a href="https://github.com/stefanceriu/SCXcodeMiniMap" target="_blank" rel="noopener">SCXcodeMiniMap</a> to add a right map panel inside Xcode editor.</p>
<p><img src="https://cdn-images-1.medium.com/max/3360/0*2ceF-Oww_gKb8V65" alt></p>
<h3 id="FuzzyAutocompletePlugin"><a href="#FuzzyAutocompletePlugin" class="headerlink" title="FuzzyAutocompletePlugin"></a>FuzzyAutocompletePlugin</h3><p>Before version 9, Xcode didn’t have proper auto completion — it was just based on prefix. That was where <a href="https://github.com/FuzzyAutocomplete/FuzzyAutocompletePlugin" target="_blank" rel="noopener">FuzzyAutocompletePlugin</a> shone. It performs fuzzy auto completion based on the hidden IDEOpenQuicklyPattern feature in Xcode.</p>
<p><img src="https://cdn-images-1.medium.com/max/2532/1*-DlTVNe370dbXNlxzOmH1g.png" alt></p>
<h3 id="KSImageNamed-Xcode"><a href="#KSImageNamed-Xcode" class="headerlink" title="KSImageNamed-Xcode"></a>KSImageNamed-Xcode</h3><p>To display a bundle image inside UIImageView, we often use the imageNamed method. But remembering exactly the name of the image file is hard. <a href="https://github.com/ksuther/KSImageNamed-Xcode" target="_blank" rel="noopener">KSImageNamed-Xcode</a> is here to help. You will get a list of auto-suggested image names when you begin to type.</p>
<p><img src="https://cdn-images-1.medium.com/max/2556/1*oMRkzNj6881iK9Tsv3OGRA.png" alt></p>
<h3 id="ColorSense-for-Xcode"><a href="#ColorSense-for-Xcode" class="headerlink" title="ColorSense-for-Xcode"></a>ColorSense-for-Xcode</h3><p>Another itch during development is to work with UIColor , which uses RGBA color space. We don’t get a visual indicator of the color that we specify, and manually performing checking can be time consuming. Luckily there is <a href="https://github.com/omz/ColorSense-for-Xcode" target="_blank" rel="noopener">ColorSense-for-Xcode</a> which shows the color being used and the color picker panel to easily select the right color.</p>
<p><img src="https://cdn-images-1.medium.com/max/2880/0*EZE4S-PiYPa3fmu4.png" alt></p>
<h3 id="LinkedConsole"><a href="#LinkedConsole" class="headerlink" title="LinkedConsole"></a>LinkedConsole</h3><p>In AppCode, we can jump to a specific line in the file that is logged inside the console. If you miss this feature in Xcode, you can use <a href="https://github.com/krzysztofzablocki/LinkedConsole" target="_blank" rel="noopener">LinkedConsole</a>. This enables clickable links inside Xcode console so we can jump to that file instantly.</p>
<p><img src="https://cdn-images-1.medium.com/max/3740/1*1K4Ndh9cQiKHNjFq3FELkA.png" alt></p>
<h2 id="The-hard-work-behind-Xcode-plugins"><a href="#The-hard-work-behind-Xcode-plugins" class="headerlink" title="The hard work behind Xcode plugins"></a>The hard work behind Xcode plugins</h2><p>Making an Xcode plugin is not easy. Not only do we need to know macOS programming, but we also need to dive deep into Xcode view hierarchy. We need to explore private frameworks and APIs in order to inject the feature we want.</p>
<p>There are very few tutorials on how to make plugins but, luckily, most plugins are open source so we can understand how they work. Since I have made a few plugins, I can give some technical details about them.</p>
<p>Xcode plugins are done usually with two private frameworks: DVTKit and IDEKit . System frameworks are at /System/Library/PrivateFrameworks but the frameworks that Xcode uses exclusively are under /Applications/Xcode.app/Contents/ , there you can find Frameworks , OtherFrameworks and SharedFrameworks.</p>
<p>There is a tool <a href="https://github.com/nygard/class-dump" target="_blank" rel="noopener">class-dump</a> that can generate headers from the Xcode app bundle. With the class names and methods, you can call NSClassFromString to get the class from the name.</p>
<h3 id="Swizzling-DVTBezelAlertPanel-framework-in-Xmas"><a href="#Swizzling-DVTBezelAlertPanel-framework-in-Xmas" class="headerlink" title="Swizzling DVTBezelAlertPanel framework in Xmas"></a>Swizzling DVTBezelAlertPanel framework in Xmas</h3><p>Christmas has always given me a special feeling, so I decided to make <a href="https://github.com/onmyway133/Xmas" target="_blank" rel="noopener">Xmas</a>, which shows a random Christmas picture instead of the default alert view. The class used to render that view is <a href="https://github.com/luisobo/Xcode-RuntimeHeaders/blob/master/DVTKit/DVTBezelAlertPanel.h" target="_blank" rel="noopener">DVTBezelAlertPanel</a> inside the DVTKit framework. <a href="https://medium.com/fantageek/xmas-9522c2c88db3" target="_blank" rel="noopener">My article on building that plugin is here.</a></p>
<p><img src="https://cdn-images-1.medium.com/max/2880/0*rPYi7qKWFen5Oq5W.png" alt></p>
<p>With Objective C Runtime, there is a technique called swizzling, which can change and switch implementation and method signature of any running classes and methods.</p>
<p>Here, in order to change the content of that alert view, we need to swap the <a href="https://github.com/onmyway133/Xmas/blob/master/Xmas/Xmas.swift" target="_blank" rel="noopener">initialiser</a> initWithIcon:message:parentWindow:duration: with our own method. We do that early by listening to NSApplicationDidFinishLaunchingNotification which is notified when a macOS plugin, in this case Xcode, launches.</p>
<pre><code>class func swizzleMethods() {
    guard let originalClass = NSClassFromString(&quot;DVTBezelAlertPanel&quot;) as? NSObject.Type else {
        return
    }

do {
        try originalClass.jr_swizzleMethod(&quot;initWithIcon:message:parentWindow:duration:&quot;,
            withMethod: &quot;xmas_initWithIcon:message:parentWindow:duration:&quot;)
    }
    catch {
        Swift.print(&quot;Swizzling failed&quot;)
    }
}</code></pre><p>I initially liked to do everything in Swift. But it’s tricky to use the s<a href="https://stackoverflow.com/questions/34317766/how-to-swizzle-init-in-swift" target="_blank" rel="noopener">wizzle init method in Swift</a>, so the quickest way is to do that in <a href="https://github.com/onmyway133/xmas/blob/master/Xmas/NSObject%2BXmas.m" target="_blank" rel="noopener">Objective C</a>. Then we simply traverse the view hierarchy to find the NSVisualEffectView inside NSPanel to update the image.</p>
<h3 id="Interacting-with-DVTSourceTextView-in-XcodeColorSense"><a href="#Interacting-with-DVTSourceTextView-in-XcodeColorSense" class="headerlink" title="Interacting with DVTSourceTextView in XcodeColorSense"></a>Interacting with DVTSourceTextView in XcodeColorSense</h3><p>I work mostly with hex colors and I want a quick way to see the color. So I built XcodeColorSense — it supports hex color, RGBA, and named color.</p>
<p><img src="https://cdn-images-1.medium.com/max/3772/1*Z-87Nylaul0qvQMVBo9JeA.png" alt></p>
<p>The idea is simple. Parse the string to see if the user is typing something related to UIColor, and show a small overlay view with that color as background. The text view that Xcode uses is of type DVTSourceTextView in DVTKit framework. We also need to listen to NSTextViewDidChangeSelectionNotification which is triggered whenever any NSTextView content is <a href="https://github.com/onmyway133/XcodeColorSense/blob/master/XcodeColorSense/XcodeColorSense.swift" target="_blank" rel="noopener">changed</a>.</p>
<pre><code>func listenNotification() {
  NSNotificationCenter.defaultCenter().addObserver(self, selector: #selector(handleSelectionChange(_:)), name: NSTextViewDidChangeSelectionNotification, object: nil)
}

func handleSelectionChange(note: NSNotification) {
  guard let DVTSourceTextView = NSClassFromString(&quot;DVTSourceTextView&quot;) as? NSObject.Type,
    object = note.object where object.isKindOfClass(DVTSourceTextView.self),
    let textView = object as? NSTextView
  else { return }

self.textView = textView
}</code></pre><p>I had a Matcher architecture so we can detect different kinds of UIColor constructions — for example <a href="https://github.com/onmyway133/XcodeColorSense/blob/master/XcodeColorSense/Matcher/HexMatcher.swift" target="_blank" rel="noopener">HexMatcher</a> .</p>
<pre><code>public struct HexMatcher: Matcher {

func check(line: String, selectedText: String) -&gt; (color: NSColor, range: NSRange)? {
    let pattern1 = &quot;\&quot;#?[A-Fa-f0-9]{6}\&quot;&quot;
    let pattern2 = &quot;0x[A-Fa-f0-9]{6}&quot;

let ranges = [pattern1, pattern2].flatMap {
      return Regex.check(line, pattern: $0)
    }

guard let range = ranges.first
      else { return nil }

let text = (line as NSString).substringWithRange(range).replace(&quot;0x&quot;, with: &quot;&quot;).replace(&quot;\&quot;&quot;, with: &quot;&quot;)
    let color = NSColor.hex(text)

return (color: color, range: range)
  }
}</code></pre><p>To render the overlay, we use NSColorWell which is good for showing a view with background. The position is determined by calling firstRectForCharacterRange and some point conversions with convertRectFromScreen and convertRect .</p>
<h3 id="Using-NSTask-and-IDEWorkspaceWindowController-in-XcodeWay"><a href="#Using-NSTask-and-IDEWorkspaceWindowController-in-XcodeWay" class="headerlink" title="Using NSTask and IDEWorkspaceWindowController in XcodeWay"></a>Using NSTask and IDEWorkspaceWindowController in XcodeWay</h3><p>Finally, my beloved <a href="https://github.com/onmyway133/XcodeWay/tree/1.0" target="_blank" rel="noopener">XcodeWay</a>.</p>
<p>I found myself needing to go to different places from Xcode with the context of the current project. So I built XcodeWay as a plugin that adds lots of handy menu options under Window.</p>
<p><img src="https://cdn-images-1.medium.com/max/2880/0*f2mTvSC0HtdbcEZ6.png" alt></p>
<p>Since the plugin runs in the same Xcode process, it has access to the main menu NSApp.mainMenu?.itemWithTitle(“Window”) . There we can alter the menu. XcodeWay is designed to easily extend functionalities through its <a href="https://github.com/onmyway133/XcodeWay/blob/1.0/XcodeWay/Navigator/Navigator.swift" target="_blank" rel="noopener">Navigator</a> protocol.</p>
<pre><code>[@objc](http://twitter.com/objc) protocol Navigator: NSObjectProtocol {
  func navigate()
  var title: String { get }
}</code></pre><p>For folders with a static path like Provisioning Profile ~/Library/MobileDevice/Provisioning Profiles or User data Developer/Xcode/UserData , we can just construct the URL and call NSWorkspace.sharedWorkspace().openURL . For dynamic folders that vary depending on the current project, more work needs to be done.</p>
<p>How do we open the folder for the current project in Finder? The information for the current project path is kept inside IDEWorkspaceWindowController . This is a class that manages workspace windows in Xcode. Take a look at <a href="https://github.com/onmyway133/XcodeWay/blob/1.0/XcodeWay/Helper/FTGEnvironmentManager.m" target="_blank" rel="noopener">EnvironmentManager</a> where we use <a href="https://developer.apple.com/documentation/objectivec/1418952-objc_getclass?language=objc" target="_blank" rel="noopener">objc_getClass</a> to get the class definition from a string.</p>
<pre><code>self.IDEWorkspaceWindowControllerClass = objc_getClass(&quot;IDEWorkspaceWindowController&quot;);

NSArray *workspaceWindowControllers = [self.IDEWorkspaceWindowControllerClass valueForKey:@&quot;workspaceWindowControllers&quot;];

id workSpace = nil;

for (id controller in workspaceWindowControllers) {
  if ([[controller valueForKey:@&quot;window&quot;] isEqual:[NSApp keyWindow]]) {
    workSpace = [controller valueForKey:@&quot;_workspace&quot;];
  }
}

NSString * path = [[workSpace valueForKey:@&quot;representingFilePath&quot;] valueForKey:@&quot;_pathString&quot;];</code></pre><p>Finally, we can utilise valueForKey to get the value for any property that we think exists. This way not only do we get the <a href="https://github.com/onmyway133/XcodeWay/blob/1.0/XcodeWay/Navigator/FTGProjectFolderNavigator.m" target="_blank" rel="noopener">project path</a>, we also get the path to the opening file. So we can call activateFileViewerSelectingURLs on NSWorkspace to open Finder with that file selected. This is handy as users don’t need to look for that file in Finder.</p>
<p>Many times we want to execute some Terminal commands on the current project folder. To achieve that, we can use NSTask with launch pad /usr/bin/open and arguments [@”-a”, @”Terminal”, projectFolderPath] . iTerm, if configured probably, will open this in a new tab.</p>
<p>The documents for iOS 7 apps are placed in the fixed location iPhone Simulator inside Application Support. But, from iOS 8, every app has a unique UUID and their <a href="https://github.com/onmyway133/XcodeWay/blob/1.0/XcodeWay/Navigator/FTGSimulatorFolderNavigator.m" target="_blank" rel="noopener">document folders</a> are hard to predict.</p>
<pre><code>~/Library/Developer/CoreSimulator/Devices/1A2FF360-B0A6-8127-95F3-68A6AB0BCC78/data/Container/Data/Application/</code></pre><p>We can build a map and perform tracking to find the generated ID for the current project, or to check the plist inside each folder to compare the bundle identifier.</p>
<p>The quick solution that I came up with was to search for the most recent updated folder. Every time we build the project, or make changes inside the app, their document folder is updated. That is where we can make use of NSFileModificationDate to find the folder for the current project.</p>
<p>There are many hacks when working with Xcode plugins, but the results are rewarding. Every few minutes we save each day end up saving a lot of time overall.</p>
<h2 id="Security-and-freedom"><a href="#Security-and-freedom" class="headerlink" title="Security and freedom"></a>Security and freedom</h2><p>With great power comes great responsibility. The fact that plugins can do whatever they want rings an alert to security. In late 2015, there was a malware attack by distributing a modified version of Xcode, called <a href="https://en.wikipedia.org/wiki/XcodeGhost" target="_blank" rel="noopener">XcodeGhost</a>, which injects malicious code into any apps built with Xcode Ghost. The malware is believed to use the plugin mechanism among other things.</p>
<p>Like the iOS apps we download from the Appstore, macOS apps like Xcode are <a href="https://developer.apple.com/support/code-signing/" target="_blank" rel="noopener">signed</a> by Apple when we download them from the Mac Appstore or through official Apple download links.</p>
<p><strong>Code signing your app</strong> assures users that it is from a known source and the app hasn’t been modified since it was last signed. Before your app can integrate app services, be installed on a device, or be submitted to the App Store, it must be signed with a <a href="https://developer.apple.com/support/technical/certificates/" target="_blank" rel="noopener">certificate</a> issued by Apple</p>
<p>To avoid potential malware like this, at WWDC 2016 Apple announced the <a href="https://developer.apple.com/videos/play/wwdc2016/414/" target="_blank" rel="noopener">Xcode Source Editor Extension</a> as the only way to load third party extensions into Xcode. This means that, from Xcode 8, plugins can’t be loaded.</p>
<h3 id="Source-Editor-Extension"><a href="#Source-Editor-Extension" class="headerlink" title="Source Editor Extension"></a>Source Editor Extension</h3><p><a href="https://developer.apple.com/app-extensions/" target="_blank" rel="noopener">Extension</a> is the recommended approach to safely add functionalities in restricted ways.</p>
<p>App extensions give users access to your app’s functionality and content throughout iOS and macOS. For example, your app can now appear as a widget on the Today screen, add new buttons in the Action sheet, offer photo filters within the Photos app, or display a new system-wide custom keyboard.</p>
<p>For now, the only extension to Xcode is Source Editor, which allows us to read and modify contents of a source file, as well as read and modify the current text selection within the editor.</p>
<p>Extension is a new target and runs in a different process than Xcode. This is good in that it can’t alter Xcode in any ways other than conforming to XCSourceEditorCommand to modify the current document content.</p>
<pre><code>protocol XCSourceEditorCommand {

  func perform(with invocation: [XCSourceEditorCommandInvocation](https://developer.apple.com/documentation/xcodekit/xcsourceeditorcommandinvocation), 
completionHandler: @escaping ([Error](https://developer.apple.com/documentation/swift/error)?) -&gt; [Void](https://developer.apple.com/documentation/swift/void))
}</code></pre><p><img src="https://cdn-images-1.medium.com/max/2720/0*QfHcnpb6WZaMrMDi.png" alt></p>
<p>Xcode 8 has lots of improvements like the new code completion features, Swift image and color literals, and snippets. This led to the deprecation of many Xcode plugins. For some indispensable plugins like XVim, this is unbearable for some people. Some old plugin features can’t be achieved with the current Source Editor Extension system.</p>
<h3 id="Unless-you-resign-Xcode"><a href="#Unless-you-resign-Xcode" class="headerlink" title="Unless you resign Xcode"></a>Unless you resign Xcode</h3><p>A workaround to bypass the restriction from Xcode 8 for plugins, is to replace the existing Xcode signature by a technique called <a href="https://github.com/XVimProject/XVim2/blob/master/SIGNING_Xcode.md" target="_blank" rel="noopener">resign</a>. Resigning is very easy — we just need to create a self-signed certificate and call the codesign command. After this, Xcode should be able to load plugins.</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/0*9BeVwHROwO7ls9Z0.png" alt></p>
<pre><code>codesign -f -s MySelfSignedCertificate /Applications/Xcode.app</code></pre><p>It is, however, <strong>not possible</strong> to submit apps built with resigned Xcode as the signature does not match the official version of Xcode. One way is to use two Xcodes: one official for distribution and one resigned for development.</p>
<h2 id="Moving-to-Xcode-extension"><a href="#Moving-to-Xcode-extension" class="headerlink" title="Moving to Xcode extension"></a>Moving to Xcode extension</h2><p>Xcode extension is the way to go, so I started moving my plugins to extension. For Xmas, since it modifies view hierarchy, it can’t become an extension.</p>
<h3 id="Color-literal-in-XcodeColorSense2"><a href="#Color-literal-in-XcodeColorSense2" class="headerlink" title="Color literal in XcodeColorSense2"></a>Color literal in XcodeColorSense2</h3><p>For the color sense, I rewrote the extension from scratch, and called it <a href="https://github.com/onmyway133/XcodeColorSense2" target="_blank" rel="noopener">XcodeColorSense2</a>. This, of course, can’t show an overlay over the current editor view. So I chose to utilize the new Color literal found in Xcode 8+.</p>
<p><img src="https://cdn-images-1.medium.com/max/3800/1*DWeJnAh6xu1-CLfaABornQ.png" alt></p>
<p>The color is shown in a small box. It may be hard to distinguish similar colors, so that’s why I also include the name. The code is simply about inspecting selections and parsing to find the color declaration.</p>
<pre><code>func perform(with invocation: XCSourceEditorCommandInvocation, completionHandler: [@escaping](http://twitter.com/escaping) (Error?) -&gt; Void ) -&gt; Void {
    guard let selection = invocation.buffer.selections.firstObject as? XCSourceTextRange else {
      completionHandler(nil)
      return
    }

let lineNumber = selection.start.line

guard lineNumber &lt; invocation.buffer.lines.count,
      let line = invocation.buffer.lines[lineNumber] as? String else {
      completionHandler(nil)
      return
    }

guard let hex = findHex(string: line) else {
      completionHandler(nil)
      return
    }

let newLine = process(line: line, hex: hex)

invocation.buffer.lines.replaceObject(at: lineNumber, with: newLine)

completionHandler(nil)
  }
}</code></pre><p>Most of the functionality is embedded inside my framework <a href="https://github.com/onmyway133/Farge" target="_blank" rel="noopener">Farge</a>, but I can’t find a way to use the <a href="https://stackoverflow.com/questions/43673353/how-to-use-framework-in-xcode-source-editor-extension" target="_blank" rel="noopener">framework inside Xcode extension</a>.</p>
<p>Since the extension feature is only accessible through the Editor menu, we can customise a key binding to invoke this menu item. For example I choose Cmd+Ctrl+S to show and hide color information.</p>
<p><img src="https://cdn-images-1.medium.com/max/2880/0*r080P3DKAy_-zvJu.png" alt></p>
<p>This is, of course, not intuitive compared to the original plugin, but it’s better than nothing.</p>
<h3 id="How-to-debug-Xcode-extensions"><a href="#How-to-debug-Xcode-extensions" class="headerlink" title="How to debug Xcode extensions"></a>How to debug Xcode extensions</h3><p>Working and debugging extensions is straightforward. We can use Xcode to debug Xcode. The debugged version of Xcode has a gray icon.</p>
<p><img src="https://cdn-images-1.medium.com/max/5580/1*-8Uw2DfLyJKt0cU4Ogcdvg.png" alt></p>
<h3 id="How-to-install-Xcode-extensions"><a href="#How-to-install-Xcode-extensions" class="headerlink" title="How to install Xcode extensions"></a>How to install Xcode extensions</h3><p>The extension must have an accompanying macOS app. This can be distributed to Mac Appstore or self-signed. <a href="https://medium.com/fantageek/install-xcode-8-source-editor-extension-10c9849e33b0" target="_blank" rel="noopener">I’ve written an article on how to do this</a>.</p>
<p>All extensions for an app need to be explicitly enabled through “System Preferences”.</p>
<p><img src="https://cdn-images-1.medium.com/max/NaN/1*6SSRVpyiSoP_QRa9DOO4ew.png" alt></p>
<p>The Xcode extension only works with editor for now, so we must open a source file for the Editor menu to have effect.</p>
<h2 id="AppleScript-in-XcodeWay"><a href="#AppleScript-in-XcodeWay" class="headerlink" title="AppleScript in XcodeWay"></a>AppleScript in XcodeWay</h2><p>In Xcode extensions, NSWorkspace, NSTask and private class construction don’t work anymore. Since I have used Finder Sync Extension in <a href="https://github.com/onmyway133/FinderGo" target="_blank" rel="noopener">FinderGo</a>, I thought I could try the same AppleScript scripting for Xcode extension.</p>
<p><a href="https://developer.apple.com/library/archive/documentation/AppleScript/Conceptual/AppleScriptLangGuide/introduction/ASLR_intro.html" target="_blank" rel="noopener">AppleScript</a> is a scripting language created by Apple. It allows users to directly control scriptable Macintosh applications, as well as parts of macOS itself. You can create scripts — sets of written instructions — to automate repetitive tasks, combine features from multiple scriptable applications, and create complex workflows.</p>
<p>To try AppleScript, you can use the app Script Editor built inside macOS to write prototype functions. Function declaration starts with on and ends with end . To avoid potential conflicts with system functions, I usually use my as a prefix. Here is how I rely on System Events to get the home directory.</p>
<p><a href="https://developer.apple.com/library/archive/documentation/LanguagesUtilities/Conceptual/MacAutomationScriptingGuide/AutomatetheUserInterface.html" target="_blank" rel="noopener">User interface scripting</a> terminology is found in the “Processes Suite” of the “System Events” scripting dictionary. This suite includes terminology for interacting with most types of user interface elements, including:</p>
<ul>
<li><p>windows</p>
</li>
<li><p>buttons</p>
</li>
<li><p>checkboxes</p>
</li>
<li><p>menus</p>
</li>
<li><p>radio buttons</p>
</li>
<li><p>text fields.</p>
</li>
</ul>
<p>In System Events, the process class represents a running app.</p>
<p><img src="https://cdn-images-1.medium.com/max/3248/1*xX3TnFjBX7uDh_Wpid7bzA.png" alt></p>
<p>Many good citizen apps support AppleScript by exposing some of their functionalities, so these can be used by other apps. Here is how I get the current song from Spotify in <a href="https://github.com/onmyway133/Lyrics" target="_blank" rel="noopener">Lyrics</a>.</p>
<pre><code>tell application &quot;Spotify&quot;
  set trackId to id of current track as string
  set trackName to name of current track as string
  set artworkUrl to artwork url of current track as string
  set artistName to artist of current track as string
  set albumName to album of current track as string
  return trackId &amp; &quot;---&quot; &amp; trackName &amp; &quot;---&quot; &amp; artworkUrl &amp; &quot;---&quot; &amp; artistName &amp; &quot;---&quot; &amp; albumName
end tell</code></pre><p>To get all the possible commands of a certain app, we can open the dictionary in Script Editor. There we can learn about which functions and parameters are supported.</p>
<p><img src="https://cdn-images-1.medium.com/max/3664/1*s3c33Gtd9Hq5u1a0pBrkPQ.png" alt></p>
<p>If you think Objective C is hard, AppleScript is much harder. The syntax is verbose and error-prone. For your reference, here is the <a href="https://github.com/onmyway133/XcodeWay/blob/master/XcodeWayExtensions/Script/XcodeWayScript.scpt" target="_blank" rel="noopener">whole script file</a> that powers XcodeWay.</p>
<p>To open a certain folder, tell Finder using POSIX file. I refactor every functionality into function for better code reuse.</p>
<pre><code>on myOpenFolder(myPath)
tell application &quot;Finder&quot;
activate
open myPath as POSIX file
end tell
end myOpenFolder</code></pre><p>Then, to run AppleScript inside a macOS app or extension, we need to construct an <a href="https://github.com/onmyway133/XcodeWay/blob/master/XcodeWayExtensions/Helper/ScriptRunner.swift" target="_blank" rel="noopener">AppleScript descriptor</a> with the correct process serial number and event identifiers.</p>
<pre><code>func eventDescriptior(functionName: String) -&gt; NSAppleEventDescriptor {
  var psn = ProcessSerialNumber(highLongOfPSN: 0, lowLongOfPSN: UInt32(kCurrentProcess))
  let target = NSAppleEventDescriptor(
    descriptorType: typeProcessSerialNumber,
    bytes: &amp;psn,
    length: MemoryLayout&lt;ProcessSerialNumber&gt;.size
  )

let event = NSAppleEventDescriptor(
    eventClass: UInt32(kASAppleScriptSuite),
    eventID: UInt32(kASSubroutineEvent),
    targetDescriptor: target,
    returnID: Int16(kAutoGenerateReturnID),
    transactionID: Int32(kAnyTransactionID)
  )

let function = NSAppleEventDescriptor(string: functionName)
  event.setParam(function, forKeyword: AEKeyword(keyASSubroutineName))

return event
}</code></pre><p>Other tasks, like checking the current Git remote, are a bit trickier. Many times I want to share the link of the file I’m debugging to my remote teammate, so they know what file I’m referencing. This is doable by using shell script inside AppleScript .</p>
<pre><code>on myGitHubURL()
set myPath to myProjectPath()
set myConsoleOutput to (do shell script &quot;cd &quot; &amp; quoted form of myPath &amp; &quot;; git remote -v&quot;)
set myRemote to myGetRemote(myConsoleOutput)
set myUrl to (do shell script &quot;cd &quot; &amp; quoted form of myPath &amp; &quot;; git config --get remote.&quot; &amp; quoted form of myRemote &amp; &quot;.url&quot;)
set myUrlWithOutDotGit to myRemoveSubString(myUrl, &quot;.git&quot;)
end myGitHubURL</code></pre><p>We can use quoted and string concatenation to form strings. Luckily we can expose Foundation framework and certain classes. Here is how I expose NSString to take advantage of all existing functionalities. Writing string manipulation from scratch using plain AppleScript will take lots of time.</p>
<pre><code>use scripting additions
use framework &quot;Foundation&quot;
property NSString : a reference to current application&apos;s NSString</code></pre><p>With this we can build our other functions for string handling.</p>
<pre><code>on myRemoveLastPath(myPath)
set myString to NSString&apos;s stringWithString:myPath
set removedLastPathString to myString&apos;s stringByDeletingLastPathComponent
removedLastPathString as text
end myRemoveLastPath</code></pre><p>One cool feature that XcodeWay supports is the ability to go to the document directory for the current app in the simulator. This is handy when we need to inspect a document to check saved or cached data. The directory is dynamic so it’s hard to detect. We can, however, sort the directory for the most recently updated. Below is how we chain multiple shell scripts commands to find the folder.</p>
<pre><code>on myOpenDocument()
set command1 to &quot;cd ~/Library/Developer/CoreSimulator/Devices/;&quot;
set command2 to &quot;cd `ls -t | head -n 1`/data/Containers/Data/Application;&quot;
set command3 to &quot;cd `ls -t | head -n 1`/Documents;&quot;
set command4 to &quot;open .&quot;
do shell script command1 &amp; command2 &amp; command3 &amp; command4
end myOpenDocument</code></pre><p>This feature helped me a lot when developing <a href="https://github.com/hyperoslo/Gallery" target="_blank" rel="noopener">Gallery</a> to check whether videos and downloaded images are saved in the correct place.</p>
<p>However, none of the scripts seem to work. Scripting has always been part of macOS since 1993. But, with the advent of the Mac Appstore and security concerns, AppleScript finally got restricted in mid 2012. That was when App Sandbox was enforced.</p>
<h3 id="App-Sandbox"><a href="#App-Sandbox" class="headerlink" title="App Sandbox"></a>App Sandbox</h3><p>App Sandbox is an access control technology provided in macOS, enforced at the kernel level. It is designed to contain damage to the system and the user’s data if an app becomes compromised. Apps distributed through the Mac App Store must adopt <a href="https://www.objc.io/issues/14-mac/sandbox-scripting/" target="_blank" rel="noopener">App Sandbox</a>.</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/0*3rbc5Xua7YWg4ouW.png" alt></p>
<p>For an Xcode extension to be loaded by Xcode, it must also support App Sandbox.</p>
<p><img src="https://cdn-images-1.medium.com/max/5588/1*aZe8ZgEI-KLIDb1vXgVKtw.png" alt></p>
<p>At the beginning of App Sandbox enforcement, we could use <a href="https://developer.apple.com/library/archive/documentation/Miscellaneous/Reference/EntitlementKeyReference/Chapters/AppSandboxTemporaryExceptionEntitlements.html" target="_blank" rel="noopener">App Sandbox Temporary Exception</a> to temporarily grant our app access to Apple Script.</p>
<p>This is now not possible.</p>
<p>The only way for AppleScript to run is if it resides inside ~/Library/Application Scripts folder.</p>
<p><img src="https://cdn-images-1.medium.com/max/3956/1*_MnW2BezYsDlw7x6eQifQg.png" alt></p>
<h3 id="How-to-install-custom-scripts"><a href="#How-to-install-custom-scripts" class="headerlink" title="How to install custom scripts"></a>How to install custom scripts</h3><p>macOS apps or extensions can’t just install scripts into the Application Scripts by themselves. They need user consent.</p>
<p>One possible way to do that is to enable Read/Write and show a dialog using NSOpenPanel to ask user to select the folder to install our scripts.</p>
<p><img src="https://cdn-images-1.medium.com/max/3506/1*gpuztyyB9Z3-XDWOnHgn0w.png" alt></p>
<p>For XcodeWay, I choose to provide an <a href="https://github.com/onmyway133/XcodeWay/blob/master/install.sh" target="_blank" rel="noopener">install shell script </a>so the user has a quick way to install scripts.</p>
<pre><code>#!/bin/bash

set -euo pipefail

DOWNLOAD_URL=[https://raw.githubusercontent.com/onmyway133/XcodeWay/master/XcodeWayExtensions/Script/XcodeWayScript.scpt](https://raw.githubusercontent.com/onmyway133/XcodeWay/master/XcodeWayExtensions/Script/XcodeWayScript.scpt)
SCRIPT_DIR=&quot;${HOME}/Library/Application Scripts/com.fantageek.XcodeWayApp.XcodeWayExtensions&quot;

mkdir -p &quot;${SCRIPT_DIR}&quot;
curl $DOWNLOAD_URL -o &quot;${SCRIPT_DIR}/XcodeWayScript.scpt&quot;</code></pre><p>AppleScript is very powerful. All of this is made explicit so the user has complete control over which things can be done.</p>
<p>Like an extension, a script is done asynchronously in a different process using <a href="https://www.objc.io/issues/14-mac/xpc/" target="_blank" rel="noopener">XPC</a> for inter process communication. This enhances security as a script has no access to the address space to our app or extension.</p>
<h2 id="More-security-in-macOS-Mojave"><a href="#More-security-in-macOS-Mojave" class="headerlink" title="More security in macOS Mojave"></a>More security in macOS Mojave</h2><p>This year, at WWDC 2018, Apple introduced macOS Mojave which focuses on lots of security enhancements. In the <a href="https://developer.apple.com/videos/play/wwdc2018/702/" target="_blank" rel="noopener">Your Apps and the Future of macOS Security</a> we can learn more about new security requirement for macOS apps. One of them is the usage description for AppleEvents.</p>
<blockquote>
<h1 id="unable-to-load-info-plist-exceptions-egpu-overrides"><a href="#unable-to-load-info-plist-exceptions-egpu-overrides" class="headerlink" title="unable to load info.plist exceptions (egpu overrides)"></a>unable to load info.plist exceptions (egpu overrides)</h1></blockquote>
<p>We used to declare usage description for many permissions in iOS, like photo library, camera, and push notifications. Now we need to declare the usage description for AppleEvents.</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/0*EQW2d3wyAnC1WSui.jpg" alt="Source: [https://www.felix-schwarz.org/blog/2018/08/new-apple-event-apis-in-macos-mojave](https://www.felix-schwarz.org/blog/2018/08/new-apple-event-apis-in-macos-mojave)"><em>Source: <a href="https://www.felix-schwarz.org/blog/2018/08/new-apple-event-apis-in-macos-mojave" target="_blank" rel="noopener">https://www.felix-schwarz.org/blog/2018/08/new-apple-event-apis-in-macos-mojave</a></em></p>
<p>The first time our extension tries to execute some AppleScript commands, the above dialog is shown to ask for user consent. User can grant or deny permission, but for Xcode please say yes 🙏</p>
<p>The fix for us is to declare NSAppleEventsUsageDescription in our app target. We only need to declare in the app target, not in the extension target.</p>
<pre><code>&lt;key&gt;NSAppleEventsUsageDescription&lt;/key&gt;
&lt;string&gt;Use AppleScript to open folders&lt;/string&gt;</code></pre><h2 id="Where-to-go-from-here"><a href="#Where-to-go-from-here" class="headerlink" title="Where to go from here"></a>Where to go from here</h2><p>Huff huff, whew! Thanks for following such a long journey. Making frameworks and tools take lots of time, especially plugins and extensions — we have to continuously change to adapt them to new operating systems and security requirements. But it is a rewarding process, as we’ve learned more and have some tools to save our precious time.</p>
<p>For your reference, here are my extensions which are fully open source.</p>
<ul>
<li><a href="https://github.com/onmyway133/XcodeWay" target="_blank" rel="noopener">XcodeWay</a></li>
<li><a href="https://github.com/onmyway133/XcodeColorSense2" target="_blank" rel="noopener">XcodeColorSense2</a></li>
</ul>
<p>I hope you find something useful in the post. Here are some resources to help explore Xcode extensions further:</p>
<ul>
<li><a href="https://nshipster.com/xcode-plugins/" target="_blank" rel="noopener">Xcode Plugins by NSHipster</a></li>
<li><a href="http://merowing.info/2015/12/writing-xcode-plugin-in-swift/" target="_blank" rel="noopener">Writing Xcode plugin in Swift</a></li>
<li><a href="https://medium.com/rocknnull/xcode-8-plugins-alcatraz-the-end-of-an-era-ea6e63617d14" target="_blank" rel="noopener">Xcode 8 Plugins (Alcatraz) — The end of an era</a></li>
<li><a href="https://developer.apple.com/videos/play/wwdc2016/414/" target="_blank" rel="noopener">Using and Extending the Xcode Source Editor</a></li>
<li><a href="https://github.com/XVimProject/XVim2/blob/master/why_resign_xcode.md" target="_blank" rel="noopener">Why do I need to resign Xcode to use XVim2</a></li>
</ul>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/xcode/">xcode</a></li></ul>

      
            
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/blog/How-to-add-app-icons-and-splash-screens-to-a-React-Native-app-in-staging-and-production/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          How to add app icons and splash screens to a React Native app in staging and production
        
      </div>
    </a>
  
  
    <a href="/blog/Get-to-know-different-JavaScript-environments-in-React-Native/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Get to know different JavaScript environments in React Native</div>
    </a>
  
</nav>

  
</article>

<!-- Table of Contents -->

  <aside id="sidebar">
    <div id="toc" class="toc-article" style="overflow-y: scroll; max-width: 28%;">
    <strong class="toc-title">Contents</strong>
    
      <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#My-first-Xcode-plugin-XcodeWay"><span class="nav-number">1.</span> <span class="nav-text">My first Xcode plugin: XcodeWay</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#I-choose-a-lazy-person-to-do-a-hard-job-Because-a-lazy-person-will-find-an-easy-way-to-do-it"><span class="nav-number"></span> <span class="nav-text">I choose a lazy person to do a hard job. Because a lazy person will find an easy way to do it</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#What-are-Xcode-plugins"><span class="nav-number">1.</span> <span class="nav-text">What are Xcode plugins?</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#What-Xcode-plugins-can-do"><span class="nav-number">2.</span> <span class="nav-text">What Xcode plugins can do</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Xvim"><span class="nav-number">2.1.</span> <span class="nav-text">Xvim</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SCXcodeMiniMap"><span class="nav-number">2.2.</span> <span class="nav-text">SCXcodeMiniMap</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#FuzzyAutocompletePlugin"><span class="nav-number">2.3.</span> <span class="nav-text">FuzzyAutocompletePlugin</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#KSImageNamed-Xcode"><span class="nav-number">2.4.</span> <span class="nav-text">KSImageNamed-Xcode</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ColorSense-for-Xcode"><span class="nav-number">2.5.</span> <span class="nav-text">ColorSense-for-Xcode</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#LinkedConsole"><span class="nav-number">2.6.</span> <span class="nav-text">LinkedConsole</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#The-hard-work-behind-Xcode-plugins"><span class="nav-number">3.</span> <span class="nav-text">The hard work behind Xcode plugins</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Swizzling-DVTBezelAlertPanel-framework-in-Xmas"><span class="nav-number">3.1.</span> <span class="nav-text">Swizzling DVTBezelAlertPanel framework in Xmas</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Interacting-with-DVTSourceTextView-in-XcodeColorSense"><span class="nav-number">3.2.</span> <span class="nav-text">Interacting with DVTSourceTextView in XcodeColorSense</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Using-NSTask-and-IDEWorkspaceWindowController-in-XcodeWay"><span class="nav-number">3.3.</span> <span class="nav-text">Using NSTask and IDEWorkspaceWindowController in XcodeWay</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Security-and-freedom"><span class="nav-number">4.</span> <span class="nav-text">Security and freedom</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Source-Editor-Extension"><span class="nav-number">4.1.</span> <span class="nav-text">Source Editor Extension</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Unless-you-resign-Xcode"><span class="nav-number">4.2.</span> <span class="nav-text">Unless you resign Xcode</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Moving-to-Xcode-extension"><span class="nav-number">5.</span> <span class="nav-text">Moving to Xcode extension</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Color-literal-in-XcodeColorSense2"><span class="nav-number">5.1.</span> <span class="nav-text">Color literal in XcodeColorSense2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#How-to-debug-Xcode-extensions"><span class="nav-number">5.2.</span> <span class="nav-text">How to debug Xcode extensions</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#How-to-install-Xcode-extensions"><span class="nav-number">5.3.</span> <span class="nav-text">How to install Xcode extensions</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#AppleScript-in-XcodeWay"><span class="nav-number">6.</span> <span class="nav-text">AppleScript in XcodeWay</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#App-Sandbox"><span class="nav-number">6.1.</span> <span class="nav-text">App Sandbox</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#How-to-install-custom-scripts"><span class="nav-number">6.2.</span> <span class="nav-text">How to install custom scripts</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#More-security-in-macOS-Mojave"><span class="nav-number">7.</span> <span class="nav-text">More security in macOS Mojave</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#unable-to-load-info-plist-exceptions-egpu-overrides"><span class="nav-number"></span> <span class="nav-text">unable to load info.plist exceptions (egpu overrides)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Where-to-go-from-here"><span class="nav-number">1.</span> <span class="nav-text">Where to go from here</span></a></li></ol>
    
    </div>
  </aside>
</section>
        
      </div>
      <footer id="footer" class="site-footer">
  

  <div class="clearfix container">
      <div class="site-info">
	      &copy; 2020 onmyway133 All Rights Reserved.
          
      </div>
      <div class="site-credit">
        Theme by <a href="https://github.com/iTimeTraveler/hexo-theme-hiero" target="_blank">hiero</a>
      </div>
  </div>
</footer>


<!-- min height -->

<script>
    var contentdiv = document.getElementById("content");

    contentdiv.style.minHeight = document.body.offsetHeight - document.getElementById("allheader").offsetHeight - document.getElementById("footer").offsetHeight + "px";
</script>

<!-- Custome JS -->
<script src="/js/my.js"></script>
    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/about/" class="mobile-nav-link">About</a>
  
    <a href="/writing/" class="mobile-nav-link">Writing</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/speaking/" class="mobile-nav-link">Speaking</a>
  
    <a href="/opensource/" class="mobile-nav-link">Open Source</a>
  
    <a href="/projects/" class="mobile-nav-link">Projects</a>
  
    <a href="/news/" class="mobile-nav-link">News</a>
  
    <a href="/gumroad/" class="mobile-nav-link">Gumroad</a>
  
    <a href="/atom.xml" class="mobile-nav-link">RSS</a>
  
</nav> -->
    

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>



  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.js"></script>


<script src="/js/scripts.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>


<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-40119591-5', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->












  </div>

  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/js/totop.js" async=""></script>
</body>
</html>
