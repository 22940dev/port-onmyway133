<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">

  <!-- PACE Progress Bar START -->
  
    <script src="https://raw.githubusercontent.com/HubSpot/pace/v1.0.2/pace.min.js"></script>
    <link rel="stylesheet" href="https://github.com/HubSpot/pace/raw/master/themes/orange/pace-theme-flash.css">
  
  

  <!-- PACE Progress Bar START -->

  
  <title>collection update | onmyway133</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <meta name="keywords" content="swiftiOS">
  
  
  
  
  <meta name="description" content="Issue #119 This is about collection update, how to provide correct IndexPath and a simple diffing algorithm  Excerpt from my talk at CocoaHeads, Oslo https://www.meetup.com/CocoaHeads-Oslo/events/2448">
<meta name="keywords" content="swift,iOS">
<meta property="og:type" content="article">
<meta property="og:title" content="Collection Update">
<meta property="og:url" content="https://onmyway133.github.io/blog/Collection-Update/index.html">
<meta property="og:site_name" content="onmyway133">
<meta property="og:description" content="Issue #119 This is about collection update, how to provide correct IndexPath and a simple diffing algorithm  Excerpt from my talk at CocoaHeads, Oslo https://www.meetup.com/CocoaHeads-Oslo/events/2448">
<meta property="og:locale" content="en">
<meta property="og:image" content="https://user-images.githubusercontent.com/2284279/34838146-55461fbc-f6fd-11e7-928f-b5461a51893f.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/2284279/33726942-d084fa74-db76-11e7-95e0-6580f4c5fc9d.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/2284279/33727113-647cfe34-db77-11e7-8533-4dd84657e718.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/2284279/33727115-6499e350-db77-11e7-8030-971bd9a29040.png">
<meta property="og:image" content="https://developer.apple.com/library/content/documentation/UserExperience/Conceptual/TableView_iPhone/Art/batch_insert_delete.jpg">
<meta property="og:image" content="https://user-images.githubusercontent.com/2284279/33278613-5dc25c70-d39c-11e7-8a5c-2e8e6946ae36.jpg">
<meta property="og:image" content="https://user-images.githubusercontent.com/2284279/33243688-2bade616-d2eb-11e7-8463-f913695818ef.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/2284279/33243726-c078ee3a-d2eb-11e7-918f-8bba30be0c0e.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/2284279/33243911-9f1e87d8-d2ee-11e7-8dde-bb2f02593eca.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/2284279/33243912-9f371230-d2ee-11e7-8386-85ed3f9f4bcf.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/2284279/33243913-9f4ed1ea-d2ee-11e7-9fae-71693ec1844d.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/2284279/35505204-a7b5f0f6-04e5-11e8-8124-4e8868f2ea8d.png">
<meta property="og:image" content="https://github.com/onmyway133/DeepDiff/raw/master/Screenshots/collection.gif">
<meta property="og:updated_time" content="2019-11-12T11:52:32.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Collection Update">
<meta name="twitter:description" content="Issue #119 This is about collection update, how to provide correct IndexPath and a simple diffing algorithm  Excerpt from my talk at CocoaHeads, Oslo https://www.meetup.com/CocoaHeads-Oslo/events/2448">
<meta name="twitter:image" content="https://user-images.githubusercontent.com/2284279/34838146-55461fbc-f6fd-11e7-928f-b5461a51893f.png">
  
    <link rel="alternate" href="/atom.xml" title="onmyway133" type="application/atom+xml">
  
  <link rel="icon" href="/favicon.ico">
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="https://cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <style type="text/css">
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/9749f0/00000000000000000001008f/27/l?subset_id=2&fvd=n5) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/90cf9f/000000000000000000010091/27/l?subset_id=2&fvd=n7) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/8a5494/000000000000000000013365/27/l?subset_id=2&fvd=n4) format("woff2");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/d337d8/000000000000000000010095/27/l?subset_id=2&fvd=i4) format("woff2");font-weight:400;font-style:italic;}</style>
    
  <link rel="stylesheet" id="athemes-headings-fonts-css" href="//fonts.googleapis.com/css?family=Yanone+Kaffeesatz%3A200%2C300%2C400%2C700&amp;ver=4.6.1" type="text/css" media="all">
  <link rel="stylesheet" href="/css/style.css">

  <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.0.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/hiero.css">
  <link rel="stylesheet" href="/css/glyphs.css">
  

  <!-- Custom CSS -->
  <link rel="stylesheet" href="/css/my.css">
  <!-- Google Adsense -->
  
</head>
</html>
<script>
var themeMenus = {};

  themeMenus["/"] = "Home"; 

  themeMenus["/about/"] = "About"; 

  themeMenus["/writing/"] = "writing"; 

  themeMenus["/archives"] = "Archives"; 

  themeMenus["/speaking/"] = "speaking"; 

  themeMenus["/opensource/"] = "open source"; 

  themeMenus["/projects/"] = "projects"; 

  themeMenus["/news/"] = "news"; 

  themeMenus["/gumroad/"] = "gumroad"; 

  themeMenus["/atom.xml"] = "rss"; 

</script>


  <body data-spy="scroll" data-target="#toc" data-offset="50">


  <header id="allheader" class="site-header" role="banner">
  <div class="clearfix container">
      <div class="site-branding">

          <h1 class="site-title">
            
              <a href="/" title="onmyway133" rel="home"> onmyway133 </a>
            
          </h1>

          
            <div class="site-description">What you don&#39;t know is what you haven&#39;t learned</div>
          
            
          <nav id="main-navigation" class="main-navigation" role="navigation">
            <a class="nav-open">Menu</a>
            <a class="nav-close">Close</a>
            <div class="clearfix sf-menu">

              <ul id="main-nav" class="nmenu sf-js-enabled">
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/">Home</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/about/">About</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/writing/">writing</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/archives">Archives</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/speaking/">speaking</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/opensource/">open source</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/projects/">projects</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/news/">news</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/gumroad/">gumroad</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/atom.xml">rss</a> </li>
                    
              </ul>
            </div>
          </nav>


      </div>
  </div>
</header>


  <div id="originBgDiv" style="background: #fff; width: 100%;">

      <div style="max-height:600px; overflow: hidden;  display: flex; display: -webkit-flex; align-items: center;">
        <img id="originBg" width="100%" alt="" src="">
      </div>

  </div>

  <script>
  function setAboutIMG(){
      var imgUrls = "https://avatars1.githubusercontent.com/u/2284279?s=460&v=4".split(",");
      var random = Math.floor((Math.random() * imgUrls.length ));
      if (imgUrls[random].startsWith('http') || imgUrls[random].indexOf('://') >= 0) {
        document.getElementById("originBg").src=imgUrls[random];
      } else {
        document.getElementById("originBg").src='/' + imgUrls[random];
      }
  }
  bgDiv=document.getElementById("originBgDiv");
  if(location.pathname.match('about')){
    setAboutIMG();
    bgDiv.style.display='block';
  }else{
    bgDiv.style.display='none';
  }
  </script>



  <div id="container">
    <div id="wrap">
            
      <div id="content" class="outer">
        
          <section id="main" style="float:none;"><article id="post-Collection-Update" style="width: 66%; float:left;" class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" class="article-title" itemprop="name">
      Collection Update
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	Posted on <a href="/blog/Collection-Update/" class="article-date">
	  <time datetime="2017-12-07T15:22:39.000Z" itemprop="datePublished">December 7, 2017</time>
	</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/119" target="_blank" rel="noopener">#119</a></strong></p>
<p>This is about collection update, how to provide correct IndexPath and a simple diffing algorithm</p>
<ul>
<li>Excerpt from my talk at CocoaHeads, Oslo <a href="https://www.meetup.com/CocoaHeads-Oslo/events/244892347/" target="_blank" rel="noopener">https://www.meetup.com/CocoaHeads-Oslo/events/244892347/</a></li>
<li>Slide <a href="https://speakerdeck.com/onmyway133/collection-update" target="_blank" rel="noopener">https://speakerdeck.com/onmyway133/collection-update</a></li>
</ul>
<h2 id="CollectionView"><a href="#CollectionView" class="headerlink" title="CollectionView"></a>CollectionView</h2><p>It’s hard to imagine of any apps that don’t use Table View or CollectionView. And by CollectionView, I actually mean UICollectionView 😉  . Most of the time, we show something with response from backend, then potentially update and insert new items as data changed.</p>
<p><img src="https://user-images.githubusercontent.com/2284279/34838146-55461fbc-f6fd-11e7-928f-b5461a51893f.png" alt="collectionview"></p>
<p>We can totally call <code>reloadData</code> to reflect the changes, but an animation is better here as it gives user better understanding of what’s going on, and to not surprise them. </p>
<p>This talks about <code>UICollectionView</code>, but <code>UITableView</code> behaves the same</p>
<h2 id="Drag-and-Drop"><a href="#Drag-and-Drop" class="headerlink" title="Drag and Drop"></a>Drag and Drop</h2><p>Let’s imagine an app where user are allowed to customise their experience by moving items from one collection to another.</p>
<p>You can take a look at the example <a href="https://github.com/onmyway133/CollectionUpdateExample/tree/master/DragAndDrop" target="_blank" rel="noopener">DragAndDrop</a> which is using the new <a href="https://developer.apple.com/ios/drag-and-drop/" target="_blank" rel="noopener">drag and drop API</a> in iOS 11.</p>
<p><img src="https://user-images.githubusercontent.com/2284279/33726942-d084fa74-db76-11e7-95e0-6580f4c5fc9d.png" alt="ipad"></p>
<p>You must ensure that your data is changed before calling update methods on <code>UICollectionView</code>. And then we call <code>deleteItems</code> and <code>insertItems</code> to reflect data changes. <code>UICollectionView</code> performs a nice animation for you</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">collectionView</span><span class="params">(<span class="number">_</span> collectionView: UICollectionView, performDropWith coordinator: UICollectionViewDropCoordinator)</span></span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> destinationIndexPath = coordinator.destinationIndexPath</span><br><span class="line">  <span class="keyword">let</span> sourceIndexPath = coordinator.items.last?.dragItem.localObject <span class="keyword">as</span>! <span class="type">IndexPath</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// remove</span></span><br><span class="line">  sourceItems.remove(at: sourceIndexPath.item)</span><br><span class="line">  sourceCollectionView.deleteItems(at: [sourceIndexPath])</span><br><span class="line"></span><br><span class="line">  <span class="comment">// insert</span></span><br><span class="line">  destinationItems.insert(draggedItem, at: destinationIndexPath.item)</span><br><span class="line">  destinationCollectionView.insertItems(at: [destinationIndexPath])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="NSInternalInconsistencyException"><a href="#NSInternalInconsistencyException" class="headerlink" title="NSInternalInconsistencyException"></a>NSInternalInconsistencyException</h2><p>If you have large number of items with many insertions and deletions from backend response, you need to calculate the correct IndexPath to call, which are not easy thing. Most the time you will get the following crashes</p>
<blockquote>
<p>Terminating app due to uncaught exception ‘NSInternalInconsistencyException’,<br>reason: ‘Invalid update: invalid number of items in section 0.<br>The number of items contained in an existing section after the update (213)<br>must be equal to the number of items contained in that section before<br>the update (154), plus or minus the number of items inserted or<br>deleted from that section (40 inserted, 0 deleted) and plus<br>or minus the number of items moved into or out of<br>that section (0 moved in, 0 moved out).’</p>
</blockquote>
<p>In my experience it happened randomly because everyone has different data. Although the message is very descriptive, it may take a while to figure it out.</p>
<h2 id="Game-of-IndexPath"><a href="#Game-of-IndexPath" class="headerlink" title="Game of IndexPath"></a>Game of IndexPath</h2><p>Let’s refine our knowledge of <code>IndexPath</code> by going through some examples. With a collection of 6 items, we perform some update operations and figure out what <code>IndexPath</code> should be. </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">items = [<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>, <span class="string">"d"</span>, <span class="string">"e"</span>, <span class="string">"f"</span>]</span><br></pre></td></tr></table></figure>

<p>Take a look at my example here <a href="https://github.com/onmyway133/CollectionUpdateExample/tree/master/CollectionUpdateExample" target="_blank" rel="noopener">CollectionUpdateExample</a>, there are many more examples</p>
<div align="center">
<img src="https://user-images.githubusercontent.com/2284279/33727113-647cfe34-db77-11e7-8533-4dd84657e718.png" height="400">
<img src="https://user-images.githubusercontent.com/2284279/33727115-6499e350-db77-11e7-8030-971bd9a29040.png" height="400">
</div>

<h2 id="index-vs-offset"><a href="#index-vs-offset" class="headerlink" title="index vs offset"></a>index vs offset</h2><p>Before we go any further, I just want to mention that, by <code>index</code> I actually mean <code>offset from the start</code>. If you take a look at the <a href="https://developer.apple.com/documentation/swift/array/1687832-enumerated" target="_blank" rel="noopener">enumerated</a> function, it suggests the name as <code>offset</code> instead of <code>index</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Array</span>(<span class="number">0</span>..&lt;<span class="number">10</span>).enumerated().forEach &#123; (offset, element) <span class="keyword">in</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This <a href="https://en.wikipedia.org/wiki/Zero-based_numbering" target="_blank" rel="noopener">zero based numbering</a> could shed some light on this matter</p>
<blockquote>
<p>Particularly in C, where arrays are closely tied to pointer arithmetic, this makes for a simpler implementation: the subscript refers to an offset from the starting position of an array, so the first element has an offset of zero.</p>
</blockquote>
<h3 id="1-Insert-3-items-at-the-end"><a href="#1-Insert-3-items-at-the-end" class="headerlink" title="1.  Insert 3 items at the end"></a>1.  Insert 3 items at the end</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">items.append(contentsOf: [<span class="string">"g"</span>, <span class="string">"h"</span>, <span class="string">"i"</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">// a, b, c, d, e, f, g, h, i</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> indexPaths = <span class="type">Array</span>(<span class="number">6</span>...<span class="number">8</span>).<span class="built_in">map</span> &#123; <span class="type">IndexPath</span>(item: $<span class="number">0</span>, section: <span class="number">0</span>) &#125;</span><br><span class="line">collectionView.insertItems(at: indexPaths)</span><br></pre></td></tr></table></figure>

<h3 id="2-Delete-3-items-at-the-end"><a href="#2-Delete-3-items-at-the-end" class="headerlink" title="2. Delete 3 items at the end"></a>2. Delete 3 items at the end</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">items.removeLast()</span><br><span class="line">items.removeLast()</span><br><span class="line">items.removeLast()</span><br><span class="line"></span><br><span class="line"><span class="comment">// a, b, c</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> indexPaths = <span class="type">Array</span>(<span class="number">3</span>...<span class="number">5</span>).<span class="built_in">map</span> &#123; <span class="type">IndexPath</span>(item: $<span class="number">0</span>, section: <span class="number">0</span>) &#125;</span><br><span class="line">collectionView.deleteItems(at: indexPaths)</span><br></pre></td></tr></table></figure>

<h3 id="3-Update-item-at-index-2"><a href="#3-Update-item-at-index-2" class="headerlink" title="3. Update item at index 2"></a>3. Update item at index 2</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">items[<span class="number">2</span>] = <span class="string">"👻"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// a, b, 👻, d, e, f</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> indexPath = <span class="type">IndexPath</span>(item: <span class="number">2</span>, section: <span class="number">0</span>)</span><br><span class="line">collectionView.reloadItems(at: [indexPath])</span><br></pre></td></tr></table></figure>

<h3 id="4-Move-item-“c”-to-the-end"><a href="#4-Move-item-“c”-to-the-end" class="headerlink" title="4. Move item “c” to the end"></a>4. Move item “c” to the end</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">items.remove(at: <span class="number">2</span>)</span><br><span class="line">items.append(<span class="string">"c"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// a, b, d, e, f, c</span></span><br><span class="line"></span><br><span class="line">collectionView.moveItem(</span><br><span class="line">  at: <span class="type">IndexPath</span>(item: <span class="number">2</span>, section: <span class="number">0</span>),</span><br><span class="line">  to: <span class="type">IndexPath</span>(item: <span class="number">5</span>, section :<span class="number">0</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="5-Delete-3-items-at-the-beginning-then-insert-3-items-at-the-end"><a href="#5-Delete-3-items-at-the-beginning-then-insert-3-items-at-the-end" class="headerlink" title="5. Delete 3 items at the beginning, then insert 3 items at the end"></a>5. Delete 3 items at the beginning, then insert 3 items at the end</h3><p>With multiple different operations, we should use <a href="https://developer.apple.com/documentation/uikit/uicollectionview/1618045-performbatchupdates" target="_blank" rel="noopener">performBatchUpdates</a></p>
<blockquote>
<p>You can use this method in cases where you want to make multiple changes to the collection view in one single animated operation, as opposed to in several separate animations. You might use this method to insert, delete, reload, or move cells or use it to change the layout parameters associated with one or more cells</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">items.removeFirst()</span><br><span class="line">items.removeFirst()</span><br><span class="line">items.removeFirst()</span><br><span class="line"></span><br><span class="line">items.append(contentsOf: [<span class="string">"g"</span>, <span class="string">"h"</span>, <span class="string">"i"</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">// d, e, f, g, h, i</span></span><br><span class="line"></span><br><span class="line">collectionView.performBatchUpdates(&#123;</span><br><span class="line">  <span class="keyword">let</span> deleteIndexPaths = <span class="type">Array</span>(<span class="number">0</span>...<span class="number">2</span>).<span class="built_in">map</span> &#123; <span class="type">IndexPath</span>(item: $<span class="number">0</span>, section: <span class="number">0</span>) &#125;</span><br><span class="line">  collectionView.deleteItems(at: deleteIndexPaths)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> insertIndexPaths = <span class="type">Array</span>(<span class="number">3</span>...<span class="number">5</span>).<span class="built_in">map</span> &#123; <span class="type">IndexPath</span>(item: $<span class="number">0</span>, section: <span class="number">0</span>) &#125;</span><br><span class="line">  collectionView.insertItems(at: insertIndexPaths)</span><br><span class="line">&#125;, completion: <span class="literal">nil</span>)</span><br></pre></td></tr></table></figure>

<h3 id="6-Insert-3-items-at-the-end-then-delete-3-items-beginning"><a href="#6-Insert-3-items-at-the-end-then-delete-3-items-beginning" class="headerlink" title="6. Insert 3 items at the end, then delete 3 items beginning"></a>6. Insert 3 items at the end, then delete 3 items beginning</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">items.append(contentsOf: [<span class="string">"g"</span>, <span class="string">"h"</span>, <span class="string">"i"</span>])</span><br><span class="line"></span><br><span class="line">items.removeFirst()</span><br><span class="line">items.removeFirst()</span><br><span class="line">items.removeFirst()</span><br><span class="line"></span><br><span class="line"><span class="comment">// d, e, f, g, h, i</span></span><br><span class="line"></span><br><span class="line">collectionView.performBatchUpdates(&#123;</span><br><span class="line">  <span class="keyword">let</span> insertIndexPaths = <span class="type">Array</span>(<span class="number">6</span>...<span class="number">8</span>).<span class="built_in">map</span> &#123; <span class="type">IndexPath</span>(item: $<span class="number">0</span>, section: <span class="number">0</span>) &#125;</span><br><span class="line">  collectionView.insertItems(at: insertIndexPaths)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> deleteIndexPaths = <span class="type">Array</span>(<span class="number">0</span>...<span class="number">2</span>).<span class="built_in">map</span> &#123; <span class="type">IndexPath</span>(item: $<span class="number">0</span>, section: <span class="number">0</span>) &#125;</span><br><span class="line">  collectionView.deleteItems(at: deleteIndexPaths)</span><br><span class="line">&#125;, completion: <span class="literal">nil</span>)</span><br></pre></td></tr></table></figure>

<h2 id="🙀"><a href="#🙀" class="headerlink" title="🙀"></a>🙀</h2><p>If you run the example 6, you will get a crash</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Terminating app due to uncaught exception </span><br><span class="line">&apos;NSInternalInconsistencyException&apos;, </span><br><span class="line">reason: &apos;attempt to insert item 6 into section 0, </span><br><span class="line">but there are only 6 items in section 0 after the update&apos;</span><br></pre></td></tr></table></figure>

<h2 id="performBatchUpdates"><a href="#performBatchUpdates" class="headerlink" title="performBatchUpdates"></a>performBatchUpdates</h2><p>It is because the way <code>performBatchUpdates</code> works. If you take a look at the <a href="https://developer.apple.com/documentation/uikit/uicollectionview/1618045-performbatchupdates" target="_blank" rel="noopener">documentation</a></p>
<blockquote>
<p>Deletes are processed before inserts in batch operations. This means the indexes for the deletions are processed relative to the indexes of the collection view’s state before the batch operation, and the indexes for the insertions are processed relative to the indexes of the state after all the deletions in the batch operation.</p>
</blockquote>
<p>No matter how we call insert or delete, <code>performBatchUpdates</code> always performs deletions first. So we need to call <code>deleteItems</code> and <code>insertItems</code> as if the deletions occur first.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">items.append(contentsOf: [<span class="string">"g"</span>, <span class="string">"h"</span>, <span class="string">"i"</span>])</span><br><span class="line"></span><br><span class="line">items.removeFirst()</span><br><span class="line">items.removeFirst()</span><br><span class="line">items.removeFirst()</span><br><span class="line"></span><br><span class="line"><span class="comment">// d, e, f, g, h, i</span></span><br><span class="line"></span><br><span class="line">collectionView.performBatchUpdates(&#123;</span><br><span class="line">  <span class="keyword">let</span> deleteIndexPaths = <span class="type">Array</span>(<span class="number">0</span>...<span class="number">2</span>).<span class="built_in">map</span> &#123; <span class="type">IndexPath</span>(item: $<span class="number">0</span>, section: <span class="number">0</span>) &#125;</span><br><span class="line">  collectionView.deleteItems(at: deleteIndexPaths)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> insertIndexPaths = <span class="type">Array</span>(<span class="number">3</span>...<span class="number">5</span>).<span class="built_in">map</span> &#123; <span class="type">IndexPath</span>(item: $<span class="number">0</span>, section: <span class="number">0</span>) &#125;</span><br><span class="line">  collectionView.insertItems(at: insertIndexPaths)</span><br><span class="line">&#125;, completion: <span class="literal">nil</span>)</span><br></pre></td></tr></table></figure>

<h2 id="Operations"><a href="#Operations" class="headerlink" title="Operations"></a>Operations</h2><p>There are many operations on <code>UICollectionView</code>, and there are operations to update whole section as well. Take a look <a href="https://developer.apple.com/library/content/documentation/UserExperience/Conceptual/TableView_iPhone/ManageInsertDeleteRow/ManageInsertDeleteRow.html" target="_blank" rel="noopener">Ordering of Operations and Index Paths</a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">insertItems(at indexPaths: [<span class="type">IndexPath</span>])</span><br><span class="line">deleteItems(at indexPaths: [<span class="type">IndexPath</span>])</span><br><span class="line">reloadItems(at indexPaths: [<span class="type">IndexPath</span>])</span><br><span class="line">moveItem(at indexPath: <span class="type">IndexPath</span>, to newIndexPath: <span class="type">IndexPath</span>)</span><br><span class="line">performBatchUpdates(<span class="number">_</span> updates, completion)</span><br></pre></td></tr></table></figure>

<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">insertSections(<span class="number">_</span> sections: <span class="type">IndexSet</span>)</span><br><span class="line">deleteSections(<span class="number">_</span> sections: <span class="type">IndexSet</span>)</span><br><span class="line">reloadSections(<span class="number">_</span> sections: <span class="type">IndexSet</span>)</span><br><span class="line">moveSection(<span class="number">_</span> section: <span class="type">Int</span>, toSection newSection: <span class="type">Int</span>)</span><br></pre></td></tr></table></figure>

<p><img src="https://developer.apple.com/library/content/documentation/UserExperience/Conceptual/TableView_iPhone/Art/batch_insert_delete.jpg" alt="inline"></p>
<h2 id="Edit-distance"><a href="#Edit-distance" class="headerlink" title="Edit distance"></a>Edit distance</h2><p>Doing these calculations by hand is quite tedious and error prone. We can build our own abstraction using some algorithms. The naive one is <a href="https://en.wikipedia.org/wiki/Wagner%E2%80%93Fischer_algorithm" target="_blank" rel="noopener">Wagner–Fischer algorithm</a> which uses <a href="https://en.wikipedia.org/wiki/Dynamic_programming" target="_blank" rel="noopener">Dynamic Programming</a> to tell the edit distance between two strings of characters.</p>
<p>Edit distance means the number of steps needed to change from one string to another. String is just a collection of characters, so we can generalise this concept to make it work for any collection of items. Instead of comparing character, we require items to conform to <code>Equatable</code></p>
<h2 id="“kit”-gt-“kat”"><a href="#“kit”-gt-“kat”" class="headerlink" title="“kit” -&gt; “kat”"></a>“kit” -&gt; “kat”</h2><p>How can we transform form the word “kit” to “kat”? What kinds of operations do we nede to perform? You may tell “just change the i to a”, but this trivial example helps you understand the algorithm. Let’s get started.</p>
<p><img src="https://user-images.githubusercontent.com/2284279/33278613-5dc25c70-d39c-11e7-8a5c-2e8e6946ae36.jpg" alt="inline"></p>
<h3 id="Deletions"><a href="#Deletions" class="headerlink" title="Deletions"></a>Deletions</h3><p>If we go from “kit” to an empty string “”, we need 3 deletions </p>
<p><img src="https://user-images.githubusercontent.com/2284279/33243688-2bade616-d2eb-11e7-8463-f913695818ef.png" alt="inline"></p>
<p>“k” -&gt; “”  👉 1 deletion<br>“ki” -&gt; “” 👉 2 deletions<br>“kit” -&gt; “” 👉    3 deletions</p>
<h3 id="Insertions"><a href="#Insertions" class="headerlink" title="Insertions"></a>Insertions</h3><p>If we go from an empty string “” to “kat”, we need 3 insertions</p>
<p><img src="https://user-images.githubusercontent.com/2284279/33243726-c078ee3a-d2eb-11e7-918f-8bba30be0c0e.png" alt="inline"></p>
<p>“” -&gt; “k”  👉    1 insertion<br>“” -&gt; “ka”  👉    2 insertions<br>“” -&gt; “kat”  👉    3 insertions</p>
<h3 id="If-equal-take-value-from-the-top-left"><a href="#If-equal-take-value-from-the-top-left" class="headerlink" title="If equal, take value from the top left"></a>If equal, take value from the top left</h3><p>You can think of the algorithm as if we go from source string, to empty string, to destination string. We try to find the minimum steps to update. Going horizontally means insertions, vertically means deletions and diagonally means substitutions</p>
<p>This way we can build our matrix, iterate from row to row, column by column. First, the letter “k” from source collection is the same with letter “k” from destination collection, we simply take value from the top left, which is 0 substituion</p>
<p><img src="https://user-images.githubusercontent.com/2284279/33243911-9f1e87d8-d2ee-11e7-8dde-bb2f02593eca.png" alt="inline"></p>
<h3 id="If-not-equal"><a href="#If-not-equal" class="headerlink" title="If not equal"></a>If not equal</h3><p>We continue with the next letter from the destination collection. Here “k” and “a” are not the same. We take minimum value from left, top, top left. Then increase by one</p>
<p><img src="https://user-images.githubusercontent.com/2284279/33243912-9f371230-d2ee-11e7-8386-85ed3f9f4bcf.png" alt="inline"></p>
<p>Here we take value from left, which is horizontally, so we increase by 1 insertion</p>
<h3 id="“k”-gt-“kat”-👉-2-insertions"><a href="#“k”-gt-“kat”-👉-2-insertions" class="headerlink" title="“k” -&gt; “kat” 👉 2 insertions"></a>“k” -&gt; “kat” 👉 2 insertions</h3><p>Continue, they are not the same, so we take value from left horizontally. Here you can see it kind makes sense, as to go from “k” to “kat”, we need 2 insertions, which is to insert letters “a” and “t”</p>
<p><img src="https://user-images.githubusercontent.com/2284279/33243913-9f4ed1ea-d2ee-11e7-9fae-71693ec1844d.png" alt="inline"></p>
<h3 id="The-bottom-right-value"><a href="#The-bottom-right-value" class="headerlink" title="The bottom right value"></a>The bottom right value</h3><p>Continue with the next row, and next row until we  got to the bottom right value, which gives you the edit distance. Here 1 substitution means that we need to perform 1 substitution to go from “kit” to “kat”, which is update “i” with “a’</p>
<p><img src="https://user-images.githubusercontent.com/2284279/35505204-a7b5f0f6-04e5-11e8-8124-4e8868f2ea8d.png" alt="final"></p>
<p>You can easily see that we need to update index 1. But how do we know that it is index 1 🤔 </p>
<h2 id="Edit-steps"><a href="#Edit-steps" class="headerlink" title="Edit steps"></a>Edit steps</h2><p>In each step, we need to associate the index of item in source and destination collection. You can take a look at my implementation <a href="https://github.com/onmyway133/DeepDiff" target="_blank" rel="noopener">DeepDiff</a></p>
<p><img src="https://github.com/onmyway133/DeepDiff/raw/master/Screenshots/collection.gif" alt="inline"></p>
<h2 id="Complexity"><a href="#Complexity" class="headerlink" title="Complexity"></a>Complexity</h2><p>We iterate through the matrix, with <code>m</code> and <code>n</code> are the length of source and destination collection respectively, we can see that the complexity of this algorithm is 0(mn).</p>
<p>Also the performance greatly depends on the size of the collection and how complex the item is. The more complex and how deep you want to perform <code>Equatable</code> can greatly affect your performance.</p>
<h2 id="Improving-performance"><a href="#Improving-performance" class="headerlink" title="Improving performance"></a>Improving performance</h2><p>The section <a href="https://github.com/onmyway133/DeepDiff#how-does-it-work" target="_blank" rel="noopener">How does it work</a> shows several ways we can improve performance.</p>
<p>Firstly, instead of building a matrix, which costs memory <code>m*n</code>, we can just use temporary arrays as holder. </p>
<p>Secondly, to quickly compare 2 items, we can use <code>Hashable</code>, as 2 identical items will always have the same hash.</p>
<h2 id="More-performance"><a href="#More-performance" class="headerlink" title="More performance"></a>More performance</h2><p>If you want better performance, then algorithms with linear complexity may be interested to you. Take a look at <a href="https://github.com/onmyway133/blog/issues/99" target="_blank" rel="noopener">Diff algorithm</a></p>
<ul>
<li><a href="http://documents.scribd.com/docs/10ro9oowpo1h81pgh1as.pdf" target="_blank" rel="noopener">Heckel</a></li>
<li><a href="https://publications.mpi-cbg.de/Wu_1990_6334.pdf" target="_blank" rel="noopener">Wu</a></li>
<li><a href="http://www.xmailserver.org/diff2.pdf" target="_blank" rel="noopener">Myers</a></li>
</ul>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/">iOS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/swift/">swift</a></li></ul>

      
            
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/blog/A-taste-of-MVVM-and-Reactive-paradigm/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          A taste of MVVM and Reactive paradigm
        
      </div>
    </a>
  
  
    <a href="/blog/Commit-as-another-user-on-GitHub/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Commit as another user on GitHub</div>
    </a>
  
</nav>

  
</article>

<!-- Table of Contents -->

  <aside id="sidebar">
    <div id="toc" class="toc-article" style="overflow-y: scroll; max-width: 28%;">
    <strong class="toc-title">Contents</strong>
    
      <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#CollectionView"><span class="nav-number">1.</span> <span class="nav-text">CollectionView</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Drag-and-Drop"><span class="nav-number">2.</span> <span class="nav-text">Drag and Drop</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#NSInternalInconsistencyException"><span class="nav-number">3.</span> <span class="nav-text">NSInternalInconsistencyException</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Game-of-IndexPath"><span class="nav-number">4.</span> <span class="nav-text">Game of IndexPath</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#index-vs-offset"><span class="nav-number">5.</span> <span class="nav-text">index vs offset</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-Insert-3-items-at-the-end"><span class="nav-number">5.1.</span> <span class="nav-text">1.  Insert 3 items at the end</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-Delete-3-items-at-the-end"><span class="nav-number">5.2.</span> <span class="nav-text">2. Delete 3 items at the end</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-Update-item-at-index-2"><span class="nav-number">5.3.</span> <span class="nav-text">3. Update item at index 2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-Move-item-“c”-to-the-end"><span class="nav-number">5.4.</span> <span class="nav-text">4. Move item “c” to the end</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-Delete-3-items-at-the-beginning-then-insert-3-items-at-the-end"><span class="nav-number">5.5.</span> <span class="nav-text">5. Delete 3 items at the beginning, then insert 3 items at the end</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-Insert-3-items-at-the-end-then-delete-3-items-beginning"><span class="nav-number">5.6.</span> <span class="nav-text">6. Insert 3 items at the end, then delete 3 items beginning</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#🙀"><span class="nav-number">6.</span> <span class="nav-text">🙀</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#performBatchUpdates"><span class="nav-number">7.</span> <span class="nav-text">performBatchUpdates</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Operations"><span class="nav-number">8.</span> <span class="nav-text">Operations</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Edit-distance"><span class="nav-number">9.</span> <span class="nav-text">Edit distance</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#“kit”-gt-“kat”"><span class="nav-number">10.</span> <span class="nav-text">“kit” -&gt; “kat”</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Deletions"><span class="nav-number">10.1.</span> <span class="nav-text">Deletions</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Insertions"><span class="nav-number">10.2.</span> <span class="nav-text">Insertions</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#If-equal-take-value-from-the-top-left"><span class="nav-number">10.3.</span> <span class="nav-text">If equal, take value from the top left</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#If-not-equal"><span class="nav-number">10.4.</span> <span class="nav-text">If not equal</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#“k”-gt-“kat”-👉-2-insertions"><span class="nav-number">10.5.</span> <span class="nav-text">“k” -&gt; “kat” 👉 2 insertions</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#The-bottom-right-value"><span class="nav-number">10.6.</span> <span class="nav-text">The bottom right value</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Edit-steps"><span class="nav-number">11.</span> <span class="nav-text">Edit steps</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Complexity"><span class="nav-number">12.</span> <span class="nav-text">Complexity</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Improving-performance"><span class="nav-number">13.</span> <span class="nav-text">Improving performance</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#More-performance"><span class="nav-number">14.</span> <span class="nav-text">More performance</span></a></li></ol>
    
    </div>
  </aside>
</section>
        
      </div>
      <footer id="footer" class="site-footer">
  

  <div class="clearfix container">
      <div class="site-info">
	      &copy; 2019 onmyway133 All Rights Reserved.
          
      </div>
      <div class="site-credit">
        Theme by <a href="https://github.com/iTimeTraveler/hexo-theme-hiero" target="_blank">hiero</a>
      </div>
  </div>
</footer>


<!-- min height -->

<script>
    var contentdiv = document.getElementById("content");

    contentdiv.style.minHeight = document.body.offsetHeight - document.getElementById("allheader").offsetHeight - document.getElementById("footer").offsetHeight + "px";
</script>

<!-- Custome JS -->
<script src="/js/my.js"></script>
    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/about/" class="mobile-nav-link">About</a>
  
    <a href="/writing/" class="mobile-nav-link">Writing</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/speaking/" class="mobile-nav-link">Speaking</a>
  
    <a href="/opensource/" class="mobile-nav-link">Open Source</a>
  
    <a href="/projects/" class="mobile-nav-link">Projects</a>
  
    <a href="/news/" class="mobile-nav-link">News</a>
  
    <a href="/gumroad/" class="mobile-nav-link">Gumroad</a>
  
    <a href="/atom.xml" class="mobile-nav-link">RSS</a>
  
</nav> -->
    

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>



  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.js"></script>


<script src="/js/scripts.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>













  </div>

  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/js/totop.js" async=""></script>
</body>
</html>
