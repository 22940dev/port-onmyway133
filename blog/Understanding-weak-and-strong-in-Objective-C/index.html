<!DOCTYPE html>
<html lang=en>
<head><meta name="generator" content="Hexo 3.9.0">
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="Issue #164 From my own blog post https://github.com/Fantageek/fantageek.github.io/blob/source/source/_posts/2014-06-27-understanding-weak-self-and-strong-self.markdown  Blocks are wonderful. To avoid">
<meta name="keywords" content="ios, android,javascript, react">
<meta property="og:type" content="article">
<meta property="og:title" content="Understanding weak and strong in Objective C">
<meta property="og:url" content="https://onmyway133.github.io/blog/Understanding-weak-and-strong-in-Objective-C/index.html">
<meta property="og:site_name" content="onmyway133">
<meta property="og:description" content="Issue #164 From my own blog post https://github.com/Fantageek/fantageek.github.io/blob/source/source/_posts/2014-06-27-understanding-weak-self-and-strong-self.markdown  Blocks are wonderful. To avoid">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2018-05-31T10:41:57.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Understanding weak and strong in Objective C">
<meta name="twitter:description" content="Issue #164 From my own blog post https://github.com/Fantageek/fantageek.github.io/blob/source/source/_posts/2014-06-27-understanding-weak-self-and-strong-self.markdown  Blocks are wonderful. To avoid">
    
    
        
          
              <link rel="shortcut icon" href="/images/icon96.jpeg">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/icon96.jpeg" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/icon96.jpeg">
          
        
    
    <!-- title -->
    <title>Understanding weak and strong in Objective C</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- persian styles -->
    
      <link rel="stylesheet" href="/css/rtl.css">
    
    <!-- rss -->
    
    
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/speaking/">Speaking</a></li>
         
          <li><a href="/opensource/">Open Source</a></li>
         
          <li><a href="/gumroad/">Gumroad</a></li>
         
          <li><a href="/news/">News</a></li>
         
          <li><a href="/jobs/">Jobs</a></li>
         
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/blog/Writing/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/blog/Interesting-how-did-you-managed-to-plug-GitHub-issues-into-the-dev.to-platform/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://onmyway133.github.io/blog/Understanding-weak-and-strong-in-Objective-C/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://onmyway133.github.io/blog/Understanding-weak-and-strong-in-Objective-C/&text=Understanding weak and strong in Objective C"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://onmyway133.github.io/blog/Understanding-weak-and-strong-in-Objective-C/&title=Understanding weak and strong in Objective C"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://onmyway133.github.io/blog/Understanding-weak-and-strong-in-Objective-C/&is_video=false&description=Understanding weak and strong in Objective C"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Understanding weak and strong in Objective C&body=Check out this article: https://onmyway133.github.io/blog/Understanding-weak-and-strong-in-Objective-C/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://onmyway133.github.io/blog/Understanding-weak-and-strong-in-Objective-C/&title=Understanding weak and strong in Objective C"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://onmyway133.github.io/blog/Understanding-weak-and-strong-in-Objective-C/&title=Understanding weak and strong in Objective C"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://onmyway133.github.io/blog/Understanding-weak-and-strong-in-Objective-C/&title=Understanding weak and strong in Objective C"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://onmyway133.github.io/blog/Understanding-weak-and-strong-in-Objective-C/&title=Understanding weak and strong in Objective C"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://onmyway133.github.io/blog/Understanding-weak-and-strong-in-Objective-C/&name=Understanding weak and strong in Objective C&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#When-block-is-created"><span class="toc-number">1.</span> <span class="toc-text">When block is created</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Block-is-object-when-it-is-copied"><span class="toc-number">1.0.1.</span> <span class="toc-text">Block is object when it is copied</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Blocks-can-capture-values-from-the-enclosing-scope"><span class="toc-number">1.0.2.</span> <span class="toc-text">Blocks can capture values from the enclosing scope</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#When-block-is-executed"><span class="toc-number">2.</span> <span class="toc-text">When block is executed</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#More-explanation"><span class="toc-number">3.</span> <span class="toc-text">More explanation</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Reference"><span class="toc-number">4.</span> <span class="toc-text">Reference</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Understanding weak and strong in Objective C
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">onmyway133</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2018-05-31T10:41:57.000Z" itemprop="datePublished">2018-05-31</time>
        
        (Updated: <time datetime="2018-05-31T10:41:57.000Z" itemprop="dateModified">2018-05-31</time>)
        
      
    </div>


      

      

    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/164" target="_blank" rel="noopener">#164</a></strong></p>
<p>From my own blog post <a href="https://github.com/Fantageek/fantageek.github.io/blob/source/source/_posts/2014-06-27-understanding-weak-self-and-strong-self.markdown" target="_blank" rel="noopener">https://github.com/Fantageek/fantageek.github.io/blob/source/source/_posts/2014-06-27-understanding-weak-self-and-strong-self.markdown</a></p>
<hr>
<p>Blocks are wonderful. To avoid retain cycle you often see the weakSelf - strongSelf dance like this</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">__<span class="keyword">weak</span> __typeof__(<span class="keyword">self</span>) weakSelf = <span class="keyword">self</span>;</span><br><span class="line">    <span class="keyword">self</span>.block = ^&#123;</span><br><span class="line">        __typeof__(<span class="keyword">self</span>) strongSelf = weakSelf;</span><br><span class="line">        [strongSelf doSomething];</span><br><span class="line">        [strongSelf doSomethingElse];</span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure>

<h2 id="When-block-is-created"><a href="#When-block-is-created" class="headerlink" title="When block is created"></a>When block is created</h2><h4 id="Block-is-object-when-it-is-copied"><a href="#Block-is-object-when-it-is-copied" class="headerlink" title="Block is object when it is copied"></a>Block is object when it is copied</h4><p>Blocks are created on the stack and will go away when their stack frame returns. While on the stack, a block has no effect on the storage or lifetime of anything it accesses.</p>
<p>If blocks need to exist after the stack frame returns, they can be copied to the heap and this action is an explicit operation. This way, a block will gain reference-counting as all objects in Cocoa. When they are copied, they take their captured scope with them, retaining any objects they refer</p>
<h4 id="Blocks-can-capture-values-from-the-enclosing-scope"><a href="#Blocks-can-capture-values-from-the-enclosing-scope" class="headerlink" title="Blocks can capture values from the enclosing scope"></a>Blocks can capture values from the enclosing scope</h4><p>As well as containing executable code, a block also has the ability to capture state from its enclosing scope. Note that block captures the variable along with its decorators (i.e. weak qualifier),</p>
<p>=&gt; This explains why you need to declare self as __weak</p>
<h2 id="When-block-is-executed"><a href="#When-block-is-executed" class="headerlink" title="When block is executed"></a>When block is executed</h2><p>When block is executed, it is possible for weakSelf to be non-nil for the first method (doSomething), but not for the second (doSomethingElse)</p>
<p>You may think, at first, this is a trick to use self inside the block avoiding the retain cycle warning. This is not the case. The strong reference to self is created at block execution time while using self in the block is evaluated at block declaration time, thus retaining the object.</p>
<p>For best practice, however, you should create a strong reference of your object using the weak one. This won’t create a retain cycle either as the strong pointer within the block will only exist until the block completes (it’s only scope is the block itself).</p>
<p>=&gt; This explains why you need to declare another __strong self</p>
<h2 id="More-explanation"><a href="#More-explanation" class="headerlink" title="More explanation"></a>More explanation</h2><p>This is my answer to reader Nikita</p>
<ol>
<li><p>As many people point out, “Blocks are created on the stack and will go away when their stack frame returns. While on the stack, a block has no effect on the storage or lifetime of anything it accesses.”<br>Even if block (declared on the stack) increase reference count to all the object it accesses, this would be useless, because this block will be discard when function returns</p>
</li>
<li><p>When block are copied (You see that people usually declare property (copy) for block), it will increase reference count to all the objects it accesses.</p>
</li>
</ol>
<p>Why? because block are mean to be executed at a later time, so it need to keep strong reference to all the object it access. Block can be executed MANY TIMES, so IT WON’T RELEASE self AFTER this ran.</p>
<p>When you nil out the block, it will be dealloc, hence it will decrease the reference count to all the objects it access.</p>
<p>AFNetworking nil out the block after it is called, so you don’t have to use weakself inside block <a href="http://www.fantageek.com/1376/afnetworking-gotcha-2/" target="_blank" rel="noopener">http://www.fantageek.com/1376/afnetworking-gotcha-2/</a></p>
<ol>
<li>So there are cases when you don’t have to use weakself inside block<br>a. Make sure the block is not copied, you simply declare and run it<br>b. Make sure the block is nil out after it is called</li>
</ol>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a href="http://dhoerl.wordpress.com/2013/04/23/i-finally-figured-out-weakself-and-strongself/" target="_blank" rel="noopener">I finally figured out weakSelf and strongSelf</a></li>
<li><a href="https://developer.apple.com/library/ios/documentation/Cocoa/Conceptual/ProgrammingWithObjectiveC/WorkingwithBlocks/WorkingwithBlocks.html" target="_blank" rel="noopener">Working with Blocks</a></li>
<li><a href="http://albertodebortoli.github.io/blog/2013/08/03/objective-c-blocks-caveat/" target="_blank" rel="noopener">Objective-C Blocks Caveat</a></li>
<li><a href="http://albertodebortoli.github.io/blog/2013/04/21/objective-c-blocks-under-the-hood/" target="_blank" rel="noopener">Objective-C Blocks Under the Hood</a></li>
<li><a href="http://www.galloway.me.uk/2012/10/a-look-inside-blocks-episode-1/" target="_blank" rel="noopener">A look inside blocks: Episode 1</a></li>
<li><a href="http://www.galloway.me.uk/2012/10/a-look-inside-blocks-episode-2/" target="_blank" rel="noopener">A look inside blocks: Episode 2</a></li>
<li><a href="http://www.galloway.me.uk/2013/05/a-look-inside-blocks-episode-3-block-copy/" target="_blank" rel="noopener">A look inside blocks: Episode 3</a></li>
<li><a href="http://nilsou.com/blog/2013/08/21/objective-c-blocks-syntax/" target="_blank" rel="noopener">From C Declarators to Objective-C Blocks Syntax</a></li>
<li><a href="http://arigrant.com/blog/2014/1/18/the-syntax-of-objective-c-blocks" target="_blank" rel="noopener">The Syntax of Objective-C Blocks</a></li>
<li><a href="http://stackoverflow.com/a/17105368/1418457" target="_blank" rel="noopener">Referring to weak self inside a nested block</a></li>
<li><a href="http://blackpixel.com/blog/2014/03/capturing-myself.html" target="_blank" rel="noopener">Capturing My(self)</a></li>
</ul>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/speaking/">Speaking</a></li>
         
          <li><a href="/opensource/">Open Source</a></li>
         
          <li><a href="/gumroad/">Gumroad</a></li>
         
          <li><a href="/news/">News</a></li>
         
          <li><a href="/jobs/">Jobs</a></li>
         
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#When-block-is-created"><span class="toc-number">1.</span> <span class="toc-text">When block is created</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Block-is-object-when-it-is-copied"><span class="toc-number">1.0.1.</span> <span class="toc-text">Block is object when it is copied</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Blocks-can-capture-values-from-the-enclosing-scope"><span class="toc-number">1.0.2.</span> <span class="toc-text">Blocks can capture values from the enclosing scope</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#When-block-is-executed"><span class="toc-number">2.</span> <span class="toc-text">When block is executed</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#More-explanation"><span class="toc-number">3.</span> <span class="toc-text">More explanation</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Reference"><span class="toc-number">4.</span> <span class="toc-text">Reference</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://onmyway133.github.io/blog/Understanding-weak-and-strong-in-Objective-C/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://onmyway133.github.io/blog/Understanding-weak-and-strong-in-Objective-C/&text=Understanding weak and strong in Objective C"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://onmyway133.github.io/blog/Understanding-weak-and-strong-in-Objective-C/&title=Understanding weak and strong in Objective C"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://onmyway133.github.io/blog/Understanding-weak-and-strong-in-Objective-C/&is_video=false&description=Understanding weak and strong in Objective C"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Understanding weak and strong in Objective C&body=Check out this article: https://onmyway133.github.io/blog/Understanding-weak-and-strong-in-Objective-C/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://onmyway133.github.io/blog/Understanding-weak-and-strong-in-Objective-C/&title=Understanding weak and strong in Objective C"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://onmyway133.github.io/blog/Understanding-weak-and-strong-in-Objective-C/&title=Understanding weak and strong in Objective C"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://onmyway133.github.io/blog/Understanding-weak-and-strong-in-Objective-C/&title=Understanding weak and strong in Objective C"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://onmyway133.github.io/blog/Understanding-weak-and-strong-in-Objective-C/&title=Understanding weak and strong in Objective C"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://onmyway133.github.io/blog/Understanding-weak-and-strong-in-Objective-C/&name=Understanding weak and strong in Objective C&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2019 Khoa Pham
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/speaking/">Speaking</a></li>
         
          <li><a href="/opensource/">Open Source</a></li>
         
          <li><a href="/gumroad/">Gumroad</a></li>
         
          <li><a href="/news/">News</a></li>
         
          <li><a href="/jobs/">Jobs</a></li>
         
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">

    <!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>
<!-- clipboard -->

  <script src="/lib/clipboard/clipboard.min.js"></script>
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight .code pre").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      target: function(trigger) {
        return trigger.nextElementSibling;
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>

<script src="/js/main.js"></script>
<!-- search -->

<!-- Google Analytics -->

    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-40119591-5', 'auto');
        ga('send', 'pageview');
    </script>

<!-- Baidu Analytics -->

<!-- Disqus Comments -->


</body>
</html>
