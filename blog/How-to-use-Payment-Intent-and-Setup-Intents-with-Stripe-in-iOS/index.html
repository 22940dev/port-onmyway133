<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">

  <!-- PACE Progress Bar START -->
  
    <script src="https://raw.githubusercontent.com/HubSpot/pace/v1.0.2/pace.min.js"></script>
    <link rel="stylesheet" href="https://github.com/HubSpot/pace/raw/master/themes/orange/pace-theme-flash.css">
  
  

  <!-- PACE Progress Bar START -->

  
  <title>how to use payment intent and setup intents with stripe in ios | onmyway133</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <meta name="keywords" content="iOSswift">
  
  
  
  
  <meta name="description" content="Issue #356 StripeHandler.swift From Stripe 16.0.0 https://github.com/stripe/stripe-ios/blob/master/CHANGELOG.md#1600-2019-07-18  Migrates STPPaymentCardTextField.cardParams property type from STPCardP">
<meta name="keywords" content="iOS,swift">
<meta property="og:type" content="article">
<meta property="og:title" content="How to use Payment Intent and Setup Intents with Stripe in iOS">
<meta property="og:url" content="https://onmyway133.github.io/blog/How-to-use-Payment-Intent-and-Setup-Intents-with-Stripe-in-iOS/index.html">
<meta property="og:site_name" content="onmyway133">
<meta property="og:description" content="Issue #356 StripeHandler.swift From Stripe 16.0.0 https://github.com/stripe/stripe-ios/blob/master/CHANGELOG.md#1600-2019-07-18  Migrates STPPaymentCardTextField.cardParams property type from STPCardP">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2019-08-27T10:13:54.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="How to use Payment Intent and Setup Intents with Stripe in iOS">
<meta name="twitter:description" content="Issue #356 StripeHandler.swift From Stripe 16.0.0 https://github.com/stripe/stripe-ios/blob/master/CHANGELOG.md#1600-2019-07-18  Migrates STPPaymentCardTextField.cardParams property type from STPCardP">
  
    <link rel="alternate" href="/atom.xml" title="onmyway133" type="application/atom+xml">
  
  <link rel="icon" href="/favicon.ico">
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="https://cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <style type="text/css">
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/9749f0/00000000000000000001008f/27/l?subset_id=2&fvd=n5) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/90cf9f/000000000000000000010091/27/l?subset_id=2&fvd=n7) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/8a5494/000000000000000000013365/27/l?subset_id=2&fvd=n4) format("woff2");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/d337d8/000000000000000000010095/27/l?subset_id=2&fvd=i4) format("woff2");font-weight:400;font-style:italic;}</style>
    
  <link rel="stylesheet" id="athemes-headings-fonts-css" href="//fonts.googleapis.com/css?family=Yanone+Kaffeesatz%3A200%2C300%2C400%2C700&amp;ver=4.6.1" type="text/css" media="all">
  <link rel="stylesheet" href="/css/style.css">

  <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.0.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/hiero.css">
  <link rel="stylesheet" href="/css/glyphs.css">
  

  <!-- Custom CSS -->
  <link rel="stylesheet" href="/css/my.css">
  <!-- Google Adsense -->
  
</head>
</html>
<script>
var themeMenus = {};

  themeMenus["/"] = "Home"; 

  themeMenus["/about/"] = "About"; 

  themeMenus["/writing/"] = "writing"; 

  themeMenus["/archives"] = "Archives"; 

  themeMenus["/speaking/"] = "speaking"; 

  themeMenus["/opensource/"] = "open source"; 

  themeMenus["/projects/"] = "projects"; 

  themeMenus["/news/"] = "news"; 

  themeMenus["/gumroad/"] = "gumroad"; 

  themeMenus["/atom.xml"] = "rss"; 

</script>


  <body data-spy="scroll" data-target="#toc" data-offset="50">


  <header id="allheader" class="site-header" role="banner">
  <div class="clearfix container">
      <div class="site-branding">

          <h1 class="site-title">
            
              <a href="/" title="onmyway133" rel="home"> onmyway133 </a>
            
          </h1>

          
            <div class="site-description">What you don&#39;t know is what you haven&#39;t learned</div>
          
            
          <nav id="main-navigation" class="main-navigation" role="navigation">
            <a class="nav-open">Menu</a>
            <a class="nav-close">Close</a>
            <div class="clearfix sf-menu">

              <ul id="main-nav" class="nmenu sf-js-enabled">
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/">Home</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/about/">About</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/writing/">writing</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/archives">Archives</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/speaking/">speaking</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/opensource/">open source</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/projects/">projects</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/news/">news</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/gumroad/">gumroad</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/atom.xml">rss</a> </li>
                    
              </ul>
            </div>
          </nav>


      </div>
  </div>
</header>


  <div id="originBgDiv" style="background: #fff; width: 100%;">

      <div style="max-height:600px; overflow: hidden;  display: flex; display: -webkit-flex; align-items: center;">
        <img id="originBg" width="100%" alt="" src="">
      </div>

  </div>

  <script>
  function setAboutIMG(){
      var imgUrls = "https://avatars1.githubusercontent.com/u/2284279?s=460&v=4".split(",");
      var random = Math.floor((Math.random() * imgUrls.length ));
      if (imgUrls[random].startsWith('http') || imgUrls[random].indexOf('://') >= 0) {
        document.getElementById("originBg").src=imgUrls[random];
      } else {
        document.getElementById("originBg").src='/' + imgUrls[random];
      }
  }
  bgDiv=document.getElementById("originBgDiv");
  if(location.pathname.match('about')){
    setAboutIMG();
    bgDiv.style.display='block';
  }else{
    bgDiv.style.display='none';
  }
  </script>



  <div id="container">
    <div id="wrap">
            
      <div id="content" class="outer">
        
          <section id="main" style="float:none;"><article id="post-How-to-use-Payment-Intent-and-Setup-Intents-with-Stripe-in-iOS" style="width: 66%; float:left;" class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" class="article-title" itemprop="name">
      How to use Payment Intent and Setup Intents with Stripe in iOS
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	Posted on <a href="/blog/How-to-use-Payment-Intent-and-Setup-Intents-with-Stripe-in-iOS/" class="article-date">
	  <time datetime="2019-08-14T09:05:23.000Z" itemprop="datePublished">August 14, 2019</time>
	</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/356" target="_blank" rel="noopener">#356</a></strong></p>
<p><code>StripeHandler.swift</code></p>
<p>From Stripe 16.0.0 <a href="https://github.com/stripe/stripe-ios/blob/master/CHANGELOG.md#1600-2019-07-18" target="_blank" rel="noopener">https://github.com/stripe/stripe-ios/blob/master/CHANGELOG.md#1600-2019-07-18</a></p>
<blockquote>
<p>Migrates STPPaymentCardTextField.cardParams property type from STPCardParams to STPPaymentMethodCardParams</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">StripeHandler</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">createPaymentMethod</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        textField: STPPaymentCardTextField,</span></span></span><br><span class="line"><span class="function"><span class="params">        completion: @escaping <span class="params">(Result&lt;STPPaymentMethod, Error&gt;)</span></span></span> -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> paymentMethodParams = <span class="type">STPPaymentMethodParams</span>(</span><br><span class="line">            card: textField.cardParams,</span><br><span class="line">            billingDetails: <span class="literal">nil</span>,</span><br><span class="line">            metadata: <span class="literal">nil</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="type">STPAPIClient</span>.shared().createPaymentMethod(</span><br><span class="line">            with: paymentMethodParams,</span><br><span class="line">            completion: &#123; paymentMethod, error <span class="keyword">in</span></span><br><span class="line">                <span class="type">DispatchQueue</span>.main.async &#123;</span><br><span class="line">                    <span class="keyword">if</span> <span class="keyword">let</span> paymentMethod = paymentMethod &#123;</span><br><span class="line">                        completion(.success(paymentMethod))</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        completion(.failure(error ?? <span class="type">AppError</span>.request))</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="type">STPAPIClient</span>.shared().createPaymentMethod(</span><br><span class="line">            with: paymentMethodParams,</span><br><span class="line">            completion: &#123; paymentMethod, error <span class="keyword">in</span></span><br><span class="line">                <span class="type">DispatchQueue</span>.main.async &#123;</span><br><span class="line">                    <span class="keyword">if</span> <span class="keyword">let</span> paymentMethod = paymentMethod &#123;</span><br><span class="line">                        completion(.success(paymentMethod))</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        completion(.failure(error ?? <span class="type">AppError</span>.request))</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">confirmSetupIntents</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        clientSecret: String,</span></span></span><br><span class="line"><span class="function"><span class="params">        paymentMethodId: String,</span></span></span><br><span class="line"><span class="function"><span class="params">        context: STPAuthenticationContext?,</span></span></span><br><span class="line"><span class="function"><span class="params">        completion: @escaping <span class="params">(Result&lt;STPSetupIntent, Error&gt;)</span></span></span> -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> context = context <span class="keyword">else</span> &#123;</span><br><span class="line">            completion(.failure(<span class="type">AppError</span>.invalid))</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> setupIntentParams = <span class="type">STPSetupIntentConfirmParams</span>(clientSecret: clientSecret)</span><br><span class="line">        setupIntentParams.paymentMethodID = paymentMethodId</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> paymentHandler = <span class="type">STPPaymentHandler</span>.shared()</span><br><span class="line">        paymentHandler.confirmSetupIntent(</span><br><span class="line">            setupIntentParams,</span><br><span class="line">            with: context,</span><br><span class="line">            completion: &#123; status, intent, error <span class="keyword">in</span></span><br><span class="line">                <span class="type">DispatchQueue</span>.main.async &#123;</span><br><span class="line">                    <span class="keyword">if</span> <span class="keyword">case</span> .succeeded = status, <span class="keyword">let</span> intent = intent &#123;</span><br><span class="line">                        completion(.success(intent))</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        completion(.failure(error ?? <span class="type">AppError</span>.invalid))</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">     <span class="function"><span class="keyword">func</span> <span class="title">confirmPaymentIntents</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        clientSecret: String,</span></span></span><br><span class="line"><span class="function"><span class="params">        context: STPAuthenticationContext?,</span></span></span><br><span class="line"><span class="function"><span class="params">        completion: @escaping <span class="params">(Result&lt;STPPaymentIntent, Error&gt;)</span></span></span> -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> context = context <span class="keyword">else</span> &#123;</span><br><span class="line">            completion(.failure(<span class="type">AppError</span>.invalid))</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">STPPaymentHandler</span>.shared().handleNextAction(</span><br><span class="line">            forPayment: clientSecret,</span><br><span class="line">            with: context,</span><br><span class="line">            returnURL: <span class="literal">nil</span>,</span><br><span class="line">            completion: &#123; status, paymentIntent, error <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">case</span> .succeeded = status, <span class="keyword">let</span> paymentIntent = paymentIntent &#123;</span><br><span class="line">                    completion(.success(paymentIntent))</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    completion(.failure(error ?? <span class="type">AppError</span>.invalid))</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">toCard</span><span class="params">(paymentMethod: STPPaymentMethod)</span></span> -&gt; <span class="type">MyCard?</span> &#123;</span><br><span class="line">        <span class="keyword">guard</span></span><br><span class="line">            <span class="keyword">let</span> card = paymentMethod.card,</span><br><span class="line">            <span class="keyword">let</span> last4 = card.last4</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> withValue(<span class="type">MyCard</span>()) &#123;</span><br><span class="line">            $<span class="number">0</span>.expiryYear = <span class="type">UInt32</span>(card.expYear)</span><br><span class="line">            $<span class="number">0</span>.expiryMonth = <span class="type">UInt32</span>(card.expMonth)</span><br><span class="line">            $<span class="number">0</span>.lastFourDigits = last4</span><br><span class="line">            $<span class="number">0</span>.brand = <span class="type">STPCard</span>.string(from: card.brand)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Payment-intents"><a href="#Payment-intents" class="headerlink" title="Payment intents"></a>Payment intents</h2><p><a href="https://stripe.com/docs/payments/payment-intents/creating-payment-intents" target="_blank" rel="noopener">https://stripe.com/docs/payments/payment-intents/creating-payment-intents</a></p>
<blockquote>
<p>When using automatic confirmation, create the PaymentIntent at the beginning of the checkout process. When using manual confirmation, create the PaymentIntent after collecting payment information from the customer using Elements or our iOS and Android SDKs. For a detailed comparison on the automatic and manual confirmation flows, see accepting one-time payments.</p>
</blockquote>
<h4 id="Step-3-Authenticate-the-payment-if-necessary"><a href="#Step-3-Authenticate-the-payment-if-necessary" class="headerlink" title="Step 3: Authenticate the payment if necessary"></a>Step 3: Authenticate the payment if necessary</h4><blockquote>
<p>Pass the confirmed Payment Intent client secret from the previous step to STPPaymentHandler handleNextActionForPayment. If the customer must perform 3D Secure authentication to complete the payment, STPPaymentHandler presents view controllers using the STPAuthenticationContext passed in and walks them through that process. See Supporting 3D Secure Authentication on iOS to learn more.</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">MyAPIClient</span>.createAndConfirmPaymentIntent(paymentMethodId: paymentMethodId) &#123; result <span class="keyword">in</span></span><br><span class="line">  <span class="keyword">guard</span> <span class="keyword">case</span> .success(<span class="keyword">let</span> paymentIntentClientSecret) = result <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// Handle error</span></span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="type">STPPaymentHandler</span>.shared().handleNextAction(forPayment: paymentIntentClientSecret, with: <span class="keyword">self</span>, returnURL: <span class="literal">nil</span>) &#123; (status, paymentIntent, error) <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">switch</span> (status) &#123;</span><br><span class="line">      <span class="keyword">case</span> .succeeded:</span><br><span class="line">        <span class="comment">// ...Continued in Step 4</span></span><br><span class="line">      <span class="keyword">case</span> .canceled:</span><br><span class="line">        <span class="comment">// Handle cancel</span></span><br><span class="line">      <span class="keyword">case</span> .failed:</span><br><span class="line">        <span class="comment">// Handle error</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Setup-intents"><a href="#Setup-intents" class="headerlink" title="Setup intents"></a>Setup intents</h2><p>There is Setup intents <a href="https://stripe.com/docs/payments/cards/reusing-cards#saving-cards-without-payment" target="_blank" rel="noopener">https://stripe.com/docs/payments/cards/reusing-cards#saving-cards-without-payment</a> for saving cards</p>
<blockquote>
<p>Use the Setup Intents API to authenticate a customer’s card without making an initial payment. This flow works best for businesses that want to onboard customers without charging them right away:</p>
</blockquote>
<h4 id="Step-4-Submit-the-card-details-to-Stripe-from-the-client"><a href="#Step-4-Submit-the-card-details-to-Stripe-from-the-client" class="headerlink" title="Step 4: Submit the card details to Stripe from the client"></a>Step 4: Submit the card details to Stripe from the client</h4><blockquote>
<p>Pass the STPSetupIntentParams object to the confirmSetupIntent method on a STPPaymentHandler sharedManager. If the customer must perform additional steps to complete the payment, such as authentication, STPPaymentHandler presents view controllers using the STPAuthenticationContext passed in and walks them through that process. See Supporting 3D Secure Authentication on iOS to learn more.</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> setupIntentParams = <span class="type">STPSetupIntentParams</span>(clientSecret: clientSecret)</span><br><span class="line">setupIntentParams.paymentMethodId = paymentMethodId</span><br><span class="line"><span class="keyword">let</span> paymentManager = <span class="type">STPPaymentHandler</span>.shared()</span><br><span class="line">paymentManager.confirmSetupIntent(setupIntentParams, authenticationContext: <span class="keyword">self</span>, completion &#123; (status, setupIntent, error) <span class="keyword">in</span></span><br><span class="line">  <span class="keyword">switch</span> (status) &#123;</span><br><span class="line">    <span class="keyword">case</span> .succeeded:</span><br><span class="line">      <span class="comment">// Setup succeeded</span></span><br><span class="line">    <span class="keyword">case</span> .canceled:</span><br><span class="line">      <span class="comment">// Handle cancel</span></span><br><span class="line">    <span class="keyword">case</span> .failed:</span><br><span class="line">      <span class="comment">// Handle error</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="Authentication-context"><a href="#Authentication-context" class="headerlink" title="Authentication context"></a>Authentication context</h2><p>In <code>STPPaymentHandler.m</code></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">BOOL</span>)_canPresentWithAuthenticationContext:(<span class="keyword">id</span>&lt;STPAuthenticationContext&gt;)authenticationContext &#123;</span><br><span class="line">    <span class="built_in">UIViewController</span> *presentingViewController = authenticationContext.authenticationPresentingViewController;</span><br><span class="line">    <span class="comment">// Is presentingViewController non-nil and in the window?</span></span><br><span class="line">    <span class="keyword">if</span> (presentingViewController == <span class="literal">nil</span> || presentingViewController.view.window == <span class="literal">nil</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Is it the Apple Pay VC?</span></span><br><span class="line">    <span class="keyword">if</span> ([presentingViewController isKindOfClass:[PKPaymentAuthorizationViewController <span class="keyword">class</span>]]) &#123;</span><br><span class="line">        <span class="comment">// We can't present over Apple Pay, user must implement prepareAuthenticationContextForPresentation: to dismiss it.</span></span><br><span class="line">        <span class="keyword">return</span> [authenticationContext respondsToSelector:<span class="keyword">@selector</span>(prepareAuthenticationContextForPresentation:)];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Is it already presenting something?</span></span><br><span class="line">    <span class="keyword">if</span> (presentingViewController.presentedViewController == <span class="literal">nil</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Hopefully the user implemented prepareAuthenticationContextForPresentation: to dismiss it.</span></span><br><span class="line">        <span class="keyword">return</span> [authenticationContext respondsToSelector:<span class="keyword">@selector</span>(prepareAuthenticationContextForPresentation:)];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Use-stripe-SDK"><a href="#Use-stripe-SDK" class="headerlink" title="Use stripe SDK"></a>Use stripe SDK</h2><p><code>STPSetupIntentConfirmParams.useStripeSDK</code></p>
<blockquote>
<p> A boolean number to indicate whether you intend to use the Stripe SDK’s functionality to handle any SetupIntent next actions.<br>If set to false, STPSetupIntent.nextAction will only ever contain a redirect url that can be opened in a webview or mobile browser.<br>When set to true, the nextAction may contain information that the Stripe SDK can use to perform native authentication within your app.</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> setupIntentParams = <span class="type">STPSetupIntentConfirmParams</span>(clientSecret: clientSecret)</span><br><span class="line">setupIntentParams.useStripeSDK = <span class="type">NSNumber</span>(booleanLiteral: <span class="literal">true</span>)</span><br></pre></td></tr></table></figure>

<h2 id="Read-more"><a href="#Read-more" class="headerlink" title="Read more"></a>Read more</h2><ul>
<li><a href="https://stripe.com/docs/payments/payment-intents/ios#create-and-confirm-payment-intent-manual" target="_blank" rel="noopener">Using Payment Intents on iOS</a></li>
<li><a href="https://stripe.com/docs/payments/payment-intents" target="_blank" rel="noopener">One-time Payments with the Payment Intents API</a></li>
<li><a href="https://stripe.com/docs/mobile/ios/authentication#return-url" target="_blank" rel="noopener">Supporting 3D Secure Authentication on iOS</a></li>
<li><a href="https://stripe.dev/stripe-ios/docs/Classes/STPSetupIntentConfirmParams.html" target="_blank" rel="noopener">STPSetupIntentConfirmParams</a></li>
<li><a href="https://stripe.com/docs/testing" target="_blank" rel="noopener">Testing</a></li>
</ul>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/">iOS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/swift/">swift</a></li></ul>

      
            
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/blog/How-to-declare-generic-RecyclerView-adapter-in-Android/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          How to declare generic RecyclerView adapter in Android
        
      </div>
    </a>
  
  
    <a href="/blog/How-to-format-currency-in-Swift/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">How to format currency in Swift</div>
    </a>
  
</nav>

  
</article>

<!-- Table of Contents -->

  <aside id="sidebar">
    <div id="toc" class="toc-article" style="overflow-y: scroll; max-width: 28%;">
    <strong class="toc-title">Contents</strong>
    
      <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Payment-intents"><span class="nav-number">1.</span> <span class="nav-text">Payment intents</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Step-3-Authenticate-the-payment-if-necessary"><span class="nav-number">1.0.1.</span> <span class="nav-text">Step 3: Authenticate the payment if necessary</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Setup-intents"><span class="nav-number">2.</span> <span class="nav-text">Setup intents</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Step-4-Submit-the-card-details-to-Stripe-from-the-client"><span class="nav-number">2.0.1.</span> <span class="nav-text">Step 4: Submit the card details to Stripe from the client</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Authentication-context"><span class="nav-number">3.</span> <span class="nav-text">Authentication context</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Use-stripe-SDK"><span class="nav-number">4.</span> <span class="nav-text">Use stripe SDK</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Read-more"><span class="nav-number">5.</span> <span class="nav-text">Read more</span></a></li></ol>
    
    </div>
  </aside>
</section>
        
      </div>
      <footer id="footer" class="site-footer">
  

  <div class="clearfix container">
      <div class="site-info">
	      &copy; 2019 onmyway133 All Rights Reserved.
          
      </div>
      <div class="site-credit">
        Theme by <a href="https://github.com/iTimeTraveler/hexo-theme-hiero" target="_blank">hiero</a>
      </div>
  </div>
</footer>


<!-- min height -->

<script>
    var contentdiv = document.getElementById("content");

    contentdiv.style.minHeight = document.body.offsetHeight - document.getElementById("allheader").offsetHeight - document.getElementById("footer").offsetHeight + "px";
</script>

<!-- Custome JS -->
<script src="/js/my.js"></script>
    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/about/" class="mobile-nav-link">About</a>
  
    <a href="/writing/" class="mobile-nav-link">Writing</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/speaking/" class="mobile-nav-link">Speaking</a>
  
    <a href="/opensource/" class="mobile-nav-link">Open Source</a>
  
    <a href="/projects/" class="mobile-nav-link">Projects</a>
  
    <a href="/news/" class="mobile-nav-link">News</a>
  
    <a href="/gumroad/" class="mobile-nav-link">Gumroad</a>
  
    <a href="/atom.xml" class="mobile-nav-link">RSS</a>
  
</nav> -->
    

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>



  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.js"></script>


<script src="/js/scripts.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>


<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-40119591-5', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->












  </div>

  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/js/totop.js" async=""></script>
</body>
</html>
